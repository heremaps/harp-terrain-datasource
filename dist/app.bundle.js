!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=151)}([function(e,t){e.exports=THREE},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(87)),r(n(88)),r(n(92)),r(n(93)),r(n(94)),r(n(95)),r(n(96)),r(n(97)),r(n(98)),r(n(99))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(8)),r(n(78)),r(n(6)),r(n(13)),r(n(34)),r(n(79)),r(n(21)),r(n(35)),r(n(36)),r(n(37)),r(n(22)),r(n(80)),r(n(38)),r(n(14)),r(n(39)),r(n(40)),r(n(15)),r(n(81)),r(n(82)),r(n(83)),r(n(84)),r(n(9))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(43)),r(n(86)),r(n(101)),r(n(23)),r(n(102)),r(n(103)),r(n(104)),r(n(105)),r(n(44)),r(n(106)),r(n(107)),r(n(108))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(114)),r(n(54)),r(n(115)),r(n(116)),r(n(117))},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},a={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=180/Math.PI,i=Math.PI/180,o=function(){function e(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n}return e.fromDegrees=function(t,n,r){return new e(t,n,r)},e.fromRadians=function(t,n,i){return new e(t*r,n*r,i)},Object.defineProperty(e.prototype,"latitudeInRadians",{get:function(){return this.latitude*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInRadians",{get:function(){return this.longitude*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeInDegrees",{get:function(){return this.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInDegrees",{get:function(){return this.longitude},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!isNaN(this.latitude)&&!isNaN(this.longitude)},e.prototype.normalized=function(){var t,n=this.latitude,r=this.longitude;if(isNaN(n)||isNaN(r))return this;n>90&&((t=(n+90)%360)>=180&&(r+=180,t=360-t),n=t-90);n<-90&&((t=(n-90)%360)<=-180&&(r+=180,t=-360-t),n=t+90);return(r<-180||r>180)&&(r=(r+180)%360-180),n===this.latitude&&r===this.longitude?this:new e(n,r,this.altitude)},e.prototype.equals=function(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude},e.prototype.copy=function(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this},e.prototype.clone=function(){return new e(this.latitude,this.longitude,this.altitude)},e}();t.GeoCoordinates=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(33)),r(n(16)),r(n(41)),r(n(109)),r(n(110)),r(n(49)),r(n(50)),r(n(17)),r(n(18)),r(n(56)),r(n(58)),r(n(124)),r(n(61)),r(n(19)),r(n(59)),r(n(60)),r(n(132)),r(n(133)),r(n(64)),r(n(12)),r(n(63)),r(n(55)),r(n(62)),r(n(30))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=Math.PI/180,o=function(){function e(e,t){this.southWest=e,this.northEast=t}return e.fromCoordinates=function(t,n){return new e(t,n)},Object.defineProperty(e.prototype,"minAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"south",{get:function(){return this.southWest.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"north",{get:function(){return this.northEast.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"west",{get:function(){return this.southWest.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"east",{get:function(){return this.northEast.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){var e,t=.5*(this.south+this.north),n=this.west,i=this.east,o=this.minAltitude,a=this.altitudeSpan;if(void 0!==o&&void 0!==a&&(e=o+.5*a),n<i)return new r.GeoCoordinates(t,.5*(n+i),e);var s=.5*(360+i+n);return s>360&&(s-=360),new r.GeoCoordinates(t,s,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInRadians",{get:function(){return this.latitudeSpan*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInRadians",{get:function(){return this.longitudeSpan*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpan",{get:function(){return this.north-this.south},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altitudeSpan",{get:function(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpan",{get:function(){var e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInDegrees",{get:function(){return this.latitudeSpan},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInDegrees",{get:function(){return this.longitudeSpan},enumerable:!0,configurable:!0}),e.prototype.contains=function(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);var t=this.minAltitude===this.maxAltitude,n=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!n:!r)&&this.containsHelper(e)},e.prototype.clone=function(){return new e(this.southWest,this.northEast)},e.prototype.containsHelper=function(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;var t=this.west,n=this.east;return n>t?e.longitude>=t&&e.longitude<n:e.longitude>n||e.longitude<=t},e}();t.GeoBox=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.PI/180,i=180/Math.PI;!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function n(e,n){var r=(e=t(e))-(n=t(n));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.degToRad=function(e){return e*r},e.radToDeg=function(e){return e*i},e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.normalizeAngleDeg=t,e.angleDistanceDeg=n,e.interpolateAnglesDeg=function(e,t,r){return(e+n(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(111)),r(n(26)),r(n(51)),r(n(27)),r(n(28)),r(n(53))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(13),a=n(0);!function(e){var t=new a.Plane(new a.Vector3(0,0,1)),n=new a.Vector3(0,0,0),s=new a.Matrix4,u=new a.Matrix4,l=new a.Raycaster,c=new a.Quaternion,d=new a.Quaternion,h=new a.Vector3(0,0,1),f=new a.Vector3(1,0,0);function p(e,r,i){var o=new a.Vector3(r,i,.5),c=e.worldCenter;n.copy(e.camera.position),s.extractRotation(e.camera.matrixWorld),u.multiplyMatrices(s,u.getInverse(e.camera.projectionMatrix));var d=o.applyMatrix4(u);l.set(n,d.normalize());var h=new a.Vector3,f=l.ray.intersectPlane(t,h);return f?(f.setX(f.x+c.x),f.setY(f.y+c.y),f):null}function m(e,t){var n=Math.pow(2,t);return o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/n/(2*Math.tan(.5*i.MathUtils.degToRad(e.camera.fov))*e.zoomLevelBias)}function v(e,t,n){var r=e.worldCenter;r.setX(r.x+t),r.setY(r.y+n),e.update()}function g(e){return e.substring(0,2)}e.zoomOnTargetPosition=function(e,t,n,r){var i=p(e,t,n);e.camera.position.setZ(m(e,r)),e.camera.matrixWorldNeedsUpdate=!0;var o=p(e,t,n);if(i&&o){var a=i.sub(o);v(e,a.x,a.y)}},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,n,r,i){var o=m(i,t),s=a.Math.degToRad(r),u=o*Math.tan(s),l=a.Math.degToRad(n),c=i.projection.projectPoint(e),d={x:c.x+Math.sin(l)*u,y:c.y-Math.cos(l)*u,z:0};return i.projection.unprojectPoint(d)},e.rayCastWorldCoordinates=p,e.calculateDistanceToGroundFromZoomLevel=m,e.pan=v,e.setRotation=function(e,t,n){c.setFromAxisAngle(h,i.MathUtils.degToRad(t)),d.setFromAxisAngle(f,i.MathUtils.degToRad(n)),c.multiply(d),e.camera.quaternion.copy(c),e.camera.matrixWorldNeedsUpdate=!0},e.extractYawPitchRoll=function(e){var t=e.y*e.y,n=2*(e.w*e.x+e.y*e.z),r=1-2*(e.x*e.x+t),i=Math.atan2(n,r),o=2*(e.w*e.y-e.z*e.x);o=(o=o>1?1:o)<-1?-1:o;var a=Math.asin(o),s=2*(e.w*e.z+e.x*e.y),u=1-2*(t+e.z*e.z);return{yaw:Math.atan2(s,u),pitch:i,roll:a}},e.rayCastGeoCoordinates=function(e,t,n){var r=p(e,t,n);return r?e.projection.unprojectPoint(r):null},e.calculateZoomLevelFromHeight=function(e,t){var n=e*t.zoomLevelBias*2*Math.tan(i.MathUtils.degToRad(t.camera.fov/2)),r=o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/2,a=n/2,s=Math.log2(r/a);return i.MathUtils.clamp(s,t.minZoomLevel,t.maxZoomLevel)},e.calculateDepthFromClipDistance=function(e,t){var n=t,r=n.far-n.near,i=e*n.far;return(1-n.near/i)*(n.far/r)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.estimateObjectSize=function(e){if("function"==typeof e)return 0;for(var t=new Map,n=[e],r=0;n.length>0;){var i=n.pop();if(Array.isArray(i)&&i.length>0&&"object"!=typeof i[0])"boolean"==typeof i[0]?r+=4*i.length:"string"==typeof i[0]?i.forEach(function(e){void 0!==e.length&&(r+=2*e.length)}):"number"==typeof i[0]&&(r+=8*i.length);else if("boolean"==typeof i)r+=4;else if("string"==typeof i)r+=2*i.length;else if("number"==typeof i)r+=8;else if(void 0!==i&&null!==i&&void 0!==i.byteLength)r+=i.byteLength;else if("object"==typeof i&&null!==i&&!1===t.has(i)){t.set(i,"");var o=i;for(var a in o)void 0!==o[a]&&"function"!=typeof o[a]&&n.push(o[a])}}return r},e.getBrowserLanguages=function(){var e,t;if(void 0!==navigator.languages&&navigator.languages.length>0){var n=[];try{for(var i=r(navigator.languages),o=i.next();!o.done;o=i.next()){var a=o.value;n.push(g(a))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n}if(void 0!==navigator.language)return[g(navigator.language)]}}(t.MapViewUtils||(t.MapViewUtils={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,e}();t.EarthConstants=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,9007199254740992,0x8000000000000],i=function(){function e(e,t,n){this.row=e,this.column=t,this.level=n}return e.fromRowColumnLevel=function(t,n,r){return new e(t,n,r)},e.fromQuadKey=function(t){for(var n=t.length,r=0,i=0,o=0;o<t.length;++o){var a=1<<o,s=parseInt(t.charAt(n-o-1),10);1&s&&(i|=a),2&s&&(r|=a)}return e.fromRowColumnLevel(r,i,n)},e.fromMortonCode=function(t){for(var n=0,r=0,i=0,o=t;o>1;){var a=1<<n;1&o&&(i|=a),2&o&&(r|=a),n++,o=(o-(3&o))/4}var s=e.fromRowColumnLevel(r,i,n);return s.m_mortonCode=t,s},e.fromHereTile=function(t){var n=e.fromMortonCode(parseInt(t,10));return n.m_hereTile=t,n},e.columnsAtLevel=function(e){return Math.pow(2,e)},e.rowsAtLevel=function(e){return Math.pow(2,e)},e.atCoords=function(t,n,r,i,o){return e.fromRowColumnLevel(Math.floor(r/(o/e.rowsAtLevel(t))),Math.floor(n/(i/e.columnsAtLevel(t))),t)},e.parentMortonCode=function(e){return Math.floor(e/4)},e.prototype.parent=function(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return e.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)},e.prototype.changedLevelBy=function(t){var n=Math.max(0,this.level+t),r=this.row,i=this.column;return t>=0?(r<<=t,i<<=t):(r>>>=-t,i>>>=-t),e.fromRowColumnLevel(r,i,n)},e.prototype.changedLevelTo=function(e){return this.changedLevelBy(e-this.level)},e.prototype.mortonCode=function(){if(void 0===this.m_mortonCode){for(var e=this.column,t=this.row,n=r[this.level<<1],i=0;i<this.level;++i)1&e&&(n+=r[2*i]),1&t&&(n+=r[2*i+1]),e>>>=1,t>>>=1;this.m_mortonCode=n}return this.m_mortonCode},e.prototype.toHereTile=function(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile},e.prototype.toQuadKey=function(){for(var e="",t=this.level;t>0;--t){var n=1<<t-1,r=0!=(this.column&n),i=0!=(this.row&n);e+=r&&i?"3":i?"2":r?"1":"0"}return e},e.prototype.equals=function(e){return this.row===e.row&&this.column===e.column&&this.level===e.level},e.prototype.addedSubKey=function(t){var n=e.fromQuadKey(0===t.length?"-":t),r=this.changedLevelBy(n.level);return e.fromRowColumnLevel(r.row+n.row,r.column+n.column,r.level)},e.prototype.addedSubHereTile=function(t){var n=e.fromHereTile(t),r=this.changedLevelBy(n.level);return e.fromRowColumnLevel(r.row+n.row,r.column+n.column,r.level)},e.prototype.getSubHereTile=function(e){var t=1<<2*e;return(this.mortonCode()&t-1|t).toString()},e.prototype.rowCount=function(){return e.rowsAtLevel(this.level)},e.prototype.columnCount=function(){return e.columnsAtLevel(this.level)},e}();t.TileKey=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),i=n(39),o=n(40),a=function(){function e(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}return e.prototype.getSubTileKeys=function(e){return this.tileTreeTraverse.subTiles(e)},e.prototype.getTileKey=function(e,t){return i.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)},e.prototype.getTileKeys=function(e,t){return i.TileKeyUtils.geoRectangleToTileKeys(this,e,t)},e.prototype.getGeoBox=function(e){return this.boundingBoxGenerator.getGeoBox(e)},e.prototype.getWorldBox=function(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)},e}();t.TilingScheme=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){this.m_map=new Map}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance},enumerable:!0,configurable:!0}),e.prototype.getColor=function(e){var t=this.m_map.get(e);return void 0!==t?t:(t=new r.Color(e),this.m_map.set(e,t),t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_map.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_map.clear()},e.m_instance=new e,e}();t.ColorCache=i},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(10),a=n(0);!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(i=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800;var s=function(){function e(e,n,r,o,a,s){void 0===e&&(e=i.Undefined),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=Number.MIN_SAFE_INTEGER),void 0===s&&(s=t.DEFAULT_FADE_TIME),this.state=e,this.value=n,this.startTime=r,this.opacity=o,this.lastFrameNumber=a,this.fadingTime=s}return e.prototype.reset=function(){this.state=i.Undefined,this.value=0,this.startTime=0,this.opacity=1,this.lastFrameNumber=Number.MIN_SAFE_INTEGER},e.prototype.isFading=function(){return this.state===i.FadingIn||this.state===i.FadingOut},e.prototype.isFadingIn=function(){return this.state===i.FadingIn},e.prototype.isFadingOut=function(){return this.state===i.FadingOut},e.prototype.isFadedOut=function(){return this.state===i.FadedOut},e.prototype.isVisible=function(){return this.state===i.FadingIn||this.state===i.FadedIn||this.state===i.FadingOut},e}();t.RenderState=s;var u=function(){function e(e,t,n,r,i,a,s,u,l,c,d,h,f,p,m){void 0===n&&(n=0),void 0===r&&(r=1),this.text=e,this.points=t,this.priority=n,this.scale=r,this.xOffset=i,this.yOffset=a,this.featureId=s,this.style=u,this.allCaps=l,this.smallCaps=c,this.oblique=d,this.bold=h,this.fadeNear=p,this.fadeFar=m,this.distanceScale=.5,this.renderOrder=0,this.sortPriority=0,this.allGlyphsLoaded=!1,this.textWidth=0,this.textDirection=o.GlyphDirection.LTR,this.bidirectional=!1,this.verticalAlignment=o.TextVerticalAlignment.Center,this.horizontalAlignment=o.TextHorizontalAlignment.Center,this.m_trackingFactor=0,void 0!==f&&(this.m_trackingFactor=f)}return Object.defineProperty(e.prototype,"position",{get:function(){return this.points instanceof Array?this.points[0]:this.points instanceof a.Vector3?new a.Vector2(this.points.x,this.points.y):this.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position3",{get:function(){return this.points instanceof a.Vector3?this.points:this.points instanceof Array?new a.Vector3(this.points[0].x,this.points[0].y,0):new a.Vector3(this.points.x,this.points.y,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){if(this.points instanceof Array)return this.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textMayOverlap",{get:function(){return!0===this.mayOverlap},set:function(e){this.mayOverlap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textReservesSpace",{get:function(){return!1!==this.reserveSpace},set:function(e){this.reserveSpace=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tracking",{get:function(){return this.m_trackingFactor},set:function(e){this.m_trackingFactor=e},enumerable:!0,configurable:!0}),e.prototype.computeCodePoints=function(e){var t,n,i,a;if(void 0===this.m_codepoints){var s="";this.m_codepoints=[],this.m_convertedToUpperCase=[];try{for(var u=r(this.text),l=u.next();!l.done;l=u.next()){for(var c=l.value,d=!0===e?c.toUpperCase():c,h=c!==d,f=d.length,p=0;p++<f;)this.m_convertedToUpperCase.push(h);s+=d}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}var m=o.ContextualArabicConverter.instance.convert(s);try{for(var v=r(m),g=v.next();!g.done;g=v.next()){c=g.value;this.m_codepoints.push(c.codePointAt(0))}}catch(e){i={error:e}}finally{try{g&&!g.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}}return this.m_codepoints},Object.defineProperty(e.prototype,"convertedToUpperCase",{get:function(){return this.m_convertedToUpperCase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codePoints",{get:function(){return this.m_codepoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLineMarker",{get:function(){return void 0!==this.points&&void 0!==this.m_poiInfo&&"line-marker"===this.m_poiInfo.technique.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderDistance",{get:function(){return!0===this.alwaysOnTop?0:void 0!==this.currentViewDistance?-this.currentViewDistance:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poiInfo",{get:function(){return this.m_poiInfo},set:function(e){if(this.m_poiInfo=e,void 0!==e){var t=void 0!==this.renderOrder?o.BG_TEXT_RENDER_ORDER+this.renderOrder:0;e.renderOrder=t}},enumerable:!0,configurable:!0}),e}();t.TextElement=u},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),s=n(1),u=n(0),l=n(16),c=n(19),d=n(118),h=n(57),f=n(123),p=n(17),m=!0,v=!1,g=500;t.DEFAULT_TEXT_DISTANCE_SCALE=.5;var y,_=300,b=.99,x=.4,w=[40,41,60,62,91,93,123,125],T=s.LoggerManager.instance.create("TextElementsRenderer"),C=1,E=new Array,S=new u.Box2,A=new s.Math2D.Box,P=new u.Vector3,M=new u.Vector3,O=new u.Vector2,L=new u.Vector2,I=new u.Matrix4,F=new s.Math2D.Box,R=new u.Vector3,k={x:1/0,y:1/0,width:-1/0,height:-1/0},D=new u.Box2,j=new u.Vector3(0,0,0),B=new u.Vector4,U=new s.Math2D.Box;!function(e){e[e.None=0]="None",e[e.Visibility=1]="Visibility",e[e.ExtremeAngle=2]="ExtremeAngle",e[e.PathOverflow=3]="PathOverflow",e[e.BufferOverflow=4]="BufferOverflow"}(y||(y={}));var z=function(){return function(e,t){this.tile=e,this.textElements=t}}(),N=function(){return function(e,t){this.priority=e,this.textElementLists=t}}(),G=function(){function e(e,t,n,r,i,o,s,l,c){if(this.m_mapView=e,this.m_screenCollisions=t,this.m_screenProjector=n,this.m_theme=r,this.m_maxNumVisibleLabels=i,this.m_numSecondChanceLabels=o,this.m_maxDistanceRatioForLabels=s,this.m_labelStartScaleDistance=l,this.m_textMaterialConstructor=c,this.m_positionCount=0,this.m_indexCount=0,this.m_fontCatalogs=new Map,this.m_textStyles=[],this.m_defaultStyle={name:a.DEFAULT_STYLE_NAME,fontCatalogName:a.DEFAULT_FONT_CATALOG_NAME,color:"#6d7477",bgMode:a.TextBackgroundModeStrings.Outline,bgColor:"#F7FBFD",bgFactor:5,bgAlpha:.5,allCaps:!1,smallCaps:!1},this.m_lastRenderedTextElements=[],this.m_secondChanceTextElements=[],this.m_firstGlyphLoaded=!1,void 0===this.m_maxNumVisibleLabels&&(this.m_maxNumVisibleLabels=g),void 0===this.m_numSecondChanceLabels&&(this.m_numSecondChanceLabels=_),void 0===this.m_maxDistanceRatioForLabels&&(this.m_maxDistanceRatioForLabels=b),void 0===this.m_labelStartScaleDistance&&(this.m_labelStartScaleDistance=x),this.initTextRenderer(),m){var d=new u.PlaneGeometry(a.GLYPH_CACHE_TEXTURE_SIZE/2.5,a.GLYPH_CACHE_TEXTURE_SIZE/2.5,a.GLYPH_CACHE_WIDTH,a.GLYPH_CACHE_WIDTH),h=new u.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheMesh=new u.Mesh(d,h),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";var f=new u.WireframeGeometry(d),p=new u.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new u.LineSegments(f,p),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug"}v&&(this.m_debugPositions=new u.BufferAttribute(new Float32Array(10240),3),this.m_debugPositions.setDynamic(!0),this.m_debugIndex=new u.BufferAttribute(new Uint32Array(10240),1),this.m_debugIndex.setDynamic(!0),this.m_debugGeometry=new u.BufferGeometry,this.m_debugGeometry.addAttribute("position",this.m_debugPositions),this.m_debugGeometry.setIndex(this.m_debugIndex),this.m_debugMesh=new u.Mesh(this.m_debugGeometry,new u.MeshBasicMaterial({color:"#f00"})),this.m_debugMesh.renderOrder=1e3,this.m_debugPositions.count=0,this.m_debugIndex.count=0)}return e.prototype.end=function(){v&&void 0!==this.m_debugPositions&&void 0!==this.m_debugIndex&&(this.m_positionCount>0&&(this.m_debugPositions.updateRange.count=this.m_positionCount*this.m_debugPositions.itemSize,this.m_debugPositions.needsUpdate=!0),this.m_debugPositions.count=this.m_positionCount*this.m_debugPositions.itemSize,this.m_indexCount>0&&(this.m_debugIndex.updateRange.count=this.m_indexCount,this.m_debugIndex.needsUpdate=!0),this.m_debugIndex.count=this.m_indexCount,this.m_positionCount=0,this.m_indexCount=0)},Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this.m_debugMesh},enumerable:!0,configurable:!0}),e.prototype.renderText=function(e,t){void 0!==this.m_textRenderer&&this.m_textRenderer.render(e,t,this.m_mapView.cameraIsMoving||this.m_mapView.animating||this.m_mapView.updatePending)},e.prototype.reset=function(){var e,t;if(C=window.devicePixelRatio,this.m_screenCollisions.reset(),void 0!==this.m_textRenderer){this.m_textRenderer.reset(),this.m_poiRenderer.reset();try{for(var n=i(this.m_textRenderer.fontCatalogs),r=n.next();!r.done;r=n.next()){var o=r.value,a=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(o);if(void 0===a)return void T.error("FontCatalog not used by text renderer: "+o);a.resetBuffer()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}},e.prototype.update=function(e){var t,n;if(void 0!==this.m_textRenderer){this.m_textRenderer.update(),this.m_poiRenderer.update();try{for(var r=i(this.m_textRenderer.fontCatalogs),o=r.next();!o.done;o=r.next()){var a=o.value,s=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(a);if(void 0===s)return void T.error("FontCatalog not used by text renderer: "+a);s.updateBuffer(),s.updateTexture(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},e.prototype.placeAllTileLabels=function(){this.placeAllLabels()},e.prototype.movementStarted=function(){},e.prototype.movementFinished=function(){this.placeAllLabels()},Object.defineProperty(e.prototype,"debugGlyphTextureCache",{set:function(e){m&&(this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)},enumerable:!0,configurable:!0}),e.prototype.renderUserTextElements=function(e,t){var n=this,r=new Map,o=this.m_mapView.visibleTileSet.dataSourceTileList,a=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),s=this.m_mapView.zoomLevel;o.forEach(function(o){var u,l,c,d;try{for(var h=i(o.visibleTiles),f=h.next();!f.done;f=h.next()){var p=f.value;try{for(var m=i(p.userTextElements),v=m.next();!v.done;v=m.next()){var g=v.value;g.tileCenterX=p.center.x,g.tileCenterY=p.center.y,n.updateViewDistance(a,g)}}catch(e){c={error:e}}finally{try{v&&!v.done&&(d=m.return)&&d.call(m)}finally{if(c)throw c.error}}n.renderTextElements(p.userTextElements,e,t,s,r)}}catch(e){u={error:e}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(u)throw u.error}}})},e.prototype.renderAllTileText=function(e,t){var n=this,r=new Map,i=this.m_mapView.visibleTileSet.dataSourceTileList,o=this.m_mapView.zoomLevel;if(0===this.m_lastRenderedTextElements.length)i.forEach(function(i){n.renderTileList(i.renderedTiles,e,t,o,r,n.m_lastRenderedTextElements,n.m_secondChanceTextElements)});else{var a=this.m_lastRenderedTextElements.concat(this.m_secondChanceTextElements);this.renderTextElements(a,e,t,o,r)}},e.prototype.renderOverlay=function(e){void 0!==e&&0!==e.length&&this.renderOverlayTextElements(e)},e.prototype.pickTextElements=function(e,t){var n=function(n,r){var i=n;if(void 0!==i){if(void 0!==i.featureId&&!t.some(function(e){return void 0!==e&&r===e.type&&(void 0!==e.featureId&&e.featureId===i.featureId||void 0!==e.userData&&e.userData===i.userData)})){var o={type:r,point:e,distance:0,featureId:i.featureId,userData:i.userData,text:i.text};t.push(o)}}};void 0!==this.m_textRenderer&&this.m_textRenderer.pickTextElements(e,function(e){n(e,c.PickObjectType.Text)}),void 0!==this.m_poiRenderer&&this.m_poiRenderer.pickTextElements(e,function(e){n(e,c.PickObjectType.Icon)})},Object.defineProperty(e.prototype,"loading",{get:function(){var e,t;if(!this.m_firstGlyphLoaded)return!0;var n=!1;try{for(var r=i(this.m_fontCatalogs),a=r.next();!a.done;a=r.next()){var s=o(a.value,2),u=(s[0],s[1]);n=n||u.loading}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),e.prototype.initTextRenderer=function(){var e,t,n;C=window.devicePixelRatio,(void 0===this.m_theme.fontCatalogs||Array.isArray(this.m_theme.fontCatalogs)&&0===this.m_theme.fontCatalogs.length)&&(this.m_theme.fontCatalogs=[{name:a.DEFAULT_FONT_CATALOG_NAME,url:this.m_mapView.defaultFontCatalog}]);var r=this.m_theme.fontCatalogs;if(r.length>0){try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value;if(void 0!==l.name){n=l.name;break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}void 0===n&&(n=a.DEFAULT_FONT_CATALOG_NAME,r[0].name=n)}void 0===this.m_theme.textStyles&&(this.m_theme.textStyles=[]);var c=this.m_theme.textStyles,d=c.find(function(e){return e.name===a.DEFAULT_STYLE_NAME});void 0!==d?this.m_defaultStyle=d:void 0!==this.m_theme.defaultTextStyle?(this.m_defaultStyle=this.m_theme.defaultTextStyle,this.m_defaultStyle.name=a.DEFAULT_STYLE_NAME,c.push(this.m_defaultStyle)):c.length>0?(this.m_defaultStyle=c[0],this.m_defaultStyle.name=a.DEFAULT_STYLE_NAME):c.push(this.m_defaultStyle),this.m_defaultStyle.fontCatalogName=n,void 0!==this.m_defaultStyle.color&&(this.m_mapView.defaultTextColor=new u.Color(this.m_defaultStyle.color)),this.loadThemeFonts(r)},e.prototype.loadThemeFonts=function(e){var t=this;if(void 0!==e){var n=[],r=[];e.forEach(function(e){var i=a.FontCatalog.load(e.url,e.name,function(){t.m_mapView.update()}).then(function(e){t.m_fontCatalogs.set(e.name,e),t.m_mapView.update()}).catch(function(t){r.push(e.name),T.error("failed to load font. ",t)});n.push(i)}),Promise.all(n).then(function(){t.initTextStyles(),t.createTextRenderer()})}},e.prototype.initTextStyles=function(){var e=this;void 0!==this.m_theme&&void 0!==this.m_theme.textStyles&&void 0!==this.m_theme.textStyles.length&&(this.m_theme.textStyles.forEach(function(t){e.m_textStyles.push(r({},t))}),this.assignFontCatalogsToStyles())},e.prototype.assignFontCatalogsToStyles=function(){var e,t,n;this.m_fontCatalogs.forEach(function(e){void 0===n&&(n=e)});try{for(var r=i(this.m_textStyles),o=r.next();!o.done;o=r.next()){var a=o.value;void 0===a.fontCatalog&&(void 0!==a.fontCatalogName&&(a.fontCatalog=this.m_fontCatalogs.get(a.fontCatalogName)),void 0===a.fontCatalog&&(void 0!==a.fontCatalogName&&T.warn("FontCatalog '"+a.fontCatalogName+"' set in TextStyle",a,"not found, using default fontCatalog."),a.fontCatalog=n))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createTextRenderer=function(){this.m_textRenderer=new a.TextRenderer(this.m_textStyles,this.m_textMaterialConstructor),void 0!==this.debugMesh&&this.m_textRenderer.sceneSet.getScene(a.DEFAULT_TEXT_RENDER_ORDER).add(this.debugMesh),this.m_poiRenderer=new d.PoiRenderer(this.m_mapView,this.m_textRenderer.sceneSet);var e=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(this.m_defaultStyle.fontCatalogName);void 0!==e?(m&&(this.m_debugGlyphTextureCacheMesh.material.map=e.texture,this.m_textRenderer.sceneSet.getScene(a.DEFAULT_TEXT_RENDER_ORDER).add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)),this.m_mapView.update()):T.error("FontCatalog not used by text renderer: "+this.m_defaultStyle.fontCatalogName)},e.prototype.updateViewDistance=function(e,t){var n;if(t.points instanceof u.Vector2||t.points instanceof u.Vector3){var r=t.position3;j.x=r.x+t.tileCenterX,j.y=r.y+t.tileCenterY,n=e.distanceTo(j)}else if(Array.isArray(t.points))if(1===t.points.length){var i=t.points[0];j.x=i.x+t.tileCenterX,j.y=i.y+t.tileCenterY,n=e.distanceTo(j)}else if(t.points.length>1){var o=t.points;i=o[0];j.x=i.x+t.tileCenterX,j.y=i.y+t.tileCenterY;var a=e.distanceTo(j);i=o[o.length-1],j.x=i.x+t.tileCenterX,j.y=i.y+t.tileCenterY;var s=e.distanceTo(j);n=Math.min(a,s)}return t.currentViewDistance=n,n},e.prototype.sortTextElements=function(e,t){var n,r;try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value;s.sortPriority=s.priority+.1-s.currentViewDistance/t*.1}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.sort(function(e,t){return t.sortPriority-e.sortPriority})},e.prototype.placeAllLabels=function(){var e=this,t=this.m_mapView.visibleTileSet.dataSourceTileList,n=this.m_mapView.zoomLevel;t.forEach(function(t){e.placeTextElements(t.dataSource,t.storageLevel,n,t.visibleTiles)}),this.m_lastRenderedTextElements.length=0,this.m_secondChanceTextElements.length=0},e.prototype.placeTextElements=function(e,t,n,r){var o,a;try{for(var s=i(r),u=s.next();!u.done;u=s.next()){var l=u.value;this.prepareUserTextElements(l)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}var c=[];this.createSortedGroupsForSorting(e,t,r,c);this.selectTextElementsToPlaceByDistance(n,c,[])},e.prototype.prepareUserTextElements=function(e){var t,n;try{for(var r=i(e.userTextElements),o=r.next();!o.done;o=r.next()){var a=o.value;a.tileCenterX=e.center.x,a.tileCenterY=e.center.y}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.createSortedGroupsForSorting=function(e,t,n,r){var o,a,s,u,l,c,d,h;if(void 0!==this.m_textRenderer&&0!==n.length){var f=[];try{for(var p=i(n),m=p.next();!m.done;m=p.next()){(_=m.value).placedTextElements.clear(),e.shouldRenderText(t,_.tileKey)&&f.push(_)}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}var v=new Map;try{for(var g=i(f),y=g.next();!y.done;y=g.next()){var _=y.value;try{for(var b=i(_.textElementGroups.groups.values()),x=b.next();!x.done;x=b.next()){var w=x.value;if(0!==w.elements.length){var T=v.get(w.priority);void 0===T?v.set(w.priority,new N(w.priority,[new z(_,w.elements)])):T.textElementLists.push(new z(_,w.elements))}}}catch(e){l={error:e}}finally{try{x&&!x.done&&(c=b.return)&&c.call(b)}finally{if(l)throw l.error}}}}catch(e){s={error:e}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}if(0!==v.size){try{for(var C=i(v),E=C.next();!E.done;E=C.next()){var S=E.value[1];r.push(S)}}catch(e){d={error:e}}finally{try{E&&!E.done&&(h=C.return)&&h.call(C)}finally{if(d)throw d.error}}}}},e.prototype.getMaxDistance=function(e){return this.m_mapView.camera.far*e},e.prototype.selectTextElementsToPlaceByDistance=function(e,t,n){var r,o,a,u,l,c;t.sort(function(e,t){return t.priority-e.priority});var d=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),h=this.m_maxDistanceRatioForLabels,f=this.getMaxDistance(h);try{for(var p=i(t),m=p.next();!m.done;m=p.next()){var v=m.value;try{for(var g=i(v.textElementLists),y=g.next();!y.done;y=g.next()){var _=y.value,b=_.tile;try{for(var x=i(_.textElements),w=x.next();!w.done;w=x.next()){var T=w.value;if(!s.MathUtils.isClamped(e,T.minZoomLevel,T.maxZoomLevel)){T.tileCenterX=b.center.x,T.tileCenterY=b.center.y;var C=this.updateViewDistance(d,T);void 0!==C&&C>f||b.placedTextElements.add(T)}}}catch(e){l={error:e}}finally{try{w&&!w.done&&(c=x.return)&&c.call(x)}finally{if(l)throw l.error}}}}catch(e){a={error:e}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(a)throw a.error}}n.push([])}}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}},e.prototype.renderOverlayTextElements=function(e){var t,n,r=this;if(void 0!==this.m_textRenderer){var o=-window.innerWidth*window.devicePixelRatio/2,s=window.innerHeight*window.devicePixelRatio/2,l=function(e){var t=c.m_textRenderer.getTextRendererBufferForStyle(e.style);if(void 0===t)return"break";var n=t.textStyle,l=n.fontCatalog,d=t.textBuffer,h=n.bgMode===a.TextBackgroundModeStrings.Glow?a.TextBackgroundMode.Glow:a.TextBackgroundMode.Outline,p=e.scale*C;if(void 0===e.codePoints&&e.computeCodePoints(e.allCaps),void 0===d||!d.canAddElements(e.codePoints.length)||void 0===l)return"break";var m=c.m_textRenderer.getGlyphTextureCacheForFontCatalog(l.name);if(void 0===m)return T.error("FontCatalog not used by text renderer: "+l.name),{value:void 0};if(!c.isTextElementLoaded(e,l,n))return"continue";void 0===e.path||e.path.length<=1?function(e){O.x=o,O.y=s,void 0!==e.xOffset&&(O.x+=e.xOffset*C),void 0!==e.yOffset&&(O.y-=e.yOffset*C),R.x=O.x,R.y=O.y,e.bidirectional?r.addBidirectionalLabel(e,d,l,m,R,p,1,e.smallCaps,h):r.addDirectionalGlyphRun(e,e.textDirection,0,e.codePoints.length-1,d,l,m,R,p,1,e.smallCaps,h)}(e):function(e){var t,n,a=[];try{for(var c=i(e.path),v=c.next();!v.done;v=c.next()){var g=v.value,y=o+g.x,_=s-g.y;a.push(new u.Vector2(y,_))}}catch(e){t={error:e}}finally{try{v&&!v.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}for(var b=new f.SimplePath,x=0;x<a.length-1;++x)b.add(new f.SimpleLineCurve(a[x],a[x+1]));var w=e;if(void 0===w.startIndex||void 0===w.startOffset){var T=b.getParamAt(.5);w.startIndex=T.index,w.startOffset=T.t*T.t}var C=b.getLengths(),E=C[u.Math.clamp(w.startIndex,0,C.length-1)],S=C[u.Math.clamp(w.startIndex+1,0,C.length-1)];w.offset=u.Math.clamp(E*(1-w.startOffset)+S*w.startOffset,0,1),w.tangent=b.getTangent(w.offset/b.getLength()),w.direction=w.tangent&&w.tangent.x<0?-1:1,w.direction<0&&(w.offset+=e.textWidth*p),e.bidirectional?r.addBidirectionalLabel(e,d,l,m,R,p,1,e.smallCaps,h,b):r.addDirectionalGlyphRun(e,e.textDirection,0,e.codePoints.length-1,d,l,m,R,p,1,e.smallCaps,h,b)}(e)},c=this;try{for(var d=i(e),h=d.next();!h.done;h=d.next()){var p=l(h.value);if("object"==typeof p)return p.value;if("break"===p)break}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}}},e.prototype.getDistanceFadingFactor=function(e,t){var n=1,r=e.currentViewDistance;if(void 0!==r&&void 0!==e.fadeFar&&e.fadeFar>0){var i=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>i&&(n=1-s.MathUtils.clamp((r/t-i)/(o-i),0,1))}return n},e.prototype.renderTextElements=function(e,t,n,r,o,l,c){var d,m,g=this;if(void 0===this.m_textRenderer||void 0===this.m_poiRenderer)return 0;var _=void 0===l,b=(e.length,this.m_maxNumVisibleLabels),x=this.m_numSecondChanceLabels,w=this.m_labelStartScaleDistance,E=0,S=[],I=this.getMaxDistance(.9),j=this.getMaxDistance(.6),z=this.m_mapView.cameraIsMoving,N=this.m_poiRenderer,G=this.m_mapView.camera.far,V=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),H=!1,W=function(e){if(!_&&b>=0&&E>=b)return"break";var d=q.m_textRenderer.getTextRendererBufferForStyle(e.style,e.renderOrder);if(void 0===d)return"break";var m=d.textStyle,W=m.fontCatalog,X=d.textBuffer,Y=m.bgMode===a.TextBackgroundModeStrings.Glow?a.TextBackgroundMode.Glow:a.TextBackgroundMode.Outline;if(void 0===e.codePoints&&e.computeCodePoints(e.allCaps),void 0===X||!X.canAddElements(e.codePoints.length)||void 0===W)return"break";var Z=q.m_textRenderer.getGlyphTextureCacheForFontCatalog(W.name);if(void 0===Z)return T.error("FontCatalog not used by text renderer: "+W.name),{value:-1};if(!q.isTextElementLoaded(e,W,m))return"continue";var K=function(i,o,a,u,d){O.x=L.x=d.x,O.y=L.y=d.y,void 0!==i.xOffset&&(O.x+=i.xOffset*C),void 0!==i.yOffset&&(O.y+=i.yOffset*C);var h=i.scale*C,f=1,p=V.distanceTo(u);if(void 0!==p){if(void 0!==i.fadeFar&&(i.fadeFar<=0||i.fadeFar*G<p))return!1;var m=G*w;p>m&&(h*=f=1-(p-m)/(G-m)*(1-i.distanceScale)),e.currentViewDistance=p}var y=g.getDistanceFadingFactor(i,G),_=i.poiInfo,b=!0,T=void 0===_||!s.MathUtils.isClamped(r,_.iconMinZoomLevel,_.iconMaxZoomLevel);if(T&&void 0!==_&&N.prepareRender(_)){if(!1===_.isValid)return!1;if(!N.computeScreenBox(_,L,f,g.m_screenCollisions,U))return void 0!==c&&c.length<x&&c.push(i),o.lastFrameNumber=-1,!1;if(b=N.isSpaceAvailable(g.m_screenCollisions,U))(o.lastFrameNumber<n-1||o.isFadingOut()||o.isFadedOut())&&g.startFadeIn(o,n,t);else{if(!o.isVisible())return!1;!0===_.mayOverlap||o.isFadingOut()||(g.startFadeOut(o,n,t),void 0!==a&&a.isVisible()&&g.startFadeOut(a,n,t))}o.isFading()&&g.updateFading(o,t)}if((void 0===_||void 0===r||!s.MathUtils.isClamped(r,_.iconMinZoomLevel,_.iconMaxZoomLevel))&&(!0===i.ignoreDistance||void 0===i.currentViewDistance||i.currentViewDistance<j)&&(void 0===_||!0===_.isValid||!1!==_.iconIsOptional)&&i.codePoints.length>0){var S=0;k.x=1/0,k.y=1/0,k.width=-1/0,k.height=-1/0;for(var A=0;A<i.codePoints.length;++A){var P=W.getGlyph(i.codePoints[A],i.bold);if(void 0!==P){var M=i.convertedToUpperCase[A]&&e.smallCaps?P.metrics.xHeight/P.metrics.capHeight:1,I=S+P.offsetX,D=I+P.width*M,B=0-P.offsetY+P.height*M;I<k.x&&(k.x=I),0<k.y&&(k.y=0),D-k.x>k.width&&(k.width=D-k.x),B-k.y>k.height&&(k.height=B-k.y),S+=(P.advanceX+i.tracking)*M}}var q=k.width*h,K=k.height*h;if(F.x=O.x-q*e.horizontalAlignment,F.y=O.y-K,F.w=q,F.h=2*K,R.x=F.x,R.y=F.y+K,F.x-=4*h,F.y-=2*h,F.w+=8*h,F.h+=4*h,!g.m_screenCollisions.isVisible(F))return void 0!==c&&c.length<x&&c.push(i),0,!1;var Q=void 0!==i.poiInfo&&!0===i.poiInfo.textIsOptional,J=void 0!==a&&a.isFadingIn(),$=void 0!==a&&a.isFadingOut(),ee=!g.m_screenCollisions.isAllocated(F);if(i.textMayOverlap||ee||J||$){if(v&&g.addDebugBoundingBox(),!$&&i.textReservesSpace&&g.m_screenCollisions.allocate(F),(J||$||!z||void 0===_||!0===_.renderTextDuringMovements)&&!o.isFadedOut()){var te=!1;!o.isFadingOut()&&ee&&b?te=g.checkStartFadeIn(a,n,t,!0):void 0!==a&&a.isFading()&&(g.updateFading(a,t),te=!0),H=H||$||te;var ne=void 0!==a?a.opacity:o.opacity;i.bidirectional?g.addBidirectionalLabel(i,X,W,Z,R,h,ne*y,i.smallCaps,Y):g.addDirectionalGlyphRun(i,i.textDirection,0,i.codePoints.length-1,X,W,Z,R,h,ne*y,i.smallCaps,Y)}0}else if(T&&Q){if(void 0!==a&&a.isVisible()){re=g.checkStartFadeOut(a,n,t);H=H||re}}else{if(void 0!==i.poiInfo&&!o.isVisible())return void 0!==c&&c.length<x&&c.push(i),0,!1;if(void 0!==i.poiInfo&&g.startFadeOut(o,n,t),void 0!==a&&a.isVisible()){var re=g.checkStartFadeOut(a,n,t);H=H||re}g.startFadeOut(o,n,t)}}if(T&&void 0!==_&&N.poiIsRenderable(_)){var ie=g.checkStartFadeIn(o,n,t);H=H||ie,N.renderPoi(_,L,g.m_screenCollisions,f,!1!==_.reserveSpace,o.opacity*y),o.lastFrameNumber=n,0}return void 0!==l&&l.push(i),E++,!0};void 0===e.path?function(e){M.x=e.position.x+e.tileCenterX,M.y=e.position.y+e.tileCenterY,M.z=0,void 0!==g.m_screenProjector.project(M,O)&&(void 0===e.iconRenderState&&(e.iconRenderState=new p.RenderState,e.textRenderState=new p.RenderState),K(e,e.iconRenderState,e.textRenderState,M,O))}(e):e.isLineMarker?function(e){var t=e.poiInfo;if(void 0!==e.path&&0!==e.path.length&&N.prepareRender(t)){var n;if(void 0!==t.shieldGroupIndex&&void 0===(n=S[t.shieldGroupIndex])&&(n=[],S[t.shieldGroupIndex]=n),void 0===e.iconRenderStates){var r=new Array;e.path.forEach(function(){var e=new p.RenderState;e.state=p.FadingState.FadingIn,r.push(e)}),e.iconRenderStates=r}var i=t.technique,o=void 0!==i.minDistance?i.minDistance*i.minDistance:0;if(o>0&&void 0!==n)for(var a=0;a<e.path.length;a++){var u=e.path[a];if(!X.canAddElements(e.codePoints.length))break;if(M.x=u.x+e.tileCenterX,M.y=u.y+e.tileCenterY,M.z=0,void 0!==g.m_screenProjector.project(M,O)){for(var l=!1,c=0;c<n.length&&!(l=s.Math2D.distSquared(n[c],n[c+1],O.x,O.y)<o);c+=2);l||K(e,e.iconRenderStates[a],void 0,M,O)&&n.push(O.x,O.y)}}else{if(!X.canAddElements(e.path.length*e.codePoints.length))return;for(a=0;a<e.path.length;a++)u=e.path[a],M.x=u.x+e.tileCenterX,M.y=u.y+e.tileCenterY,M.z=0,void 0!==g.m_screenProjector.project(M,O)&&K(e,e.iconRenderStates[a],void 0,M,O)}}}(e):function(r){var a,s,d,m;if(!0===r.ignoreDistance||void 0===r.currentViewDistance||r.currentViewDistance<I){var _=r.scale*C,b=1,x=r.tileCenterX,T=r.tileCenterY,S=r.path[0].clone();if(S.x+=x,S.y+=T,void 0===r.fadeFar||!(r.fadeFar<=0||r.fadeFar*G<r.renderDistance)){g.updateViewDistance(V,r);var M=r.renderDistance,O=G*w,L=-M;L>O&&(_*=1-(L-O)/(G-O)*(1-r.distanceScale));var F=o.get(e.text);if(void 0===F)o.set(e.text,[S]);else{var k=!1;try{for(var j=i(F),U=j.next();!U.done;U=j.next()){var z=U.value;if(Math.abs(z.x-S.x)<.001&&Math.abs(z.y-S.y)<.001){k=!0;break}}}catch(e){a={error:e}}finally{try{U&&!U.done&&(s=j.return)&&s.call(j)}finally{if(a)throw a.error}}if(k)return;F.push(S)}var N=[];try{for(var q=i(r.path),K=q.next();!K.done;K=q.next()){z=K.value,P.set(z.x+x,z.y+T,0);var Q=g.m_screenProjector.project(P);if(void 0===Q)return;N.push(Q)}}catch(e){d={error:e}}finally{try{K&&!K.done&&(m=q.return)&&m.call(q)}finally{if(d)throw d.error}}if(-1!==N.findIndex(function(e){return!!g.m_screenCollisions.screenBounds.contains(e.x,e.y)})){for(var J=new f.SimplePath,$=0;$<N.length-1;++$)J.add(new f.SimpleLineCurve(N[$],N[$+1]));if(r.textWidth*_>J.getLength())0;else{var ee=r;if(void 0===ee.startIndex&&void 0===ee.startOffset){var te=J.getParamAt(.5);ee.startIndex=te.index,B.set(r.path[ee.startIndex].x+x,r.path[ee.startIndex].y+T,0,1),g.m_screenProjector.projectVector(B);var ne=B.w;B.set(r.path[ee.startIndex+1].x+x,r.path[ee.startIndex+1].y+T,0,1),g.m_screenProjector.projectVector(B);var re=B.w;ee.startOffset=te.t*ne/(re+(ne-re)/te.t)}var ie=J.getLengths(),oe=ie[u.Math.clamp(ee.startIndex,0,ie.length-1)],ae=ie[u.Math.clamp(ee.startIndex+1,0,ie.length-1)];if(ee.offset=oe*(1-ee.startOffset)+ae*ee.startOffset,ee.offset>J.getLength())0;else{ee.tangent=J.getTangent(ee.offset/J.getLength()),ee.direction=ee.tangent&&ee.tangent.x<0?-1:1,ee.direction<0&&(ee.offset+=r.textWidth*_),void 0===r.textRenderState&&(r.textRenderState=new p.RenderState),(r.textRenderState.state===p.FadingState.Undefined||r.textRenderState.lastFrameNumber<n-1)&&g.startFadeIn(r.textRenderState,n,t);var se=g.checkStartFadeIn(r.textRenderState,n,t);H=H||se,r.textRenderState.isFading()&&(b=r.textRenderState.opacity);var ue=g.getDistanceFadingFactor(r,G),le=X.saveState();if(ee.placementError=y.None,D.makeEmpty(),r.bidirectional?g.addBidirectionalLabel(r,X,W,Z,R,_,b*ue,r.smallCaps,Y,J,!0):g.addDirectionalGlyphRun(r,r.textDirection,0,r.codePoints.length-1,X,W,Z,R,_,b*ue,r.smallCaps,Y,J,!0),ee.placementError!==y.None)return X.restoreState(le),void(ee.placementError===y.Visibility?(0,void 0!==c&&c.length<g.m_numSecondChanceLabels&&c.push(e)):ee.placementError===y.ExtremeAngle?0:ee.placementError===y.PathOverflow?0:ee.placementError===y.BufferOverflow&&0);v&&g.addDebugBoundingBox(),r.textReservesSpace&&(h.ScreenCollisions.toBox2D(D,A),g.m_screenCollisions.allocate(A)),void 0!==l&&l.push(r),E++}}}else 0}}}(e)},q=this;try{for(var X=i(e),Y=X.next();!Y.done;Y=X.next()){var Z=W(Y.value);if("object"==typeof Z)return Z.value;if("break"===Z)break}}catch(e){d={error:e}}finally{try{Y&&!Y.done&&(m=X.return)&&m.call(X)}finally{if(d)throw d.error}}return H&&this.m_mapView.update(),E},e.prototype.renderTileList=function(e,t,n,r,o,a,u){var l,c,d,h;if(void 0!==this.m_textRenderer&&0!==e.length){var f=new s.GroupedPriorityList;try{for(var p=i(e),m=p.next();!m.done;m=p.next()){var v=m.value;f.merge(v.placedTextElements)}}catch(e){l={error:e}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(l)throw l.error}}var g=this.m_mapView.camera.far*this.m_mapView.camera.far,y=this.m_maxNumVisibleLabels,_=0;try{for(var b=i(f.sortedGroups),x=b.next();!x.done;x=b.next()){var w=x.value.elements;if(this.sortTextElements(w,g),(_+=this.renderTextElements(w,t,n,r,o,a,u))>y)break}}catch(e){d={error:e}}finally{try{x&&!x.done&&(h=b.return)&&h.call(b)}finally{if(d)throw d.error}}}},e.prototype.isTextElementLoaded=function(e,t,n){var r,o;if(!e.allGlyphsLoaded){var s=void 0!==e.bold?e.bold:!0===n.bold,u=void 0!==e.tracking?e.tracking:void 0!==n.tracking?n.tracking:0,c=0,d=void 0,h=!0;try{for(var f=i(e.codePoints),p=f.next();!p.done;p=f.next()){var m=p.value,v=t.getGlyph(m,s);if(void 0===v){h=!1;break}this.m_firstGlyphLoaded=!0,c+=v.advanceX+u,void 0===d?v.direction!==a.GlyphDirection.LTR&&v.direction!==a.GlyphDirection.RTL||(d=v.direction):d!==v.direction&&(e.bidirectional=!0)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}if(!h)return!1;var g=void 0!==e.smallCaps?e.smallCaps:!0===n.smallCaps,y=(void 0!==e.allCaps?e.allCaps:!0===n.allCaps)||g,_=void 0!==e.oblique?e.oblique:!0===n.oblique,b=void 0!==e.color?e.color:void 0!==n.color?l.ColorCache.instance.getColor(n.color):this.m_mapView.defaultTextColor;e.allGlyphsLoaded=!0,e.allCaps=y,e.smallCaps=g,e.bold=s,e.oblique=_,e.tracking=u,e.color=b,e.textWidth=c,e.textDirection=void 0!==d?d:a.GlyphDirection.LTR}return!0},e.prototype.computeGlyphTransform=function(e,t,n,r){I.set(void 0!==n?t*r.tangent.x:t,void 0!==n?t*-r.tangent.y:0,0,e.x,void 0!==n?t*r.tangent.y:0,void 0!==n?t*r.tangent.x:t,0,e.y,0,0,t,0,0,0,0,1)},e.prototype.addDirectionalGlyphRun=function(e,t,n,r,i,o,s,l,c,d,f,p,m,v){for(var g,_=t===a.GlyphDirection.LTR?n:r,b=t===a.GlyphDirection.LTR?r:n,x=e,T=function(n){var r=o.getGlyph(e.codePoints[n],e.bold);if(s.add(r.codepoint,e.bold),t===a.GlyphDirection.RTL&&r.direction===a.GlyphDirection.Weak){for(var _=n,b=n,T=o.getGlyph(e.codePoints[b--],e.bold);T.direction===a.GlyphDirection.Weak||T.direction===a.GlyphDirection.Neutral&&32!==T.codepoint;)T=o.getGlyph(e.codePoints[b--],e.bold);return b+=2,C.addDirectionalGlyphRun(e,a.GlyphDirection.LTR,b,_,i,o,s,l,c,d,f,p,m),g=n=b,"continue"}var P=w.find(function(e){return e===r.codepoint}),M=e.convertedToUpperCase[n]&&f?r.metrics.xHeight/r.metrics.capHeight:1;if(void 0!==m){var O=x.offset/m.getLength(),L=O+x.direction*(r.width*c*M)/m.getLength();if(!0===v&&(O<0||O>1||L<0||L>1))return x.placementError=y.PathOverflow,{value:!1};var F=m.getPoint(u.Math.clamp(O,0,1)),R=m.getPoint(u.Math.clamp(L,0,1));if(x.tangent=R.sub(F).normalize(),!0===v){if(void 0!==x.prevTangent){var k=Math.atan2(x.prevTangent.x*x.tangent.y-x.tangent.x*x.prevTangent.y,x.tangent.dot(x.prevTangent));if(Math.abs(k)>Math.PI/8)return x.placementError=y.ExtremeAngle,{value:!1}}x.prevTangent=x.tangent}F.x+=e.xOffset||0,F.y-=e.yOffset||0,l.set(F.x,F.y,0)}if(C.computeGlyphTransform(l,c,m,x),!0===v){if(a.FontCatalog.getGlyphCorners(r,I,E,!0,e.verticalAlignment,e.oblique),S.setFromPoints(E),h.ScreenCollisions.toBox2D(S,A),!C.m_screenCollisions.isVisible(A)||!e.textMayOverlap&&C.m_screenCollisions.isAllocated(A))return x.placementError=y.Visibility,{value:!1};D.union(S)}var j=i.addGlyph(r,e.color,d,e.renderDistance,I,E,!0,e.verticalAlignment,t===a.GlyphDirection.RTL&&void 0!==P,e.oblique,1!==M,p,e.poiInfo);if(!0===v&&!j)return x.placementError=y.BufferOverflow,{value:!1};var B=(r.advanceX+e.tracking)*c*M;l.x+=B,void 0!==m&&(x.offset+=x.direction*B),g=n},C=this,P=_;t===a.GlyphDirection.LTR?P<=b:P>=b;P+=t){var M=T(P);if(P=g,"object"==typeof M)return M.value}return!0},e.prototype.addBidirectionalLabel=function(e,t,n,r,i,o,s,u,l,c,d){for(var h,f=i.x,p=0,m=0,v=0,g=0,y=-1,_=-1,b=0,x=e.textDirection;b!==e.codePoints.length;){var w=n.getGlyph(e.codePoints[b],e.bold);p+=(w.advanceX+e.tracking)*o;var T=n.getGlyph(e.codePoints[b-1],e.bold),C=n.getGlyph(e.codePoints[b+1],e.bold);if(w.direction===a.GlyphDirection.Weak);else if(w.direction===a.GlyphDirection.Neutral){if(void 0===h&&T.direction!==a.GlyphDirection.Neutral&&(h=T.direction,y=b-1,_=p),void 0!==h&&C.direction!==a.GlyphDirection.Neutral)if(C.direction===h)h=void 0,y=-1,_=-1;else if(C.direction===-h){if(g=h!==e.textDirection?y:b,i.x=f+m,!this.addDirectionalGlyphRun(e,x,v,g,t,n,r,i,o,s,u,l,c,d))return;m=_,v=g+1,x=-x,h=void 0,y=-1,_=-1}}else if(C.direction===-x){if(g=b,i.x=f+m,!this.addDirectionalGlyphRun(e,x,v,g,t,n,r,i,o,s,u,l,c,d))return;m=p,v=g+1,x=-x}b++}if(v<e.codePoints.length&&(g=b-1,i.x=f+m,!this.addDirectionalGlyphRun(e,x,v,g,t,n,r,i,o,s,u,l,c,d)))return},e.prototype.addDebugBoundingBox=function(){if(void 0!==this.m_debugPositions&&void 0!==this.m_debugIndex){var e=this.m_positionCount;this.m_debugPositions.setXY(this.m_positionCount++,F.x,F.y),this.m_debugPositions.setXY(this.m_positionCount++,F.x+F.w,F.y),this.m_debugPositions.setXY(this.m_positionCount++,F.x,F.y+F.h),this.m_debugPositions.setXY(this.m_positionCount++,F.x+F.w,F.y+F.h),this.m_debugIndex.setX(this.m_indexCount++,e),this.m_debugIndex.setX(this.m_indexCount++,e+1),this.m_debugIndex.setX(this.m_indexCount++,e+2),this.m_debugIndex.setX(this.m_indexCount++,e+2),this.m_debugIndex.setX(this.m_indexCount++,e+1),this.m_debugIndex.setX(this.m_indexCount++,e+3)}},e.prototype.checkStartFadeIn=function(e,t,n,r){void 0===r&&(r=!1);var i=!1;return void 0!==e&&((r||e.state===p.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeIn(e,t,n),e.isFading()&&(this.updateFading(e,n),i=!0),e.lastFrameNumber=t),i},e.prototype.checkStartFadeOut=function(e,t,n,r){void 0===r&&(r=!0);var i=!1;return void 0!==e&&((r||e.state===p.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeOut(e,t,n),e.isFading()&&(this.updateFading(e,n),i=!0),e.lastFrameNumber=t),i},e.prototype.startFadeIn=function(e,t,n){e.lastFrameNumber<t-1&&e.reset(),e.state!==p.FadingState.FadingIn&&e.state!==p.FadingState.FadedIn&&(e.state===p.FadingState.FadingOut?(e.value=1-e.value,e.startTime=n-e.value*e.fadingTime):(e.startTime=n,e.value=0,e.opacity=0),e.state=p.FadingState.FadingIn)},e.prototype.startFadeOut=function(e,t,n){e.lastFrameNumber<t-1&&e.reset(),e.state!==p.FadingState.FadingOut&&e.state!==p.FadingState.FadedOut&&(e.state===p.FadingState.FadingIn?(e.startTime=n-e.value*e.fadingTime,e.value=1-e.value):(e.startTime=n,e.value=0,e.opacity=1),e.state=p.FadingState.FadingOut)},e.prototype.updateFading=function(e,t){if(e.state===p.FadingState.FadingIn||e.state===p.FadingState.FadingOut){0===e.startTime&&(e.startTime=t);var n=t-e.startTime,r=e.state===p.FadingState.FadingIn?0:1,i=e.state===p.FadingState.FadingIn?1:0;n>=e.fadingTime?(e.value=1,e.opacity=i,e.state=e.state===p.FadingState.FadingIn?p.FadingState.FadedIn:p.FadingState.FadedOut):(e.value=n/e.fadingTime,e.opacity=s.MathUtils.clamp(s.MathUtils.smootherStep(r,i,e.value),0,1))}},e}();t.TextElementsRenderer=G},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(4),s=n(0),u=n(55);!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(o=t.PickObjectType||(t.PickObjectType={}));var l=function(){function e(e,t){void 0===t&&(t=!0),this.mapView=e,this.enableRoadPicking=t,this.m_rayCaster=new s.Raycaster,this.m_plane=new s.Plane(new s.Vector3(0,0,1)),t&&(this.m_roadPicker=new u.RoadPicker(e))}return e.prototype.registerTile=function(e){return void 0!==this.m_roadPicker?this.m_roadPicker.registerTile(e):void 0},e.prototype.intersectMapObjects=function(e,t){var n,r,u=this,l=this.mapView.getNormalizedScreenCoordinates(e,t),c=this.m_rayCaster,d=[];if(void 0!==this.mapView.textElementsRenderer){var h=this.mapView.canvas,f=h.clientWidth,p=h.clientHeight,m=l.x*f*.5*devicePixelRatio,v=l.y*p*.5*devicePixelRatio,g=new s.Vector2(m,v);this.mapView.textElementsRenderer.pickTextElements(g,d)}c.setFromCamera(l,this.mapView.camera),c.linePrecision=1;var y=c.intersectObjects(this.mapView.worldRootObject.children,!0);try{for(var _=i(y),b=_.next();!b.done;b=_.next()){var x=b.value,w={type:o.Unspecified,point:x.point,distance:x.distance,intersection:x};if(void 0!==x.object.userData){var T=void 0!==x.object.userData?x.object.userData.feature:void 0;if(void 0===T){d.push(w);continue}if(this.addObjInfo(T,x,w),void 0!==T.ids){var C=1===T.ids.length?T.ids[0]:void 0;w.featureId=C}var E=void 0;switch(T.geometryType){case a.GeometryType.Point:case a.GeometryType.Text:E=o.Point;break;case a.GeometryType.Line:case a.GeometryType.ExtrudedLine:case a.GeometryType.SolidLine:case a.GeometryType.TextPath:E=o.Line;break;case a.GeometryType.Polygon:case a.GeometryType.ExtrudedPolygon:E=o.Area;break;case a.GeometryType.Object3D:E=o.Object3D;break;default:E=o.Unspecified}w.type=E,d.push(w)}}}catch(e){n={error:e}}finally{try{b&&!b.done&&(r=_.return)&&r.call(_)}finally{if(n)throw n.error}}if(this.enableRoadPicking){var S=new s.Vector3;c.ray.intersectPlane(this.m_plane,S),S.add(this.mapView.worldCenter);var A=this.mapView.worldCenter.clone().add(this.mapView.camera.position);this.mapView.forEachVisibleTile(function(e){u.m_roadPicker.intersectRoads(e,A,S,d)})}return d.sort(function(e,t){return e.distance-t.distance}),d},e.prototype.addObjInfo=function(e,t,n){var o,a;if(void 0!==e.objInfos&&void 0!==e.starts&&void 0!==t.faceIndex)if(e.starts.length>1){var s=0;try{for(var u=i(e.starts),l=u.next();!l.done;l=u.next()){if(l.value>t.faceIndex)break;s++}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}t.object.userData.objInfo=r({},e.objInfos[s-1]),n.userData=r({},e.objInfos[s-1])}else t.object.userData.objInfo=r({},e.objInfos[0]),n.userData=r({},e.objInfos[0])},e}();t.PickHandler=l},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(140)),r(n(70)),r(n(141))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(6),o=n(9),a=n(13),s=function(){function e(){}return e.clamp=function(e,t,n){return Math.min(Math.max(t,e),n)},e.latitudeClamp=function(t){return e.clamp(t,-e.MAXIMUM_LATITUDE,e.MAXIMUM_LATITUDE)},e.latitudeProject=function(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI},e.latitudeClampProject=function(t){return e.latitudeProject(e.latitudeClamp(t))},e.unprojectLatitude=function(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI},e.prototype.getScaleFactor=function(e){return Math.cosh(2*Math.PI*(e.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5))},e.prototype.worldExtent=function(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.max.y=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.max.z=t,n},e.prototype.projectPoint=function(t,n){var r;return r=t instanceof i.GeoCoordinates?t.normalized():new i.GeoCoordinates(t.latitude,t.longitude,t.altitude).normalized(),n||(n={x:0,y:0,z:0}),n.x=(r.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.y=(.5*e.latitudeClampProject(r.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.z=t.altitude||0,n},e.prototype.unprojectPoint=function(t){return i.GeoCoordinates.fromRadians(e.unprojectLatitude(2*(t.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5)),t.x/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE*2*Math.PI-Math.PI,t.z)},e.prototype.projectBox=function(t,n){var r=t.center,s=this.projectPoint(new i.GeoCoordinates(r.latitude,r.longitude,0)),u=(.5*e.latitudeClampProject(t.northEast.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,l=(.5*e.latitudeClampProject(t.southWest.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=.5*(u+l);s.y=c;var d=u-l,h=t.longitudeSpan/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;n||(n=o.MathUtils.newEmptyBox3()),n.min.x=s.x-.5*h,n.min.y=s.y-.5*d,n.max.x=s.x+.5*h,n.max.y=s.y+.5*d;var f=t.altitudeSpan;return void 0!==f?(n.min.z=s.z-.5*f,n.max.z=s.z+.5*f):(n.min.z=0,n.max.z=0),n},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)},e.MAXIMUM_LATITUDE=1.4844222297453322,e}();t.MercatorProjection=s,t.mercatorProjection=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(){return 2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 1<<e},e}();t.quadTreeSubdivisionScheme=new r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(1),a=n(0),s=n(100);function u(e,t){return e*t.far}!function(e){e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.patchGlobalShaderChunks=function(){void 0===a.ShaderChunk.fading_pars_vertex&&Object.assign(a.ShaderChunk,s.default)},e.updateDistanceFadeFeature=function(e){e.needsUpdate=!0,void 0===e.defines&&(e.defines={}),void 0!==e.fadeFar&&e.fadeFar>0&&(e.defines.FADING_MATERIAL="")},e.insertShaderInclude=function(e,t,n,r){var i=!0===r?"\t":"";return e.replace("#include <"+t+">","\n#include <"+t+">\n// << Patched fading shader START >>\n"+i+"#include <"+n+">\n// << Patched fading shader END >>\n")},e.onBeforeCompile=function(t,n){if(!(void 0===t.fadeFar||t.fadeFar<=0)){var r=n.uniforms;r.fadeNear={value:t.fadeNear},r.fadeFar={value:t.fadeFar},n.vertexShader=e.insertShaderInclude(n.vertexShader,"fog_pars_vertex","fading_pars_vertex"),n.vertexShader=e.insertShaderInclude(n.vertexShader,"fog_vertex","fading_vertex",!0),n.fragmentShader=e.insertShaderInclude(n.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),n.fragmentShader=e.insertShaderInclude(n.fragmentShader,"fog_fragment","fading_fragment",!0)}},e.addRenderHelper=function(t,n,r,i,o,a){t.onBeforeRender=function(t,s,l,c,d){i&&(d.transparent=!0);var h=d;if(h.fadeNear=void 0===n?e.DEFAULT_FADE_NEAR:u(n,l),h.fadeFar=void 0===r?e.DEFAULT_FADE_FAR:u(r,l),o){var f=t.properties.get(d);void 0!==f.shader&&(f.shader.uniforms.fadeNear.value=h.fadeNear,f.shader.uniforms.fadeFar.value=h.fadeFar,h.uniformsNeedUpdate=!0)}void 0!==a&&a(t,d)},i&&(t.onAfterRender=function(e,t,n,r,i){i.transparent=!1})}}(i=t.FadingFeature||(t.FadingFeature={}));var l=function(){function e(){this.m_fadeNear=i.DEFAULT_FADE_NEAR,this.m_fadeFar=i.DEFAULT_FADE_FAR}return e.prototype.getFadeNear=function(){return this.m_fadeNear},e.prototype.setFadeNear=function(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeNear,this.m_fadeNear=e,this.needsUpdate&&i.updateDistanceFadeFeature(this)},e.prototype.getFadeFar=function(){return this.m_fadeFar},e.prototype.setFadeFar=function(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeFar,this.m_fadeFar=e,this.needsUpdate&&i.updateDistanceFadeFeature(this)},e.prototype.addFadingProperties=function(){var e=this;Object.defineProperty(this,"fadeNear",{get:function(){return e.getFadeNear()},set:function(t){e.setFadeNear(t)}}),Object.defineProperty(this,"fadeFar",{get:function(){return e.getFadeFar()},set:function(t){e.setFadeFar(t)}})},e.prototype.applyFadingParameters=function(e){var t=this;void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=function(e){i.onBeforeCompile(t,e)}},e.prototype.copyFadingParameters=function(e){return this.setFadeNear(void 0===e.fadeNear?i.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?i.DEFAULT_FADE_FAR:e.fadeFar),this},e}();t.FadingFeatureMixin=l;var c=function(e){function t(t){var n=e.call(this,t)||this;return i.patchGlobalShaderChunks(),n.addFadingProperties(),n.applyFadingParameters(t),n}return r(t,e),t.prototype.clone=function(){return(new t).copy(this)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.copyFadingParameters(t),this},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return i.DEFAULT_FADE_NEAR},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return i.DEFAULT_FADE_FAR},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addFadingProperties=function(){},t.prototype.applyFadingParameters=function(e){},t.prototype.copyFadingParameters=function(e){},t}(a.MeshBasicMaterial);t.MapMeshBasicMaterial=c;var d=function(e){function t(t){var n=e.call(this,t)||this;return i.patchGlobalShaderChunks(),n.addFadingProperties(),n.applyFadingParameters(t),n}return r(t,e),t.prototype.clone=function(){return(new t).copy(this)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.copyFadingParameters(t),this},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return i.DEFAULT_FADE_NEAR},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return i.DEFAULT_FADE_FAR},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addFadingProperties=function(){},t.prototype.applyFadingParameters=function(e){},t.prototype.copyFadingParameters=function(e){},t}(a.MeshStandardMaterial);t.MapMeshStandardMaterial=d,o.applyMixinsWithoutProperties(c,[l]),o.applyMixinsWithoutProperties(d,[l])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));var r=function(){return function(){}}();t.LoggerOptions=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={project_line_vert_func:"\nvoid projectVertex(vec2 segment, vec2 t0, vec2 t1, float lineWidth, inout vec2 pos, inout vec2 uv) {\n        float uu = uv.x / 2.0 + 0.5;\n        float ss = mix(segment.x, segment.y, uu);\n\n        if (t0 != t1) {\n            float angle = atan(t0.x * t1.y - t0.y * t1.x, t0.x * t1.x + t0.y * t1.y);\n            vec2 t = normalize(t0 + t1);\n            vec2 n = vec2(t.y, -t.x);\n            pos += uv.y * lineWidth * n / cos(angle / 2.0);\n            uv.x = ss + uv.x * lineWidth * uv.y * tan(angle / 2.0);\n        }\n        else {\n            vec2 n = vec2(t0.y, -t0.x);\n            pos += uv.y * lineWidth * n + uv.x * lineWidth * mix(t0, t1, uu);\n            uv.x = ss + uv.x * lineWidth;\n        }\n}\n",join_dist_func:"\nfloat joinDist(vec2 segment, vec2 texcoord) {\n    float d = abs(texcoord.y);\n    float dx = texcoord.x;\n    if (dx < segment.x) {\n        d = max(d, length(texcoord - vec2(segment.x, 0.0)));\n    } else if (dx > segment.y) {\n        d = max(d, length(texcoord - vec2(segment.y, 0.0)));\n    }\n    return d;\n}\n",tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert2D_func:"\nvec2 subtractDblEyePos( const in vec2 pos ) {\n    vec2 t1 = positionLow - u_eyepos_lowpart.xy;\n    vec2 e = t1 - positionLow.xy;\n    vec2 t2 = ((-u_eyepos_lowpart.xy - e) + (positionLow.xy - (t1 - e))) + pos - u_eyepos.xy;\n    vec2 high_delta = t1 + t2;\n    vec2 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n",high_precision_vert3D_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t.GlyphDirection||(t.GlyphDirection={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);n(11);var s=n(1),u=n(26),l=s.LoggerManager.instance.create("FontCatalog"),c="./resources/replacementCharacter.png",d=["Hebrew","Alphabetic_Presentation_Forms","Arabic","Arabic_Supplement","Arabic_Extended-A","Arabic_Presentation_Forms-A","Arabic_Presentation_Forms-B","Arabic_Mathematical_Alphabetic_Symbols","Indic_Siyaq_Numbers","Rumi_Numeral_Symbols","Syriac","Syriac_Supplement","Samaritan","Mandaic","Thaana","Mende_Kikakui","NKo","Adlam","Hanifi_Rohingya"],h=[[32,47],[58,64],[91,96],[123,126]],f=[[48,57],[1632,1641],[1776,1785]];function p(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:if(!(t=r.sent()).ok)throw new Error(e+" Status Text:  "+t.statusText);return[4,t.text()];case 2:return n=r.sent(),[2,JSON.parse(n)]}})})}t.BOLD_CODEPOINT_OFFSET=2147483648,function(e){e[e.Left=1]="Left",e[e.Center=.5]="Center",e[e.Right=0]="Right"}(t.TextHorizontalAlignment||(t.TextHorizontalAlignment={})),function(e){e[e.Above=0]="Above",e[e.Center=.5]="Center",e[e.Below=1]="Below"}(t.TextVerticalAlignment||(t.TextVerticalAlignment={})),function(e){e.Left="Left",e.Center="Center",e.Right="Right"}(t.TextHorizontalAlignmentStrings||(t.TextHorizontalAlignmentStrings={})),function(e){e.Above="Above",e.Center="Center",e.Below="Below"}(t.TextVerticalAlignmentStrings||(t.TextVerticalAlignmentStrings={}));var m=function(){function e(e,t,n,r){this.name=e,this.fonts=t,this.supportedRanges=n,this.supportedSubranges=r}return e.load=function(t){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return[4,p(t)];case 1:return n=r.sent(),[2,new e(n.name,n.fonts,n.supportedRanges,n.supportedSubranges)]}})})},e}();t.FontCatalogInfo=m;var v=function(){function e(t,n,r,i){(this.info=t,this.name=n,this.m_url=r,this.m_callback=i,this.m_loadingJson=new Set,this.m_loadedJson=new Map,this.m_loadingTextures=new Set,this.m_loadedTextures=new Map,this.m_loadedGlyphs=new Map,void 0===e.replacementGlyph)&&(e.replacementGlyph={codepoint:65533,direction:u.GlyphDirection.LTR,advanceX:32,offsetX:-3,offsetY:14,width:37,height:37,s0:0,t0:1,s1:1,t1:0,s2:0,t2:0,s3:0,t3:0,page:0,texture:a.Texture.DEFAULT_IMAGE,emulateBold:!1,size:32,base:38,lineHeight:44,metrics:{unitsPerEm:1,capHeight:1}},new Promise(function(e){(new a.TextureLoader).load(c,e)}).then(function(t){l.log("Loaded texture: "+c);var n=t;n.wrapS=a.ClampToEdgeWrapping,n.wrapT=a.ClampToEdgeWrapping,n.minFilter=a.NearestFilter,n.needsUpdate=!0,e.replacementGlyph.texture=n}).catch(function(e){l.error("Failed to load texture: "+c,e)}))}return e.load=function(t,n,o){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,m.load(t)];case 1:return[2,new e(r.sent(),n,t,o)]}})})},e.getGlyphCorners=function(e,t,n,r,i,o,s,u){void 0===n&&(n=[]),void 0===r&&(r=!0),void 0===s&&(s=!1),void 0===u&&(u=!1);for(var l=0;l<4;++l)void 0===n[l]&&(n[l]=new a.Vector2);var c=e.metrics.capHeight/e.metrics.unitsPerEm*e.size*i,d=e.lineHeight-c,h=0,f=0,p=0,m=0;if(r){var v=u?e.metrics.xHeight/e.metrics.capHeight:1,g=u?e.metrics.xHeight/e.metrics.unitsPerEm*e.size*.5:0,y=e.width*v,_=e.height*v,b=e.offsetX*v,x=e.offsetY*v+g;f=(h=b)+y,m=(p=d-x-_)+_}else h=0,p=0,f=e.width,m=e.height;var w=s&&r?Math.tan(.174533)*e.size:0,T=new a.Vector3;return n[0].copy(T.set(o?f:h,p,0).applyMatrix4(t)),n[1].copy(T.set(o?h:f,p,0).applyMatrix4(t)),n[2].copy(T.set((o?f:h)+w,m,0).applyMatrix4(t)),n[3].copy(T.set((o?h:f)+w,m,0).applyMatrix4(t)),n},e.prototype.getGlyph=function(n,r){var i,a,s=n;!0===r&&(s+=t.BOLD_CODEPOINT_OFFSET);var u=this.m_loadedGlyphs.get(s);if(void 0!==u)return u;var l,c=void 0;try{for(var d=o(this.info.supportedRanges),h=d.next();!h.done;h=d.next()){var f=h.value;if(n>=f.min&&n<=f.max){c=f,l=f.fonts[0];break}}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}if(void 0===c)return e.replacementGlyph;var p=this.info.fonts.find(function(e){return e.name===l});if(void 0===p)return e.replacementGlyph;var m=void 0!==p.bold,v=!0===r&&!m,g=this.m_url.lastIndexOf("_FontCatalog.json"),y=this.m_url.substr(0,g)+(r&&m?"_BoldAssets/":"_Assets/")+c.fonts[0];return void 0!==(u=this.loadGlyph(n,c,y,v))&&this.m_loadedGlyphs.set(s,u),u},Object.defineProperty(e.prototype,"loading",{get:function(){return this.m_loadingJson.size>0||this.m_loadingTextures.size>0},enumerable:!0,configurable:!0}),e.prototype.loadGlyph=function(t,n,r,i){var a=this.m_loadedJson.get(r+"/"+n.name+".json");if(void 0!==a){var s=a.chars.find(function(e){return e.id===t});if(void 0===s)return e.replacementGlyph;var l=r+"/"+a.pages[s.page],c=this.m_loadedTextures.get(l);if(void 0!==c)return{codepoint:s.id,direction:function(e,t){var n,r,i,a;try{for(var s=o(f),l=s.next();!l.done;l=s.next()){var c=l.value;if(e>=c[0]&&e<=c[1])return u.GlyphDirection.Weak}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var p=o(h),m=p.next();!m.done;m=p.next()){var v=m.value;if(e>=v[0]&&e<=v[1])return u.GlyphDirection.Neutral}}catch(e){i={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}return void 0!==d.find(function(e){return e===t})?u.GlyphDirection.RTL:u.GlyphDirection.LTR}(t,n.name),advanceX:s.xadvance,offsetX:s.xoffset,offsetY:s.yoffset,width:s.width,height:s.height,s0:s.x/c.image.width,t0:1-s.y/c.image.height,s1:(s.x+s.width)/c.image.width,t1:1-(s.y+s.height)/c.image.height,s2:0,t2:0,s3:0,t3:0,page:s.page,texture:c,emulateBold:i,size:a.info.size,base:a.common.base,lineHeight:a.common.lineHeight,metrics:a.metrics};this.loadTexture(l)}else this.loadJson(t,n.name,r)},e.prototype.loadJson=function(e,t,n){var r=this,i=n+"/"+t+".json";this.m_loadingJson.has(i)||(l.log("Loading font json: "+i),this.m_loadingJson.add(i),p(i).then(function(t){l.log("Loaded font json: "+i),r.m_loadingJson.delete(i),r.m_loadedJson.set(i,t);var o=t.chars.find(function(t){return t.id===e});if(void 0===o)l.error("Codepoint "+e+" not found in FontCatalog assets.");else{var a=n+"/"+t.pages[o.page];r.loadTexture(a)}}).catch(function(e){l.error("Failed to load font. ",e)}))},e.prototype.loadTexture=function(e){var t=this;this.m_loadingTextures.has(e)||(l.log("Loading font texture: "+e),this.m_loadingTextures.add(e),function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){(new a.TextureLoader).load(e,t)})];case 1:return[2,t.sent()]}})})}(e).then(function(n){l.log("Loaded font texture: "+e),n.wrapS=a.ClampToEdgeWrapping,n.wrapT=a.ClampToEdgeWrapping,n.minFilter=a.NearestFilter,n.needsUpdate=!0,t.m_loadingTextures.delete(e),t.m_loadedTextures.set(e,n),t.m_callback()}).catch(function(e){l.error("Failed to load texture. ",e)}))},e}();t.FontCatalog=v},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(0),a=n(27),s=n(113),u=0,l=32768,c=0,d=32768;!function(e){e[e.Outline=0]="Outline",e[e.Glow=1]="Glow"}(t.TextBackgroundMode||(t.TextBackgroundMode={})),function(e){e.Outline="Outline",e.Glow="Glow"}(t.TextBackgroundModeStrings||(t.TextBackgroundModeStrings={}));var h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.type="BoxBufferMesh",r}return r(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return void 0===this.geometry||0===this.geometry.index.count},enumerable:!0,configurable:!0}),t}(o.Mesh);t.BoxBufferMesh=h;var f=function(){function e(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=u),void 0===r&&(r=l),this.material=e,this.renderOrder=t,this.startElementCount=n,this.maxElementCount=r,this.m_size=0,this.resizeBuffer(n),this.pickInfos=new Array}return e.prototype.clone=function(){return new e(this.material,this.renderOrder)},e.prototype.dispose=function(){void 0!==this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.internalMesh=void 0},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),e.prototype.reset=function(){void 0!==this.positionAttribute&&(this.positionAttribute.count=0,this.colorAttribute.count=0,this.uvAttribute.count=0,this.indexAttribute.count=0,this.pickInfos.length=0)},e.prototype.canAddElements=function(e){void 0===e&&(e=1);var t=this.indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.maxElementCount)return!1;var n=Math.min(this.maxElementCount,0===this.size?256:2*this.size);this.resize(n)}return!0},e.prototype.saveState=function(){return{positionAttributeCount:this.positionAttribute.count,colorAttributeCount:this.colorAttribute.count,uvAttributeCount:this.uvAttribute.count,indexAttributeCount:this.indexAttribute.count,pickInfoCount:this.pickInfos.length}},e.prototype.restoreState=function(e){this.positionAttribute.count=e.positionAttributeCount,this.colorAttribute.count=e.colorAttributeCount,this.uvAttribute.count=e.uvAttributeCount,this.indexAttribute.count=e.indexAttributeCount,this.pickInfos.length=e.pickInfoCount},e.prototype.addBox=function(e,t,n,r,i,o){if(!this.canAddElements())return!1;var a=t.s0,s=t.t0,u=t.s1,l=t.t1,c=e.x,d=e.y,h=e.w,f=e.h,p=Math.round(255*n.r),m=Math.round(255*n.g),v=Math.round(255*n.b),g=Math.round(255*r),y=this.positionAttribute,_=this.colorAttribute,b=this.uvAttribute,x=this.indexAttribute,w=y.count,T=x.count;return y.setXYZ(w,c,d,i),y.setXYZ(w+1,c+h,d,i),y.setXYZ(w+2,c,d+f,i),y.setXYZ(w+3,c+h,d+f,i),_.setXYZW(w,p,m,v,g),_.setXYZW(w+1,p,m,v,g),_.setXYZW(w+2,p,m,v,g),_.setXYZW(w+3,p,m,v,g),b.setXY(w,a,s),b.setXY(w+1,u,s),b.setXY(w+2,a,l),b.setXY(w+3,u,l),x.setX(T,w),x.setX(T+1,w+1),x.setX(T+2,w+2),x.setX(T+3,w+2),x.setX(T+4,w+1),x.setX(T+5,w+3),y.count+=4,_.count+=4,b.count+=4,x.count+=6,this.pickInfos.push(o),!0},e.prototype.updateBufferGeometry=function(){var e=this.positionAttribute,t=this.colorAttribute,n=this.uvAttribute,r=this.indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),n.count>0&&(n.needsUpdate=!0,n.updateRange.offset=0,n.updateRange.count=4*n.count),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=r.count),void 0!==this.geometry&&(this.geometry.clearGroups(),this.geometry.addGroup(0,this.indexAttribute.count))},e.prototype.cleanUp=function(){0===this.indexAttribute.count&&this.size>u&&this.clearAttributes()},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.internalMesh.isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return void 0===this.internalMesh&&this.resize(),this.internalMesh},enumerable:!0,configurable:!0}),e.prototype.pickBoxes=function(e,t,n){for(var r=this.pickInfos.length,o=this.pickInfos,a=this.positionAttribute,s=e.x,u=e.y,l=document.createElement("canvas"),c=0;c<r;c++){var d=4*c,h=a.getX(d);if(!(s<h)){var f=a.getX(d+1);if(!(s>f)){var p=a.getY(d);if(!(u<p)){var m=a.getY(d+2);if(!(u>m)){var v=new i.Math2D.Box(h,p,f-h,m-p);void 0!==n&&void 0!==o[c].poiInfo&&void 0!==o[c].poiInfo.uvBox&&this.isPixelTransparent(n,s,u,v,o[c].poiInfo.uvBox,l)||void 0!==o[c]&&t(o[c])}}}}}},e.prototype.resize=function(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new o.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.addAttribute("position",this.positionAttribute),this.geometry.addAttribute("color",this.colorAttribute),this.geometry.addAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?(this.internalMesh=new h(this.geometry,this.material),this.internalMesh.renderOrder=this.renderOrder):this.internalMesh.geometry=this.geometry,this.internalMesh},e.prototype.isPixelTransparent=function(e,t,n,r,i,o){var a=!1,u=s.screenToUvCoordinates(t,n,r,i),l=u.u,c=u.v,d=e.width*l,h=e.height*c,f=s.getPixelFromImage(d,h,e,o);return void 0!==f&&0===f[3]&&(a=!0),a},e.prototype.clearAttributes=function(){this.positionAttribute=void 0,this.colorAttribute=void 0,this.uvAttribute=void 0,this.indexAttribute=void 0,this.resize(u,!0)},e.prototype.resizeBuffer=function(e){var t=new Float32Array(4*e*3);if(void 0!==this.positionAttribute&&this.positionAttribute.array.length>0){var n=this.positionAttribute.count;t.set(this.positionAttribute.array),this.positionAttribute.setArray(t),this.positionAttribute.count=n}else this.positionAttribute=new o.BufferAttribute(t,3),this.positionAttribute.count=0,this.positionAttribute.setDynamic(!0);var r=new Uint8Array(4*e*4);if(void 0!==this.colorAttribute){var i=this.colorAttribute.count;r.set(this.colorAttribute.array),this.colorAttribute.setArray(r),this.colorAttribute.count=i}else this.colorAttribute=new o.BufferAttribute(r,4,!0),this.colorAttribute.count=0,this.colorAttribute.setDynamic(!0);var a=new Float32Array(4*e*4);if(void 0!==this.uvAttribute){var s=this.uvAttribute.count;a.set(this.uvAttribute.array),this.uvAttribute.setArray(a),this.uvAttribute.count=s}else this.uvAttribute=new o.BufferAttribute(a,4),this.uvAttribute.count=0,this.uvAttribute.setDynamic(!0);var u=6*e*1,l=u>65535?new Uint32Array(u):new Uint16Array(u);if(void 0!==this.indexAttribute){var c=this.indexAttribute.count;l.set(this.indexAttribute.array),this.indexAttribute.setArray(l),this.indexAttribute.count=c}else this.indexAttribute=new o.BufferAttribute(l,1),this.indexAttribute.count=0,this.indexAttribute.setDynamic(!0);this.m_size=e},e}();t.BoxBuffer=f;var p=function(e){function t(t,n,r,i,a){void 0===r&&(r=0),void 0===i&&(i=c),void 0===a&&(a=d);var s=e.call(this,t,r,i,a)||this;return s.textMaterial=t,s.outlineMaterial=n,s.renderOrder=r,s.startGlyphCount=i,s.maxGlyphCount=a,s.m_glyphAxis=new o.Vector2,s}return r(t,e),t.prototype.clone=function(){return new t(this.textMaterial,this.outlineMaterial,this.renderOrder)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.m_outlineMesh=void 0},Object.defineProperty(t.prototype,"outlineMesh",{get:function(){return void 0===this.m_outlineMesh&&this.resize(),this.m_outlineMesh},enumerable:!0,configurable:!0}),t.prototype.addGlyph=function(e,t,n,r,i,o,s,u,l,c,d,h,f){if(void 0===o&&(o=[]),!this.canAddElements())return!1;var p=e.s0,m=e.t0,v=e.s1,g=e.t1,y=e.s2,_=e.t2,b=e.s3,x=e.t3,w=e.page,T=e.emulateBold,C=Math.round(255*t.r),E=Math.round(255*t.g),S=Math.round(255*t.b),A=Math.round(255*n),P=this.positionAttribute,M=this.colorAttribute,O=this.uvAttribute,L=this.indexAttribute,I=this.glyphAxisAttribute,F=P.count,R=L.count;a.FontCatalog.getGlyphCorners(e,i,o,s,u,l,c,d),this.m_glyphAxis.set(o[1].x,o[1].y),this.m_glyphAxis.sub(o[0]).normalize(),P.setXYZ(F,o[0].x,o[0].y,r),P.setXYZ(F+1,o[1].x,o[1].y,r),P.setXYZ(F+2,o[2].x,o[2].y,r),P.setXYZ(F+3,o[3].x,o[3].y,r),I.setXY(F,this.m_glyphAxis.x,this.m_glyphAxis.y),I.setXY(F+1,this.m_glyphAxis.x,this.m_glyphAxis.y),I.setXY(F+2,this.m_glyphAxis.x,this.m_glyphAxis.y),I.setXY(F+3,this.m_glyphAxis.x,this.m_glyphAxis.y),M.setXYZW(F,C,E,S,A),M.setXYZW(F+1,C,E,S,A),M.setXYZW(F+2,C,E,S,A),M.setXYZW(F+3,C,E,S,A);var k=T?.2:0,D=d?.125:0;return s?(O.setXYZW(F,y,x,1+k+D,h),O.setXYZW(F+1,b,x,1+k+D,h),O.setXYZW(F+2,y,_,1+k+D,h),O.setXYZW(F+3,b,_,1+k+D,h)):(O.setXYZW(F,p,g,w,h),O.setXYZW(F+1,v,g,w,h),O.setXYZW(F+2,p,m,w,h),O.setXYZW(F+3,v,m,w,h)),L.setX(R,F),L.setX(R+1,F+1),L.setX(R+2,F+2),L.setX(R+3,F+2),L.setX(R+4,F+1),L.setX(R+5,F+3),P.count+=4,I.count+=4,M.count+=4,O.count+=4,L.count+=6,this.pickInfos.push(f),!0},t.prototype.pickBoxes=function(e,t){for(var n=this.pickInfos.length,r=this.pickInfos,i=this.positionAttribute,o=e.x,a=e.y,s=0;s<n;s++){var u=4*s;if(!(o<Math.min(i.getX(u+2),i.getX(u+1))))if(!(o>Math.max(i.getX(u+2),i.getX(u+1))))if(!(a<Math.min(i.getY(u+2),i.getY(u+1))))a>Math.max(i.getY(u+2),i.getY(u+1))||void 0!==r[s]&&t(r[s])}},t.prototype.resize=function(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new o.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.addAttribute("position",this.positionAttribute),this.geometry.addAttribute("glyphAxis",this.glyphAxisAttribute),this.geometry.addAttribute("color",this.colorAttribute),this.geometry.addAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?this.internalMesh=new h(this.geometry,this.material):this.internalMesh.geometry=this.geometry,void 0===this.m_outlineMesh?this.m_outlineMesh=new h(this.geometry,this.outlineMaterial):this.m_outlineMesh.geometry=this.geometry,this.internalMesh},t.prototype.updateBufferGeometry=function(){var t=this.glyphAxisAttribute;t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),e.prototype.updateBufferGeometry.call(this)},t.prototype.clearAttributes=function(){this.glyphAxisAttribute=void 0,e.prototype.clearAttributes.call(this)},t.prototype.resizeBuffer=function(t){var n=new Float32Array(4*t*2);if(void 0!==this.glyphAxisAttribute){var r=this.glyphAxisAttribute.count;n.set(this.glyphAxisAttribute.array),this.glyphAxisAttribute.setArray(n),this.glyphAxisAttribute.count=r}else this.glyphAxisAttribute=new o.BufferAttribute(n,2),this.glyphAxisAttribute.count=0,this.glyphAxisAttribute.setDynamic(!0);e.prototype.resizeBuffer.call(this,t)},t}(f);t.TextBuffer=p},function(e,t,n){"use strict";function r(e,t,n,i){if(!(this instanceof r))return new r(e,t,n,i);var o,a,s;e.x?(n=e.w,i=e.h,t=e.y,0!==e.w&&!e.w&&e.x2?(n=e.x2-e.x,i=e.y2-e.y):(n=e.w,i=e.h),e=e.x,o=e+n,a=t+i,s=!(i+n)):(o=e+n,a=t+i,s=!(i+n)),this.x1=this.x=function(){return e},this.y1=this.y=function(){return t},this.x2=function(){return o},this.y2=function(){return a},this.w=function(){return n},this.h=function(){return i},this.p=function(){return s},this.overlap=function(n){return s||n.p()?e<=n.x2()&&o>=n.x()&&t<=n.y2()&&a>=n.y():e<n.x2()&&o>n.x()&&t<n.y2()&&a>n.y()},this.expand=function(r){var s,u,l=r.x(),c=r.y(),d=r.x2(),h=r.y2();return s=e>l?l:e,u=t>c?c:t,n=o>d?o-s:d-s,i=a>h?a-u:h-u,e=s,t=u,this}}r.overlapRectangle=function(e,t){return 0===e.h&&0===e.w||0===t.h&&0===t.w?e.x<=t.x+t.w&&e.x+e.w>=t.x&&e.y<=t.y+t.h&&e.y+e.h>=t.y:e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y},r.containsRectangle=function(e,t){return e.x+e.w<=t.x+t.w&&e.x>=t.x&&e.y+e.h<=t.y+t.h&&e.y>=t.y},r.expandRectangle=function(e,t){var n,r,i=e.x+e.w,o=t.x+t.w,a=e.y+e.h,s=t.y+t.h;return n=e.x>t.x?t.x:e.x,r=e.y>t.y?t.y:e.y,e.w=i>o?i-n:o-n,e.h=a>s?a-r:s-r,e.x=n,e.y=r,e},r.makeMBR=function(e,t){if(!e.length)return{x:0,y:0,w:0,h:0};(t=t||{}).x=e[0].x,t.y=e[0].y,t.w=e[0].w,t.h=e[0].h;for(var n=1,i=e.length;n<i;n++)r.expandRectangle(t,e[n]);return t},r.squarifiedRatio=function(e,t,n){var r=(e+t)/2,i=e*t;return i*n/(i/(r*r))},e.exports=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);function o(e){e.depthWrite=!0,e.depthFunc=i.LessDepth,e.colorWrite=!0,e.transparent=!0;var n=e.clone();return n.depthWrite=!0,n.depthTest=!0,n.colorWrite=!1,n.transparent=!1,n.opacity=1,n.polygonOffset=!0,n.polygonOffsetUnits=t.DEPTH_PASS_POLYGON_OFFSET_UNITS,n}t.DEPTH_PASS_POLYGON_OFFSET_UNITS=1,t.DEFAULT_DEPTH_BASED_POLYGON_OFFSET_MULTIPLIER=t.DEPTH_PASS_POLYGON_OFFSET_UNITS+1,t.isRenderDepthPrePassEnabled=function(e){return!1!==e.enableDepthPrePass&&void 0!==e.opacity&&e.opacity>0&&e.opacity<1},t.createDepthPrePassMaterial=o,t.createDepthPrePassMesh=function(e){var t,n,a=e.geometry;if(!(a instanceof i.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");var s=a.getAttribute("position");if(!s)throw new Error("#createDepthPassMesh position attribute not found");var u=new i.BufferGeometry;u.addAttribute("position",s);var l=a.getAttribute("uv");l&&u.addAttribute("uv",l),a.index&&u.setIndex(a.index);try{for(var c=r(a.groups),d=c.next();!d.done;d=c.next()){var h=d.value,f=h.start,p=h.count,m=h.materialIndex;u.addGroup(f,p,m)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var v=e.material instanceof Array?e.material.map(o):o(e.material),g=new i.Mesh(u,v);return g.renderOrder=e.renderOrder,g},t.applyDepthBasedPolygonOffset=function(e){for(var n,i,o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];try{for(var l=r(o),c=l.next();!c.done;c=l.next())s(c.value,function(e){e.polygonOffset=!0,e.polygonOffsetFactor=0})}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}o[0].onBeforeRender=function(){for(var n=a++*e,r=function(e){var r=o[e],i=0===e?t.DEPTH_PASS_POLYGON_OFFSET_UNITS:0;s(r,function(e){e.polygonOffsetUnits=n+i})},i=0;i<o.length;++i)r(i)}};var a=0;function s(e,t){e.material instanceof Array?e.material.forEach(t):t(e.material)}t.resetDepthBasedPolygonOffsetIndex=function(){a=0}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(0),a=n(66),s=n(136),u=n(65);!function(e){function t(e){return new Float32Array([e])[0]}function n(e){return new o.Vector3(t(e.x),t(e.y),t(e.z))}function l(e,t){var r=(new o.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),i=new o.Vector3(0,0,0).applyMatrix4(t),a=n(i);return{viewProjection:r,eyePosHi:a,eyePosLo:n(i.sub(a))}}function c(e,n){if(e.length>0){var i=e[0];if(void 0===i||null===i)throw Error("Empty element in positions");var a=new Array,s=new Array,u=function(){for(var e,n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var u=r(i),l=u.next();!l.done;l=u.next()){var c=l.value,d=t(c);s.push(c-d),a.push(d)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}},l=i;if(void 0!==l.z)e.forEach(function(e){!function(e){u(e.x,e.y,e.z)}(e)}),n=3;else if(void 0!==l.y)e.forEach(function(e){u(e.x,e.y)}),n=2;else{if(void 0===n)throw Error("Positions are float array, please provide dimensionality (2 or 3)");if(a.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(function(e){u(e)})}return{positionHigh:new o.Float32BufferAttribute(a,n),positionLow:new o.Float32BufferAttribute(s,n)}}return{positionHigh:new o.Float32BufferAttribute([],n||3),positionLow:new o.Float32BufferAttribute([],n||3)}}function d(e,n,r){void 0===r&&(r=0);for(var i=new Array,o=e.length,a=0;a<o;a+=n){for(var s=0;s<r;s++)i.push(e[a+s]);var u=e[a+r],l=e[a+r+1],c=e[a+r+2],d=t(u),h=u-d,f=t(l),p=l-f,m=t(c),v=c-m;i.push(d,f,m,h,p,v);for(s=r+3;s<n;s++)i.push(e[a+s])}return i}function h(e,t,n){var r=c(t,n);return e.bufferGeometry.addAttribute("position",r.positionHigh),e.bufferGeometry.addAttribute("positionLow",r.positionLow),r.positionHigh.itemSize}e.doubleToFloat=t,e.doubleToFloatVec=n,e.makeFloatVec=function(e){var n=t(e.x),r=t(e.y),i=t(e.z),a=new o.Vector3(e.x-n,e.y-r,e.z-i);return e.x=t(n),e.y=t(r),e.z=t(i),a},e.createHighPrecisionCameraPos=l,e.updateHpUniforms=function(e,t,n){var r=l(t,e.matrixWorldInverse),i=r.viewProjection;if(void 0===n||!n.isMaterial)throw Error("High pecision line has no high precision material");if(!(n.uniforms&&n.uniforms.u_mvp&&n.uniforms.u_eyepos&&n.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");n.uniforms.u_mvp.value=new Float32Array(i.elements),n.uniforms.u_eyepos.value=new Float32Array(r.eyePosHi.toArray()),n.uniforms.u_eyepos_lowpart.value=new Float32Array(r.eyePosLo.toArray())},e.createAttributes=c,e.addInterleavedAttributes3=d,e.setPositions=h,e.convertPositions=function(e,t){if(e.length<=0)return{positions:[],dimensionality:t};var n=e[0];if(void 0===n||null===n)throw Error("Empty element in positions");var r=n;if(void 0===r.y&&void 0===r.z)return{positions:e,dimensionality:t};var i=new Array;return void 0!==r.z&&2!==t?(t=3,e.forEach(function(e){i.push(e.x,e.y,e.z)})):(t=2,e.forEach(function(e){i.push(e.x,e.y)})),{positions:i,dimensionality:t}},e.createLine=function(e,t){var n=void 0!==t.lineWidth?t.lineWidth:5,r=void 0!==t.addCircles&&t.addCircles,s=void 0!==t.wireFrame&&t.wireFrame,l=[],c=[];u.triangulateLine(e,n,l,c,r);var h=new o.BufferGeometry,f=d(l,3),p=new o.InterleavedBuffer(new Float32Array(f),6),m=new o.InterleavedBufferAttribute(p,3,0,!1),v=new o.InterleavedBufferAttribute(p,3,3,!1);h.addAttribute("position",m),h.addAttribute("positionLow",v),h.setIndex(new o.BufferAttribute(new Uint32Array(c),1));var g=new i.HighPrecisionLineMaterial(t),y=s?new a.HighPrecisionWireFrameLine(h,g):new a.HighPrecisionLine(h,g);return y.setupForRendering(),y},e.createPoints=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(n.length/3);var a=new o.BufferGeometry,u=i.isHighPrecisionPointMaterial(t)?t:new i.HighPrecisionPointMaterial(t),l=new s.HighPrecisionPoints(a,u);return h(l,e,3),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(12),o=300,a=function(){function e(e,t,n){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=n,this.m_lastCameraPos=new r.Vector3,this.m_newCameraPos=new r.Vector3,this.m_lastWorldCenter=new r.Vector3,this.m_throttlingTimerId=void 0,void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=o)}return e.prototype.checkCameraMoved=function(e){var t=i.MapViewUtils.extractYawPitchRoll(e.camera.quaternion),n=e.camera.getWorldPosition(this.m_newCameraPos),r=void 0===this.m_lastYawPitchRoll||!this.m_lastCameraPos.equals(n)||!this.m_lastWorldCenter.equals(e.worldCenter)||t.yaw!==this.m_lastYawPitchRoll.yaw||t.pitch!==this.m_lastYawPitchRoll.pitch||t.roll!==this.m_lastYawPitchRoll.roll;return r&&(this.m_lastCameraPos.copy(n),this.m_lastWorldCenter.copy(e.worldCenter),this.m_lastYawPitchRoll=t),r!==this.m_cameraMovedLastFrame&&(r&&this.movementStarted(),this.m_cameraMovedLastFrame=r),r&&this.startMovementFinishedTimer(),this.m_cameraMovedLastFrame},Object.defineProperty(e.prototype,"cameraIsMoving",{get:function(){return void 0!==this.m_throttlingTimerId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0},Object.defineProperty(e.prototype,"cameraMovedLastFrame",{get:function(){return!0===this.m_cameraMovedLastFrame},enumerable:!0,configurable:!0}),e.prototype.movementStarted=function(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()},e.prototype.movementFinished=function(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()},e.prototype.startMovementFinishedTimer=function(){var e=this;this.removeMovementFinishedTimer(),this.m_throttlingTimerId=setTimeout(function(){return e.movementFinished()},this.m_throttlingTimeout)},e.prototype.removeMovementFinishedTimer=function(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)},e}();t.CameraMovementDetector=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(6),o=n(9),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=1,n.max.y=.5,n.max.z=t,n},e.prototype.projectPoint=function(t,n){return void 0===n&&(n={x:0,y:0,z:0}),n.x=(t.longitude*a+Math.PI)*e.geoToWorldScale,n.y=(t.latitude*a+.5*Math.PI)*e.geoToWorldScale,n.z=t.altitude||0,n},e.prototype.unprojectPoint=function(t){return i.GeoCoordinates.fromRadians(t.y*e.worldToGeoScale-.5*Math.PI,t.x*e.worldToGeoScale-Math.PI,t.z)},e.prototype.projectBox=function(t,n){var r=this.projectPoint(new i.GeoCoordinates(t.center.latitude,t.center.longitude,0)),a=t.latitudeSpanInRadians,s=t.longitudeSpanInRadians,u=t.altitudeSpan,l=s*e.geoToWorldScale,c=a*e.geoToWorldScale;return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=r.x-.5*l,n.min.y=r.y-.5*c,n.max.x=r.x+.5*l,n.max.y=r.y+.5*c,void 0!==u?(n.min.z=r.z-.5*u,n.max.z=r.z+.5*u):(n.min.z=0,n.max.z=0),n},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)},e.geoToWorldScale=1/(2*Math.PI),e.worldToGeoScale=2*Math.PI/1,e}();t.equirectangularProjection=new s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=n(6),a=n(13),s=n(21),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.projectPoint=function(e,t){var n;n=e instanceof o.GeoCoordinates?e.normalized():new o.GeoCoordinates(e.latitude,e.longitude,e.altitude).normalized(),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;var r=Math.sin(s.MercatorProjection.latitudeClamp(n.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.z=e.altitude||0,t},t.prototype.unprojectPoint=function(e){var t=s.MercatorProjection.clamp(e.x,0,a.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5,n=.5-s.MercatorProjection.clamp(e.y,0,a.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r=360*t,i=90-360*Math.atan(Math.exp(2*-n*Math.PI))/Math.PI;return new o.GeoCoordinates(i,r,e.z)},t.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return new i.GeoBox(new o.GeoCoordinates(n.latitude,t.longitude,t.altitude),new o.GeoCoordinates(t.latitude,n.longitude,n.altitude))},t.MAXIMUM_LATITUDE=1.4844222297453322,t}(s.MercatorProjection);t.webMercatorProjection=new u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.tilingScheme=e,this.minElevation=t,this.maxElevation=n,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,n);var r=this.m_worldBox,i=r.min,o=r.max;this.m_worldDimensions={x:o.x-i.x,y:o.y-i.y,z:o.z-i.z}}return Object.defineProperty(e.prototype,"projection",{get:function(){return this.m_tilingScheme.projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionScheme",{get:function(){return this.m_tilingScheme.subdivisionScheme},enumerable:!0,configurable:!0}),e.prototype.getWorldBox=function(e,t){var n=e.level,i=this.subdivisionScheme.getLevelDimensionX(n),o=this.subdivisionScheme.getLevelDimensionY(n),a=this.m_worldDimensions.x/i,s=this.m_worldDimensions.y/o,u=this.m_worldBox.min.x+a*e.column,l=this.m_worldBox.min.y+s*e.row;return t||(t=r.MathUtils.newEmptyBox3()),t.min.x=u,t.min.y=l,t.min.z=this.m_worldBox.min.z,t.max.x=u+a,t.max.y=l+s,t.max.z=this.m_worldBox.max.z,t},e.prototype.getGeoBox=function(e){var t=this.getWorldBox(e);return this.projection.unprojectBox(t)},e}();t.FlatTileBoundingBoxGenerator=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(e){return 0===e?1:2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 0!==e?1<<e-1:1},e}();t.halfQuadTreeSubdivisionScheme=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=function(){function e(e,t,n){this.m_tileKey=e,this.m_level=t,this.m_count=1<<(t<<1),this.m_mask=n,this.m_shift=t>2?t-2<<1:0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.m_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.m_level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileKey",{get:function(){return this.m_tileKey},enumerable:!0,configurable:!0}),e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.skip=function(e){if(-1!==this.m_mask)for(;e<this.m_count&&0==(this.m_mask&1<<(e>>this.m_shift));)++e;return e},e}();t.SubTiles=i,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_parent=e,this.m_index=e.skip(t)}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this.m_parent.tileKey,t=this.m_parent.level;return r.TileKey.fromRowColumnLevel(e.row<<t|this.m_index>>t,e.column<<t|this.m_index&(1<<t)-1,e.level+t)},enumerable:!0,configurable:!0}),e.prototype.next=function(){this.m_index=this.m_parent.skip(++this.m_index)},e}();e.Iterator=t}(i=t.SubTiles||(t.SubTiles={})),t.SubTiles=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(14),o=function(){function e(){}return e.geoCoordinatesToTileKey=function(e,t,n){var r=e.projection,o=e.subdivisionScheme,a=r.projectPoint(t),s=o.getLevelDimensionX(n),u=o.getLevelDimensionY(n),l=r.worldExtent(0,0),c=l.min,d=l.max,h=d.x-c.x,f=d.y-c.y;if(a.x<c.x||a.x>d.x)return null;if(a.y<c.y||a.y>d.y)return null;var p=Math.min(s-1,Math.floor(s*(a.x-c.x)/h)),m=Math.min(u-1,Math.floor(u*(a.y-c.y)/f));return i.TileKey.fromRowColumnLevel(m,p,n)},e.geoRectangleToTileKeys=function(t,n,o){var a=function(e,t,n){return e<t?n-(t-e)%(n-t):t+(e-t)%(n-t)},s=function(e,t,n){return Math.min(Math.max(e,t),n)},u=a(n.southWest.longitudeInRadians,-Math.PI,Math.PI),l=s(n.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=a(n.northEast.longitudeInRadians,-Math.PI,Math.PI),d=s(n.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=e.geoCoordinatesToTileKey(t,r.GeoCoordinates.fromRadians(l,u),o),f=e.geoCoordinatesToTileKey(t,r.GeoCoordinates.fromRadians(d,c),o),p=t.subdivisionScheme.getLevelDimensionX(o);if(!h||!f)throw new Error("Invalid coordinates");var m=h.column,v=f.column;u>c&&(v+=v!==m?p:p-1);for(var g=Math.min(h.row,f.row),y=Math.max(h.row,f.row),_=new Array,b=g;b<=y;++b)for(var x=m;x<=v;++x)_.push(i.TileKey.fromRowColumnLevel(b,x%p,o));return _},e}();t.TileKeyUtils=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),i=function(){function e(e){this.m_subdivisionScheme=e}return e.prototype.subTiles=function(e){for(var t=~(-1<<this.m_subdivisionScheme.getSubdivisionX(e.level)*this.m_subdivisionScheme.getSubdivisionY(e.level)),n=new r.SubTiles(e,1,t),i=n.iterator(),o=new Array,a=0;a<n.length;++a)o.push(i.value),i.next();return o},e}();t.TileTreeTraverse=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(85);t.MapRenderingManager=r.MapRenderingManager;var i=n(48);t.Pass=i.Pass;var o=n(42);t.MSAARenderPass=o.MSAARenderPass,t.MSAASampling=o.MSAASampling},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(3),a=n(0),s=n(48);!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(i=t.MSAASampling||(t.MSAASampling={}));var u=function(e){function t(){var t=e.call(this)||this;return t.samplingLevel=i.Level_1,t.m_renderTarget=null,t.m_localCamera=new a.OrthographicCamera(-1,1,1,-1,0,1),t.m_quadScene=new a.Scene,t.m_quadUniforms=o.CopyShader.uniforms,t.m_quadMaterial=new o.MSAAMaterial(t.m_quadUniforms),t.m_quad=new a.Mesh(new a.PlaneBufferGeometry(2,2),t.m_quadMaterial),t.m_quad.frustumCulled=!1,t.m_quadScene.add(t.m_quad),t}return r(t,e),t.prototype.dispose=function(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)},t.prototype.render=function(e,n,r,i,o){if(this.enabled){null===this.m_renderTarget&&(this.m_renderTarget=new a.WebGLRenderTarget(o.width,o.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;var s=t.OffsetVectors[this.samplingLevel],u=e.getClearColor().getHex(),l={enabled:null!==r.view&&r.view.enabled,fullWidth:o.width,fullHeight:o.height,x:0,y:0,width:o.width,height:o.height};l.enabled&&null!==r.view&&(l.fullWidth=r.view.fullWidth,l.fullHeight=r.view.fullHeight,l.x=r.view.offsetX,l.y=r.view.offsetY,l.width=r.view.width,l.height=r.view.height);for(var c=0;c<s.length;c++){var d=s[c];r.setViewOffset(l.fullWidth,l.fullHeight,l.x+d[0]/16,l.y+d[1]/16,l.width,l.height);var h=(c+.5)/s.length-.5,f=1/s.length+h/32;this.m_quadUniforms.opacity.value=f,e.render(n,r,this.m_renderTarget,!0),0===c&&e.setClearColor(0),e.render(this.m_quadScene,this.m_localCamera,this.renderToScreen?void 0:i,0===c),0===c&&e.setClearColor(u)}null!==r.view&&(r.view.enabled=l.enabled,r.view.offsetX=l.x,r.view.offsetY=l.y)}},t.prototype.setSize=function(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)},t.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],t}(s.Pass);t.MSAARenderPass=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(23),a=n(25),s="\nattribute vec2 position;\nattribute vec4 tangents;\nattribute vec2 segment;\nattribute vec2 angles;\nattribute vec2 texcoord;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float lineWidth;\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n#include <project_line_vert_func>\n\nvoid main() {\n    vLinewidth = lineWidth;\n    vSegment = segment;\n\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = position;\n    vec2 uvs = texcoord;\n    projectVertex(segment, normalize(tangents.xy), normalize(tangents.zw), lineWidth, pos, uvs);\n\n    vPosition = pos;\n    vTexcoord = vec2(uvs.x, uvs.y * lineWidth);\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 0.0, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",u="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 tileSize;\n#if DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\n#endif\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\n#include <join_dist_func>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n\n    float alpha = opacity;\n\n    #if TILE_CLIP\n    tileClip(vPosition, tileSize);\n    #endif\n\n    #if DASHED_LINE\n    float halfSegment = (dashSize + gapSize) / dashSize * 0.5;\n    float segmentDist = mod(vTexcoord.x, dashSize + gapSize) / dashSize;\n    float dist = 0.5 - distance(segmentDist, halfSegment);\n    float width = fwidth(dist);\n    alpha *= smoothstep(-width, width, dist);\n    #else\n    float dist = joinDist(vSegment, vTexcoord) - vLinewidth;\n    float width = fwidth(dist);\n    alpha *= (1.0 - smoothstep(-width, width, dist));\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( diffuse, alpha );\n    #endif\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",l=function(e){function t(n){var r=this;Object.assign(i.ShaderChunk,a.default),o.FadingFeature.patchGlobalShaderChunks();var l={DASHED_LINE:0,TILE_CLIP:0},c=void 0!==n&&!0===n.fog;c&&(l.USE_FOG="");var d={name:"SolidLineMaterial",vertexShader:s,fragmentShader:u,uniforms:i.UniformsUtils.merge([{diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),lineWidth:new i.Uniform(t.DEFAULT_WIDTH),opacity:new i.Uniform(t.DEFAULT_OPACITY),tileSize:new i.Uniform(new i.Vector2),fadeNear:new i.Uniform(o.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new i.Uniform(o.FadingFeature.DEFAULT_FADE_FAR)},i.UniformsLib.fog]),defines:l,transparent:!0,fog:!0};return(r=e.call(this,d)||this).extensions.derivatives=!0,void 0!==n&&(void 0!==n.color&&r.color.set(n.color),void 0!==n.lineWidth&&(r.lineWidth=n.lineWidth),void 0!==n.opacity&&(r.opacity=n.opacity),void 0!==n.depthTest&&(r.depthTest=n.depthTest),void 0!==n.fadeNear&&(r.fadeNear=n.fadeNear),void 0!==n.fadeFar&&(r.fadeFar=n.fadeFar),r.fog=c),r}return r(t,e),t.prototype.updateFog=function(e){e?this.defines.USE_FOG="":delete this.defines.USE_FOG},Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeNear",{get:function(){return this.uniforms.fadeNear.value},set:function(e){this.uniforms.fadeNear.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return this.uniforms.fadeFar.value},set:function(e){var t=this.uniforms.fadeFar.value;this.uniforms.fadeFar.value=e,void 0!==t&&t>0?this.defines.USE_FADING="":delete this.defines.USE_FADING},enumerable:!0,configurable:!0}),t.DEFAULT_COLOR=16711680,t.DEFAULT_WIDTH=1,t.DEFAULT_OPACITY=1,t}(i.RawShaderMaterial);t.SolidLineMaterial=l},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.error.apply(console,i([e],t))},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.debug.apply(console,i([e],t))},e.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.info.apply(console,i([e],t))},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log.apply(console,i([e],t))},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.trace.apply(console,i([e],t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.warn.apply(console,i([e],t))},e}();t.ConsoleChannel=o},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(24),a=function(){function e(e,t,n){this.name=e,this.m_channel=t,this.enabled=!0,this.level=o.LogLevel.Trace,void 0!==n&&this.update(n)}return e.prototype.error=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Error&&(t=this.m_channel).error.apply(t,i([this.prefix,e],n))},e.prototype.debug=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Debug&&(t=this.m_channel).debug.apply(t,i([this.prefix,e],n))},e.prototype.info=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Info&&(t=this.m_channel).info.apply(t,i([this.prefix,e],n))},e.prototype.log=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Log&&(t=this.m_channel).log.apply(t,i([this.prefix,e],n))},e.prototype.trace=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Trace&&(t=this.m_channel).trace.apply(t,i([this.prefix,e],n))},e.prototype.warn=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.enabled&&this.level<=o.LogLevel.Warn&&(t=this.m_channel).warn.apply(t,i([this.prefix,e],n))},e.prototype.update=function(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level},Object.defineProperty(e.prototype,"prefix",{get:function(){return this.name+":"},enumerable:!0,configurable:!0}),e}();t.Logger=a},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(24);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";var a=function(){function e(){}return e.prototype.error=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Error};self.postMessage(a)},e.prototype.debug=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Debug};self.postMessage(a)},e.prototype.info=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Info};self.postMessage(a)},e.prototype.log=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Log};self.postMessage(a)},e.prototype.trace=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Trace};self.postMessage(a)},e.prototype.warn=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a={message:i([e],n),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Warn};self.postMessage(a)},e}();t.WorkerChannel=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.enabled=!0,this.renderToScreen=!1}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,n,r,i,o){},e}();t.Pass=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(0),a=i.LoggerManager.instance.create("ImageCache"),s=(function(){}(),function(){function e(){this.m_images=new Map}return Object.defineProperty(e,"instance",{get:function(){return void 0===e.m_instance&&(e.m_instance=new e),e.m_instance},enumerable:!0,configurable:!0}),e.dispose=function(){e.m_instance=void 0},e.prototype.registerImage=function(e,t,n){var r=this.findImageCacheItem(t);if(void 0!==r)return void 0!==e&&r.mapViews.indexOf(e)<0&&r.mapViews.push(e),r.imageItem;if(void 0!==(r=this.findImageCacheItem(t)))return void 0!==e&&r.mapViews.indexOf(e)<0&&r.mapViews.push(e),r.imageItem;var i=[];return void 0!==e&&i.push(e),r={imageItem:{url:t,imageData:n,loaded:!1},mapViews:i},this.m_images.set(t,r),r.imageItem},e.prototype.addImage=function(e,t,n){void 0===n&&(n=!0);var r=this.registerImage(e,t,void 0);return void 0!==r&&!0===n?this.loadImage(r):r},e.prototype.findImage=function(e){var t=this.m_images.get(e);if(void 0!==t)return t.imageItem},e.prototype.clear=function(e){var t,n,i=[];this.m_images.forEach(function(t){var n=t.mapViews.indexOf(e);n>=0&&t.mapViews.splice(n,1),0===t.mapViews.length&&i.push(t.imageItem.url)});try{for(var o=r(i),a=o.next();!a.done;a=o.next()){var s=a.value;this.m_images.delete(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.clearAll=function(){this.m_images=new Map},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_images.size},enumerable:!0,configurable:!0}),e.prototype.loadImage=function(e){var t=this;if(void 0!==e.imageData)return e;if(void 0!==e.loadingPromise)return e.loadingPromise;var n=new o.ImageLoader;return e.loadingPromise=new Promise(function(r){a.log("Loading image: "+e.url),n.load(e.url,function(n){a.log("... finished loading image: "+e.url),t.renderImage(e,n).then(function(){e.loadingPromise=void 0,r(e)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),r(void 0)})},void 0,function(t){a.error("... loading image failed: "+e.url+" : "+t),e.loadingPromise=void 0,r(void 0)})}),e.loadingPromise},e.prototype.findImageCacheItem=function(e){return this.m_images.get(e)},e.prototype.renderImage=function(e,t){return new Promise(function(n,r){if("function"==typeof createImageBitmap){a.log("Creating bitmap image: "+e.url),createImageBitmap(t,0,0,t.width,t.height,{premultiplyAlpha:"default",imageOrientation:"flipY"}).then(function(t){a.log("... finished creating bitmap image: "+e.url),e.loadingPromise=void 0,e.imageData=t,e.loaded=!0,n(t)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),n(void 0)})}else try{"undefined"==typeof document&&(a.error("Error: document is not available, cannot generate image"),r(new Error("ImageCache#renderImage: document is not available, cannot render image to create texture")));var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var o=i.getContext("2d");if(null!==o){a.log("... finished creating bitmap image in canvas: "+e.url+" "+t),o.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height);var s=o.getImageData(0,0,t.width,t.height);e.imageData=s,e.loaded=!0,n(s)}else a.error("renderImage: no context found"),r(new Error("ImageCache#renderImage: no context found"))}catch(t){a.error("renderImage failed: "+t),e.imageData=void 0,e.loaded=!0,r(new Error("ImageCache#renderImage failed: "+t))}})},e}());t.ImageCache=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(49),i=function(){function e(e){this.mapView=e,this.m_name2Url=new Map,this.m_url2Name=new Map}return e.prototype.registerImage=function(e,t,n){if(void 0!==e){if(this.hasName(e))throw new Error("duplicate name in cache");var i=this.m_url2Name.get(t);void 0!==i?i.indexOf(e)<0&&i.push(e):this.m_url2Name.set(t,[e]),this.m_name2Url.set(e,t)}var o=r.ImageCache.instance.findImage(t);return void 0===o?r.ImageCache.instance.registerImage(this.mapView,t,n):o},e.prototype.addImage=function(e,t,n){void 0===n&&(n=!0);var i=this.registerImage(e,t,void 0);return!0===n?r.ImageCache.instance.loadImage(i):i},e.prototype.findImageByName=function(e){var t=this.m_name2Url.get(e);if(void 0!==t)return r.ImageCache.instance.findImage(t)},e.prototype.findImageByUrl=function(e){return r.ImageCache.instance.findImage(e)},e.prototype.loadImage=function(e){return r.ImageCache.instance.loadImage(e)},e.prototype.clear=function(){r.ImageCache.instance.clear(this.mapView),this.m_name2Url=new Map,this.m_url2Name=new Map},Object.defineProperty(e.prototype,"numberOfNames",{get:function(){return this.m_name2Url.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfUrls",{get:function(){return this.m_url2Name.size},enumerable:!0,configurable:!0}),e.prototype.hasName=function(e){return void 0!==this.m_name2Url.get(e)},e.prototype.hasUrl=function(e){return void 0!==this.m_url2Name.get(e)},e.prototype.findNames=function(e){return this.m_url2Name.get(e)},e}();t.MapViewImageCache=i},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(52),o=n(3),a=n(0),s=n(27),u=n(26),l=n(28),c=n(53),d=new a.Vector3(0,0,0),h=new a.Matrix4,f=new Array;t.GLYPH_CACHE_SIZE=1024,t.GLYPH_CACHE_WIDTH=Math.sqrt(t.GLYPH_CACHE_SIZE),t.GLYPH_CACHE_TEXTURE_SIZE=2048,t.GLYPH_CACHE_ENTRY_WIDTH=t.GLYPH_CACHE_TEXTURE_SIZE/t.GLYPH_CACHE_WIDTH;var p=function(){function e(e){this.fontCatalogAsset=e,this.m_scene=new a.Scene,this.m_glyphCache=new i.LRUCache(t.GLYPH_CACHE_SIZE),this.initCacheEntries(),this.m_camera=new a.OrthographicCamera(0,t.GLYPH_CACHE_TEXTURE_SIZE,t.GLYPH_CACHE_TEXTURE_SIZE,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new a.WebGLRenderTarget(t.GLYPH_CACHE_TEXTURE_SIZE,t.GLYPH_CACHE_TEXTURE_SIZE),this.m_clearColor=new a.Color(0,0,0),this.m_copyMaterial=new o.GlyphCopyMaterial,this.m_copyTextureSet=new Set;var n=new l.TextBuffer(this.m_copyMaterial,this.m_copyMaterial);this.m_renderBuffer=new c.TextRenderBuffer(n,{fontCatalog:e,fontCatalogName:e.name}),this.m_scene.add(this.m_renderBuffer.textBuffer.mesh)}return Object.defineProperty(e.prototype,"size",{get:function(){return this.m_glyphCache.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.m_glyphCache.capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_rt.texture},enumerable:!0,configurable:!0}),e.prototype.add=function(e,n){var i,o,a=e;if(!0===n&&(a+=s.BOLD_CODEPOINT_OFFSET),void 0===this.m_glyphCache.get(a)){var u=this.m_glyphCache.oldest;if(void 0===this.m_renderBuffer||void 0===this.m_renderBuffer.textStyle.fontCatalog||null===u)throw new Error("GlyphTextureCache not properly initialized.");var c=this.m_renderBuffer.textStyle.fontCatalog.getGlyph(a);this.m_copyTextureSet.add(c.texture);var p=0;try{for(var m=r(this.m_copyTextureSet.values()),v=m.next();!v.done;v=m.next()){if(v.value===c.texture)break;p++}}catch(e){i={error:e}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}c.page=p,h.identity(),d.set(u.value.location.x*t.GLYPH_CACHE_ENTRY_WIDTH,u.value.location.y*t.GLYPH_CACHE_ENTRY_WIDTH,0),h.setPosition(d),this.m_renderBuffer.textBuffer.addGlyph(c,this.m_clearColor,1,0,h,f,!1,s.TextVerticalAlignment.Center,!1,!1,!1,l.TextBackgroundMode.Outline),c.s2=f[0].x/t.GLYPH_CACHE_TEXTURE_SIZE,c.t2=f[3].y/t.GLYPH_CACHE_TEXTURE_SIZE,c.s3=f[3].x/t.GLYPH_CACHE_TEXTURE_SIZE,c.t3=f[0].y/t.GLYPH_CACHE_TEXTURE_SIZE,this.m_glyphCache.set(a,{glyphInfo:c,location:u.value.location})}},e.prototype.get=function(e,t){var n=e;return!0===t&&(n+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.get(n)},e.prototype.has=function(e,t){var n=e;return!0===t&&(n+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.has(n)},e.prototype.delete=function(e,t){var n=e;return!0===t&&(n+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.delete(n)},e.prototype.clear=function(){this.m_glyphCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()},e.prototype.disposeBuffer=function(){void 0!==this.m_renderBuffer&&(this.m_renderBuffer.dispose(),this.m_copyTextureSet.clear())},e.prototype.resetBuffer=function(){void 0!==this.m_renderBuffer&&(this.m_renderBuffer.reset(),this.m_copyTextureSet.clear())},e.prototype.updateBuffer=function(){void 0!==this.m_renderBuffer&&this.m_renderBuffer.updateBufferGeometry()},e.prototype.clearTexture=function(e){var t=e.getRenderTarget(),n=e.getClearColor();e.setRenderTarget(this.m_rt),e.setClearColor(this.m_clearColor),e.clear(!0),e.setRenderTarget(t),e.setClearColor(n)},e.prototype.updateTexture=function(e){for(var t=Array.from(this.m_copyTextureSet),n=Math.ceil(this.m_copyTextureSet.size/8),r=0;r<n;r++){var i=8*r;this.m_copyMaterial.uniforms.pageOffset.value=i;for(var o=0;o<8;o++){var a=i+o;a<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+o].value=t[a])}e.render(this.m_scene,this.m_camera,this.m_rt)}this.m_copyTextureSet.clear()},e.prototype.initCacheEntries=function(){for(var e=0;e<t.GLYPH_CACHE_WIDTH;e++)for(var n=0;n<t.GLYPH_CACHE_WIDTH;n++){var r={glyphInfo:{codepoint:0,direction:u.GlyphDirection.LTR,advanceX:0,offsetX:0,offsetY:0,width:0,height:0,s0:0,t0:0,s1:0,t1:0,s2:0,t2:0,s3:0,t3:0,page:0,texture:a.Texture.DEFAULT_IMAGE,emulateBold:!1,size:0,lineHeight:0,base:0,metrics:{}},location:new a.Vector2(n,e)};this.m_glyphCache.set(-(e*t.GLYPH_CACHE_WIDTH+n+1),r)}},e}();t.GlyphTextureCache=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(112))},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(0),u=n(51),l=n(28),c=a.LoggerManager.instance.create("TextRenderer");t.DEFAULT_TEXT_RENDER_ORDER=0,t.BG_TEXT_RENDER_ORDER=t.DEFAULT_TEXT_RENDER_ORDER+.1;var d=t.BG_TEXT_RENDER_ORDER+1e-9;t.DEFAULT_STYLE_NAME="default",t.DEFAULT_FONT_CATALOG_NAME="default";var h=function(){function e(e,n,r){void 0===r&&(r=t.DEFAULT_TEXT_RENDER_ORDER),this.textBuffer=e,this.textStyle=n,this.renderOrder=r}return e.prototype.reset=function(){this.textBuffer.reset()},e.prototype.dispose=function(){this.textBuffer.dispose()},e.prototype.updateBufferGeometry=function(){this.textBuffer.updateBufferGeometry()},e.prototype.cleanUp=function(){this.textBuffer.cleanUp()},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.textBuffer.isEmpty},enumerable:!0,configurable:!0}),e}();t.TextRenderBuffer=h;var f=function(){function e(){this.scenes=new Map,this.sortedScenes=[]}return e.prototype.getScene=function(e){var t=this;void 0===e&&(e=0);var n=Math.floor(e),r=this.scenes.get(n);void 0===r&&(r=new s.Scene,this.scenes.set(n,r),this.sortedScenes.length=0,new Map(i(this.scenes.entries()).sort()).forEach(function(e){t.sortedScenes.push(e)}));return r},e}();t.SceneSet=f;var p=function(){function e(e,t){this.styles=e,this.materialConstructor=t,this.sceneSet=new f,this.fontCatalogs=[],this.renderBuffers=new Map,this.glyphCaches=new Map,void 0!==e&&void 0!==t&&this.addFontCatalogStyles(e,t)}return e.prototype.defaultTextRenderBuffer=function(e){return void 0===e&&(e=t.DEFAULT_TEXT_RENDER_ORDER),void 0!==this.m_defaultRenderBuffer&&void 0!==this.m_defaultRenderBuffer.get(e)?this.m_defaultRenderBuffer.get(e):(this.m_defaultRenderBuffer=this.renderBuffers.get(t.DEFAULT_STYLE_NAME),void 0!==this.m_defaultRenderBuffer?this.m_defaultRenderBuffer.get(e):void 0)},Object.defineProperty(e.prototype,"defaultGlyphTextureCache",{get:function(){return this.m_defaultGlyphCache?this.m_defaultGlyphCache:(this.m_defaultGlyphCache=this.glyphCaches.get(t.DEFAULT_FONT_CATALOG_NAME),this.m_defaultGlyphCache)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){var e=[];return this.renderBuffers.forEach(function(t){t.forEach(function(t){e.push(t.textBuffer)})}),e},enumerable:!0,configurable:!0}),e.prototype.getTextRendererBufferForStyle=function(e,n){if(void 0===n&&(n=t.DEFAULT_TEXT_RENDER_ORDER),void 0===e)return this.defaultTextRenderBuffer(n);var r=this.renderBuffers.get(e);if(void 0!==r){var i=r.get(n);return void 0===i?this.addOrderedTextBuffer(r,n):i}return void 0!==this.m_defaultRenderBuffer?this.m_defaultRenderBuffer.get(n):void 0},e.prototype.getGlyphTextureCacheForFontCatalog=function(e){if(void 0===e)return this.defaultGlyphTextureCache;var t=this.glyphCaches.get(e);return void 0!==t?t:this.defaultGlyphTextureCache},e.prototype.dispose=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.dispose()})})},e.prototype.reset=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.reset()})})},e.prototype.update=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.updateBufferGeometry()})})},e.prototype.render=function(e,t,n){var r,i,a,s;try{for(var u=o(this.sceneSet.sortedScenes),l=u.next();!l.done;l=u.next()){var c=l.value,d=!1;if(c.children.length>0)try{for(var h=o(c.children),f=h.next();!f.done;f=h.next()){var p=f.value;if("BoxBufferMesh"===p.type){var m=p;m.visible=!m.isEmpty,d=d||m.visible}}}catch(e){a={error:e}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}d&&(e.clearDepth(),e.render(c,t))}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}n||this.renderBuffers.forEach(function(e){e.forEach(function(e){e.cleanUp()})})},e.prototype.pickTextElements=function(e,t){var n,r;try{for(var i=o(this.renderBuffers.values()),a=i.next();!a.done;a=i.next()){a.value.forEach(function(n){n.textBuffer.pickBoxes(e,t)})}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.addFontCatalogStyles=function(e,n){var r=this,i=new Set;e.forEach(function(e){void 0!==e.fontCatalog?i.add(e.fontCatalog):c.warn("No 'fontCatalog' defined in style:",e)}),i.forEach(function(e){var t=new u.GlyphTextureCache(e);r.glyphCaches.set(e.name,t),r.fontCatalogs.push(e.name)}),e.forEach(function(e){if(void 0===e.fontCatalog&&c.warn("No 'fontCatalog' defined in style:",e),void 0===e.name&&c.warn("No 'name' defined in style:",e),void 0!==e.fontCatalog&&void 0!==e.name){var i=r.glyphCaches.get(e.fontCatalog.name);if(void 0!==i){var o={texture:i.texture,textureSize:u.GLYPH_CACHE_TEXTURE_SIZE},a=new n(o),s={texture:i.texture,textureSize:u.GLYPH_CACHE_TEXTURE_SIZE,bgColor:e.bgColor,bgFactor:e.bgFactor,bgAlpha:e.bgAlpha},d=new n(s),f=new l.TextBuffer(a,d,t.DEFAULT_TEXT_RENDER_ORDER),p=new Map,m=new h(f,e,t.DEFAULT_TEXT_RENDER_ORDER);p.set(t.DEFAULT_TEXT_RENDER_ORDER,m),r.renderBuffers.set(e.name,p),r.initTextBuffer(m,t.DEFAULT_TEXT_RENDER_ORDER)}else c.error("GlyphCacheTexture not properly set up for fontCatalog: ",e.fontCatalog.name)}})},e.prototype.addOrderedTextBuffer=function(e,t){var n=e.get(0);a.assert(void 0!==n);var r=n.textBuffer.clone(),i=new h(r,n.textStyle,n.renderOrder);return e.set(t,i),this.initTextBuffer(i,t),i},e.prototype.initTextBuffer=function(e,n){var r=e.textBuffer.mesh,i=e.textBuffer.outlineMesh;r.frustumCulled=!1,i.frustumCulled=!1,r.renderOrder=d+n,i.renderOrder=t.BG_TEXT_RENDER_ORDER+n;var o=this.sceneSet.getScene(n);a.assert(void 0!==o),void 0!==o&&o.add(r,i)},e}();t.TextRenderer=p},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(0);function a(e){return e instanceof Array&&e.length>0&&void 0!==e[0].value}function s(e,t){var n,i;if(!(e instanceof Array))return e;try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(!(void 0!==s.minLevel&&t<s.minLevel)&&!(void 0!==s.maxLevel&&t>s.maxLevel))return s.value}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}!function(e){e.ShowInStack="show-in-stack",e.HideInStack="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=function(e){return"extruded-line"===e.name},t.isFillTechnique=function(e){return"fill"===e.name},t.isExtrudedPolygonTechnique=function(e){return"extruded-polygon"===e.name},t.isStandardTechnique=function(e){return"standard"===e.name},t.isStandardTexturedTechnique=function(e){return"standard-textured"===e.name},t.isLandmarkTechnique=function(e){return"landmark"===e.name},t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.getMaterialConstructor=function(e){switch(e.name){case"extruded-line":return"standard"===e.shading?i.MapMeshStandardMaterial:i.MapMeshBasicMaterial;case"standard":case"standard-textured":case"landmark":case"extruded-polygon":return i.MapMeshStandardMaterial;case"solid-line":return i.SolidLineMaterial;case"dashed-line":return i.DashedLineMaterial;case"fill":return i.MapMeshBasicMaterial;case"squares":return o.PointsMaterial;case"circles":return i.CirclePointsMaterial;case"line":case"segments":return o.LineBasicMaterial;case"shader":return o.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":return}},t.getObjectConstructor=function(e){switch(e.name){case"extruded-line":case"standard":case"standard-textured":case"landmark":case"extruded-polygon":case"fill":case"solid-line":case"dashed-line":return o.Mesh;case"circles":case"squares":return o.Points;case"line":case"segments":return o.LineSegments;case"shader":switch(e.primitive){case"line":return o.Line;case"segments":return o.LineSegments;case"point":return o.Points;case"mesh":return o.Mesh;default:return}case"text":case"labeled-icon":case"line-marker":return}},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","renderOrderBiasProperty","renderOrderBiasGroup","renderOrderBiasRange","transient"],t.getPropertyValue=s,t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.format},t.getAttributeValue=function(e,t){return a(e)?s(e,t):e},t.toWrappingMode=function(e){if("clamp"===e)return o.ClampToEdgeWrapping;if("repeat"===e)return o.RepeatWrapping;if("mirror"===e)return o.MirroredRepeatWrapping;throw new Error("invalid wrapping: "+e)},t.applyTechniqueToMaterial=function(e,n,r,i){Object.getOwnPropertyNames(e).forEach(function(u){if(!(u.startsWith("_")||-1!==t.BASE_TECHNIQUE_NON_MATERIAL_PROPS.indexOf(u)||void 0!==i&&-1!==i.indexOf(u))){var l=u,c=n,d=e[l];void 0!==c[l]&&(void 0!==r&&a(d)&&(d=s(d,r)),c[l]instanceof o.Color?c[l].set(d):c[l]=d)}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(3),a=n(1),s=n(19),u=a.LoggerManager.instance.create("RoadPicker"),l=function(){function e(e){this.m_mapView=e}return e.prototype.registerTile=function(e){if(a.assert(void 0!==e.decodedTile),void 0!==e.decodedTile&&void 0!==e.decodedTile.tileInfo){var t=e.decodedTile.tileInfo,n=t.lineGroup;if(void 0!==n&&0!==n.numFeatures){var r=[];r.length=n.numFeatures;for(var i=e.tileKey.level,o=0;o<n.numFeatures;o++){var s=t.techniqueCatalog[n.techniqueIndex[o]],u=this.getLineWidthInWorldUnit(s,i);r[o]=void 0!==u?Math.max(1,u):1}var l=t.lineGroup.userData;return{ids:n.featureIds,techniqueIndex:n.techniqueIndex,starts:n.positionIndex,widths:r,positions:n.positions,techniques:t.techniqueCatalog,objInfos:l}}}},e.prototype.intersectRoads=function(e,t,n,r){if(e.boundingBox.distanceToPoint(n)>.01)return!1;var i=e.roadIntersectionData;if(void 0===i)return!1;var o=i.ids,l=i.techniques,c=i.techniqueIndex,d=o.length,h=i.positions,f=i.widths,p=n.x-e.center.x,m=n.y-e.center.y,v=n.distanceTo(t);if(f.length!==o.length||o.length!==c.length||c.length!==i.starts.length)return u.error("The amount of widths, ids, techniqueIndices and starts has to be the same"),!1;for(var g=0;g<d;g++){var y=l[c[g]];if(!0!==y.transient){for(var _=i.starts[g],b=g<d-1?i.starts[g+1]:i.positions.length,x=h[_],w=h[_+1],T=f[g]*f[g],C=Number.MAX_VALUE,E=_+2;E<b;E+=2){var S=h[E],A=h[E+1],P=a.Math2D.distToSegmentSquared(p,m,x,w,S,A);P<T&&P<C&&(C=P),x=S,w=A}if(C<Number.MAX_VALUE){var M={type:s.PickObjectType.Line,point:n,distance:v,distFromCenter:Math.sqrt(C),featureId:o[g],positions:h.slice(_,b),technique:y};this.addUserData(M,g,i.objInfos),r.push(M)}}}return!1},e.prototype.addUserData=function(e,t,n){void 0!==n&&n.length>0&&(e.userData=r({},n[t]))},e.prototype.getLineWidthInWorldUnit=function(e,t){var n=e;if("Pixel"===i.getAttributeValue(n.metricUnit,t)){var r=this.m_mapView.renderer.getPixelRatio()*this.m_mapView.pixelToWorld*.5,a=i.getAttributeValue(n.lineWidth,t);return(void 0!==a?a:o.SolidLineMaterial.DEFAULT_WIDTH)*r}var s=e;return i.getAttributeValue(s.lineWidth,t)},e}();t.RoadPicker=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TopLeft=0]="TopLeft",e[e.BottomLeft=1]="BottomLeft"}(t.ImageOrigin||(t.ImageOrigin={}));var r=function(){return function(e){this.image=e}}();t.IconTexture=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(119),a=n(120),s=i.LoggerManager.instance.create("ScreenCollissions"),u=function(){function e(){this.screenBounds=new i.Math2D.Box,this.rtree=new a,this.m_returnArray=[]}return e.toBox2D=function(e,t){t.x=e.min.x,t.y=e.min.y,t.w=e.max.x-e.min.x,t.h=e.max.y-e.min.y},e.prototype.reset=function(){this.rtree=new a},e.prototype.update=function(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()},e.prototype.allocate=function(e){this.rtree.insert(e,null)},e.prototype.isAllocated=function(e){return this.m_returnArray.length=0,this.m_returnArray=this.rtree.search(e,void 0,this.m_returnArray),0!==this.m_returnArray.length},e.prototype.isVisible=function(e){return this.screenBounds.intersects(e)},e}();t.ScreenCollisions=u;var l=function(e){function t(t){var n=e.call(this)||this;return n.m_renderContext=null,n.m_renderingEnabled=!1,n.m_numAllocations=0,n.m_numSuccessfulTests=0,n.m_numFailedTests=0,n.m_numSuccessfulVisibilityTests=0,n.m_numFailedVisibilityTests=0,void 0!==t&&null!==t&&(n.m_renderContext=t.getContext("2d")),n}return r(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0},t.prototype.update=function(t,n){this.m_renderingEnabled&&s.log("Allocations: "+this.m_numAllocations+" Successful Tests: "+this.m_numSuccessfulTests+" Failed Tests: "+this.m_numFailedTests+"  Successful Visibility Tests: "+this.m_numSuccessfulVisibilityTests+"  Failed Visibility Tests: "+this.m_numFailedVisibilityTests+" "),e.prototype.update.call(this,t,n),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=t,this.m_renderContext.canvas.height=n),this.m_renderingEnabled=o.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")},t.prototype.allocate=function(t){e.prototype.allocate.call(this,t),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(t.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.y-1,t.w,-t.h))},t.prototype.isAllocated=function(t){var n=e.prototype.isAllocated.call(this,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){var r=n?2:0;this.m_renderContext.strokeStyle=n?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(t.x-this.screenBounds.x-r,this.screenBounds.y+this.screenBounds.h-t.y-1+r,t.w+2*r,-t.h-2*r)}return n?this.m_numFailedTests++:this.m_numSuccessfulTests++,n},t.prototype.isVisible=function(t){var n=e.prototype.isVisible.call(this,t);return n?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,n},t}(u);t.ScreenCollisionsDebug=l},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4);n(11);var o=n(10),a=n(1),s=n(0),u=n(17),l=n(18),c=a.LoggerManager.instance.create("PoiManager"),d=function(){function e(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}return e.prototype.addPois=function(e,t){var n,o,u=a.assertExists(t.poiGeometries);try{for(var l=r(u),c=l.next();!c.done;c=l.next()){var d=c.value;a.assert(void 0!==d.technique);var h=a.assertExists(d.technique),f=t.techniques[h];if(("line-marker"===f.name||"labeled-icon"===f.name)&&!1!==f.showOnMap){var p=new s.BufferAttribute(new Float32Array(d.positions.buffer),d.positions.itemCount);if(i.isLineMarkerTechnique(f)&&p.count>0)this.addLineMarker(e,d,f,p);else{var m=f,v=m.imageTexture;if(void 0===d.stringCatalog)continue;for(var g=0;g<p.count;++g){var y=p.getX(g),_=p.getY(g);a.assert(d.texts.length>g);var b=d.stringCatalog[d.texts[g]];void 0===b&&(b=""),void 0!==d.stringCatalog&&void 0!==d.imageTextures&&d.imageTextures[g]>=0?(a.assert(d.imageTextures.length>g),v=d.stringCatalog[d.imageTextures[g]]):v=m.imageTexture;var x=this.checkCreateTextElement(b,f,v,0,d.featureId,y,_,e.tileKey.level);void 0!==x&&e.addTextElement(x)}}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}},e.prototype.addTextureAtlas=function(e,t){var n=this;fetch(t).then(function(e){if(!e.ok)throw new Error("addTextureAtlas: Cannot load textureAtlas: "+e.statusText);return e.json()}).then(function(i){var o,a;if(void 0!==i){try{c.log("addTextureAtlas: Loading textureAtlas '"+t+"' for image '"+e+"'");try{for(var s=r(Object.getOwnPropertyNames(i)),u=s.next();!u.done;u=s.next()){var l=u.value,d=i[l],h={name:l,image:e,xOffset:d.x,yOffset:d.y,width:d.width,height:d.height};n.addImageTexture(h)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}}catch(e){c.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)}n.mapView.update()}else c.info("addTextureAtlas: TextureAtlas empty: "+t)}).catch(function(e){c.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)})},e.prototype.addImageTexture=function(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&c.warn("addImageTexture: Name already used: "+e.name+" (overriding it)"),this.m_imageTextures.set(e.name,e)):c.error("addImageTexture: Name required",e)},e.prototype.getImageTexture=function(e){return this.m_imageTextures.get(e)},e.prototype.clear=function(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()},e.prototype.addLineMarker=function(e,t,n,r){var i,o=n.imageTexture;void 0!==t.stringCatalog&&void 0!==t.imageTextures&&(o=t.stringCatalog[t.imageTextures[0]],i=t.stringCatalog[t.texts[0]]),void 0===i&&(i="");var a=String(o)+"-"+i,u=this.m_poiShieldGroups.get(a);void 0===u&&(u=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(a,u));for(var l=[],c=0;c<r.count;c+=2)l.push(new s.Vector2(r.getX(c),r.getY(c)));var d=this.checkCreateTextElement(i,n,o,u,t.featureId,l,void 0,e.tileKey.level);void 0!==d&&(d.ignoreDistance=!0,e.addTextElement(d))},e.prototype.checkCreateTextElement=function(e,t,n,r,c,d,h,f){var p;if(void 0===e&&(e=""),void 0!==e){var m=void 0!==t.priority?t.priority:0;m+=.01*Math.random();var v=Array.isArray(d)?d:new s.Vector2(d,h);(p=new u.TextElement(e,v,m,void 0!==t.scale?t.scale:1,void 0!==t.xOffset?t.xOffset:0,void 0!==t.yOffset?t.yOffset:0,c,t.style,t.allCaps,t.smallCaps,t.bold,t.oblique,t.tracking,i.getPropertyValue(t.fadeNear,f),i.getPropertyValue(t.fadeFar,f))).mayOverlap=!0===t.textMayOverlap,p.reserveSpace=!1!==t.textReserveSpace,p.alwaysOnTop=!0===t.alwaysOnTop;var g=!0===t.textIsOptional,y=!1!==t.iconIsOptional,_=!(!1===t.renderTextDuringMovements),b=void 0===t.iconMayOverlap?p.textMayOverlap:!0===t.iconMayOverlap,x=void 0===t.iconReserveSpace?p.textReservesSpace:!1!==t.iconReserveSpace,w=void 0!==t.distanceScale?t.distanceScale:l.DEFAULT_TEXT_DISTANCE_SCALE;void 0!==n&&(p.poiInfo={technique:t,imageTextureName:n,shieldGroupIndex:r,textElement:p,textIsOptional:g,iconIsOptional:y,renderTextDuringMovements:_,mayOverlap:b,reserveSpace:x,featureId:c,iconMinZoomLevel:t.iconMinZoomLevel,iconMaxZoomLevel:t.iconMaxZoomLevel,textMinZoomLevel:t.textMinZoomLevel,textMaxZoomLevel:t.textMaxZoomLevel}),void 0!==t.color&&(p.color=new s.Color(t.color)),void 0===p.minZoomLevel&&(p.minZoomLevel=a.MathUtils.min2(t.iconMinZoomLevel,t.textMinZoomLevel)),void 0===p.maxZoomLevel&&(p.maxZoomLevel=a.MathUtils.max2(t.iconMaxZoomLevel,t.textMaxZoomLevel)),p.distanceScale=w,void 0===t.hAlignment||t.hAlignment!==o.TextHorizontalAlignmentStrings.Left&&t.hAlignment!==o.TextHorizontalAlignmentStrings.Center&&t.hAlignment!==o.TextHorizontalAlignmentStrings.Right||(p.horizontalAlignment=o.TextHorizontalAlignment[t.hAlignment]),void 0===t.vAlignment||t.vAlignment!==o.TextVerticalAlignmentStrings.Above&&t.vAlignment!==o.TextVerticalAlignmentStrings.Center&&t.vAlignment!==o.TextVerticalAlignmentStrings.Below||(p.verticalAlignment=o.TextVerticalAlignment[t.vAlignment])}return p},e}();t.PoiManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(125),i=n(60),o=function(){function e(){}return e.getTileDecoder=function(e,t){var n=this.getWorkerSet(t);return new i.WorkerBasedDecoder(n,e)},e.getWorkerSet=function(e){void 0===e&&(e=this.defaultScriptUrl);var t=this.workerSets[e];return void 0===t&&(t=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:this.defaultWorkerCount}),this.workerSets[e]=t),t},e.destroyWorkerSet=function(e){var t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])},e.destroy=function(){var e=this;Object.keys(this.workerSets).forEach(function(t){e.workerSets[t].destroy()}),this.workerSets={}},e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=void 0,e.workerSets={},e}();t.ConcurrentDecoderFacade=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=0,s=function(){function e(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=this.decoderServiceType+"-"+a++}return e.prototype.dispose=function(){this.m_serviceCreated&&this.workerSet.broadcastMessage({type:o.DecodedTileMessageName.DestroyService,service:o.WORKER_SERVICE_MANAGER_SERVICE_ID}),this.workerSet.removeReference()},e.prototype.connect=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.workerSet.connect(o.WORKER_SERVICE_MANAGER_SERVICE_ID)];case 1:return t.sent(),this.m_serviceCreated||(e={service:o.WORKER_SERVICE_MANAGER_SERVICE_ID,type:o.DecodedTileMessageName.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId},this.workerSet.broadcastMessage(e),this.m_serviceCreated=!0),[2]}})})},e.prototype.decodeTile=function(e,t,n){var r=t.mortonCode(),i={type:o.Requests.DecodeTileRequest,tileKey:r,data:e,projection:o.getProjectionName(n)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,i,a)},e.prototype.getTileInfo=function(e,t,n){var r=t.mortonCode(),i={type:o.Requests.TileInfoRequest,tileKey:r,data:e,projection:o.getProjectionName(n)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,i,a)},e.prototype.configure=function(e,t,n){var r={service:this.serviceId,type:o.DecodedTileMessageName.Configuration,styleSet:e,options:n,languages:t};this.workerSet.broadcastMessage(r)},e}();t.WorkerBasedDecoder=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(0),o=function(){function e(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new i.Fog(0),this.m_fogIsDefined=!1,this.m_cachedTheme={styles:{}}}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.m_enabled},set:function(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){this.m_cachedTheme=e,void 0!==e&&void 0!==e.sky&&void 0!==e.sky.colorBottom&&void 0!==e.fog&&void 0!==e.fog.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.sky.colorBottom),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())},e.prototype.update=function(e){null!==this.m_scene.fog&&void 0!==e.far&&void 0!==this.m_cachedTheme&&this.m_cachedTheme.fog&&void 0!==this.m_cachedTheme.fog.startRatio&&(this.m_fog.far=e.far,this.m_fog.near=e.far*this.m_cachedTheme.fog.startRatio)},e.prototype.add=function(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)},e.prototype.remove=function(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)},e.prototype.setFogInRawShaderMaterials=function(e){this.m_scene.traverse(function(t){if(t instanceof i.Mesh&&t.material instanceof i.Material&&t.material instanceof i.Material&&!(t.material instanceof r.HighPrecisionLineMaterial)){if(t.material instanceof r.SolidLineMaterial)t.material.updateFog(e);t.material.fog=e,t.material.needsUpdate=!0}})},e}();t.MapViewFog=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=o.LoggerManager.instance.create("Statistics"),s=function(){function e(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}return e.prototype.clear=function(){this.head=this.tail=this.size=0},e.prototype.enqOne=function(e){var t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)},e.prototype.enq=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var o=i(n),a=o.next();!a.done;a=o.next()){var s=a.value;this.enqOne(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.deq=function(){if(0===this.size)throw new Error("Ringbuffer underrun");var e=this.buffer[this.tail],t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e},e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.asArray=function(){for(var e=new Array,t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e},e}();t.RingBuffer=s,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_buffer=e,this.m_index=t}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]},enumerable:!0,configurable:!0}),e.prototype.next=function(){return this.m_index++,this.m_index<this.m_buffer.size},e}();e.Iterator=t}(s=t.RingBuffer||(t.RingBuffer={})),t.RingBuffer=s;var u=function(){function e(e,t){this.statistics=e,this.name=t,this.running=!1}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_currentValue},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e){this.m_currentValue=e},e.prototype.reset=function(){this.m_currentValue=void 0},e.prototype.start=function(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=o.PerformanceTimer.now()},e.prototype.stop=function(){if(!this.statistics.enabled)return-1;if(this.running){var e=o.PerformanceTimer.now()-(this.m_currentValue||0);return this.m_currentValue=e,this.setValue(e),this.running=!1,e}throw new Error("Timer '"+this.name+"' has not been started")},e.prototype.now=function(){if(!this.statistics.enabled)return-1;if(this.running)return o.PerformanceTimer.now()-(this.m_currentValue||0);throw new Error("Timer '"+this.name+"' has not been started")},e}();t.SimpleTimer=u;var l=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.statistics=t,r.name=n,r.numSamples=0,r.numResets=0,r.maxNumSamples=1e3,r.samples=new s(r.maxNumSamples),r}return r(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.updateStats(),this.samples.clear(),this.numResets++},t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),void 0!==t&&(this.samples.enqOne(t),this.numSamples++)},t.prototype.updateStats=function(){if(0!==this.samples.size){var e=this.samples.asArray();e.sort(function(e,t){return e-t});var t,n,r=e[0],i=e[e.length-1];if(1===e.length)n=t=e[0];else if(2===e.length)t=.5*e[0]+.5*e[1],n=e[1];else{var o=Math.floor(e.length/2);t=e.length%2==0?.5*e[o]+.5*e[o+1]:e[o],n=e[Math.floor(.95*e.length)]}for(var a=0,s=0,u=e.length;s<u;s++)a+=e[s];var l=a/e.length;this.min=r,this.max=i,this.avg=l,this.median=t,this.median95=n}},t}(u);t.SampledTimer=l;var c=function(){function e(e,t,n){if(this.statistics=e,this.name=t,this.stages=n,n.length<1)throw new Error("MultiStageTimer needs stages");n.forEach(function(t){if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var e=this;this.statistics.enabled&&this.stages.forEach(function(t){e.statistics.getTimer(t).reset()})},e.prototype.start=function(){return this.stage=this.stages[0],this.statistics.getTimer(this.stages[0]).value||-1},e.prototype.stop=function(){return this.stage=void 0,void 0!==this.value?this.value:-1},Object.defineProperty(e.prototype,"stage",{get:function(){return this.currentStage},set:function(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())},enumerable:!0,configurable:!0}),e}();t.MultiStageTimer=c;var d=function(){function e(e,t){void 0===t&&(t=!1),this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new u(this,"<null>")}return e.prototype.createTimer=function(e,t){void 0===t&&(t=!0);var n=t?new l(this,e):new u(this,e);return this.addTimer(n)},e.prototype.addTimer=function(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e},e.prototype.getTimer=function(e){if(!this.enabled)return this.nullTimer;var t=this.timers.get(e);return void 0===t?this.nullTimer:t},e.prototype.hasTimer=function(e){return void 0!==this.timers.get(e)},e.prototype.reset=function(){this.timers.forEach(function(e){e.reset()})},e.prototype.log=function(e,t){void 0===e&&void 0===this.name||a.log(void 0!==e?e:this.name);var n=0;this.timers.forEach(function(e){n=Math.max(n,e.name.length)});var r=function(e){return void 0!==e?e.toFixed(5):"?"};this.timers.forEach(function(e){var t=e.name+": "+" ".repeat(n-e.name.length);t+=r(e.value),e instanceof l&&(e.updateStats(),t+="  [ min="+r(e.min)+", max="+r(e.max)+", avg="+r(e.avg)+", med="+r(e.median)+", med95="+r(e.median95)+", N="+r(e.numSamples)+" ]"),a.log(t)}),void 0!==t&&a.log(t)},e}();t.Statistics=d},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),n(11);var a=n(1),s=function(){function e(){}return e.loadAsync=function(e){return r(this,void 0,void 0,function(){var t,n,r,s,u,l,c,d,h,f,p,m,v;return i(this,function(i){switch(i.label){case 0:return e=a.defaultUrlResolver(e),[4,fetch(e)];case 1:if(!(u=i.sent()).ok)throw new Error("ThemeLoader#loadAsync: cannot load theme: "+u.statusText);return[4,u.json()];case 2:if(null===(l=i.sent()))throw new Error("ThemeLoader#loadAsync: loaded resource is not valid JSON");if(c=a.composeUrlResolvers(function(t){return a.resolveReferenceUrl(e,t)},a.defaultUrlResolver),l.images)try{for(d=o(l.images),h=d.next();!h.done;h=d.next())(f=h.value).url=c(f.url),void 0!==f.atlas&&(f.atlas=c(f.atlas))}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}if(l.fontCatalogs)try{for(p=o(l.fontCatalogs),m=p.next();!m.done;m=p.next())(v=m.value).url=c(v.url)}catch(e){r={error:e}}finally{try{m&&!m.done&&(s=p.return)&&s.call(p)}finally{if(r)throw r.error}}return[2,l]}})})},e}();t.ThemeLoader=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(134),s=n(1),u=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};var l=function(){function e(e,t,n){this.object=e,this.geometryType=t,this.bufferGeometry=n,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,s.assert(!!e),"BufferGeometry"!==n.type&&u.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),s.assert("BufferGeometry"===n.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||u.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&u.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}return e.prototype.getCount=function(){return this.position.count},Object.defineProperty(e.prototype,"renderOrder",{get:function(){return this.object.renderOrder},enumerable:!0,configurable:!0}),e.prototype.setRange=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),s.assert(e>=0),s.assert(t>=0),s.assert(e<=t),this.start=e,this.end=t,this.startCapSize=n,this.endCapSize=r},Object.defineProperty(e.prototype,"color",{get:function(){var e,t,n=function(e){var t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){var n=e;if("SolidLineMaterial"===n.name)return n.uniforms.diffuse.value;u.warn("BufferedGeometryAccessor#color: unknown shader material name",n.name)}else u.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){var r=new Array,o=this.object.material;try{for(var a=i(o),s=a.next();!s.done;s=a.next()){var l=s.value;r.push(n(l))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}return n(this.object.material)},enumerable:!0,configurable:!0}),e}();t.BufferedGeometryAccessorBase=l;var c=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return o.object=t,o.geometryType=n,o.bufferGeometry=r,o.stride=i,o}return r(t,e),t.prototype.clear=function(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");for(var e=this.position.array,t=this.start*this.itemSize,n=this.end*this.itemSize,r=t;r<n;r++)e[r]=0;this.position.needsUpdate=!0},t.prototype.getVertices=function(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");var e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)},t.prototype.checkSetUp=function(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end},t}(l);t.BufferedGeometryAccessor=c;var d=function(e){function t(t,n,r){var i=e.call(this,t,n,r,3)||this;return i.object=t,i.geometryType=n,i.bufferGeometry=r,i}return r(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){s.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")},enumerable:!0,configurable:!0}),t}(c);t.BufferedGeometryLineAccessor=d;var h=function(e){function t(t,n,r){var i=e.call(this,t,n,r,1)||this;return i.object=t,i.geometryType=n,i.bufferGeometry=r,i}return r(t,e),t.prototype.isObject3dAccessor=function(){return!0},t.prototype.getVertices=function(){return e.prototype.getVertices.call(this)},t}(c);t.BufferedGeometryObject3dAccessor=h;var f=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,r)||this;return a.object=t,a.geometryType=n,a.bufferGeometry=r,a.indices=a.bufferGeometry.index.array,a.indices?a.indices instanceof Uint32Array||(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),s.assert(a.indices instanceof Uint32Array)):(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),s.assert(!!a.indices)),a}return r(t,e),t.prototype.getCount=function(){return this.indices.length},t.prototype.checkSetUp=function(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end},t}(l);t.IndexedBufferedGeometryAccessor=f;var p=function(e){function t(t,n,r){var i=e.call(this,t,n,r,3)||this;return i.object=t,i.geometryType=n,i.bufferGeometry=r,i}return r(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){if(s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===o.GeometryType.ExtrudedLine){var e=this.start+this.startCapSize,t=this.position.array;return a.reconstructLineWidth(t,e)}},enumerable:!0,configurable:!0}),t.prototype.clear=function(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");for(var e=this.start,t=this.end,n=e;n<t;n++)this.indices[n]=0;this.bufferGeometry.index.needsUpdate=!0},t.prototype.getVertices=function(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");var e=this.itemSize,t=this.start,n=this.end,r=new Float32Array((n-t)*e),i=this.position.array;if(2===e)for(var o=t,a=0;o<n;o++,a+=e){var u=this.indices[o];r[a+0]=i[u*e+0],r[a+1]=i[u*e+1]}if(3===e)for(o=t,a=0;o<n;o++,a+=e){u=this.indices[o];r[a+0]=i[u*e+0],r[a+1]=i[u*e+1],r[a+2]=i[u*e+2]}else for(o=t,a=0;o<n;o++,a++){u=this.indices[o];for(var l=0;l<e;l++)r[a*e+l]=i[u*e+l]}return r},t}(f);t.IndexedBufferedGeometryLineAccessor=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=new r.Vector3(0,0,1),o=[0,1,2,1,3,2],a=16,s=2*Math.PI/a;function u(e,t,n,r,i){var o=r.length/3;r.push(e,t,0);for(var u=0;u<a;++u)r.push(e+n*Math.cos(s*u),t+n*Math.sin(s*u),0),i.push(o,o+u+1,o+(u+1)%a+1)}t.numCirclePoints=function(e){return a},t.triangulateLine=function(e,t,n,a,s,l){if(void 0===s&&(s=!0),void 0===l&&(l=s),0!==e.length){s&&u(e[0],e[1],t,n,a);for(var c=n.length/3,d=new r.Vector3,h=new r.Vector3,f=new r.Vector3,p=new r.Vector3,m=new r.Vector3,v=new r.Vector3,g=new r.Vector3,y=e.length/2,_=0;_<y;++_)h.set(e[2*_],e[2*_+1],0),_+1<y?(f.set(e[2*(_+1)],e[2*(_+1)+1],0),p.copy(f).sub(h).normalize().cross(i),m.copy(p),_>0&&m.add(d).multiplyScalar(1-.5*p.dot(d)),v.copy(m).multiplyScalar(-t).add(h),g.copy(m).multiplyScalar(t).add(h),n.push(v.x,v.y,v.z,g.x,g.y,g.z),d.copy(p)):(v.copy(d).multiplyScalar(-t).add(h),g.copy(d).multiplyScalar(t).add(h),n.push(v.x,v.y,v.z,g.x,g.y,g.z));var b=function(e){o.forEach(function(t){return a.push(c+2*e+t)})};for(_=0;_<y-1;++_)b(_);l&&u(e[2*(y-1)],e[2*(y-1)+1],t,n,a)}},t.reconstructLine=function(e,t){for(var n=new Float32Array(e.length/2),r=3*t,i=2*r;r<n.length;r+=3,i+=6)n[r]=e[i]+.5*(e[i+3]-e[i]),n[r+1]=e[i+1]+.5*(e[i+3+1]-e[i+1]),n[r+2]=e[i+2]+.5*(e[i+3+2]-e[i+2]);return n},t.reconstructLineWidth=function(e,t){var n=e[2*t+3]-e[2*t],r=e[2*t+3+1]-e[2*t+1],i=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(n*n+r*r+i*i)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(0),a=n(31),s=function(e){function t(t,n,r,a,s){var u=e.call(this,void 0===t?new o.BufferGeometry:t,n)||this;return u.dimensionality=0,void 0===n&&(n=new i.HighPrecisionLineMaterial({color:a||i.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:i.HighPrecisionLineMaterial.DEFAULT_OPACITY})),u.matrixWorldInverse=new o.Matrix4,r&&u.setPositions(r),u}return r(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;if(0===this.dimensionality||void 0===this.dimensionality)throw new Error("HighPrecisionLine: positions not specified.");this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,n,r,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,r,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var n=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),n&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(o.Line);t.HighPrecisionWireFrameLine=s;var u=function(e){function t(t,n,r,a,s){var u=e.call(this,void 0===t?new o.BufferGeometry:t,n)||this;return u.dimensionality=0,void 0===n&&(n=new i.HighPrecisionLineMaterial({color:a||i.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:i.HighPrecisionLineMaterial.DEFAULT_OPACITY})),u.matrixWorldInverse=new o.Matrix4,r&&u.setPositions(r),u}return r(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e,t){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e,t)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,n,r,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,r,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var n=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),n&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(o.Mesh);t.HighPrecisionLine=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o,a=n(2),s=n(7),u=n(0),l=n(68);!function(e){e[e.NONE=0]="NONE",e[e.PAN=1]="PAN",e[e.ROTATE=2]="ROTATE",e[e.ORBIT=3]="ORBIT"}(i||(i={})),function(e){e.Update="update",e.BeginInteraction="begin-interaction",e.EndInteraction="end-interaction"}(o=t.EventNames||(t.EventNames={}));var c={type:o.Update},d={type:o.BeginInteraction},h={type:o.EndInteraction},f=new u.Quaternion,p=new u.Quaternion,m=new u.Vector3(0,0,1),v=new u.Vector3(1,0,0),g=function(e){function t(t){var n=e.call(this)||this;return n.mapView=t,n.rotationMouseDeltaFactor=.1,n.orbitingMouseDeltaFactor=.1,n.orbitingTouchDeltaFactor=.1,n.enabled=!0,n.tiltEnabled=!0,n.rotateEnabled=!0,n.zoomLevelDeltaOnMouseWheel=.2,n.minZoomLevel=0,n.maxZoomLevel=20,n.minCameraHeight=3,n.m_currentViewDirection=new u.Vector3,n.m_lastMousePosition=new u.Vector2(0,0),n.m_state=i.NONE,n.m_minPitchAngle=0,n.m_maxPitchAngle=Math.PI,n.m_touchState={touches:[],currentRotation:0,initialRotation:0},n.dispose=function(){},n.camera=t.camera,n.domElement=t.renderer.domElement,n.maxZoomLevel=t.maxZoomLevel,n.minZoomLevel=t.minZoomLevel,n.minCameraHeight=t.minCameraHeight,n.bindInputEvents(n.domElement),n}return r(t,e),t.create=function(e){return new t(e)},t.prototype.rotate=function(e,t){var n=s.MapViewUtils.extractYawPitchRoll(this.camera.quaternion),r=n.yaw;this.rotateEnabled&&(r-=a.MathUtils.degToRad(e)),f.setFromAxisAngle(m,r);var i=a.MathUtils.degToRad(t),o=this.constrainPitchAngle(n.pitch,i);p.setFromAxisAngle(v,o),f.multiply(p),this.mapView.camera.quaternion.copy(f),this.mapView.camera.matrixWorldNeedsUpdate=!0},Object.defineProperty(t.prototype,"yawPitchRoll",{get:function(){var e=s.MapViewUtils.extractYawPitchRoll(this.camera.quaternion);return{yaw:a.MathUtils.radToDeg(e.yaw),pitch:a.MathUtils.radToDeg(e.pitch),roll:a.MathUtils.radToDeg(e.roll)}},enumerable:!0,configurable:!0}),t.prototype.orbitFocusPoint=function(e,t){this.mapView.camera.getWorldDirection(this.m_currentViewDirection);var n=l.directionToAzimuthAltitude(this.m_currentViewDirection),r=1/Math.sin(n.altitude)*this.mapView.camera.position.z,i=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,0,0),o=this.getMinDelta(t);this.rotate(e,o),this.mapView.camera.getWorldDirection(this.m_currentViewDirection);var a=l.directionToAzimuthAltitude(this.m_currentViewDirection),u=Math.sin(a.altitude)*r;this.mapView.camera.position.z=u;var c=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,0,0);if(i&&c){var d=i.sub(c);s.MapViewUtils.pan(this.mapView,d.x,d.y)}else this.updateMapView()},t.prototype.moveAlongTheViewDirection=function(e){this.mapView.camera.getWorldDirection(this.m_currentViewDirection),this.m_currentViewDirection.multiplyScalar(e),this.mapView.camera.position.z+=this.m_currentViewDirection.z,this.mapView.worldCenter.x+=this.m_currentViewDirection.x,this.mapView.worldCenter.y+=this.m_currentViewDirection.y,this.updateMapView()},t.prototype.setRotation=function(e,t){s.MapViewUtils.setRotation(this.mapView,e,t)},t.prototype.zoomOnTargetPosition=function(e,t,n){s.MapViewUtils.zoomOnTargetPosition(this.mapView,e,t,n)},Object.defineProperty(t.prototype,"cameraHeight",{get:function(){return this.mapView.camera.position.z},set:function(e){this.camera.position.setZ(e),this.camera.matrixWorldNeedsUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPitchAngle",{get:function(){return a.MathUtils.radToDeg(this.m_maxPitchAngle)},set:function(e){this.m_maxPitchAngle=a.MathUtils.degToRad(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPitchAngle",{get:function(){return a.MathUtils.radToDeg(this.m_minPitchAngle)},set:function(e){this.m_minPitchAngle=a.MathUtils.degToRad(e)},enumerable:!0,configurable:!0}),t.prototype.bindInputEvents=function(e){var t=this.contextMenu.bind(this),n=this.mouseDown.bind(this),r=this.mouseWheel.bind(this),i=this.touchStart.bind(this),o=this.touchEnd.bind(this),a=this.touchMove.bind(this);e.addEventListener("contextmenu",t,!1),e.addEventListener("mousedown",n,!1),e.addEventListener("wheel",r,!1),e.addEventListener("touchstart",i,!1),e.addEventListener("touchend",o,!1),e.addEventListener("touchmove",a,!1),this.dispose=function(){e.removeEventListener("contextmenu",t,!1),e.removeEventListener("mousedown",n,!1),e.removeEventListener("wheel",r,!1),e.removeEventListener("touchstart",i,!1),e.removeEventListener("touchend",o,!1),e.removeEventListener("touchmove",a,!1)}},t.prototype.updateMapView=function(){this.dispatchEvent(c),this.mapView.update()},t.prototype.mouseDown=function(e){if(!1!==this.enabled&&!e.shiftKey&&!e.ctrlKey&&(e.preventDefault(),e.stopPropagation(),this.m_state===i.NONE)){if(0===e.button)this.m_state=i.PAN;else if(1===e.button&&this.tiltEnabled)this.m_state=i.ORBIT;else{if(2!==e.button)return;this.m_state=i.ROTATE}this.dispatchEvent(d),this.m_lastMousePosition.setX(e.offsetX),this.m_lastMousePosition.setY(e.offsetY),this.mapView.beginAnimation();var t=this.mouseMove.bind(this),n=this.mouseUp.bind(this);document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",n,!1),this.m_cleanupMouseEventListeners=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)}}},t.prototype.mouseMove=function(e){!1!==this.enabled&&(this.m_state===i.PAN?this.panFromTo(this.m_lastMousePosition.x,this.m_lastMousePosition.y,this.m_lastMousePosition.x+e.movementX,this.m_lastMousePosition.y+e.movementY):this.m_state===i.ROTATE?this.rotate(-this.rotationMouseDeltaFactor*e.movementX,this.rotationMouseDeltaFactor*e.movementY):this.m_state===i.ORBIT&&this.orbitFocusPoint(this.orbitingMouseDeltaFactor*e.movementX,-this.orbitingMouseDeltaFactor*e.movementY),this.m_lastMousePosition.setX(this.m_lastMousePosition.x+e.movementX),this.m_lastMousePosition.setY(this.m_lastMousePosition.y+e.movementY),this.updateMapView(),e.preventDefault(),e.stopPropagation())},t.prototype.mouseUp=function(e){!1!==this.enabled&&(this.mapView.endAnimation(),this.updateMapView(),e.preventDefault(),e.stopPropagation(),this.m_state=i.NONE,this.m_cleanupMouseEventListeners&&this.m_cleanupMouseEventListeners(),this.dispatchEvent(h))},t.prototype.mouseWheel=function(e){if(!1!==this.enabled){var t=s.MapViewUtils.calculateZoomLevelFromHeight(this.mapView.camera.position.z,this.mapView)+(e.deltaY>0?-this.zoomLevelDeltaOnMouseWheel:this.zoomLevelDeltaOnMouseWheel);t=Math.max(Math.min(t,this.maxZoomLevel),this.minZoomLevel);var n=l.getWidthAndHeightFromCanvas(this.domElement),r=n.width,i=n.height,o=l.calculateNormalizedScreenCoordinates(e.offsetX,e.offsetY,r,i);s.MapViewUtils.zoomOnTargetPosition(this.mapView,o.x,o.y,t),this.updateMapView(),e.preventDefault(),e.stopPropagation()}},t.prototype.calculateAngleFromTouchPointsInWorldspace=function(){if(this.m_touchState.touches.length<2)return 0;var e=this.m_touchState.touches[1].currentWorldPosition.x-this.m_touchState.touches[0].currentWorldPosition.x,t=this.m_touchState.touches[1].currentWorldPosition.y-this.m_touchState.touches[0].currentWorldPosition.y;return Math.atan2(t,e)},t.prototype.calculatePinchDistanceInWorldSpace=function(){if(this.m_touchState.touches.length<2)return 0;var e=this.m_touchState.touches[0].initialWorldPosition.clone().sub(this.m_touchState.touches[1].initialWorldPosition).length();return this.m_touchState.touches[0].currentWorldPosition.clone().sub(this.m_touchState.touches[1].currentWorldPosition).length()-e},t.prototype.convertTouchPoint=function(e){var t=new u.Vector2(e.pageX,e.pageY),n=l.getWidthAndHeightFromCanvas(this.domElement),r=n.width,i=n.height,o=l.calculateNormalizedScreenCoordinates(t.x,t.y,r,i),a=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,o.x,o.y);return a?{currentTouchPoint:t.clone(),lastTouchPoint:t.clone(),currentWorldPosition:a.clone(),initialWorldPosition:a.clone()}:null},t.prototype.setTouchState=function(e){this.m_touchState.touches=[];for(var t=0;t<e.length;++t){var n=this.convertTouchPoint(e[t]);n&&this.m_touchState.touches.push(n)}0!==this.m_touchState.touches.length&&(this.updateTouchState(),this.m_touchState.initialRotation=this.m_touchState.currentRotation)},t.prototype.updateTouchState=function(){this.m_touchState.currentRotation=this.calculateAngleFromTouchPointsInWorldspace()},t.prototype.updateTouches=function(e){for(var t=Math.min(e.length,this.m_touchState.touches.length),n=0;n<t;++n){var r=this.m_touchState.touches[n],i=this.convertTouchPoint(e[n]);i&&(i.initialWorldPosition=r.initialWorldPosition,i.lastTouchPoint=r.currentTouchPoint,this.m_touchState.touches[n]=i)}},t.prototype.touchStart=function(e){!1!==this.enabled&&(this.setTouchState(e.touches),this.mapView.beginAnimation(),e.preventDefault(),e.stopPropagation())},t.prototype.touchMove=function(e){if(!1!==this.enabled){if(this.updateTouches(e.touches),this.updateTouchState(),this.m_touchState.touches.length<=2){var t=this.m_touchState.touches[0].currentWorldPosition.clone(),n=this.m_touchState.touches[0].initialWorldPosition.clone().sub(t);s.MapViewUtils.pan(this.mapView,n.x,n.y)}if(2===this.m_touchState.touches.length){var r=this.m_touchState.currentRotation-this.m_touchState.initialRotation;this.rotate(a.MathUtils.radToDeg(r),0),this.moveAlongTheViewDirection(this.calculatePinchDistanceInWorldSpace())}if(3===this.m_touchState.touches.length&&this.tiltEnabled){var i=this.m_touchState.touches[0],o=i.lastTouchPoint.clone().sub(i.currentTouchPoint);this.orbitFocusPoint(this.orbitingTouchDeltaFactor*o.x,this.orbitingTouchDeltaFactor*o.y)}this.updateMapView(),e.preventDefault(),e.stopPropagation()}},t.prototype.touchEnd=function(e){!1!==this.enabled&&(this.setTouchState(e.touches),this.mapView.endAnimation(),this.updateMapView(),e.preventDefault(),e.stopPropagation())},t.prototype.contextMenu=function(e){e.preventDefault()},t.prototype.panFromTo=function(e,t,n,r){var i=l.getWidthAndHeightFromCanvas(this.domElement),o=i.width,a=i.height,u=l.calculateNormalizedScreenCoordinates(e,t,o,a),c=l.calculateNormalizedScreenCoordinates(n,r,o,a),d=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y),h=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,u.x,u.y);if(d&&h){var f=h.sub(d);s.MapViewUtils.pan(this.mapView,f.x,f.y)}},t.prototype.constrainPitchAngle=function(e,t){var n=a.MathUtils.clamp(e+t,this.m_minPitchAngle,this.m_maxPitchAngle);return this.tiltEnabled&&n<=this.m_maxPitchAngle&&n>=this.m_minPitchAngle&&(e=n),e},t.prototype.getMinDelta=function(e){var t=this;if(this.mapView.camera.position.z<this.minCameraHeight&&e>0)return 0;for(var n=function(e,n){var r=n.position,i=n.quaternion,o=new u.Quaternion,c=new u.Vector3,d=new u.Object3D;d.position.set(r.x,r.y,r.z),d.quaternion.set(i.x,i.y,i.z,i.w),d.getWorldDirection(c);var h=l.directionToAzimuthAltitude(c),f=1/Math.sin(h.altitude)*d.position.z,p=s.MapViewUtils.extractYawPitchRoll(d.quaternion),m=a.MathUtils.degToRad(e),g=t.constrainPitchAngle(p.pitch,m);o.setFromAxisAngle(v,g),d.quaternion.copy(o),d.matrixWorldNeedsUpdate=!0,d.getWorldDirection(c);var y=l.directionToAzimuthAltitude(c);return Math.sin(y.altitude)*f},r=e,i=0;i<10;i++){if(!(n(r,this.mapView.camera)<this.minCameraHeight))return r;r*=.5}return r},t}(u.EventDispatcher);t.MapControls=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e,t){if(null===e||void 0===e||""===e)return t;if(!e.match(o))return t;var n=Number.parseInt(e,10);return isNaN(n)?t:n}t.calculateNormalizedScreenCoordinates=function(e,t,n,i){return new r.Vector2(e/n*2-1,-t/i*2+1)},t.directionToAzimuthAltitude=function(e){var t=e.clone().normalize(),n=new r.Vector2(t.x,t.y),i=new r.Vector2(n.length(),t.z).normalize();return{azimuth:Math.atan2(n.x,n.y),altitude:-Math.asin(i.y)}},t.azimuthAltitudeToDirection=function(e,t){e=e,t=t;var n=new r.Vector3,i=Math.cos(t);return n.setX(Math.sin(e)*i),n.setY(Math.cos(e)*i),n.setZ(Math.sin(t)),n},t.safeParseDecimalInt=i;var o=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:i(e.style.width,e.clientWidth),height:i(e.style.height,e.clientHeight)}}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,l=[],c=!1,d=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):d=-1,l.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),n(11);var i=n(7),o=n(1).LoggerManager.instance.create("TileLoader"),a=function(){function e(e,t,n,r){this.dataSource=e,this.tileKey=t,this.dataProvider=n,this.tileDecoder=r,this.state=i.TileLoaderState.Initialized,this.loadAbortController=new AbortController}return e.prototype.loadAndDecode=function(){switch(this.state){case i.TileLoaderState.Loading:return this.donePromise;case i.TileLoaderState.Disposed:return o.warn("cannot load in disposed state"),Promise.resolve(i.TileLoaderState.Disposed);case i.TileLoaderState.Ready:case i.TileLoaderState.Failed:case i.TileLoaderState.Initialized:case i.TileLoaderState.Canceled:return this.ensureLoadingStarted(),this.donePromise;case i.TileLoaderState.Loaded:return this.startDecodeTile(),this.donePromise;case i.TileLoaderState.Decoding:return this.cancelDecoding(),this.ensureLoadingStarted(),this.donePromise}},e.prototype.waitSettled=function(){return this.donePromise?this.donePromise:Promise.resolve(this.state)},e.prototype.cancel=function(){switch(this.state){case i.TileLoaderState.Disposed:return void o.warn("attempting to cancel disposed TileLoader");case i.TileLoaderState.Loading:this.loadAbortController.abort(),this.loadAbortController=new AbortController;break;case i.TileLoaderState.Decoding:this.decodeAbortController&&(this.decodeAbortController.abort(),this.decodeAbortController=void 0)}this.onDone(i.TileLoaderState.Canceled)},e.prototype.dispose=function(){this.state!==i.TileLoaderState.Disposed&&(this.cancel(),this.state=i.TileLoaderState.Disposed)},e.prototype.isFinished=function(){return this.state===i.TileLoaderState.Ready||this.state===i.TileLoaderState.Canceled||this.state===i.TileLoaderState.Failed},e.prototype.ensureLoadingStarted=function(){switch(this.state){case i.TileLoaderState.Ready:case i.TileLoaderState.Initialized:case i.TileLoaderState.Canceled:return void this.doStartLoad();case i.TileLoaderState.Loading:case i.TileLoaderState.Loaded:return void o.info("reusing already started load operation");case i.TileLoaderState.Decoding:return this.cancelDecoding(),void this.doStartLoad();case i.TileLoaderState.Disposed:return void o.warn("cannot load in disposed state")}},e.prototype.doStartLoad=function(){var e=this,t=this.loadAbortController.signal;this.dataProvider.getTile(this.tileKey,t).then(function(n){if(t.aborted){var r=new Error("Aborted");throw r.name="AbortError",r}e.onLoaded(n)}).catch(function(t){"AbortError"!==t.name&&e.onError(t)}),void 0===this.donePromise&&(this.donePromise=new Promise(function(t){e.resolveDonePromise=t})),this.state=i.TileLoaderState.Loading},e.prototype.onLoaded=function(e){this.state=i.TileLoaderState.Loaded,this.payload=e,(void 0===e.byteLength||0!==e.byteLength)&&e!=={}?this.startDecodeTile():this.onDone(i.TileLoaderState.Ready)},e.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=i.TileLoaderState.Decoding,this.payload=void 0;var n=new AbortController;this.decodeAbortController=n;var r=this.dataSource;this.tileDecoder.decodeTile(t,this.tileKey,r.projection).then(function(t){n.signal.aborted||e.onDecoded(t)}).catch(function(t){"AbortError"!==t.name&&e.onError(t)})}else o.error("TileLoader#startDecodeTile: Cannot decode without payload")},e.prototype.onDecoded=function(e){this.decodedTile=e,this.onDone(i.TileLoaderState.Ready)},e.prototype.cancelDecoding=function(){void 0!==this.decodeAbortController&&(this.decodeAbortController.abort(),this.decodeAbortController=void 0)},e.prototype.onDone=function(e){this.resolveDonePromise&&(this.resolveDonePromise(e),this.resolveDonePromise=void 0,this.donePromise=void 0),this.state=e},e.prototype.onError=function(e){var t=this.dataSource;o.error("["+t.name+"]: failed to load tile "+this.tileKey.toHereTile(),e),this.error=e,this.onDone(i.TileLoaderState.Failed)},e}();t.TileLoader=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=i.TileLoaderState.Decoding,this.payload=void 0;var n=new AbortController;this.decodeAbortController=n;var r=this.dataSource;this.tileDecoder.getTileInfo(t,this.tileKey,r.projection).then(function(t){n.signal.aborted||(e.tileInfo=t,e.onDone(i.TileLoaderState.Ready))}).catch(function(t){"AbortError"!==t.name&&e.onError(t)})}else o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload")},t}(a);t.TileInfoLoader=s},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";var r=n(5),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,i,o,a,s=e.length,u=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return u(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,o,s=t||e.length,l=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)l[r++]=i;else if((o=a[i])>4)l[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&e[n++],o--;o>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return u(l,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(67)),r(n(137)),r(n(68)),r(n(138))},function(e,t,n){(function(t){!function(){var t={};e.exports=t,function(e,t){e.toRGBA8=function(t){var n=t.width,r=t.height;if(null==t.tabs.acTL)return[e.toRGBA8.decodeImage(t.data,n,r,t).buffer];var i=[];null==t.frames[0].data&&(t.frames[0].data=t.data);for(var o,a=new Uint8Array(n*r*4),s=0;s<t.frames.length;s++){var u=t.frames[s],l=u.rect.x,c=u.rect.y,d=u.rect.width,h=u.rect.height,f=e.toRGBA8.decodeImage(u.data,d,h,t);if(0==s?o=f:0==u.blend?e._copyTile(f,d,h,o,n,r,l,c,0):1==u.blend&&e._copyTile(f,d,h,o,n,r,l,c,1),i.push(o.buffer),o=o.slice(0),0==u.dispose);else if(1==u.dispose)e._copyTile(a,d,h,o,n,r,l,c,0);else if(2==u.dispose){for(var p=s-1;2==t.frames[p].dispose;)p--;o=new Uint8Array(i[p]).slice(0)}}return i},e.toRGBA8.decodeImage=function(t,n,r,i){var o=n*r,a=e.decode._getBPP(i),s=Math.ceil(n*a/8),u=new Uint8Array(4*o),l=new Uint32Array(u.buffer),c=i.ctype,d=i.depth,h=e._bin.readUshort;if(6==c){var f=o<<2;if(8==d)for(var p=0;p<f;p++)u[p]=t[p];if(16==d)for(p=0;p<f;p++)u[p]=t[p<<1]}else if(2==c){var m=i.tabs.tRNS,v=-1,g=-1,y=-1;if(m&&(v=m[0],g=m[1],y=m[2]),8==d)for(p=0;p<o;p++){var _=3*p;u[S=p<<2]=t[_],u[S+1]=t[_+1],u[S+2]=t[_+2],u[S+3]=255,-1!=v&&t[_]==v&&t[_+1]==g&&t[_+2]==y&&(u[S+3]=0)}if(16==d)for(p=0;p<o;p++){_=6*p;u[S=p<<2]=t[_],u[S+1]=t[_+2],u[S+2]=t[_+4],u[S+3]=255,-1!=v&&h(t,_)==v&&h(t,_+2)==g&&h(t,_+4)==y&&(u[S+3]=0)}}else if(3==c){var b=i.tabs.PLTE,x=i.tabs.tRNS,w=x?x.length:0;if(1==d)for(var T=0;T<r;T++){var C=T*s,E=T*n;for(p=0;p<n;p++){var S=E+p<<2,A=3*(P=t[C+(p>>3)]>>7-((7&p)<<0)&1);u[S]=b[A],u[S+1]=b[A+1],u[S+2]=b[A+2],u[S+3]=P<w?x[P]:255}}if(2==d)for(T=0;T<r;T++)for(C=T*s,E=T*n,p=0;p<n;p++){S=E+p<<2,A=3*(P=t[C+(p>>2)]>>6-((3&p)<<1)&3);u[S]=b[A],u[S+1]=b[A+1],u[S+2]=b[A+2],u[S+3]=P<w?x[P]:255}if(4==d)for(T=0;T<r;T++)for(C=T*s,E=T*n,p=0;p<n;p++){S=E+p<<2,A=3*(P=t[C+(p>>1)]>>4-((1&p)<<2)&15);u[S]=b[A],u[S+1]=b[A+1],u[S+2]=b[A+2],u[S+3]=P<w?x[P]:255}if(8==d)for(p=0;p<o;p++){var P;S=p<<2,A=3*(P=t[p]);u[S]=b[A],u[S+1]=b[A+1],u[S+2]=b[A+2],u[S+3]=P<w?x[P]:255}}else if(4==c){if(8==d)for(p=0;p<o;p++){S=p<<2;var M=t[O=p<<1];u[S]=M,u[S+1]=M,u[S+2]=M,u[S+3]=t[O+1]}if(16==d)for(p=0;p<o;p++){var O;S=p<<2,M=t[O=p<<2];u[S]=M,u[S+1]=M,u[S+2]=M,u[S+3]=t[O+2]}}else if(0==c){v=i.tabs.tRNS?i.tabs.tRNS:-1;if(1==d)for(p=0;p<o;p++){var L=(M=255*(t[p>>3]>>7-(7&p)&1))==255*v?0:255;l[p]=L<<24|M<<16|M<<8|M}if(2==d)for(p=0;p<o;p++){L=(M=85*(t[p>>2]>>6-((3&p)<<1)&3))==85*v?0:255;l[p]=L<<24|M<<16|M<<8|M}if(4==d)for(p=0;p<o;p++){L=(M=17*(t[p>>1]>>4-((1&p)<<2)&15))==17*v?0:255;l[p]=L<<24|M<<16|M<<8|M}if(8==d)for(p=0;p<o;p++){L=(M=t[p])==v?0:255;l[p]=L<<24|M<<16|M<<8|M}if(16==d)for(p=0;p<o;p++){M=t[p<<1],L=h(t,p<<1)==v?0:255;l[p]=L<<24|M<<16|M<<8|M}}return u},e.decode=function(t){for(var n,r=new Uint8Array(t),i=8,o=e._bin,a=o.readUshort,s=o.readUint,u={tabs:{},frames:[]},l=new Uint8Array(r.length),c=0,d=0,h=[137,80,78,71,13,10,26,10],f=0;f<8;f++)if(r[f]!=h[f])throw"The input is not a PNG file!";for(;i<r.length;){var p=o.readUint(r,i);i+=4;var m=o.readASCII(r,i,4);if(i+=4,"IHDR"==m)e.decode._IHDR(r,i,u);else if("IDAT"==m){for(f=0;f<p;f++)l[c+f]=r[i+f];c+=p}else if("acTL"==m)u.tabs[m]={num_frames:s(r,i),num_plays:s(r,i+4)},n=new Uint8Array(r.length);else if("fcTL"==m){if(0!=d)(C=u.frames[u.frames.length-1]).data=e.decode._decompress(u,n.slice(0,d),C.rect.width,C.rect.height),d=0;var v={x:s(r,i+12),y:s(r,i+16),width:s(r,i+4),height:s(r,i+8)},g=a(r,i+22);g=a(r,i+20)/(0==g?100:g);var y={rect:v,delay:Math.round(1e3*g),dispose:r[i+24],blend:r[i+25]};u.frames.push(y)}else if("fdAT"==m){for(f=0;f<p-4;f++)n[d+f]=r[i+f+4];d+=p-4}else if("pHYs"==m)u.tabs[m]=[o.readUint(r,i),o.readUint(r,i+4),r[i+8]];else if("cHRM"==m){u.tabs[m]=[];for(f=0;f<8;f++)u.tabs[m].push(o.readUint(r,i+4*f))}else if("tEXt"==m){null==u.tabs[m]&&(u.tabs[m]={});var _=o.nextZero(r,i),b=o.readASCII(r,i,_-i),x=o.readASCII(r,_+1,i+p-_-1);u.tabs[m][b]=x}else if("iTXt"==m){null==u.tabs[m]&&(u.tabs[m]={});_=0;var w=i;_=o.nextZero(r,w);b=o.readASCII(r,w,_-w),r[w=_+1],r[w+1];w+=2,_=o.nextZero(r,w);o.readASCII(r,w,_-w);w=_+1,_=o.nextZero(r,w);o.readUTF8(r,w,_-w);w=_+1;x=o.readUTF8(r,w,p-(w-i));u.tabs[m][b]=x}else if("PLTE"==m)u.tabs[m]=o.readBytes(r,i,p);else if("hIST"==m){var T=u.tabs.PLTE.length/3;u.tabs[m]=[];for(f=0;f<T;f++)u.tabs[m].push(a(r,i+2*f))}else if("tRNS"==m)3==u.ctype?u.tabs[m]=o.readBytes(r,i,p):0==u.ctype?u.tabs[m]=a(r,i):2==u.ctype&&(u.tabs[m]=[a(r,i),a(r,i+2),a(r,i+4)]);else if("gAMA"==m)u.tabs[m]=o.readUint(r,i)/1e5;else if("sRGB"==m)u.tabs[m]=r[i];else if("bKGD"==m)0==u.ctype||4==u.ctype?u.tabs[m]=[a(r,i)]:2==u.ctype||6==u.ctype?u.tabs[m]=[a(r,i),a(r,i+2),a(r,i+4)]:3==u.ctype&&(u.tabs[m]=r[i]);else if("IEND"==m){var C;if(0!=d)(C=u.frames[u.frames.length-1]).data=e.decode._decompress(u,n.slice(0,d),C.rect.width,C.rect.height),d=0;u.data=e.decode._decompress(u,l,u.width,u.height);break}i+=p;o.readUint(r,i);i+=4}return delete u.compress,delete u.interlace,delete u.filter,u},e.decode._decompress=function(t,n,r,i){return 0==t.compress&&(n=e.decode._inflate(n)),0==t.interlace?n=e.decode._filterZero(n,t,0,r,i):1==t.interlace&&(n=e.decode._readInterlace(n,t)),n},e.decode._inflate=function(e){return t.inflate(e)},e.decode._readInterlace=function(t,n){for(var r=n.width,i=n.height,o=e.decode._getBPP(n),a=o>>3,s=Math.ceil(r*o/8),u=new Uint8Array(i*s),l=0,c=[0,0,4,0,2,0,1],d=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],f=[8,8,4,4,2,2,1],p=0;p<7;){for(var m=h[p],v=f[p],g=0,y=0,_=c[p];_<i;)_+=m,y++;for(var b=d[p];b<r;)b+=v,g++;var x=Math.ceil(g*o/8);e.decode._filterZero(t,n,l,g,y);for(var w=0,T=c[p];T<i;){for(var C=d[p],E=l+w*x<<3;C<r;){var S;if(1==o)S=(S=t[E>>3])>>7-(7&E)&1,u[T*s+(C>>3)]|=S<<7-((3&C)<<0);if(2==o)S=(S=t[E>>3])>>6-(7&E)&3,u[T*s+(C>>2)]|=S<<6-((3&C)<<1);if(4==o)S=(S=t[E>>3])>>4-(7&E)&15,u[T*s+(C>>1)]|=S<<4-((1&C)<<2);if(o>=8)for(var A=T*s+C*a,P=0;P<a;P++)u[A+P]=t[(E>>3)+P];E+=o,C+=v}w++,T+=m}g*y!=0&&(l+=y*(1+x)),p+=1}return u},e.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},e.decode._filterZero=function(t,n,r,i,o){var a=e.decode._getBPP(n),s=Math.ceil(i*a/8),u=e.decode._paeth;a=Math.ceil(a/8);for(var l=0;l<o;l++){var c=r+l*s,d=c+l+1,h=t[d-1];if(0==h)for(var f=0;f<s;f++)t[c+f]=t[d+f];else if(1==h){for(f=0;f<a;f++)t[c+f]=t[d+f];for(f=a;f<s;f++)t[c+f]=t[d+f]+t[c+f-a]&255}else if(0==l){for(f=0;f<a;f++)t[c+f]=t[d+f];if(2==h)for(f=a;f<s;f++)t[c+f]=255&t[d+f];if(3==h)for(f=a;f<s;f++)t[c+f]=t[d+f]+(t[c+f-a]>>1)&255;if(4==h)for(f=a;f<s;f++)t[c+f]=t[d+f]+u(t[c+f-a],0,0)&255}else{if(2==h)for(f=0;f<s;f++)t[c+f]=t[d+f]+t[c+f-s]&255;if(3==h){for(f=0;f<a;f++)t[c+f]=t[d+f]+(t[c+f-s]>>1)&255;for(f=a;f<s;f++)t[c+f]=t[d+f]+(t[c+f-s]+t[c+f-a]>>1)&255}if(4==h){for(f=0;f<a;f++)t[c+f]=t[d+f]+u(0,t[c+f-s],0)&255;for(f=a;f<s;f++)t[c+f]=t[d+f]+u(t[c+f-a],t[c+f-s],t[c+f-a-s])&255}}}return t},e.decode._paeth=function(e,t,n){var r=e+t-n,i=Math.abs(r-e),o=Math.abs(r-t),a=Math.abs(r-n);return i<=o&&i<=a?e:o<=a?t:n},e.decode._IHDR=function(t,n,r){var i=e._bin;r.width=i.readUint(t,n),n+=4,r.height=i.readUint(t,n),n+=4,r.depth=t[n],n++,r.ctype=t[n],n++,r.compress=t[n],n++,r.filter=t[n],n++,r.interlace=t[n],n++},e._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},readBytes:function(e,t,n){for(var r=[],i=0;i<n;i++)r.push(e[t+i]);return r},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,n,r){for(var i,o="",a=0;a<r;a++)o+="%"+e._bin.pad(t[n+a].toString(16));try{i=decodeURIComponent(o)}catch(i){return e._bin.readASCII(t,n,r)}return i}},e._copyTile=function(e,t,n,r,i,o,a,s,u){for(var l=Math.min(t,i),c=Math.min(n,o),d=0,h=0,f=0;f<c;f++)for(var p=0;p<l;p++)if(a>=0&&s>=0?(d=f*t+p<<2,h=(s+f)*i+a+p<<2):(d=(-s+f)*t-a+p<<2,h=f*i+p<<2),0==u)r[h]=e[d],r[h+1]=e[d+1],r[h+2]=e[d+2],r[h+3]=e[d+3];else if(1==u){var m=e[d+3]*(1/255),v=e[d]*m,g=e[d+1]*m,y=e[d+2]*m,_=r[h+3]*(1/255),b=r[h]*_,x=r[h+1]*_,w=r[h+2]*_,T=1-m,C=m+_*T,E=0==C?0:1/C;r[h+3]=255*C,r[h+0]=(v+b*T)*E,r[h+1]=(g+x*T)*E,r[h+2]=(y+w*T)*E}else if(2==u){m=e[d+3],v=e[d],g=e[d+1],y=e[d+2],_=r[h+3],b=r[h],x=r[h+1],w=r[h+2];m==_&&v==b&&g==x&&y==w?(r[h]=0,r[h+1]=0,r[h+2]=0,r[h+3]=0):(r[h]=v,r[h+1]=g,r[h+2]=y,r[h+3]=m)}else if(3==u){m=e[d+3],v=e[d],g=e[d+1],y=e[d+2],_=r[h+3],b=r[h],x=r[h+1],w=r[h+2];if(m==_&&v==b&&g==x&&y==w)continue;if(m<220&&_>20)return!1}return!0},e.encode=function(t,n,r,i,o,a){null==i&&(i=0),null==a&&(a=!1);for(var s=new Uint8Array(t[0].byteLength*t.length+100),u=[137,80,78,71,13,10,26,10],l=0;l<8;l++)s[l]=u[l];var c=8,d=e._bin,h=e.crc.crc,f=d.writeUint,p=d.writeUshort,m=d.writeASCII,v=e.encode.compressPNG(t,n,r,i,a);f(s,c,13),m(s,c+=4,"IHDR"),f(s,c+=4,n),f(s,c+=4,r),s[c+=4]=v.depth,s[++c]=v.ctype,s[++c]=0,s[++c]=0,s[++c]=0,f(s,++c,h(s,c-17,17)),f(s,c+=4,1),m(s,c+=4,"sRGB"),s[c+=4]=1,f(s,++c,h(s,c-5,5)),c+=4;var g=t.length>1;if(g&&(f(s,c,8),m(s,c+=4,"acTL"),f(s,c+=4,t.length),f(s,c+=4,0),f(s,c+=4,h(s,c-12,12)),c+=4),3==v.ctype){f(s,c,3*(S=v.plte.length)),m(s,c+=4,"PLTE"),c+=4;for(l=0;l<S;l++){var y=3*l,_=v.plte[l],b=255&_,x=_>>8&255,w=_>>16&255;s[c+y+0]=b,s[c+y+1]=x,s[c+y+2]=w}if(f(s,c+=3*S,h(s,c-3*S-4,3*S+4)),c+=4,v.gotAlpha){f(s,c,S),m(s,c+=4,"tRNS"),c+=4;for(l=0;l<S;l++)s[c+l]=v.plte[l]>>24&255;f(s,c+=S,h(s,c-S-4,S+4)),c+=4}}for(var T=0,C=0;C<v.frames.length;C++){var E=v.frames[C];g&&(f(s,c,26),m(s,c+=4,"fcTL"),f(s,c+=4,T++),f(s,c+=4,E.rect.width),f(s,c+=4,E.rect.height),f(s,c+=4,E.rect.x),f(s,c+=4,E.rect.y),p(s,c+=4,o[C]),p(s,c+=2,1e3),s[c+=2]=E.dispose,s[++c]=E.blend,f(s,++c,h(s,c-30,30)),c+=4);var S,A=E.cimg;f(s,c,(S=A.length)+(0==C?0:4));var P=c+=4;m(s,c,0==C?"IDAT":"fdAT"),c+=4,0!=C&&(f(s,c,T++),c+=4);for(l=0;l<S;l++)s[c+l]=A[l];f(s,c+=S,h(s,P,c-P)),c+=4}return f(s,c,0),m(s,c+=4,"IEND"),f(s,c+=4,h(s,c-4,4)),c+=4,s.buffer.slice(0,c)},e.encode.compressPNG=function(t,n,r,i,o){for(var a=e.encode.compress(t,n,r,i,!1,o),s=0;s<t.length;s++){var u=a.frames[s],l=(u.rect.width,u.rect.height),c=u.bpl,d=u.bpp,h=new Uint8Array(l*c+l);u.cimg=e.encode._filterZero(u.img,l,d,c,h)}return a},e.encode.compress=function(t,n,r,i,o,a){null==a&&(a=!1);for(var s=6,u=8,l=4,c=255,d=0;d<t.length;d++)for(var h=new Uint8Array(t[d]),f=h.length,p=0;p<f;p+=4)c&=h[p+3];var m=255!=c,v={},g=[];if(0!=t.length&&(v[0]=0,g.push(0),0!=i&&i--),0!=i){var y=e.quantize(t,i,o);t=y.bufs;for(p=0;p<y.plte.length;p++){null==v[b=y.plte[p].est.rgba]&&(v[b]=g.length,g.push(b))}}else for(d=0;d<t.length;d++){var _=new Uint32Array(t[d]);for(f=_.length,p=0;p<f;p++){var b=_[p];if((p<n||b!=_[p-1]&&b!=_[p-n])&&null==v[b]&&(v[b]=g.length,g.push(b),g.length>=300))break}}var x=!!m&&o,w=g.length;w<=256&&0==a&&(u=w<=2?1:w<=4?2:w<=16?4:8,o&&(u=8),m=!0);var T=[];for(d=0;d<t.length;d++){var C=new Uint8Array(t[d]),E=new Uint32Array(C.buffer),S=0,A=0,P=n,M=r,O=0;if(0!=d&&!x){for(var L=o||1==d||2==T[T.length-2].dispose?1:2,I=0,F=1e9,R=0;R<L;R++){for(var k=new Uint8Array(t[d-1-R]),D=new Uint32Array(t[d-1-R]),j=n,B=r,U=-1,z=-1,N=0;N<r;N++)for(var G=0;G<n;G++){E[p=N*n+G]!=D[p]&&(G<j&&(j=G),G>U&&(U=G),N<B&&(B=N),N>z&&(z=N))}var V=-1==U?1:(U-j+1)*(z-B+1);V<F&&(F=V,I=R,-1==U?(S=A=0,P=M=1):(S=j,A=B,P=U-j+1,M=z-B+1))}k=new Uint8Array(t[d-1-I]);1==I&&(T[T.length-1].dispose=2);var H=new Uint8Array(P*M*4);new Uint32Array(H.buffer);e._copyTile(k,n,r,H,P,M,-S,-A,0),e._copyTile(C,n,r,H,P,M,-S,-A,3)?(e._copyTile(C,n,r,H,P,M,-S,-A,2),O=1):(e._copyTile(C,n,r,H,P,M,-S,-A,0),O=0),C=H,E=new Uint32Array(C.buffer)}var W=4*P;if(w<=256&&0==a){W=Math.ceil(u*P/8);for(H=new Uint8Array(W*M),N=0;N<M;N++){p=N*W;var q=N*P;if(8==u)for(G=0;G<P;G++)H[p+G]=v[E[q+G]];else if(4==u)for(G=0;G<P;G++)H[p+(G>>1)]|=v[E[q+G]]<<4-4*(1&G);else if(2==u)for(G=0;G<P;G++)H[p+(G>>2)]|=v[E[q+G]]<<6-2*(3&G);else if(1==u)for(G=0;G<P;G++)H[p+(G>>3)]|=v[E[q+G]]<<7-1*(7&G)}C=H,s=3,l=1}else if(0==m&&1==t.length){H=new Uint8Array(P*M*3);var X=P*M;for(p=0;p<X;p++){var Y=3*p,Z=4*p;H[Y]=C[Z],H[Y+1]=C[Z+1],H[Y+2]=C[Z+2]}C=H,s=2,l=3,W=3*P}T.push({rect:{x:S,y:A,width:P,height:M},img:C,bpl:W,bpp:l,blend:O,dispose:x?1:0})}return{ctype:s,depth:u,plte:g,gotAlpha:m,frames:T}},e.encode._filterZero=function(n,r,i,o,a){for(var s=[],u=0;u<5;u++)if(!(r*o>5e5)||2!=u&&3!=u&&4!=u){for(var l=0;l<r;l++)e.encode._filterLine(a,n,l,o,i,u);if(s.push(t.deflate(a)),1==i)break}for(var c,d=1e9,h=0;h<s.length;h++)s[h].length<d&&(c=h,d=s[h].length);return s[c]},e.encode._filterLine=function(t,n,r,i,o,a){var s=r*i,u=s+r,l=e.decode._paeth;if(t[u]=a,u++,0==a)for(var c=0;c<i;c++)t[u+c]=n[s+c];else if(1==a){for(c=0;c<o;c++)t[u+c]=n[s+c];for(c=o;c<i;c++)t[u+c]=n[s+c]-n[s+c-o]+256&255}else if(0==r){for(c=0;c<o;c++)t[u+c]=n[s+c];if(2==a)for(c=o;c<i;c++)t[u+c]=n[s+c];if(3==a)for(c=o;c<i;c++)t[u+c]=n[s+c]-(n[s+c-o]>>1)+256&255;if(4==a)for(c=o;c<i;c++)t[u+c]=n[s+c]-l(n[s+c-o],0,0)+256&255}else{if(2==a)for(c=0;c<i;c++)t[u+c]=n[s+c]+256-n[s+c-i]&255;if(3==a){for(c=0;c<o;c++)t[u+c]=n[s+c]+256-(n[s+c-i]>>1)&255;for(c=o;c<i;c++)t[u+c]=n[s+c]+256-(n[s+c-i]+n[s+c-o]>>1)&255}if(4==a){for(c=0;c<o;c++)t[u+c]=n[s+c]+256-l(0,n[s+c-i],0)&255;for(c=o;c<i;c++)t[u+c]=n[s+c]+256-l(n[s+c-o],n[s+c-i],n[s+c-o-i])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(t,n,r,i){for(var o=0;o<i;o++)t=e.crc.table[255&(t^n[r+o])]^t>>>8;return t},crc:function(t,n,r){return 4294967295^e.crc.update(4294967295,t,n,r)}},e.quantize=function(t,n,r){for(var i=[],o=0,a=0;a<t.length;a++)i.push(e.encode.alphaMul(new Uint8Array(t[a]),r)),o+=t[a].byteLength;var s=new Uint8Array(o),u=new Uint32Array(s.buffer),l=0;for(a=0;a<i.length;a++){for(var c=i[a],d=c.length,h=0;h<d;h++)s[l+h]=c[h];l+=d}var f={i0:0,i1:s.length,bst:null,est:null,tdst:0,left:null,right:null};f.bst=e.quantize.stats(s,f.i0,f.i1),f.est=e.quantize.estats(f.bst);for(var p=[f];p.length<n;){var m=0,v=0;for(a=0;a<p.length;a++)p[a].est.L>m&&(m=p[a].est.L,v=a);if(m<.001)break;var g=p[v],y=e.quantize.splitPixels(s,u,g.i0,g.i1,g.est.e,g.est.eMq255),_={i0:g.i0,i1:y,bst:null,est:null,tdst:0,left:null,right:null};_.bst=e.quantize.stats(s,_.i0,_.i1),_.est=e.quantize.estats(_.bst);var b={i0:y,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null};b.bst={R:[],m:[],N:g.bst.N-_.bst.N};for(a=0;a<16;a++)b.bst.R[a]=g.bst.R[a]-_.bst.R[a];for(a=0;a<4;a++)b.bst.m[a]=g.bst.m[a]-_.bst.m[a];b.est=e.quantize.estats(b.bst),g.left=_,g.right=b,p[v]=_,p.push(b)}p.sort(function(e,t){return t.bst.N-e.bst.N});for(var x=0;x<i.length;x++){var w=e.quantize.planeDst,T=new Uint8Array(i[x].buffer),C=new Uint32Array(i[x].buffer),E=T.length;for(a=0;a<E;a+=4){for(var S=T[a]*(1/255),A=T[a+1]*(1/255),P=T[a+2]*(1/255),M=T[a+3]*(1/255),O=f;O.left;)O=w(O.est,S,A,P,M)<=0?O.left:O.right;C[a>>2]=O.est.rgba}i[x]=C.buffer}return{bufs:i,plte:p}},e.quantize.getNearest=function(t,n,r,i,o){if(null==t.left)return t.tdst=e.quantize.dist(t.est.q,n,r,i,o),t;var a=e.quantize.planeDst(t.est,n,r,i,o),s=t.left,u=t.right;a>0&&(s=t.right,u=t.left);var l=e.quantize.getNearest(s,n,r,i,o);if(l.tdst<=a*a)return l;var c=e.quantize.getNearest(u,n,r,i,o);return c.tdst<l.tdst?c:l},e.quantize.planeDst=function(e,t,n,r,i){var o=e.e;return o[0]*t+o[1]*n+o[2]*r+o[3]*i-e.eMq},e.quantize.dist=function(e,t,n,r,i){var o=t-e[0],a=n-e[1],s=r-e[2],u=i-e[3];return o*o+a*a+s*s+u*u},e.quantize.splitPixels=function(t,n,r,i,o,a){var s=e.quantize.vecDot;i-=4;for(;r<i;){for(;s(t,r,o)<=a;)r+=4;for(;s(t,i,o)>a;)i-=4;if(r>=i)break;var u=n[r>>2];n[r>>2]=n[i>>2],n[i>>2]=u,r+=4,i-=4}for(;s(t,r,o)>a;)r-=4;return r+4},e.quantize.vecDot=function(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]},e.quantize.stats=function(e,t,n){for(var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],o=n-t>>2,a=t;a<n;a+=4){var s=e[a]*(1/255),u=e[a+1]*(1/255),l=e[a+2]*(1/255),c=e[a+3]*(1/255);i[0]+=s,i[1]+=u,i[2]+=l,i[3]+=c,r[0]+=s*s,r[1]+=s*u,r[2]+=s*l,r[3]+=s*c,r[5]+=u*u,r[6]+=u*l,r[7]+=u*c,r[10]+=l*l,r[11]+=l*c,r[15]+=c*c}return r[4]=r[1],r[8]=r[2],r[12]=r[3],r[9]=r[6],r[13]=r[7],r[14]=r[11],{R:r,m:i,N:o}},e.quantize.estats=function(t){var n=t.R,r=t.m,i=t.N,o=r[0],a=r[1],s=r[2],u=r[3],l=0==i?0:1/i,c=[n[0]-o*o*l,n[1]-o*a*l,n[2]-o*s*l,n[3]-o*u*l,n[4]-a*o*l,n[5]-a*a*l,n[6]-a*s*l,n[7]-a*u*l,n[8]-s*o*l,n[9]-s*a*l,n[10]-s*s*l,n[11]-s*u*l,n[12]-u*o*l,n[13]-u*a*l,n[14]-u*s*l,n[15]-u*u*l],d=c,h=e.M4,f=[.5,.5,.5,.5],p=0,m=0;if(0!=i)for(var v=0;v<10&&(f=h.multVec(d,f),m=Math.sqrt(h.dot(f,f)),f=h.sml(1/m,f),!(Math.abs(m-p)<1e-9));v++)p=m;var g=[o*l,a*l,s*l,u*l],y=h.dot(h.sml(255,g),f),_=g[3]<.001?0:1/g[3];return{Cov:c,q:g,e:f,L:p,eMq255:y,eMq:h.dot(f,g),rgba:(Math.round(255*g[3])<<24|Math.round(255*g[2]*_)<<16|Math.round(255*g[1]*_)<<8|Math.round(255*g[0]*_)<<0)>>>0}},e.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},e.encode.alphaMul=function(e,t){for(var n=new Uint8Array(e.length),r=e.length>>2,i=0;i<r;i++){var o=i<<2,a=e[o+3];t&&(a=a<128?0:255);var s=a*(1/255);n[o+0]=e[o+0]*s,n[o+1]=e[o+1]*s,n[o+2]=e[o+2]*s,n[o+3]=a}return n}}(t,n(142))}()}).call(this,n(69))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(6),o=n(9),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=-Math.PI,n.min.y=.5*-Math.PI,n.min.z=e,n.max.x=Math.PI,n.max.y=.5*Math.PI,n.max.z=t,n},e.prototype.projectPoint=function(e,t){return t||(t={x:0,y:0,z:0}),t.x=e.longitude*a,t.y=e.latitude*a,t.z=e.altitude||0,t},e.prototype.unprojectPoint=function(e){return i.GeoCoordinates.fromRadians(e.y,e.x,e.z)},e.prototype.projectBox=function(e,t){return t||(t=o.MathUtils.newEmptyBox3()),this.projectPoint(new i.GeoCoordinates(e.south,e.west,e.minAltitude),t.min),this.projectPoint(new i.GeoCoordinates(e.north,e.east,e.maxAltitude),t.max),t},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)},e}();t.identityProjection=new s},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),o=function(){function e(e){this.tilingScheme=e}return e.prototype.visit=function(e){this.visitTileKey(i.TileKey.fromRowColumnLevel(0,0,0),e)},e.prototype.visitTileKey=function(e,t){var n,i;if(t(e,this.tilingScheme.getGeoBox(e)))try{for(var o=r(this.tilingScheme.getSubTileKeys(e)),a=o.next();!a.done;a=o.next()){var s=a.value;this.visitTileKey(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e}();t.QuadTree=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(37),o=n(15);t.hereTilingScheme=new o.TilingScheme(i.halfQuadTreeSubdivisionScheme,r.equirectangularProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),i=n(22),o=n(15);t.webMercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,r.webMercatorProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(22),o=n(15);t.mercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,r.mercatorProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(42),o=i.MSAASampling.Level_1,a=i.MSAASampling.Level_4,s=function(){function e(e,t,n){void 0===n&&(n={msaaEnabled:!1}),this.m_readBuffer=new r.WebGLRenderTarget(e,t),this.m_msaaPass=new i.MSAARenderPass,this.m_msaaPass.enabled=void 0!==n&&!0===n.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===n.dynamicMsaaSamplingLevel?o:n.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===n.staticMsaaSamplingLevel?a:n.staticMsaaSamplingLevel}return e.prototype.render=function(e,t,n,r){if(e.getPixelRatio()>1.1)e.render(t,n);else{this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=r?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!0,this.m_msaaPass.render(e,t,n,void 0,this.m_readBuffer)):e.render(t,n,void 0)}},e.prototype.setSize=function(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t)},Object.defineProperty(e.prototype,"dynamicMsaaSamplingLevel",{get:function(){return this.m_dynamicMsaaSamplingLevel},set:function(e){this.m_dynamicMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"msaaEnabled",{get:function(){return this.m_msaaPass.enabled},set:function(e){this.m_msaaPass.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"staticMsaaSamplingLevel",{get:function(){return this.m_staticMsaaSamplingLevel},set:function(e){this.m_staticMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),e}();t.MapRenderingManager=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(n){var r=this,o={};return void 0!==n&&void 0!==n.color&&(o.color=n.color),void 0!==n&&void 0!==n.lineWidth&&(o.lineWidth=n.lineWidth),void 0!==n&&void 0!==n.opacity&&(o.opacity=n.opacity),void 0!==n&&void 0!==n.fog&&(o.fog=n.fog),(r=e.call(this,o)||this).name="DashedLineMaterial",Object.assign(r.uniforms,{dashSize:new i.Uniform(t.DEFAULT_DASH_SIZE),gapSize:new i.Uniform(t.DEFAULT_GAP_SIZE)}),void 0!==n&&(void 0!==n.dashSize&&(r.dashSize=n.dashSize),void 0!==n.gapSize&&(r.gapSize=n.gapSize),void 0!==n.fog&&(r.fog=null!==n.fog)),r}return r(t,e),Object.defineProperty(t.prototype,"dashSize",{get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gapSize",{get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e,this.updateDashedFeature()},enumerable:!0,configurable:!0}),t.prototype.updateDashedFeature=function(){this.defines.DASHED_LINE=this.gapSize>0?1:0},t.DEFAULT_DASH_SIZE=1,t.DEFAULT_GAP_SIZE=1,t}(n(44).SolidLineMaterial);t.DashedLineMaterial=o},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){void 0===t&&(t=new Array),this.priority=e,this.elements=t}}();t.PriorityListGroup=i;var o=function(){function e(){this.groups=new Map}return e.prototype.add=function(e){this.getGroup(e.priority).elements.push(e)},e.prototype.remove=function(e){var t=this.getGroup(e.priority);if(void 0!==t){var n=t.elements.indexOf(e);if(n>=0){if(t.elements.splice(n,1),0===t.elements.length){var r=Math.floor(e.priority);this.groups.delete(r)}return!0}}return!1},e.prototype.clear=function(){this.groups.clear()},e.prototype.merge=function(e){var t,n;try{for(var i=r(e.groups),o=i.next();!o.done;o=i.next()){var a=o.value,s=this.findGroup(a[1].priority);void 0!==s?s.elements=s.elements.concat(a[1].elements):this.groups.set(Math.floor(a[1].priority),a[1])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return this},Object.defineProperty(e.prototype,"sortedGroups",{get:function(){var e,t,n=[];try{for(var i=r(this.groups),o=i.next();!o.done;o=i.next()){var a=o.value;n.push(a[1])}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n.sort(function(e,t){return t.priority-e.priority}),n},enumerable:!0,configurable:!0}),e.prototype.findGroup=function(e){var t=Math.floor(e);return this.groups.get(t)},e.prototype.getGroup=function(e){var t=this.findGroup(e);if(void 0===t){var n=Math.floor(e);t=new i(n),this.groups.set(n,t)}return t},e}();t.GroupedPriorityList=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(45)),r(n(24)),r(n(46)),r(n(89)),r(n(91)),r(n(47))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),i=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)},enumerable:!0,configurable:!0}),e}();t.LoggerManager=i},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(45),o=n(46),a=n(47),s=function(){function e(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new i.ConsoleChannel:new a.WorkerChannel}return e.prototype.getLoggerNames=function(){return this.m_loggers.map(function(e){return e.name})},e.prototype.getLogger=function(e){return this.m_loggers.find(function(t){return t.name===e})},e.prototype.create=function(e,t){var n=new o.Logger(e,this.channel,t);return this.m_loggers.push(n),n},e.prototype.dispose=function(e){var t=this.m_loggers.indexOf(e);if(t<0)throw new Error('Cannot unregister "'+e+'" : no such logger registered.');this.m_loggers.splice(t,1)},e.prototype.updateAll=function(e){var t,n;try{for(var i=r(this.m_loggers),o=i.next();!o.done;o=i.next()){o.value.update(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.update=function(e,t){var n,i;try{for(var o=r(this.m_loggers),a=o.next();!a.done;a=o.next()){var s=a.value;s.name===e&&s.update(t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype.enableAll=function(e){var t,n;try{for(var i=r(this.m_loggers),o=i.next();!o.done;o=i.next()){o.value.enabled=e}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.enable=function(e,t){this.update(e,{enabled:t})},e.prototype.setLogLevelForAll=function(e){var t,n;try{for(var i=r(this.m_loggers),o=i.next();!o.done;o=i.next()){o.value.level=e}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.setLogLevel=function(e,t){this.update(e,{level:t})},e.prototype.setChannel=function(e){this.channel=e},e}();t.LoggerManagerImpl=s},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.channels=[],this.channels=e}return e.prototype.error=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.error.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.debug=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.debug.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.info=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.info.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.log=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.log.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.trace=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.trace.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.warn=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=r(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.warn.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e}();t.MultiChannel=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=e,this.y=t,this.w=n,this.h=r}return e.prototype.set=function(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r},e.prototype.contains=function(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t},e.prototype.intersects=function(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y},e}();function n(e,t,n,r){return(e-n)*(e-n)+(t-r)*(t-r)}e.Box=t,e.distSquared=n,e.computeSquaredLineLength=function(e){for(var t=0,n=e.length-3,r=0;r<n;r+=2){var i=e[r+2]-e[r],o=e[r+3]-e[r+1];t+=i*i+o*o}return t},e.distToSegmentSquared=function(e,t,r,i,o,a){var s=n(r,i,o,a);if(0===s)return n(e,t,r,i);var u=((e-r)*(o-r)+(t-i)*(a-i))/s;return n(e,t,r+(u=Math.max(0,Math.min(1,u)))*(o-r),i+u*(a-i))}}(t.Math2D||(t.Math2D={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){return e<t?t:e>n?n:e}e.clamp=t,e.smoothStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*r*(r*(6*r-15)+10)},e.lerp=function(e,t,n,r,i){return(e-t)*(i-r)/(n-t)+r},e.min2=function(e,t){var n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.min(n,t)),n},e.max2=function(e,t){var n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.max(n,t)),n},e.isClamped=function(e,t,n){return void 0!==t&&e<t||void 0!==n&&e>n}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t.prototype,n);void 0!==r&&void 0===r.get&&(e.prototype[n]=t.prototype[n])})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=!0;t.assert=function(e,t){if(!r&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!r&&(void 0===e||null===e))throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined or null");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.now=function(){return e.nowFunc()},e.getNowFunc=function(){return"undefined"!=typeof performance&&void 0!==performance.now?function(){return performance.now()}:function(){return(new Date).getTime()}},e.instance=new e,e.nowFunc=e.getNowFunc(),e}();t.PerformanceTimer=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var o=i(n),a=o.next();!a.done;a=o.next()){var s=a.value;if(void 0!==s&&null!==s)return s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.mergeWithOptions=function(e,t){var n=r({},e);if(void 0===t||null===t)return n;for(var i in e)if(e.hasOwnProperty(i)){var o=t[i];void 0!==o&&null!==o&&(n[i]=o)}return n}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultUrlResolver=function(e){return void 0!==r?r(e):e},t.setDefaultUrlResolver=function(e){r=e},t.composeUrlResolvers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reduce(function(e,t){return void 0!==t?t(e):e},t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUrl=function(e,t){return r.test(t)?t:t.startsWith("/")?o(e)+t:(t.startsWith("./")&&(t=t.substr(2)),i(e)+t)};var r=new RegExp("^(?:[a-z]+:)?//","i");function i(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}function o(e){var t=a(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function a(e){var t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),n=e.match(t);if(!n)throw new Error("getUrlHostAndProtocol: unable to parse URL '"+e+"'");return{protocol:n[1],host:n[2]}}t.baseUrl=i,t.getUrlOrigin=o,t.getUrlHostAndProtocol=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(23),a="\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\nvarying vec3 vColor;\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n    #if USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",s="\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",u=function(e){function t(n){var r=this,u={name:"EdgeMaterial",vertexShader:a,fragmentShader:s,uniforms:{edgeColor:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),edgeColorMix:new i.Uniform(t.DEFAULT_COLOR_MIX),fadeNear:new i.Uniform(o.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new i.Uniform(o.FadingFeature.DEFAULT_FADE_FAR)},depthWrite:!1};return r=e.call(this,u)||this,o.FadingFeature.patchGlobalShaderChunks(),void 0!==n&&(void 0!==n.color&&r.color.set(n.color),void 0!==n.colorMix&&(r.colorMix=n.colorMix),void 0!==n.fadeNear&&(r.fadeNear=n.fadeNear),void 0!==n.fadeFar&&(r.fadeFar=n.fadeFar)),r}return r(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.edgeColor.value},set:function(e){this.uniforms.edgeColor.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorMix",{get:function(){return this.uniforms.edgeColorMix.value},set:function(e){this.uniforms.edgeColorMix.value=e,this.updateColorMixFeature()},enumerable:!0,configurable:!0}),t.prototype.updateColorMixFeature=function(){this.defines.USE_COLOR=this.colorMix>0?1:0},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return this.uniforms.fadeNear.value},set:function(e){this.uniforms.fadeNear.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return this.uniforms.fadeFar.value},set:function(e){this.uniforms.fadeFar.value=e,void 0!==e&&e>0?(this.needsUpdate=this.needsUpdate||void 0===this.defines.USE_FADING,this.defines.USE_FADING=""):(this.needsUpdate=this.needsUpdate||void 0!==this.defines.USE_FADING,delete this.defines.USE_FADING)},enumerable:!0,configurable:!0}),t.DEFAULT_COLOR=0,t.DEFAULT_COLOR_MIX=0,t}(i.RawShaderMaterial);t.EdgeMaterial=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o="\nattribute vec4 position;\nattribute vec3 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec3 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n}",a="\nprecision highp float;\nprecision highp int;\n\nuniform float pageOffset;\nuniform sampler2D page0;\nuniform sampler2D page1;\nuniform sampler2D page2;\nuniform sampler2D page3;\nuniform sampler2D page4;\nuniform sampler2D page5;\nuniform sampler2D page6;\nuniform sampler2D page7;\n\nvarying vec3 vUv;\n\nvoid main() {\n    float sample = 0.0;\n    if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n    else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy).a;\n    else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy).a;\n    else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy).a;\n    else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy).a;\n    else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy).a;\n    else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy).a;\n    else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy).a;\n    else sample = texture2D(page7, vUv.xy).a;\n\n    gl_FragColor = vec4(sample, sample, sample, 1.0);\n}",s=function(e){function t(){var t={name:"GlyphCopyMaterial",vertexShader:o,fragmentShader:a,uniforms:{pageOffset:new i.Uniform(0),page0:new i.Uniform(i.Texture.DEFAULT_IMAGE),page1:new i.Uniform(i.Texture.DEFAULT_IMAGE),page2:new i.Uniform(i.Texture.DEFAULT_IMAGE),page3:new i.Uniform(i.Texture.DEFAULT_IMAGE),page4:new i.Uniform(i.Texture.DEFAULT_IMAGE),page5:new i.Uniform(i.Texture.DEFAULT_IMAGE),page6:new i.Uniform(i.Texture.DEFAULT_IMAGE),page7:new i.Uniform(i.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1};return e.call(this,t)||this}return r(t,e),t}(i.RawShaderMaterial);t.GlyphCopyMaterial=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(25),a="\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",s="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",u=function(e){function t(n){var r=this;Object.assign(i.ShaderChunk,o.default);var u={name:"HighPrecisionLineMaterial",vertexShader:a,fragmentShader:s,uniforms:{diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),opacity:new i.Uniform(t.DEFAULT_OPACITY),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)}};return Object.assign(u,n),(r=e.call(this,u)||this).type="HighPrecisionLineMaterial",r.isHighPrecisionLineMaterial=!0,r.dimensionality=3,void 0!==n&&(void 0!==n.color&&r.color.set(n.color),void 0!==n.opacity&&(r.opacity=n.opacity)),r.updateTransparencyFeature(),r}return r(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n}":a)},t.prototype.updateTransparencyFeature=function(){this.transparent=this.opacity<1},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t}(i.RawShaderMaterial);t.HighPrecisionLineMaterial=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(25),a="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",s=function(e){function t(n){var r=this;Object.assign(i.ShaderChunk,o.default);var s=n;return(r=e.call(this,s)||this).type="HighPrecisionPointMaterial",r.vertexShader=a,r.fragmentShader=i.ShaderChunk.points_frag,r.fog=!1,r.uniforms={diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),opacity:new i.Uniform(t.DEFAULT_OPACITY),size:new i.Uniform(t.DEFAULT_SIZE),scale:new i.Uniform(t.DEFAULT_SCALE),map:new i.Uniform(new i.Texture),uvTransform:new i.Uniform(new i.Matrix3),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)},r.isHighPrecisionPointMaterial=!0,r.dimensionality=3,void 0!==n&&(void 0!==n.color&&r.color.set(n.color),void 0!==n.opacity&&(r.opacity=n.opacity),void 0!==n.size&&(r.size=n.size),void 0!==n.scale&&(r.scale=n.scale),void 0!==n.uvTransform&&(r.uvTransform=n.uvTransform),void 0!==n.map&&(r.map=n.map)),r}return r(t,e),Object.defineProperty(t.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvTransform",{get:function(){return this.uniforms.uvTransform.value},set:function(e){this.uniforms.uvTransform.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}":a)},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t.DEFAULT_SIZE=1,t.DEFAULT_SCALE=1,t}(i.PointsMaterial);t.HighPrecisionPointMaterial=s,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",a="\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor.a;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",s=function(e){function t(t){var n={name:"IconMaterial",vertexShader:o,fragmentShader:a,uniforms:{map:new i.Uniform(t.map)},depthTest:!0,depthWrite:!0,transparent:!0,vertexColors:i.VertexColors,premultipliedAlpha:!0,blending:i.NormalBlending};return e.call(this,n)||this}return r(t,e),Object.defineProperty(t.prototype,"map",{get:function(){return this.uniforms.map.value},enumerable:!0,configurable:!0}),t}(i.RawShaderMaterial);t.IconMaterial=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o="\nuniform float size;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",a="\nuniform vec3 diffuse;\n\nvoid main() {\n    float alpha = 1.0;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",s=1,u=function(e){function t(t){void 0===t&&(t={});var n=this;return t.depthTest=!1,(n=e.call(this,t)||this).isCirclePointsMaterial=!0,n.type="CirclePointsMaterial",n.vertexShader=o,n.fragmentShader=a,n.m_size=t.size||s,n.m_color=new i.Color,n.uniforms={diffuse:new i.Uniform(n.m_color),size:new i.Uniform(n.m_size)},n.extensions.derivatives=!0,n}return r(t,e),Object.defineProperty(t.prototype,"size",{get:function(){return this.m_size},set:function(e){this.m_size=e,this.uniforms.size.value=e,this.needsUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return"#"+this.m_color.getHexString()},set:function(e){this.m_color.set(e),this.uniforms.diffuse.value.set(this.m_color),this.needsUpdate=!0},enumerable:!0,configurable:!0}),t}(i.ShaderMaterial);t.CirclePointsMaterial=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(43),a=function(e){function t(t){return e.call(this,{uniforms:t,vertexShader:o.CopyShader.vertexShader,fragmentShader:o.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1})||this}return r(t,e),t}(i.ShaderMaterial);t.MSAAMaterial=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec4 uv;\nattribute vec2 glyphAxis;\nattribute vec2 dummy_for_alignment;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec4 vUv;\nvarying float vWeight;\nvarying float vBG;\n\nvoid main() {\n    vColor = color;\n    vUv = vec4(uv.xy, glyphAxis.xy);\n    vWeight = uv.z;\n    vBG = uv.w;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",a='\nprecision highp float;\nprecision highp int;\n\n// Make sure this parameter matches the "distanceRange" used when generating these fonts (found in:\n// @here/harp-map-theme/scripts/create-font-catalog.js).\n#define SDF_DISTANCE_RANGE 8.0\n\nuniform sampler2D texture;\nuniform float textureSize;\n\n#if BG_TEXT\nuniform vec3 bgColor;\nuniform float bgFactor;\nuniform float bgAlpha;\n#endif\n\nvarying vec4 vColor;\nvarying vec4 vUv;\nvarying float vWeight;\nvarying float vBG;\n\nvoid main() {\n\n    vec4 color = vec4(vColor);\n    vec3 sample = texture2D(texture, vUv.xy).rgb;\n\n    float h = sqrt(vUv.z * vUv.z + vUv.w * vUv.w);\n    float textScale = max(abs(vUv.z / h), 0.000001);\n    float dx = abs(dFdx( vUv.x ) * textureSize);\n    float dy = abs(dFdy( vUv.y ) * textureSize);\n    // Special case for glyphs perfectly aligned with the screen Y axis.\n    if (dx == 0.0 && dy == 0.0) {\n        textScale = 1.0;\n        dx = abs(dFdy( vUv.x ) * textureSize);\n        dy = abs(dFdx( vUv.y ) * textureSize);\n    }\n    float toPixels = SDF_DISTANCE_RANGE * inversesqrt( dx * dx + dy * dy ) * textScale;\n\n    float distScale = vWeight;\n    float alphaScale = 1.0;\n    #if BG_TEXT\n    // TODO: Make this less hard-coded with proper outlines specified in pixel width.\n    distScale = (1.0 + (bgFactor * (vWeight - 1.0 ))) * bgFactor;\n    alphaScale = bgAlpha;\n    color.rgb = bgColor;\n\n    float dist = sample.r * distScale - 0.5;\n    float alpha = 1.0;\n    if (vBG < 1.0) alpha = clamp( dist * toPixels + 0.5, 0.0, alphaScale);\n    else alpha = (dist + 0.5) * alphaScale;\n    #else\n    float dist = sample.r * distScale - 0.5;\n    float alpha = clamp( dist * toPixels + 0.5, 0.0, alphaScale);\n    #endif\n    color.a *= alpha;\n    if (color.a < 0.05) {\n        discard;\n    }\n\n    gl_FragColor = color;\n}',s=function(e){function t(n){var r=this,s={name:"TextMaterial",vertexShader:o,fragmentShader:a,uniforms:{texture:new i.Uniform(n.texture),textureSize:new i.Uniform(n.textureSize),bgFactor:new i.Uniform(t.DEFAULT_BG_FACTOR),bgColor:new i.Uniform(new i.Color(t.DEFAULT_BG_COLOR)),bgAlpha:new i.Uniform(t.DEFAULT_BG_ALPHA)},defines:{BG_TEXT:0},depthTest:!0,depthWrite:!0,side:i.DoubleSide,transparent:!0};return(r=e.call(this,s)||this).extensions.derivatives=!0,void 0!==n&&(void 0!==n.bgColor&&r.bgColor.set(n.bgColor),void 0!==n.bgFactor&&(r.bgFactor=n.bgFactor),void 0!==n.bgAlpha&&(r.bgAlpha=n.bgAlpha)),r}return r(t,e),Object.defineProperty(t.prototype,"bgFactor",{get:function(){return this.uniforms.bgFactor.value},set:function(e){this.uniforms.bgFactor.value=e,this.updateBackgroundFeature()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgColor",{get:function(){return this.uniforms.bgColor.value},set:function(e){this.uniforms.bgColor.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgAlpha",{get:function(){return this.uniforms.bgAlpha.value},set:function(e){this.uniforms.bgAlpha.value=e},enumerable:!0,configurable:!0}),t.prototype.updateBackgroundFeature=function(){this.defines.BG_TEXT=this.bgFactor>0?1:0},t.DEFAULT_BG_FACTOR=0,t.DEFAULT_BG_COLOR=14737632,t.DEFAULT_BG_ALPHA=1,t}(i.RawShaderMaterial);t.TextMaterial=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),s=n(1),u={type:"update"},l=function(e){function t(n,r){var i=e.call(this)||this;return i.enabled=!0,i.cacheable=!1,void 0!==n&&0!==n.length||(n="anonymous-datasource#"+ ++t.uniqueNameCounter),i.name=n,i.styleSetName=r,i}return r(t,e),Object.defineProperty(t.prototype,"styleSetName",{get:function(){return this.m_styleSetName},set:function(e){this.m_styleSetName=e,void 0!==this.m_mapView&&void 0!==e&&void 0!==this.m_mapView.theme.styles&&this.setStyleSet(this.m_mapView.theme.styles[e])},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.ready=function(){return!0},Object.defineProperty(t.prototype,"mapView",{get:function(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this.mapView.projection},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2]})})},t.prototype.attach=function(e){this.m_mapView=e},t.prototype.detach=function(e){s.assert(this.m_mapView===e),this.m_mapView=void 0},t.prototype.setStyleSet=function(e,t){},t.prototype.setLanguages=function(e){},t.prototype.updateTile=function(e){},t.prototype.shouldPreloadTiles=function(){return!1},Object.defineProperty(t.prototype,"minZoomLevel",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoomLevel",{get:function(){return 20},enumerable:!0,configurable:!0}),t.prototype.getDisplayZoomLevel=function(e){return a.Math.clamp(e,this.minZoomLevel,this.maxZoomLevel)},t.prototype.shouldRender=function(e,t){return t.level===e},t.prototype.shouldRenderText=function(e,t){return!0},t.prototype.requestUpdate=function(){this.dispatchEvent(u)},t.uniqueNameCounter=0,t}(a.EventDispatcher);t.DataSource=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isLoading=function(e){return void 0!==e.loadingPromise}}(t.ImageItem||(t.ImageItem={}))},function(e,t,n){"use strict";var r,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(r||(r={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(i||(i={}));var a=function(){function e(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}return Object.defineProperty(e,"instance",{get:function(){return void 0===this.m_instance&&(this.m_instance=new e),this.m_instance},enumerable:!0,configurable:!0}),e.prototype.convert=function(e){for(var t="",n=0;n<e.length;++n){var o=e.charCodeAt(n);if(this.isArabicCharacter(o)){for(var a=n-1;a>=0&&this.isNeutral(e.charCodeAt(a));--a);var s=a>=0?e.charCodeAt(a):void 0;if(void 0!==s){var u=this.getCharacterMap(s);(void 0===u||void 0===u[r.Initial]&&void 0===u[r.Medial])&&(s=void 0)}for(var l=n+1;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);var c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){var d=this.getCharacterMap(c);(void 0===d||void 0===d[r.Medial]&&void 0===d[r.Final])&&(c=void 0)}if(1604===o&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){var h=this.getCombinedCharacterMap(o,c);t+=void 0!==s?String.fromCharCode(h[i.Connected]):String.fromCharCode(h[i.Isolated]),++n;continue}var f=this.getCharacterMap(o);void 0!==s&&void 0!==c&&void 0!==f[r.Medial]?t+=String.fromCharCode(f[r.Medial]):void 0!==s&&void 0!==f[r.Final]?t+=String.fromCharCode(f[r.Final]):void 0!==c&&void 0!==f[r.Initial]?t+=String.fromCharCode(f[r.Initial]):t+=String.fromCharCode(o)}else t+=String.fromCharCode(o)}return t},e.prototype.isArabicCharacter=function(e){return this.m_singleCharactersMap.has(e)},e.prototype.getCharacterMap=function(e){return this.m_singleCharactersMap.get(e)},e.prototype.getCombinedCharacterMap=function(e,t){var n=this.m_combinedCharactersMap.get(e);if(void 0!==n)return n.get(t)},e.prototype.isNeutral=function(e){var t,n;try{for(var r=o(this.m_neutralCharacters),i=r.next();!i.done;i=r.next()){if(i.value===e)return!0}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},e}();t.ContextualArabicConverter=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){return function(e,t,n,r,i){this.key=e,this.value=t,this.size=n,this.newer=r,this.older=i}}();t.Entry=i;var o=function(){function e(e,t){void 0===t&&(t=function(){return 1}),this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}return e.prototype.forEach=function(e,t){for(var n=this.m_newest;null!==n;)e.call(t,n.value,n.key,this),n=n.older},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.m_capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.m_map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newest",{get:function(){return this.m_newest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldest",{get:function(){return this.m_oldest},enumerable:!0,configurable:!0}),e.prototype.setCapacity=function(e){for(this.m_capacity=e;this.m_size>this.m_capacity;)this.evict()},e.prototype.set=function(e,t){var n=this.m_sizeFunction(t),o=this.m_map.get(e);if(void 0!==o)this.m_size=this.m_size-o.size+n,o.value=t,o.size=n,this.promote(o),this.evict();else{if(n>this.m_capacity)return;if(o=new i(e,t,n,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=o;else{r.assert(null!==this.m_newest);var a=this.m_newest;o.older=this.m_newest,a.newer=o,this.m_newest=o}this.m_map.set(e,o),this.m_size+=n,this.evict()}},e.prototype.get=function(e){var t=this.m_map.get(e);if(void 0!==t)return this.promote(t),t.value},e.prototype.has=function(e){return this.m_map.has(e)},e.prototype.clear=function(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()},e.prototype.evictAll=function(){var e=this.evictionCallback;void 0!==e&&this.forEach(function(t,n){return e(n,t)}),this.clear()},e.prototype.delete=function(e){var t=this.m_map.get(e);return void 0!==t&&(t===this.m_newest?this.m_newest=t.older:t.newer?t.newer.older=t.older:r.assert(!1),t===this.m_oldest?this.m_oldest=t.newer:t.older?t.older.newer=t.newer:r.assert(!1),this.m_size-=t.size,this.m_map.delete(e))},e.prototype.evict=function(){for(;this.m_size>this.m_capacity;)this.evictOldest()},e.prototype.evictOldest=function(){r.assert(null!==this.m_oldest);var e=this.m_oldest;r.assert(null===e.older);var t=e;this.m_oldest=t.newer,null!==t.newer&&(r.assert(t.newer.older===t),t.newer.older=null);var n=this.m_map.delete(t.key);return r.assert(!0===n),n&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t},e.prototype.promote=function(e){if(e!==this.m_newest){e.newer&&(r.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(r.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,r.assert(null!==this.m_newest);var t=this.m_newest;r.assert(null===t.newer),t.newer=e,this.m_newest=e}},e}();t.LRUCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function i(e,t,n,r){if(!(t>e.width||t<0||n>e.height||n<0)){var i;r.width=e.width,r.height=e.height;var o=r.getContext("2d");return null!==o&&(o.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),i=o.getImageData(t,n,1,1).data),i}}function o(e,t,n,r){if(!(t>e.width||t<0||n>e.height||n<0))return function(e,t,n){for(var r=t*n,i=e.data,o=new Uint8ClampedArray(n),a=0;a<n;a++)o[0]=i[r+a];return o}(e,n*e.width+t,r)}t.getPixelFromImage=function(e,t,n,r){var a;if(function(e){return void 0!==e.close}(n))void 0===r&&(r=document.createElement("canvas")),a=i(n,e,t,r);else{var s=n;a=o(s,e,t,s.data.length/(s.height*s.width))}return a},t.screenToUvCoordinates=function(e,t,n,i){var o=n.x,a=n.x+n.w,s=n.y,u=n.y+n.h;return{u:r.MathUtils.lerp(e,o,a,i.s0,i.s1),v:r.MathUtils.lerp(t,s,u,i.t0,i.t1)}},t.getPixelFromImageBitmap=i,t.getPixelFromImageData=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),o=n(3),a=n(54);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.createMaterial=function(e){var t=a.getMaterialConstructor(e.technique),n={};if(void 0!==t){t.prototype instanceof r.RawShaderMaterial&&t!==o.HighPrecisionLineMaterial&&(n.fog=e.fog);var i=new t(n);if(void 0!==e.technique.id&&(i.name=e.technique.id),"extruded-polygon"===e.technique.name&&(i.flatShading=!0),i.depthTest="extruded-polygon"===e.technique.name&&!1!==e.technique.depthTest,"shader"===e.technique.name){var s=e.technique.params;Object.getOwnPropertyNames(s).forEach(function(e){var t=e;if("name"!==t){var n=i;n[t]instanceof r.Color?n[t].set(s[t]):n[t]=s[t]}})}else a.applyTechniqueToMaterial(e.technique,i,e.level,e.skipExtraProps);return i}},t.getProjection=function(e){switch(e){case"mercator":return i.mercatorProjection;case"webMercator":return i.webMercatorProjection;default:throw new Error("Unknown projection "+e)}},t.getProjectionName=function(e){if(e===i.mercatorProjection)return"mercator";if(e===i.webMercatorProjection)return"webMercator";throw new Error("Unknown projection")},t.getBufferAttribute=function(e){switch(e.type){case"float":return new r.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint16":return new r.BufferAttribute(new Uint16Array(e.buffer),e.itemCount);case"uint32":return new r.BufferAttribute(new Uint32Array(e.buffer),e.itemCount);default:throw new Error("unsupported buffer of type "+e.type)}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(0),u=a.LoggerManager.instance.create("Theme"),l=function(){function e(){}return e.prototype.lookup=function(e){},e.prototype.unmap=function(){return{}},e}();t.Env=l;var c=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name=t,i.value=n,i.parent=r,i}return r(t,e),t.prototype.lookup=function(e){return e===this.name?this.value:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};return e[this.name]=this.value,e},t}(l);t.Bind=c,t.EmptyEnv={lookup:function(e){},unmap:function(){return{}}};var d=function(e){function t(t,n){var r=e.call(this)||this;return r.entries=t,r.parent=n,r}return r(t,e),t.prototype.lookup=function(e){var t=this.entries[e];return void 0!==t?t:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};for(var t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e},t}(l);t.MapEnv=d;var h=function(){function e(e){this.kind=e}return e.parse=function(e){return new L(e).parse()},e}();t.Expr=h;var f,p,m=function(e){function t(t){var n=e.call(this,"var")||this;return n.name=t,n}return r(t,e),t.prototype.evaluate=function(e){return e.lookup(this.name)},t}(h),v=function(e){function t(t){var n=e.call(this,"number")||this;return n.value=t,n}return r(t,e),t.prototype.evaluate=function(){return this.value},t}(h),g=function(e){function t(t){var n=e.call(this,"string")||this;return n.value=t,n}return r(t,e),t.prototype.evaluate=function(){return this.value},t}(h),y=function(e){function t(t){var n=e.call(this,"has")||this;return n.attribute=t,n}return r(t,e),t.prototype.evaluate=function(e){return void 0!==e.lookup(this.attribute)},t}(h),_=function(e){function t(t,n){var r=e.call(this,"in")||this;return r.value=t,r.elements=n,r}return r(t,e),t.prototype.evaluate=function(e){var t,n,r=this.value.evaluate(e);try{for(var o=i(this.elements),a=o.next();!a.done;a=o.next()){if(r===a.value.evaluate(e))return!0}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!1},t}(h),b=function(e){function t(t){var n=e.call(this,"!")||this;return n.expr=t,n}return r(t,e),t.prototype.evaluate=function(e){return!this.expr.evaluate(e)},t}(h),x=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.op=t,i.left=n,i.right=r,i}return r(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e),n=this.right.evaluate(e);switch(this.op){case"~=":return"string"==typeof t&&"string"==typeof n&&-1!==t.indexOf(n);case"^=":return"string"==typeof t&&"string"==typeof n&&t.startsWith(n);case"$=":return"string"==typeof t&&"string"==typeof n&&t.endsWith(n);case"==":return t===n;case"!=":return t!==n;case"<":return void 0!==t&&void 0!==n?t<n:void 0;case">":return void 0!==t&&void 0!==n?t>n:void 0;case"<=":return void 0!==t&&void 0!==n?t<=n:void 0;case">=":return void 0!==t&&void 0!==n?t>=n:void 0}throw new Error("invalid relational op "+this.op)},t}(h),w=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.op=t,i.left=n,i.right=r,i}return r(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e);switch(this.op){case"||":return t||this.right.evaluate(e);case"&&":return t&&this.right.evaluate(e)}throw new Error("invalid logical op "+this.op)},t}(h);function T(e){switch(e){case f.Tab:case f.Lf:case f.Cr:case f.Space:return!0;default:return!1}}function C(e){return e>=f._0&&e<=f._9}function E(e){return e>=f.a&&e<=f.z||e>=f.A&&e<=f.Z}function S(e){return function(e){return E(e)||C(e)}(e)||e===f._||e===f.Dollar||e===f.Dot||e===f.LBracket||e===f.RBracket}function A(e){switch(e){case p.Eof:return"eof";case p.Error:return"error";case p.Identifier:return"identifier";case p.Number:return"number";case p.String:return"string";case p.Comma:return",";case p.LParen:return"(";case p.RParen:return")";case p.LBracket:return"[";case p.RBracket:return"]";case p.Exclaim:return"!";case p.TildeEqual:return"~=";case p.CaretEqual:return"^=";case p.DollarEqual:return"$=";case p.EqualEqual:return"==";case p.ExclaimEqual:return"!=";case p.Less:return"<";case p.Greater:return">";case p.LessEqual:return"<=";case p.GreaterEqual:return">=";case p.BarBar:return"||";case p.AmpAmp:return"&&";default:throw new Error("invalid token "+e)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(f||(f={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(p||(p={}));var P=function(){function e(e){this.code=e,this.m_token=p.Error,this.m_index=0,this.m_char=f.Lf}return e.prototype.token=function(){return this.m_token},e.prototype.text=function(){return this.m_text||""},e.prototype.next=function(){if(this.m_token=this.yylex(),this.m_token===p.Error)throw new Error("unexpected character "+this.m_char);return this.m_token},e.prototype.yyinp=function(){this.m_char=this.code.codePointAt(this.m_index++)||0},e.prototype.yylex=function(){for(this.m_text=void 0;T(this.m_char);)this.yyinp();if(0===this.m_char)return p.Eof;var e=this.m_char;switch(this.yyinp(),e){case f.LParen:return p.LParen;case f.RParen:return p.RParen;case f.LBracket:return p.LBracket;case f.RBracket:return p.RBracket;case f.Comma:return p.Comma;case f.SingleQuote:case f.DoubleQuote:for(var t=this.m_index-1;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),p.String;case f.Exclaim:return this.m_char===f.Equal?(this.yyinp(),p.ExclaimEqual):p.Exclaim;case f.Caret:return this.m_char===f.Equal?(this.yyinp(),p.CaretEqual):p.Error;case f.Tilde:return this.m_char===f.Equal?(this.yyinp(),p.TildeEqual):p.Error;case f.Equal:return this.m_char===f.Equal?(this.yyinp(),p.EqualEqual):p.Error;case f.Less:return this.m_char===f.Equal?(this.yyinp(),p.LessEqual):p.Less;case f.Greater:return this.m_char===f.Equal?(this.yyinp(),p.GreaterEqual):p.Greater;case f.Bar:return this.m_char===f.Bar?(this.yyinp(),p.BarBar):p.Error;case f.Amp:return this.m_char===f.Amp?(this.yyinp(),p.AmpAmp):p.Error;default:t=this.m_index-2;if(E(e)||e===f._||e===f.Dollar&&S(this.m_char)){for(;S(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),p.Identifier}if(C(e)){for(;C(this.m_char);)this.yyinp();if(this.m_char===f.Dot)for(this.yyinp();C(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),p.Number}if(e===f.Dollar)return this.m_char===f.Equal?(this.yyinp(),p.DollarEqual):p.Error}return p.Error},e}();function M(e){switch(e){case p.TildeEqual:return"~=";case p.CaretEqual:return"^=";case p.DollarEqual:return"$=";case p.EqualEqual:return"==";case p.ExclaimEqual:return"!=";default:return}}function O(e){switch(e){case p.Less:return"<";case p.Greater:return">";case p.LessEqual:return"<=";case p.GreaterEqual:return">=";default:return}}var L=function(){function e(e){this.lex=new P(e),this.lex.next()}return e.prototype.parse=function(){return this.parseLogicalOr()},e.prototype.yyexpect=function(e){if(this.lex.token()!==e)throw new Error("Syntax error: Expected token '"+A(e)+"' but found '"+A(this.lex.token())+"'");this.lex.next()},e.prototype.parsePrimary=function(){switch(this.lex.token()){case p.Identifier:var e=this.lex.text();if("has"!==e){var t=new m(e);return this.lex.next(),t}this.lex.next(),this.yyexpect(p.LParen);var n=this.lex.text();return this.yyexpect(p.Identifier),this.yyexpect(p.RParen),new y(n);case p.Number:t=new v(parseFloat(this.lex.text()));return this.lex.next(),t;case p.String:t=new g(this.lex.text());return this.lex.next(),t;case p.LParen:this.lex.next();t=this.parseLogicalOr();return this.yyexpect(p.RParen),t}throw new Error("Syntax error")},e.prototype.parseUnary=function(){return this.lex.token()===p.Exclaim?(this.lex.next(),new b(this.parseUnary())):this.parsePrimary()},e.prototype.parseRelational=function(){for(var e=this.parseUnary();;)if(this.lex.token()===p.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(p.LBracket);for(var t=[this.parsePrimary()];this.lex.token()===p.Comma;)this.lex.next(),t.push(this.parsePrimary());this.yyexpect(p.RBracket),e=new _(e,t)}else{var n=O(this.lex.token());if(void 0===n)break;this.lex.next();var r=this.parseUnary();e=new x(n,e,r)}return e},e.prototype.parseEquality=function(){for(var e=this.parseRelational();;){var t=M(this.lex.token());if(void 0===t)break;this.lex.next();var n=this.parseRelational();e=new x(t,e,n)}return e},e.prototype.parseLogicalAnd=function(){for(var e=this.parseEquality();this.lex.token()===p.AmpAmp;){this.lex.next();var t=this.parseEquality();e=new w("&&",e,t)}return e},e.prototype.parseLogicalOr=function(){for(var e=this.parseLogicalAnd();this.lex.token()===p.BarBar;){this.lex.next();var t=this.parseLogicalAnd();e=new w("||",e,t)}return e},e}();t.createLight=function(e){switch(e.type){case"ambient":return(t=new s.AmbientLight(e.color,e.intensity)).name=e.name,t;case"directional":var t;return(t=new s.DirectionalLight(e.color,e.intensity)).name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}};var I=function(){function e(e,t){var n,r,a=this;this.styleSet=e,this.validate=t,this.m_renderOrderBiasGroups=new Map,this.m_techniques=new Array;var s=0,l=function(e){var t,n;if(void 0!==e.renderOrderBiasGroup){var r=e.renderOrderBiasGroup?a.m_renderOrderBiasGroups.get(e.renderOrderBiasGroup):void 0;if(void 0!==e.renderOrderBiasRange&&void 0===r){void 0!==e.renderOrder&&u.warn("WARN: style.renderOrder will be overriden if renderOrderBiasGroup is set:",e);var c=o(e.renderOrderBiasRange,2),d=c[0],h=c[1];e.renderOrder=d<0?s+Math.abs(d):s,s+=Math.abs(d)+h,e.renderOrderBiasGroup&&a.m_renderOrderBiasGroups.set(e.renderOrderBiasGroup,e.renderOrder),s++}else r&&(void 0!==e.renderOrder&&u.warn("WARN: style.renderOrder will be overriden if renderOrderBiasGroup is set:",e),e.renderOrder=r)}if(void 0!==e.styles){a.validate&&(Array.isArray(e.styles)||u.error("ERROR: style.styles must be an Array:",e));try{for(var f=i(e.styles),p=f.next();!p.done;p=f.next()){var m=p.value;l(m)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}else void 0!==e.technique&&void 0!==e.attr&&void 0===e.attr.renderOrder&&(e.attr._renderOrderAuto=s++)};try{for(var c=i(e),d=c.next();!d.done;d=c.next()){var h=d.value;l(h)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}return e.prototype.getMatchingTechniques=function(e){var t,n,r=[],o=new Array;try{for(var a=i(this.styleSet),s=a.next();!s.done;s=a.next()){var u=s.value;if(this.validate&&0!==o.length)throw new Error("Internal error: sytle stack cleanup failed");if(this.processStyle(e,o,u,r))break}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r},e.prototype.checkAddTechnique=function(e,t){var n=void 0===e._index?-1:e._index;return n<0?(t._index=n=this.m_techniques.length,this.m_techniques.push(t),e._index=n):t._index=n,n},Object.defineProperty(e.prototype,"techniques",{get:function(){return this.m_techniques},enumerable:!0,configurable:!0}),e.prototype.cleanupStyle=function(e,t){return"styles"===e?"[...]":e.startsWith("_")?void 0:t},e.prototype.processStyle=function(e,t,n,r){var o,a,s,l,c=this;if(void 0!==n.when&&(void 0===n._whenExpr&&(n._whenExpr=h.parse(n.when)),!n._whenExpr.evaluate(e)))return!1;if(void 0!==n.styles){if(n.debug&&u.log("\n======== style group =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle group:",JSON.stringify(n,this.cleanupStyle,2)),t.push(n),this.validate&&!Array.isArray(n.styles))return u.error("ERROR: style.styles must be an Array:",n),t.pop(),!1;try{for(var d=i(n.styles),f=d.next();!f.done;f=d.next()){var p=f.value;if(this.processStyle(e,t,p,r))return t.pop(),!0}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}t.pop()}else{if(void 0!==n.technique){if(void 0===n._index){var m={};m.name=n.technique;var v=function(e){void 0!==e.renderOrder&&(m.renderOrder=e.renderOrder),void 0!==e.transient&&(m.transient=e.transient),void 0!==e.renderOrderBiasProperty&&(m.renderOrderBiasProperty=e.renderOrderBiasProperty),void 0!==e.labelProperty&&(m.label=e.labelProperty),void 0!==e.renderOrderBiasRange&&(m.renderOrderBiasRange=e.renderOrderBiasRange),void 0!==e.renderOrderBiasGroup&&(m.renderOrderBiasGroup=e.renderOrderBiasGroup),void 0!==e.attr&&Object.getOwnPropertyNames(e.attr).forEach(function(t){c.validate&&("technique"===t?u.warn("WARNING: technique defined in attr (deprecated):",e):"renderOrder"===t&&u.warn("WARNING: renderOrder defined in attr (deprecated):",e)),void 0!==e.attr&&(m[t]=e.attr[t])})};try{for(var g=i(t),y=g.next();!y.done;y=g.next()){v(p=y.value)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}v(n),this.checkAddTechnique(n,m),r.push(m),n.debug&&u.log("\n======== style w/ technique =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle:",JSON.stringify(n,this.cleanupStyle,2),"\ntechnique:",JSON.stringify(m,this.cleanupStyle,2))}else r.push(this.m_techniques[n._index]);return!0===n.final}this.validate&&u.warn("WARNING: No technique defined in style. Either sub-styles or a technique must be defined:",JSON.stringify(n))}return!1},e}();t.StyleSetEvaluator=I;var F=function(){function e(e){this.theme=e}return e.prototype.visitStyles=function(e){var t,n,r=function(t){var n,o;if(e(t))return!0;if(void 0!==t.styles)try{for(var a=i(t.styles),s=a.next();!s.done;s=a.next()){var u=s.value;if(r(u))return!0}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return!1};if(void 0!==this.theme.styles)for(var o in this.theme.styles)if(void 0!==this.theme.styles[o])try{for(var a=i(this.theme.styles[o]),s=a.next();!s.done;s=a.next()){var u=s.value;if(r(u))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},e}();t.ThemeVisitor=F},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=function(){return function(e,t){void 0===t&&(t=5e3),this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}}();t.FeatureGroup=a;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userData=[],t}return r(t,e),t}(a);t.LineFeatureGroup=s;var u=function(e){function t(t,n){void 0===n&&(n=5e3);var r=e.call(this,t,n)||this;return r.groupNumRings=0,r.outerRingStartIndex=new Array(n),r.outerRingStartIndex.length=n,r.innerRingIsOuterContour=new Array(n),r.innerRingIsOuterContour.length=n,r.innerRingStartIndex=new Array(n),r.innerRingStartIndex.length=n,r}return r(t,e),t}(a);t.PolygonFeatureGroup=u;var l=function(){return function(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.pointGroup=new a(t),this.lineGroup=new s(t),this.polygonGroup=new u(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}}();t.ExtendedTileInfo=l,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function n(e){return e.numPositions===e.positions.length}e.finish=function(e){t(e.pointGroup),function(e){t(e),void 0!==e.segmentIds&&(e.segmentIds.length=e.numFeatures,e.segmentStartOffsets.length=e.numFeatures,e.segmentEndOffsets.length=e.numFeatures)}(e.lineGroup),function(e){t(e),e.outerRingStartIndex.length=e.numFeatures,e.innerRingIsOuterContour.length=e.groupNumRings,e.innerRingStartIndex.length=e.groupNumRings}(e.polygonGroup)},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=n,e.tileInfoFinished=function(e){return n(e.pointGroup)&&n(e.lineGroup)&&n(e.polygonGroup)},e.getFeatureName=function(e,t,n,r){var o,a,s;if(t){var u=e.lookup("abbr");if("string"==typeof u&&u.length>0)return u}if(n){var l=e.lookup("iso_code");if("string"==typeof l&&l.length>0)return l}if(void 0!==r)try{for(var c=i(r),d=c.next();!d.done;d=c.next()){var h=d.value;if("string"==typeof(s=e.lookup("name_"+h))&&s.length>0)return s}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}if("string"==typeof(s=e.lookup("name")))return s}}(l=t.ExtendedTileInfo||(t.ExtendedTileInfo={})),t.ExtendedTileInfo=l;var c=function(){function e(e,t,n){this.tileInfo=e,this.storeExtendedTags=t,this.languages=n,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}return e.prototype.addTechnique=function(e){if(void 0===e._index)throw new Error("ExtendedTileInfoEmitter#processPointFeature: Internal error - No technique index");var t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;t=this.tileInfo.techniqueCatalog.length;var n={};return Object.getOwnPropertyNames(e).forEach(function(t){t.startsWith("_")||(n[t]=e[t])}),n._index=e._index,this.techniqueIndexMap.set(e._index,t),this.tileInfo.techniqueCatalog.push(n),t},e.prototype.addFeature=function(e,t,n,r,i,a){var s=t,u=s.label,c=s.useAbbreviation,d=s.useIsoCode,h="string"==typeof u?n.lookup(u):l.getFeatureName(n,c,d,this.languages),f=-1;if(h&&"string"==typeof h&&(f=this.addText(h)),e.featureIds[e.numFeatures]=r,e.techniqueIndex[e.numFeatures]=i,e.textIndex[e.numFeatures]=f,e.positionIndex[e.numFeatures]=e.numPositions,a){var p=e;o.assert(void 0!==p.outerRingStartIndex),o.assert(void 0!==p.innerRingStartIndex),o.assert(void 0!==p.innerRingIsOuterContour),p.outerRingStartIndex[e.numFeatures]=p.groupNumRings}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(n.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(n.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(n.lookup("type"))),e.numFeatures++},e.prototype.addFeaturePoint=function(e,t,n){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=n},e.prototype.addFeaturePoints=function(e,t){for(var n=e.numPositions,r=t.length,i=e.positions,o=0;o<r;o++)i[n+o]=t[o];e.numPositions+=t.length},e.prototype.addRoadSegments=function(e,t,n,r){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=n,e.segmentEndOffsets[e.numFeatures-1]=r},e.prototype.addRingPoints=function(e,t,n){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=n?1:0,e.groupNumRings++;for(var r=e.numPositions,i=t.length,o=e.positions,a=0;a<i;a++)o[r+a]=t[a];e.numPositions+=t.length},e.prototype.finish=function(){l.finish(this.tileInfo)},e.prototype.addText=function(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)},e.prototype.addLayer=function(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)},e.prototype.addClass=function(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)},e.prototype.addType=function(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)},e.prototype.addStringValue=function(e,t,n){if(void 0===e)return-1;var r=e.toString(),i=n.get(r);return void 0!==i?i:(i=t.length,t.push(r),n.set(r,i),i)},e}();t.ExtendedTileInfoWriter=c;var d=function(){function e(){this.polygons=new u(!1,5e3),this.featureIndex=0,this.ringStart=0,this.numRings=0}return e.prototype.setup=function(e,t,n,r){this.polygons=e,this.featureIndex=t,this.ringStart=n,this.numRings=r},e.prototype.isOuterRing=function(e){if(o.assert(e>=0),o.assert(e<this.numRings),e<0||e>=this.numRings)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]},e.prototype.getPoints=function(e){if(o.assert(e>=0),o.assert(e<this.numRings),e<0||e>=this.numRings)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");var t,n=this.polygons.innerRingStartIndex[this.ringStart+e];return t=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-n:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-n:this.polygons.positions.length-n,{points:this.polygons.positions,pointsStart:n,numPointValues:t}},e}(),h=function(){function e(e){this.tileInfo=e}return e.prototype.visitAll=function(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)},e.prototype.visitFeature=function(e,t){for(var n=0,r=this.tileInfo.pointGroup.numFeatures,i=this.tileInfo.pointGroup.featureIds,o=0;o<r;o++)i[o]===e&&(n++,this.visitPointFeature(o,t));var a=this.tileInfo.lineGroup.numFeatures,s=this.tileInfo.lineGroup.featureIds;for(o=0;o<a;o++)s[o]===e&&(n++,this.visitLineFeature(o,t));var u=this.tileInfo.polygonGroup.numFeatures,l=this.tileInfo.polygonGroup.featureIds;for(o=0;o<u;o++)l[o]===e&&(n++,this.visitPolygonFeature(o,t));return n},e.prototype.visitAllPointFeatures=function(e){for(var t=this.tileInfo.pointGroup.numFeatures,n=0;n<t;n++)this.visitPointFeature(n,e)},e.prototype.visitAllLineFeatures=function(e){for(var t=this.tileInfo.lineGroup.numFeatures,n=0;n<t;n++)this.visitLineFeature(n,e)},e.prototype.visitAllPolygonFeatures=function(e){for(var t=this.tileInfo.polygonGroup.numFeatures,n=0;n<t;n++)this.visitPolygonFeature(n,e)},e.prototype.getTag=function(e,t){return void 0!==t&&t[e]>=0?t[e]:-1},e.prototype.visitPointFeature=function(e,t){var n=this.tileInfo.pointGroup,r=n.positionIndex[e],i=n.positions[r],o=n.positions[r+1];t.acceptPoint&&t.acceptPoint(n.featureIds[e],n.techniqueIndex[e],i,o,n.textIndex[e],this.getTag(e,n.layerIndex),this.getTag(e,n.classIndex),this.getTag(e,n.typeIndex))},e.prototype.visitLineFeature=function(e,t){var n,r,i,o=this.tileInfo,a=o.lineGroup,s=a.numFeatures,u=a.positionIndex[e],l=e===s-1?a.positions.length-u:a.positionIndex[e+1]-u;void 0!==a.segmentIds&&(n=a.segmentIds[e],r=a.segmentStartOffsets[e],i=a.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(a.featureIds[e],a.techniqueIndex[e],a.textIndex[e],this.getTag(e,a.layerIndex),this.getTag(e,a.classIndex),this.getTag(e,a.typeIndex),o.lineGroup.positions,u,l,n,r,i)},e.prototype.visitPolygonFeature=function(t,n){var r=this.tileInfo.polygonGroup,i=r.numFeatures,o=r.outerRingStartIndex[t],a=t===i-1?r.innerRingStartIndex.length-o:r.outerRingStartIndex[t+1]-o;e.polygonAccessor.setup(r,t,o,a),n.acceptPolygon&&n.acceptPolygon(r.featureIds[t],r.techniqueIndex[t],r.textIndex[t],this.getTag(t,r.layerIndex),this.getTag(t,r.classIndex),this.getTag(t,r.typeIndex),e.polygonAccessor)},e.polygonAccessor=new d,e}();t.ExtendedTileInfoVisitor=h},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Configuration="configuration",e.Initialized="initialized",e.Request="request",e.Response="response",e.CreateService="create-service",e.DestroyService="destroy-service"}(r=t.DecodedTileMessageName||(t.DecodedTileMessageName={})),t.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=t.Requests||(t.Requests={})),t.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===r.Configuration},t.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===r.Initialized},t.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===r.Request},t.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===r.Response},t.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},t.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(10),a=n(1),s=n(0),u=n(16),l=n(56),c=a.LoggerManager.instance.create("PoiRenderer"),d=1,h=function(){function e(e,t,n,r){this.mapView=e,this.scene=t,this.imageItem=n,this.renderOrder=r,this.color=u.ColorCache.instance.getColor("#000000")}return e.prototype.init=function(){void 0===this.boxBuffer&&this.setup()},e.prototype.reset=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.reset()},e.prototype.update=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.updateBufferGeometry()},e.prototype.setup=function(){var e=new l.IconTexture(this.imageItem),t=new s.Texture(e.image.imageData,s.UVMapping,void 0,void 0,s.LinearFilter,s.LinearFilter,s.RGBAFormat);t.needsUpdate=!0,t.premultiplyAlpha=!0,t.generateMipmaps=!1,this.m_material=new i.IconMaterial({map:t}),this.boxBuffer=new o.BoxBuffer(this.m_material,this.renderOrder);var n=this.boxBuffer.mesh;n.frustumCulled=!1,this.scene.add(n),this.mapView.update()},e}(),f=function(){function e(e,t){this.mapView=e,this.sceneSet=t,this.batches=[],this.m_batchMap=new Map,d=window.devicePixelRatio}return e.prototype.registerPoi=function(e){var t=e.imageItem,n=e.imageTexture,r=e.imageTextureName;if(void 0===t||void 0===r||void 0===n)return-1;var i,o,a=e.renderOrder,s=n.image,u=this.m_batchMap.get(s);if(void 0===u&&(u=new Map,this.m_batchMap.set(s,u)),void 0!==(i=u.get(a)))return i;i=this.batches.length;var l=this.sceneSet.getScene(a);return void 0===l?-1:((o=new h(this.mapView,l,t,a)).init(),u.set(a,i),this.batches.push(o),i)},e.prototype.addPoi=function(e,t,n){var r=this.registerPoi(e);return a.assert(r>=0),r<0?-1:(a.assert(void 0!==e.uvBox),void 0===this.batches[r].boxBuffer&&this.batches[r].init(),this.batches[r].boxBuffer.addBox(t,e.uvBox,this.batches[r].color,n,e.textElement.renderDistance,e.textElement),r)},e.prototype.getBatch=function(e){if(e>=0)return a.assert(e<this.batches.length),this.batches[e]},e.prototype.reset=function(){var e,t;d=window.devicePixelRatio;try{for(var n=r(this.batches),i=n.next();!i.done;i=n.next()){i.value.reset()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.update=function(){var e,t;try{for(var n=r(this.batches),i=n.next();!i.done;i=n.next()){i.value.update()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.pickTextElements=function(e,t){var n,i;try{for(var o=r(this.batches),a=o.next();!a.done;a=o.next()){var s=a.value;void 0===s.boxBuffer&&s.init(),s.boxBuffer.pickBoxes(e,t,s.imageItem.imageData)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e}(),p=function(){function e(e,t){this.mapView=e,this.sceneSet=t,this.m_tempScreenBox=new a.Math2D.Box,this.m_renderBuffer=new f(e,t)}return e.prototype.prepareRender=function(e){return void 0===e.poiRenderBatch&&this.preparePoi(e),void 0!==e.poiRenderBatch},e.prototype.computeScreenBox=function(e,t,n,r,i){return!!this.computeIconScreenBox(e,t,n,i)&&r.isVisible(i)},e.prototype.isSpaceAvailable=function(e,t){return!e.isAllocated(t)},e.prototype.reset=function(){this.m_renderBuffer.reset()},e.prototype.renderPoi=function(e,t,n,r,i,o){a.assert(void 0!==e.poiRenderBatch),this.computeIconScreenBox(e,t,r,this.m_tempScreenBox)&&(i&&n.allocate(this.m_tempScreenBox),this.m_renderBuffer.addPoi(e,this.m_tempScreenBox,o))},e.prototype.poiIsRenderable=function(e){return void 0!==e.poiRenderBatch},e.prototype.update=function(){this.m_renderBuffer.update()},e.prototype.pickTextElements=function(e,t){this.m_renderBuffer.pickTextElements(e,t)},e.prototype.computeIconScreenBox=function(e,t,n,r){if(a.assert(void 0!==e.poiRenderBatch),void 0===this.m_renderBuffer.getBatch(e.poiRenderBatch))return!1;var i=e.computedWidth*n,o=e.computedHeight*n,s=e.technique,u=t.x+(void 0!==s.iconXOffset?s.iconXOffset:0),l=t.y+(void 0!==s.iconYOffset?s.iconYOffset:0);return r.x=u-i/2,r.y=l-o/2,r.w=i,r.h=o,!0},e.prototype.preparePoi=function(t){var n=this;if(void 0===t.poiRenderBatch&&!1!==t.isValid){var r=this.mapView.poiManager.getImageTexture(t.imageTextureName);if(void 0===r)return void 0===e.m_missingTextureName.get(t.imageTextureName)&&(e.m_missingTextureName.set(t.imageTextureName,!0),c.error("PoiRenderer#preparePoi: No imageTexture with name '"+t.imageTextureName+"' found")),void(t.isValid=!1);var i=r.image,o=this.mapView.imageCache.findImageByName(i);if(void 0===o)return c.error("PoiRenderer#init: No imageItem found with name '"+i+"'"),void(t.isValid=!1);if(!o.loaded){if(void 0!==o.loadingPromise)return;var a=o.url,s=this.mapView.imageCache.loadImage(o);if(s instanceof Promise)return void s.then(function(e){void 0!==e?n.setupPoiInfo(t,r,e):c.error("PoiRenderer#preparePoi: Failed to load imageItem: '"+a)}).catch(function(e){c.error("PoiRenderer#preparePoi: Failed to load imageItem: '"+a,e),t.isValid=!1});o=s}this.setupPoiInfo(t,r,o)}},e.prototype.setupPoiInfo=function(e,t,n){if(a.assert(void 0===e.uvBox),void 0===n||void 0===n.imageData)return c.error("PoiRenderer#setupPoiInfo: No imageItem/imageData found"),e.poiRenderBatch=-1,void(e.isValid=!1);var r,i,o=e.technique,s=n.imageData.width,u=n.imageData.height,l=void 0!==t.width?t.width:s,h=void 0!==t.height?t.height:u,f=0,p=1,m=void 0!==o.iconScale?o.iconScale:1,v=void 0!==o.iconScale?o.iconScale:1,g=void 0!==t.width?t.width:s,y=void 0!==t.height?t.height:u,_=void 0!==t.xOffset?t.xOffset:0,b=void 0!==t.yOffset?t.yOffset:0;r=_/s,i=(_+g)/s;f=(u-b)/u,p=(u-b-y)/u,void 0!==o.screenWidth&&(v=m=o.screenWidth/s),void 0!==o.screenHeight&&(v=o.screenHeight/u,void 0===o.screenWidth&&(m=v)),e.computedWidth=l*m*d,e.computedHeight=h*v*d,e.uvBox={s0:r,t0:p,s1:i,t1:f},e.imageItem=n,e.imageTexture=t,e.poiRenderBatch=this.m_renderBuffer.registerPoi(e),e.isValid=!0,a.assert(void 0!==e.poiRenderBatch)},e.m_missingTextureName=new Map,e}();t.PoiRenderer=p},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=new Function("return typeof window === 'undefined' || this !== window")(),a=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n}return r(t,e),t.prototype.set=function(e,n){this.value=e,this.dispatchEvent({type:t.SET_EVENT_TYPE,name:n,value:e})},t.SET_EVENT_TYPE="set",t}(i.EventDispatcher),s=function(){function e(){(this.m_optionsMap=new Map,!o&&"undefined"!=typeof window&&window)&&(window.__debugContext=this)}return e.prototype.setValue=function(e,t){var n=this.m_optionsMap.get(e);n?n.set(t,e):(n=new a(t),this.m_optionsMap.set(e,n))},e.prototype.getValue=function(e){var t=this.m_optionsMap.get(e);return t?t.value:void 0},e.prototype.hasOption=function(e){return void 0!==this.m_optionsMap.get(e)},e.prototype.addEventListener=function(e,t){var n=this.m_optionsMap.get(e);if(!n)throw Error("Unknown option: "+e);n.addEventListener(a.SET_EVENT_TYPE,t)},e.prototype.hasEventListener=function(e,t){var n=this.m_optionsMap.get(e);if(n)return n.hasEventListener(a.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)},e.prototype.removeEventListener=function(e,t){var n=this.m_optionsMap.get(e);if(!n)throw Error("Unknown option: "+e);n.removeEventListener(a.SET_EVENT_TYPE,t)},Object.defineProperty(e.prototype,"options",{get:function(){return this.m_optionsMap},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_optionsMap.forEach(function(e){e.set(void 0,"")})},e}();t.DebugContext=s,t.debugContext=new s},function(e,t,n){"use strict";var r=n(121),i=n(122);r.prototype.bbox=i.bbox,r.prototype.geoJSON=i.geoJSON,r.Rectangle=n(29),e.exports=r},function(e,t,n){"use strict";var r=n(29);function i(e){if(!(this instanceof i))return new i(e);var t=3,n=6;isNaN(e)||(t=Math.floor(e/2),n=e);var o={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=o;var a=function(e){for(var t,n=e.slice(),r=[];n.length;)(t=n.pop()).nodes?n=n.concat(t.nodes):t.leaf&&r.push(t);return r},s=function(e,n,i){var o,s,u,l=[],c=[],f=[];if(!e||!r.overlapRectangle(e,i))return f;var p={x:e.x,y:e.y,w:e.w,h:e.h,target:n};for(c.push(i.nodes.length),l.push(i);l.length>0;){if(o=l.pop(),s=c.pop()-1,"target"in p)for(;s>=0;){if(u=o.nodes[s],r.overlapRectangle(p,u)){if(p.target&&"leaf"in u&&u.leaf===p.target||!p.target&&("leaf"in u||r.containsRectangle(u,p))){f="nodes"in u?a(o.nodes.splice(s,1)):o.nodes.splice(s,1),r.makeMBR(o.nodes,o),delete p.target;break}"nodes"in u&&(0,c.push(s),l.push(o),o=u,s=u.nodes.length)}s--}else if("nodes"in p){o.nodes.splice(s+1,1),o.nodes.length>0&&r.makeMBR(o.nodes,o);for(var m=0;m<p.nodes.length;m++)h(p.nodes[m],o);p.nodes=[],0===l.length&&o.nodes.length<=1?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[],l.push(o),c.push(1)):l.length>0&&o.nodes.length<t?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[]):delete p.nodes}else r.makeMBR(o.nodes,o);1}return f},u=function(e){for(var t=c(e);e.length>0;)l(e,t[0],t[1]);return t},l=function(e,n,i){for(var o,a,s,u=r.squarifiedRatio(n.w,n.h,n.nodes.length+1),l=r.squarifiedRatio(i.w,i.h,i.nodes.length+1),c=e.length-1;c>=0;c--){var d=e[c],h={};h.x=Math.min(n.x,d.x),h.y=Math.min(n.y,d.y),h.w=Math.max(n.x+n.w,d.x+d.w)-h.x,h.h=Math.max(n.y+n.h,d.y+d.h)-h.y;var f=Math.abs(r.squarifiedRatio(h.w,h.h,n.nodes.length+2)-u),p={};p.x=Math.min(i.x,d.x),p.y=Math.min(i.y,d.y),p.w=Math.max(i.x+i.w,d.x+d.w)-p.x,p.h=Math.max(i.y+i.h,d.y+d.h)-p.y;var m=Math.abs(r.squarifiedRatio(p.w,p.h,i.nodes.length+2)-l);(!a||!o||Math.abs(m-f)<o)&&(a=c,o=Math.abs(m-f),s=m<f?i:n)}var v=e.splice(a,1)[0];n.nodes.length+e.length+1<=t?(n.nodes.push(v),r.expandRectangle(n,v)):i.nodes.length+e.length+1<=t?(i.nodes.push(v),r.expandRectangle(i,v)):(s.nodes.push(v),r.expandRectangle(s,v))},c=function(e){for(var t,n,r=e.length-1,i=0,o=e.length-1,a=0,s=e.length-2;s>=0;s--){var u=e[s];u.x>e[i].x?i=s:u.x+u.w<e[r].x+e[r].w&&(r=s),u.y>e[a].y?a=s:u.y+u.h<e[o].y+e[o].h&&(o=s)}return Math.abs(e[r].x+e[r].w-e[i].x)>Math.abs(e[o].y+e[o].h-e[a].y)?r>i?(t=e.splice(r,1)[0],n=e.splice(i,1)[0]):(n=e.splice(i,1)[0],t=e.splice(r,1)[0]):o>a?(t=e.splice(o,1)[0],n=e.splice(a,1)[0]):(n=e.splice(a,1)[0],t=e.splice(o,1)[0]),[{x:t.x,y:t.y,w:t.w,h:t.h,nodes:[t]},{x:n.x,y:n.y,w:n.w,h:n.h,nodes:[n]}]},d=function(e,t,n,i){var o=[];if(!r.overlapRectangle(e,i))return n;for(o.push(i.nodes);o.length>0;)for(var a=o.pop(),s=a.length-1;s>=0;s--){var u=a[s];r.overlapRectangle(e,u)&&("nodes"in u?o.push(u.nodes):"leaf"in u&&(t?n.push(u):n.push(u.leaf)))}return n},h=function(e,t){var i;if(0===t.nodes.length)return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,void t.nodes.push(e);for(var o,a=function(e,t){var n,i=-1,o=[],a=!0;o.push(t);for(var s=t.nodes;a||-1!==i;){a?a=!1:(o.push(s[i]),s=s[i].nodes,i=-1);for(var u=s.length-1;u>=0;u--){var l=s[u];if("leaf"in l){i=-1;break}var c=r.squarifiedRatio(l.w,l.h,l.nodes.length+1),d=Math.max(l.x+l.w,e.x+e.w)-Math.min(l.x,e.x),h=Math.max(l.y+l.h,e.y+e.h)-Math.min(l.y,e.y),f=r.squarifiedRatio(d,h,l.nodes.length+2);(i<0||Math.abs(f-c)<n)&&(n=Math.abs(f-c),i=u)}}return o}(e,t),s=e;a.length>0;){if(i&&"nodes"in i&&0===i.nodes.length){o=i,i=a.pop();for(var l=0;l<i.nodes.length;l++)if(i.nodes[l]===o||0===i.nodes[l].nodes.length){i.nodes.splice(l,1);break}}else i=a.pop();if("leaf"in s||"nodes"in s||Array.isArray(s)){if(Array.isArray(s)){for(var c=0;c<s.length;c++)r.expandRectangle(i,s[c]);i.nodes=i.nodes.concat(s)}else r.expandRectangle(i,s),i.nodes.push(s);if(i.nodes.length<=n)s={x:i.x,y:i.y,w:i.w,h:i.h};else{var d=u(i.nodes);s=d,a.length<1&&(i.nodes.push(d[0]),a.push(i),s=d[1])}}else r.expandRectangle(i,s),s={x:i.x,y:i.y,w:i.w,h:i.h}}};this.insertSubtree=h,this.getTree=function(){return o},this.setTree=function(e,t){return t||(t=o),function(e,t){return e.nodes=t.nodes,e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e}(t,e)},this.search=function(e,t,n){return d(e,t,n=n||[],o)};this.remove=function(e,t){return t&&"function"!=typeof t?function(e,t){return s(e,t,o)}(e,t):function(e){for(var t,n=1,r=[];n>0;)n=(t=s(e,!1,o)).length,r=r.concat(t);return r}(e)},this.insert=function(e,t){return h({x:e.x,y:e.y,w:e.w,h:e.h,leaf:t},o)}}i.prototype.toJSON=function(e){return JSON.stringify(this.root,!1,e)},i.fromJSON=function(e){var t=new i;return t.setTree(JSON.parse(e)),t},e.exports=i,"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"object"==typeof e&&"[object Array]"==={}.toString.call(e)})},function(e,t,n){"use strict";var r=n(29),i=function(e,t){if(t&&t.bbox)return{leaf:t,x:t.bbox[0],y:t.bbox[1],w:t.bbox[2]-t.bbox[0],h:t.bbox[3]-t.bbox[1]};for(var n=e.length,r=0,i=new Array(n);r<n;)i[r]=[e[r][0],e[r][1]],r++;var o=i[0];n=i.length,r=1;for(var a={min:[].concat(o),max:[].concat(o)};r<n;)i[r][0]<a.min[0]?a.min[0]=i[r][0]:i[r][0]>a.max[0]&&(a.max[0]=i[r][0]),i[r][1]<a.min[1]?a.min[1]=i[r][1]:i[r][1]>a.max[1]&&(a.max[1]=i[r][1]),r++;var s={x:a.min[0],y:a.min[1],w:a.max[0]-a.min[0],h:a.max[1]-a.min[1]};return t&&(s.leaf=t),s},o={point:function(e,t){return t.insertSubtree({x:e.geometry.coordinates[0],y:e.geometry.coordinates[1],w:0,h:0,leaf:e},t.root)},multiPointLineString:function(e,t){return t.insertSubtree(i(e.geometry.coordinates,e),t.root)},multiLineStringPolygon:function(e,t){return t.insertSubtree(i(Array.prototype.concat.apply([],e.geometry.coordinates),e),t.root)},multiPolygon:function(e,t){return t.insertSubtree(i(Array.prototype.concat.apply([],Array.prototype.concat.apply([],e.geometry.coordinates)),e),t.root)},makeRec:function(e){return r(e.x,e.y,e.w,e.h)},geometryCollection:function(e,t){if(e.bbox)return t.insertSubtree({leaf:e,x:e.bbox[0],y:e.bbox[1],w:e.bbox[2]-e.bbox[0],h:e.bbox[3]-e.bbox[1]},t.root);for(var n,r=e.geometry.geometries,a=0,s=r.length,u=[];a<s;){switch((n=r[a]).type){case"Point":u.push(o.makeRec({x:n.coordinates[0],y:n.coordinates[1],w:0,h:0}));break;case"MultiPoint":case"LineString":u.push(o.makeRec(i(n.coordinates)));break;case"MultiLineString":case"Polygon":u.push(o.makeRec(i(Array.prototype.concat.apply([],n.coordinates))));break;case"MultiPolygon":u.push(o.makeRec(i(Array.prototype.concat.apply([],Array.prototype.concat.apply([],n.coordinates)))));break;case"GeometryCollection":s=(r=r.concat(n.geometries)).length}a++}var l=u[0];for(a=1,s=u.length;a<s;)l.expand(u[a]),a++;return t.insertSubtree({leaf:e,x:l.x(),y:l.y(),h:l.h(),w:l.w()},t.root)}};t.geoJSON=function(e){var t,n;if(Array.isArray(e))t=e.slice();else if(e.features&&Array.isArray(e.features))t=e.features.slice();else{if(!(e instanceof Object))throw"this isn't what we're looking for";t=[e]}for(var r=t.length,i=0;i<r;){if("Feature"===(n=t[i]).type)switch(n.geometry.type){case"Point":o.point(n,this);break;case"MultiPoint":case"LineString":o.multiPointLineString(n,this);break;case"MultiLineString":case"Polygon":o.multiLineStringPolygon(n,this);break;case"MultiPolygon":o.multiPolygon(n,this);break;case"GeometryCollection":o.geometryCollection(n,this)}i++}},t.bbox=function(){var e,t,n,r;switch(arguments.length){case 1:e=arguments[0][0][0],t=arguments[0][0][1],n=arguments[0][1][0],r=arguments[0][1][1];break;case 2:e=arguments[0][0],t=arguments[0][1],n=arguments[1][0],r=arguments[1][1];break;case 4:e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3]}return this.search({x:e,y:t,w:n-e,h:r-t})}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.getLengths=function(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths},t}(i.LineCurve);t.SimpleLineCurve=o;var a=function(){function e(e,t,n){this.path=e,this.index=t,this.t=n}return Object.defineProperty(e.prototype,"curve",{get:function(){return this.path.curves[this.index]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point},enumerable:!0,configurable:!0}),e}();t.PathParam=a;var s=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.getLengths=function(){if(this.m_cache)return this.m_cache;var e=0,t=new Array;return t.push(0),this.curves.forEach(function(n){var r=n;e+=r.v1.distanceTo(r.v2),t.push(e)}),this.m_cache=t,t},t.prototype.getParamAt=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;++r)if(!(n[r]<t)){var i=n[r]-t,o=this.curves[r].getLength();return new a(this,r,0===o?0:1-i/o)}return null},t}(i.Path);t.SimplePath=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(4),u=n(2),l=n(3),c=n(1),d=n(0),h=n(33),f=n(41),p=n(59),m=n(30),v=n(50),g=n(61),y=n(19),_=n(58),b=n(57),x=n(127),w=n(128),T=n(62),C=n(18),E=n(63),S=n(12),A=n(130),P=!0;!function(e){e.Update="update",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored"}(a=t.MapViewEventNames||(t.MapViewEventNames={}));var M=c.LoggerManager.instance.create("MapView"),O="./resources/fonts/Default_FontCatalog.json",L=15722977,I=new d.Vector3(0,0,-1),F=40,R=140,k=10,D=1,j=20,B=20,U={type:a.Render},z={type:a.AfterRender},N={type:a.FirstFrame},G={type:a.FrameComplete},V={type:a.ThemeLoaded},H={type:a.AnimationStarted},W={type:a.AnimationFinished},q={type:a.MovementStarted},X={type:a.MovementFinished},Y={type:a.ContextLost},Z={type:a.ContextRestored};t.MapViewDefaults={projection:u.mercatorProjection,maxVisibleDataSourceTiles:20,extendedFrustumCulling:!0,tileCacheSize:40,tileCacheMemorySize:419430400,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2};var K=function(e){function n(n){var r=e.call(this)||this;r.defaultFontCatalog=O,r.defaultTextMaterialConstructor=l.TextMaterial,r.m_zoomLevelBias=1,r.m_screenProjector=new x.ScreenProjector,r.m_screenCollisions=new b.ScreenCollisions,r.m_visibleTileSetLock=!1,r.m_minZoomLevel=D,r.m_maxZoomLevel=j,r.m_minCameraHeight=B,r.m_screenCamera=new d.OrthographicCamera(-1,1,1,-1),r.m_tempVector3=new d.Vector3,r.m_pixelToWorld=1,r.m_scene=new d.Scene,r.m_fog=new g.MapViewFog(r.m_scene),r.m_worldCenter=new d.Vector3,r.m_mapTilesRoot=new d.Object3D,r.m_animationCount=0,r.m_drawing=!1,r.m_updatePending=!1,r.m_snapshot=0,r.m_defaultTextColor=new d.Color(0,0,0),r.m_overlayTextElements=[],r.m_forceCameraAspect=void 0,r.m_tileDataSources=[],r.m_connectedDataSources=new Set,r.m_raycaster=new d.Raycaster,r.m_plane=new d.Plane(new d.Vector3(0,0,1)),r.m_theme={styles:{}},r.m_logStatsFrames=100,r.m_firstFrameRendered=!1,r.m_firstFrameComplete=!1,r.m_imageCache=new v.MapViewImageCache(r),r.m_poiManager=new _.PoiManager(r),r.m_lastTileIds="",r.m_debugGlyphTextureCache=!1,r.onWebGLContextLost=function(e){r.dispatchEvent(Y),M.log("WebGL context lost",e)},r.onWebGLContextRestored=function(e){r.dispatchEvent(Z),void 0!==r.m_theme&&void 0!==r.m_theme.clearColor?r.m_renderer.setClearColor(new d.Color(r.m_theme.clearColor)):r.m_renderer.setClearColor(L),r.update(),M.log("WebGL context restored",e)},r.m_options=i({},n),void 0!==r.m_options.minZoomLevel&&(r.m_minZoomLevel=r.m_options.minZoomLevel),void 0!==r.m_options.maxZoomLevel&&(r.m_maxZoomLevel=r.m_options.maxZoomLevel),void 0!==r.m_options.minCameraHeight&&(r.m_minCameraHeight=r.m_options.minCameraHeight),void 0!==r.m_options.fontCatalog&&(r.defaultFontCatalog=r.m_options.fontCatalog),void 0!==r.m_options.textMaterialConstructor&&(r.defaultTextMaterialConstructor=r.m_options.textMaterialConstructor),void 0!==r.m_options.decoderUrl&&(p.ConcurrentDecoderFacade.defaultScriptUrl=r.m_options.decoderUrl),void 0!==r.m_options.decoderCount&&(p.ConcurrentDecoderFacade.defaultWorkerCount=r.m_options.decoderCount),r.m_visibleTileSetOptions=i({},t.MapViewDefaults),void 0!==n.projection&&(r.m_visibleTileSetOptions.projection=n.projection),void 0!==n.extendedFrustumCulling&&(r.m_visibleTileSetOptions.extendedFrustumCulling=n.extendedFrustumCulling),void 0!==n.maxVisibleDataSourceTiles&&(r.m_visibleTileSetOptions.maxVisibleDataSourceTiles=n.maxVisibleDataSourceTiles),void 0!==n.tileCacheSize&&(r.m_visibleTileSetOptions.tileCacheSize=n.tileCacheSize),void 0!==n.tileCacheMemorySize&&(r.m_visibleTileSetOptions.tileCacheMemorySize=n.tileCacheMemorySize),void 0!==n.quadTreeSearchDistanceUp&&(r.m_visibleTileSetOptions.quadTreeSearchDistanceUp=n.quadTreeSearchDistanceUp),void 0!==n.quadTreeSearchDistanceDown&&(r.m_visibleTileSetOptions.quadTreeSearchDistanceDown=n.quadTreeSearchDistanceDown),n.fov=u.MathUtils.clamp(void 0===n.fov?F:n.fov,k,R),r.m_options.enableStatistics=!0===r.m_options.enableStatistics,r.m_languages=r.m_options.languages||S.MapViewUtils.getBrowserLanguages(),P||void 0===r.m_options.collisionDebugCanvas||null===r.m_options.collisionDebugCanvas||(r.m_collisionDebugCanvas=r.m_options.collisionDebugCanvas,r.m_screenCollisions=new b.ScreenCollisionsDebug(r.m_collisionDebugCanvas)),r.handleRequestAnimationFrame=r.renderFunc.bind(r),r.m_pickHandler=new y.PickHandler(r,!0===r.m_options.enableRoadPicking),r.m_stats=new T.Statistics("MapView",r.m_options.enableStatistics),r.setupStats(),r.m_stagedRenderTimer=new T.MultiStageTimer(r.m_stats,"stagedRenderTimer",["render.setup","render.culling","render.text.render","render.draw","render.text.post","render.cleanup"]),r.m_renderer=new d.WebGLRenderer({canvas:r.canvas,antialias:!1!==r.m_options.enableNativeWebglAntialias,alpha:r.m_options.alpha,preserveDrawingBuffer:!0===r.m_options.preserveDrawingBuffer}),r.m_renderer.autoClear=!1,r.m_renderer.info.autoReset=!1,r.setupRenderer();var o=r.canvas,a=o.clientWidth,s=o.clientHeight,c=a/s;r.m_options.fov=r.limitFov(r.m_options.fov,c),r.m_camera=new d.PerspectiveCamera(r.m_options.fov,c,.1,4e6),r.setupCamera(),r.m_movementDetector=new h.CameraMovementDetector(r.m_options.movementThrottleTimeout,function(){return r.movementStarted()},function(){return r.movementFinished()});var m=r.m_options.customAntialiasSettings;return r.mapRenderingManager=new f.MapRenderingManager(a,s,m),r.m_visibleTiles=new A.VisibleTileSet(r.m_camera,r.m_visibleTileSetOptions),r.initTheme(),r.drawFrame(),r.canvas.addEventListener("webglcontextlost",r.onWebGLContextLost),r.canvas.addEventListener("webglcontextrestored",r.onWebGLContextRestored),r}return r(n,e),Object.defineProperty(n.prototype,"textElementsRenderer",{get:function(){return this.m_textElementsRenderer},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e,t;void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);try{for(var n=o(this.m_tileDataSources),r=n.next();!r.done;r=n.next()){r.value.dispose()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.m_visibleTiles.clearTileCache(),this.m_renderer.dispose(),this.m_imageCache.clear(),this.m_movementDetector.dispose()},n.prototype.getCacheSize=function(){return this.m_visibleTiles.getDataSourceCacheSize()},n.prototype.setCacheSize=function(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.updateImages(),this.updateLighting(),this.updateTextRenderer(),this.updateSkyBackground(),this.update()},Object.defineProperty(n.prototype,"extendedFrustumCulling",{get:function(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling},set:function(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lockVisibleTileSet",{get:function(){return this.m_visibleTileSetLock},set:function(e){this.m_visibleTileSetLock=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pointOfView",{get:function(){return this.m_pointOfView},set:function(e){this.m_pointOfView=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"theme",{get:function(){return this.m_theme},set:function(e){if(this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,this.updateSkyBackground(),this.m_fog.reset(this.m_theme),this.m_theme.lights=e.lights,this.updateLighting(),this.m_theme.clearColor=e.clearColor,this.renderer.setClearColor(new d.Color(e.clearColor)),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,this.updateImages(),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,this.updateTextRenderer(),void 0===this.m_theme.styles&&(this.m_theme.styles={}),void 0!==e.styles){var t=function(t){if(void 0!==e.styles[t]){var r=e.styles[t];n.getDataSourcesByStyleSetName(t).forEach(function(e){return e.setStyleSet(r)}),n.m_theme.styles[t]=r}},n=this;for(var r in e.styles)t(r)}this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"forceCameraAspect",{get:function(){return this.m_forceCameraAspect},set:function(e){this.m_forceCameraAspect=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"languages",{get:function(){return this.m_languages},set:function(e){var t=this;this.m_languages=e,this.m_tileDataSources.forEach(function(e){e.setLanguages(t.m_languages)}),this.update()},enumerable:!0,configurable:!0}),n.prototype.addEventListener=function(t,n){e.prototype.addEventListener.call(this,t,n)},n.prototype.removeEventListener=function(t,n){e.prototype.removeEventListener.call(this,t,n)},Object.defineProperty(n.prototype,"canvas",{get:function(){return this.m_options.canvas},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"collisionDebugCanvas",{get:function(){return this.m_collisionDebugCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scene",{get:function(){return this.m_scene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"camera",{get:function(){return this.m_camera},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderer",{get:function(){return this.m_renderer},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clearColor",{get:function(){return this.m_renderer.getClearColor().getHex()},set:function(e){this.m_renderer.setClearColor(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"defaultTextColor",{get:function(){return this.m_defaultTextColor},set:function(e){this.m_defaultTextColor.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projection",{get:function(){return this.m_visibleTileSetOptions.projection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"geoCenter",{get:function(){return this.projection.unprojectPoint(this.m_worldCenter)},set:function(e){this.projection.projectPoint(e,this.m_worldCenter),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"worldCenter",{get:function(){return this.m_worldCenter},set:function(e){this.m_worldCenter.copy(e),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"worldRootObject",{get:function(){return this.m_mapTilesRoot},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pickHandler",{get:function(){return this.m_pickHandler},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageCache",{get:function(){return this.m_imageCache},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"poiManager",{get:function(){return this.m_poiManager},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"minCameraHeight",{get:function(){return this.m_minCameraHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"minZoomLevel",{get:function(){return this.m_minZoomLevel},set:function(e){this.m_minZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxZoomLevel",{get:function(){return this.m_maxZoomLevel},set:function(e){this.m_maxZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zoomLevelBias",{get:function(){return this.m_zoomLevelBias},set:function(e){this.m_zoomLevelBias=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zoomLevel",{get:function(){var e=Math.abs(this.camera.position.z),t=S.MapViewUtils.calculateZoomLevelFromHeight(e,this);return Math.floor(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fov",{get:function(){return this.m_camera.fov},set:function(e){e=this.limitFov(e,this.m_camera.aspect),this.m_camera.fov=e,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewportHeight",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataSources",{get:function(){return this.m_tileDataSources},enumerable:!0,configurable:!0}),n.prototype.getDataSourceByName=function(e){return this.m_tileDataSources.find(function(t){return t.name===e})},n.prototype.getDataSourcesByStyleSetName=function(e){return this.m_tileDataSources.filter(function(t){return t.styleSetName===e})},n.prototype.addDataSource=function(e){var t=this;if(void 0!==this.getDataSourceByName(e.name))throw new Error('A DataSource with the name "'+e.name+'" already exists in this MapView.');return e.attach(this),this.m_tileDataSources.push(e),e.connect().then(function(){if(!(-1===t.m_tileDataSources.indexOf(e))){if(e.addEventListener(a.Update,function(){t.update()}),void 0!==t.m_theme.styles&&void 0!==e.styleSetName){var n=t.m_theme.styles[e.styleSetName];e.setStyleSet(n,t.m_languages)}t.m_connectedDataSources.add(e.name),t.dispatchEvent({type:a.DataSourceConnect,dataSourceName:e.name}),t.update()}}).catch(function(n){t.dispatchEvent({type:a.DataSourceConnect,dataSourceName:e.name,error:n})})},n.prototype.removeDataSource=function(e){var t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e.name),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.update())},Object.defineProperty(n.prototype,"visibleTileSet",{get:function(){return this.m_visibleTiles},enumerable:!0,configurable:!0}),n.prototype.addOverlayText=function(e){void 0!==this.m_overlayTextElements&&(this.m_overlayTextElements=this.m_overlayTextElements.concat(e)),this.updateTextRenderer(),this.update()},n.prototype.clearOverlayText=function(){this.m_overlayTextElements=[]},n.prototype.setCameraGeolocationAndZoom=function(e,t,n,r){void 0!==n&&void 0!==r&&S.MapViewUtils.setRotation(this,n,r),this.geoCenter=e,this.camera.position.set(0,0,0),S.MapViewUtils.zoomOnTargetPosition(this,0,0,t),this.update()},Object.defineProperty(n.prototype,"animating",{get:function(){return this.m_animationCount>0},enumerable:!0,configurable:!0}),n.prototype.beginAnimation=function(){0==this.m_animationCount++&&(this.m_updatePending||(this.m_updatePending=!0,this.drawFrame()),H.time=Date.now(),this.dispatchEvent(H))},n.prototype.endAnimation=function(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(W.time=Date.now(),this.dispatchEvent(W))},Object.defineProperty(n.prototype,"cameraIsMoving",{get:function(){return this.m_movementDetector.cameraIsMoving},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pixelToWorld",{get:function(){return this.m_pixelToWorld},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wordlToPixel",{get:function(){return 1/this.m_pixelToWorld},enumerable:!0,configurable:!0}),n.prototype.getScreenPosition=function(e){var t=new d.Vector3;this.projection.projectPoint(e,t);var n=this.m_screenProjector.project(t);if(void 0!==n){var r=this.canvas,i=r.width,o=r.height;n.x=(n.x+i/2)/window.devicePixelRatio,n.y=(o-(n.y+o/2))/window.devicePixelRatio}return n},n.prototype.getWorldPositionAt=function(e,t){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);var n=new d.Vector3,r=this.m_raycaster.ray.intersectPlane(this.m_plane,n);return r?(r.add(this.m_worldCenter),r):null},n.prototype.getGeoCoordinatesAt=function(e,t){var n=this.getWorldPositionAt(e,t);return n?this.projection.unprojectPoint(n):null},n.prototype.getNormalizedScreenCoordinates=function(e,t){var n=this.canvas,r=n.clientWidth,i=n.clientHeight;return new d.Vector3(e/r*2-1,-t/i*2+1,0)},n.prototype.intersectMapObjects=function(e,t){return this.m_pickHandler.intersectMapObjects(e,t)},n.prototype.resize=function(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.setPixelRatio(window.devicePixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update()},n.prototype.update=function(){this.m_updatePending||(this.m_updatePending=!0,this.animating||this.drawFrame())},Object.defineProperty(n.prototype,"updatePending",{get:function(){return this.m_updatePending},enumerable:!0,configurable:!0}),n.prototype.requestUpdateIfNeeded=function(){this.update()},n.prototype.clearTileCache=function(e){this.m_visibleTiles.clearTileCache(e)},n.prototype.forEachVisibleTile=function(e){this.m_visibleTiles.forEachVisibleTile(e)},n.prototype.forEachCachedTile=function(e){this.m_visibleTiles.forEachCachedTile(e)},n.prototype.markTilesDirty=function(e){this.m_visibleTiles.markTilesDirty(e)},Object.defineProperty(n.prototype,"fog",{get:function(){return this.m_fog},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"debugGlyphTextureCache",{set:function(e){this.m_debugGlyphTextureCache=e},enumerable:!0,configurable:!0}),n.prototype.updateCameras=function(){var e=this.canvas,t=e.width,n=e.height;this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:t/n,this.m_camera.fov=this.limitFov(this.m_camera.fov,this.m_camera.aspect);var r=Math.max(.1,.1*this.m_camera.position.z),i=50*r+200;if(void 0!==this.m_options.farPlaneEvaluator){this.camera.getWorldDirection(this.m_tempVector3);var o=d.Math.radToDeg(this.m_tempVector3.angleTo(I)),a=this.m_options.farPlaneEvaluator(this,o,r,i);r=Math.max(.1,a.near),i=Math.max(r+200,a.far)}this.m_camera.near=r,this.m_camera.far=i,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCamera.left=t/-2,this.m_screenCamera.right=t/2,this.m_screenCamera.bottom=n/-2,this.m_screenCamera.top=n/2,this.m_screenCamera.updateProjectionMatrix(),this.m_screenCamera.updateMatrixWorld(!1),this.m_screenProjector.update(this.m_camera,this.m_worldCenter,t,n),this.m_screenCollisions.update(t,n);var s=this.getWorldPositionAt(.5*t,n),u=this.getWorldPositionAt(.5*t+1,n);null!==s&&null!==u&&(this.m_pixelToWorld=u.sub(s).length())},n.prototype.drawFrame=function(){this.m_drawing||(void 0!==this.m_animationFrameHandle&&cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))},n.prototype.renderFunc=function(e){this.render(e)},n.prototype.getEnabledTileDataSources=function(){var e,t,n=[];try{for(var r=o(this.m_tileDataSources),i=r.next();!i.done;i=r.next()){var a=i.value;a.enabled&&(a.ready()&&this.m_connectedDataSources.has(a.name)&&n.push(a))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},n.prototype.render=function(e){var t=this;if(!this.m_drawing){for(this.m_renderer.info.reset(),this.m_stagedRenderTimer.start(),this.m_updatePending=!1,++this.m_snapshot,this.m_drawing=!0,this.m_renderer.setPixelRatio(window.devicePixelRatio),U.time=e,this.dispatchEvent(U),this.updateCameras(),this.m_fog.update(this.m_camera),this.m_renderer.clear(),m.resetDepthBasedPolygonOffsetIndex();this.m_mapTilesRoot.children.length>0;)this.m_mapTilesRoot.remove(this.m_mapTilesRoot.children[0]);var n=d.Math.clamp(this.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel);this.m_stagedRenderTimer.stage="render.culling",this.lockVisibleTileSet||this.m_visibleTiles.updateRenderList(this.m_worldCenter,n,this.zoomLevel,this.getEnabledTileDataSources()),this.m_visibleTiles.dataSourceTileList.forEach(function(e){var n=e.zoomLevel;e.renderedTiles.forEach(function(e){t.renderTileObjects(e,n)})}),this.checkCameraMoved();var r=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_camera;if(this.prepareRenderTextElements(e),this.m_stagedRenderTimer.stage="render.draw",this.m_stats.enabled){var i=c.PerformanceTimer.now();if(void 0!==this.m_previousFrameTimeStamp){var o=i-this.m_previousFrameTimeStamp;this.m_stats.getTimer("render.frameTime").setValue(o),this.m_stats.getTimer("render.fps").setValue(1e3/o)}this.m_previousFrameTimeStamp=i}void 0!==this.m_skyBackground&&this.m_skyBackground.update(this.m_camera);var a=!(this.animating||this.m_updatePending);this.mapRenderingManager.render(this.m_renderer,this.m_scene,r,a),this.finishRenderTextElements(),this.m_stagedRenderTimer.stage="render.cleanup",z.time=e,this.dispatchEvent(z),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,N.time=e,this.dispatchEvent(N)),this.m_firstFrameComplete||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_updatePending||this.animating||void 0===this.m_textElementsRenderer||this.m_textElementsRenderer.loading||(this.m_firstFrameComplete=!0,G.time=e,this.dispatchEvent(G)),this.m_visibleTiles.disposePendingTiles(),this.m_stagedRenderTimer.stop(),this.m_drawing=!1,this.m_stats.enabled&&this.m_snapshot%this.m_logStatsFrames==0&&this.m_stats.log(),(this.animating||this.m_updatePending)&&this.drawFrame()}},n.prototype.renderTileObjects=function(e,t){var n,r;if(e.willRender(t))try{for(var i=o(e.objects),a=i.next();!a.done;a=i.next()){var s=a.value;s.position.copy(e.center),void 0!==s.displacement&&s.position.add(s.displacement),s.position.sub(this.m_worldCenter),this.m_mapTilesRoot.add(s)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.didRender()},n.prototype.prepareRenderTextElements=function(e){(this.checkIfTextElementsChanged()||this.checkIfTilesChanged())&&void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.placeAllTileLabels(),this.m_stagedRenderTimer.stage="render.text.render";var t=void 0!==this.m_pointOfView;if(void 0!==this.m_textElementsRenderer&&!t){var n;this.m_textElementsRenderer.debugGlyphTextureCache=this.m_debugGlyphTextureCache,this.camera.getWorldDirection(this.m_tempVector3);var r=d.Math.radToDeg(this.m_tempVector3.angleTo(I));if(void 0!==this.m_options.labelVisibilityEvaluator)n=this.m_options.labelVisibilityEvaluator(this,r);else n=r<(void 0===this.m_options.maxLabelAngle?90:this.m_options.maxLabelAngle);this.m_textElementsRenderer.reset(),n&&(this.m_textElementsRenderer.renderUserTextElements(e,this.m_snapshot),this.m_textElementsRenderer.renderAllTileText(e,this.m_snapshot)),this.m_textElementsRenderer.renderOverlay(this.m_overlayTextElements),this.m_textElementsRenderer.update(this.m_renderer)}},n.prototype.finishRenderTextElements=function(){this.m_stagedRenderTimer.stage="render.text.post",void 0===this.m_pointOfView&&this.m_textElementsRenderer&&(this.m_textElementsRenderer.end(),this.m_screenCamera.far=this.camera.far,this.m_textElementsRenderer.renderText(this.m_renderer,this.m_screenCamera))},n.prototype.initTheme=function(){var e=this;void 0!==this.m_options.theme&&("string"==typeof this.m_options.theme?E.ThemeLoader.loadAsync(this.m_options.theme):Promise.resolve(this.m_options.theme)).then(function(t){V.time=Date.now(),e.dispatchEvent(V),e.theme=t})},n.prototype.setupCamera=function(){var e=this.canvas,t=e.clientWidth,n=e.clientHeight;this.m_scene.add(this.m_camera),this.m_camera.position.set(0,0,3e3),this.m_camera.lookAt(new d.Vector3(0,0,0)),this.m_visibleTiles=new A.VisibleTileSet(this.m_camera,this.m_visibleTileSetOptions),this.resize(t,n),this.geoCenter=new u.GeoCoordinates(52.518611,13.376111,0),this.m_screenCamera.position.z=1,this.m_screenCamera.near=0},n.prototype.updateSkyBackground=function(){if(void 0!==this.m_theme){var e=this.m_theme;if(this.m_skyBackground instanceof w.SkyBackground&&void 0!==e.sky)this.updateSkyBackgroundColors(e.sky,e.clearColor);else{if(void 0===this.m_skyBackground&&void 0!==e.sky)return void this.addNewSkyBackground(e.sky,e.clearColor);this.m_skyBackground instanceof w.SkyBackground&&void 0===e.sky&&this.removeSkyBackGround()}}},n.prototype.addNewSkyBackground=function(e,t){var n=void 0===e.groundColor?t:e.groundColor;this.m_skyBackground=new w.SkyBackground(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(n),this.camera,e.monomialPower),this.m_scene.background=this.m_skyBackground.texture},n.prototype.removeSkyBackGround=function(){this.m_scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.texture.dispose(),this.m_skyBackground=void 0)},n.prototype.updateSkyBackgroundColors=function(e,t){var n=void 0===e.groundColor?t:e.groundColor;void 0!==this.m_skyBackground&&this.m_skyBackground.updateColors(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(n))},n.prototype.updateLighting=function(){var e=this;if(this.m_theme){var t=this.m_theme;void 0!==t.clearColor&&this.m_renderer.setClearColor(new d.Color(t.clearColor)),this.m_createdLights&&this.m_createdLights.forEach(function(t){e.m_scene.remove(t)}),void 0!==t.lights&&(this.m_createdLights=[],t.lights.forEach(function(t){var n=s.createLight(t);n?(e.m_scene.add(n),e.m_createdLights.push(n)):M.log("MapView: failed to create light "+t.name+" of type "+t.type)}))}},n.prototype.movementStarted=function(){void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementStarted(),q.time=Date.now(),this.dispatchEvent(q)},n.prototype.movementFinished=function(){var e=this;void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementFinished(),X.time=Date.now(),this.dispatchEvent(X),this.animating||setTimeout(function(){return e.update()},0)},n.prototype.checkCameraMoved=function(){return this.m_movementDetector.checkCameraMoved(this)},n.prototype.checkIfTextElementsChanged=function(){var e=!1;return this.m_visibleTiles.dataSourceTileList.forEach(function(t){t.renderedTiles.forEach(function(t){t.textElementsChanged&&(t.textElementsChanged=!1,e=!0)})}),e},n.prototype.checkIfTilesChanged=function(){var e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(function(e){var n=e.dataSource;e.renderedTiles.forEach(function(e){t.push(n.name+"-"+e.tileKey.mortonCode())})}),t.sort();var n=t.join("#");return n!==this.m_lastTileIds&&(this.m_lastTileIds=n,!0)},n.prototype.updateImages=function(){var e=this;if(this.m_theme){var t=this.m_theme;this.m_imageCache.clear(),this.poiManager.clear(),void 0!==t.images&&t.images.forEach(function(t){e.m_imageCache.addImage(t.name,t.url,!0===t.preload),"string"==typeof t.atlas&&e.poiManager.addTextureAtlas(t.name,t.atlas)}),void 0!==t.imageTextures&&t.imageTextures.forEach(function(t){e.poiManager.addImageTexture(t)})}},Object.defineProperty(n.prototype,"statistics",{get:function(){if(void 0===this.m_stats)throw new Error("Statistics are not initialized.");return this.m_stats},enumerable:!0,configurable:!0}),n.prototype.setupStats=function(){this.m_stats.createTimer("render.frameTime",!0),this.m_stats.createTimer("render.fps",!0),this.m_stats.createTimer("render.setup",!0),this.m_stats.createTimer("render.culling",!0),this.m_stats.createTimer("render.text.render",!0),this.m_stats.createTimer("render.draw",!0),this.m_stats.createTimer("render.text.post",!0),this.m_stats.createTimer("render.cleanup",!0),this.m_stats.createTimer("decoding",!0),this.m_stats.createTimer("geometryCreation",!0),this.m_stagedRenderTimer=new T.MultiStageTimer(this.m_stats,"stagedRenderTimer",["render.setup","render.culling","render.text.render","render.draw","render.text.post","render.cleanup"])},n.prototype.setupRenderer=function(){this.m_renderer.setClearColor(L),this.m_scene.add(this.m_mapTilesRoot)},n.prototype.updateTextRenderer=function(){void 0!==this.m_theme&&(void 0===this.m_textElementsRenderer&&(this.m_textElementsRenderer=new C.TextElementsRenderer(this,this.m_screenCollisions,this.m_screenProjector,this.m_theme,this.m_options.maxNumVisibleLabels,this.m_options.numSecondChanceLabels,this.m_options.maxDistanceRatioForLabels,this.m_options.labelStartScaleDistance,this.defaultTextMaterialConstructor)),this.m_textElementsRenderer.placeAllTileLabels())},n.prototype.limitFov=function(e,t){e=u.MathUtils.clamp(void 0===e?F:e,k,R);var n=u.MathUtils.radToDeg(S.MapViewUtils.calculateHorizontalFovByVerticalFov(u.MathUtils.degToRad(e),t));return(n>R||n<k)&&(n=u.MathUtils.clamp(n,k,R),e=u.MathUtils.radToDeg(S.MapViewUtils.calculateVerticalFovByHorizontalFov(u.MathUtils.degToRad(n),t))),e},n}(d.EventDispatcher);t.MapView=K},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(4),u=n(1),l=n(126),c=u.LoggerManager.instance.create("ConcurrentWorkerSet");function d(e){return e&&"number"==typeof e.level&&e.type===u.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=d;var h=function(){function e(e){var t=this;this.m_options=e,this.m_workerChannelLogger=u.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=function(e){var n,r,i,o,l,h;if(s.isResponseMessage(e.data)){var f=e.data;if(null===f.messageId)return void c.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: no messageId");var p=t.m_requests.get(f.messageId);if(void 0===p)return void c.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: invalid messageId");p.resolver(f.error,f.response)}else if(s.isInitializedMessage(e.data)){var m=t.getReadyPromise(e.data.service);++m.count===t.m_workerPromises.length&&m.resolve()}else if(d(e.data))switch(e.data.level){case u.LogLevel.Trace:(n=t.m_workerChannelLogger).trace.apply(n,a(e.data.message));break;case u.LogLevel.Debug:(r=t.m_workerChannelLogger).debug.apply(r,a(e.data.message));break;case u.LogLevel.Log:(i=t.m_workerChannelLogger).log.apply(i,a(e.data.message));break;case u.LogLevel.Info:(o=t.m_workerChannelLogger).info.apply(o,a(e.data.message));break;case u.LogLevel.Warn:(l=t.m_workerChannelLogger).warn.apply(l,a(e.data.message));break;case u.LogLevel.Error:(h=t.m_workerChannelLogger).error.apply(h,a(e.data.message))}else t.eventHandler(e)},this.start()}return e.prototype.addReference=function(){this.m_referenceCount+=1},e.prototype.removeReference=function(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()},e.prototype.start=function(e){var t=this;if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");for(var n=u.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?Math.max(1,navigator.hardwareConcurrency):void 0,4),r=function(e){var n=l.WorkerLoader.startWorker(i.m_options.scriptUrl);n.then(function(e){e.addEventListener("message",t.onWorkerMessage),t.m_workers.push(e)}).catch(function(t){c.error("failed to load worker "+e+": "+t)}),i.m_workerPromises.push(n)},i=this,o=0;o<n;++o)r(o);this.m_stopped=!1},e.prototype.stop=function(){return r(this,void 0,void 0,function(){var e=this;return i(this,function(t){switch(t.label){case 0:return this.m_stopped=!0,[4,this.waitForAllResponses().then(function(){e.terminateWorkers()})];case 1:return t.sent(),[2]}})})},e.prototype.destroy=function(){this.m_stopped=!0,this.m_requests.forEach(function(e){e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.terminateWorkers(),this.m_eventListeners.clear()},e.prototype.connect=function(e){return this.ensureStarted(),this.getReadyPromise(e).promise},e.prototype.addEventListener=function(e,t){this.m_eventListeners.set(e,t)},e.prototype.removeEventListener=function(e){this.m_eventListeners.delete(e)},e.prototype.invokeRequest=function(e,t,n){var r=this;this.ensureStarted();var i,o=this.m_nextMessageId++,a=new Promise(function(e,t){i=function(n,i){r.m_requests.delete(o),void 0!==n?t(new Error(n.toString())):e(i)}});this.m_requests.set(o,{promise:a,resolver:i});var u={service:e,type:s.DecodedTileMessageName.Request,messageId:o,request:t};return this.postMessage(u,n),a},e.prototype.postMessage=function(e,t){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");var n=Math.floor(Math.random()*this.m_workers.length);this.m_workers[n].postMessage(e,t)},e.prototype.broadcastMessage=function(e,t){this.ensureStarted(),this.m_workers.forEach(function(n){return n.postMessage(e,t)})},e.prototype.eventHandler=function(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)},e.prototype.ensureStarted=function(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")},e.prototype.waitForAllResponses=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return e=new Array,this.m_requests.forEach(function(t){e.push(t.promise)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},e.prototype.dispatchEvent=function(e,t){var n=this.m_eventListeners.get(e);void 0!==n&&n(t)},e.prototype.terminateWorkers=function(){var e=this;this.m_workerPromises.forEach(function(t){t.then(function(t){t.removeEventListener("message",e.onWorkerMessage),t.terminate()}).catch(function(){})}),this.m_workers=[],this.m_workerPromises=[],this.m_readyPromises.clear()},e.prototype.getReadyPromise=function(e){var t=this,n=this.m_readyPromises.get(e);if(void 0!==n)return n;var r={count:0,promise:void 0,resolve:function(){},reject:function(e){r.error=e},error:void 0};return r.promise=new Promise(function(e,n){var i=r;void 0!==i.error?n(i.error):i.count===t.m_workerPromises.length&&e(),i.resolve=e,i.reject=n}),this.m_readyPromises.set(e,r),r},e}();t.ConcurrentWorkerSet=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(11);var r=n(1).LoggerManager.instance.create("WorkerLoader"),i=function(){function e(){}return e.startWorker=function(t){var n=this;return t.startsWith("blob:")?this.startWorkerImmediately(t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(t):this.startWorkerImmediately(t).catch(function(i){return r.log("#startWorker: worker construction failed, attempting load with blob"),n.directlyFallbackToBlobBasedLoading=!0,e.startWorkerBlob(t)})},e.startWorkerImmediately=function(e){try{var t=new Worker(e);return this.waitWorkerInitialized(t)}catch(e){return Promise.reject(e)}},e.startWorkerBlob=function(e){var t=this;return this.fetchScriptSourceToBlobUrl(e).then(function(e){return t.startWorkerImmediately(e)})},e.fetchScriptSourceToBlobUrl=function(e){var t=this,n=this.sourceLoaderCache.get(e);return void 0!==n?n:(n=fetch(e).then(function(e){return e.text()}).catch(function(e){throw new Error("WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: "+e)}).then(function(n){t.sourceLoaderCache.delete(e);var r=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(r)}),this.sourceLoaderCache.set(e,n),n)},e.waitWorkerInitialized=function(e){return new Promise(function(t,n){var r=function(n){e.removeEventListener("message",r),e.removeEventListener("error",i),t(e),setTimeout(function(){e.dispatchEvent(n)},0)},i=function(t){e.removeEventListener("message",r),e.removeEventListener("error",i),n(new Error("#waitWorkerInitialized: Error event before first message."))};e.addEventListener("message",r),e.addEventListener("error",i)})},e.directlyFallbackToBlobBasedLoading=!1,e.sourceLoaderCache=new Map,e}();t.WorkerLoader=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){this.m_projectionViewMatrix=new r.Matrix4,this.m_viewMatrix=new r.Matrix4,this.m_cameraPosition=new r.Vector3,this.m_center=new r.Vector3,this.m_width=0,this.m_height=0,this.m_nearClipPlane=0,this.m_farClipPlane=0}return Object.defineProperty(e.prototype,"width",{get:function(){return this.m_width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.m_height},enumerable:!0,configurable:!0}),e.prototype.projectVector=function(e){return e.x-=this.m_center.x+this.m_cameraPosition.x,e.y-=this.m_center.y+this.m_cameraPosition.y,e.z-=this.m_center.z+this.m_cameraPosition.z,e.applyMatrix4(this.m_projectionViewMatrix),e},e.prototype.project=function(e,t){void 0===t&&(t=new r.Vector2);var n=this.projectVector(e.clone());if(n.z>0&&n.z<1)return t.set(n.x*this.m_width/2,n.y*this.m_height/2),t},e.prototype.update=function(e,t,n,i){this.m_width=n,this.m_height=i,e instanceof r.PerspectiveCamera&&(this.m_nearClipPlane=e.near,this.m_farClipPlane=e.far),this.m_center.copy(t),this.m_viewMatrix.makeRotationFromQuaternion(e.quaternion),this.m_viewMatrix.transpose(),this.m_cameraPosition.copy(e.position),this.m_projectionViewMatrix.multiplyMatrices(e.projectionMatrix,this.m_viewMatrix)},e}();t.ScreenProjector=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(129),o=function(){function e(e,t,n,o,a){void 0===a&&(a=i.DEFAULT_MONOMIAL_POWER),this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=n,this.m_monomialPower=a,this.m_gradient=new i.SkyGradientTexture(e,t,n,a),this.m_farClipPlaneDividedVertically=new r.Line3,this.m_groundPlane=new r.Plane(new r.Vector3(0,0,1)),this.m_bottomMidFarPoint=new r.Vector3,this.m_topMidFarPoint=new r.Vector3,this.m_horizonPosition=new r.Vector3,this.m_farClipPlaneCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.update(o)}return Object.defineProperty(e.prototype,"topColor",{get:function(){return this.m_topColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomColor",{get:function(){return this.m_bottomColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundColor",{get:function(){return this.m_groundColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monomialPower",{get:function(){return this.m_monomialPower},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_gradient.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizon",{get:function(){return this.m_horizonPosition},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.setHorizonPosition(e),this.updateTexturePosition()},e.prototype.updateColors=function(e,t,n){this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=n,this.m_gradient.update(e,t,n)},e.prototype.setHorizonPosition=function(e){this.setFarPlaneCornersFromCamera(e,this.m_farClipPlaneCorners);var t=this.m_farClipPlaneCorners[0],n=this.m_farClipPlaneCorners[1],r=this.m_farClipPlaneCorners[2],i=this.m_farClipPlaneCorners[3];this.setMidPoint(t,n,this.m_bottomMidFarPoint),this.setMidPoint(r,i,this.m_topMidFarPoint),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)},e.prototype.updateTexturePosition=function(){var e,t=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance();0===this.m_horizonPosition.length()?e=1:e=t-1/this.m_gradient.texture.image.height;this.m_bottomMidFarPoint.z<=0?this.m_gradient.updateYOffset(-e):this.m_gradient.updateYOffset(t)},e.prototype.setMidPoint=function(e,t,n){n.set((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},e.prototype.setFarPlaneCornersFromCamera=function(e,t){var n=0;function r(r,i,o){t[n++].set(r,i,o).unproject(e)}r(-1,-1,1),r(1,-1,1),r(-1,1,1),r(1,1,1)},e}();t.SkyBackground=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.DEFAULT_TEXTURE_HEIGHT=512;t.DEFAULT_MONOMIAL_POWER=1;var i=function(){function e(e,n,r,i,o){void 0===o&&(o=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=n,this.m_groundColor=r,this.m_monomialPower=i,this.m_height=o,this.m_texture=this.createTexture()}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_texture},enumerable:!0,configurable:!0}),e.prototype.updateYOffset=function(e){this.m_texture.offset.set(0,e)},e.prototype.update=function(e,n,r,i){void 0===i&&(i=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=n,this.m_groundColor=r,this.updateTextureColors()},e.prototype.updateTextureColors=function(){var e=this.m_texture.image.data;this.fillTextureData(e),this.m_texture.needsUpdate=!0},e.prototype.createTexture=function(){var e=1*this.m_height,t=new Uint8Array(3*e);this.fillTextureData(t);var n=new r.DataTexture(t,1,this.m_height,r.RGBFormat);return n.needsUpdate=!0,n.unpackAlignment=1,n},e.prototype.fillTextureData=function(e){var t=1*this.m_height,n=this.m_topColor,i=this.m_bottomColor,o=this.m_groundColor;e[0]=255*o.r,e[1]=255*o.g,e[2]=255*o.b;for(var a=new r.Color,s=1;s<t;s++){var u=a.copy(i).lerp(n,Math.pow(s/t,this.m_monomialPower)).multiplyScalar(255),l=u.r,c=u.g,d=u.b,h=3*s;e[h]=l,e[h+1]=c,e[h+2]=d}},e}();t.SkyGradientTexture=i},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(131),o=n(2),a=n(52),s=n(0),u=function(){return function(e,t){this.tile=e,this.area=t}}();t.TileEntry=u;var l=function(){return function(e,t){this.tileKey=e,this.area=t}}(),c=function(){function e(e){var t=this;this.disposedTiles=[],this.tileCache=new a.LRUCache(e.tileCacheSize),this.tileCache.evictionCallback=function(e,n){t.disposedTiles.push(n)}}return e.prototype.disposeTiles=function(){this.disposedTiles.forEach(function(e){e.dispose()}),this.disposedTiles.length=0},e.prototype.get=function(e){return this.tileCache.get(e)},e}(),d=function(){function e(e,t){this.camera=e,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_dataSourceCache=new Map,this.m_viewProjectionMatrix=new s.Matrix4,this.m_frustum=new s.Frustum,this.m_mapTileCuller=new i.MapTileCuller(e),this.options=t}return e.prototype.getDataSourceCacheSize=function(){return this.options.tileCacheSize},e.prototype.setDataSourceCacheSize=function(e){this.options.tileCacheSize=e,this.m_dataSourceCache.forEach(function(t){t.tileCache.setCapacity(e)})},e.prototype.getNumberOfVisibleTiles=function(){return this.options.maxVisibleDataSourceTiles},e.prototype.setNumberOfVisibleTiles=function(e){this.options.maxVisibleDataSourceTiles=e},e.prototype.updateRenderList=function(e,t,n,i){var a,u,c=this;this.m_viewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.m_frustum.setFromMatrix(this.m_viewProjectionMatrix);var d=o.TileKey.fromRowColumnLevel(0,0,0),h=new s.Box3,f=[],p=!0;this.options.extendedFrustumCulling&&this.m_mapTileCuller.setup();var m=function(r){var i=r.getDisplayZoomLevel(n),o=r.getTilingScheme(),a=[new l(d,0)],u=[],m=new Map;for(m.set(d.mortonCode(),1/0);a.length>0;){if(void 0!==(x=a.pop())){var g=m.get(x.tileKey.mortonCode());if(void 0===g)throw new Error("Unexpected tile key");g<=0||x.tileKey.level>i||(r.shouldRender(i,x.tileKey)&&u.push(x),o.getSubTileKeys(x.tileKey).forEach(function(t){var n=0;if(void 0===m.get(t.mortonCode())){var r=o.getGeoBox(t);if(c.options.projection.projectBox(r,h),h.min.sub(e),h.max.sub(e),(!c.options.extendedFrustumCulling||c.m_mapTileCuller.frustumIntersectsTileBox(h))&&c.m_frustum.intersectsBox(h)){var i=[new s.Vector3(h.min.x,h.min.y,0).applyMatrix4(c.m_viewProjectionMatrix),new s.Vector3(h.max.x,h.min.y,0).applyMatrix4(c.m_viewProjectionMatrix),new s.Vector3(h.max.x,h.max.y,0).applyMatrix4(c.m_viewProjectionMatrix),new s.Vector3(h.min.x,h.max.y,0).applyMatrix4(c.m_viewProjectionMatrix)];i.push(i[0]);for(var u=i.length,d=u-1,f=0;f<u;d=f++)n+=i[d].x*i[f].y-i[f].x*i[d].y;n=Math.abs(.5*n)}m.set(t.mortonCode(),n)}n>0&&a.push(new l(t,n))}))}}u.sort(function(e,t){var n=t.area-e.area,r=.001*(e.area+t.area);return Math.abs(n)<r?t.tileKey.mortonCode()-e.tileKey.mortonCode():n});for(var y=[],_=!0,b=0;b<u.length&&y.length<v.options.maxVisibleDataSourceTiles;b++){var x=u[b];if(r.shouldRender(i,x.tileKey)){var w=v.getTile(r,x.tileKey);void 0!==w&&(w.prepareForRender(),_=_&&w.hasGeometry,y.push(w))}}f.push({dataSource:r,storageLevel:t,zoomLevel:i,allVisibleTileLoaded:_,visibleTiles:y,renderedTiles:y}),p=p&&_},v=this;try{for(var g=r(i),y=g.next();!y.done;y=g.next()){m(y.value)}}catch(e){a={error:e}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(a)throw a.error}}return this.dataSourceTileList=f,this.allVisibleTilesLoaded=p,this.fillMissingTilesFromCache(),f},e.prototype.getTile=function(e,t){if(!e.cacheable)return e.getTile(t);var n=this.getOrCreateCache(e).tileCache,r=n.get(t.mortonCode());return void 0!==r?r:(void 0!==(r=e.getTile(t))&&n.set(t.mortonCode(),r),r)},e.prototype.removeDataSource=function(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(function(t){return t.dataSource.name!==e}),this.m_dataSourceCache.delete(e)},e.prototype.clearTileCache=function(e){if(void 0!==e){var t=this.m_dataSourceCache.get(e);t&&t.tileCache.evictAll()}else this.m_dataSourceCache.forEach(function(e){e.tileCache.evictAll()})},e.prototype.markTilesDirty=function(e){var t=this;if(void 0===e)this.dataSourceTileList.forEach(function(e){t.markDataSourceTilesDirty(e)});else{var n=this.dataSourceTileList.find(function(t){return t.dataSource===e});if(void 0===n)return;this.markDataSourceTilesDirty(n)}},e.prototype.disposePendingTiles=function(){this.m_dataSourceCache.forEach(function(e){e.disposeTiles()})},e.prototype.forEachVisibleTile=function(e){var t,n;try{for(var i=r(this.dataSourceTileList),o=i.next();!o.done;o=i.next()){o.value.visibleTiles.forEach(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.forEachCachedTile=function(e){this.m_dataSourceCache.forEach(function(t){t.tileCache.forEach(function(t){e(t)})})},e.prototype.fillMissingTilesFromCache=function(){var e=this;this.dataSourceTileList.forEach(function(t){var n,r=t.dataSource,i=r.getTilingScheme(),a=t.zoomLevel,s=new Map,u=new Set;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.BOTH=2]="BOTH"}(n||(n={}));var l=e.m_dataSourceCache.get(r.name),c=e.options.quadTreeSearchDistanceUp>0&&void 0!==l&&a>r.minZoomLevel,d=e.options.quadTreeSearchDistanceDown>0&&void 0!==l&&a<r.maxZoomLevel;if(d||c){var h=d&&c?n.BOTH:d?n.DOWN:n.UP,f=new Map;if(t.visibleTiles.forEach(function(e){var t=e.tileKey.mortonCode();e.hasGeometry?s.set(t,e):f.set(t,h)}),0!==f.size){for(var p=function(){var t=new Map;f.forEach(function(r,c){if(r===n.BOTH||r===n.UP){var d=o.TileKey.parentMortonCode(c);if(!u.has(d)&&!s.get(d)){u.add(d);var h=l.get(d);if(void 0!==h&&h.hasGeometry)return void s.set(d,h);var f=h?h.tileKey:o.TileKey.fromMortonCode(d);Math.abs(a-f.level)<e.options.quadTreeSearchDistanceUp&&t.set(d,n.UP)}}if(r===n.BOTH||r===n.DOWN){var p=o.TileKey.fromMortonCode(c);i.getSubTileKeys(p).forEach(function(r){var i=r.mortonCode(),o=l.get(i);(u.add(i),void 0!==o&&o.hasGeometry)?s.set(i,o):Math.abs(r.level-a)<e.options.quadTreeSearchDistanceDown&&t.set(i,n.DOWN)})}}),f=t};void 0!==l&&0!==f.size;)p();t.renderedTiles=Array.from(s.values())}}})},e.prototype.getOrCreateCache=function(e){var t=e.name,n=this.m_dataSourceCache.get(t);return void 0===n&&(n=new c(this.options),this.m_dataSourceCache.set(t,n)),n},e.prototype.markDataSourceTilesDirty=function(e){var t=this.m_dataSourceCache.get(e.dataSource.name),n=new Set;e.visibleTiles.forEach(function(e){n.add(e.tileKey.mortonCode()),e.reload()}),e.renderedTiles.forEach(function(e){var t=e.tileKey.mortonCode();n.has(t)||(n.add(t),e.reload())}),void 0!==t&&t.tileCache.forEach(function(e,r){n.has(r)||(e.dispose(),t.tileCache.delete(r))})},e}();t.VisibleTileSet=d},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e){this.m_camera=e,this.m_globalFrustumMin=new i.Vector3,this.m_globalFrustumMax=new i.Vector3,this.m_frustumCorners=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3]}return e.prototype.setup=function(){var e,t,n=this.getFrustumCorners(),i=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);try{for(var o=r(n),a=o.next();!a.done;a=o.next()){var s=a.value;s.applyMatrix4(i),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,s.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,s.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,s.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,s.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,s.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,s.z)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.frustumIntersectsTileBox=function(e){var t=this.m_globalFrustumMin,n=this.m_globalFrustumMax;return!(n.x<e.min.x||n.y<e.min.y||n.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)},e.prototype.getFrustumCorners=function(){var e=this.m_frustumCorners,t=new i.Camera;t.projectionMatrix.copy(this.m_camera.projectionMatrix);var n=0;function r(r,i,o){e[n++].set(r,i,o).unproject(t)}return r(-1,-1,-1),r(1,-1,-1),r(-1,1,-1),r(1,1,-1),r(-1,-1,1),r(1,-1,1),r(-1,1,1),r(1,1,1),e},e}();t.MapTileCuller=o},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(3),a=n(10),s=n(1),u=n(0),l=n(16),c=n(30),d=n(17),h=n(18),f=n(12);!function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed",e[e.Disposed=7]="Disposed"}(t.TileLoaderState||(t.TileLoaderState={}));var p=function(){function e(e,t){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=new Array,this.boundingBox=new u.Box3,this.center=new u.Vector3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_preparedTextPaths=new Array,this.m_userTextElements=[],this.m_textElementGroups=new s.GroupedPriorityList,this.m_placedTextElements=new s.GroupedPriorityList,this.m_numVertices=0,this.m_memoryUsage=void 0,this.m_textElementsChanged=!1,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.projection.projectBox(this.geoBox,this.boundingBox),this.boundingBox.getCenter(this.center)}return Object.defineProperty(e.prototype,"projection",{get:function(){return this.dataSource.projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapView",{get:function(){return this.dataSource.mapView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placedTextElements",{get:function(){return this.m_placedTextElements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){if(void 0!==this.m_memoryUsage)return this.m_memoryUsage;var e=0;return void 0!==this.decodedTile&&(e+=f.MapViewUtils.estimateObjectSize(this.decodedTile)),e+=f.MapViewUtils.estimateObjectSize(this.textElementGroups),e+=f.MapViewUtils.estimateObjectSize(this.objects),e+=f.MapViewUtils.estimateObjectSize(this.preparedTextPaths),this.roadIntersectionData&&(e+=f.MapViewUtils.estimateObjectSize(this.roadIntersectionData)),this.m_memoryUsage=e,2*e},enumerable:!0,configurable:!0}),e.prototype.getUsageStatistics=function(){return{estimatedMemoryUsage:this.memoryUsage,numVertices:this.m_numVertices,numColors:l.ColorCache.instance.size,numObjects:this.objects.length,numGeometries:void 0!==this.m_decodedTile?this.m_decodedTile.geometries.length:0,numMaterials:this.getMaterialsCount()}},Object.defineProperty(e.prototype,"userTextElements",{get:function(){return this.m_userTextElements},enumerable:!0,configurable:!0}),e.prototype.addUserTextElement=function(e){this.m_userTextElements.push(e),this.textElementsChanged=!0},e.prototype.removeUserTextElement=function(e){var t=this.m_userTextElements.indexOf(e);return t>=0&&(this.m_userTextElements.splice(t,1),this.textElementsChanged=!0,!0)},e.prototype.addTextElement=function(e){this.textElementGroups.add(e),this.textElementsChanged=!0},e.prototype.removeTextElement=function(e){return!!this.textElementGroups.remove(e)&&(this.textElementsChanged=!0,!0)},Object.defineProperty(e.prototype,"textElementGroups",{get:function(){return this.m_textElementGroups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textElementsChanged",{get:function(){return this.m_textElementsChanged},set:function(e){this.m_textElementsChanged=e},enumerable:!0,configurable:!0}),e.prototype.prepareForRender=function(){var e=this;if(this.m_decodedTile&&!this.m_disposed){var t=this.m_decodedTile;void 0!==t.tileInfo&&(this.roadIntersectionData=this.dataSource.mapView.pickHandler.registerTile(this)),this.m_decodedTile=void 0,setTimeout(function(){var n=e.mapView.statistics,r=0;n.enabled&&(r=s.PerformanceTimer.now()),e.createGeometries(t),n.enabled&&n.getTimer("geometryCreation").setValue(s.PerformanceTimer.now()-r),e.dataSource.requestUpdate()},0)}},e.prototype.willRender=function(e){return!0},e.prototype.didRender=function(){},e.prototype.createGeometries=function(e){this.clear(),this.preparePois(e),this.createTextElements(e),this.createObjects(e,this.objects),this.countVertices()},Object.defineProperty(e.prototype,"decodedTile",{get:function(){return this.m_decodedTile},enumerable:!0,configurable:!0}),e.prototype.setDecodedTile=function(e){this.m_decodedTile=e,this.invalidateUsageInfoCache();var t=this.dataSource.mapView.statistics;t.enabled&&t.getTimer("decoding").setValue(e.decodeTime)},e.prototype.shouldDisposeObjectGeometry=function(e){return!0},e.prototype.shouldDisposeObjectMaterial=function(e){return!0},Object.defineProperty(e.prototype,"disposed",{get:function(){return this.m_disposed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeometry",{get:function(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry},enumerable:!0,configurable:!0}),e.prototype.forceHasGeometry=function(e){this.m_forceHasGeometry=e},Object.defineProperty(e.prototype,"tileLoader",{get:function(){return this.m_tileLoader},set:function(e){this.m_tileLoader=e},enumerable:!0,configurable:!0}),e.prototype.reload=function(){this.dataSource.updateTile(this)},e.prototype.clear=function(){var e=this,t=function(t){void 0!==t.geometry&&e.shouldDisposeObjectGeometry(t)&&t.geometry.dispose(),void 0!==t.material&&e.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(function(e){return e.dispose()}):t.material.dispose())};this.objects.forEach(function(e){e.traverse(function(e){t(e)}),t(e)}),this.objects.length=0,this.m_preparedTextPaths&&(this.m_preparedTextPaths=[]),this.placedTextElements.clear(),this.textElementGroups.clear(),this.userTextElements.length=0,this.invalidateUsageInfoCache()},e.prototype.dispose=function(){this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.dispose(),this.m_tileLoader=void 0),this.clear(),this.userTextElements.length=0,this.m_disposed=!0)},Object.defineProperty(e.prototype,"preparedTextPaths",{get:function(){return this.m_preparedTextPaths},enumerable:!0,configurable:!0}),e.prototype.prepareTextPaths=function(e){for(var t=new Array,n=Math.PI/8,r=e.slice(),i=new u.Vector2,o=new u.Vector2,a=new u.Vector2;r.length>0;){var s=r.pop();if(void 0===s)break;for(var l=-1,c=0;c<s.path.length-2;c+=2){i.set(s.path[c],s.path[c+1]),o.set(s.path[c+2],s.path[c+3]);var d=o.sub(i).normalize();if(c>0){var h=Math.atan2(a.x*d.y-d.x*a.y,d.dot(a));if(Math.abs(h)>n){l=c;break}}a.set(d.x,d.y)}if(l>0){var f={path:s.path.slice(0,l+2),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};t.push(f);var p={path:s.path.slice(l),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};r.push(p)}else t.push(s)}return t},e.prototype.createTextElements=function(e){var t,n,o,s,c,f,p=new Map,m=0,v=0;if(void 0!==e.textPathGeometries&&(m+=e.textPathGeometries.length),void 0!==e.textGeometries&&(m+=e.textGeometries.length),void 0!==e.textPathGeometries){this.m_preparedTextPaths=this.prepareTextPaths(e.textPathGeometries);var g=0;try{for(var y=r(this.preparedTextPaths),_=y.next();!_.done;_=y.next()){var b=_.value;"text"===(P=e.techniques[b.technique]).name&&(b.pathLengthSqr>g&&(g=b.pathLengthSqr))}}catch(e){t={error:e}}finally{try{_&&!_.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}try{for(var x=r(this.preparedTextPaths),w=x.next();!w.done;w=x.next()){b=w.value;if("text"===(P=e.techniques[b.technique]).name){void 0!==P.color&&p.set(b.technique,l.ColorCache.instance.getColor(P.color));for(var T=[],C=0;C<b.path.length;C+=2)T.push(new u.Vector2(b.path[C],b.path[C+1]));var E=(void 0!==P.priority?P.priority:0)+.1*(m-v)/m+(g>0?.9*b.pathLengthSqr/g:0);(D=new d.TextElement(b.text,T,E,void 0!==P.scale?P.scale:1,void 0!==P.xOffset?P.xOffset:0,void 0!==P.yOffset?P.yOffset:0,b.featureId,P.style,P.allCaps,P.smallCaps,P.bold,P.oblique,P.tracking,i.getPropertyValue(P.fadeNear,this.tileKey.level),i.getPropertyValue(P.fadeFar,this.tileKey.level))).color=p.get(b.technique),D.minZoomLevel=P.minZoomLevel,D.maxZoomLevel=P.maxZoomLevel,D.distanceScale=void 0!==P.distanceScale?P.distanceScale:h.DEFAULT_TEXT_DISTANCE_SCALE,D.mayOverlap=!0===P.mayOverlap,D.reserveSpace=!1!==P.reserveSpace,void 0===P.hAlignment||P.hAlignment!==a.TextHorizontalAlignmentStrings.Left&&P.hAlignment!==a.TextHorizontalAlignmentStrings.Center&&P.hAlignment!==a.TextHorizontalAlignmentStrings.Right||(D.horizontalAlignment=a.TextHorizontalAlignment[P.hAlignment]),void 0===P.vAlignment||P.vAlignment!==a.TextVerticalAlignmentStrings.Above&&P.vAlignment!==a.TextVerticalAlignmentStrings.Center&&P.vAlignment!==a.TextVerticalAlignmentStrings.Below||(D.verticalAlignment=a.TextVerticalAlignment[P.vAlignment]),this.addTextElement(D),v++}}}catch(e){o={error:e}}finally{try{w&&!w.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}}if(void 0!==e.textGeometries)try{for(var S=r(e.textGeometries),A=S.next();!A.done;A=S.next()){var P,M=A.value;if(void 0!==M.technique&&void 0!==M.stringCatalog)if("text"===(P=e.techniques[M.technique]).name){void 0!==P.color&&p.set(M.technique,l.ColorCache.instance.getColor(P.color));var O=new u.BufferAttribute(new Float32Array(M.positions.buffer),M.positions.itemCount),L=O.count;if(!(L<1)){E=(void 0!==P.priority?P.priority:0)+.1*(m-v)/m;var I=.1/L;for(C=0;C<L;++C){var F=O.getX(C),R=O.getY(C),k=M.stringCatalog[M.texts[C]];if(void 0!==k){var D,j=E+I*(L-C)/L;(D=new d.TextElement(k,new u.Vector2(F,R),j,P.scale||1,P.xOffset||0,P.yOffset||0,M.featureId,P.style)).color=p.get(M.technique),D.minZoomLevel=P.minZoomLevel,D.maxZoomLevel=P.maxZoomLevel,D.mayOverlap=!0===P.mayOverlap,D.reserveSpace=!1!==P.reserveSpace,this.addTextElement(D),v++,D.fadeNear=i.getPropertyValue(P.fadeNear,this.tileKey.level),D.fadeFar=i.getPropertyValue(P.fadeFar,this.tileKey.level)}}}}}}catch(e){c={error:e}}finally{try{A&&!A.done&&(f=S.return)&&f.call(S)}finally{if(c)throw c.error}}},e.prototype.registerTileObject=function(e){var t=e.userData||{};t.tileKey=this.tileKey,t.dataSource=this.dataSource.name},e.prototype.createObjects=function(e,t){var n,a,s=this,l=[];try{for(var d=r(e.geometries),h=d.next();!h.done;h=d.next())for(var f,p=h.value,m=p.groups,v=m.length,g=function(n){for(var a,d,h=m[n++],g=h.start,_=h.technique,b=e.techniques[_],x=h.count;n<v&&m[n].technique===_&&g+x===m[n].start;++n)x+=m[n].count;var w=i.getObjectConstructor(b);if(void 0===w)return f=n,"continue";var T=l[_];if(void 0===T){if(void 0===(T=i.createMaterial({technique:e.techniques[_],level:y.tileKey.level,fog:null!==y.mapView.scene.fog})))return f=n,"continue";l[_]=T}var C=new u.BufferGeometry;if(p.vertexAttributes.forEach(function(e){var t=i.getBufferAttribute(e);C.addAttribute(e.name,t)}),void 0!==p.interleavedVertexAttributes&&p.interleavedVertexAttributes.forEach(function(e){var t=i.getArrayConstructor(e.type),n=new u.InterleavedBuffer(new t(e.buffer),e.stride);e.attributes.forEach(function(e){var t=new u.InterleavedBufferAttribute(n,e.itemSize,e.offset,!1);C.addAttribute(e.name,t)})}),p.index&&C.setIndex(i.getBufferAttribute(p.index)),!C.getAttribute("normal")&&i.isStandardTechnique(b)&&C.computeVertexNormals(),C.addGroup(g,x),"solid-line"===b.name||"dashed-line"===b.name){var E=T;if(E.uniforms.opacity.value=T.opacity,!1!==b.clipping){var S=E.uniforms.tileSize,A=new u.Vector3;y.boundingBox.getSize(A),S.value.x=A.x,S.value.y=A.y,E.defines.TILE_CLIP=1}}var P="extruded-polygon"===b.name&&void 0!==p.edgeIndex,M="fill"===b.name&&void 0!==p.outlineIndicesAttributes;(P||M)&&(T.polygonOffset=!0,T.polygonOffsetFactor=.25,T.polygonOffsetUnits=.1);var O=new w(C,T);if(O.frustumCulled=!1,void 0!==b.renderOrder)O.renderOrder=b.renderOrder;else{if(void 0===b._renderOrderAuto)throw new Error("Technique has no renderOrderAuto");O.renderOrder=b._renderOrderAuto}if(void 0!==h.renderOrderOffset&&(O.renderOrder+=h.renderOrderOffset),void 0!==p.uuid&&(O.userData.geometryId=p.uuid),"solid-line"===b.name||"dashed-line"===b.name){var L=y.getFadingParams(b);o.FadingFeature.addRenderHelper(O,L.fadeNear,L.fadeFar,!0,!1,function(e,t){var n=t;if("Pixel"===i.getAttributeValue(b.metricUnit,s.tileKey.level)){var r=e.getPixelRatio()*s.mapView.pixelToWorld*.5,a=i.getAttributeValue(b.lineWidth,s.tileKey.level);if(n.lineWidth=(void 0!==a?a:o.SolidLineMaterial.DEFAULT_WIDTH)*r,"dashed-line"===b.name){var u=n,l=i.getAttributeValue(b.dashSize,s.tileKey.level);u.dashSize=(void 0!==l?l:o.DashedLineMaterial.DEFAULT_DASH_SIZE)*r;var c=i.getAttributeValue(b.gapSize,s.tileKey.level);u.gapSize=(void 0!==c?c:o.DashedLineMaterial.DEFAULT_GAP_SIZE)*r}}})}if("extruded-line"===b.name&&void 0!==b.fadeFar&&b.fadeFar>=0){L=y.getFadingParams(b);o.FadingFeature.addRenderHelper(O,L.fadeNear,L.fadeFar,!0,!0)}if(y.addFeatureData(p,b,O),P||"fill"===b.name){var I=b;if(void 0!==b.fadeFar&&b.fadeFar>=0){L=y.getFadingParams(I);o.FadingFeature.addRenderHelper(O,L.fadeNear,L.fadeFar,!0,!0)}}var F="extruded-polygon"===b.name&&c.isRenderDepthPrePassEnabled(b);if(F){var R=c.createDepthPrePassMesh(O);t.push(R),c.applyDepthBasedPolygonOffset(c.DEFAULT_DEPTH_BASED_POLYGON_OFFSET_MULTIPLIER,R,O)}if(y.registerTileObject(O),t.push(O),"extruded-polygon"===b.name&&void 0!==p.edgeIndex){var k=new u.BufferGeometry;k.addAttribute("position",C.getAttribute("position")),k.addAttribute("color",C.getAttribute("color")),k.setIndex(i.getBufferAttribute(p.edgeIndex));var D=b,j={color:(L=y.getPolygonFadingParams(D)).color,colorMix:L.colorMix,fadeNear:L.lineFadeNear,fadeFar:L.lineFadeFar},B=new o.EdgeMaterial(j),U=new u.LineSegments(k,B);U.renderOrder=B.transparent&&!F?-1:O.renderOrder+.1,o.FadingFeature.addRenderHelper(U,L.lineFadeNear,L.lineFadeFar,!0,!1),y.registerTileObject(U),t.push(U)}if(M&&void 0!==p.outlineIndicesAttributes)try{for(var z=r(p.outlineIndicesAttributes),N=z.next();!N.done;N=z.next()){var G=N.value,V=new u.BufferGeometry;V.addAttribute("position",C.getAttribute("position")),void 0!==G&&V.setIndex(i.getBufferAttribute(G));I=b,j={color:(L=y.getPolygonFadingParams(I)).color,colorMix:L.colorMix,fadeNear:L.lineFadeNear,fadeFar:L.lineFadeFar};var H=new o.EdgeMaterial(j),W=new u.LineSegments(V,H);W.renderOrder=O.renderOrder+.1,o.FadingFeature.addRenderHelper(W,L.lineFadeNear,L.lineFadeFar,!0,!1),y.registerTileObject(W),t.push(W)}}catch(e){a={error:e}}finally{try{N&&!N.done&&(d=z.return)&&d.call(z)}finally{if(a)throw a.error}}f=n},y=this,_=0;_<v;)g(_),_=f}catch(e){n={error:e}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}},e.prototype.invalidateUsageInfoCache=function(){this.m_numVertices=0,this.m_memoryUsage=void 0},e.prototype.countVertices=function(){var e=this;this.objects.filter(function(e){return e instanceof u.Mesh}).forEach(function(t){var n=t;n.geometry instanceof u.BufferGeometry&&(void 0!==n.geometry.index&&null!==n.geometry.index?e.m_numVertices+=n.geometry.index.count:e.m_numVertices+=n.geometry.getAttribute("position").count/3),n.geometry instanceof u.Geometry&&(e.m_numVertices=n.geometry.vertices.length)})},e.prototype.preparePois=function(e){void 0!==e.poiGeometries&&this.mapView.poiManager.addPois(this,e)},e.prototype.getMaterialsCount=function(){var e=0;return this.objects.forEach(function(t){t.material&&(Array.isArray(t.material)?e+=t.material.length:e+=1)}),e},e.prototype.addFeatureData=function(e,t,n){if(void 0!==e.featureIds&&e.featureIds.length>0&&"solid-line"!==t.name&&"dashed-line"!==t.name){var r={geometryType:e.type,ids:e.featureIds,starts:e.featureStarts};n.userData.feature=r,void 0!==e.objInfos&&(n.userData.feature.objInfos=e.objInfos)}},e.prototype.getFadingParams=function(e){return{fadeNear:void 0!==e.fadeNear?i.getPropertyValue(e.fadeNear,this.tileKey.level):o.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==e.fadeFar?i.getPropertyValue(e.fadeFar,this.tileKey.level):o.FadingFeature.DEFAULT_FADE_FAR}},e.prototype.getPolygonFadingParams=function(e){var t=o.EdgeMaterial.DEFAULT_COLOR,n=o.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==e.lineColor&&(t=e.lineColor,i.isExtrudedPolygonTechnique(e))){var r=e;n=void 0!==r.lineColorMix?r.lineColorMix:o.EdgeMaterial.DEFAULT_COLOR_MIX}var a=void 0!==e.fadeNear?i.getPropertyValue(e.fadeNear,this.tileKey.level):o.FadingFeature.DEFAULT_FADE_NEAR,s=void 0!==e.fadeFar?i.getPropertyValue(e.fadeFar,this.tileKey.level):o.FadingFeature.DEFAULT_FADE_FAR;return{color:t,colorMix:n,fadeNear:a,fadeFar:s,lineFadeNear:void 0!==e.lineFadeNear?i.getPropertyValue(e.lineFadeNear,this.tileKey.level):a,lineFadeFar:void 0!==e.lineFadeFar?i.getPropertyValue(e.lineFadeFar,this.tileKey.level):s}},e}();t.Tile=p},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(1),a=n(64),s=o.LoggerManager.instance.create("TileDataAccessor"),u=function(){function e(e,t,n){this.tile=e,this.visitor=t,this.m_wantsPoints=!0,this.m_wantsLines=!0,this.m_wantsAreas=!0,this.m_wantsObject3D=!0;var r=!0===n.wantsAll;this.m_wantsPoints=r||!(!1===n.wantsPoints),this.m_wantsLines=r||!(!1===n.wantsLines),this.m_wantsAreas=r||!(!1===n.wantsAreas),this.m_wantsObject3D=r||!(!1===n.wantsObject3D)}return e.prototype.visitAll=function(){var e,t,n=this.tile.objects;try{for(var i=r(n),o=i.next();!o.done;o=i.next()){var a=o.value;this.visitObject(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.visitObject=function(e){var t=void 0!==e.userData?e.userData.feature:void 0;if(void 0!==t&&(void 0===t.ids||1!==t.ids.length||this.visitor.wantsFeature(t.ids[0]))){var n=t.geometryType;if(void 0!==n){switch(o.assert(void 0!==t.ids,"featureData.ids missing"),o.assert(Array.isArray(t.ids),"featureData.ids is not an array"),o.assert(void 0!==t.starts,"featureData.starts missing"),o.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.ids&&void 0!==t.starts&&o.assert(t.ids.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),n){case i.GeometryType.Point:case i.GeometryType.Text:if(!this.m_wantsPoints)return;break;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case i.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:s.warn("#visitObject: invalid geometryType")}if("Mesh"===e.type){var r=e;this.visitMesh(r,t)}else s.warn("#visitObject: visiting object failed, not of type 'Mesh'",e)}else s.warn("#visitObject: visiting object failed, no geometryType",e)}},e.prototype.getBufferGeometry=function(e){var t=e.geometry;if("BufferGeometry"===t.type){var n=t;if(n.getAttribute("position"))return n;s.warn("#visitLines: BufferGeometry has no position attribute")}else s.warn("#visitObject: object does not have BufferGeometry")},e.prototype.getGeometryAccessor=function(e,t,n){switch(e){case i.GeometryType.Point:case i.GeometryType.Text:return;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:return new a.BufferedGeometryLineAccessor(t,e,n);case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:return;case i.GeometryType.Object3D:return new a.BufferedGeometryObject3dAccessor(t,e,n);default:s.warn("#getGeometryAccessor: invalid geometryType")}},e.prototype.getIndexedGeometryAccessor=function(e,t,n){switch(e){case i.GeometryType.Point:case i.GeometryType.Text:return;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:return new a.IndexedBufferedGeometryLineAccessor(t,e,n);case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:case i.GeometryType.Object3D:return;default:s.warn("#getIndexedGeometryAccessor: invalid geometryType")}},e.prototype.visitMesh=function(e,t){var n=t.ids,r=t.starts,u=t.geometryType;if(void 0!==n&&void 0!==r&&void 0!==u)for(var l,c=0;c<n.length;c++){var d=n[c];if(this.visitor.wantsFeature(d)){var h,f=r[c];if(void 0===l){var p=this.getBufferGeometry(e);if(void 0===p)continue;if(void 0===(l=null!==p.index?this.getIndexedGeometryAccessor(u,e,p):this.getGeometryAccessor(u,e,p))){s.warn("#visitObject: no accessor geometryType",u);continue}}switch(h=c<r.length-1?r[c+1]:l.getCount(),l.setRange(f,h),u){case i.GeometryType.Point:case i.GeometryType.Text:this.visitor.visitPoint(d);break;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:o.assert(a.isLineAccessor(l)),this.visitor.visitLine(d,l);break;case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:this.visitor.visitArea(d);break;case i.GeometryType.Object3D:o.assert(a.isObject3dAccessor(l)),this.visitor.visitObject3D(d,l);break;default:s.warn("#visitObject: invalid geometryType")}}}},e}();t.TileDataAccessor=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(135)),r(n(65)),r(n(66)),r(n(31))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e){return new Float32Array([e])[0]}var o=function(){return function(){this.vertices=[],this.indices=[]}}();function a(e,t,n){if(void 0===t&&(t=new o),void 0===n&&(n=!1),0===e.length)return t;var r=e.length/2,a=t.vertices,s=t.indices,u=[],l=[],c=[],d=t.vertices.length/12,h=0;l.push(0);for(var f=0;f<r-1;++f){var p=e[2*(f+1)]-e[2*f],m=e[2*(f+1)+1]-e[2*f+1],v=Math.sqrt(p*p+m*m);u[f]=v,h+=v,l.push(h),c.push([p,m])}var g=e[0]===e[e.length-2]&&e[1]===e[e.length-1];for(f=0;f<r;++f){var y=e[2*f],_=e[2*f+1],b=g&&0===f?c[c.length-1]:c[Math.max(0,f-1)],x=g&&f===r-1?c[0]:c[Math.min(f,c.length-1)];if(f>0){var w=l[f-1],T=l[f];if(n){var C=y-(S=i(y)),E=_-(A=i(_));a.push(S,A,C,E,w,T,b[0],b[1],x[0],x[1],0,0,1,-1),a.push(S,A,C,E,w,T,b[0],b[1],x[0],x[1],0,0,1,1)}else a.push(y,_,w,T,b[0],b[1],x[0],x[1],0,0,1,-1),a.push(y,_,w,T,b[0],b[1],x[0],x[1],0,0,1,1)}if(f+1<r){w=l[Math.min(f,l.length-1)],T=l[Math.min(f+1,l.length-1)];if(n){var S,A;C=y-(S=i(y)),E=_-(A=i(_));a.push(S,A,C,E,w,T,b[0],b[1],x[0],x[1],0,0,-1,-1),a.push(S,A,C,E,w,T,b[0],b[1],x[0],x[1],0,0,-1,1)}else a.push(y,_,w,T,b[0],b[1],x[0],x[1],0,0,-1,-1),a.push(y,_,w,T,b[0],b[1],x[0],x[1],0,0,-1,1)}}for(f=0;f<r-1;++f){var P=d+4*f;s.push(P,P+1,P+2,P+2,P+1,P+3)}return t}function s(e,t){if(void 0===t&&(t=new o),0===e.length)return t;for(var n=e.length/2,r=t.vertices,i=t.indices,a=r.length/3,s=0;s<n;++s,a++){var u=e[2*s],l=e[2*s+1];s>0&&i.push(a),s<n-1&&i.push(a),r.push(u,l,0)}return t}t.LineGeometry=o,t.createLineGeometry=a,t.createSimpleLineGeometry=s,t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"segment",itemSize:2,offset:2},{name:"tangents",itemSize:4,offset:4},{name:"angles",itemSize:2,offset:8},{name:"texcoord",itemSize:2,offset:10}],t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"positionLow",itemSize:2,offset:2},{name:"segment",itemSize:2,offset:4},{name:"tangents",itemSize:4,offset:6},{name:"angles",itemSize:2,offset:10},{name:"texcoord",itemSize:2,offset:12}];var u=function(){function e(e){void 0===e&&(e=!1),this.highPrecision=e,this.g=new o}return e.createGeometry=function(e,n,i,o){void 0===o&&(o=!1);var a=new r.InterleavedBuffer(new Float32Array(e),o?14:12);return(o?t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS:t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS).forEach(function(e){var t=new r.InterleavedBufferAttribute(a,e.itemSize,e.offset,!1);i.addAttribute(e.name,t)}),i.setIndex(new r.BufferAttribute(new Uint32Array(n),1)),i},e.prototype.clear=function(){this.g.vertices=[],this.g.indices=[]},e.prototype.add=function(e,t){return void 0===t&&(t=!1),t?s(e,this.g):a(e,this.g,this.highPrecision),this},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.g.vertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this.g.indices},enumerable:!0,configurable:!0}),e.prototype.createGeometry=function(t){return void 0===t&&(t=new r.BufferGeometry),e.createGeometry(this.g.vertices,this.g.indices,t,this.highPrecision)},e}();t.Lines=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(3),a=n(31),s=function(e){function t(t,n,r,a,s){var u=this;return void 0===n&&(n=new o.HighPrecisionPointMaterial({color:a||o.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:1})),(u=e.call(this,void 0===t?new i.BufferGeometry:t,n)||this).matrixWorldInverse=new i.Matrix4,r&&u.setPositions(r),u}return r(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),t.prototype.clearGeometry=function(){return this.geometry=new i.BufferGeometry},Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,n,r,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,r,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var n=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),n&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(i.Points);t.HighPrecisionPoints=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.element=e,this.onLongPress=t,this.timeout=500,this.moveThreshold=5,this.buttonId=0,this.m_mouseDownEvent=void 0,this.m_timerId=void 0,this.m_moveHandlerRegistered=!1,this.m_boundMouseMoveHandler=this.onMouseMove.bind(this),this.m_boundMouseDownHandler=this.onMousedown.bind(this),this.m_boundMouseUpHandler=this.onMouseup.bind(this),this.element.addEventListener("mousedown",this.m_boundMouseDownHandler),this.element.addEventListener("mouseup",this.m_boundMouseUpHandler)}return e.prototype.dispose=function(){this.cancel(),this.element.removeEventListener("mousedown",this.m_boundMouseDownHandler),this.element.removeEventListener("mouseup",this.m_boundMouseUpHandler)},e.prototype.onMousedown=function(e){var t=this;e.button===this.buttonId&&(this.cancelTimer(),this.m_mouseDownEvent=e,this.m_timerId=setTimeout(function(){return t.onTimeout()},this.timeout),this.addMouseMoveHandler())},e.prototype.onMouseup=function(e){e.button===this.buttonId&&this.cancel()},e.prototype.onMouseMove=function(e){void 0!==this.m_mouseDownEvent&&(Math.abs(e.clientX-this.m_mouseDownEvent.clientX)+Math.abs(e.clientY-this.m_mouseDownEvent.clientY)>=this.moveThreshold&&this.cancel())},e.prototype.cancel=function(){this.m_mouseDownEvent=void 0,this.cancelTimer(),this.removeMouseMoveHandler()},e.prototype.cancelTimer=function(){void 0!==this.m_timerId&&(clearTimeout(this.m_timerId),this.m_timerId=void 0)},e.prototype.addMouseMoveHandler=function(){this.m_moveHandlerRegistered||(this.element.addEventListener("mousemove",this.m_boundMouseMoveHandler),this.m_moveHandlerRegistered=!0)},e.prototype.removeMouseMoveHandler=function(){this.m_moveHandlerRegistered&&(this.element.removeEventListener("mousemove",this.m_boundMouseMoveHandler),this.m_moveHandlerRegistered=!1)},e.prototype.onTimeout=function(){var e=this.m_mouseDownEvent;this.m_timerId=void 0,this.cancel(),void 0!==e&&this.onLongPress(e)},e}();t.LongPressHandler=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(2),u=n(67),l=n(1),c=n(139),d=n(0);!function(e){e[e.Linear=0]="Linear",e[e.QuadraticIn=1]="QuadraticIn",e[e.QuadraticOut=2]="QuadraticOut",e[e.QuadraticInOut=3]="QuadraticInOut",e[e.CubicIn=4]="CubicIn",e[e.CubicOut=5]="CubicOut",e[e.CubicInOut=6]="CubicInOut",e[e.QuarticIn=7]="QuarticIn",e[e.QuarticOut=8]="QuarticOut",e[e.QuarticInOut=9]="QuarticInOut",e[e.QuinticIn=10]="QuinticIn",e[e.QuinticOut=11]="QuinticOut",e[e.QuinticInOut=12]="QuinticInOut",e[e.SinusoidalIn=13]="SinusoidalIn",e[e.SinusoidalOut=14]="SinusoidalOut",e[e.SinusoidalInOut=15]="SinusoidalInOut",e[e.ExponentialIn=16]="ExponentialIn",e[e.ExponentialOut=17]="ExponentialOut",e[e.ExponentialInOut=18]="ExponentialInOut",e[e.CircularIn=19]="CircularIn",e[e.CircularOut=20]="CircularOut",e[e.CircularInOut=21]="CircularInOut",e[e.ElasticIn=22]="ElasticIn",e[e.ElasticOut=23]="ElasticOut",e[e.ElasticInOut=24]="ElasticInOut",e[e.BackIn=25]="BackIn",e[e.BackOut=26]="BackOut",e[e.BackInOut=27]="BackInOut",e[e.BounceIn=28]="BounceIn",e[e.BounceOut=29]="BounceOut",e[e.BounceInOut=30]="BounceInOut"}(o=t.EasingFunction||(t.EasingFunction={})),function(e){e[e.Linear=0]="Linear",e[e.Bezier=1]="Bezier",e[e.CatmullRom=2]="CatmullRom"}(a=t.InterpolationFunction||(t.InterpolationFunction={}));var h=function(){function e(e,t){this.mapView=e,this.name=t,this.running=!1,this.stopped=!1,this.duration=1e4,this.repeat=0,this.easing=c.Easing.Linear.None,function(){if(void 0!==p)return;p=new Map,m=new Map,p.set(o.Linear,c.Easing.Linear.None),p.set(o.QuadraticIn,c.Easing.Quadratic.In),p.set(o.QuadraticOut,c.Easing.Quadratic.Out),p.set(o.QuadraticInOut,c.Easing.Quadratic.InOut),p.set(o.CubicIn,c.Easing.Cubic.In),p.set(o.CubicOut,c.Easing.Cubic.Out),p.set(o.CubicInOut,c.Easing.Cubic.InOut),p.set(o.QuarticIn,c.Easing.Quartic.In),p.set(o.QuarticOut,c.Easing.Quartic.Out),p.set(o.QuarticInOut,c.Easing.Quartic.InOut),p.set(o.QuinticIn,c.Easing.Quintic.In),p.set(o.QuinticOut,c.Easing.Quintic.Out),p.set(o.QuinticInOut,c.Easing.Quintic.InOut),p.set(o.SinusoidalIn,c.Easing.Sinusoidal.In),p.set(o.SinusoidalOut,c.Easing.Sinusoidal.Out),p.set(o.SinusoidalInOut,c.Easing.Sinusoidal.InOut),p.set(o.ExponentialIn,c.Easing.Exponential.In),p.set(o.ExponentialOut,c.Easing.Exponential.Out),p.set(o.ExponentialInOut,c.Easing.Exponential.InOut),p.set(o.CircularIn,c.Easing.Circular.In),p.set(o.CircularOut,c.Easing.Circular.Out),p.set(o.CircularOut,c.Easing.Circular.InOut),p.set(o.ElasticIn,c.Easing.Elastic.In),p.set(o.ElasticOut,c.Easing.Elastic.Out),p.set(o.ElasticInOut,c.Easing.Elastic.InOut),p.set(o.BackIn,c.Easing.Back.In),p.set(o.BackOut,c.Easing.Back.Out),p.set(o.BackInOut,c.Easing.Back.InOut),p.set(o.BounceIn,c.Easing.Bounce.In),p.set(o.BounceOut,c.Easing.Bounce.Out),p.set(o.BounceInOut,c.Easing.Bounce.InOut),m.set(a.Linear,c.Interpolation.Linear),m.set(a.Bezier,c.Interpolation.Bezier),m.set(a.CatmullRom,c.Interpolation.CatmullRom)}()}return e.prototype.update=function(e){return!!this.tween&&this.tween.update(e||l.PerformanceTimer.now())},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.running},enumerable:!0,configurable:!0}),e}();t.CameraAnimation=h;var f=function(e){function t(t,n,r,i){var o=e.call(this,t,i)||this;return o.m_mapControls=n,o.startAngle=0,o.endAngle=360,o.m_axis=new d.Vector3(0,0,1),o.beginInteractionListener=function(){o.stopped||o.stopTween()},o.endInteractionListener=function(){o.stopped||o.startTween()},void 0!==r.axis&&(o.m_axis=r.axis),void 0!==r.startAngle&&(o.startAngle=r.startAngle),void 0!==r.endAngle&&(o.endAngle=r.endAngle),void 0!==r.duration&&(o.duration=r.duration),void 0!==r.repeat&&(o.repeat=r.repeat),void 0!==r.easing&&(o.easing="function"==typeof r.easing?r.easing:p.get(r.easing)||c.Easing.Linear.None),o.m_lastRotationValue=o.startAngle,o}return r(t,e),t.prototype.start=function(e,t){if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.running=!0,this.onFinished=t,this.stopped=!1,this.m_mapControls&&(this.m_mapControls.addEventListener(u.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.addEventListener(u.EventNames.EndInteraction,this.endInteractionListener)),this.startTween(e),this.mapView.beginAnimation()},t.prototype.stop=function(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.stopped=!0,this.mapView.endAnimation(),this.tween&&this.tween.stop(),this.m_mapControls&&(this.m_mapControls.removeEventListener(u.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.removeEventListener(u.EventNames.EndInteraction,this.endInteractionListener))},t.prototype.startTween=function(e){var t=this,n=new d.Quaternion;this.m_userCamerRotation=new d.Quaternion,this.mapView.camera.getWorldQuaternion(this.m_userCamerRotation),this.tween=new c.Tween({rotation:0}).to({rotation:this.endAngle-this.m_lastRotationValue},this.duration).onComplete(function(){t.stop(),t.onFinished&&t.onFinished()}).onUpdate(function(e){var r=e.rotation;t.m_lastRotationValue=r,n.setFromEuler(new d.Euler(0,0,s.MathUtils.degToRad(r))),void 0!==t.m_userCamerRotation&&n.multiply(t.m_userCamerRotation),t.mapView.camera.quaternion.copy(n)}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.start(e)},t.prototype.stopTween=function(){this.tween&&this.tween.stop()},t}(h);t.CameraRotationAnimation=f;var p,m,v=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.name=r,i.interpolation=c.Interpolation.CatmullRom,void 0!==n.duration&&(i.duration=n.duration),void 0!==n.repeat&&(i.repeat=n.repeat),void 0!==n.easing&&(i.easing="function"==typeof n.easing?n.easing:p.get(n.easing)||c.Easing.Linear.None),void 0!==n.interpolation&&(i.interpolation="function"==typeof n.interpolation?n.interpolation:m.get(n.interpolation)||c.Interpolation.Linear),i.m_geoCoordinates=void 0!==n.geoCoordinates?n.geoCoordinates:[],i}return r(t,e),t.prototype.addPosition=function(e){this.m_geoCoordinates.push(e)},t.prototype.start=function(e,t){var n,r,o=this;if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.onFinished=t,this.running=!0;var a=new s.GeoCoordinates(this.mapView.geoCenter.latitude,this.mapView.geoCenter.longitude,this.mapView.camera.position.z),u={latitude:new Array,longitude:new Array,altitude:new Array};try{for(var l=i(this.m_geoCoordinates),d=l.next();!d.done;d=l.next()){var h=d.value;u.latitude.push(h.latitude),u.longitude.push(h.longitude),u.altitude.push(h.altitude||this.mapView.camera.position.z)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}this.tween=new c.Tween(a).to(u,this.duration).onComplete(function(){o.stop(),o.onFinished&&o.onFinished()}).onUpdate(function(e){var t=e.latitude,n=e.longitude,r=e.altitude;o.mapView.geoCenter=new s.GeoCoordinates(t,n,r),o.mapView.camera.position.z=r}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.interpolation(this.interpolation),this.tween.start(e),this.mapView.beginAnimation()},t.prototype.stop=function(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.mapView.endAnimation(),this.tween&&this.tween.stop()},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!0,configurable:!0}),t}(h);t.CameraPanAnimation=v},function(e,t,n){(function(n){var r,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:o.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&void 0!==n?o.now=function(){var e=n.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,r=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?i+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=i+(o-i)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,u=this._chainedTweens.length;s<u;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=r;s++)n+=i(1-t,r-s)*i(t,s)*e[s]*a(r,s);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=o.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}}(),CatmullRom:function(e,t,n,r,i){var o=.5*(n-e),a=.5*(r-t),s=i*i;return(2*t-2*n+o+a)*(i*s)+(-3*t+3*n-2*o-a)*s+o*i+t}}},void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}).call(this,n(69))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),s=n(70),u=function(){function e(e){this.m_modelConstructor=e}return e.prototype.create=function(e,t){return new this.m_modelConstructor(e,t)},e}();t.TileFactory=u;var l=function(e){function t(t,n){var r=e.call(this,n.name,n.styleSetName)||this;if(r.m_tileFactory=t,r.m_options=n,r.m_isReady=!1,n.decoder)r.m_decoder=n.decoder;else{if(!n.concurrentDecoderServiceName)throw new Error("TileDataSource["+r.name+"]: unable to create, missing decoder or concurrentDecoderServiceName");r.m_decoder=a.ConcurrentDecoderFacade.getTileDecoder(n.concurrentDecoderServiceName,n.concurrentDecoderScriptUrl)}return r.cacheable=!0,r}return r(t,e),t.prototype.dispose=function(){this.decoder.dispose()},t.prototype.ready=function(){return this.m_isReady},Object.defineProperty(t.prototype,"decoder",{get:function(){return this.m_decoder},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.m_options.dataProvider.connect(),this.m_decoder.connect()])];case 1:return e.sent(),this.m_isReady=!0,[2]}})})},t.prototype.setStyleSet=function(e,t){this.m_decoder.configure(e,t),this.mapView.markTilesDirty(this)},t.prototype.dataProvider=function(){return this.m_options.dataProvider},t.prototype.getTilingScheme=function(){return this.m_options.tilingScheme},t.prototype.getTile=function(e){var t=this.m_tileFactory.create(this,e);return t.tileLoader=new s.TileLoader(this,e,this.m_options.dataProvider,this.decoder),this.updateTile(t),t},t.prototype.getTileInfo=function(e){var t=this;return new Promise(function(n,r){var i=new s.TileInfoLoader(t,e,t.m_options.dataProvider,t.decoder);i.loadAndDecode().then(function(e){e===a.TileLoaderState.Ready?n(i.tileInfo):r(new Error("TileDataSource#getInfoTile wrong final state: "+e))})})},t.prototype.updateTile=function(e){var t=this,n=e.tileLoader;void 0!==n&&n.loadAndDecode().then(function(){n.decodedTile&&t.decodedTileHasGeometry(n.decodedTile)?(e.setDecodedTile(n.decodedTile),t.requestUpdate()):e.forceHasGeometry(!0)})},t.prototype.decodedTileHasGeometry=function(e){return e.geometries.length||void 0!==e.poiGeometries&&e.poiGeometries.length||void 0!==e.textGeometries&&e.textGeometries.length||void 0!==e.textPathGeometries&&e.textPathGeometries.length},t}(a.DataSource);t.TileDataSource=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=function(){function e(){}return e.prototype.dispose=function(){},e.prototype.decodeTile=function(e,t,n){return void 0===this.m_styleSetEvaluator?Promise.reject(new Error("No style is defined")):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,n)},e.prototype.getTileInfo=function(e,t,n){return Promise.resolve(void 0)},e.prototype.configure=function(e,t,n){void 0!==e&&(this.m_styleSetEvaluator=new r.StyleSetEvaluator(e)),void 0!==t&&(this.languages=t)},e}();t.ThemedTileDecoder=i},function(e,t,n){"use strict";var r={};(0,n(5).assign)(r,n(143),n(146),n(75)),e.exports=r},function(e,t,n){"use strict";var r=n(144),i=n(5),o=n(73),a=n(32),s=n(74),u=Object.prototype.toString,l=0,c=-1,d=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:c,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==l)throw new Error(a[n]);this._dict_set=!0}}function p(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(e,t){var n,a,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(c),s.next_out=0,s.avail_out=c),1!==(n=r.deflate(s,a))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==a||(this.onEnd(l),s.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=f,t.deflate=p,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},function(e,t,n){"use strict";var r,i=n(5),o=n(145),a=n(71),s=n(72),u=n(32),l=0,c=1,d=3,h=4,f=5,p=0,m=1,v=-2,g=-3,y=-5,_=-1,b=1,x=2,w=3,T=4,C=0,E=2,S=8,A=9,P=15,M=8,O=286,L=30,I=19,F=2*O+1,R=15,k=3,D=258,j=D+k+1,B=32,U=42,z=69,N=73,G=91,V=103,H=113,W=666,q=1,X=2,Y=3,Z=4,K=3;function Q(e,t){return e.msg=u[t],t}function J(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t,n,r){var o=e.avail_in;return o>r&&(o=r),0===o?0:(e.avail_in-=o,i.arraySet(t,e.input,e.next_in,o,n),1===e.state.wrap?e.adler=a(e.adler,t,o,n):2===e.state.wrap&&(e.adler=s(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)}function oe(e,t){var n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-j?e.strstart-(e.w_size-j):0,l=e.window,c=e.w_mask,d=e.prev,h=e.strstart+D,f=l[o+a-1],p=l[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===p&&l[n+a-1]===f&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<h);if(r=D-(h-o),o=h-D,r>a){if(e.match_start=t,a=r,r>=s)break;f=l[o+a-1],p=l[o+a]}}}while((t=d[t&c])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function ae(e){var t,n,r,o,a,s=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-j)){i.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=s?r-s:0}while(--n);t=n=s;do{r=e.prev[--t],e.prev[t]=r>=s?r-s:0}while(--n);o+=s}if(0===e.strm.avail_in)break;if(n=ie(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=k)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+k-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<k)););}while(e.lookahead<j&&0!==e.strm.avail_in)}function se(e,t){for(var n,r;;){if(e.lookahead<j){if(ae(e),e.lookahead<j&&t===l)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-j&&(e.match_length=oe(e,n)),e.match_length>=k)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-k),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=k){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=e.strstart<k-1?e.strstart:k-1,t===h?(te(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}function ue(e,t){for(var n,r,i;;){if(e.lookahead<j){if(ae(e),e.lookahead<j&&t===l)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=k-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-j&&(e.match_length=oe(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===k&&e.strstart-e.match_start>4096)&&(e.match_length=k-1)),e.prev_length>=k&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-k,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-k),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=k-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return q}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return q}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<k-1?e.strstart:k-1,t===h?(te(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}function le(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function ce(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=E,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?U:H,e.adler=2===t.wrap?0:1,t.last_flush=l,o._tr_init(t),p):Q(e,v)}function de(e){var t=ce(e);return t===p&&function(e){e.window_size=2*e.w_size,$(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=k-1,e.match_available=0,e.ins_h=0}(e.state),t}function he(e,t,n,r,o,a){if(!e)return v;var s=1;if(t===_&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>A||n!==S||r<8||r>15||t<0||t>9||a<0||a>T)return Q(e,v);8===r&&(r=9);var u=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*F),this.dyn_dtree=new i.Buf16(2*(2*L+1)),this.bl_tree=new i.Buf16(2*(2*I+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(R+1),this.heap=new i.Buf16(2*O+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*O+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+k-1)/k),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=n,de(e)}r=[new le(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===l)return q;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return q;if(e.strstart-e.block_start>=e.w_size-j&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Y:Z):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),q)}),new le(4,4,8,4,se),new le(4,5,16,8,se),new le(4,6,32,32,se),new le(4,4,16,16,ue),new le(8,16,32,32,ue),new le(8,16,128,128,ue),new le(8,32,128,256,ue),new le(32,128,258,1024,ue),new le(32,258,258,4096,ue)],t.deflateInit=function(e,t){return he(e,t,S,P,M,C)},t.deflateInit2=he,t.deflateReset=de,t.deflateResetKeep=ce,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,p):v},t.deflate=function(e,t){var n,i,a,u;if(!e||!e.state||t>f||t<0)return e?Q(e,v):v;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==h)return Q(e,0===e.avail_out?y:v);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===U)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=x||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=z):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=x||i.level<2?4:0),ne(i,K),i.status=H);else{var g=S+(i.w_bits-8<<4)<<8;g|=(i.strategy>=x||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=B),g+=31-g%31,i.status=H,re(i,g),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===z)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=N)}else i.status=N;if(i.status===N)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=G)}else i.status=G;if(i.status===G)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=V)}else i.status=V;if(i.status===V&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=H)):i.status=H),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&J(t)<=J(n)&&t!==h)return Q(e,y);if(i.status===W&&0!==e.avail_in)return Q(e,y);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==W){var _=i.strategy===x?function(e,t){for(var n;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===l)return q;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}(i,t):i.strategy===w?function(e,t){for(var n,r,i,a,s=e.window;;){if(e.lookahead<=D){if(ae(e),e.lookahead<=D&&t===l)return q;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=k&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=e.strstart+D;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=D-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=k?(n=o._tr_tally(e,1,e.match_length-k),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}(i,t):r[i.level].func(i,t);if(_!==Y&&_!==Z||(i.status=W),_===q||_===Y)return 0===e.avail_out&&(i.last_flush=-1),p;if(_===X&&(t===c?o._tr_align(i):t!==f&&(o._tr_stored_block(i,0,0,!1),t===d&&($(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==h?p:i.wrap<=0?m:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==U&&t!==z&&t!==N&&t!==G&&t!==V&&t!==H&&t!==W?Q(e,v):(e.state=null,t===H?Q(e,g):p):v},t.deflateSetDictionary=function(e,t){var n,r,o,s,u,l,c,d,h=t.length;if(!e||!e.state)return v;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==U||n.lookahead)return v;for(1===s&&(e.adler=a(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===s&&($(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new i.Buf8(n.w_size),i.arraySet(d,t,h-n.w_size,n.w_size,0),t=d,h=n.w_size),u=e.avail_in,l=e.next_in,c=e.input,e.avail_in=h,e.next_in=0,e.input=t,ae(n);n.lookahead>=k;){r=n.strstart,o=n.lookahead-(k-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+k-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=k-1,ae(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=k-1,n.match_available=0,e.next_in=l,e.input=c,e.avail_in=u,n.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(5),i=4,o=0,a=1,s=2;function u(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,c=1,d=2,h=29,f=256,p=f+1+h,m=30,v=19,g=2*p+1,y=15,_=16,b=7,x=256,w=16,T=17,C=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=new Array(2*(p+2));u(M);var O=new Array(2*m);u(O);var L=new Array(512);u(L);var I=new Array(256);u(I);var F=new Array(h);u(F);var R,k,D,j=new Array(m);function B(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function U(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function z(e){return e<256?L[e]:L[256+(e>>>7)]}function N(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function G(e,t,n){e.bi_valid>_-n?(e.bi_buf|=t<<e.bi_valid&65535,N(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=n-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function V(e,t,n){G(e,n[2*t],n[2*t+1])}function H(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function W(e,t,n){var r,i,o=new Array(y+1),a=0;for(r=1;r<=y;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=H(o[s]++,s))}}function q(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*x]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function X(e){e.bi_valid>8?N(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Y(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function Z(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Y(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Y(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function K(e,t,n){var r,i,o,a,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?V(e,i,t):(V(e,(o=I[i])+f+1,t),0!==(a=E[o])&&G(e,i-=F[o],a),V(e,o=z(--r),n),0!==(a=S[o])&&G(e,r-=j[o],a))}while(s<e.last_lit);V(e,x,t)}function Q(e,t){var n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=g,n=0;n<u;n++)0!==o[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)Z(e,o,n);i=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Z(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,Z(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,a,s,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=y;o++)e.bl_count[o]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<g;n++)(o=u[2*u[2*(r=e.heap[n])+1]+1]+1)>p&&(o=p,m++),u[2*r+1]=o,r>l||(e.bl_count[o]++,a=0,r>=f&&(a=h[r-f]),s=u[2*r],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(c[2*r+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>l||(u[2*i+1]!==o&&(e.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),r--)}}(e,t),W(o,l,e.bl_count)}function J(e,t,n){var r,i,o=-1,a=t[1],s=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<u&&i===a||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*w]++):s<=10?e.bl_tree[2*T]++:e.bl_tree[2*C]++,s=0,o=i,0===a?(u=138,l=3):i===a?(u=6,l=3):(u=7,l=4))}function $(e,t,n){var r,i,o=-1,a=t[1],s=0,u=7,l=4;for(0===a&&(u=138,l=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<u&&i===a)){if(s<l)do{V(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(V(e,i,e.bl_tree),s--),V(e,w,e.bl_tree),G(e,s-3,2)):s<=10?(V(e,T,e.bl_tree),G(e,s-3,3)):(V(e,C,e.bl_tree),G(e,s-11,7));s=0,o=i,0===a?(u=138,l=3):i===a?(u=6,l=3):(u=7,l=4)}}u(j);var ee=!1;function te(e,t,n,i){G(e,(l<<1)+(i?1:0),3),function(e,t,n,i){X(e),i&&(N(e,n),N(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,i,o=new Array(y+1);for(n=0,r=0;r<h-1;r++)for(F[r]=n,e=0;e<1<<E[r];e++)I[n++]=r;for(I[n-1]=r,i=0,r=0;r<16;r++)for(j[r]=i,e=0;e<1<<S[r];e++)L[i++]=r;for(i>>=7;r<m;r++)for(j[r]=i<<7,e=0;e<1<<S[r]-7;e++)L[256+i++]=r;for(t=0;t<=y;t++)o[t]=0;for(e=0;e<=143;)M[2*e+1]=8,e++,o[8]++;for(;e<=255;)M[2*e+1]=9,e++,o[9]++;for(;e<=279;)M[2*e+1]=7,e++,o[7]++;for(;e<=287;)M[2*e+1]=8,e++,o[8]++;for(W(M,p+1,o),e=0;e<m;e++)O[2*e+1]=5,O[2*e]=H(e,5);R=new B(M,E,f+1,p,y),k=new B(O,S,0,m,y),D=new B(new Array(0),A,0,v,b)}(),ee=!0),e.l_desc=new U(e.dyn_ltree,R),e.d_desc=new U(e.dyn_dtree,k),e.bl_desc=new U(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,q(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var u,l,h=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return a;return o}(e)),Q(e,e.l_desc),Q(e,e.d_desc),h=function(e){var t;for(J(e,e.dyn_ltree,e.l_desc.max_code),J(e,e.dyn_dtree,e.d_desc.max_code),Q(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*P[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=u&&(u=l)):u=l=n+5,n+4<=u&&-1!==t?te(e,t,n,r):e.strategy===i||l===u?(G(e,(c<<1)+(r?1:0),3),K(e,M,O)):(G(e,(d<<1)+(r?1:0),3),function(e,t,n,r){var i;for(G(e,t-257,5),G(e,n-1,5),G(e,r-4,4),i=0;i<r;i++)G(e,e.bl_tree[2*P[i]+1],3);$(e,e.dyn_ltree,t-1),$(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),K(e,e.dyn_ltree,e.dyn_dtree)),q(e),r&&X(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(I[n]+f+1)]++,e.dyn_dtree[2*z(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){G(e,c<<1,3),V(e,x,M),function(e){16===e.bi_valid?(N(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(147),i=n(5),o=n(73),a=n(75),s=n(32),u=n(74),l=n(150),c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new l,r.inflateGetHeader(this.strm,this.header)}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,u,l,d,h,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,v=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?f.input=o.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(p),f.next_out=0,f.avail_out=p),(n=r.inflate(f,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(h="string"==typeof m?o.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,n=r.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===v&&(n=a.Z_OK,v=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==a.Z_STREAM_END&&(0!==f.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(f.output,f.next_out),l=f.next_out-u,d=o.buf2string(f.output,u),f.next_out=l,f.avail_out=p-l,l&&i.arraySet(f.output,f.output,u,l,0),this.onData(d)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(v=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),f.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,n){"use strict";var r=n(5),i=n(71),o=n(72),a=n(148),s=n(149),u=0,l=1,c=2,d=4,h=5,f=6,p=0,m=1,v=2,g=-2,y=-3,_=-4,b=-5,x=8,w=1,T=2,C=3,E=4,S=5,A=6,P=7,M=8,O=9,L=10,I=11,F=12,R=13,k=14,D=15,j=16,B=17,U=18,z=19,N=20,G=21,V=22,H=23,W=24,q=25,X=26,Y=27,Z=28,K=29,Q=30,J=31,$=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,p):g}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):g}function ae(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,oe(e))):g}function se(e,t){var n,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,(n=ae(e,t))!==p&&(e.state=null),n):g}var ue,le,ce=!0;function de(e){if(ce){var t;for(ue=new r.Buf32(512),le=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,ue,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,le,0,e.work,{bits:5}),ce=!1}e.lencode=ue,e.lenbits=9,e.distcode=le,e.distbits=5}function he(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=ie,t.inflateInit=function(e){return se(e,ne)},t.inflateInit2=se,t.inflate=function(e,t){var n,ee,te,ne,ie,oe,ae,se,ue,le,ce,fe,pe,me,ve,ge,ye,_e,be,xe,we,Te,Ce,Ee,Se=0,Ae=new r.Buf8(4),Pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g;(n=e.state).mode===F&&(n.mode=R),ie=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,ue=n.bits,le=oe,ce=ae,Te=p;e:for(;;)switch(n.mode){case w:if(0===n.wrap){n.mode=R;break}for(;ue<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(2&n.wrap&&35615===se){n.check=0,Ae[0]=255&se,Ae[1]=se>>>8&255,n.check=o(n.check,Ae,2,0),se=0,ue=0,n.mode=T;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=Q;break}if((15&se)!==x){e.msg="unknown compression method",n.mode=Q;break}if(ue-=4,we=8+(15&(se>>>=4)),0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=Q;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&se?L:F,se=0,ue=0;break;case T:for(;ue<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(n.flags=se,(255&n.flags)!==x){e.msg="unknown compression method",n.mode=Q;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Q;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(Ae[0]=255&se,Ae[1]=se>>>8&255,n.check=o(n.check,Ae,2,0)),se=0,ue=0,n.mode=C;case C:for(;ue<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.head&&(n.head.time=se),512&n.flags&&(Ae[0]=255&se,Ae[1]=se>>>8&255,Ae[2]=se>>>16&255,Ae[3]=se>>>24&255,n.check=o(n.check,Ae,4,0)),se=0,ue=0,n.mode=E;case E:for(;ue<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(Ae[0]=255&se,Ae[1]=se>>>8&255,n.check=o(n.check,Ae,2,0)),se=0,ue=0,n.mode=S;case S:if(1024&n.flags){for(;ue<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(Ae[0]=255&se,Ae[1]=se>>>8&255,n.check=o(n.check,Ae,2,0)),se=0,ue=0}else n.head&&(n.head.extra=null);n.mode=A;case A:if(1024&n.flags&&((fe=n.length)>oe&&(fe=oe),fe&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,fe,we)),512&n.flags&&(n.check=o(n.check,ee,fe,ne)),oe-=fe,ne+=fe,n.length-=fe),n.length))break e;n.length=0,n.mode=P;case P:if(2048&n.flags){if(0===oe)break e;fe=0;do{we=ee[ne+fe++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we))}while(we&&fe<oe);if(512&n.flags&&(n.check=o(n.check,ee,fe,ne)),oe-=fe,ne+=fe,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=M;case M:if(4096&n.flags){if(0===oe)break e;fe=0;do{we=ee[ne+fe++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we))}while(we&&fe<oe);if(512&n.flags&&(n.check=o(n.check,ee,fe,ne)),oe-=fe,ne+=fe,we)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(512&n.flags){for(;ue<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Q;break}se=0,ue=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=F;break;case L:for(;ue<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}e.adler=n.check=re(se),se=0,ue=0,n.mode=I;case I:if(0===n.havedict)return e.next_out=ie,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ue,v;e.adler=n.check=1,n.mode=F;case F:if(t===h||t===f)break e;case R:if(n.last){se>>>=7&ue,ue-=7&ue,n.mode=Y;break}for(;ue<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}switch(n.last=1&se,ue-=1,3&(se>>>=1)){case 0:n.mode=k;break;case 1:if(de(n),n.mode=N,t===f){se>>>=2,ue-=2;break e}break;case 2:n.mode=B;break;case 3:e.msg="invalid block type",n.mode=Q}se>>>=2,ue-=2;break;case k:for(se>>>=7&ue,ue-=7&ue;ue<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Q;break}if(n.length=65535&se,se=0,ue=0,n.mode=D,t===f)break e;case D:n.mode=j;case j:if(fe=n.length){if(fe>oe&&(fe=oe),fe>ae&&(fe=ae),0===fe)break e;r.arraySet(te,ee,ne,fe,ie),oe-=fe,ne+=fe,ae-=fe,ie+=fe,n.length-=fe;break}n.mode=F;break;case B:for(;ue<14;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(n.nlen=257+(31&se),se>>>=5,ue-=5,n.ndist=1+(31&se),se>>>=5,ue-=5,n.ncode=4+(15&se),se>>>=4,ue-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Q;break}n.have=0,n.mode=U;case U:for(;n.have<n.ncode;){for(;ue<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.lens[Pe[n.have++]]=7&se,se>>>=3,ue-=3}for(;n.have<19;)n.lens[Pe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ce={bits:n.lenbits},Te=s(u,n.lens,0,19,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,Te){e.msg="invalid code lengths set",n.mode=Q;break}n.have=0,n.mode=z;case z:for(;n.have<n.nlen+n.ndist;){for(;ge=(Se=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(ye<16)se>>>=ve,ue-=ve,n.lens[n.have++]=ye;else{if(16===ye){for(Ee=ve+2;ue<Ee;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(se>>>=ve,ue-=ve,0===n.have){e.msg="invalid bit length repeat",n.mode=Q;break}we=n.lens[n.have-1],fe=3+(3&se),se>>>=2,ue-=2}else if(17===ye){for(Ee=ve+3;ue<Ee;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}ue-=ve,we=0,fe=3+(7&(se>>>=ve)),se>>>=3,ue-=3}else{for(Ee=ve+7;ue<Ee;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}ue-=ve,we=0,fe=11+(127&(se>>>=ve)),se>>>=7,ue-=7}if(n.have+fe>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Q;break}for(;fe--;)n.lens[n.have++]=we}}if(n.mode===Q)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Q;break}if(n.lenbits=9,Ce={bits:n.lenbits},Te=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,Te){e.msg="invalid literal/lengths set",n.mode=Q;break}if(n.distbits=6,n.distcode=n.distdyn,Ce={bits:n.distbits},Te=s(c,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ce),n.distbits=Ce.bits,Te){e.msg="invalid distances set",n.mode=Q;break}if(n.mode=N,t===f)break e;case N:n.mode=G;case G:if(oe>=6&&ae>=258){e.next_out=ie,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ue,a(e,ce),ie=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,ue=n.bits,n.mode===F&&(n.back=-1);break}for(n.back=0;ge=(Se=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(ge&&0==(240&ge)){for(_e=ve,be=ge,xe=ye;ge=(Se=n.lencode[xe+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(ve=Se>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}se>>>=_e,ue-=_e,n.back+=_e}if(se>>>=ve,ue-=ve,n.back+=ve,n.length=ye,0===ge){n.mode=X;break}if(32&ge){n.back=-1,n.mode=F;break}if(64&ge){e.msg="invalid literal/length code",n.mode=Q;break}n.extra=15&ge,n.mode=V;case V:if(n.extra){for(Ee=n.extra;ue<Ee;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,ue-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=H;case H:for(;ge=(Se=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(0==(240&ge)){for(_e=ve,be=ge,xe=ye;ge=(Se=n.distcode[xe+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(ve=Se>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}se>>>=_e,ue-=_e,n.back+=_e}if(se>>>=ve,ue-=ve,n.back+=ve,64&ge){e.msg="invalid distance code",n.mode=Q;break}n.offset=ye,n.extra=15&ge,n.mode=W;case W:if(n.extra){for(Ee=n.extra;ue<Ee;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,ue-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Q;break}n.mode=q;case q:if(0===ae)break e;if(fe=ce-ae,n.offset>fe){if((fe=n.offset-fe)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Q;break}fe>n.wnext?(fe-=n.wnext,pe=n.wsize-fe):pe=n.wnext-fe,fe>n.length&&(fe=n.length),me=n.window}else me=te,pe=ie-n.offset,fe=n.length;fe>ae&&(fe=ae),ae-=fe,n.length-=fe;do{te[ie++]=me[pe++]}while(--fe);0===n.length&&(n.mode=G);break;case X:if(0===ae)break e;te[ie++]=n.length,ae--,n.mode=G;break;case Y:if(n.wrap){for(;ue<32;){if(0===oe)break e;oe--,se|=ee[ne++]<<ue,ue+=8}if(ce-=ae,e.total_out+=ce,n.total+=ce,ce&&(e.adler=n.check=n.flags?o(n.check,te,ce,ie-ce):i(n.check,te,ce,ie-ce)),ce=ae,(n.flags?se:re(se))!==n.check){e.msg="incorrect data check",n.mode=Q;break}se=0,ue=0}n.mode=Z;case Z:if(n.wrap&&n.flags){for(;ue<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ue,ue+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Q;break}se=0,ue=0}n.mode=K;case K:Te=m;break e;case Q:Te=y;break e;case J:return _;case $:default:return g}return e.next_out=ie,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ue,(n.wsize||ce!==e.avail_out&&n.mode<Q&&(n.mode<Y||t!==d))&&he(e,e.output,e.next_out,ce-e.avail_out)?(n.mode=J,_):(le-=e.avail_in,ce-=e.avail_out,e.total_in+=le,e.total_out+=ce,n.total+=ce,n.wrap&&ce&&(e.adler=n.check=n.flags?o(n.check,te,ce,e.next_out-ce):i(n.check,te,ce,e.next_out-ce)),e.data_type=n.bits+(n.last?64:0)+(n.mode===F?128:0)+(n.mode===N||n.mode===D?256:0),(0===le&&0===ce||t===d)&&Te===p&&(Te=b),Te)},t.inflateEnd=function(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?g:(n.head=t,t.done=!1,p):g},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==I?g:n.mode===I&&i(1,t,r,0)!==n.check?y:he(e,t,r,r)?(n.mode=J,_):(n.havedict=1,p):g},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,o,a,s,u,l,c,d,h,f,p,m,v,g,y,_,b,x,w,T,C,E,S;n=e.state,r=e.next_in,E=e.input,i=r+(e.avail_in-5),o=e.next_out,S=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),u=n.dmax,l=n.wsize,c=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,v=n.distcode,g=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),_=m[f&g];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))S[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&_,(b&=15)&&(p<b&&(f+=E[r++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),_=v[f&y];n:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=v[(65535&_)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=E[r++]<<p,(p+=8)<b&&(f+=E[r++]<<p,p+=8)),(w+=f&(1<<b)-1)>u){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,w>(b=o-a)){if((b=w-b)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(T=0,C=h,0===d){if(T+=l-b,b<x){x-=b;do{S[o++]=h[T++]}while(--b);T=o-w,C=S}}else if(d<b){if(T+=l+d-b,(b-=d)<x){x-=b;do{S[o++]=h[T++]}while(--b);if(T=0,d<x){x-=b=d;do{S[o++]=h[T++]}while(--b);T=o-w,C=S}}}else if(T+=d-b,b<x){x-=b;do{S[o++]=h[T++]}while(--b);T=o-w,C=S}for(;x>2;)S[o++]=C[T++],S[o++]=C[T++],S[o++]=C[T++],x-=3;x&&(S[o++]=C[T++],x>1&&(S[o++]=C[T++]))}else{T=o-w;do{S[o++]=S[T++],S[o++]=S[T++],S[o++]=S[T++],x-=3}while(x>2);x&&(S[o++]=S[T++],x>1&&(S[o++]=S[T++]))}break}}break}}while(r<i&&o<s);r-=x=p>>3,f&=(1<<(p-=x<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(5),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,u,l,c,d,h){var f,p,m,v,g,y,_,b,x,w=h.bits,T=0,C=0,E=0,S=0,A=0,P=0,M=0,O=0,L=0,I=0,F=null,R=0,k=new r.Buf16(16),D=new r.Buf16(16),j=null,B=0;for(T=0;T<=15;T++)k[T]=0;for(C=0;C<u;C++)k[t[n+C]]++;for(A=w,S=15;S>=1&&0===k[S];S--);if(A>S&&(A=S),0===S)return l[c++]=20971520,l[c++]=20971520,h.bits=1,0;for(E=1;E<S&&0===k[E];E++);for(A<E&&(A=E),O=1,T=1;T<=15;T++)if(O<<=1,(O-=k[T])<0)return-1;if(O>0&&(0===e||1!==S))return-1;for(D[1]=0,T=1;T<15;T++)D[T+1]=D[T]+k[T];for(C=0;C<u;C++)0!==t[n+C]&&(d[D[t[n+C]]++]=C);if(0===e?(F=j=d,y=19):1===e?(F=i,R-=257,j=o,B-=257,y=256):(F=a,j=s,y=-1),I=0,C=0,T=E,g=c,P=A,M=0,m=-1,v=(L=1<<A)-1,1===e&&L>852||2===e&&L>592)return 1;for(;;){_=T-M,d[C]<y?(b=0,x=d[C]):d[C]>y?(b=j[B+d[C]],x=F[R+d[C]]):(b=96,x=0),f=1<<T-M,E=p=1<<P;do{l[g+(I>>M)+(p-=f)]=_<<24|b<<16|x|0}while(0!==p);for(f=1<<T-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,C++,0==--k[T]){if(T===S)break;T=t[n+d[C]]}if(T>A&&(I&v)!==m){for(0===M&&(M=A),g+=E,O=1<<(P=T-M);P+M<S&&!((O-=k[P+M])<=0);)P++,O<<=1;if(L+=1<<P,1===e&&L>852||2===e&&L>592)return 1;l[m=I&v]=A<<24|P<<16|g-c|0}}return 0!==I&&(l[g+I]=T-M<<24|64<<16|0),h.bits=A,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";function r(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+a+"}":"unknown format"}n.r(t);var i=Array.prototype.forEach,o=Array.prototype.slice,a={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(i&&e.forEach&&e.forEach===i)e.forEach(t,n);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,o=arguments;var a=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},s=[{litmus:a.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r}}},{litmus:a.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:a.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:a.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b)&&a.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v)&&a.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,l=void 0,c=function(){l=!1;var e=arguments.length>1?a.toArray(arguments):arguments[0];return a.each(s,function(t){if(t.litmus(e))return a.each(t.conversions,function(t,n){if(u=t.read(e),!1===l&&!1!==u)return l=u,u.conversionName=n,u.conversion=t,a.BREAK}),a.BREAK}),l},d=void 0,h={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(d=8*t)|e&~(255<<d)}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),v=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},g=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(){function e(){if(p(this,e),this.__state=c.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(e,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(_.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function x(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(_.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=h.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");a.extend(e.__state,h.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=h.rgb_to_hsv(e.r,e.g,e.b);a.extend(e.__state,{s:t.s,v:t.v}),a.isNaN(t.h)?a.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(_.prototype,"r",2),b(_.prototype,"g",1),b(_.prototype,"b",0),x(_.prototype,"h"),x(_.prototype,"s"),x(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var w=function(){function e(t,n){p(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return m(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),T={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){a.each(e,function(e){T[e]=t})});var C=/(\d+(\.\d+)?)px/;function E(e){if("0"===e||a.isUndefined(e))return 0;var t=e.match(C);return a.isNull(t)?0:parseFloat(t[1])}var S={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;a.isUndefined(i)&&(i=!0),a.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},o=T[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var u=i.x||i.clientX||0,l=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;a.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0)}a.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),S},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),S},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return S},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return S},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return E(t["border-left-width"])+E(t["border-right-width"])+E(t["padding-left"])+E(t["padding-right"])+E(t.width)},getHeight:function(e){var t=getComputedStyle(e);return E(t["border-top-width"])+E(t["border-bottom-width"])+E(t["padding-top"])+E(t["padding-bottom"])+E(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},A=function(e){function t(e,n){p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),S.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return g(t,w),m(t,[{key:"setValue",value:function(e){var n=v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),P=function(e){function t(e,n,r){p(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r,s=i;if(i.__select=document.createElement("select"),a.isArray(o)){var u={};a.each(o,function(e){u[e]=e}),o=u}return a.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),i.updateDisplay(),S.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),i.domElement.appendChild(i.__select),i}return g(t,w),m(t,[{key:"setValue",value:function(e){var n=v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return S.isActive(this.__select)?this:(this.__select.value=this.getValue(),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),M=function(e){function t(e,n){p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),S.bind(r.__input,"keyup",o),S.bind(r.__input,"change",o),S.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),S.bind(r.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return g(t,w),m(t,[{key:"updateDisplay",value:function(){return S.isActive(this.__input)||(this.__input.value=this.getValue()),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function O(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var L=function(e){function t(e,n,r){p(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,a.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=O(i.__impliedStep),i}return g(t,w),m(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=O(e),this}}]),t}();var I=function(e){function t(e,n,r){p(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var o=i,s=void 0;function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function c(){S.unbind(window,"mousemove",l),S.unbind(window,"mouseup",c),u()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),S.bind(i.__input,"change",function(){var e=parseFloat(o.__input.value);a.isNaN(e)||o.setValue(e)}),S.bind(i.__input,"blur",function(){u()}),S.bind(i.__input,"mousedown",function(e){S.bind(window,"mousemove",l),S.bind(window,"mouseup",c),s=e.clientY}),S.bind(i.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return g(t,L),m(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}(this.getValue(),this.__precision),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function F(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var R=function(e){function t(e,n,r,i,o){p(this,t);var a=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:o})),s=a;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(F(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function l(){S.unbind(window,"mousemove",u),S.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(F(t,n.left,n.right,s.__min,s.__max))}function d(){S.unbind(window,"touchmove",c),S.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),S.bind(a.__background,"mousedown",function(e){document.activeElement.blur(),S.bind(window,"mousemove",u),S.bind(window,"mouseup",l),u(e)}),S.bind(a.__background,"touchstart",function(e){if(1!==e.touches.length)return;S.bind(window,"touchmove",c),S.bind(window,"touchend",d),c(e)}),S.addClass(a.__background,"slider"),S.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return g(t,L),m(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),k=function(e){function t(e,n,r){p(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,S.bind(i.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),S.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return g(t,w),m(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),D=function(e){function t(e,n){p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new _(r.getValue()),r.__temp=new _(0);var i=r;r.domElement=document.createElement("div"),S.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",S.bind(r.__input,"keydown",function(e){13===e.keyCode&&h.call(this)}),S.bind(r.__input,"blur",h),S.bind(r.__selector,"mousedown",function(){S.addClass(this,"drag").bind(window,"mouseup",function(){S.removeClass(i.__selector,"drag")})}),S.bind(r.__selector,"touchstart",function(){S.addClass(this,"drag").bind(window,"touchend",function(){S.removeClass(i.__selector,"drag")})});var o=document.createElement("div");function s(e){m(e),S.bind(window,"mousemove",m),S.bind(window,"touchmove",m),S.bind(window,"mouseup",l),S.bind(window,"touchend",l)}function u(e){v(e),S.bind(window,"mousemove",v),S.bind(window,"touchmove",v),S.bind(window,"mouseup",d),S.bind(window,"touchend",d)}function l(){S.unbind(window,"mousemove",m),S.unbind(window,"touchmove",m),S.unbind(window,"mouseup",l),S.unbind(window,"touchend",l),f()}function d(){S.unbind(window,"mousemove",v),S.unbind(window,"touchmove",v),S.unbind(window,"mouseup",d),S.unbind(window,"touchend",d),f()}function h(){var e=c(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function f(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,o=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return a.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),a.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),a.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),a.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),a.extend(o.style,{width:"100%",height:"100%",background:"none"}),B(o,"top","rgba(0,0,0,0)","#000"),a.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(r.__hue_field),a.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),S.bind(r.__saturation_field,"mousedown",s),S.bind(r.__saturation_field,"touchstart",s),S.bind(r.__field_knob,"mousedown",s),S.bind(r.__field_knob,"touchstart",s),S.bind(r.__hue_field,"mousedown",u),S.bind(r.__hue_field,"touchstart",u),r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return g(t,w),m(t,[{key:"updateDisplay",value:function(){var e=c(this.getValue());if(!1!==e){var t=!1;a.each(_.COMPONENTS,function(n){if(!a.isUndefined(e[n])&&!a.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&a.extend(this.__color.__state,e)}a.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,B(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),a.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(),j=["-moz-","-o-","-webkit-","-ms-",""];function B(e,t,n,r){e.style.background="",a.each(j,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}var U=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},z=function(e,t){var n=e[t];return a.isArray(arguments[2])||a.isObject(arguments[2])?new P(e,t,arguments[2]):a.isNumber(n)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?a.isNumber(arguments[4])?new R(e,t,arguments[2],arguments[3],arguments[4]):new R(e,t,arguments[2],arguments[3]):a.isNumber(arguments[4])?new I(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new I(e,t,{min:arguments[2],max:arguments[3]}):a.isString(n)?new M(e,t):a.isFunction(n)?new k(e,t,""):a.isBoolean(n)?new A(e,t):null};var N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},G=function(){function e(){p(this,e),this.backgroundElement=document.createElement("div"),a.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),S.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),a.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;S.bind(this.backgroundElement,"click",function(){t.hide()})}return m(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),a.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",S.unbind(e.domElement,"webkitTransitionEnd",t),S.unbind(e.domElement,"transitionend",t),S.unbind(e.domElement,"oTransitionEnd",t)};S.bind(this.domElement,"webkitTransitionEnd",t),S.bind(this.domElement,"transitionend",t),S.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-S.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-S.getHeight(this.domElement)/2+"px"}}]),e}();U(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var V="Default",H=function(){try{return!!window.localStorage}catch(e){return!1}}(),W=void 0,q=!0,X=void 0,Y=!1,Z=[],K=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),S.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=a.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=a.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),a.isUndefined(r.load)?r.load={preset:V}:r.preset&&(r.load.preset=r.preset),a.isUndefined(r.parent)&&r.hideable&&Z.push(this),r.resizable=a.isUndefined(r.parent)&&r.resizable,r.autoPlace&&a.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=H&&"true"===localStorage.getItem(ne(this,"isLocal")),o=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ae(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?S.addClass(n.__ul,e.CLASS_CLOSED):S.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(e){H&&(i=e,e?S.bind(window,"unload",o):S.unbind(window,"unload",o),localStorage.setItem(ne(n,"isLocal"),e))}}}),a.isUndefined(r.parent)){if(r.closed=!1,S.addClass(this.domElement,e.CLASS_MAIN),S.makeSelectable(this.domElement,!1),H&&i){n.useLocalStorage=!0;var u=localStorage.getItem(ne(this,"gui"));u&&(r.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,S.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(S.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(S.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),S.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===r.closed&&(r.closed=!0);var l=document.createTextNode(r.name);S.addClass(l,"controller-name"),s=Q(n,l);S.addClass(this.__ul,e.CLASS_CLOSED),S.addClass(s,"title"),S.bind(s,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(a.isUndefined(r.parent)&&(q&&(X=document.createElement("div"),S.addClass(X,"dg"),S.addClass(X,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(X),q=!1),X.appendChild(this.domElement),S.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ae(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},S.bind(window,"resize",this.__resizeHandler),S.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),S.bind(this.__ul,"transitionend",this.__resizeHandler),S.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&oe(this),o=function(){H&&"true"===localStorage.getItem(ne(n,"isLocal"))&&localStorage.setItem(ne(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,r.parent||function(){var e=n.getRoot();e.width+=1,a.defer(function(){e.width-=1})}()};function Q(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function J(e){S.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&S.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function $(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function ee(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[V])return;a=o[V]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function te(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new D(t,n);else{var o=[t,n].concat(r.factoryArgs);i=z.apply(e,o)}r.before instanceof w&&(r.before=r.before.__li),ee(e,i),S.addClass(i.domElement,"c");var s=document.createElement("span");S.addClass(s,"property-name"),s.innerHTML=i.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(i.domElement);var l=Q(e,u,r.before);return S.addClass(l,K.CLASS_CONTROLLER_ROW),i instanceof D?S.addClass(l,"color"):S.addClass(l,f(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,a.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:r,factoryArgs:[a.toArray(arguments)]})}if(a.isArray(t)||a.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof R){var r=new I(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});a.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}}),S.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof I){var i=function(t){if(a.isNumber(n.__min)&&a.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=te(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),i&&o.listen(),o}return t};n.min=a.compose(i,n.min),n.max=a.compose(i,n.max)}else n instanceof A?(S.bind(t,"click",function(){S.fakeEvent(n.__checkbox,"click")}),S.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof k?(S.bind(t,"click",function(){S.fakeEvent(n.__button,"click")}),S.bind(t,"mouseover",function(){S.addClass(n.__button,"hover")}),S.bind(t,"mouseout",function(){S.removeClass(n.__button,"hover")})):n instanceof D&&(S.addClass(t,"color"),n.updateDisplay=a.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=a.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&$(e.getRoot(),!0),t},n.setValue)}(e,l,i),e.__controllers.push(i),i}function ne(e,t){return document.location.href+"."+t}function re(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ie(e,t){t.style.display=e.useLocalStorage?"block":"none"}function oe(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){S.removeClass(e.__closeButton,K.CLASS_DRAG),S.unbind(window,"mousemove",n),S.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,S.addClass(e.__closeButton,K.CLASS_DRAG),S.bind(window,"mousemove",n),S.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),a.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),S.bind(e.__resize_handle,"mousedown",i),S.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function se(e,t){var n={};return a.each(e.__rememberedObjects,function(r,i){var o={},s=e.__rememberedObjectIndecesToControllers[i];a.each(s,function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[i]=o}),n}K.toggleHide=function(){Y=!Y,a.each(Z,function(e){e.domElement.style.display=Y?"none":""})},K.CLASS_AUTO_PLACE="a",K.CLASS_AUTO_PLACE_CONTAINER="ac",K.CLASS_MAIN="main",K.CLASS_CONTROLLER_ROW="cr",K.CLASS_TOO_TALL="taller-than-window",K.CLASS_CLOSED="closed",K.CLASS_CLOSE_BUTTON="close-button",K.CLASS_CLOSE_TOP="close-top",K.CLASS_CLOSE_BOTTOM="close-bottom",K.CLASS_DRAG="drag",K.DEFAULT_WIDTH=245,K.TEXT_CLOSED="Close Controls",K.TEXT_OPEN="Open Controls",K._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||K.toggleHide()},S.bind(window,"keydown",K._keydownHandler,!1),a.extend(K.prototype,{add:function(e,t){return te(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return te(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;a.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&X.removeChild(this.domElement);var e=this;a.each(this.__folders,function(t){e.removeFolder(t)}),S.unbind(window,"keydown",K._keydownHandler,!1),J(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new K(t);this.__folders[e]=n;var r=Q(this,n.domElement);return S.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],J(e);var t=this;a.each(e.__folders,function(t){e.removeFolder(t)}),a.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=S.getOffset(e.__ul).top,n=0;a.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=S.getHeight(t))}),window.innerHeight-t-20<n?(S.addClass(e.domElement,K.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(S.removeClass(e.domElement,K.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&a.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:a.debounce(function(){this.onResize()},50),remember:function(){if(a.isUndefined(W)&&((W=new G).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;a.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");S.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),S.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",S.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",S.addClass(r,"button"),S.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",S.addClass(i,"button"),S.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",S.addClass(o,"button"),S.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?a.each(e.load.remembered,function(t,n){re(e,n,n===e.preset)}):re(e,V,!1);if(S.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(o),H){var u=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(ne(e,"isLocal"))&&l.setAttribute("checked","checked"),ie(e,u),S.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,ie(e,u)})}var d=document.getElementById("dg-new-constructor");S.bind(d,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||W.hide()}),S.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),W.show(),d.focus(),d.select()}),S.bind(r,"click",function(){e.save()}),S.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),S.bind(o,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=se(this)),e.folders={},a.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=se(this),$(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[V]=se(this,!0)),this.load.remembered[e]=se(this),this.preset=e,re(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){a.each(this.__controllers,function(t){this.getRoot().load.remembered?ee(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),a.each(this.__folders,function(e){e.revert(e)}),e||$(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&N.call(window,function(){e(t)});a.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){a.each(this.__controllers,function(e){e.updateDisplay()}),a.each(this.__folders,function(e){e.updateDisplay()})}});var ue=K,le=n(0),ce=n(7),de=n(2),he=n(76),fe=n(20);var pe=()=>"\nvarying float vAltitude;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n\nattribute vec2 octNormal;\n\nuniform bool useOctNormal;\n\n#include <fog_pars_vertex>\n\nvec2 signNotZero(vec2 v) {\n  return vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\n\nvec3 oct_to_float32x3(vec2 e) {\n  vec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\n  if (v.z < 0.0) {\n    v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n  }\n  return normalize(v);\n}\n\nvec2 snorm_to_float32x2(vec2 s) {\n  vec2 v = ((s / 255.0) * 2.0) - 1.0;\n  return v;\n}\n\nvoid main() {\n  vAltitude = position[2]; // z value\n\n  if (useOctNormal) {\n    vec2 floatOctNormal = snorm_to_float32x2(octNormal);\n    vec3 decNormal = oct_to_float32x3(floatOctNormal);\n    vNormal = decNormal;\n  } else {\n    vNormal = normal;\n  }\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  \n  #include <begin_vertex>\n  #include <project_vertex>\n  #include <fog_vertex>\n}\n";var me=e=>`\n#define COLOR_STEPS_COUNT ${e.COLOR_STEPS_COUNT}\n\nvarying float vAltitude;\nvarying vec2 vUv;\nvarying vec3 vNormal;\n\nuniform vec3 colorSteps[COLOR_STEPS_COUNT];\nuniform float altitudeSteps[COLOR_STEPS_COUNT];\n\nuniform sampler2D texture;\nuniform int hasTexture;\nuniform float textureIntensity;\nuniform vec3 lightVector;\nuniform float opacity;\n\n#include <fog_pars_fragment>\n\nvoid main() {\n  vec3 altitudeColor;\n  float lowestAltitude = altitudeSteps[0];\n  float highestAlttitude = altitudeSteps[COLOR_STEPS_COUNT - 1];\n  vec3 lowestAltitudeColor = colorSteps[0];\n  vec3 highestAltitudeColor = colorSteps[COLOR_STEPS_COUNT - 1];\n\n  if (vAltitude < lowestAltitude) {\n    altitudeColor = lowestAltitudeColor;\n  }\n\n  if (vAltitude > highestAlttitude) {\n    altitudeColor = highestAltitudeColor;\n  }\n\n  for(int i = 0; i < COLOR_STEPS_COUNT - 1; i++) {\n    if (vAltitude > altitudeSteps[i] && vAltitude <= altitudeSteps[i + 1]) {\n      altitudeColor = mix(\n        colorSteps[i],\n        colorSteps[i + 1],\n        (vAltitude - altitudeSteps[i]) / (altitudeSteps[i + 1] - altitudeSteps[i])\n      );\n    }\n  }\n\n  if (hasTexture == 1) {\n    vec4 texColor = texture2D(texture, vUv);\n\n    gl_FragColor = vec4(mix(altitudeColor.xyz, texColor.xyz, textureIntensity), 1.0);\n  } else {\n    vec3 color = altitudeColor * clamp(dot(vNormal, normalize(lightVector)), 0.3, 1.0); \n  \n    gl_FragColor = vec4(color, opacity);\n  }\n  \n  #include <fog_fragment>\n}\n`;const ve={colorSteps:[{color:new le.Vector3(0,0,0),altitude:-300},{color:new le.Vector3(1,1,1),altitude:8848}],texture:null,textureIntensity:.4,lightVector:new le.Vector3(1,0,.5),opacity:1};class ge extends le.ShaderMaterial{constructor(e,t){const n=Object.assign({},ve,t),r=n.colorSteps.slice().sort((e,t)=>e.altitude>=t.altitude),i=r.map(e=>e.color),o=r.map(e=>e.altitude),a=le.UniformsUtils.merge([{useOctNormal:{value:ge.containsOctNormals(e)},colorSteps:{value:i},altitudeSteps:{value:o},textureIntensity:{value:n.textureIntensity},hasTexture:{value:null===n.texture?0:1},texture:{value:n.texture},lightVector:{value:n.lightVector},opacity:{value:n.opacity}},le.UniformsLib.fog]);super({vertexShader:pe(),fragmentShader:me({COLOR_STEPS_COUNT:r.length}),uniforms:a})}static containsOctNormals(e){return void 0!==e.geometries[0].vertexAttributes.find(this.isOctNormalAttribute)}static isOctNormalAttribute(e){return"octNormal"===e.name}}class ye extends fe.TileFactory{constructor(e){super(_e),this.getTileMaterial=e}create(e,t){return new _e(e,t,this.getTileMaterial)}}class _e extends ce.Tile{constructor(e,t,n){super(e,t),this.getTileMaterial=n}generateTileMaterial(e){return this.getTileMaterial?this.getTileMaterial(this,e):Promise.resolve(new ge(e))}getTileSize(e,t,n){const r=new le.Box3,i=new le.Vector3,o=n.getGeoBox(e);return t.projectBox(o,r),r.getSize(i),i}scaleVertices(e,t,n){const r=n.x,i=n.y,o=t.maxHeight-t.minHeight,a=new Float32Array(e.length);for(let s=0;s<e.length;s+=3)a[s]=e[s]*r-n.x/2,a[s+1]=e[s+1]*i-n.y/2,a[s+2]=e[s+2]*o+t.minHeight;return a}createObjects(e,t){this.generateTileMaterial(e).then(n=>this.createTileObjects(n,e,t))}createTileObjects(e,t,n){const r=this.getTileSize(this.tileKey,this.projection,this.dataSource.getTilingScheme()),i=t.geometries[0],o=new le.BufferGeometry,a=new le.Mesh(o,e);i.vertexAttributes.forEach(e=>{const t="position"===e.name?this.scaleVertices(e.buffer,e.metadata,r):e.buffer;o.addAttribute(e.name,new le.BufferAttribute(t,e.itemCount))}),void 0!==i.index&&o.setIndex(new le.BufferAttribute(i.index.buffer,1)),o.attributes.normal||o.attributes.octNormal||o.computeVertexNormals(),this.registerTileObject(a),n.push(a),this.dataSource.requestUpdate()}}class be{constructor(e){if(void 0===e)throw new Error('"fetchTile()" method was not provided');this.fetchTile=e}connect(){return Promise.resolve()}ready(){return!0}getTile(e){return this.fetchTile(e)}}class xe extends fe.TileDataSource{constructor(e){if(void 0===e.tilingScheme)throw new Error('No "tilingScheme" option provided.');if(void 0===e.concurrentDecoderServiceName)throw new Error('No "concurrentDecoderServiceName" option provided. It should be an ID of one of the supported decoders.');if(void 0===e.concurrentDecoderScriptUrl)throw new Error('No "concurrentDecoderScriptUrl" option provided. It should be URL of a decoder worker used to decode tiles.');super(new ye(e.getTileMaterial),{id:"terrain",tilingScheme:e.tilingScheme,dataProvider:new be(e.fetchTile),useWorker:!0,concurrentDecoderServiceName:e.concurrentDecoderServiceName,concurrentDecoderScriptUrl:e.concurrentDecoderScriptUrl}),this.options=e,void 0!==e.decoderOptions&&this.decoder.connect().then(()=>{this.decoder.configure(e.decoderOptions)})}connect(){return this.decoder.connect()}ready(){return!0}shouldPreloadTiles(){return!0}getDisplayZoomLevel(e){return void 0!==this.options.getDisplayZoomLevel?this.options.getDisplayZoomLevel(e):e}}new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);const we={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4};we.extensions;const Te="quantized-mesh-tile-decoder";n(77);const Ce={float32:"float32",terrarium:"terrarium"},Ee=(Ce.terrarium,"png-tile-decoder");var Se={APP_ID:"cJ7gyg679deVM55KumC5",APP_CODE:"tJ69vQOiDh26e1R_esdVaA",CESIUM_USER_ACCESS_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjNTJiNGQ3Ny05N2EzLTRiOTQtYWFiYS05NmE3MzAxN2FmODciLCJpZCI6MjgxOCwic2NvcGVzIjpbImFzciJdLCJhc3NldHMiOlsxXSwiaWF0IjoxNTQ3MjA2NjM5fQ.cFwN3KPr0VmuVEvak282nc9L-eG8SylHJCkqUFNOpN4"};const Ae=["Grand Teton National Park (Quantized Mesh)","Cesium World Terrain (Quantized Mesh)","Nextzen Terrain (PNG)"],Pe=["Elevation Styling","Texture","Wireframe"];const Me=new le.TextureLoader;function Oe(e){const t=function(e){const t=de.mercatorTilingScheme.getTileKey(e.geoBox.center,e.tileKey.level);return`https://${Math.round(3*Math.random())+1}.aerial.maps.api.here.com/maptile/2.1/basetile/newest/satellite.day/${t.level}/${t.column}/${t.rowCount()-t.row-1}/512/png?app_id=${Se.APP_ID}&app_code=${Se.APP_CODE}`}(e);return new Promise((e,n)=>{Me.load(t,e,void 0,n)})}Me.crossOrigin="";const Le=[{color:new le.Vector3(.670588235,.850980392,.91372549),altitude:700},{color:new le.Vector3(.109803922,.564705882,.6),altitude:1500},{color:new le.Vector3(.403921569,.662745098,.811764706),altitude:2e3},{color:new le.Vector3(.741176471,.788235294,.882352941),altitude:2800},{color:new le.Vector3(1,1,1),altitude:3e3}],Ie=new le.Vector3(.7,0,.5),Fe=new le.Vector3(0,-1,0);function Re(e,t,n){switch(n.style){case Pe[0]:return Promise.resolve(new ge(t,{colorSteps:Le,lightVector:n.dataset===Ae[1]?Fe:Ie}));case Pe[1]:return Oe(e).then(e=>(e.minFilter=le.LinearFilter,e.magFilter=le.LinearFilter,e.generateMipmaps=!1,e.wrapS=e.wrapT=le.ClampToEdgeWrapping,new le.MeshBasicMaterial({map:e})));case Pe[2]:return Promise.resolve(new le.MeshBasicMaterial({color:0,wireframe:!0}))}}function ke(e){const t=e.column,n=e.rowCount()-e.row-1,r=`https://s3.amazonaws.com/elevation-tiles-prod/terrarium/${e.level}/${t}/${n}.png`;return window.fetch(r).then(e=>{if(200!==e.status)throw new Error(`Unable to load tile ${r}`);return e.arrayBuffer()}).catch(e=>{console.log(e)})}const De={currentDataset:Ae[0],isAttributionPopupVisible:!1},je=document.querySelector(".attribution-trigger"),Be=document.querySelector(".attribution-popup"),Ue=document.querySelector(".cesium-attribution"),ze=document.querySelector(".nextzen-attribution"),Ne=document.querySelector(".sample-attribution"),Ge=document.querySelector(".cesium-ion-logo");function Ve(e){je.classList.toggle("active",e.isAttributionPopupVisible),Be.style.display=e.isAttributionPopupVisible?"block":"none",Ne.style.display=e.currentDataset===Ae[0]?"block":"none",Ue.style.display=e.currentDataset===Ae[1]?"block":"none",ze.style.display=e.currentDataset===Ae[2]?"block":"none",Ge.style.display=e.currentDataset===Ae[1]?"block":"none"}je.addEventListener("click",function(){De.isAttributionPopupVisible=!De.isAttributionPopupVisible,Ve(De)}),window.addEventListener("message",function(e){if("object"!=typeof e.data||"dataset-change"!==e.data.type)return;De.currentDataset=e.data.dataset,Ve(De)}),Ve(De);const He="./dist/quantized-mesh-decoder.bundle.js",We="./dist/png-decoder.bundle.js";function qe(e,t){return new xe({concurrentDecoderServiceName:Te,concurrentDecoderScriptUrl:He,tilingScheme:de.hereTilingScheme,fetchTile:t=>(function(e,t){const n=e.column,r=e.row,i=`https://assets.cesium.com/1/${e.level-1}/${n}/${r}.terrain?extensions=octvertexnormals&v=1.1.0`;return window.fetch(i,{headers:{Accept:`application/vnd.quantized-mesh,application/octet-stream;q=0.9;access_token=${t};`}}).then(e=>{if(200!==e.status)throw new Error(`Unable to load tile ${i}`);return e.arrayBuffer()}).catch(e=>{console.log(e)})})(t,e),getTileMaterial:(e,n)=>Re(e,n,t)})}function Xe(e){return new xe({concurrentDecoderServiceName:Te,concurrentDecoderScriptUrl:He,tilingScheme:de.webMercatorTilingScheme,fetchTile:e=>(function(e){const t=e.column,n=e.rowCount()-e.row-1,r=`https://nikgarmash.com/grand-teton-tiles/tiles/${e.level}/${t}/${n}.terrain`;return window.fetch(r).then(e=>{if(200!==e.status)throw new Error(`Unable to load tile ${r}`);return e.arrayBuffer()}).catch(e=>{console.log(e)})})(e),getTileMaterial:(t,n)=>Re(t,n,e),getDisplayZoomLevel:e=>le.Math.clamp(e+2,8,14)})}(function(){const e=`https://api.cesium.com/v1/assets/1/endpoint?access_token=${Se.CESIUM_USER_ACCESS_TOKEN}`;return window.fetch(e).then(e=>e.json()).then(e=>e.accessToken).catch(e=>console.log(e))})().then(e=>{const t={dataset:Ae[0],style:Pe[0]},n=function(e){const t=new ce.MapView({minZoomLevel:8,maxZoomLevel:14,canvas:e,maxVisibleDataSourceTiles:300,tileCacheSize:1e3});return new he.MapControls(t),t.resize(window.innerWidth,window.innerHeight),t.zoomLevelBias=.5,window.addEventListener("resize",()=>{t.resize(window.innerWidth,window.innerHeight)}),t}(document.getElementById("map")),r=qe(e,t),i=Xe(t),o=function(e,t){return new xe({concurrentDecoderServiceName:Ee,concurrentDecoderScriptUrl:We,tilingScheme:de.mercatorTilingScheme,fetchTile:ke,getTileMaterial:(t,n)=>Re(t,n,e),decoderOptions:t})}(t,{widthSegments:63,heightSegments:63,demEncoding:Ce.terrarium});n.addDataSource(r),n.addDataSource(i),n.addDataSource(o),i.enabled=t.dataset===Ae[0],r.enabled=t.dataset===Ae[1],o.enabled=t.dataset===Ae[2],n.setCameraGeolocationAndZoom(new de.GeoCoordinates(43.7519975195926,-110.73214288570348),12),n.camera.rotateX(le.Math.degToRad(35));const a=new ue({width:300}),s=a.add(t,"dataset",Ae),u=a.add(t,"style",Pe);function l(){n.clearTileCache(),n.update()}s.onChange(e=>{i.enabled=e===Ae[0],r.enabled=e===Ae[1],o.enabled=e===Ae[2],u.setValue(Pe[0]),u.updateDisplay(),u.domElement.querySelectorAll("option[value*=Texture]").forEach(t=>{t.disabled=e===Ae[1]}),l(),window.postMessage({type:"dataset-change",dataset:e},"*")}),u.onChange(l)})}]);
//# sourceMappingURL=app.bundle.js.map