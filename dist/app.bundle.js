!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=155)}([function(e,t){e.exports=THREE},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(90)),i(r(91)),i(r(95)),i(r(96)),i(r(97)),i(r(98)),i(r(99)),i(r(100)),i(r(101)),i(r(102))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(53)),i(r(111)),i(r(112)),i(r(113)),i(r(114)),i(r(115)),i(r(116)),i(r(117)),i(r(118))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(9)),i(r(80)),i(r(5)),i(r(15)),i(r(38)),i(r(81)),i(r(23)),i(r(39)),i(r(40)),i(r(41)),i(r(24)),i(r(82)),i(r(42)),i(r(16)),i(r(43)),i(r(44)),i(r(17)),i(r(83)),i(r(84)),i(r(85)),i(r(86)),i(r(10))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(46)),i(r(89)),i(r(104)),i(r(26)),i(r(105)),i(r(106)),i(r(107)),i(r(47)),i(r(108)),i(r(109))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=180/Math.PI,n=Math.PI/180,o=function(){function e(e,t,r){this.latitude=e,this.longitude=t,this.altitude=r}return e.fromDegrees=function(t,r,i){return new e(t,r,i)},e.fromRadians=function(t,r,n){return new e(t*i,r*i,n)},Object.defineProperty(e.prototype,"latitudeInRadians",{get:function(){return this.latitude*n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInRadians",{get:function(){return this.longitude*n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeInDegrees",{get:function(){return this.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInDegrees",{get:function(){return this.longitude},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!isNaN(this.latitude)&&!isNaN(this.longitude)},e.prototype.normalized=function(){var t,r=this.latitude,i=this.longitude;if(isNaN(r)||isNaN(i))return this;r>90&&((t=(r+90)%360)>=180&&(i+=180,t=360-t),r=t-90);r<-90&&((t=(r-90)%360)<=-180&&(i+=180,t=-360-t),r=t+90);return(i<-180||i>180)&&(i=(i+180)%360-180),r===this.latitude&&i===this.longitude?this:new e(r,i,this.altitude)},e.prototype.equals=function(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude},e.prototype.copy=function(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this},e.prototype.clone=function(){return new e(this.latitude,this.longitude,this.altitude)},e}();t.GeoCoordinates=o},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n,o,a,s,l,u,c,d=r(0);!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(n=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(o=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(a=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(s=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(u=t.WrappingMode||(t.WrappingMode={})),function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(n.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=o.Regular,e.DEFAULT_FONT_VARIANT=a.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new d.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new d.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=u.Word,e.DEFAULT_VERTICAL_ALIGNMENT=s.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left}(c=t.DefaultTextStyle||(t.DefaultTextStyle={}));var h=function(){function e(e){void 0===e&&(e={}),this.m_params={fontName:void 0!==e.fontName?e.fontName:c.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?e.fontSize:{unit:c.DEFAULT_FONT_SIZE.unit,size:c.DEFAULT_FONT_SIZE.size,backgroundSize:c.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:c.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:c.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:c.DEFAULT_ROTATION,color:void 0!==e.color?e.color:new d.Color(c.DEFAULT_COLOR),opacity:void 0!==e.opacity?e.opacity:c.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor:new d.Color(c.DEFAULT_BACKGROUND_COLOR),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:c.DEFAULT_BACKGROUND_OPACITY}}return Object.defineProperty(e.prototype,"params",{get:function(){return this.m_params},set:function(e){this.m_params=i({},this.m_params,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this.m_params.fontName},set:function(e){this.m_params.fontName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.m_params.fontSize},set:function(e){this.m_params.fontSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.m_params.fontStyle},set:function(e){this.m_params.fontStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontVariant",{get:function(){return this.m_params.fontVariant},set:function(e){this.m_params.fontVariant=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.m_params.rotation},set:function(e){this.m_params.rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_params.color},set:function(e){this.m_params.color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this.m_params.backgroundColor},set:function(e){this.m_params.backgroundColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.m_params.opacity},set:function(e){this.m_params.opacity=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundOpacity",{get:function(){return this.m_params.backgroundOpacity},set:function(e){this.m_params.backgroundOpacity=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){return void 0===t&&(t={}),new e(i({},this.m_params,t))},e}();t.TextRenderStyle=h;var f=function(){function e(e){void 0===e&&(e={}),this.m_params={tracking:void 0!==e.tracking?e.tracking:c.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:c.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:c.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:c.DEFAULT_LINE_WIDTH,lineRotation:void 0!==e.lineRotation?e.lineRotation:c.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:c.DEFAULT_WRAPPING_MODE,verticalAlignment:void 0!==e.verticalAlignment?e.verticalAlignment:c.DEFAULT_VERTICAL_ALIGNMENT,horizontalAlignment:void 0!==e.horizontalAlignment?e.horizontalAlignment:c.DEFAULT_HORIZONTAL_ALIGNMENT}}return Object.defineProperty(e.prototype,"params",{get:function(){return this.m_params},set:function(e){this.m_params=i({},this.m_params,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tracking",{get:function(){return this.m_params.tracking},set:function(e){this.m_params.tracking=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leading",{get:function(){return this.m_params.leading},set:function(e){this.m_params.leading=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLines",{get:function(){return this.m_params.maxLines},set:function(e){this.m_params.maxLines=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this.m_params.lineWidth},set:function(e){this.m_params.lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineRotation",{get:function(){return this.m_params.lineRotation},set:function(e){this.m_params.lineRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrappingMode",{get:function(){return this.m_params.wrappingMode},set:function(e){this.m_params.wrappingMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{get:function(){return this.m_params.verticalAlignment},set:function(e){this.m_params.verticalAlignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{get:function(){return this.m_params.horizontalAlignment},set:function(e){this.m_params.horizontalAlignment=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){return void 0===t&&(t={}),new e(i({},this.m_params,t))},e}();t.TextLayoutStyle=f},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(37)),i(r(8)),i(r(25)),i(r(45)),i(r(110)),i(r(52)),i(r(119)),i(r(54)),i(r(55)),i(r(18)),i(r(20)),i(r(13)),i(r(62)),i(r(63)),i(r(64)),i(r(65)),i(r(69)),i(r(21)),i(r(66)),i(r(142)),i(r(68)),i(r(71)),i(r(143)),i(r(144)),i(r(73)),i(r(14)),i(r(70)),i(r(61)),i(r(35)),i(r(72)),i(r(33)),i(r(148))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){this.m_map=new Map}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance},enumerable:!0,configurable:!0}),e.prototype.getColor=function(e){var t=this.m_map.get(e);return void 0!==t?t:(t=new i.Color(e),this.m_map.set(e,t),t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_map.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_map.clear()},e.m_instance=new e,e}();t.ColorCache=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=Math.PI/180,o=function(){function e(e,t){this.southWest=e,this.northEast=t}return e.fromCoordinates=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"minAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"south",{get:function(){return this.southWest.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"north",{get:function(){return this.northEast.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"west",{get:function(){return this.southWest.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"east",{get:function(){return this.northEast.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){var e,t=.5*(this.south+this.north),r=this.west,n=this.east,o=this.minAltitude,a=this.altitudeSpan;if(void 0!==o&&void 0!==a&&(e=o+.5*a),r<n)return new i.GeoCoordinates(t,.5*(r+n),e);var s=.5*(360+n+r);return s>360&&(s-=360),new i.GeoCoordinates(t,s,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInRadians",{get:function(){return this.latitudeSpan*n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInRadians",{get:function(){return this.longitudeSpan*n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpan",{get:function(){return this.north-this.south},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altitudeSpan",{get:function(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpan",{get:function(){var e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInDegrees",{get:function(){return this.latitudeSpan},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInDegrees",{get:function(){return this.longitudeSpan},enumerable:!0,configurable:!0}),e.prototype.contains=function(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);var t=this.minAltitude===this.maxAltitude,r=this.minAltitude===e.altitude,i=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!r:!i)&&this.containsHelper(e)},e.prototype.clone=function(){return new e(this.southWest,this.northEast)},e.prototype.containsHelper=function(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;var t=this.west,r=this.east;return r>t?e.longitude>=t&&e.longitude<r:e.longitude>r||e.longitude<=t},e}();t.GeoBox=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Math.PI/180,n=180/Math.PI;!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function r(e,r){var i=(e=t(e))-(r=t(r));return i>180?i-360:i<=-180?i+360:i}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.degToRad=function(e){return e*i},e.radToDeg=function(e){return e*n},e.clamp=function(e,t,r){return e<t?t:e>r?r:e},e.normalizeAngleDeg=t,e.angleDistanceDeg=r,e.interpolateAnglesDeg=function(e,t,i){return(e+r(t,e)*i)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(120)),i(r(30)),i(r(6)),i(r(58)),i(r(123)),i(r(126)),i(r(59)),i(r(31)),i(r(12))},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){var r,n;try{for(var o=i(e.whiteSpaceRanges),a=o.next();!a.done;a=o.next()){var s=a.value;if(t>=s[0]&&t<=s[1])return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){var r,n;try{for(var o=i(e.newLineRanges),a=o.next();!a.done;a=o.next()){var s=a.value;if(t>=s[0]&&t<=s[1])return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){var r,n;try{for(var o=i(e.nonPrintableRanges),a=o.next();!a.done;a=o.next()){var s=a.value;if(t>=s[0]&&t<=s[1])return!1}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(r,n){var o,a,s,l;try{for(var u=i(e.weakBidirectionalRanges),c=u.next();!c.done;c=u.next()){var d=c.value;if(r>=d[0]&&r<=d[1])return t.Weak}}catch(e){o={error:e}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}try{for(var h=i(e.neutralBidirectionalRanges),f=h.next();!f.done;f=h.next()){var p=f.value;if(r>=p[0]&&r<=p[1])return t.Neutral}}catch(e){s={error:e}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}return void 0!==e.rtlBlocks.find(function(e){return e===n})?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find(function(e){return e===t})}}(t.UnicodeUtils||(t.UnicodeUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(11),n=r(8);t.DEFAULT_TEXT_STYLE_CACHE_ID="Default",t.computeStyleCacheId=function(e,t,r){return e+"_"+t._renderOrderAuto+"_"+r};var o=function(){function e(){this.m_map=new Map,this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new i.TextRenderStyle({fontSize:{unit:i.FontUnit.Pixel,size:32,backgroundSize:8},color:n.ColorCache.instance.getColor("#6d7477"),backgroundColor:n.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}))}return Object.defineProperty(e.prototype,"size",{get:function(){return this.m_map.size},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return this.m_map.get(e)},e.prototype.set=function(e,t){this.m_map.set(e,t)},e.prototype.clear=function(){this.m_map.clear(),this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new i.TextRenderStyle({fontSize:{unit:i.FontUnit.Pixel,size:32,backgroundSize:8},color:n.ColorCache.instance.getColor("#6d7477"),backgroundColor:n.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}))},e}();t.TextRenderStyleCache=o;var a=function(){function e(){this.m_map=new Map,this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new i.TextLayoutStyle({verticalAlignment:i.VerticalAlignment.Center,horizontalAlignment:i.HorizontalAlignment.Center}))}return Object.defineProperty(e.prototype,"size",{get:function(){return this.m_map.size},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return this.m_map.get(e)},e.prototype.set=function(e,t){this.m_map.set(e,t)},e.prototype.clear=function(){this.m_map.clear(),this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new i.TextLayoutStyle({verticalAlignment:i.VerticalAlignment.Center,horizontalAlignment:i.HorizontalAlignment.Center}))},e}();t.TextLayoutStyleCache=a},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(15),a=r(0);!function(e){var t=new a.Plane(new a.Vector3(0,0,1)),r=new a.Vector3(0,0,0),s=new a.Matrix4,l=new a.Matrix4,u=new a.Raycaster,c=new a.Quaternion,d=new a.Quaternion,h=new a.Vector3(0,0,1),f=new a.Vector3(1,0,0);function p(e,i,n){var o=new a.Vector3(i,n,.5),c=e.worldCenter;r.copy(e.camera.position),s.extractRotation(e.camera.matrixWorld),l.multiplyMatrices(s,l.getInverse(e.camera.projectionMatrix));var d=o.applyMatrix4(l);u.set(r,d.normalize());var h=new a.Vector3,f=u.ray.intersectPlane(t,h);return f?(f.setX(f.x+c.x),f.setY(f.y+c.y),f):null}function m(e,t){var r=Math.pow(2,t);return o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/r/(2*Math.tan(.5*n.MathUtils.degToRad(e.camera.fov))*e.zoomLevelBias)}function v(e,t,r){var i=e.worldCenter;i.setX(i.x+t),i.setY(i.y+r),e.update()}function y(e){return e.substring(0,2)}e.zoomOnTargetPosition=function(e,t,r,i){var n=p(e,t,r);e.camera.position.setZ(m(e,i)),e.camera.matrixWorldNeedsUpdate=!0;var o=p(e,t,r);if(n&&o){var a=n.sub(o);v(e,a.x,a.y)}},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,r,i,n){var o=m(n,t),s=a.Math.degToRad(i),l=o*Math.tan(s),u=a.Math.degToRad(r),c=n.projection.projectPoint(e),d={x:c.x+Math.sin(u)*l,y:c.y-Math.cos(u)*l,z:0};return n.projection.unprojectPoint(d)},e.rayCastWorldCoordinates=p,e.calculateDistanceToGroundFromZoomLevel=m,e.pan=v,e.setRotation=function(e,t,r){c.setFromAxisAngle(h,n.MathUtils.degToRad(t)),d.setFromAxisAngle(f,n.MathUtils.degToRad(r)),c.multiply(d),e.camera.quaternion.copy(c),e.camera.matrixWorldNeedsUpdate=!0},e.extractYawPitchRoll=function(e){var t=e.y*e.y,r=2*(e.w*e.x+e.y*e.z),i=1-2*(e.x*e.x+t),n=Math.atan2(r,i),o=2*(e.w*e.y-e.z*e.x);o=(o=o>1?1:o)<-1?-1:o;var a=Math.asin(o),s=2*(e.w*e.z+e.x*e.y),l=1-2*(t+e.z*e.z);return{yaw:Math.atan2(s,l),pitch:n,roll:a}},e.rayCastGeoCoordinates=function(e,t,r){var i=p(e,t,r);return i?e.projection.unprojectPoint(i):null},e.calculateZoomLevelFromHeight=function(e,t){var r=e*t.zoomLevelBias*2*Math.tan(n.MathUtils.degToRad(t.camera.fov/2)),i=o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/2,a=r/2,s=Math.log2(i/a);return n.MathUtils.clamp(s,t.minZoomLevel,t.maxZoomLevel)},e.calculateDepthFromClipDistance=function(e,t){var r=t,i=r.far-r.near,n=e*r.far;return(1-r.near/n)*(r.far/i)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.calculateFocalLengthByVerticalFov=function(e,t){return t/2/Math.tan(e/2)},e.calculateFovByFocalLength=function(e,t){return n.MathUtils.radToDeg(2*Math.atan(t/2/e))},e.estimateObjectSize=function(e){if("function"==typeof e)return 0;for(var t=new Map,r=[e],i=0;r.length>0;){var n=r.pop();if(Array.isArray(n)&&n.length>0&&"object"!=typeof n[0])"boolean"==typeof n[0]?i+=4*n.length:"string"==typeof n[0]?n.forEach(function(e){void 0!==e.length&&(i+=2*e.length)}):"number"==typeof n[0]&&(i+=8*n.length);else if("boolean"==typeof n)i+=4;else if("string"==typeof n)i+=2*n.length;else if("number"==typeof n)i+=8;else if(null!=n&&void 0!==n.byteLength)i+=n.byteLength;else if("object"==typeof n&&null!==n&&!1===t.has(n)){t.set(n,"");var o=n;for(var a in o)void 0!==o[a]&&"function"!=typeof o[a]&&r.push(o[a])}}return i},e.getBrowserLanguages=function(){var e,t;if(void 0!==navigator.languages&&navigator.languages.length>0){var r=[];try{for(var n=i(navigator.languages),o=n.next();!o.done;o=n.next()){var a=o.value;r.push(y(a))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r}if(void 0!==navigator.language)return[y(navigator.language)]}}(t.MapViewUtils||(t.MapViewUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,e}();t.EarthConstants=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,9007199254740992,0x8000000000000],n=function(){function e(e,t,r){this.row=e,this.column=t,this.level=r}return e.fromRowColumnLevel=function(t,r,i){return new e(t,r,i)},e.fromQuadKey=function(t){for(var r=t.length,i=0,n=0,o=0;o<t.length;++o){var a=1<<o,s=parseInt(t.charAt(r-o-1),10);1&s&&(n|=a),2&s&&(i|=a)}return e.fromRowColumnLevel(i,n,r)},e.fromMortonCode=function(t){for(var r=0,i=0,n=0,o=t;o>1;){var a=1<<r;1&o&&(n|=a),2&o&&(i|=a),r++,o=(o-(3&o))/4}var s=e.fromRowColumnLevel(i,n,r);return s.m_mortonCode=t,s},e.fromHereTile=function(t){var r=e.fromMortonCode(parseInt(t,10));return r.m_hereTile=t,r},e.columnsAtLevel=function(e){return Math.pow(2,e)},e.rowsAtLevel=function(e){return Math.pow(2,e)},e.atCoords=function(t,r,i,n,o){return e.fromRowColumnLevel(Math.floor(i/(o/e.rowsAtLevel(t))),Math.floor(r/(n/e.columnsAtLevel(t))),t)},e.parentMortonCode=function(e){return Math.floor(e/4)},e.prototype.parent=function(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return e.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)},e.prototype.changedLevelBy=function(t){var r=Math.max(0,this.level+t),i=this.row,n=this.column;return t>=0?(i<<=t,n<<=t):(i>>>=-t,n>>>=-t),e.fromRowColumnLevel(i,n,r)},e.prototype.changedLevelTo=function(e){return this.changedLevelBy(e-this.level)},e.prototype.mortonCode=function(){if(void 0===this.m_mortonCode){for(var e=this.column,t=this.row,r=i[this.level<<1],n=0;n<this.level;++n)1&e&&(r+=i[2*n]),1&t&&(r+=i[2*n+1]),e>>>=1,t>>>=1;this.m_mortonCode=r}return this.m_mortonCode},e.prototype.toHereTile=function(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile},e.prototype.toQuadKey=function(){for(var e="",t=this.level;t>0;--t){var r=1<<t-1,i=0!=(this.column&r),n=0!=(this.row&r);e+=i&&n?"3":n?"2":i?"1":"0"}return e},e.prototype.equals=function(e){return this.row===e.row&&this.column===e.column&&this.level===e.level},e.prototype.addedSubKey=function(t){var r=e.fromQuadKey(0===t.length?"-":t),i=this.changedLevelBy(r.level);return e.fromRowColumnLevel(i.row+r.row,i.column+r.column,i.level)},e.prototype.addedSubHereTile=function(t){var r=e.fromHereTile(t),i=this.changedLevelBy(r.level);return e.fromRowColumnLevel(i.row+r.row,i.column+r.column,i.level)},e.prototype.getSubHereTile=function(e){var t=1<<2*e;return(this.mortonCode()&t-1|t).toString()},e.prototype.rowCount=function(){return e.rowsAtLevel(this.level)},e.prototype.columnCount=function(){return e.columnsAtLevel(this.level)},e}();t.TileKey=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(40),n=r(43),o=r(44),a=function(){function e(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new i.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}return e.prototype.getSubTileKeys=function(e){return this.tileTreeTraverse.subTiles(e)},e.prototype.getTileKey=function(e,t){return n.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)},e.prototype.getTileKeys=function(e,t){return n.TileKeyUtils.geoRectangleToTileKeys(this,e,t)},e.prototype.getGeoBox=function(e){return this.boundingBoxGenerator.getGeoBox(e)},e.prototype.getWorldBox=function(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)},e}();t.TilingScheme=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(11),o=r(1),a=r(0);!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(i=t.FadingState||(t.FadingState={})),function(e){e[e.Requested=0]="Requested",e[e.Loaded=1]="Loaded",e[e.Initialized=2]="Initialized"}(t.LoadingState||(t.LoadingState={})),t.DEFAULT_FADE_TIME=800;var s=function(){function e(e,r,n,o,a,s){void 0===e&&(e=i.Undefined),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===a&&(a=Number.MIN_SAFE_INTEGER),void 0===s&&(s=t.DEFAULT_FADE_TIME),this.state=e,this.value=r,this.startTime=n,this.opacity=o,this.lastFrameNumber=a,this.fadingTime=s}return e.prototype.reset=function(){this.state=i.Undefined,this.value=0,this.startTime=0,this.opacity=1,this.lastFrameNumber=Number.MIN_SAFE_INTEGER},e.prototype.isFading=function(){return this.state===i.FadingIn||this.state===i.FadingOut},e.prototype.isFadingIn=function(){return this.state===i.FadingIn},e.prototype.isFadingOut=function(){return this.state===i.FadingOut},e.prototype.isFadedIn=function(){return this.state===i.FadedIn},e.prototype.isFadedOut=function(){return this.state===i.FadedOut},e.prototype.isVisible=function(){return this.state===i.FadingIn||this.state===i.FadedIn||this.state===i.FadingOut},e}();t.RenderState=s;var l=function(){function e(e,t,r,i,o,a,s,l,u,c,d){void 0===o&&(o=0),this.text=e,this.points=t,this.renderParams=r,this.layoutParams=i,this.priority=o,this.xOffset=a,this.yOffset=s,this.featureId=l,this.style=u,this.fadeNear=c,this.fadeFar=d,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.sortPriority=0,r instanceof n.TextRenderStyle&&(this.renderStyle=r),i instanceof n.TextLayoutStyle&&(this.layoutStyle=i)}return Object.defineProperty(e.prototype,"position",{get:function(){return this.points instanceof Array?this.points[0]:this.points instanceof a.Vector3?new a.Vector2(this.points.x,this.points.y):this.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position3",{get:function(){return this.points instanceof a.Vector3?this.points:this.points instanceof Array?new a.Vector3(this.points[0].x,this.points[0].y,0):new a.Vector3(this.points.x,this.points.y,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){if(this.points instanceof Array)return this.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textMayOverlap",{get:function(){return!0===this.mayOverlap},set:function(e){this.mayOverlap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textReservesSpace",{get:function(){return!1!==this.reserveSpace},set:function(e){this.reserveSpace=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLineMarker",{get:function(){return void 0!==this.points&&void 0!==this.m_poiInfo&&"line-marker"===this.m_poiInfo.technique.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderDistance",{get:function(){return!0===this.alwaysOnTop?0:void 0!==this.currentViewDistance?-this.currentViewDistance:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poiInfo",{get:function(){return this.m_poiInfo},set:function(e){if(this.m_poiInfo=e,void 0!==e){var t=void 0!==this.renderOrder?this.renderOrder:0;e.renderOrder=t}},enumerable:!0,configurable:!0}),e.prototype.updateMinMaxZoomLevelsFromPoiInfo=function(){void 0!==this.poiInfo&&(void 0===this.minZoomLevel&&(this.minZoomLevel=o.MathUtils.min2(this.poiInfo.iconMinZoomLevel,this.poiInfo.textMinZoomLevel)),void 0===this.maxZoomLevel&&(this.maxZoomLevel=o.MathUtils.max2(this.poiInfo.iconMaxZoomLevel,this.poiInfo.textMaxZoomLevel)))},e}();t.TextElement=l},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE;var o=function(){function e(e,r,i){this.capacity=Math.min(i,t.MAX_CAPACITY),this.m_drawCount=0,this.m_updateOffset=0,this.m_vertexBuffer=new n.InterleavedBuffer(new Float32Array(this.capacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setDynamic(!0),this.m_positionAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new n.BufferAttribute(new Uint32Array(this.capacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setDynamic(!0),this.m_geometry=new n.BufferGeometry,this.m_geometry.addAttribute("position",this.m_positionAttribute),this.m_geometry.addAttribute("uv",this.m_uvAttribute),this.m_geometry.addAttribute("color",this.m_colorAttribute),this.m_geometry.addAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_mesh=new n.Mesh(this.m_geometry,e),this.m_mesh.renderOrder=1/0,this.m_bgMesh=new n.Mesh(this.m_geometry,r),this.m_pickingCount=0,this.m_pickingDataArray=new Array(i)}return e.prototype.dispose=function(){this.m_geometry.dispose()},Object.defineProperty(e.prototype,"drawCount",{get:function(){return this.m_drawCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this.m_mesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundMesh",{get:function(){return this.m_bgMesh},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0},e.prototype.update=function(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)},e.prototype.add=function(e,r,i,n,o,a,s){if(this.m_drawCount>=this.capacity)return!1;for(var l=this.m_drawCount*t.VERTICES_PER_QUAD,u=this.m_drawCount*t.INDICES_PER_QUAD,c=0;c<t.VERTICES_PER_QUAD;++c){this.m_positionAttribute.setXYZW(l+c,r[c].x,r[c].y,r[c].z,!0===s?e.copyIndex:(o?-1:1)*a.rotation);var d=o?(c+1)%2+2*Math.floor(c/2):c;this.m_uvAttribute.setXYZW(l+c,(!0===s?e.sourceTextureCoordinates:e.dynamicTextureCoordinates)[d].x,(!0===s?e.sourceTextureCoordinates:e.dynamicTextureCoordinates)[d].y,i,n),this.m_colorAttribute.setXYZW(l+c,a.color.r,a.color.g,a.color.b,a.opacity),this.m_bgColorAttribute.setXYZW(l+c,a.backgroundColor.r,a.backgroundColor.g,a.backgroundColor.b,a.backgroundOpacity)}return this.m_indexBuffer.setX(u,l),this.m_indexBuffer.setX(u+1,l+1),this.m_indexBuffer.setX(u+2,l+2),this.m_indexBuffer.setX(u+3,l+2),this.m_indexBuffer.setX(u+4,l+1),this.m_indexBuffer.setX(u+5,l+3),++this.m_drawCount,!0},e.prototype.addToBuffer=function(e,r,i,n,o,a,s,l){for(var u=0;u<t.VERTICES_PER_QUAD;++u){var c=r+t.VERTEX_BUFFER_STRIDE*u;e[c]=n[u].x,e[c+1]=n[u].y,e[c+2]=n[u].z,e[c+3]=(s?-1:1)*l.rotation;var d=s?(u+1)%2+2*Math.floor(u/2):u;e[c+4]=i.dynamicTextureCoordinates[d].x,e[c+5]=i.dynamicTextureCoordinates[d].y,e[c+6]=o,e[c+7]=a,e[c+8]=l.color.r,e[c+9]=l.color.g,e[c+10]=l.color.b,e[c+11]=l.opacity,e[c+12]=l.backgroundColor.r,e[c+13]=l.backgroundColor.g,e[c+14]=l.backgroundColor.b,e[c+15]=l.backgroundOpacity}},e.prototype.addTextBufferObject=function(e,r,i,n,o,a,s,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;for(var u=i||1,c=n||0,d=Math.cos(c),h=Math.sin(c),f=void 0!==r?r.x:0,p=void 0!==r?r.y:0,m=void 0!==r?r.z:0,v=e.buffer,y=v[3]<0?-1:1,g=void 0!==o?o.r:v[8],_=void 0!==o?o.g:v[9],b=void 0!==o?o.b:v[10],x=void 0!==a?a:v[11],w=void 0!==s?s.r:v[12],S=void 0!==s?s.g:v[13],T=void 0!==s?s.b:v[14],C=void 0!==l?l:v[15],P=this.m_drawCount*t.VERTICES_PER_QUAD,E=0;E<e.glyphs.length;++E){var M=E*t.QUAD_VERTEX_MEMORY_FOOTPRINT,O=e.glyphs[E];if(!O.isInCache)return!1;for(var A=v[M+4]>v[M+t.VERTEX_BUFFER_STRIDE+4],L=v[M+6],R=v[M+7],I=0;I<t.VERTICES_PER_QUAD;++I){var F=v[M+I*t.VERTEX_BUFFER_STRIDE],D=v[M+I*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(P+E*t.VERTICES_PER_QUAD+I,F*u*d+D*u*-h+f,F*u*h+D*u*d+p,v[M+I*t.VERTEX_BUFFER_STRIDE+2]+m,v[M+I*t.VERTEX_BUFFER_STRIDE+3]+y*c);var k=A?(I+1)%2+2*Math.floor(I/2):I;this.m_uvAttribute.setXYZW(P+E*t.VERTICES_PER_QUAD+I,O.dynamicTextureCoordinates[k].x,O.dynamicTextureCoordinates[k].y,L,(R-L)/u+L),this.m_colorAttribute.setXYZW(P+E*t.VERTICES_PER_QUAD+I,g,_,b,x),this.m_bgColorAttribute.setXYZW(P+E*t.VERTICES_PER_QUAD+I,w,S,T,C)}this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD,(this.m_drawCount+E)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD+1,(this.m_drawCount+E)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD+2,(this.m_drawCount+E)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD+3,(this.m_drawCount+E)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD+4,(this.m_drawCount+E)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+E)*t.INDICES_PER_QUAD+5,(this.m_drawCount+E)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0},e.prototype.addPickingData=function(e,t,r){return!(this.m_pickingCount>=this.capacity)&&(this.m_pickingDataArray[this.m_pickingCount]={start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:r},++this.m_pickingCount,!0)},e.prototype.pick=function(e,r){var n,o;try{for(var a=i(this.m_pickingDataArray),s=a.next();!s.done;s=a.next()){var l=s.value;if(void 0===l)return;for(var u=l.start;u<l.end;++u){var c=u*t.VERTICES_PER_QUAD,d=Math.min(this.m_positionAttribute.getX(c+2),this.m_positionAttribute.getX(c+1));if(!(e.x<d)){var h=Math.max(this.m_positionAttribute.getX(c+2),this.m_positionAttribute.getX(c+1));if(!(e.x>h)){var f=Math.min(this.m_positionAttribute.getY(c+2),this.m_positionAttribute.getY(c+1));if(!(e.y<f)){var p=Math.max(this.m_positionAttribute.getY(c+2),this.m_positionAttribute.getY(c+1));if(!(e.y>p)){r(l.data);break}}}}}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}},e}();t.TextGeometry=o},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),l=r(8),u=r(60),c=r(21),d=r(128),h=r(131),f=r(18),p=r(13),m=r(11),v="default",y="default",g=32768,_=500;t.DEFAULT_TEXT_DISTANCE_SCALE=.5;var b=300,x=.99,w=.4,S=a.LoggerManager.instance.create("TextElementsRenderer"),T=new s.Box2,C=[],P=new a.Math2D.Box,E=new s.Vector3,M=new s.Vector3(0,0,0),O=new s.Vector2,A=new s.Vector2,L=function(){return function(e,t){this.tile=e,this.textElements=t}}(),R=function(){return function(e,t){this.priority=e,this.textElementLists=t}}(),I=function(){function e(e,t,r,i,n,o,a,s,l){this.m_mapView=e,this.m_screenCollisions=t,this.m_screenProjector=r,this.m_maxNumGlyphs=i,this.m_theme=n,this.m_maxNumVisibleLabels=o,this.m_numSecondChanceLabels=a,this.m_maxDistanceRatioForLabels=s,this.m_labelStartScaleDistance=l,this.m_initializedTextElementCount=0,this.m_textRenderers=[],this.m_textStyles=new Map,this.m_defaultStyle={name:v,fontCatalog:y,renderParams:this.m_mapView.textRenderStyleCache.get(p.DEFAULT_TEXT_STYLE_CACHE_ID).params,layoutParams:this.m_mapView.textLayoutStyleCache.get(p.DEFAULT_TEXT_STYLE_CACHE_ID).params},this.m_lastRenderedTextElements=[],this.m_secondChanceTextElements=[],void 0===this.m_maxNumGlyphs&&(this.m_maxNumGlyphs=g),void 0===this.m_maxNumVisibleLabels&&(this.m_maxNumVisibleLabels=_),void 0===this.m_numSecondChanceLabels&&(this.m_numSecondChanceLabels=b),void 0===this.m_maxDistanceRatioForLabels&&(this.m_maxDistanceRatioForLabels=x),void 0===this.m_labelStartScaleDistance&&(this.m_labelStartScaleDistance=w),this.initializeDefaultAssets(),this.initializeTextCanvases()}return e.prototype.renderText=function(e){var t,r,i=u.debugContext.getValue("DEBUG_GLYPHS");void 0!==i&&void 0!==this.m_debugGlyphTextureCacheMesh&&void 0!==this.m_debugGlyphTextureCacheWireMesh&&(this.m_debugGlyphTextureCacheMesh.visible=i,this.m_debugGlyphTextureCacheWireMesh.visible=i);try{for(var o=n(this.m_textRenderers),a=o.next();!a.done;a=o.next()){a.value.textCanvas.render(e)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.reset=function(){var e,t;this.m_screenCollisions.reset();try{for(var r=n(this.m_textRenderers),i=r.next();!i.done;i=r.next()){var o=i.value;o.textCanvas.clear(),o.poiRenderer.reset()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.m_initializedTextElementCount=0},e.prototype.update=function(){var e,t;try{for(var r=n(this.m_textRenderers),i=r.next();!i.done;i=r.next()){i.value.poiRenderer.update()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.placeAllTileLabels=function(){this.placeAllLabels()},e.prototype.movementStarted=function(){},e.prototype.movementFinished=function(){this.placeAllLabels()},Object.defineProperty(e.prototype,"maxNumGlyphs",{get:function(){return this.m_maxNumGlyphs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultStyle",{get:function(){return this.m_defaultStyle},enumerable:!0,configurable:!0}),e.prototype.renderUserTextElements=function(e,t){var r=this,i=this.m_mapView.visibleTileSet.dataSourceTileList,o=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),a=this.m_mapView.zoomLevel;i.forEach(function(i){var s,l,u,c;try{for(var d=n(i.visibleTiles),h=d.next();!h.done;h=d.next()){var f=h.value;try{for(var p=n(f.userTextElements),m=p.next();!m.done;m=p.next()){var v=m.value;v.tileCenterX=f.center.x,v.tileCenterY=f.center.y,r.updateViewDistance(o,v)}}catch(e){u={error:e}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}r.renderTextElements(f.userTextElements,e,t,a)}}catch(e){s={error:e}}finally{try{h&&!h.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}})},e.prototype.renderAllTileText=function(e,t){var r=this,i=this.m_mapView.visibleTileSet.dataSourceTileList,n=this.m_mapView.zoomLevel;if(0===this.m_lastRenderedTextElements.length)i.forEach(function(i){r.renderTileList(i.renderedTiles,e,t,n,r.m_lastRenderedTextElements,r.m_secondChanceTextElements)});else{var o=this.m_lastRenderedTextElements.concat(this.m_secondChanceTextElements);this.renderTextElements(o,e,t,n)}},e.prototype.renderOverlay=function(e){void 0!==e&&0!==e.length&&this.renderOverlayTextElements(e)},e.prototype.pickTextElements=function(e,t){var r,i,o=function(r,i){var n=r;if(void 0!==n){if(void 0!==n.featureId&&!t.some(function(e){return void 0!==e&&i===e.type&&(void 0!==e.featureId&&e.featureId===n.featureId||void 0!==e.userData&&e.userData===n.userData)})){var o={type:i,point:e,distance:0,featureId:n.featureId,userData:n.userData,text:n.text};t.push(o)}}};try{for(var a=n(this.m_textRenderers),s=a.next();!s.done;s=a.next()){var l=s.value;l.textCanvas.pickText(e,function(e){o(e,c.PickObjectType.Text)}),l.poiRenderer.pickTextElements(e,function(e){o(e,c.PickObjectType.Icon)})}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},e.prototype.getTextElementStyle=function(e){var t;return void 0===e?t=this.m_defaultStyle:void 0===(t=this.m_textStyles.get(e))&&(t=this.m_defaultStyle),t},Object.defineProperty(e.prototype,"loading",{get:function(){var e,t,r=!1;try{for(var i=n(this.m_textRenderers),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.textCanvas.fontCatalog.isLoading}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},enumerable:!0,configurable:!0}),e.prototype.clearRenderStates=function(){this.m_mapView.visibleTileSet.dataSourceTileList.forEach(function(e){var t,r;try{for(var i=n(e.visibleTiles),o=i.next();!o.done;o=i.next()){var a=o.value;a.userTextElements.forEach(function(e){e.iconRenderState=void 0,e.textRenderState=void 0}),a.textElementGroups.forEach(function(e){e.iconRenderState=void 0,e.textRenderState=void 0})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}})},e.prototype.initializeDefaultAssets=function(){var e,t;(void 0===this.m_theme.fontCatalogs||Array.isArray(this.m_theme.fontCatalogs)&&0===this.m_theme.fontCatalogs.length)&&(this.m_theme.fontCatalogs=[{name:y,url:this.m_mapView.defaultFontCatalog}]);var r,i=this.m_theme.fontCatalogs;if(i.length>0){try{for(var o=n(i),a=o.next();!a.done;a=o.next()){var s=a.value;if(void 0!==s.name){r=s.name;break}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}void 0===r&&(r=y,i[0].name=r)}void 0===this.m_theme.textStyles&&(this.m_theme.textStyles=[]);var l=this.m_theme.textStyles,u=l.find(function(e){return e.name===v});void 0!==u?this.m_defaultStyle=this.createTextElementStyle(u,v):void 0!==this.m_theme.defaultTextStyle?this.m_defaultStyle=this.createTextElementStyle(this.m_theme.defaultTextStyle,v):l.length>0&&(this.m_defaultStyle=this.createTextElementStyle(l[0],v)),this.m_defaultStyle.fontCatalog=r},e.prototype.createTextElementStyle=function(e,t){return{name:t,fontCatalog:a.getOptionValue(e.fontCatalogName,y),renderParams:{fontSize:{unit:m.FontUnit.Pixel,size:32,backgroundSize:e.backgroundSize||8},fontVariant:!0===e.smallCaps?m.FontVariant.SmallCaps:!0===e.allCaps?m.FontVariant.AllCaps:void 0,fontStyle:!0===e.bold?!0===e.oblique?m.FontStyle.BoldItalic:m.FontStyle.Bold:!0===e.oblique?m.FontStyle.Italic:void 0,color:void 0!==e.color?l.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?l.ColorCache.instance.getColor(e.backgroundColor):void 0,backgroundOpacity:e.backgroundAlpha},layoutParams:{tracking:e.tracking,verticalAlignment:m.VerticalAlignment.Center,horizontalAlignment:m.HorizontalAlignment.Center}}},e.prototype.initializeTextCanvases=function(){var e=this,t=[];this.m_theme.fontCatalogs.forEach(function(r){var i=m.FontCatalog.load(r.url,1024).then(function(t){var i=new m.TextCanvas({renderer:e.m_mapView.renderer,fontCatalog:t,maxGlyphCount:e.maxNumGlyphs});e.m_textRenderers.push({fontCatalog:r.name,textCanvas:i,poiRenderer:new d.PoiRenderer(e.m_mapView,i)})}).catch(function(e){S.error("Failed to load FontCatalog: ",e)});t.push(i)}),Promise.all(t).then(function(){e.initializeTextElementStyles();var t=e.m_textRenderers[0].textCanvas.fontCatalog,r=new s.PlaneGeometry(t.textureSize.width/2.5,t.textureSize.height/2.5,t.textureSize.width/t.maxWidth,t.textureSize.height/t.maxHeight),i=new s.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:t.texture});e.m_debugGlyphTextureCacheMesh=new s.Mesh(r,i),e.m_debugGlyphTextureCacheMesh.renderOrder=1e4,e.m_debugGlyphTextureCacheMesh.visible=!1,e.m_debugGlyphTextureCacheMesh.name="glyphDebug";var n=new s.WireframeGeometry(r),o=new s.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});e.m_debugGlyphTextureCacheWireMesh=new s.LineSegments(n,o),e.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,e.m_debugGlyphTextureCacheWireMesh.visible=!1,e.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",e.m_textRenderers[0].textCanvas.getLayer(m.DEFAULT_TEXT_CANVAS_LAYER).scene.add(e.m_debugGlyphTextureCacheMesh,e.m_debugGlyphTextureCacheWireMesh),e.m_mapView.update()})},e.prototype.initializeTextElementStyles=function(){var e,t,r,i=this;this.m_textRenderers.forEach(function(e){void 0===r&&(r=e.textCanvas)});var a=new d.PoiRenderer(this.m_mapView,r);if(void 0!==this.m_defaultStyle.fontCatalog){var s=this.m_textRenderers.find(function(e){return e.fontCatalog===i.m_defaultStyle.fontCatalog});this.m_defaultStyle.textCanvas=void 0!==s?s.textCanvas:void 0,this.m_defaultStyle.poiRenderer=void 0!==s?s.poiRenderer:void 0}void 0===this.m_defaultStyle.textCanvas&&(void 0!==this.m_defaultStyle.fontCatalog&&S.warn("FontCatalog '"+this.m_defaultStyle.fontCatalog+"' set in TextStyle '"+this.m_defaultStyle.name+"' not found, using default fontCatalog("+r.fontCatalog.name+")."),this.m_defaultStyle.textCanvas=r,this.m_defaultStyle.poiRenderer=a),this.m_theme.textStyles.forEach(function(e){i.m_textStyles.set(e.name,i.createTextElementStyle(e,e.name))});var l=function(e,t){if(void 0===t.textCanvas){if(void 0!==t.fontCatalog){var i=u.m_textRenderers.find(function(e){return e.fontCatalog===t.fontCatalog});t.textCanvas=void 0!==i?i.textCanvas:void 0,t.poiRenderer=void 0!==i?i.poiRenderer:void 0}void 0===t.textCanvas&&(void 0!==t.fontCatalog&&S.warn("FontCatalog '"+t.fontCatalog+"' set in TextStyle '"+t.name+"' not found, using default fontCatalog("+r.fontCatalog.name+")."),t.textCanvas=r,t.poiRenderer=a)}},u=this;try{for(var c=n(this.m_textStyles),h=c.next();!h.done;h=c.next()){var f=o(h.value,2);f[0];l(0,f[1])}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}},e.prototype.updateViewDistance=function(e,t){var r;if(t.points instanceof s.Vector2||t.points instanceof s.Vector3){var i=t.position3;M.x=i.x+t.tileCenterX,M.y=i.y+t.tileCenterY,r=e.distanceTo(M)}else if(Array.isArray(t.points))if(1===t.points.length){var n=t.points[0];M.x=n.x+t.tileCenterX,M.y=n.y+t.tileCenterY,r=e.distanceTo(M)}else if(t.points.length>1){var o=t.points;n=o[0];M.x=n.x+t.tileCenterX,M.y=n.y+t.tileCenterY;var a=e.distanceTo(M);n=o[o.length-1],M.x=n.x+t.tileCenterX,M.y=n.y+t.tileCenterY;var l=e.distanceTo(M);r=Math.min(a,l)}return t.currentViewDistance=r,r},e.prototype.sortTextElements=function(e,t){for(var r=1/e.length*.01,i=0;i<e.length;i++){var n=e[i];n.sortPriority=n.priority+i*r+.1-n.currentViewDistance/t*.1}e.sort(function(e,t){return t.sortPriority-e.sortPriority})},e.prototype.placeAllLabels=function(){var e=this,t=this.m_mapView.visibleTileSet.dataSourceTileList,r=this.m_mapView.zoomLevel;t.forEach(function(t){e.placeTextElements(t.dataSource,t.storageLevel,r,t.visibleTiles)}),this.m_lastRenderedTextElements.length=0,this.m_secondChanceTextElements.length=0},e.prototype.placeTextElements=function(e,t,r,i){var o,a,s=i;s.sort(function(e,t){return e.tileKey.mortonCode()-t.tileKey.mortonCode()});try{for(var l=n(s),u=l.next();!u.done;u=l.next()){var c=u.value;this.prepareUserTextElements(c)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}var d=[];this.createSortedGroupsForSorting(e,t,s,d);this.selectTextElementsToPlaceByDistance(r,d,[])},e.prototype.prepareUserTextElements=function(e){var t,r;try{for(var i=n(e.userTextElements),o=i.next();!o.done;o=i.next()){var a=o.value;a.tileCenterX=e.center.x,a.tileCenterY=e.center.y}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.createSortedGroupsForSorting=function(e,t,r,i){var o,a,s,l,u,c,d,h;if(0!==this.m_textRenderers.length&&0!==r.length){var f=[];try{for(var p=n(r),m=p.next();!m.done;m=p.next()){(_=m.value).placedTextElements.clear(),e.shouldRenderText(t,_.tileKey)&&f.push(_)}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}var v=new Map;try{for(var y=n(f),g=y.next();!g.done;g=y.next()){var _=g.value;try{for(var b=n(_.textElementGroups.groups.values()),x=b.next();!x.done;x=b.next()){var w=x.value;if(0!==w.elements.length){var S=v.get(w.priority);void 0===S?v.set(w.priority,new R(w.priority,[new L(_,w.elements)])):S.textElementLists.push(new L(_,w.elements))}}}catch(e){u={error:e}}finally{try{x&&!x.done&&(c=b.return)&&c.call(b)}finally{if(u)throw u.error}}}}catch(e){s={error:e}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}if(0!==v.size){try{for(var T=n(v),C=T.next();!C.done;C=T.next()){var P=C.value[1];i.push(P)}}catch(e){d={error:e}}finally{try{C&&!C.done&&(h=T.return)&&h.call(T)}finally{if(d)throw d.error}}i.sort(function(e,t){return t.priority-e.priority})}}},e.prototype.getMaxDistance=function(e){return this.m_mapView.camera.far*e},e.prototype.selectTextElementsToPlaceByDistance=function(e,t,r){var i,o,s,l,u,c,d=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),h=this.m_maxDistanceRatioForLabels,f=this.getMaxDistance(h);try{for(var p=n(t),m=p.next();!m.done;m=p.next()){var v=m.value;try{for(var y=n(v.textElementLists),g=y.next();!g.done;g=y.next()){var _=g.value,b=_.tile;try{for(var x=n(_.textElements),w=x.next();!w.done;w=x.next()){var S=w.value;if(S.visible){if(void 0!==S.poiInfo&&void 0!==S.poiInfo.poiTableName){if(!this.m_mapView.poiManager.updatePoiFromPoiTable(S))continue;S.poiInfo.poiTableName=void 0}if(S.visible&&a.MathUtils.isClamped(e,S.minZoomLevel,S.maxZoomLevel)){S.tileCenterX=b.center.x,S.tileCenterY=b.center.y;var T=this.updateViewDistance(d,S);void 0!==T&&T>f||b.placedTextElements.add(S)}}}}catch(e){u={error:e}}finally{try{w&&!w.done&&(c=x.return)&&c.call(x)}finally{if(u)throw u.error}}}}catch(e){s={error:e}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}r.push([])}}catch(e){i={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}},e.prototype.renderOverlayTextElements=function(e){var t,r,o=this;if(0!==this.m_textRenderers.length){var a=this.m_mapView.pixelRatio,l=this.m_mapView.renderer.getSize(),u=-l.width*a/2,c=l.height*a/2,d={},p={},v=function(e){var t,r,v=y.getTextElementStyle(e.style),g=v.textCanvas;if(void 0===g)return"continue";var _=g.getLayer(e.renderOrder||m.DEFAULT_TEXT_CANVAS_LAYER),b=void 0!==e.path&&!e.isLineMarker;if(void 0===e.loadingState&&(e.loadingState=f.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new m.TextRenderStyle(i({},v.renderParams,e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new m.TextLayoutStyle(i({},v.layoutParams,e.layoutParams))),""===e.text?e.loadingState=f.LoadingState.Loaded:g.fontCatalog.loadCharset(e.text,e.renderStyle).then(function(){e.loadingState=f.LoadingState.Loaded,o.m_mapView.update()})),e.loadingState===f.LoadingState.Loaded&&y.m_initializedTextElementCount<1/0&&(g.textRenderStyle=e.renderStyle,g.textLayoutStyle=e.layoutStyle,b?(e.glyphCaseArray=[],e.glyphs=g.fontCatalog.getGlyphs(e.text,g.textRenderStyle,e.glyphCaseArray)):e.textBufferObject=g.createTextBufferObject(e.text),e.loadingState=f.LoadingState.Initialized,++y.m_initializedTextElementCount),e.loadingState!==f.LoadingState.Initialized)return"continue";if(void 0!==_)if(b){if(_.geometry.drawCount+e.glyphs.length>y.maxNumGlyphs)return"continue"}else if(_.geometry.drawCount+e.textBufferObject.glyphs.length>y.maxNumGlyphs)return"continue";g.textRenderStyle=e.renderStyle,g.textLayoutStyle=e.layoutStyle;var x=void 0;if(b){O.x=u,O.y=c,void 0!==e.xOffset&&(O.x+=e.xOffset*a),void 0!==e.yOffset&&(O.y-=e.yOffset*a);var w=[];try{for(var S=n(e.path),T=S.next();!T.done;T=S.next()){var C=T.value,P=O.x+C.x*l.width*a,M=O.y-C.y*l.height*a;w.push(new s.Vector2(P,M))}}catch(e){t={error:e}}finally{try{T&&!T.done&&(r=S.return)&&r.call(S)}finally{if(t)throw t.error}}x=new h.SimplePath;for(var A=0;A<w.length-1;++A)x.add(new s.LineCurve(w[A],w[A+1]));d.path=x,d.pathOverflow=!0,d.layer=e.renderOrder,d.letterCaseArray=e.glyphCaseArray,g.addText(e.glyphs,E,d)}else O.x=u+e.position.x*l.width*a,O.y=c-e.position.y*l.height*a,void 0!==e.xOffset&&(O.x+=e.xOffset*a),void 0!==e.yOffset&&(O.y-=e.yOffset*a),E.x=O.x,E.y=O.y,E.z=0,p.position=E,p.layer=e.renderOrder,g.addTextBufferObject(e.textBufferObject,p)},y=this;try{for(var g=n(e),_=g.next();!_.done;_=g.next()){v(_.value)}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}}},e.prototype.getDistanceFadingFactor=function(e,t){var r=1,i=e.currentViewDistance;if(void 0!==i&&void 0!==e.fadeFar&&e.fadeFar>0){var n=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>n&&(r=1-a.MathUtils.clamp((i/t-n)/(o-n),0,1))}return r},e.prototype.renderTextElements=function(e,t,r,o,l,u){var c,d,p=this;if(0===this.m_textRenderers.length)return 0;var v=void 0===l,y=(e.length,this.m_maxNumVisibleLabels),g=this.m_numSecondChanceLabels,_=this.m_labelStartScaleDistance,b=0,x=[],w=this.getMaxDistance(.9),S=this.getMaxDistance(.6),M=this.m_mapView.cameraIsMoving,L=this.m_mapView.camera.far,R=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),I=!1,F={},D={},k={},V=function(e){if(!v&&y>=0&&b>=y)return"break";var c=j.getTextElementStyle(e.style),d=c.textCanvas,V=c.poiRenderer;if(void 0===d||void 0===V)return"continue";var U=d.getLayer(e.renderOrder||m.DEFAULT_TEXT_CANVAS_LAYER),z=void 0!==e.path&&!e.isLineMarker;if(void 0===e.loadingState&&(e.loadingState=f.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new m.TextRenderStyle(i({},c.renderParams,e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new m.TextLayoutStyle(i({},c.layoutParams,e.layoutParams))),""===e.text?e.loadingState=f.LoadingState.Loaded:d.fontCatalog.loadCharset(e.text,e.renderStyle).then(function(){e.loadingState=f.LoadingState.Loaded,p.m_mapView.update()})),e.loadingState===f.LoadingState.Loaded&&j.m_initializedTextElementCount<1/0&&(d.textRenderStyle=e.renderStyle,d.textLayoutStyle=e.layoutStyle,z?(e.glyphCaseArray=[],e.glyphs=d.fontCatalog.getGlyphs(e.text,d.textRenderStyle,e.glyphCaseArray)):e.textBufferObject=d.createTextBufferObject(e.text,{outputBounds:!0}),e.loadingState=f.LoadingState.Initialized,++j.m_initializedTextElementCount),e.loadingState!==f.LoadingState.Initialized)return void 0!==u&&u.length<g&&u.push(e),"continue";if(void 0!==U)if(z){if(U.geometry.drawCount+e.glyphs.length>j.maxNumGlyphs)return 0,"continue"}else if(U.geometry.drawCount+e.textBufferObject.glyphs.length>j.maxNumGlyphs)return 0,"continue";d.textRenderStyle=e.renderStyle,d.textLayoutStyle=e.layoutStyle;var B,N=function(i,n,s,c,h){var f=p.m_mapView.pixelRatio;O.x=A.x=h.x,O.y=A.y=h.y,void 0!==i.xOffset&&(O.x+=i.xOffset*f),void 0!==i.yOffset&&(O.y+=i.yOffset*f);var m=f,v=1,y=R.distanceTo(c);if(void 0!==y){if(void 0!==i.fadeFar&&(i.fadeFar<=0||i.fadeFar*L<y))return!1;var x=L*_;y>x&&(m*=v=1-(y-x)/(L-x)*(1-i.distanceScale)),e.currentViewDistance=y}var w=p.getDistanceFadingFactor(i,L),T=i.poiInfo,C=!0,F=void 0===T||a.MathUtils.isClamped(o,T.iconMinZoomLevel,T.iconMaxZoomLevel);if(F&&void 0!==T&&V.prepareRender(i)){if(!1===T.isValid)return!1;if(!V.computeScreenBox(T,A,v,p.m_screenCollisions,P))return void 0!==u&&u.length<g&&u.push(i),n.lastFrameNumber=-1,!1;if(C=V.isSpaceAvailable(p.m_screenCollisions,P))(n.lastFrameNumber<r-1||n.isFadingOut()||n.isFadedOut())&&p.startFadeIn(n,r,t);else{if(!n.isVisible())return!1;!0===T.mayOverlap||n.isFadingOut()||(p.startFadeOut(n,r,t),void 0!==s&&s.isVisible()&&p.startFadeOut(s,r,t))}n.isFading()&&p.updateFading(n,t)}if((void 0===T||void 0===o||a.MathUtils.isClamped(o,T.iconMinZoomLevel,T.iconMaxZoomLevel))&&(!0===i.ignoreDistance||void 0===i.currentViewDistance||i.currentViewDistance<S)&&(void 0===T||!0===T.isValid||!1!==T.iconIsOptional)&&""!==e.text){if(E.x=O.x,E.y=O.y,E.z=e.renderDistance,P.x=O.x+i.textBufferObject.bounds.min.x*m,P.y=O.y+i.textBufferObject.bounds.min.y*m,P.w=(i.textBufferObject.bounds.max.x-i.textBufferObject.bounds.min.x)*m,P.h=(i.textBufferObject.bounds.max.y-i.textBufferObject.bounds.min.y)*m,P.x-=4*m,P.y-=2*m,P.w+=8*m,P.h+=4*m,!p.m_screenCollisions.isVisible(P))return void 0!==u&&u.length<g&&u.push(i),0,!1;var D=void 0!==i.poiInfo&&!0===i.poiInfo.textIsOptional,j=void 0!==s&&s.isFadingIn(),U=void 0!==s&&s.isFadingOut(),z=!p.m_screenCollisions.isAllocated(P);if(i.textMayOverlap||z||j||U){if(!U&&i.textReservesSpace&&p.m_screenCollisions.allocate(P),(j||U||!M||void 0===T||!0===T.renderTextDuringMovements)&&!n.isFadedOut()){var B=!1;!n.isFadingOut()&&z&&C?B=p.checkStartFadeIn(s,r,t,!0):void 0!==s&&s.isFading()&&(p.updateFading(s,t),B=!0),I=I||U||B;var N=void 0!==s?s.opacity:n.opacity;k.layer=i.renderOrder,k.position=E,k.scale=m,k.opacity=N*w,k.backgroundOpacity=k.opacity*e.renderStyle.backgroundOpacity,d.addTextBufferObject(i.textBufferObject,k)}0}else if(F&&D){if(void 0!==s&&s.isVisible()){G=p.checkStartFadeOut(s,r,t);I=I||G}}else{if(void 0!==i.poiInfo&&!n.isVisible())return void 0!==u&&u.length<g&&u.push(i),0,!1;if(void 0!==i.poiInfo&&p.startFadeOut(n,r,t),void 0!==s&&s.isVisible()){var G=p.checkStartFadeOut(s,r,t);I=I||G}p.startFadeOut(n,r,t)}}if(F&&void 0!==T&&V.poiIsRenderable(T)){var W=p.checkStartFadeIn(n,r,t);I=I||W,V.renderPoi(T,A,p.m_screenCollisions,v,!1!==T.reserveSpace,n.opacity*w),n.lastFrameNumber=r,0}return void 0!==l&&l.push(i),b++,!0};void 0===e.path?(B=e,E.x=B.position.x+B.tileCenterX,E.y=B.position.y+B.tileCenterY,E.z=0,void 0!==p.m_screenProjector.project(E,O)&&(void 0===B.iconRenderState&&(B.iconRenderState=new f.RenderState,B.textRenderState=new f.RenderState,p.m_mapView.fadingDisabled&&(B.iconRenderState.fadingTime=0,B.textRenderState.fadingTime=0)),N(B,B.iconRenderState,B.textRenderState,E,O))):e.isLineMarker?function(e){var t=e.poiInfo;if(void 0!==e.path&&0!==e.path.length&&V.prepareRender(e)){var r;if(void 0!==t.shieldGroupIndex&&void 0===(r=x[t.shieldGroupIndex])&&(r=[],x[t.shieldGroupIndex]=r),void 0===e.iconRenderStates){var i=new Array;e.path.forEach(function(){var e=new f.RenderState;e.state=f.FadingState.FadingIn,e.fadingTime=p.m_mapView.fadingDisabled?0:e.fadingTime,i.push(e)}),e.iconRenderStates=i}var n=t.technique,o=void 0!==n.minDistance?n.minDistance*n.minDistance:0;if(o>0&&void 0!==r)for(var s=0;s<e.path.length;s++){var l=e.path[s];if(E.x=l.x+e.tileCenterX,E.y=l.y+e.tileCenterY,E.z=0,void 0!==p.m_screenProjector.project(E,O)){for(var u=!1,c=0;c<r.length&&!(u=a.Math2D.distSquared(r[c],r[c+1],O.x,O.y)<o);c+=2);u||N(e,e.iconRenderStates[s],void 0,E,O)&&r.push(O.x,O.y)}}else for(s=0;s<e.path.length;s++)l=e.path[s],E.x=l.x+e.tileCenterX,E.y=l.y+e.tileCenterY,E.z=0,void 0!==p.m_screenProjector.project(E,O)&&N(e,e.iconRenderStates[s],void 0,E,O)}}(e):function(i){var o,a,u,c;if(!(!0===i.ignoreDistance||void 0===i.currentViewDistance||i.currentViewDistance<w))return!1;var m=p.m_mapView.pixelRatio,v=d.textRenderStyle.fontSize.size/100*m,y=1,g=i.tileCenterX,x=i.tileCenterY,S=i.path[0].clone();S.x+=g,S.y+=x;if(void 0!==i.fadeFar&&(i.fadeFar<=0||i.fadeFar*L<i.renderDistance))return!1;p.updateViewDistance(R,i);var M=i.renderDistance,A=L*_,k=-M;k>A&&(v*=1-(k-A)/(L-A)*(1-i.distanceScale));var V=[];try{for(var j=n(i.path),U=j.next();!U.done;U=j.next()){var z=U.value;E.set(z.x+g,z.y+x,0);var B=p.m_screenProjector.project(E);if(void 0===B)return!1;V.push(B)}}catch(e){o={error:e}}finally{try{U&&!U.done&&(a=j.return)&&a.call(j)}finally{if(o)throw o.error}}if(-1===V.findIndex(function(e){return!!p.m_screenCollisions.screenBounds.contains(e.x,e.y)}))return 0,!1;var N=new s.Path;if(V[1].x-V[0].x>=0){O.copy(V[0]);for(var G=0;G<V.length-1;++G)N.add(new h.SimpleLineCurve(V[G],V[G+1]))}else for(O.copy(V[V.length-1]),G=V.length-1;G>0;--G)N.add(new h.SimpleLineCurve(V[G],V[G-1]));var W=d.textRenderStyle.fontSize.size;if(d.textRenderStyle.fontSize.size=100*v,D.path=N,D.outputCharacterBounds=C,D.letterCaseArray=i.glyphCaseArray,!d.measureText(i.glyphs,T,D))return d.textRenderStyle.fontSize.size=W,!1;try{for(var q=n(C),H=q.next();!H.done;H=q.next()){var X=H.value;if(P.x=O.x+X.min.x,P.y=O.y+X.min.y,P.w=X.max.x-X.min.x,P.h=X.max.y-X.min.y,!p.m_screenCollisions.isVisible(P)||!e.textMayOverlap&&p.m_screenCollisions.isAllocated(P))return d.textRenderStyle.fontSize.size=W,!1}}catch(e){u={error:e}}finally{try{H&&!H.done&&(c=q.return)&&c.call(q)}finally{if(u)throw u.error}}void 0===i.textRenderState&&(i.textRenderState=new f.RenderState,i.textRenderState.fadingTime=p.m_mapView.fadingDisabled?0:i.textRenderState.fadingTime),(i.textRenderState.state===f.FadingState.Undefined||i.textRenderState.lastFrameNumber<r-1)&&p.startFadeIn(i.textRenderState,r,t);var Y=p.checkStartFadeIn(i.textRenderState,r,t);I=I||Y,i.textRenderState.isFading()&&(y=i.textRenderState.opacity);var Z=d.textRenderStyle.opacity,Q=d.textRenderStyle.backgroundOpacity,K=p.getDistanceFadingFactor(i,L);d.textRenderStyle.opacity=y*K,d.textRenderStyle.backgroundOpacity=d.textRenderStyle.opacity*e.renderStyle.backgroundOpacity,E.z=e.renderDistance,F.path=N,F.layer=i.renderOrder,F.letterCaseArray=i.glyphCaseArray,d.addText(i.glyphs,E,F),i.textReservesSpace&&(P.x=O.x+T.min.x,P.y=O.y+T.min.y,P.w=T.max.x-T.min.x,P.h=T.max.y-T.min.y,p.m_screenCollisions.allocate(P)),void 0!==l&&l.push(i),b++,d.textRenderStyle.fontSize.size=W,d.textRenderStyle.opacity=Z,d.textRenderStyle.backgroundOpacity=Q}(e)},j=this;try{for(var U=n(e),z=U.next();!z.done;z=U.next()){if("break"===V(z.value))break}}catch(e){c={error:e}}finally{try{z&&!z.done&&(d=U.return)&&d.call(U)}finally{if(c)throw c.error}}return!this.m_mapView.fadingDisabled&&I&&this.m_mapView.update(),b},e.prototype.renderTileList=function(e,t,r,i,o,s){var l,u,c,d;if(0!==this.m_textRenderers.length&&0!==e.length){var h=new a.GroupedPriorityList;try{for(var f=n(e),p=f.next();!p.done;p=f.next()){var m=p.value;h.merge(m.placedTextElements)}}catch(e){l={error:e}}finally{try{p&&!p.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}var v=this.m_mapView.camera.far*this.m_mapView.camera.far,y=this.m_maxNumVisibleLabels,g=0;try{for(var _=n(h.sortedGroups),b=_.next();!b.done;b=_.next()){var x=b.value.elements;if(this.sortTextElements(x,v),(g+=this.renderTextElements(x,t,r,i,o,s))>y)break}}catch(e){c={error:e}}finally{try{b&&!b.done&&(d=_.return)&&d.call(_)}finally{if(c)throw c.error}}}},e.prototype.checkStartFadeIn=function(e,t,r,i){void 0===i&&(i=!1);var n=!1;return void 0!==e&&((i||e.state===f.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeIn(e,t,r),e.isFading()&&(this.updateFading(e,r),n=!0),e.lastFrameNumber=t),n},e.prototype.checkStartFadeOut=function(e,t,r,i){void 0===i&&(i=!0);var n=!1;return void 0!==e&&((i||e.state===f.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeOut(e,t,r),e.isFading()&&(this.updateFading(e,r),n=!0),e.lastFrameNumber=t),n},e.prototype.startFadeIn=function(e,t,r){e.lastFrameNumber<t-1&&e.reset(),e.state!==f.FadingState.FadingIn&&e.state!==f.FadingState.FadedIn&&(e.state===f.FadingState.FadingOut?(e.value=1-e.value,e.startTime=r-e.value*e.fadingTime):(e.startTime=r,e.value=0,e.opacity=0),e.state=f.FadingState.FadingIn)},e.prototype.startFadeOut=function(e,t,r){e.lastFrameNumber<t-1&&e.reset(),e.state!==f.FadingState.FadingOut&&e.state!==f.FadingState.FadedOut&&(e.state===f.FadingState.FadingIn?(e.startTime=r-e.value*e.fadingTime,e.value=1-e.value):(e.startTime=r,e.value=0,e.opacity=1),e.state=f.FadingState.FadingOut)},e.prototype.updateFading=function(e,t){if(e.state===f.FadingState.FadingIn||e.state===f.FadingState.FadingOut){0===e.startTime&&(e.startTime=t);var r=t-e.startTime,i=e.state===f.FadingState.FadingIn?0:1,n=e.state===f.FadingState.FadingIn?1:0;r>=e.fadingTime?(e.value=1,e.opacity=n,e.state=e.state===f.FadingState.FadingIn?f.FadingState.FadedIn:f.FadingState.FadedOut):(e.value=r/e.fadingTime,e.opacity=a.MathUtils.clamp(a.MathUtils.smootherStep(i,n,e.value),0,1))}},e}();t.TextElementsRenderer=I},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(2),a=r(0),s=r(25),l=r(127),u=r(61);!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(n=t.PickObjectType||(t.PickObjectType={}));var c=function(){function e(e,t){void 0===t&&(t=!0),this.mapView=e,this.enableRoadPicking=t,this.m_plane=new a.Plane(new a.Vector3(0,0,1)),this.m_rayCaster=new l.PickingRaycaster(e),t&&(this.m_roadPicker=new u.RoadPicker(e))}return e.prototype.registerTile=function(e){return void 0!==this.m_roadPicker?this.m_roadPicker.registerTile(e):void 0},e.prototype.intersectMapObjects=function(e,t){var r,s,l=this,u=this.mapView.getNormalizedScreenCoordinates(e,t),c=this.m_rayCaster,d=[];if(void 0!==this.mapView.textElementsRenderer){var h=this.mapView.canvas,f=h.clientWidth,p=h.clientHeight,m=u.x*f*.5*this.mapView.pixelRatio,v=u.y*p*.5*this.mapView.pixelRatio,y=new a.Vector2(m,v);this.mapView.textElementsRenderer.pickTextElements(y,d)}c.setFromCamera(u,this.mapView.camera);var g=c.intersectObjects(this.mapView.worldRootObject.children,!0);try{for(var _=i(g),b=_.next();!b.done;b=_.next()){var x=b.value,w={type:n.Unspecified,point:x.point,distance:x.distance,intersection:x};if(void 0!==x.object.userData){var S=void 0!==x.object.userData?x.object.userData.feature:void 0;if(void 0===S){d.push(w);continue}if(this.addObjInfo(S,x,w),void 0!==S.ids){var T=1===S.ids.length?S.ids[0]:void 0;w.featureId=T}var C=void 0;switch(S.geometryType){case o.GeometryType.Point:case o.GeometryType.Text:C=n.Point;break;case o.GeometryType.Line:case o.GeometryType.ExtrudedLine:case o.GeometryType.SolidLine:case o.GeometryType.TextPath:C=n.Line;break;case o.GeometryType.Polygon:case o.GeometryType.ExtrudedPolygon:C=n.Area;break;case o.GeometryType.Object3D:C=n.Object3D;break;default:C=n.Unspecified}w.type=C,d.push(w)}}}catch(e){r={error:e}}finally{try{b&&!b.done&&(s=_.return)&&s.call(_)}finally{if(r)throw r.error}}if(this.enableRoadPicking){var P=new a.Vector3;c.ray.intersectPlane(this.m_plane,P),P.add(this.mapView.worldCenter);var E=this.mapView.worldCenter.clone().add(this.mapView.camera.position);this.mapView.forEachVisibleTile(function(e){l.m_roadPicker.intersectRoads(e,E,P,d)})}return d.sort(function(e,t){return e.distance-t.distance}),d},e.prototype.addObjInfo=function(e,t,r){var n,o;if(r.intersection.object instanceof s.MapViewPoints)r.userData=e.objInfos[t.index];else if(void 0!==e.objInfos&&void 0!==e.starts&&void 0!==t.faceIndex)if(e.starts.length>1){var a=0;try{for(var l=i(e.starts),u=l.next();!u.done;u=l.next()){if(u.value>t.faceIndex)break;a++}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}r.userData=e.objInfos[a-1]}else r.userData=e.objInfos[0]},e}();t.PickHandler=c},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(153)),i(r(78)),i(r(154))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),n=r(5),o=r(10),a=r(15),s=function(){function e(){}return e.clamp=function(e,t,r){return Math.min(Math.max(t,e),r)},e.latitudeClamp=function(t){return e.clamp(t,-e.MAXIMUM_LATITUDE,e.MAXIMUM_LATITUDE)},e.latitudeProject=function(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI},e.latitudeClampProject=function(t){return e.latitudeProject(e.latitudeClamp(t))},e.unprojectLatitude=function(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI},e.prototype.getScaleFactor=function(e){return Math.cosh(2*Math.PI*(e.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5))},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.max.y=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.max.z=t,r},e.prototype.projectPoint=function(t,r){var i;return i=t instanceof n.GeoCoordinates?t.normalized():new n.GeoCoordinates(t.latitude,t.longitude,t.altitude).normalized(),r||(r={x:0,y:0,z:0}),r.x=(i.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.y=(.5*e.latitudeClampProject(i.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.z=t.altitude||0,r},e.prototype.unprojectPoint=function(t){return n.GeoCoordinates.fromRadians(e.unprojectLatitude(2*(t.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5)),t.x/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE*2*Math.PI-Math.PI,t.z)},e.prototype.projectBox=function(t,r){var i=t.center,s=this.projectPoint(new n.GeoCoordinates(i.latitude,i.longitude,0)),l=(.5*e.latitudeClampProject(t.northEast.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,u=(.5*e.latitudeClampProject(t.southWest.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=.5*(l+u);s.y=c;var d=l-u,h=t.longitudeSpan/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;r||(r=o.MathUtils.newEmptyBox3()),r.min.x=s.x-.5*h,r.min.y=s.y-.5*d,r.max.x=s.x+.5*h,r.max.y=s.y+.5*d;var f=t.altitudeSpan;return void 0!==f?(r.min.z=s.z-.5*f,r.max.z=s.z+.5*f):(r.min.z=0,r.max.z=0),r},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)},e.MAXIMUM_LATITUDE=1.4844222297453322,e}();t.MercatorProjection=s,t.mercatorProjection=new s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(){return 2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 1<<e},e}();t.quadTreeSubdivisionScheme=new i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.enableRayTesting=!0,t}return n(t,e),t.prototype.raycast=function(e,t){if(this.enableRayTesting){var r=this.geometry,i=this.matrixWorld,n=e.ray.origin.clone().add(e.ray.direction).project(e.mapView.camera),a=e.mapView.canvas,l=a.clientWidth,u=a.clientHeight,c=new o.Vector2(Math.ceil((n.x+1)/2*l),Math.ceil((1-n.y)/2*u));if(r instanceof o.BufferGeometry){var d=new o.Vector3,h=r.index,f=r.attributes.position.array;if(null!==h)for(var p=h.array,m=0,v=p.length;m<v;m++){var y=p[m];d.fromArray(f,3*y),(b=s(d,i,e,l,u)).pointIsOnScreen&&this.testPoint(d,b.absoluteScreenPosition,c,m,b.distance,t)}else{m=0;for(var g=f.length/3;m<g;m++){d.fromArray(f,3*m),(b=s(d,i,e,l,u)).pointIsOnScreen&&this.testPoint(d,b.absoluteScreenPosition,c,m,b.distance,t)}}}else{var _=r.vertices;for(h=0;h<_.length;h++){var b;(b=s(d=_[h],i,e,l,u)).pointIsOnScreen&&this.testPoint(d,b.absoluteScreenPosition,c,h,b.distance,t)}}}},t}(o.Points);function s(e,t,r,i,n){var a=e.clone();a.applyMatrix4(t);var s=a.distanceTo(r.ray.origin);a.project(r.mapView.camera);var l=new o.Vector2(a.x,a.y),u=l.x<1&&l.x>-1&&l.y<1&&l.y>-1;return u?(a.x=(a.x+1)/2*i,a.y=(1-a.y)/2*n,{absoluteScreenPosition:new o.Vector2(a.x,a.y),pointIsOnScreen:u,distance:s}):{pointIsOnScreen:u}}t.MapViewPoints=a;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.testPoint=function(e,t,r,i,n,o){var a=t.x-r.x,s=t.y-r.y;Math.sqrt(a*a+s*s)<=this.material.size/2&&o.push({point:e,distance:n,index:i,object:this})},t}(a);t.Circles=l;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.testPoint=function(e,t,r,i,n,o){var a=t.x-r.x,s=t.y-r.y,l=this.material.size/2;Math.abs(a)<=l&&Math.abs(s)<=l&&o.push({point:e,distance:n,index:i,object:this})},t}(a);t.Squares=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r(1),s=r(0),l=r(103);function u(e,t){return e*t.far}!function(e){e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.patchGlobalShaderChunks=function(){void 0===s.ShaderChunk.fading_pars_vertex&&Object.assign(s.ShaderChunk,l.default)},e.updateDistanceFadeFeature=function(e){e.needsUpdate=!0,void 0===e.defines&&(e.defines={}),void 0!==e.fadeFar&&e.fadeFar>0&&(e.defines.FADING_MATERIAL="")},e.insertShaderInclude=function(e,t,r,i){var n=!0===i?"\t":"";return e.replace("#include <"+t+">","\n#include <"+t+">\n// << Patched fading shader START >>\n"+n+"#include <"+r+">\n// << Patched fading shader END >>\n")},e.onBeforeCompile=function(t,r){if(!(void 0===t.fadeFar||t.fadeFar<=0)){var i=r.uniforms;i.fadeNear={value:t.fadeNear},i.fadeFar={value:t.fadeFar},r.vertexShader=e.insertShaderInclude(r.vertexShader,"fog_pars_vertex","fading_pars_vertex"),r.vertexShader=e.insertShaderInclude(r.vertexShader,"fog_vertex","fading_vertex",!0),r.fragmentShader=e.insertShaderInclude(r.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),r.fragmentShader=e.insertShaderInclude(r.fragmentShader,"fog_fragment","fading_fragment",!0)}},e.addRenderHelper=function(t,r,i,n,o,a){t.onBeforeRender=function(t,s,l,c,d){n&&(d.transparent=!0);var h=d;if(h.fadeNear=void 0===r?e.DEFAULT_FADE_NEAR:u(r,l),h.fadeFar=void 0===i?e.DEFAULT_FADE_FAR:u(i,l),o){var f=t.properties.get(d);void 0!==f.shader&&(f.shader.uniforms.fadeNear.value=h.fadeNear,f.shader.uniforms.fadeFar.value=h.fadeFar,h.uniformsNeedUpdate=!0)}void 0!==a&&a(t,d)},n&&(t.onAfterRender=function(e,t,r,i,n){n.transparent=!1})}}(o=t.FadingFeature||(t.FadingFeature={}));var c=function(){function e(){this.m_fadeNear=o.DEFAULT_FADE_NEAR,this.m_fadeFar=o.DEFAULT_FADE_FAR}return e.prototype.getFadeNear=function(){return this.m_fadeNear},e.prototype.setFadeNear=function(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeNear,this.m_fadeNear=e,this.needsUpdate&&o.updateDistanceFadeFeature(this)},e.prototype.getFadeFar=function(){return this.m_fadeFar},e.prototype.setFadeFar=function(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeFar,this.m_fadeFar=e,this.needsUpdate&&o.updateDistanceFadeFeature(this)},e.prototype.addFadingProperties=function(){var e=this;Object.defineProperty(this,"fadeNear",{get:function(){return e.getFadeNear()},set:function(t){e.setFadeNear(t)}}),Object.defineProperty(this,"fadeFar",{get:function(){return e.getFadeFar()},set:function(t){e.setFadeFar(t)}})},e.prototype.applyFadingParameters=function(e){var t=this;void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=function(e){o.onBeforeCompile(t,e)}},e.prototype.copyFadingParameters=function(e){return this.setFadeNear(void 0===e.fadeNear?o.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?o.DEFAULT_FADE_FAR:e.fadeFar),this},e}();t.FadingFeatureMixin=c;var d=function(e){function t(t){var r=e.call(this,t)||this;return o.patchGlobalShaderChunks(),r.addFadingProperties(),r.applyFadingParameters(t),r}return n(t,e),t.prototype.clone=function(){return(new t).copy(this)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.copyFadingParameters(t),this},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return o.DEFAULT_FADE_NEAR},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return o.DEFAULT_FADE_FAR},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addFadingProperties=function(){},t.prototype.applyFadingParameters=function(e){},t.prototype.copyFadingParameters=function(e){},t}(s.MeshBasicMaterial);t.MapMeshBasicMaterial=d;var h=function(e){function t(t){var r=e.call(this,t)||this;return o.patchGlobalShaderChunks(),r.addFadingProperties(),r.applyFadingParameters(t),r}return n(t,e),t.prototype.clone=function(){return(new t).copy(this)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.copyFadingParameters(t),this},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return o.DEFAULT_FADE_NEAR},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return o.DEFAULT_FADE_FAR},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addFadingProperties=function(){},t.prototype.applyFadingParameters=function(e){},t.prototype.copyFadingParameters=function(e){},t}(s.MeshStandardMaterial);t.MapMeshStandardMaterial=h,a.applyMixinsWithoutProperties(d,[c]),a.applyMixinsWithoutProperties(h,[c])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));var i=function(){return function(){}}();t.LoggerOptions=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={project_line_vert_func:"\nvoid projectVertex(vec2 segment, vec2 t0, vec2 t1, float lineWidth, inout vec2 pos, inout vec2 uv) {\n        float uu = uv.x / 2.0 + 0.5;\n        float ss = mix(segment.x, segment.y, uu);\n\n        if (t0 != t1) {\n            float angle = atan(t0.x * t1.y - t0.y * t1.x, t0.x * t1.x + t0.y * t1.y);\n            vec2 t = normalize(t0 + t1);\n            vec2 n = vec2(t.y, -t.x);\n            pos += uv.y * lineWidth * n / cos(angle / 2.0);\n            uv.x = ss + uv.x * lineWidth * uv.y * tan(angle / 2.0);\n        }\n        else {\n            vec2 n = vec2(t0.y, -t0.x);\n            pos += uv.y * lineWidth * n + uv.x * lineWidth * mix(t0, t1, uu);\n            uv.x = ss + uv.x * lineWidth;\n        }\n}\n",join_dist_func:"\nfloat joinDist(vec2 segment, vec2 texcoord) {\n    float d = abs(texcoord.y);\n    float dx = texcoord.x;\n    if (dx < segment.x) {\n        d = max(d, length(texcoord - vec2(segment.x, 0.0)));\n    } else if (dx > segment.y) {\n        d = max(d, length(texcoord - vec2(segment.y, 0.0)));\n    }\n    return d;\n}\n",tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert2D_func:"\nvec2 subtractDblEyePos( const in vec2 pos ) {\n    vec2 t1 = positionLow - u_eyepos_lowpart.xy;\n    vec2 e = t1 - positionLow.xy;\n    vec2 t2 = ((-u_eyepos_lowpart.xy - e) + (positionLow.xy - (t1 - e))) + pos - u_eyepos.xy;\n    vec2 high_delta = t1 + t2;\n    vec2 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n",high_precision_vert3D_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.enabled=!1,this.renderToScreen=!1}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,r,i,n,o){},e}();t.Pass=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(12),o=function(){function e(e,t,r,o,a,s,l,u,c,d,h,f,p){this.codePoint=e,this.block=t,this.width=r,this.height=o,this.advanceX=a,this.offsetX=s,this.offsetY=l,this.texture=f,this.font=p,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=n.UnicodeUtils.getDirection(e,t);var m=this.offsetX,v=m+this.width,y=p.metrics.lineHeight-this.offsetY,g=y-this.height;this.positions.push(new i.Vector3(m,g,1),new i.Vector3(v,g,1),new i.Vector3(m,y,1),new i.Vector3(v,y,1)),this.sourceTextureCoordinates.push(new i.Vector2(u,c),new i.Vector2(d,c),new i.Vector2(u,h),new i.Vector2(d,h)),this.dynamicTextureCoordinates.push(new i.Vector2(0,0),new i.Vector2(1,0),new i.Vector2(0,1),new i.Vector2(1,1))}return e.prototype.clone=function(){return new e(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font)},e}();t.GlyphData=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(6),o=r(12);!function(e){e.EM_TO_PX=16,e.PT_TO_PX=1.25,e.OBLIQUE_ANGLE=.174533,e.OBLIQUE_OFFSET=Math.tan(e.OBLIQUE_ANGLE),e.getPixelSize=function(t,r,i){var o=t;switch(r){case n.FontUnit.Em:o*=e.EM_TO_PX;break;case n.FontUnit.Point:o*=e.PT_TO_PX;break;case n.FontUnit.Percent:o*=.01*i}return o},e.getSmallCapsScale=function(e,t,r,i){return t[r]&&i===n.FontVariant.SmallCaps?e[r].font.metrics.xHeight/e[r].font.metrics.capHeight:1},e.getDirection=function(e,t){for(var r=o.UnicodeUtils.Direction.LTR,i=t;e[i].direction!==o.UnicodeUtils.Direction.LTR&&e[i].direction!==o.UnicodeUtils.Direction.RTL&&i<e.length-1;)++i;return 1===Math.abs(e[i].direction)&&(r=e[i].direction),r},e.computeGlyphTransform=function(e,t,r,i,n){var o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),l=Math.sin(n);e.set(r*s,r*-l,o*t.x-a*t.y,r*l,r*s,a*t.x+o*t.y,0,0,1)},e.updateBounds=function(e,t,r){var n=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),a=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),s=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==r&&(void 0!==r.array[r.offset]?(r.array[r.offset].min.set(n,a),r.array[r.offset].max.set(o,s)):r.array.push(new i.Box2(new i.Vector2(n,a),new i.Vector2(o,s))),++r.offset),t.min.set(Math.min(t.min.x,n),Math.min(t.min.y,a)),t.max.set(Math.max(t.max.x,o),Math.max(t.max.y,s))}}(t.TypesettingUtils||(t.TypesettingUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);!function(e){e.mergeArrays=function(e,t){var r,a,s,l,u=[];try{for(var c=n([e,t]),d=c.next();!d.done;d=c.next()){var h=d.value;if(void 0!==h){var f=function(e){var t=u.find(function(t){return t.id===e.id||void 0!==t.label&&t.label===e.label});void 0===t?u.push(i({},e)):(t.year=o.MathUtils.max2(e.year,t.year),t.label=o.getOptionValue(e.label,t.label),t.link=o.getOptionValue(e.link,t.link))};try{for(var p=n(h),m=p.next();!m.done;m=p.next())f(m.value)}catch(e){s={error:e}}finally{try{m&&!m.done&&(l=p.return)&&l.call(p)}finally{if(s)throw s.error}}}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return u},e.formatAsHtml=function(e){if(0===e.length)return"";var t=e.filter(function(e){return""!==e.label});return 0===t.length?"":" "+t.map(function(e){var t=void 0!==e.label?e.label:e.id,r=void 0!==e.year?e.year+" "+t:t;return e.link?'<a href="'+e.link+'">'+r+"</a>":""+r}).join(", ")}}(t.CopyrightInfo||(t.CopyrightInfo={}))},function(e,t,r){"use strict";function i(e,t,r,n){if(!(this instanceof i))return new i(e,t,r,n);var o,a,s;e.x?(r=e.w,n=e.h,t=e.y,0!==e.w&&!e.w&&e.x2?(r=e.x2-e.x,n=e.y2-e.y):(r=e.w,n=e.h),e=e.x,o=e+r,a=t+n,s=!(n+r)):(o=e+r,a=t+n,s=!(n+r)),this.x1=this.x=function(){return e},this.y1=this.y=function(){return t},this.x2=function(){return o},this.y2=function(){return a},this.w=function(){return r},this.h=function(){return n},this.p=function(){return s},this.overlap=function(r){return s||r.p()?e<=r.x2()&&o>=r.x()&&t<=r.y2()&&a>=r.y():e<r.x2()&&o>r.x()&&t<r.y2()&&a>r.y()},this.expand=function(i){var s,l,u=i.x(),c=i.y(),d=i.x2(),h=i.y2();return s=e>u?u:e,l=t>c?c:t,r=o>d?o-s:d-s,n=a>h?a-l:h-l,e=s,t=l,this}}i.overlapRectangle=function(e,t){return 0===e.h&&0===e.w||0===t.h&&0===t.w?e.x<=t.x+t.w&&e.x+e.w>=t.x&&e.y<=t.y+t.h&&e.y+e.h>=t.y:e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y},i.containsRectangle=function(e,t){return e.x+e.w<=t.x+t.w&&e.x>=t.x&&e.y+e.h<=t.y+t.h&&e.y>=t.y},i.expandRectangle=function(e,t){var r,i,n=e.x+e.w,o=t.x+t.w,a=e.y+e.h,s=t.y+t.h;return r=e.x>t.x?t.x:e.x,i=e.y>t.y?t.y:e.y,e.w=n>o?n-r:o-r,e.h=a>s?a-i:s-i,e.x=r,e.y=i,e},i.makeMBR=function(e,t){if(!e.length)return{x:0,y:0,w:0,h:0};(t=t||{}).x=e[0].x,t.y=e[0].y,t.w=e[0].w,t.h=e[0].h;for(var r=1,n=e.length;r<n;r++)i.expandRectangle(t,e[r]);return t},i.squarifiedRatio=function(e,t,r){var i=(e+t)/2,n=e*t;return n*r/(n/(i*i))},e.exports=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),l=s.LoggerManager.instance.create("Statistics"),u=function(){function e(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}return e.prototype.clear=function(){this.head=this.tail=this.size=0},e.prototype.enqOne=function(e){var t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)},e.prototype.enq=function(){for(var e,t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];try{for(var n=o(r),a=n.next();!a.done;a=n.next()){var s=a.value;this.enqOne(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.deq=function(){if(0===this.size)throw new Error("Ringbuffer underrun");var e=this.buffer[this.tail],t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e},Object.defineProperty(e.prototype,"top",{get:function(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){if(0===this.size)throw new Error("Ringbuffer underrun");var e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]},enumerable:!0,configurable:!0}),e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.asArray=function(){for(var e=new Array,t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e},e}();t.RingBuffer=u,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_buffer=e,this.m_index=t}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]},enumerable:!0,configurable:!0}),e.prototype.next=function(){return this.m_index++,this.m_index<this.m_buffer.size},e}();e.Iterator=t}(u=t.RingBuffer||(t.RingBuffer={})),t.RingBuffer=u;var c=function(){function e(e,t){this.statistics=e,this.name=t,this.running=!1}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_currentValue},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e){this.m_currentValue=e},e.prototype.reset=function(){this.m_currentValue=void 0},e.prototype.start=function(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=s.PerformanceTimer.now()},e.prototype.stop=function(){if(!this.statistics.enabled)return-1;if(this.running){var e=s.PerformanceTimer.now()-(this.m_currentValue||0);return this.m_currentValue=e,this.setValue(e),this.running=!1,e}throw new Error("Timer '"+this.name+"' has not been started")},e.prototype.now=function(){if(!this.statistics.enabled)return-1;if(this.running)return s.PerformanceTimer.now()-(this.m_currentValue||0);throw new Error("Timer '"+this.name+"' has not been started")},e}();t.SimpleTimer=c;var d=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.statistics=t,i.name=r,i.numResets=0,i.maxNumSamples=1e3,i.samples=new u(i.maxNumSamples),i}return n(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.getStats(),this.samples.clear(),this.numResets++},t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),void 0!==t&&this.samples.enqOne(t)},t.prototype.getStats=function(){return h(this.samples.asArray())},t}(c);function h(e){if(0!==e.length){e.sort(function(e,t){return e-t});var t,r,i,n,o,a,s=e[0],l=e[e.length-1];if(1===e.length)r=i=n=o=a=t=e[0];else if(2===e.length)t=.5*e[0]+.5*e[1],r=i=n=o=a=e[1];else{var u=Math.floor(e.length/2);t=e.length%2==0?.5*e[u-1]+.5*e[u]:e[u],r=e[Math.round(.9*e.length)-1],i=e[Math.round(.95*e.length)-1],n=e[Math.round(.97*e.length)-1],o=e[Math.round(.99*e.length)-1],a=e[Math.round(.999*e.length)-1]}for(var c=0,d=0,h=e.length;d<h;d++)c+=e[d];return{min:s,max:l,avg:c/e.length,median:t,median90:r,median95:i,median97:n,median99:o,median999:a,numSamples:e.length}}}t.SampledTimer=d,t.computeArrayStats=h;var f=function(){function e(e,t,r){if(this.statistics=e,this.name=t,this.stages=r,r.length<1)throw new Error("MultiStageTimer needs stages");r.forEach(function(t){if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var e=this;this.statistics.enabled&&this.stages.forEach(function(t){e.statistics.getTimer(t).reset()})},e.prototype.start=function(){return this.stage=this.stages[0],this.statistics.getTimer(this.stages[0]).value||-1},e.prototype.stop=function(){return this.stage=void 0,void 0!==this.value?this.value:-1},Object.defineProperty(e.prototype,"stage",{get:function(){return this.currentStage},set:function(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())},enumerable:!0,configurable:!0}),e}();t.MultiStageTimer=f;var p=function(){function e(e,t){void 0===t&&(t=!1),this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new c(this,"<null>")}return e.prototype.createTimer=function(e,t){void 0===t&&(t=!0);var r=t?new d(this,e):new c(this,e);return this.addTimer(r)},e.prototype.addTimer=function(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e},e.prototype.getTimer=function(e){if(!this.enabled)return this.nullTimer;var t=this.timers.get(e);return void 0===t?this.nullTimer:t},e.prototype.hasTimer=function(e){return void 0!==this.timers.get(e)},e.prototype.reset=function(){this.timers.forEach(function(e){e.reset()})},e.prototype.log=function(e,t){void 0===e&&void 0===this.name||l.log(void 0!==e?e:this.name);var r=0;this.timers.forEach(function(e){r=Math.max(r,e.name.length)});var i=function(e){return void 0!==e?e.toFixed(5):"?"};this.timers.forEach(function(e){var t=e.name+": "+" ".repeat(r-e.name.length);if(t+=i(e.value),e instanceof d){var n=e.getStats();void 0!==n&&(t+="  [ min="+i(n.min)+", max="+i(n.max)+", avg="+i(n.avg)+", med="+i(n.median)+", med95="+i(n.median95)+", med99="+i(n.median99)+", N="+i(n.numSamples)+" ]")}l.log(t)}),void 0!==t&&l.log(t)},e}();t.Statistics=p;var m=function(){function e(){this.entries=new Map,this.messages=void 0}return e.prototype.getValue=function(e){return this.entries.get(e)},e.prototype.setValue=function(e,t){this.entries.set(e,t)},e.prototype.addValue=function(e,t){var r=this.entries.get(e);this.entries.set(e,t+(void 0===r?0:r))},e.prototype.addMessage=function(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)},e.prototype.reset=function(){var e=this;this.entries.forEach(function(t,r){e.entries.set(r,0)}),this.messages=void 0},e}();t.FrameStats=m;var v=function(){function e(e){void 0===e&&(e=0),this.capacity=e,this.frameEntries=new Map,this.messages=new u(e)}return Object.defineProperty(e.prototype,"length",{get:function(){return this.messages.size},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.frameEntries.forEach(function(e,t){e.clear()}),this.messages.clear()},e.prototype.addFrame=function(e){var t=this,r=this.length,i=this.frameEntries;e.entries.forEach(function(e,n){var o=i.get(n);if(void 0===o){o=new u(t.capacity);for(var a=0;a<r;a++)o.enqOne(0);t.frameEntries.set(n,o)}o.enqOne(e)}),this.messages.enq(e.messages)},e.prototype.log=function(){var e=0;this.frameEntries.forEach(function(t,r){e=Math.max(e,r.length)});var t=function(e){return void 0!==e?e.toFixed(5):"?"};this.frameEntries.forEach(function(r,i){var n=i+": "+" ".repeat(e-i.length),o=h(r.asArray());void 0!==o&&(n+="  [ min="+t(o.min)+", max="+t(o.max)+", avg="+t(o.avg)+", med="+t(o.median)+", med95="+t(o.median95)+", med99="+t(o.median99)+", N="+t(o.numSamples)+" ]"),l.log(n)})},e}();t.FrameStatsArray=v;var y=function(){function e(t,r){void 0===t&&(t=!0),void 0===r&&(r=1e3),this.enabled=t,this.maxNumFrames=r,this.currentFrame=new m,this.appResults=new Map,this.configs=new Map,e.m_instance=this,this.m_frameEvents=new v(r)}return Object.defineProperty(e.prototype,"isFull",{get:function(){return this.m_frameEvents.length>=this.maxNumFrames},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return void 0===e.m_instance&&(e.m_instance=new e(!1,0)),e.m_instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameEvents",{get:function(){return this.m_frameEvents},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.clearFrames(),this.configs.clear(),this.appResults.clear()},e.prototype.clearFrames=function(){this.m_frameEvents.reset(),this.currentFrame.reset()},e.prototype.storeFrameInfo=function(e){if(this.m_frameEvents.length>=this.maxNumFrames)return!1;if(void 0!==e&&(this.currentFrame.setValue("gl.numCalls",e.render.calls),this.currentFrame.setValue("gl.numGeometries",e.memory.geometries),this.currentFrame.setValue("gl.numLines",e.render.lines),this.currentFrame.setValue("gl.numPoints",e.render.points),this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length),this.currentFrame.setValue("gl.numTextures",e.memory.textures),this.currentFrame.setValue("gl.numTriangles",e.render.triangles)),void 0!==window&&void 0!==window.performance){var t=window.performance.memory;void 0!==t&&(this.currentFrame.setValue("memory.totalJSHeapSize",t.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",t.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",t.jsHeapSizeLimit))}return this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),!0},e.prototype.log=function(e,t){l.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach(function(e,t){l.log(t,e)}),this.configs.forEach(function(e,t){l.log(t,e)}),this.m_frameEvents.log(),void 0!==t&&l.log(t)},e.prototype.getAsPlainObject=function(){var e,t,r={},i={},n={},s={configs:i,appResults:r,frames:n};this.appResults.forEach(function(e,t){r[t]=e}),this.configs.forEach(function(e,t){i[t]=e});try{for(var l=o(this.m_frameEvents.frameEntries),u=l.next();!u.done;u=l.next()){var c=a(u.value,2),d=c[0],h=c[1];n[d]=h.asArray()}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}return s.messages=this.m_frameEvents.messages.asArray(),s},e.prototype.getLastFrameStatistics=function(){var e,t,r={},i={},n={},s={configs:i,appResults:r,frames:n};this.appResults.forEach(function(e,t){r[t]=e}),this.configs.forEach(function(e,t){i[t]=e});try{for(var l=o(this.m_frameEvents.frameEntries),u=l.next();!u.done;u=l.next()){var c=a(u.value,2),d=c[0],h=c[1];n[d]=h.bottom}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}return s.messages=this.m_frameEvents.messages.asArray(),s},e.m_instance=void 0,e}();t.PerformanceStatistics=y},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(0),a=r(75),s=r(147),l=r(74);!function(e){function t(e){return new o.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function r(e,r){var i=(new o.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),n=new o.Vector3(0,0,0).applyMatrix4(r),a=t(n);return{viewProjection:i,eyePosHi:a,eyePosLo:t(n.sub(a))}}function u(e,t){if(e.length>0){var r=e[0];if(null==r)throw Error("Empty element in positions");var n=new Array,a=new Array,s=function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];try{for(var s=i(r),l=s.next();!l.done;l=s.next()){var u=l.value,c=Math.fround(u);a.push(u-c),n.push(c)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},l=r;if(void 0!==l.z)e.forEach(function(e){!function(e){s(e.x,e.y,e.z)}(e)}),t=3;else if(void 0!==l.y)e.forEach(function(e){s(e.x,e.y)}),t=2;else{if(void 0===t)throw Error("Positions are float array, please provide dimensionality (2 or 3)");if(n.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(function(e){s(e)})}return{positionHigh:new o.Float32BufferAttribute(n,t),positionLow:new o.Float32BufferAttribute(a,t)}}return{positionHigh:new o.Float32BufferAttribute([],t||3),positionLow:new o.Float32BufferAttribute([],t||3)}}function c(e,t,r){void 0===r&&(r=0);for(var i=new Array,n=e.length,o=0;o<n;o+=t){for(var a=0;a<r;a++)i.push(e[o+a]);var s=e[o+r],l=e[o+r+1],u=e[o+r+2],c=Math.fround(s),d=s-c,h=Math.fround(l),f=l-h,p=Math.fround(u),m=u-p;i.push(c,h,p,d,f,m);for(a=r+3;a<t;a++)i.push(e[o+a])}return i}function d(e,t,r){var i=u(t,r);return e.bufferGeometry.addAttribute("position",i.positionHigh),e.bufferGeometry.addAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){var t=Math.fround(e.x),r=Math.fround(e.y),i=Math.fround(e.z),n=new o.Vector3(e.x-t,e.y-r,e.z-i);return e.x=Math.fround(t),e.y=Math.fround(r),e.z=Math.fround(i),n},e.createHighPrecisionCameraPos=r,e.updateHpUniforms=function(e,t,i){var n=r(t,e.matrixWorldInverse),o=n.viewProjection;if(void 0===i||!i.isMaterial)throw Error("High pecision line has no high precision material");if(!(i.uniforms&&i.uniforms.u_mvp&&i.uniforms.u_eyepos&&i.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");i.uniforms.u_mvp.value=new Float32Array(o.elements),i.uniforms.u_eyepos.value=new Float32Array(n.eyePosHi.toArray()),i.uniforms.u_eyepos_lowpart.value=new Float32Array(n.eyePosLo.toArray())},e.createAttributes=u,e.addInterleavedAttributes3=c,e.setPositions=d,e.convertPositions=function(e,t){if(e.length<=0)return{positions:[],dimensionality:t};var r=e[0];if(null==r)throw Error("Empty element in positions");var i=r;if(void 0===i.y&&void 0===i.z)return{positions:e,dimensionality:t};var n=new Array;return void 0!==i.z&&2!==t?(t=3,e.forEach(function(e){n.push(e.x,e.y,e.z)})):(t=2,e.forEach(function(e){n.push(e.x,e.y)})),{positions:n,dimensionality:t}},e.createLine=function(e,t){var r=void 0!==t.lineWidth?t.lineWidth:5,i=void 0!==t.addCircles&&t.addCircles,s=void 0!==t.wireFrame&&t.wireFrame,u=[],d=[];l.triangulateLine(e,r,u,d,i);var h=new o.BufferGeometry,f=c(u,3),p=new o.InterleavedBuffer(new Float32Array(f),6),m=new o.InterleavedBufferAttribute(p,3,0,!1),v=new o.InterleavedBufferAttribute(p,3,3,!1);h.addAttribute("position",m),h.addAttribute("positionLow",v),h.setIndex(new o.BufferAttribute(new Uint32Array(d),1));var y=new n.HighPrecisionLineMaterial(t),g=s?new a.HighPrecisionWireFrameLine(h,y):new a.HighPrecisionLine(h,y);return g.setupForRendering(),g},e.createPoints=function(e,t){for(var r=[],i=0;i<e.length;i++)r.push(r.length/3);var a=new o.BufferGeometry,l=n.isHighPrecisionPointMaterial(t)?t:new n.HighPrecisionPointMaterial(t),u=new s.HighPrecisionPoints(a,l);return d(u,e,3),u.setupForRendering(),u}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(14),o=300,a=function(){function e(e,t,r){var n=this;this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=r,this.m_lastCameraPos=new i.Vector3,this.m_newCameraPos=new i.Vector3,this.m_lastWorldCenter=new i.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=function(){n.m_throttlingTimerId=void 0;var e=performance.now();e>=n.m_movementDetectorDeadline?n.movementFinished():n.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=o)}return e.prototype.checkCameraMoved=function(e,t){var r=n.MapViewUtils.extractYawPitchRoll(e.camera.quaternion),i=e.camera.getWorldPosition(this.m_newCameraPos),o=void 0===this.m_lastYawPitchRoll||!this.m_lastCameraPos.equals(i)||!this.m_lastWorldCenter.equals(e.worldCenter)||r.yaw!==this.m_lastYawPitchRoll.yaw||r.pitch!==this.m_lastYawPitchRoll.pitch||r.roll!==this.m_lastYawPitchRoll.roll;return o&&(this.m_lastCameraPos.copy(i),this.m_lastWorldCenter.copy(e.worldCenter),this.m_lastYawPitchRoll=r),o!==this.m_cameraMovedLastFrame&&(o&&this.movementStarted(),this.m_cameraMovedLastFrame=o),o&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame},e.prototype.clear=function(e){var t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z)},e.prototype.forceMoved=function(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)},Object.defineProperty(e.prototype,"cameraIsMoving",{get:function(){return void 0!==this.m_throttlingTimerId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0},Object.defineProperty(e.prototype,"cameraMovedLastFrame",{get:function(){return!0===this.m_cameraMovedLastFrame},enumerable:!0,configurable:!0}),e.prototype.movementStarted=function(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()},e.prototype.movementFinished=function(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()},e.prototype.startMovementFinishedTimer=function(e){if(void 0===this.m_throttlingTimerId){var t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}},e.prototype.removeMovementFinishedTimer=function(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)},e}();t.CameraMovementDetector=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),n=r(5),o=r(10),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=1,r.max.y=.5,r.max.z=t,r},e.prototype.projectPoint=function(t,r){return void 0===r&&(r={x:0,y:0,z:0}),r.x=(t.longitude*a+Math.PI)*e.geoToWorldScale,r.y=(t.latitude*a+.5*Math.PI)*e.geoToWorldScale,r.z=t.altitude||0,r},e.prototype.unprojectPoint=function(t){return n.GeoCoordinates.fromRadians(t.y*e.worldToGeoScale-.5*Math.PI,t.x*e.worldToGeoScale-Math.PI,t.z)},e.prototype.projectBox=function(t,r){var i=this.projectPoint(new n.GeoCoordinates(t.center.latitude,t.center.longitude,0)),a=t.latitudeSpanInRadians,s=t.longitudeSpanInRadians,l=t.altitudeSpan,u=s*e.geoToWorldScale,c=a*e.geoToWorldScale;return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=i.x-.5*u,r.min.y=i.y-.5*c,r.max.x=i.x+.5*u,r.max.y=i.y+.5*c,void 0!==l?(r.min.z=i.z-.5*l,r.max.z=i.z+.5*l):(r.min.z=0,r.max.z=0),r},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)},e.geoToWorldScale=1/(2*Math.PI),e.worldToGeoScale=2*Math.PI/1,e}();t.equirectangularProjection=new s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(9),a=r(5),s=r(15),l=r(23),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.projectPoint=function(e,t){var r;r=e instanceof a.GeoCoordinates?e.normalized():new a.GeoCoordinates(e.latitude,e.longitude,e.altitude).normalized(),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*s.EarthConstants.EQUATORIAL_CIRCUMFERENCE;var i=Math.sin(l.MercatorProjection.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+i)/(1-i))/(4*Math.PI))*s.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.z=e.altitude||0,t},t.prototype.unprojectPoint=function(e){var t=l.MercatorProjection.clamp(e.x,0,s.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/s.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5,r=.5-l.MercatorProjection.clamp(e.y,0,s.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/s.EarthConstants.EQUATORIAL_CIRCUMFERENCE,i=360*t,n=90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI;return new a.GeoCoordinates(n,i,e.z)},t.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return new o.GeoBox(new a.GeoCoordinates(r.latitude,t.longitude,t.altitude),new a.GeoCoordinates(t.latitude,r.longitude,r.altitude))},t.MAXIMUM_LATITUDE=1.4844222297453322,t}(l.MercatorProjection);t.webMercatorProjection=new u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.tilingScheme=e,this.minElevation=t,this.maxElevation=r,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,r);var i=this.m_worldBox,n=i.min,o=i.max;this.m_worldDimensions={x:o.x-n.x,y:o.y-n.y,z:o.z-n.z}}return Object.defineProperty(e.prototype,"projection",{get:function(){return this.m_tilingScheme.projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionScheme",{get:function(){return this.m_tilingScheme.subdivisionScheme},enumerable:!0,configurable:!0}),e.prototype.getWorldBox=function(e,t){var r=e.level,n=this.subdivisionScheme.getLevelDimensionX(r),o=this.subdivisionScheme.getLevelDimensionY(r),a=this.m_worldDimensions.x/n,s=this.m_worldDimensions.y/o,l=this.m_worldBox.min.x+a*e.column,u=this.m_worldBox.min.y+s*e.row;return t||(t=i.MathUtils.newEmptyBox3()),t.min.x=l,t.min.y=u,t.min.z=this.m_worldBox.min.z,t.max.x=l+a,t.max.y=u+s,t.max.z=this.m_worldBox.max.z,t},e.prototype.getGeoBox=function(e){var t=this.getWorldBox(e);return this.projection.unprojectBox(t)},e}();t.FlatTileBoundingBoxGenerator=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(e){return 0===e?1:2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 0!==e?1<<e-1:1},e}();t.halfQuadTreeSubdivisionScheme=new i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(16),n=function(){function e(e,t,r){this.m_tileKey=e,this.m_level=t,this.m_count=1<<(t<<1),this.m_mask=r,this.m_shift=t>2?t-2<<1:0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.m_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.m_level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileKey",{get:function(){return this.m_tileKey},enumerable:!0,configurable:!0}),e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.skip=function(e){if(-1!==this.m_mask)for(;e<this.m_count&&0==(this.m_mask&1<<(e>>this.m_shift));)++e;return e},e}();t.SubTiles=n,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_parent=e,this.m_index=e.skip(t)}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this.m_parent.tileKey,t=this.m_parent.level;return i.TileKey.fromRowColumnLevel(e.row<<t|this.m_index>>t,e.column<<t|this.m_index&(1<<t)-1,e.level+t)},enumerable:!0,configurable:!0}),e.prototype.next=function(){this.m_index=this.m_parent.skip(++this.m_index)},e}();e.Iterator=t}(n=t.SubTiles||(t.SubTiles={})),t.SubTiles=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=r(16),o=function(){function e(){}return e.geoCoordinatesToTileKey=function(e,t,r){var i=e.projection,o=e.subdivisionScheme,a=i.projectPoint(t),s=o.getLevelDimensionX(r),l=o.getLevelDimensionY(r),u=i.worldExtent(0,0),c=u.min,d=u.max,h=d.x-c.x,f=d.y-c.y;if(a.x<c.x||a.x>d.x)return null;if(a.y<c.y||a.y>d.y)return null;var p=Math.min(s-1,Math.floor(s*(a.x-c.x)/h)),m=Math.min(l-1,Math.floor(l*(a.y-c.y)/f));return n.TileKey.fromRowColumnLevel(m,p,r)},e.geoRectangleToTileKeys=function(t,r,o){var a=function(e,t,r){return e<t?r-(t-e)%(r-t):t+(e-t)%(r-t)},s=function(e,t,r){return Math.min(Math.max(e,t),r)},l=a(r.southWest.longitudeInRadians,-Math.PI,Math.PI),u=s(r.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=a(r.northEast.longitudeInRadians,-Math.PI,Math.PI),d=s(r.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=e.geoCoordinatesToTileKey(t,i.GeoCoordinates.fromRadians(u,l),o),f=e.geoCoordinatesToTileKey(t,i.GeoCoordinates.fromRadians(d,c),o),p=t.subdivisionScheme.getLevelDimensionX(o);if(!h||!f)throw new Error("Invalid coordinates");var m=h.column,v=f.column;l>c&&(v+=v!==m?p:p-1);for(var y=Math.min(h.row,f.row),g=Math.max(h.row,f.row),_=new Array,b=y;b<=g;++b)for(var x=m;x<=v;++x)_.push(n.TileKey.fromRowColumnLevel(b,x%p,o));return _},e}();t.TileKeyUtils=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(42),n=function(){function e(e){this.m_subdivisionScheme=e}return e.prototype.subTiles=function(e){for(var t=~(-1<<this.m_subdivisionScheme.getSubdivisionX(e.level)*this.m_subdivisionScheme.getSubdivisionY(e.level)),r=new i.SubTiles(e,1,t),n=r.iterator(),o=new Array,a=0;a<r.length;++a)o.push(n.value),n.next();return o},e}();t.TileTreeTraverse=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(87);t.MapRenderingManager=i.MapRenderingManager;var n=r(29);t.Pass=n.Pass;var o=r(51);t.MSAARenderPass=o.MSAARenderPass,t.MSAASampling=o.MSAASampling},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};var a=function(e){function r(r){return e.call(this,{name:"CopyMaterial",uniforms:r,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:o.NoBlending,depthTest:!1,depthWrite:!1})||this}return n(r,e),r}(o.ShaderMaterial);t.CopyMaterial=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(26),s=r(28),l="\nattribute vec2 position;\nattribute vec4 tangents;\nattribute vec2 segment;\nattribute vec2 angles;\nattribute vec2 texcoord;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float lineWidth;\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n#include <project_line_vert_func>\n\nvoid main() {\n    vLinewidth = lineWidth;\n    vSegment = segment;\n\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = position;\n    vec2 uvs = texcoord;\n    projectVertex(segment, normalize(tangents.xy), normalize(tangents.zw), lineWidth, pos, uvs);\n\n    vPosition = pos;\n    vTexcoord = vec2(uvs.x, uvs.y * lineWidth);\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 0.0, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",u="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 tileSize;\n#if DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\n#endif\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\n#include <join_dist_func>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n\n    float alpha = opacity;\n\n    #if TILE_CLIP\n    tileClip(vPosition, tileSize);\n    #endif\n\n    #if DASHED_LINE\n    float halfSegment = (dashSize + gapSize) / dashSize * 0.5;\n    float segmentDist = mod(vTexcoord.x, dashSize + gapSize) / dashSize;\n    float dist = 0.5 - distance(segmentDist, halfSegment);\n    float width = fwidth(dist);\n    alpha *= smoothstep(-width, width, dist);\n    #else\n    float dist = joinDist(vSegment, vTexcoord) - vLinewidth;\n    float width = fwidth(dist);\n    alpha *= (1.0 - smoothstep(-width, width, dist));\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( diffuse, alpha );\n    #endif\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",c=function(e){function t(r){var i=this;Object.assign(o.ShaderChunk,s.default),a.FadingFeature.patchGlobalShaderChunks();var n={DASHED_LINE:0,TILE_CLIP:0},c=void 0!==r&&!0===r.fog;c&&(n.USE_FOG="");var d={name:"SolidLineMaterial",vertexShader:l,fragmentShader:u,uniforms:o.UniformsUtils.merge([{diffuse:new o.Uniform(new o.Color(t.DEFAULT_COLOR)),lineWidth:new o.Uniform(t.DEFAULT_WIDTH),opacity:new o.Uniform(t.DEFAULT_OPACITY),tileSize:new o.Uniform(new o.Vector2),fadeNear:new o.Uniform(a.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new o.Uniform(a.FadingFeature.DEFAULT_FADE_FAR)},o.UniformsLib.fog]),defines:n,transparent:!0,fog:!0};return(i=e.call(this,d)||this).extensions.derivatives=!0,void 0!==r&&(void 0!==r.color&&i.color.set(r.color),void 0!==r.lineWidth&&(i.lineWidth=r.lineWidth),void 0!==r.opacity&&(i.opacity=r.opacity),void 0!==r.depthTest&&(i.depthTest=r.depthTest),void 0!==r.fadeNear&&(i.fadeNear=r.fadeNear),void 0!==r.fadeFar&&(i.fadeFar=r.fadeFar),i.fog=c),i}return n(t,e),t.prototype.updateFog=function(e){e?this.defines.USE_FOG="":delete this.defines.USE_FOG},Object.defineProperty(t.prototype,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){void 0!==this.uniforms&&(this.uniforms.opacity.value=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeNear",{get:function(){return this.uniforms.fadeNear.value},set:function(e){this.uniforms.fadeNear.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return this.uniforms.fadeFar.value},set:function(e){var t=this.uniforms.fadeFar.value;this.uniforms.fadeFar.value=e,void 0!==t&&t>0?this.defines.USE_FADING="":delete this.defines.USE_FADING},enumerable:!0,configurable:!0}),t.DEFAULT_COLOR=16711680,t.DEFAULT_WIDTH=1,t.DEFAULT_OPACITY=1,t}(o.RawShaderMaterial);t.SolidLineMaterial=c},function(e,t,r){"use strict";var i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a},n=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.error.apply(console,n([e],t))},e.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.debug.apply(console,n([e],t))},e.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.info.apply(console,n([e],t))},e.prototype.log=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.log.apply(console,n([e],t))},e.prototype.trace=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.trace.apply(console,n([e],t))},e.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.warn.apply(console,n([e],t))},e}();t.ConsoleChannel=o},function(e,t,r){"use strict";var i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a},n=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(27),a=function(){function e(e,t,r){this.name=e,this.m_channel=t,this.enabled=!0,this.level=o.LogLevel.Trace,void 0!==r&&this.update(r)}return e.prototype.error=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Error&&(t=this.m_channel).error.apply(t,n([this.prefix,e],r))},e.prototype.debug=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Debug&&(t=this.m_channel).debug.apply(t,n([this.prefix,e],r))},e.prototype.info=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Info&&(t=this.m_channel).info.apply(t,n([this.prefix,e],r))},e.prototype.log=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Log&&(t=this.m_channel).log.apply(t,n([this.prefix,e],r))},e.prototype.trace=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Trace&&(t=this.m_channel).trace.apply(t,n([this.prefix,e],r))},e.prototype.warn=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.enabled&&this.level<=o.LogLevel.Warn&&(t=this.m_channel).warn.apply(t,n([this.prefix,e],r))},e.prototype.update=function(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level},Object.defineProperty(e.prototype,"prefix",{get:function(){return this.name+":"},enumerable:!0,configurable:!0}),e}();t.Logger=a},function(e,t,r){"use strict";var i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a},n=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(27);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";var a=function(){function e(){}return e.prototype.error=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Error};self.postMessage(a)},e.prototype.debug=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Debug};self.postMessage(a)},e.prototype.info=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Info};self.postMessage(a)},e.prototype.log=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Log};self.postMessage(a)},e.prototype.trace=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Trace};self.postMessage(a)},e.prototype.warn=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a={message:n([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Warn};self.postMessage(a)},e}();t.WorkerChannel=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r(4),s=r(0),l=r(29);!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(o=t.MSAASampling||(t.MSAASampling={}));var u=function(e){function t(){var t=e.call(this)||this;return t.samplingLevel=o.Level_1,t.m_renderTarget=null,t.m_localCamera=new s.OrthographicCamera(-1,1,1,-1,0,1),t.m_quadScene=new s.Scene,t.m_quadUniforms=a.CopyShader.uniforms,t.m_quadMaterial=new a.MSAAMaterial(t.m_quadUniforms),t.m_quad=new s.Mesh(new s.PlaneBufferGeometry(2,2),t.m_quadMaterial),t.m_quad.frustumCulled=!1,t.m_quadScene.add(t.m_quad),t}return n(t,e),t.prototype.dispose=function(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)},t.prototype.render=function(e,r,i,n,o){if(this.enabled){null===this.m_renderTarget&&(this.m_renderTarget=new s.WebGLRenderTarget(o.width,o.height,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;var a=t.OffsetVectors[this.samplingLevel],l=e.getClearColor(),u=void 0!==l?l.getHex():0,c={enabled:null!==i.view&&i.view.enabled,fullWidth:o.width,fullHeight:o.height,x:0,y:0,width:o.width,height:o.height};c.enabled&&null!==i.view&&(c.fullWidth=i.view.fullWidth,c.fullHeight=i.view.fullHeight,c.x=i.view.offsetX,c.y=i.view.offsetY,c.width=i.view.width,c.height=i.view.height);for(var d=0;d<a.length;d++){var h=a[d];i.setViewOffset(c.fullWidth,c.fullHeight,c.x+h[0]/16,c.y+h[1]/16,c.width,c.height);var f=(d+.5)/a.length-.5,p=1/a.length+f/32;this.m_quadUniforms.opacity.value=p,e.render(r,i,this.m_renderTarget,!0),0===d&&e.setClearColor(0),e.render(this.m_quadScene,this.m_localCamera,this.renderToScreen?void 0:n,0===d),0===d&&void 0!==l&&e.setClearColor(u)}null!==i.view&&(i.view.enabled=c.enabled,i.view.offsetX=c.x,i.view.offsetY=c.y)}},t.prototype.setSize=function(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)},t.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],t}(l.Pass);t.MSAARenderPass=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),n=r(4),o=r(1),a=r(0),s=r(25),l=o.LoggerManager.instance.create("DecodedTileHelpers");function u(e){switch(e.name){case"extruded-line":return"standard"===e.shading?n.MapMeshStandardMaterial:n.MapMeshBasicMaterial;case"standard":case"standard-textured":case"landmark":case"extruded-polygon":return n.MapMeshStandardMaterial;case"solid-line":return n.SolidLineMaterial;case"dashed-line":return n.DashedLineMaterial;case"fill":return n.MapMeshBasicMaterial;case"squares":return a.PointsMaterial;case"circles":return n.CirclePointsMaterial;case"line":case"segments":return a.LineBasicMaterial;case"shader":return a.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":case"none":return}}function c(e,r,n,o){Object.getOwnPropertyNames(e).forEach(function(s){if(!(s.startsWith("_")||-1!==t.BASE_TECHNIQUE_NON_MATERIAL_PROPS.indexOf(s)||void 0!==o&&-1!==o.indexOf(s))){var l=s,u=r,c=e[l];void 0!==u[l]&&(void 0!==n&&i.isInterpolatedProperty(c)&&(c=i.getPropertyValue(c,n)),u[l]instanceof a.Color?u[l].set(c):u[l]=c)}})}t.createMaterial=function(e,t){var r=e.technique,o=u(r),s={};if(void 0!==o){o.prototype instanceof a.RawShaderMaterial&&o!==n.HighPrecisionLineMaterial&&(s.fog=e.fog);var d=new o(s);if(void 0!==r.id&&(d.name=r.id),i.isExtrudedPolygonTechnique(r)&&(d.flatShading=!0),d.depthTest=i.isExtrudedPolygonTechnique(r)&&!1!==r.depthTest,i.isStandardTexturedTechnique(r)&&void 0!==r.texture){var h=function(e){void 0!==r.wrapS&&(e.wrapS=i.toWrappingMode(r.wrapS)),void 0!==r.wrapT&&(e.wrapT=i.toWrappingMode(r.wrapT)),void 0!==r.flipY&&(e.flipY=r.flipY),d.map=e,e.needsUpdate=!0,d.needsUpdate=!0,t&&t()},f=function(e){l.error("#createMaterial: Failed to load texture: ",e)},p=void 0;if("string"==typeof r.texture)p=r.texture;else if(i.isTextureBuffer(r.texture))if("image/raw"===r.texture.type){var m=r.texture.dataTextureProperties;if(void 0!==m){var v=new a.DataTexture(r.texture.buffer,m.width,m.height,m.format?i.toPixelFormat(m.format):void 0,m.type?i.toTextureDataType(m.type):void 0);v.magFilter=a.LinearFilter,v.minFilter=a.LinearFilter,h(v)}else f("no data texture properties provided.")}else{var y=new Blob([r.texture.buffer],{type:r.texture.type});p=URL.createObjectURL(y)}p&&(new a.TextureLoader).load(p,h,void 0,f)}if(i.isShaderTechnique(r)){var g=r.params;Object.getOwnPropertyNames(g).forEach(function(e){var t=e;if("name"!==t){var r=d;r[t]instanceof a.Color?r[t].set(g[t]):r[t]=g[t]}})}else c(r,d,e.level,e.skipExtraProps);return d}},t.getBufferAttribute=function(e){switch(e.type){case"float":return new a.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint16":return new a.BufferAttribute(new Uint16Array(e.buffer),e.itemCount);case"uint32":return new a.BufferAttribute(new Uint32Array(e.buffer),e.itemCount);default:throw new Error("unsupported buffer of type "+e.type)}},t.getObjectConstructor=function(e){switch(e.name){case"extruded-line":case"standard":case"standard-textured":case"landmark":case"extruded-polygon":case"fill":case"solid-line":case"dashed-line":return a.Mesh;case"circles":return s.Circles;case"squares":return s.Squares;case"line":case"segments":return a.LineSegments;case"shader":switch(e.primitive){case"line":return a.Line;case"segments":return a.LineSegments;case"point":return a.Points;case"mesh":return a.Mesh;default:return}case"text":case"labeled-icon":case"line-marker":case"none":return}},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","renderOrderBiasProperty","renderOrderBiasGroup","renderOrderBiasRange","transient"],t.getMaterialConstructor=u,t.applyTechniqueToMaterial=c},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(0);!function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isDashedLineTechnique=function(e){return"dashed-line"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=function(e){return"extruded-line"===e.name},t.isFillTechnique=function(e){return"fill"===e.name},t.isExtrudedPolygonTechnique=function(e){return"extruded-polygon"===e.name},t.isStandardTechnique=function(e){return"standard"===e.name},t.isStandardTexturedTechnique=function(e){return"standard-textured"===e.name},t.isLandmarkTechnique=function(e){return"landmark"===e.name},t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type};var a=[o.DiscreteInterpolant,o.LinearInterpolant,o.CubicInterpolant];function s(e){return void 0!==e&&void 0!==e.interpolationMode&&void 0!==e.zoomLevels&&void 0!==e.values&&e.values.length>0&&(e.zoomLevels.length===e.values.length/3||e.zoomLevels.length===e.values.length)}!function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic"}(t.InterpolationMode||(t.InterpolationMode={})),t.isInterpolatedProperty=s,t.getPropertyValue=function(e,t){var r,o;if(s(e)){var l=e.values.length/e.zoomLevels.length,u=l>1,c=new a[e.interpolationMode](e.zoomLevels,e.values,l);c.evaluate(t);var d=u?"#":0;try{for(var h=i(c.resultBuffer),f=h.next();!f.done;f=h.next()){var p=f.value;d+=u?("0"+(255*n.MathUtils.clamp(p,0,1)|0).toString(16)).slice(-2):p}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return d}return e},t.toPixelFormat=function(e){if("Alpha"===e)return o.AlphaFormat;if("RGB"===e)return o.RGBFormat;if("RGBA"===e)return o.RGBAFormat;if("Luminance"===e)return o.LuminanceFormat;if("LuminanceAlpha"===e)return o.LuminanceAlphaFormat;if("RGBE"===e)return o.RGBEFormat;if("Depth"===e)return o.DepthFormat;if("DepthStencil"===e)return o.DepthStencilFormat;throw new Error("invalid pixel format: "+e)},t.toTextureDataType=function(e){if("UnsignedByte"===e)return o.UnsignedByteType;if("Byte"===e)return o.ByteType;if("Short"===e)return o.ShortType;if("UnsignedShort"===e)return o.UnsignedShortType;if("Int"===e)return o.IntType;if("UnsignedInt"===e)return o.UnsignedIntType;if("Float"===e)return o.FloatType;if("HalfFloat"===e)return o.HalfFloatType;throw new Error("invalid texture data type: "+e)},t.toWrappingMode=function(e){if("clamp"===e)return o.ClampToEdgeWrapping;if("repeat"===e)return o.RepeatWrapping;if("mirror"===e)return o.MirroredRepeatWrapping;throw new Error("invalid wrapping: "+e)}},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(0),a=n.LoggerManager.instance.create("ImageCache"),s=(function(){}(),function(){function e(){this.m_images=new Map}return Object.defineProperty(e,"instance",{get:function(){return void 0===e.m_instance&&(e.m_instance=new e),e.m_instance},enumerable:!0,configurable:!0}),e.dispose=function(){e.m_instance=void 0},e.prototype.registerImage=function(e,t,r){var i=this.findImageCacheItem(t);if(void 0!==i)return void 0!==e&&i.mapViews.indexOf(e)<0&&i.mapViews.push(e),i.imageItem;if(void 0!==(i=this.findImageCacheItem(t)))return void 0!==e&&i.mapViews.indexOf(e)<0&&i.mapViews.push(e),i.imageItem;var n=[];return void 0!==e&&n.push(e),i={imageItem:{url:t,imageData:r,loaded:!1},mapViews:n},this.m_images.set(t,i),i.imageItem},e.prototype.addImage=function(e,t,r){void 0===r&&(r=!0);var i=this.registerImage(e,t,void 0);return void 0!==i&&!0===r?this.loadImage(i):i},e.prototype.findImage=function(e){var t=this.m_images.get(e);if(void 0!==t)return t.imageItem},e.prototype.clear=function(e){var t,r,n=[];this.m_images.forEach(function(t){var r=t.mapViews.indexOf(e);r>=0&&t.mapViews.splice(r,1),0===t.mapViews.length&&n.push(t.imageItem.url)});try{for(var o=i(n),a=o.next();!a.done;a=o.next()){var s=a.value;this.m_images.delete(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.clearAll=function(){this.m_images=new Map},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_images.size},enumerable:!0,configurable:!0}),e.prototype.loadImage=function(e){var t=this;if(void 0!==e.imageData)return e;if(void 0!==e.loadingPromise)return e.loadingPromise;var r=new o.ImageLoader;return e.loadingPromise=new Promise(function(i){a.log("Loading image: "+e.url),r.load(e.url,function(r){a.log("... finished loading image: "+e.url),t.renderImage(e,r).then(function(){e.loadingPromise=void 0,i(e)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),i(void 0)})},void 0,function(t){a.error("... loading image failed: "+e.url+" : "+t),e.loadingPromise=void 0,i(void 0)})}),e.loadingPromise},e.prototype.findImageCacheItem=function(e){return this.m_images.get(e)},e.prototype.renderImage=function(e,t){return new Promise(function(r,i){if("function"==typeof createImageBitmap){a.log("Creating bitmap image: "+e.url),createImageBitmap(t,0,0,t.width,t.height,{premultiplyAlpha:"default",imageOrientation:"flipY"}).then(function(t){a.log("... finished creating bitmap image: "+e.url),e.loadingPromise=void 0,e.imageData=t,e.loaded=!0,r(t)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),r(void 0)})}else try{"undefined"==typeof document&&(a.error("Error: document is not available, cannot generate image"),i(new Error("ImageCache#renderImage: document is not available, cannot render image to create texture")));var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var o=n.getContext("2d");if(null!==o){a.log("... finished creating bitmap image in canvas: "+e.url+" "+t),o.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height);var s=o.getImageData(0,0,t.width,t.height);e.imageData=s,e.loaded=!0,r(s)}else a.error("renderImage: no context found"),i(new Error("ImageCache#renderImage: no context found"))}catch(t){a.error("renderImage failed: "+t),e.imageData=void 0,e.loaded=!0,i(new Error("ImageCache#renderImage failed: "+t))}})},e}());t.ImageCache=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(54),n=function(){function e(e){this.mapView=e,this.m_name2Url=new Map,this.m_url2Name=new Map}return e.prototype.registerImage=function(e,t,r){if(void 0!==e){if(this.hasName(e))throw new Error("duplicate name in cache");var n=this.m_url2Name.get(t);void 0!==n?n.indexOf(e)<0&&n.push(e):this.m_url2Name.set(t,[e]),this.m_name2Url.set(e,t)}var o=i.ImageCache.instance.findImage(t);return void 0===o?i.ImageCache.instance.registerImage(this.mapView,t,r):o},e.prototype.addImage=function(e,t,r){void 0===r&&(r=!0);var n=this.registerImage(e,t,void 0);return!0===r?i.ImageCache.instance.loadImage(n):n},e.prototype.findImageByName=function(e){var t=this.m_name2Url.get(e);if(void 0!==t)return i.ImageCache.instance.findImage(t)},e.prototype.findImageByUrl=function(e){return i.ImageCache.instance.findImage(e)},e.prototype.loadImage=function(e){return i.ImageCache.instance.loadImage(e)},e.prototype.clear=function(){i.ImageCache.instance.clear(this.mapView),this.m_name2Url=new Map,this.m_url2Name=new Map},Object.defineProperty(e.prototype,"numberOfNames",{get:function(){return this.m_name2Url.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfUrls",{get:function(){return this.m_url2Name.size},enumerable:!0,configurable:!0}),e.prototype.hasName=function(e){return void 0!==this.m_name2Url.get(e)},e.prototype.hasUrl=function(e){return void 0!==this.m_url2Name.get(e)},e.prototype.findNames=function(e){return this.m_url2Name.get(e)},e}();t.MapViewImageCache=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(122))},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0);Object.assign(o.ShaderChunk,{sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 sample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(sample.r, sample.g, sample.b);\n            #else\n            return sample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "});var a="\n    attribute vec4 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",s="\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",l="\n    attribute vec4 position;\n    attribute vec3 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.w);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",u="\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 sample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy);\n        else sample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = sample;\n    }",c="\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",d="\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",h=function(e){function t(){var t={name:"GlyphClearMaterial",vertexShader:a,fragmentShader:s,uniforms:{},depthTest:!1,depthWrite:!1};return e.call(this,t)||this}return n(t,e),t}(o.RawShaderMaterial);t.GlyphClearMaterial=h;var f=function(e){function t(){var t={name:"GlyphCopyMaterial",vertexShader:l,fragmentShader:u,uniforms:{pageOffset:new o.Uniform(0),page0:new o.Uniform(o.Texture.DEFAULT_IMAGE),page1:new o.Uniform(o.Texture.DEFAULT_IMAGE),page2:new o.Uniform(o.Texture.DEFAULT_IMAGE),page3:new o.Uniform(o.Texture.DEFAULT_IMAGE),page4:new o.Uniform(o.Texture.DEFAULT_IMAGE),page5:new o.Uniform(o.Texture.DEFAULT_IMAGE),page6:new o.Uniform(o.Texture.DEFAULT_IMAGE),page7:new o.Uniform(o.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1};return e.call(this,t)||this}return n(t,e),t}(o.RawShaderMaterial);t.GlyphCopyMaterial=f;var p=function(e){function t(t){var r=this,i={name:"SdfTextMaterial",vertexShader:void 0!==t.vertexSource?t.vertexSource:c,fragmentShader:void 0!==t.fragmentSource?t.fragmentSource:d,uniforms:{sdfTexture:new o.Uniform(t.texture),sdfParams:new o.Uniform(new o.Vector4(t.textureSize.x,t.textureSize.y,t.size,t.distanceRange))},defines:{MSDF:t.isMsdf?1:0,BG_TEXT:t.isBackground?1:0},depthTest:!0,depthWrite:!0,side:o.DoubleSide,transparent:!0};return(r=e.call(this,i)||this).extensions.derivatives=!0,r}return n(t,e),t}(o.RawShaderMaterial);t.SdfTextMaterial=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,r,i,n,o,a){this.text=e,this.glyphs=t,this.buffer=r,this.bounds=o,this.characterBounds=a,this.textRenderStyle=i.clone(),this.textLayoutStyle=n.clone()}}();t.TextBufferObject=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(57);t.createSdfTextMaterial=function(e){return new i.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource})}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a="undefined"==typeof window,s=function(e){function t(t){var r=e.call(this)||this;return r.value=t,r}return n(t,e),t.prototype.set=function(e,r){this.value=e,this.dispatchEvent({type:t.SET_EVENT_TYPE,name:r,value:e})},t.SET_EVENT_TYPE="set",t}(o.EventDispatcher),l=function(){function e(){(this.m_optionsMap=new Map,!a&&"undefined"!=typeof window&&window)&&(window.__debugContext=this)}return e.prototype.setValue=function(e,t){var r=this.m_optionsMap.get(e);r?r.set(t,e):(r=new s(t),this.m_optionsMap.set(e,r))},e.prototype.getValue=function(e){var t=this.m_optionsMap.get(e);return t?t.value:void 0},e.prototype.hasOption=function(e){return void 0!==this.m_optionsMap.get(e)},e.prototype.addEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(!r)throw Error("Unknown option: "+e);r.addEventListener(s.SET_EVENT_TYPE,t)},e.prototype.hasEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(r)return r.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)},e.prototype.removeEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(!r)throw Error("Unknown option: "+e);r.removeEventListener(s.SET_EVENT_TYPE,t)},Object.defineProperty(e.prototype,"options",{get:function(){return this.m_optionsMap},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_optionsMap.forEach(function(e){e.set(void 0,"")})},e}();t.DebugContext=l,t.debugContext=new l},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(4),a=r(1),s=r(21),l=a.LoggerManager.instance.create("RoadPicker"),u=function(){function e(e){this.m_mapView=e}return e.prototype.registerTile=function(e){if(a.assert(void 0!==e.decodedTile),void 0!==e.decodedTile&&void 0!==e.decodedTile.tileInfo){var t=e.decodedTile.tileInfo,r=t.lineGroup;if(void 0!==r&&0!==r.numFeatures){var i=[];i.length=r.numFeatures;for(var n=e.tileKey.level,o=0;o<r.numFeatures;o++){var s=t.techniqueCatalog[r.techniqueIndex[o]],l=this.getLineWidthInWorldUnit(s,n);i[o]=void 0!==l?Math.max(1,l):1}var u=t.lineGroup.userData;return{ids:r.featureIds,techniqueIndex:r.techniqueIndex,starts:r.positionIndex,widths:i,positions:r.positions,techniques:t.techniqueCatalog,objInfos:u}}}},e.prototype.intersectRoads=function(e,t,r,i){if(e.boundingBox.distanceToPoint(r)>.01)return!1;var n=e.roadIntersectionData;if(void 0===n)return!1;var o=n.ids,u=n.techniques,c=n.techniqueIndex,d=o.length,h=n.positions,f=n.widths,p=r.x-e.center.x,m=r.y-e.center.y,v=r.distanceTo(t);if(f.length!==o.length||o.length!==c.length||c.length!==n.starts.length)return l.error("The amount of widths, ids, techniqueIndices and starts has to be the same"),!1;for(var y=0;y<d;y++){var g=u[c[y]];if(!0!==g.transient){for(var _=n.starts[y],b=y<d-1?n.starts[y+1]:n.positions.length,x=h[_],w=h[_+1],S=f[y]*f[y],T=Number.MAX_VALUE,C=_+2;C<b;C+=2){var P=h[C],E=h[C+1],M=a.Math2D.distToSegmentSquared(p,m,x,w,P,E);M<S&&M<T&&(T=M),x=P,w=E}if(T<Number.MAX_VALUE){var O={type:s.PickObjectType.Line,point:r,distance:v,distFromCenter:Math.sqrt(T),featureId:o[y],positions:h.slice(_,b),technique:g};this.addUserData(O,y,n.objInfos),i.push(O)}}}return!1},e.prototype.addUserData=function(e,t,r){void 0!==r&&r.length>0&&(e.userData=i({},r[t]))},e.prototype.getLineWidthInWorldUnit=function(e,t){var r=e;if("Pixel"===n.getPropertyValue(r.metricUnit,t)){var i=this.m_mapView.renderer.getPixelRatio()*this.m_mapView.pixelToWorld*.5,a=n.getPropertyValue(r.lineWidth,t);return(void 0!==a?a:o.SolidLineMaterial.DEFAULT_WIDTH)*i}var s=e;return n.getPropertyValue(s.lineWidth,t)},e}();t.RoadPicker=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TopLeft=0]="TopLeft",e[e.BottomLeft=1]="BottomLeft"}(t.ImageOrigin||(t.ImageOrigin={}));var i=function(){return function(e){this.image=e}}();t.IconTexture=i},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=r(11),s=r(1),l=r(0),u=r(8),c=r(18),d=r(20),h=r(13),f=s.LoggerManager.instance.create("PoiManager"),p=function(){function e(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map,this.m_colorMap=new Map}return e.prototype.addPois=function(e,t){var r,i,a=s.assertExists(t.poiGeometries);try{for(var u=n(a),c=u.next();!c.done;c=u.next()){var d=c.value;s.assert(void 0!==d.technique);var h=s.assertExists(d.technique),f=t.techniques[h];if(("line-marker"===f.name||"labeled-icon"===f.name)&&!1!==f.showOnMap){var p=new l.BufferAttribute(new Float32Array(d.positions.buffer),d.positions.itemCount);if(o.isLineMarkerTechnique(f)&&p.count>0)this.addLineMarker(e,d,f,h,p);else{var m=f,v=m.imageTexture;if(void 0===d.stringCatalog)continue;for(var y=m.poiTable,g=m.poiName,_=0;_<p.count;++_){var b=p.getX(_),x=p.getY(_);s.assert(d.texts.length>_);var w=d.stringCatalog[d.texts[_]];void 0===w&&(w=""),void 0!==d.stringCatalog&&(void 0!==d.imageTextures&&d.imageTextures[_]>=0?(s.assert(d.imageTextures.length>_),v=d.stringCatalog[d.imageTextures[_]]):v=m.imageTexture,void 0!==y&&(g=void 0===m.poiName?v:m.poiName,v=void 0));var S=this.checkCreateTextElement(e,w,f,h,v,y,g,0,d.featureId,b,x,e.tileKey.level);void 0!==S&&e.addTextElement(S)}}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}},e.prototype.addTextureAtlas=function(e,t){var r=this;fetch(t).then(function(e){if(!e.ok)throw new Error("addTextureAtlas: Cannot load textureAtlas: "+e.statusText);return e.json()}).then(function(i){var o,a;if(void 0!==i){try{f.log("addTextureAtlas: Loading textureAtlas '"+t+"' for image '"+e+"'");try{for(var s=n(Object.getOwnPropertyNames(i)),l=s.next();!l.done;l=s.next()){var u=l.value,c=i[u],d={name:u,image:e,xOffset:c.x,yOffset:c.y,width:c.width,height:c.height};r.addImageTexture(d)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}}catch(e){f.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)}r.mapView.update()}else f.info("addTextureAtlas: TextureAtlas empty: "+t)}).catch(function(e){f.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)})},e.prototype.addImageTexture=function(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&f.warn("addImageTexture: Name already used: "+e.name+" (overriding it)"),this.m_imageTextures.set(e.name,e)):f.error("addImageTexture: Name required",e)},e.prototype.getImageTexture=function(e){return this.m_imageTextures.get(e)},e.prototype.updatePoiFromPoiTable=function(t){var r=t.poiInfo;if(void 0===r||void 0===r.poiTableName||void 0===r.poiName)return!0;var i=r.poiTableName,n=this.mapView.poiTableManager.getPoiTable(i);if(void 0!==n&&n.isLoading)return!1;if(void 0===n||!n.loadedOk)return void 0===i&&(i="undefined"),void 0===e.m_missingPoiTableName.get(i)&&(e.m_missingPoiTableName.set(i,!0),void 0===n||n.loadedOk?f.error("updatePoiFromPoiTable: No POI table with name '"+i+"' found."):f.error("Error loading POI table name "+i)),!0;var o=r.poiName,a=n.poiDict.get(o);return void 0===a?(void 0===o&&(o="undefined"),void 0===e.m_missingPoiName.get(o)&&(e.m_missingPoiName.set(o,!0),f.warn("Cannot find POI info '"+o+"' found in table "+i+".")),!0):(void 0!==a.iconName&&(r.imageTextureName=a.iconName),t.visible=void 0!==a.visible?a.visible:t.visible,t.priority=void 0!==a.priority?a.priority:t.priority,r.iconMinZoomLevel=void 0!==a.iconMinLevel?a.iconMinLevel:r.iconMinZoomLevel,r.iconMaxZoomLevel=void 0!==a.iconMaxLevel?a.iconMaxLevel:r.iconMaxZoomLevel,r.textMinZoomLevel=void 0!==a.textMinLevel?a.textMinLevel:r.textMinZoomLevel,r.textMaxZoomLevel=void 0!==a.textMaxLevel?a.textMaxLevel:r.textMaxZoomLevel,t.updateMinMaxZoomLevelsFromPoiInfo(),!0)},e.prototype.clear=function(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()},e.prototype.addLineMarker=function(e,t,r,i,n){var o,a=r.imageTexture;void 0!==t.stringCatalog&&void 0!==t.imageTextures&&(a=t.stringCatalog[t.imageTextures[0]],o=t.stringCatalog[t.texts[0]]),void 0===o&&(o="");var s=String(a)+"-"+o,u=this.m_poiShieldGroups.get(s);void 0===u&&(u=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(s,u));for(var c=[],d=0;d<n.count;d+=2)c.push(new l.Vector2(n.getX(d),n.getY(d)));var h=this.checkCreateTextElement(e,o,r,i,a,void 0,void 0,u,t.featureId,c,void 0,e.tileKey.level);void 0!==h&&(h.ignoreDistance=!0,e.addTextElement(h))},e.prototype.checkCreateTextElement=function(e,t,r,i,n,s,u,h,f,p,m,v){var y;if(void 0===t&&(t=""),void 0!==t){var g=void 0!==r.priority?r.priority:0,_=Array.isArray(p)?p:new l.Vector2(p,m),b=this.mapView.zoomLevel;(y=new c.TextElement(a.ContextualArabicConverter.instance.convert(t),_,this.getRenderStyle(e.dataSource.name,r,i),this.getLayoutStyle(e.dataSource.name,r),g,void 0!==r.xOffset?r.xOffset:0,void 0!==r.yOffset?r.yOffset:0,f,r.style,o.getPropertyValue(r.fadeNear,b),o.getPropertyValue(r.fadeFar,b))).mayOverlap=!0===r.textMayOverlap,y.reserveSpace=!1!==r.textReserveSpace,y.alwaysOnTop=!0===r.alwaysOnTop;var x=!0===r.textIsOptional,w=!1!==r.iconIsOptional,S=!(!1===r.renderTextDuringMovements),T=void 0===r.iconMayOverlap?y.textMayOverlap:!0===r.iconMayOverlap,C=void 0===r.iconReserveSpace?y.textReservesSpace:!1!==r.iconReserveSpace,P=void 0!==r.distanceScale?r.distanceScale:d.DEFAULT_TEXT_DISTANCE_SCALE;void 0===n&&void 0!==s&&(n=""),void 0!==n?(y.poiInfo={technique:r,imageTextureName:n,poiTableName:s,poiName:u,shieldGroupIndex:h,textElement:y,textIsOptional:x,iconIsOptional:w,renderTextDuringMovements:S,mayOverlap:T,reserveSpace:C,featureId:f,iconMinZoomLevel:r.iconMinZoomLevel,iconMaxZoomLevel:r.iconMaxZoomLevel,textMinZoomLevel:r.textMinZoomLevel,textMaxZoomLevel:r.textMaxZoomLevel},y.updateMinMaxZoomLevelsFromPoiInfo()):(void 0===y.minZoomLevel&&(y.minZoomLevel=r.textMinZoomLevel),void 0===y.maxZoomLevel&&(y.maxZoomLevel=r.textMaxZoomLevel)),y.distanceScale=P}return y},e.prototype.getRenderStyle=function(e,t,r){var n=h.computeStyleCacheId(e,t,this.mapView.zoomLevel),l=this.mapView.textRenderStyleCache.get(n);if(void 0===l){var c=this.mapView.textElementsRenderer.defaultStyle.renderParams,d=s.getOptionValue(o.getPropertyValue(t.size,Math.floor(this.mapView.zoomLevel)),c.fontSize.size),f=s.getOptionValue(o.getPropertyValue(t.backgroundSize,Math.floor(this.mapView.zoomLevel)),c.fontSize.backgroundSize),p=o.getPropertyValue(t.color,Math.floor(this.mapView.zoomLevel));void 0!==p&&this.m_colorMap.set(n,u.ColorCache.instance.getColor(p));var m=s.getOptionValue(this.m_colorMap.get(n),c.color),v=o.getPropertyValue(t.backgroundColor,Math.floor(this.mapView.zoomLevel));void 0!==v&&this.m_colorMap.set(n+"_bg",u.ColorCache.instance.getColor(v));var y=s.getOptionValue(this.m_colorMap.get(n+"_bg"),c.backgroundColor),g=s.getOptionValue(o.getPropertyValue(t.backgroundAlpha,Math.floor(this.mapView.zoomLevel)),c.backgroundOpacity),_=!0===t.smallCaps||c.fontVariant===a.FontVariant.SmallCaps,b=!0===t.allCaps||c.fontVariant===a.FontVariant.AllCaps,x=_?a.FontVariant.SmallCaps:b?a.FontVariant.AllCaps:void 0,w=!0===t.bold?t.oblique?a.FontStyle.BoldItalic:a.FontStyle.Bold:!0===t.oblique?a.FontStyle.Italic:c.fontStyle,S={fontSize:{unit:a.FontUnit.Pixel,size:d,backgroundSize:f},color:m,backgroundColor:y,backgroundOpacity:g,fontVariant:x,fontStyle:w},T=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.getTextElementStyle(t.style).renderParams:{};l=new a.TextRenderStyle(i({},T,S)),this.mapView.textRenderStyleCache.set(n,l)}return l},e.prototype.getLayoutStyle=function(e,t){var r=h.computeStyleCacheId(e,t,this.mapView.zoomLevel),n=this.mapView.textLayoutStyleCache.get(r);if(void 0===n){var o=this.mapView.textElementsRenderer.defaultStyle.layoutParams,l=s.getOptionValue(t.tracking,o.tracking),u=o.horizontalAlignment;"Left"!==t.hAlignment&&"Center"!==t.hAlignment&&"Right"!==t.hAlignment||(u=a.HorizontalAlignment[t.hAlignment]);var c=o.verticalAlignment;"Above"!==t.vAlignment&&"Center"!==t.vAlignment&&"Below"!==t.vAlignment||(c=a.VerticalAlignment[t.vAlignment]);var d={tracking:l,horizontalAlignment:u,verticalAlignment:c},f=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.getTextElementStyle(t.style).layoutParams:{};n=new a.TextLayoutStyle(i({},f,d)),this.mapView.textLayoutStyleCache.set(r,n)}return n},e.m_missingPoiTableName=new Map,e.m_missingPoiName=new Map,e}();t.PoiManager=p},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),s=r(1),l=s.LoggerManager.instance.create("PoiTable"),u=function(){function e(){}return e.verifyJSON=function(e){var t="string"==typeof e.name&&e.name.length>0&&(void 0===e.altNames||Array.isArray(e.altNames))&&(void 0===e.stackMode||"yes"===e.stackMode||"no"===e.stackMode||"parent"===e.stackMode)&&(void 0===e.visible||"boolean"==typeof e.visible)&&(void 0===e.priority||"number"==typeof e.priority)&&(void 0===e.iconMinLevel||"number"==typeof e.iconMinLevel)&&(void 0===e.iconMaxLevel||"number"==typeof e.iconMaxLevel)&&(void 0===e.textMinLevel||"number"==typeof e.textMinLevel)&&(void 0===e.textMaxLevel||"number"==typeof e.textMaxLevel);if(t&&void 0!==e.altNames){var r=e.altNames;for(var i in r)if("string"!=typeof i){t=!1;break}}return t},e.prototype.setup=function(e){switch(this.name=e.name,this.altNames=e.altNames,this.iconName=void 0!==e.iconName?e.iconName:"<undefined>",this.visible=e.visible,this.priority=e.priority,this.iconMinLevel=e.iconMinLevel,this.iconMaxLevel=e.iconMaxLevel,this.textMinLevel=e.textMinLevel,this.textMaxLevel=e.textMaxLevel,e.stackMode){case"yes":this.stackMode=a.PoiStackMode.Show;break;case"no":this.stackMode=a.PoiStackMode.Hide;break;case"parent":this.stackMode=a.PoiStackMode.ShowParent}},e}(),c=function(){function e(e,t){this.name=e,this.useAltNamesForKey=t,this.poiList=new Array,this.poiDict=new Map,this.m_isLoading=!1,this.m_loadedOk=void 0}return Object.defineProperty(e.prototype,"isLoading",{get:function(){return this.m_isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadedOk",{get:function(){return!0===this.m_loadedOk},enumerable:!0,configurable:!0}),e.prototype.load=function(e){return i(this,void 0,void 0,function(){var t,r,i,a,s,c,d,h,f,p,m,v,y;return n(this,function(n){switch(n.label){case 0:return void 0!==this.m_loadedOk?[2,!0]:(this.m_loadedOk=!1,[4,fetch(e)]);case 1:if(!(s=n.sent()).ok)throw new Error("load: Cannot load POI table at "+e+": "+s.statusText);return[4,s.json()];case 2:if(void 0===(c=n.sent()))return l.info("load: TextureAtlas empty: "+e),[2,!0];this.startLoading();try{if(l.log("load: Loading POI table '"+e+"' for table '"+this.name+"'"),void 0!==c.poiList&&Array.isArray(c.poiList))try{for(d=o(c.poiList),h=d.next();!h.done;h=d.next())if(f=h.value,u.verifyJSON(f))if((p=new u).setup(f),this.poiList.push(p),this.useAltNamesForKey)if(void 0!==p.altNames&&p.altNames.length>0)try{for(m=o(p.altNames),v=m.next();!v.done;v=m.next())y=v.value,this.poiDict.set(y,p)}catch(e){i={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}else l.warn("load: Invalid entry in POI table '"+e+"' : No alternative names set in entry: "+f+".");else void 0===p.name?l.warn("load: Invalid entry in POI table '"+e+"' : . No name set in entry: "+f+"."):this.poiDict.set(p.name,p);else l.warn("load: Invalid entry in POI table '"+e+"' : "+f)}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}this.m_loadedOk=!0,this.finishedLoading()}catch(t){return l.error("load: Failed to load POI table '"+e+"' : "+t),this.m_loadedOk=!1,this.finishedLoading(),[2,!1]}return[2,!0]}})})},e.prototype.startLoading=function(){this.m_isLoading=!0},e.prototype.finishedLoading=function(){this.m_isLoading=!1},e}();t.PoiTable=c;var d=function(){function e(e){this.mapView=e,this.m_isLoading=!1,this.m_poiTables=new Map}return e.prototype.loadPoiTables=function(e){return i(this,void 0,void 0,function(){var t=this;return n(this,function(r){return[2,new Promise(function(r){if(t.clear(),void 0!==e.poiTables){t.startLoading();var i=new Array,n=e.url,o=void 0===n?void 0:s.composeUrlResolvers(function(e){return s.resolveReferenceUrl(n,e)},s.defaultUrlResolver);e.poiTables.forEach(function(e){if(void 0!==e&&void 0!==e.name&&"string"==typeof e.name){var r=new c(e.name,!1!==e.useAltNamesForKey);if(void 0!==e.url&&"string"==typeof e.url){t.addTable(r);var n=void 0===o?e.url:o(e.url);i.push(r.load(n))}else l.error("POI table definition has no valid url: "+e)}else l.error("POI table definition has no valid name: "+e)}),i.length>0?Promise.all(i).then(function(){t.finishLoading(),r()}):(t.finishLoading(),r())}else t.finishLoading(),r()})]})})},e.prototype.clear=function(){this.m_poiTables=new Map},Object.defineProperty(e.prototype,"poiTables",{get:function(){return this.m_poiTables},enumerable:!0,configurable:!0}),e.prototype.addTable=function(e){this.m_poiTables.set(e.name,e)},e.prototype.getPoiTable=function(e){return void 0===e?void 0:this.m_poiTables.get(e)},Object.defineProperty(e.prototype,"finishedLoading",{get:function(){return!this.m_isLoading},enumerable:!0,configurable:!0}),e.prototype.startLoading=function(){this.m_isLoading=!0},e.prototype.finishLoading=function(){this.m_isLoading=!1},e}();t.PoiTableManager=d},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var s,l=r(2),u=r(3),c=r(1),d=r(0),h=r(37),f=r(45),p=r(66),m=r(33),v=r(55),y=r(69),g=r(21),_=r(63),b=r(64),x=r(133),w=r(137),S=r(138),T=r(35),C=r(20),P=r(13),E=r(70),M=r(14),O=r(140),A=!0;!function(e){e.Update="update",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored"}(s=t.MapViewEventNames||(t.MapViewEventNames={}));var L=c.LoggerManager.instance.create("MapView"),R="./resources/fonts/Default_FontCatalog.json",I=15722977,F=new d.Vector3(0,0,-1),D={type:"dynamic",fov:40},k=140,V=10,j=1,U=20,z=20,B={type:s.Render},N={type:s.AfterRender},G={type:s.FirstFrame},W={type:s.FrameComplete},q={type:s.ThemeLoaded},H={type:s.AnimationStarted},X={type:s.AnimationFinished},Y={type:s.MovementStarted},Z={type:s.MovementFinished},Q={type:s.ContextLost},K={type:s.ContextRestored},J={type:s.CopyrightChanged};t.MapViewDefaults={projection:u.mercatorProjection,maxVisibleDataSourceTiles:20,extendedFrustumCulling:!0,tileCacheSize:40,tileCacheMemorySize:419430400,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1};var $=function(e){function r(r){var i=e.call(this)||this;i.defaultFontCatalog=R,i.m_zoomLevelBias=1,i.m_screenProjector=new w.ScreenProjector,i.m_screenCollisions=new x.ScreenCollisions,i.m_visibleTileSetLock=!1,i.m_zoomLevel=j,i.m_minZoomLevel=j,i.m_maxZoomLevel=U,i.m_minCameraHeight=z,i.m_screenCamera=new d.OrthographicCamera(-1,1,1,-1),i.m_tempVector3=new d.Vector3,i.m_scene=new d.Scene,i.m_fog=new y.MapViewFog(i.m_scene),i.m_worldCenter=new d.Vector3,i.m_mapTilesRoot=new d.Object3D,i.m_animationCount=0,i.m_drawing=!1,i.m_updatePending=!1,i.m_frameNumber=0,i.m_textRenderStyleCache=new P.TextRenderStyleCache,i.m_textLayoutStyleCache=new P.TextLayoutStyleCache,i.m_overlayTextElements=[],i.m_forceCameraAspect=void 0,i.m_tileDataSources=[],i.m_connectedDataSources=new Set,i.m_raycaster=new d.Raycaster,i.m_plane=new d.Plane(new d.Vector3(0,0,1)),i.m_theme={styles:{}},i.m_firstFrameRendered=!1,i.m_firstFrameComplete=!1,i.m_imageCache=new v.MapViewImageCache(i),i.m_poiManager=new _.PoiManager(i),i.m_poiTableManager=new b.PoiTableManager(i),i.m_lastTileIds="",i.m_copyrightInfo=[],i.onWebGLContextLost=function(e){i.dispatchEvent(Q),L.log("WebGL context lost",e)},i.onWebGLContextRestored=function(e){i.dispatchEvent(K),void 0!==i.m_theme&&void 0!==i.m_theme.clearColor?i.m_renderer.setClearColor(new d.Color(i.m_theme.clearColor)):i.m_renderer.setClearColor(I),i.update(),L.log("WebGL context restored",e)},i.m_options=o({},r),void 0!==i.m_options.minZoomLevel&&(i.m_minZoomLevel=i.m_options.minZoomLevel),void 0!==i.m_options.maxZoomLevel&&(i.m_maxZoomLevel=i.m_options.maxZoomLevel),void 0!==i.m_options.minCameraHeight&&(i.m_minCameraHeight=i.m_options.minCameraHeight),void 0!==i.m_options.fontCatalog&&(i.defaultFontCatalog=i.m_options.fontCatalog),void 0!==i.m_options.decoderUrl&&(p.ConcurrentDecoderFacade.defaultScriptUrl=i.m_options.decoderUrl),void 0!==i.m_options.decoderCount&&(p.ConcurrentDecoderFacade.defaultWorkerCount=i.m_options.decoderCount),i.m_visibleTileSetOptions=o({},t.MapViewDefaults),void 0!==r.projection&&(i.m_visibleTileSetOptions.projection=r.projection),void 0!==r.extendedFrustumCulling&&(i.m_visibleTileSetOptions.extendedFrustumCulling=r.extendedFrustumCulling),void 0!==r.maxVisibleDataSourceTiles&&(i.m_visibleTileSetOptions.maxVisibleDataSourceTiles=r.maxVisibleDataSourceTiles),void 0!==r.tileCacheSize&&(i.m_visibleTileSetOptions.tileCacheSize=r.tileCacheSize),void 0!==r.tileCacheMemorySize&&(i.m_visibleTileSetOptions.tileCacheMemorySize=r.tileCacheMemorySize),void 0!==r.quadTreeSearchDistanceUp&&(i.m_visibleTileSetOptions.quadTreeSearchDistanceUp=r.quadTreeSearchDistanceUp),void 0!==r.quadTreeSearchDistanceDown&&(i.m_visibleTileSetOptions.quadTreeSearchDistanceDown=r.quadTreeSearchDistanceDown),i.m_pixelRatio=r.pixelRatio,i.m_options.enableStatistics=!0===i.m_options.enableStatistics,i.m_languages=i.m_options.languages||M.MapViewUtils.getBrowserLanguages(),A||void 0===i.m_options.collisionDebugCanvas||null===i.m_options.collisionDebugCanvas||(i.m_collisionDebugCanvas=i.m_options.collisionDebugCanvas,i.m_screenCollisions=new x.ScreenCollisionsDebug(i.m_collisionDebugCanvas)),i.handleRequestAnimationFrame=i.renderFunc.bind(i),i.m_pickHandler=new g.PickHandler(i,!0===i.m_options.enableRoadPicking),i.setupStats(i.m_options.enableStatistics),i.m_renderer=new d.WebGLRenderer({canvas:i.canvas,antialias:!1!==i.m_options.enableNativeWebglAntialias,alpha:i.m_options.alpha,preserveDrawingBuffer:!0===i.m_options.preserveDrawingBuffer}),i.m_renderer.autoClear=!1,i.m_renderer.info.autoReset=!1,i.setupRenderer(),i.m_options.fovCalculation=void 0===i.m_options.fovCalculation?D:i.m_options.fovCalculation,i.m_options.fovCalculation.fov=u.MathUtils.clamp(i.m_options.fovCalculation.fov,V,k);var n=i.canvas,a=n.clientWidth,s=n.clientHeight,l=a/s;i.m_camera=new d.PerspectiveCamera(i.m_options.fovCalculation.fov,l,.1,4e6),i.m_focalLength=0,i.setupCamera(),i.m_movementDetector=new h.CameraMovementDetector(i.m_options.movementThrottleTimeout,function(){return i.movementStarted()},function(){return i.movementFinished()});var c=i.m_options.customAntialiasSettings;return i.mapRenderingManager=new f.MapRenderingManager(a,s,i.m_options.dynamicPixelRatio,c),i.m_visibleTiles=new O.VisibleTileSet(i.m_camera,i.m_visibleTileSetOptions),i.initTheme(),i.drawFrame(),i.canvas.addEventListener("webglcontextlost",i.onWebGLContextLost),i.canvas.addEventListener("webglcontextrestored",i.onWebGLContextRestored),i}return n(r,e),Object.defineProperty(r.prototype,"textElementsRenderer",{get:function(){return this.m_textElementsRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textRenderStyleCache",{get:function(){return this.m_textRenderStyleCache},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textLayoutStyleCache",{get:function(){return this.m_textLayoutStyleCache},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraMovementDetector",{get:function(){return this.m_movementDetector},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e,t;void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);try{for(var r=a(this.m_tileDataSources),i=r.next();!i.done;i=r.next()){i.value.dispose()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.m_visibleTiles.clearTileCache(),this.m_renderer.dispose(),this.m_imageCache.clear(),this.m_movementDetector.dispose()},r.prototype.getCacheSize=function(){return this.m_visibleTiles.getDataSourceCacheSize()},r.prototype.setCacheSize=function(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.updateImages(),this.updateLighting(),this.updateTextRenderer(),this.updateSkyBackground(),this.update()},Object.defineProperty(r.prototype,"extendedFrustumCulling",{get:function(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling},set:function(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lockVisibleTileSet",{get:function(){return this.m_visibleTileSetLock},set:function(e){this.m_visibleTileSetLock=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointOfView",{get:function(){return this.m_pointOfView},set:function(e){this.m_pointOfView=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"theme",{get:function(){return this.m_theme},set:function(e){if(this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,this.updateSkyBackground(),this.m_fog.reset(this.m_theme),this.m_theme.lights=e.lights,this.updateLighting(),this.m_theme.clearColor=e.clearColor,this.renderer.setClearColor(new d.Color(e.clearColor)),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,this.updateImages(),this.m_theme.poiTables=e.poiTables,this.loadPoiTables(),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,this.m_textRenderStyleCache.clear(),this.m_textLayoutStyleCache.clear(),this.updateTextRenderer(),void 0===this.m_theme.styles&&(this.m_theme.styles={}),void 0!==e.styles){var t=function(t){if(void 0!==e.styles[t]){var i=e.styles[t];r.getDataSourcesByStyleSetName(t).forEach(function(e){return e.setStyleSet(i)}),r.m_theme.styles[t]=i}},r=this;for(var i in e.styles)t(i)}this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forceCameraAspect",{get:function(){return this.m_forceCameraAspect},set:function(e){this.m_forceCameraAspect=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"languages",{get:function(){return this.m_languages},set:function(e){var t=this;this.m_languages=e,this.m_tileDataSources.forEach(function(e){e.setLanguages(t.m_languages)}),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"copyrightInfo",{get:function(){return this.m_copyrightInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fadingDisabled",{get:function(){return!0===this.m_options.disableFading},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameNumber",{get:function(){return this.m_frameNumber},enumerable:!0,configurable:!0}),r.prototype.addEventListener=function(t,r){e.prototype.addEventListener.call(this,t,r)},r.prototype.removeEventListener=function(t,r){e.prototype.removeEventListener.call(this,t,r)},Object.defineProperty(r.prototype,"canvas",{get:function(){return this.m_options.canvas},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collisionDebugCanvas",{get:function(){return this.m_collisionDebugCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scene",{get:function(){return this.m_scene},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"camera",{get:function(){return this.m_camera},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderer",{get:function(){return this.m_renderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"clearColor",{get:function(){var e=this.m_renderer.getClearColor();return void 0!==e?e.getHex():0},set:function(e){this.m_renderer.setClearColor(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projection",{get:function(){return this.m_visibleTileSetOptions.projection},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"geoCenter",{get:function(){return this.projection.unprojectPoint(this.m_worldCenter)},set:function(e){this.projection.projectPoint(e,this.m_worldCenter),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"worldCenter",{get:function(){return this.m_worldCenter},set:function(e){this.m_worldCenter.copy(e),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"worldRootObject",{get:function(){return this.m_mapTilesRoot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pickHandler",{get:function(){return this.m_pickHandler},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageCache",{get:function(){return this.m_imageCache},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"poiManager",{get:function(){return this.m_poiManager},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"poiTableManager",{get:function(){return this.m_poiTableManager},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minCameraHeight",{get:function(){return this.m_minCameraHeight},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minZoomLevel",{get:function(){return this.m_minZoomLevel},set:function(e){this.m_minZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxZoomLevel",{get:function(){return this.m_maxZoomLevel},set:function(e){this.m_maxZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zoomLevelBias",{get:function(){return this.m_zoomLevelBias},set:function(e){this.m_zoomLevelBias=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zoomLevel",{get:function(){return this.m_zoomLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"viewportHeight",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dataSources",{get:function(){return this.m_tileDataSources},enumerable:!0,configurable:!0}),r.prototype.setFovCalculation=function(e){this.m_options.fovCalculation=e,this.calculateFocalLength(this.m_renderer.getSize().height),this.updateCameras()},r.prototype.getDataSourceByName=function(e){return this.m_tileDataSources.find(function(t){return t.name===e})},r.prototype.getDataSourcesByStyleSetName=function(e){return this.m_tileDataSources.filter(function(t){return t.styleSetName===e})},r.prototype.addDataSource=function(e){var t=this;if(void 0!==this.getDataSourceByName(e.name))throw new Error('A DataSource with the name "'+e.name+'" already exists in this MapView.');return e.attach(this),this.m_tileDataSources.push(e),e.connect().then(function(){return new Promise(function(e){if(void 0===t.theme){var r=function(){t.removeEventListener(s.ThemeLoaded,r),e()};t.addEventListener(s.ThemeLoaded,r)}else e()})}).then(function(){if(!(-1===t.m_tileDataSources.indexOf(e))){if(e.addEventListener(s.Update,function(){t.update()}),void 0!==t.m_theme.styles&&void 0!==e.styleSetName){var r=t.m_theme.styles[e.styleSetName];e.setStyleSet(r,t.m_languages)}t.m_connectedDataSources.add(e.name),t.dispatchEvent({type:s.DataSourceConnect,dataSourceName:e.name}),t.update()}}).catch(function(r){t.dispatchEvent({type:s.DataSourceConnect,dataSourceName:e.name,error:r})})},r.prototype.removeDataSource=function(e){var t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e.name),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.update())},Object.defineProperty(r.prototype,"visibleTileSet",{get:function(){return this.m_visibleTiles},enumerable:!0,configurable:!0}),r.prototype.addOverlayText=function(e){void 0!==this.m_overlayTextElements&&(this.m_overlayTextElements=this.m_overlayTextElements.concat(e)),this.updateTextRenderer(),this.update()},r.prototype.clearOverlayText=function(){this.m_overlayTextElements=[]},r.prototype.setCameraGeolocationAndZoom=function(e,t,r,i){void 0!==r&&void 0!==i&&M.MapViewUtils.setRotation(this,r,i),this.geoCenter=e,this.camera.position.set(0,0,0),M.MapViewUtils.zoomOnTargetPosition(this,0,0,t),this.update()},Object.defineProperty(r.prototype,"animating",{get:function(){return this.m_animationCount>0},enumerable:!0,configurable:!0}),r.prototype.beginAnimation=function(){0==this.m_animationCount++&&(this.m_updatePending||(this.m_updatePending=!0,this.drawFrame()),H.time=Date.now(),this.dispatchEvent(H))},r.prototype.endAnimation=function(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(X.time=Date.now(),this.dispatchEvent(X))},Object.defineProperty(r.prototype,"cameraIsMoving",{get:function(){return this.m_movementDetector.cameraIsMoving},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pixelToWorld",{get:function(){if(void 0===this.m_pixelToWorld){var e=this.canvas,t=e.clientWidth,r=e.clientHeight,i=this.getWorldPositionAt(.5*t,r),n=this.getWorldPositionAt(.5*t+1,r);this.m_pixelToWorld=null!==i&&null!==n?n.sub(i).length():1}return this.m_pixelToWorld},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"worldToPixel",{get:function(){return 1/this.pixelToWorld},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pixelRatio",{get:function(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1},set:function(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dynamicPixelRatio",{get:function(){return this.mapRenderingManager.lowResPixelRatio},set:function(e){this.mapRenderingManager.lowResPixelRatio=e},enumerable:!0,configurable:!0}),r.prototype.getScreenPosition=function(e){var t=new d.Vector3;this.projection.projectPoint(e,t);var r=this.m_screenProjector.project(t);if(void 0!==r){var i=this.canvas,n=i.width,o=i.height;r.x=(r.x+n/2)/this.pixelRatio,r.y=(o-(r.y+o/2))/this.pixelRatio}return r},r.prototype.getWorldPositionAt=function(e,t){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);var r=new d.Vector3,i=this.m_raycaster.ray.intersectPlane(this.m_plane,r);return i?(i.add(this.m_worldCenter),i):null},r.prototype.getGeoCoordinatesAt=function(e,t){var r=this.getWorldPositionAt(e,t);return r?this.projection.unprojectPoint(r):null},r.prototype.getNormalizedScreenCoordinates=function(e,t){var r=this.canvas,i=r.clientWidth,n=r.clientHeight;return new d.Vector3(e/i*2-1,-t/n*2+1,0)},r.prototype.intersectMapObjects=function(e,t){return this.m_pickHandler.intersectMapObjects(e,t)},r.prototype.resize=function(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update()},r.prototype.update=function(){this.m_updatePending||(this.m_updatePending=!0,this.animating||this.drawFrame())},Object.defineProperty(r.prototype,"updatePending",{get:function(){return this.m_updatePending},enumerable:!0,configurable:!0}),r.prototype.requestUpdateIfNeeded=function(){this.update()},r.prototype.clearTileCache=function(e){this.m_visibleTiles.clearTileCache(e)},r.prototype.forEachVisibleTile=function(e){this.m_visibleTiles.forEachVisibleTile(e)},r.prototype.forEachCachedTile=function(e){this.m_visibleTiles.forEachCachedTile(e)},r.prototype.markTilesDirty=function(e){this.m_visibleTiles.markTilesDirty(e)},Object.defineProperty(r.prototype,"fog",{get:function(){return this.m_fog},enumerable:!0,configurable:!0}),r.prototype.getFrameBufferSize=function(){var e=this.m_renderer.getSize(),t=e.width,r=e.height;return{width:t*this.pixelRatio,height:r*this.pixelRatio}},r.prototype.updateCameras=function(){var e=this.getFrameBufferSize(),t=e.width,r=e.height;this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:t/r,this.setFovOnCamera(this.m_options.fovCalculation,r);var i=Math.max(.1,.1*this.m_camera.position.z),n=50*i+200;if(void 0!==this.m_options.farPlaneEvaluator){this.camera.getWorldDirection(this.m_tempVector3);var o=d.Math.radToDeg(this.m_tempVector3.angleTo(F)),a=this.m_options.farPlaneEvaluator(this,o,i,n);i=Math.max(.1,a.near),n=Math.max(i+200,a.far)}this.m_camera.near=i,this.m_camera.far=n,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCamera.left=t/-2,this.m_screenCamera.right=t/2,this.m_screenCamera.bottom=r/-2,this.m_screenCamera.top=r/2,this.m_screenCamera.updateProjectionMatrix(),this.m_screenCamera.updateMatrixWorld(!1),this.m_screenProjector.update(this.m_camera,this.m_worldCenter,t,r),this.m_screenCollisions.update(t,r),this.m_zoomLevel=M.MapViewUtils.calculateZoomLevelFromHeight(Math.abs(this.m_camera.position.z),this),this.m_pixelToWorld=void 0},r.prototype.drawFrame=function(){this.m_drawing||(void 0!==this.m_animationFrameHandle&&cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))},r.prototype.renderFunc=function(e){this.render(e)},r.prototype.getEnabledTileDataSources=function(){var e,t,r=[];try{for(var i=a(this.m_tileDataSources),n=i.next();!n.done;n=i.next()){var o=n.value;o.enabled&&(o.ready()&&this.m_connectedDataSources.has(o.name)&&r.push(o))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},r.prototype.render=function(e){var t=this;if(!this.m_drawing){++this.m_frameNumber;var r,i,n,o,a,s,l,u=T.PerformanceStatistics.instance,h=u.enabled,f=c.PerformanceTimer.now();if(B.time=e,this.dispatchEvent(B),h&&((r=u.currentFrame).setValue("renderCount.frameNumber",this.m_frameNumber),void 0!==this.m_previousFrameTimeStamp)){var p=f-this.m_previousFrameTimeStamp;h&&(r.setValue("render.fullFrameTime",p),r.setValue("render.fps",1e3/p))}for(this.m_previousFrameTimeStamp=f,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.m_fog.update(this.m_camera),this.m_renderer.clear();this.m_mapTilesRoot.children.length>0;)this.m_mapTilesRoot.remove(this.m_mapTilesRoot.children[0]);var m=d.Math.clamp(Math.floor(this.zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel);h&&(i=c.PerformanceTimer.now()),this.lockVisibleTileSet||this.m_visibleTiles.updateRenderList(this.m_worldCenter,m,Math.floor(this.zoomLevel),this.getEnabledTileDataSources()),h&&(n=c.PerformanceTimer.now());var v=this.m_visibleTiles.dataSourceTileList;v.forEach(function(e){var r=e.zoomLevel,i=e.renderedTiles,n=e.visibleTiles;e.numTilesLoading;n.forEach(function(e){e.frameNumLastVisible=t.m_frameNumber}),i.forEach(function(e){t.renderTileObjects(e,r),e.frameNumLastVisible=t.m_frameNumber})}),this.forEachCachedTile(function(e){e.isVisible=e.frameNumLastVisible===t.m_frameNumber}),void 0!==r&&(r.addValue("renderCount.numTilesRendered",0),r.addValue("renderCount.numTilesVisible",0),r.addValue("renderCount.numTilesLoading",0),v.forEach(function(e){e.zoomLevel;var t=e.renderedTiles,i=e.visibleTiles,n=e.numTilesLoading;r.addValue("renderCount.numTilesRendered",t.length),r.addValue("renderCount.numTilesVisible",i.length),r.addValue("renderCount.numTilesLoading",n)})),this.m_movementDetector.checkCameraMoved(this,e);var y=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_camera;this.prepareRenderTextElements(e),h&&(o=c.PerformanceTimer.now()),void 0!==this.m_skyBackground&&this.m_skyBackground.update(this.m_camera);var g=this.cameraIsMoving||this.animating||this.m_updatePending;this.mapRenderingManager.render(this.m_renderer,this.m_scene,y,!g),h&&(a=c.PerformanceTimer.now()),this.finishRenderTextElements(),h&&(s=c.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,h&&u.appResults.set("firstFrame",e),G.time=e,this.dispatchEvent(G)),this.m_firstFrameComplete||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_connectedDataSources.size!==this.m_tileDataSources.length||this.m_updatePending||this.animating||void 0===this.m_textElementsRenderer||this.m_textElementsRenderer.loading||(this.m_firstFrameComplete=!0,h&&u.appResults.set("firstFrameComplete",e),W.time=e,this.dispatchEvent(W)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,(this.animating||this.m_updatePending)&&this.drawFrame(),this.checkCopyrightUpdates(),void 0!==r&&(l=c.PerformanceTimer.now(),r.setValue("render.setupTime",i-f),r.setValue("render.cullTime",n-i),r.setValue("render.textPlacementTime",o-n),r.setValue("render.drawTime",a-o),r.setValue("render.textDrawTime",s-a),r.setValue("render.cleanupTime",l-s),r.setValue("render.frameRenderTime",l-f),T.PerformanceStatistics.instance.storeFrameInfo(this.m_renderer.info)),N.time=e,this.dispatchEvent(N)}},r.prototype.renderTileObjects=function(e,t){var r,i;if(e.willRender(t))try{for(var n=a(e.objects),o=n.next();!o.done;o=n.next()){var s=o.value;s.position.copy(e.center),void 0!==s.displacement&&s.position.add(s.displacement),s.position.sub(this.m_worldCenter),this.m_mapTilesRoot.add(s)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}e.didRender()},r.prototype.prepareRenderTextElements=function(e){var t=void 0!==this.m_pointOfView;if(void 0!==this.m_textElementsRenderer&&!t){var r;(this.checkIfTextElementsChanged()||this.checkIfTilesChanged())&&this.m_textElementsRenderer.placeAllTileLabels(),this.camera.getWorldDirection(this.m_tempVector3);var i=d.Math.radToDeg(this.m_tempVector3.angleTo(F));if(void 0!==this.m_options.labelVisibilityEvaluator)r=this.m_options.labelVisibilityEvaluator(this,i);else r=i<(void 0===this.m_options.maxLabelAngle?90:this.m_options.maxLabelAngle);this.m_textElementsRenderer.reset(),r&&(this.m_textElementsRenderer.renderUserTextElements(e,this.m_frameNumber),this.m_textElementsRenderer.renderAllTileText(e,this.m_frameNumber)),this.m_textElementsRenderer.renderOverlay(this.m_overlayTextElements),this.m_textElementsRenderer.update()}},r.prototype.finishRenderTextElements=function(){void 0===this.m_pointOfView&&this.m_textElementsRenderer&&(this.m_screenCamera.far=this.camera.far,this.m_textElementsRenderer.renderText(this.m_screenCamera))},r.prototype.initTheme=function(){var e=this;void 0!==this.m_options.theme&&("string"==typeof this.m_options.theme?E.ThemeLoader.loadAsync(this.m_options.theme):Promise.resolve(this.m_options.theme)).then(function(t){q.time=Date.now(),e.dispatchEvent(q),e.theme=t})},r.prototype.setupCamera=function(){var e=this.canvas,t=e.clientWidth,r=e.clientHeight;this.m_scene.add(this.m_camera),this.m_camera.position.set(0,0,3e3),this.m_camera.lookAt(new d.Vector3(0,0,0)),this.calculateFocalLength(r),this.m_visibleTiles=new O.VisibleTileSet(this.m_camera,this.m_visibleTileSetOptions),this.resize(t,r),this.geoCenter=new u.GeoCoordinates(52.518611,13.376111,0),this.m_screenCamera.position.z=1,this.m_screenCamera.near=0},r.prototype.updateSkyBackground=function(){if(void 0!==this.m_theme){var e=this.m_theme;if(this.m_skyBackground instanceof S.SkyBackground&&void 0!==e.sky)this.updateSkyBackgroundColors(e.sky,e.clearColor);else{if(void 0===this.m_skyBackground&&void 0!==e.sky)return void this.addNewSkyBackground(e.sky,e.clearColor);this.m_skyBackground instanceof S.SkyBackground&&void 0===e.sky&&this.removeSkyBackGround()}}},r.prototype.addNewSkyBackground=function(e,t){var r=void 0===e.groundColor?t:e.groundColor;this.m_skyBackground=new S.SkyBackground(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(r),this.camera,e.monomialPower),this.m_scene.background=this.m_skyBackground.texture},r.prototype.removeSkyBackGround=function(){this.m_scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.texture.dispose(),this.m_skyBackground=void 0)},r.prototype.updateSkyBackgroundColors=function(e,t){var r=void 0===e.groundColor?t:e.groundColor;void 0!==this.m_skyBackground&&this.m_skyBackground.updateColors(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(r))},r.prototype.updateLighting=function(){var e=this;if(this.m_theme){var t=this.m_theme;void 0!==t.clearColor&&this.m_renderer.setClearColor(new d.Color(t.clearColor)),this.m_createdLights&&this.m_createdLights.forEach(function(t){e.m_scene.remove(t)}),void 0!==t.lights&&(this.m_createdLights=[],t.lights.forEach(function(t){var r=l.createLight(t);r?(e.m_scene.add(r),e.m_createdLights.push(r)):L.log("MapView: failed to create light "+t.name+" of type "+t.type)}))}},r.prototype.movementStarted=function(){void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementStarted(),Y.time=Date.now(),this.dispatchEvent(Y)},r.prototype.movementFinished=function(){var e=this;void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementFinished(),Z.time=Date.now(),this.dispatchEvent(Z),this.animating||setTimeout(function(){return e.update()},0)},r.prototype.checkIfTextElementsChanged=function(){var e=this.m_visibleTiles.dataSourceTileList,t=!1;return e.forEach(function(e){e.renderedTiles.forEach(function(e){e.textElementsChanged&&(e.textElementsChanged=!1,t=!0)})}),t},r.prototype.checkIfTilesChanged=function(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;var e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(function(e){var r=e.dataSource;e.renderedTiles.forEach(function(e){t.push(r.name+"-"+e.tileKey.mortonCode())})}),t.sort();var r=t.join("#");return r!==this.m_lastTileIds?(this.m_lastTileIds=r,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged},r.prototype.checkCopyrightUpdates=function(){if(this.checkIfTilesChanged()){var e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){for(var t=!0,r=0;r<e.length;r++){var i=e[r],n=this.m_copyrightInfo[r];if(i.label!==n.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(J)}}},r.prototype.getRenderedTilesCopyrightInfo=function(){var e,t,r,i,n=[];try{for(var o=a(this.m_visibleTiles.dataSourceTileList),s=o.next();!s.done;s=o.next()){var l=s.value;try{for(var u=a(l.renderedTiles),c=u.next();!c.done;c=u.next()){var d=c.value.copyrightInfo;void 0!==d&&0!==d.length&&(n=m.CopyrightInfo.mergeArrays(n,d))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},r.prototype.updateImages=function(){var e,t,r=this;if(this.m_theme){var i=this.m_theme;if(this.m_imageCache.clear(),this.poiManager.clear(),void 0!==i.images)try{for(var n=a(Object.keys(i.images)),o=n.next();!o.done;o=n.next()){var s=o.value,l=i.images[s];this.m_imageCache.addImage(s,l.url,!0===l.preload),"string"==typeof l.atlas&&this.poiManager.addTextureAtlas(s,l.atlas)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}void 0!==i.imageTextures&&i.imageTextures.forEach(function(e){r.poiManager.addImageTexture(e)})}},r.prototype.loadPoiTables=function(){void 0!==this.m_theme&&(this.poiTableManager.clear(),this.poiTableManager.loadPoiTables(this.m_theme))},r.prototype.setupStats=function(e){new T.PerformanceStatistics(e,1e3)},r.prototype.setupRenderer=function(){this.m_renderer.setClearColor(I),this.m_scene.add(this.m_mapTilesRoot)},r.prototype.updateTextRenderer=function(){void 0!==this.m_theme.textStyles&&(void 0===this.m_textElementsRenderer&&(this.m_textElementsRenderer=new C.TextElementsRenderer(this,this.m_screenCollisions,this.m_screenProjector,this.m_options.maxNumGlyphs,this.m_theme,this.m_options.maxNumVisibleLabels,this.m_options.numSecondChanceLabels,this.m_options.maxDistanceRatioForLabels,this.m_options.labelStartScaleDistance)),this.m_textElementsRenderer.placeAllTileLabels())},r.prototype.limitFov=function(e,t){e=u.MathUtils.clamp(e,V,k);var r=u.MathUtils.radToDeg(M.MapViewUtils.calculateHorizontalFovByVerticalFov(u.MathUtils.degToRad(e),t));return(r>k||r<V)&&(r=u.MathUtils.clamp(r,V,k),e=u.MathUtils.radToDeg(M.MapViewUtils.calculateVerticalFovByHorizontalFov(u.MathUtils.degToRad(r),t))),e},r.prototype.setFovOnCamera=function(e,t){this.m_camera.fov=this.limitFov("fixed"===e.type?e.fov:M.MapViewUtils.calculateFovByFocalLength(this.m_focalLength,t),this.m_camera.aspect)},r.prototype.calculateFocalLength=function(e){c.assert(void 0!==this.m_options.fovCalculation),"fixed"!==this.m_options.fovCalculation.type&&(this.m_focalLength=M.MapViewUtils.calculateFocalLengthByVerticalFov(u.MathUtils.degToRad(this.m_options.fovCalculation.fov),e))},r}(d.EventDispatcher);t.MapView=$},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(67),n=r(68),o=function(){function e(){}return e.getTileDecoder=function(e,t){var r=this.getWorkerSet(t);return new n.WorkerBasedDecoder(r,e)},e.getWorkerSet=function(e){void 0===e&&(e=this.defaultScriptUrl);var t=this.workerSets[e];return void 0===t&&(t=new i.ConcurrentWorkerSet({scriptUrl:e,workerCount:this.defaultWorkerCount}),this.workerSets[e]=t),t},e.destroyWorkerSet=function(e){var t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])},e.destroy=function(){var e=this;Object.keys(this.workerSets).forEach(function(t){e.workerSets[t].destroy()}),this.workerSets={}},e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=void 0,e.workerSets={},e}();t.ConcurrentDecoderFacade=o},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(2),u=r(1),c=r(132),d=u.LoggerManager.instance.create("ConcurrentWorkerSet");function h(e){return e&&"number"==typeof e.level&&e.type===u.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=h;var f=function(){function e(e){var t=this;this.m_options=e,this.m_workerChannelLogger=u.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_workerListeners=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=function(e,r){var i,n,o,s,c,f;if(l.WorkerServiceProtocol.isResponseMessage(r.data)){var p=r.data;if(null===p.messageId)return void d.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: no messageId");var m=t.m_requests.get(p.messageId);if(void 0===m)return void d.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: invalid messageId");if(e>=0&&e<t.m_workers.length){var v=t.m_workers[e];t.m_availableWorkers.push(v),t.checkWorkerRequestQueue()}else d.error("["+t.m_options.scriptUrl+"]: onWorkerMessage: invalid workerId");m.resolver(p.error,p.response)}else if(l.WorkerServiceProtocol.isInitializedMessage(r.data)){var y=t.getReadyPromise(r.data.service);++y.count===t.m_workerPromises.length&&y.resolve()}else if(h(r.data))switch(r.data.level){case u.LogLevel.Trace:(i=t.m_workerChannelLogger).trace.apply(i,a(r.data.message));break;case u.LogLevel.Debug:(n=t.m_workerChannelLogger).debug.apply(n,a(r.data.message));break;case u.LogLevel.Log:(o=t.m_workerChannelLogger).log.apply(o,a(r.data.message));break;case u.LogLevel.Info:(s=t.m_workerChannelLogger).info.apply(s,a(r.data.message));break;case u.LogLevel.Warn:(c=t.m_workerChannelLogger).warn.apply(c,a(r.data.message));break;case u.LogLevel.Error:(f=t.m_workerChannelLogger).error.apply(f,a(r.data.message))}else t.eventHandler(r)},this.start()}return e.prototype.addReference=function(){this.m_referenceCount+=1},e.prototype.removeReference=function(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()},e.prototype.start=function(e){var t=this;if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");for(var r=u.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?Math.max(1,navigator.hardwareConcurrency):void 0,4),i=function(e){var r=c.WorkerLoader.startWorker(n.m_options.scriptUrl);r.then(function(r){var i=function(r){t.onWorkerMessage(e,r)};t.m_workerListeners.push(i),r.addEventListener("message",i),t.m_workers.push(r),t.m_availableWorkers.push(r)}).catch(function(t){d.error("failed to load worker "+e+": "+t)}),n.m_workerPromises.push(r)},n=this,o=0;o<r;++o)i(o);this.m_stopped=!1},e.prototype.stop=function(){return i(this,void 0,void 0,function(){var e=this;return n(this,function(t){switch(t.label){case 0:return this.m_stopped=!0,[4,this.waitForAllResponses().then(function(){e.terminateWorkers()})];case 1:return t.sent(),[2]}})})},e.prototype.destroy=function(){this.m_stopped=!0,this.m_requests.forEach(function(e){e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.terminateWorkers(),this.m_eventListeners.clear()},e.prototype.connect=function(e){return this.ensureStarted(),this.getReadyPromise(e).promise},e.prototype.addEventListener=function(e,t){this.m_eventListeners.set(e,t)},e.prototype.removeEventListener=function(e){this.m_eventListeners.delete(e)},e.prototype.invokeRequest=function(e,t,r,i){var n=this;this.ensureStarted();var o,a=this.m_nextMessageId++,s=new Promise(function(e,t){o=function(r,i){n.m_requests.delete(a),void 0!==r?t(new Error(r.toString())):e(i)}});this.m_requests.set(a,{promise:s,resolver:o});var u={service:e,type:l.WorkerServiceProtocol.ServiceMessageName.Request,messageId:a,request:t};return this.postRequestMessage(u,r,i),s},e.prototype.broadcastRequest=function(e,t,r){var i,n,o=this;this.ensureStarted();var a=[],u=function(i){var n,s=c.m_nextMessageId++,u=new Promise(function(e,t){n=function(r,i){o.m_requests.delete(s),void 0!==r?t(new Error(r.toString())):e(i)}});a.push(u),c.m_requests.set(s,{promise:u,resolver:n});var d={service:e,type:l.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};i.postMessage(d,r)},c=this;try{for(var d=s(this.m_workers),h=d.next();!h.done;h=d.next()){u(h.value)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}return Promise.all(a)},e.prototype.postRequestMessage=function(e,t,r){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==r&&r.signal.aborted){var i=this.m_requests.get(e.messageId);if(void 0===i)return void d.error("["+this.m_options.scriptUrl+"]: Bad ResponseMessage: invalid messageId");var n=new Error("Aborted");return n.name="AbortError",void i.resolver(n,void 0)}this.m_availableWorkers.length>0?this.m_availableWorkers.pop().postMessage(e,t):(void 0===r&&(r=new l.RequestController(0)),0===r.priority&&(r.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:r}))},e.prototype.broadcastMessage=function(e,t){this.ensureStarted(),this.m_workers.forEach(function(r){return r.postMessage(e,t)})},Object.defineProperty(e.prototype,"requestQueueSize",{get:function(){return this.m_workerRequestQueue.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numWorkers",{get:function(){return this.m_workers.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numIdleWorkers",{get:function(){return this.m_availableWorkers.length},enumerable:!0,configurable:!0}),e.prototype.eventHandler=function(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)},e.prototype.ensureStarted=function(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")},e.prototype.waitForAllResponses=function(){return i(this,void 0,void 0,function(){var e;return n(this,function(t){switch(t.label){case 0:return e=new Array,this.m_requests.forEach(function(t){e.push(t.promise)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},e.prototype.dispatchEvent=function(e,t){var r=this.m_eventListeners.get(e);void 0!==r&&r(t)},e.prototype.terminateWorkers=function(){var e=this;this.m_workerPromises.forEach(function(t){t.then(function(t){var r=e.m_workers.indexOf(t);if(r>=0){var i=e.m_workerListeners[r];t.removeEventListener("message",i)}else d.error("["+e.m_options.scriptUrl+"]: ConcurrentWorkerSet#terminateWorkers: invalid workerId");t.terminate()}).catch(function(){})}),this.m_workers=[],this.m_workerListeners=[],this.m_workerPromises=[],this.m_availableWorkers=[],this.m_readyPromises.clear()},e.prototype.getReadyPromise=function(e){var t=this,r=this.m_readyPromises.get(e);if(void 0!==r)return r;var i={count:0,promise:void 0,resolve:function(){},reject:function(e){i.error=e},error:void 0};return i.promise=new Promise(function(e,r){var n=i;void 0!==n.error?r(n.error):n.count===t.m_workerPromises.length&&e(),n.resolve=e,n.reject=r}),this.m_readyPromises.set(e,i),i},e.prototype.checkWorkerRequestQueue=function(){if(this.m_workerRequestQueue.length>0&&(this.m_workerRequestQueue.sort(function(e,t){return e.requestController.priority-t.requestController.priority}),this.m_availableWorkers.length>0)){var e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}},e}();t.ConcurrentWorkerSet=f},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=0,s=function(){function e(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=this.decoderServiceType+"-"+a++}return e.prototype.dispose=function(){this.m_serviceCreated&&this.workerSet.broadcastRequest(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:o.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}),this.workerSet.removeReference()},e.prototype.connect=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this.workerSet.connect(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)];case 1:return e.sent(),this.m_serviceCreated?[3,3]:[4,this.workerSet.broadcastRequest(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:o.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId})];case 2:e.sent(),this.m_serviceCreated=!0,e.label=3;case 3:return[2]}})})},e.prototype.decodeTile=function(e,t,r,i,n){var a=t.mortonCode(),s={type:o.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:a,displayZoomLevel:i,data:e,projection:o.getProjectionName(r)},l=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,s,l,n)},e.prototype.getTileInfo=function(e,t,r,i,n){var a=t.mortonCode(),s={type:o.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:a,displayZoomLevel:i,data:e,projection:o.getProjectionName(r)},l=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,s,l,n)},e.prototype.configure=function(e,t,r){var i={service:this.serviceId,type:o.WorkerDecoderProtocol.DecoderMessageName.Configuration,styleSet:e,options:r,languages:t};this.workerSet.broadcastMessage(i)},e}();t.WorkerBasedDecoder=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),n=r(0),o=function(){function e(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new n.Fog(0),this.m_fogIsDefined=!1,this.m_cachedTheme={styles:{}}}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.m_enabled},set:function(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){this.m_cachedTheme=e,void 0!==e&&void 0!==e.sky&&void 0!==e.sky.colorBottom&&void 0!==e.fog&&void 0!==e.fog.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.sky.colorBottom),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())},e.prototype.update=function(e){null!==this.m_scene.fog&&void 0!==e.far&&void 0!==this.m_cachedTheme&&this.m_cachedTheme.fog&&void 0!==this.m_cachedTheme.fog.startRatio&&(this.m_fog.far=e.far,this.m_fog.near=e.far*this.m_cachedTheme.fog.startRatio)},e.prototype.add=function(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)},e.prototype.remove=function(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)},e.prototype.setFogInRawShaderMaterials=function(e){this.m_scene.traverse(function(t){if(t instanceof n.Mesh&&t.material instanceof n.Material&&t.material instanceof n.Material&&!(t.material instanceof i.HighPrecisionLineMaterial)){if(t.material instanceof i.SolidLineMaterial)t.material.updateFog(e);t.material.fog=e,t.material.needsUpdate=!0}})},e}();t.MapViewFog=o},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),r(32);var a=r(1),s=function(){function e(){}return e.loadAsync=function(e){return i(this,void 0,void 0,function(){var t,r,i,s,l,u,c,d,h,f,p,m,v,y;return n(this,function(n){switch(n.label){case 0:return e=a.defaultUrlResolver(e),[4,fetch(e)];case 1:if(!(l=n.sent()).ok)throw new Error("ThemeLoader#loadAsync: cannot load theme: "+l.statusText);return[4,l.json()];case 2:if(null===(u=n.sent()))throw new Error("ThemeLoader#loadAsync: loaded resource is not valid JSON");if(u.url=e,c=a.composeUrlResolvers(function(t){return a.resolveReferenceUrl(e,t)},a.defaultUrlResolver),u.images)try{for(d=o(Object.keys(u.images)),h=d.next();!h.done;h=d.next())f=h.value,(p=u.images[f]).url=c(p.url),void 0!==p.atlas&&(p.atlas=c(p.atlas))}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}if(u.fontCatalogs)try{for(m=o(u.fontCatalogs),v=m.next();!v.done;v=m.next())(y=v.value).url=c(y.url)}catch(e){i={error:e}}finally{try{v&&!v.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}return[2,u]}})})},e}();t.ThemeLoader=s},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=0,s=function(){function e(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=this.tilerServiceType+"-"+a++}return e.prototype.dispose=function(){this.m_serviceCreated&&this.workerSet.broadcastRequest(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:o.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}),this.workerSet.removeReference()},e.prototype.connect=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this.workerSet.connect(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)];case 1:return e.sent(),this.m_serviceCreated?[3,3]:[4,this.workerSet.broadcastRequest(o.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:o.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId})];case 2:e.sent(),this.m_serviceCreated=!0,e.label=3;case 3:return[2]}})})},e.prototype.registerIndex=function(e,t){var r={type:o.WorkerTilerProtocol.Requests.RegisterIndex,id:e,url:t};return this.workerSet.invokeRequest(this.serviceId,r)},e.prototype.getTile=function(e,t){var r=t.mortonCode(),i={type:o.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:r};return this.workerSet.invokeRequest(this.serviceId,i)},e}();t.WorkerBasedTiler=s},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);function o(e){e.depthWrite=!1,e.depthFunc=n.EqualDepth,e.colorWrite=!0,e.transparent=!0;var t=e.clone();return t.depthWrite=!0,t.depthTest=!0,t.depthFunc=n.LessDepth,t.colorWrite=!1,t.transparent=!1,t.opacity=1,t}t.DEPTH_PRE_PASS_STENCIL_MASK=1,t.isRenderDepthPrePassEnabled=function(e){return!1!==e.enableDepthPrePass&&void 0!==e.opacity&&e.opacity>0&&e.opacity<1},t.createDepthPrePassMaterial=o,t.createDepthPrePassMesh=function(e){var t,r,a=e.geometry;if(!(a instanceof n.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");var s=a.getAttribute("position");if(!s)throw new Error("#createDepthPassMesh position attribute not found");var l=new n.BufferGeometry;l.addAttribute("position",s);var u=a.getAttribute("uv");u&&l.addAttribute("uv",u),a.index&&l.setIndex(a.index);try{for(var c=i(a.groups),d=c.next();!d.done;d=c.next()){var h=d.value,f=h.start,p=h.count,m=h.materialIndex;l.addGroup(f,p,m)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var v=e.material instanceof Array?e.material.map(o):o(e.material),y=new n.Mesh(l,v);return y.renderOrder=e.renderOrder,y},t.setDepthPrePassStencil=function(e,r){e.onBeforeRender=function(e){var r=e.context;e.state.buffers.stencil.setTest(!0),e.state.buffers.stencil.setMask(t.DEPTH_PRE_PASS_STENCIL_MASK),e.state.buffers.stencil.setOp(r.KEEP,r.KEEP,r.REPLACE),e.state.buffers.stencil.setFunc(r.ALWAYS,255,t.DEPTH_PRE_PASS_STENCIL_MASK)},r.onBeforeRender=function(e){var r=e.context;e.state.buffers.stencil.setTest(!0),e.state.buffers.stencil.setMask(t.DEPTH_PRE_PASS_STENCIL_MASK),e.state.buffers.stencil.setOp(r.KEEP,r.KEEP,r.ZERO),e.state.buffers.stencil.setFunc(r.EQUAL,255,t.DEPTH_PRE_PASS_STENCIL_MASK)},e.onAfterRender=function(e){e.state.buffers.stencil.setTest(!1),e.state.buffers.stencil.setMask(255)},r.onAfterRender=function(e){e.state.buffers.stencil.setTest(!1),e.state.buffers.stencil.setMask(255)}}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),s=r(145),l=r(1),u=l.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};var c=function(){function e(e,t,r){this.object=e,this.geometryType=t,this.bufferGeometry=r,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,l.assert(!!e),"BufferGeometry"!==r.type&&u.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),l.assert("BufferGeometry"===r.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||u.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&u.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}return e.prototype.getCount=function(){return this.position.count},Object.defineProperty(e.prototype,"renderOrder",{get:function(){return this.object.renderOrder},enumerable:!0,configurable:!0}),e.prototype.setRange=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),l.assert(e>=0),l.assert(t>=0),l.assert(e<=t),this.start=e,this.end=t,this.startCapSize=r,this.endCapSize=i},Object.defineProperty(e.prototype,"color",{get:function(){var e,t,r=function(e){var t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){var r=e;if("SolidLineMaterial"===r.name)return r.uniforms.diffuse.value;u.warn("BufferedGeometryAccessor#color: unknown shader material name",r.name)}else u.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){var i=new Array,n=this.object.material;try{for(var a=o(n),s=a.next();!s.done;s=a.next()){var l=s.value;i.push(r(l))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return i}return r(this.object.material)},enumerable:!0,configurable:!0}),e}();t.BufferedGeometryAccessorBase=c;var d=function(e){function t(t,r,i,n){var o=e.call(this,t,r,i)||this;return o.object=t,o.geometryType=r,o.bufferGeometry=i,o.stride=n,o}return n(t,e),t.prototype.clear=function(){l.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");for(var e=this.position.array,t=this.start*this.itemSize,r=this.end*this.itemSize,i=t;i<r;i++)e[i]=0;this.position.needsUpdate=!0},t.prototype.getVertices=function(){l.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");var e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)},t.prototype.checkSetUp=function(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end},t}(c);t.BufferedGeometryAccessor=d;var h=function(e){function t(t,r,i){var n=e.call(this,t,r,i,3)||this;return n.object=t,n.geometryType=r,n.bufferGeometry=i,n}return n(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){l.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")},enumerable:!0,configurable:!0}),t}(d);t.BufferedGeometryLineAccessor=h;var f=function(e){function t(t,r,i){var n=e.call(this,t,r,i,1)||this;return n.object=t,n.geometryType=r,n.bufferGeometry=i,n}return n(t,e),t.prototype.isObject3dAccessor=function(){return!0},t.prototype.getVertices=function(){return e.prototype.getVertices.call(this)},t}(d);t.BufferedGeometryObject3dAccessor=f;var p=function(e){function t(t,r,i,n,o){var a=e.call(this,t,r,i)||this;return a.object=t,a.geometryType=r,a.bufferGeometry=i,a.indices=a.bufferGeometry.index.array,a.indices?a.indices instanceof Uint32Array||(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),l.assert(a.indices instanceof Uint32Array)):(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),l.assert(!!a.indices)),a}return n(t,e),t.prototype.getCount=function(){return this.indices.length},t.prototype.checkSetUp=function(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end},t}(c);t.IndexedBufferedGeometryAccessor=p;var m=function(e){function t(t,r,i){var n=e.call(this,t,r,i,3)||this;return n.object=t,n.geometryType=r,n.bufferGeometry=i,n}return n(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){if(l.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===a.GeometryType.ExtrudedLine){var e=this.start+this.startCapSize,t=this.position.array;return s.reconstructLineWidth(t,e)}},enumerable:!0,configurable:!0}),t.prototype.clear=function(){l.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");for(var e=this.start,t=this.end,r=e;r<t;r++)this.indices[r]=0;this.bufferGeometry.index.needsUpdate=!0},t.prototype.getVertices=function(){l.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");var e=this.itemSize,t=this.start,r=this.end,i=new Float32Array((r-t)*e),n=this.position.array;if(2===e)for(var o=t,a=0;o<r;o++,a+=e){var s=this.indices[o];i[a+0]=n[s*e+0],i[a+1]=n[s*e+1]}if(3===e)for(o=t,a=0;o<r;o++,a+=e){s=this.indices[o];i[a+0]=n[s*e+0],i[a+1]=n[s*e+1],i[a+2]=n[s*e+2]}else for(o=t,a=0;o<r;o++,a++){s=this.indices[o];for(var u=0;u<e;u++)i[a*e+u]=n[s*e+u]}return i},t}(p);t.IndexedBufferedGeometryLineAccessor=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=new i.Vector3(0,0,1),o=[0,1,2,1,3,2],a=8,s=Math.PI/a;function l(e,t,r,i,n,o){var l=n.length/3;n.push(e,t,0);for(var u=0;u<a+1;++u){var c=s*u+Math.PI/2+r;n.push(e+i*Math.cos(c),t+i*Math.sin(c),0),o.push(l,l+u+1,l+(u+1)%(a+1)+1)}}t.numCirclePoints=function(e){return a+1},t.triangulateLine=function(e,t,r,a,s,u){if(void 0===s&&(s=!0),void 0===u&&(u=s),!(e.length<2)){var c=new i.Vector2;if(s){var d=2!==e.length?c.set(e[2]-e[0],e[3]-e[1]).angle():0;l(e[0],e[1],d,t,r,a)}for(var h=r.length/3,f=new i.Vector3,p=new i.Vector3,m=new i.Vector3,v=new i.Vector3,y=new i.Vector3,g=new i.Vector3,_=new i.Vector3,b=e.length/2,x=0;x<b;++x)p.set(e[2*x],e[2*x+1],0),x+1<b?(m.set(e[2*(x+1)],e[2*(x+1)+1],0),v.copy(m).sub(p).normalize().cross(n),y.copy(v),x>0&&y.add(f).multiplyScalar(1-.5*v.dot(f)),g.copy(y).multiplyScalar(-t).add(p),_.copy(y).multiplyScalar(t).add(p),r.push(g.x,g.y,g.z,_.x,_.y,_.z),f.copy(v)):(g.copy(f).multiplyScalar(-t).add(p),_.copy(f).multiplyScalar(t).add(p),r.push(g.x,g.y,g.z,_.x,_.y,_.z));var w=function(e){o.forEach(function(t){return a.push(h+2*e+t)})};for(x=0;x<b-1;++x)w(x);u&&(d=2!==e.length?c.set(e[2*(b-2)]-e[2*(b-1)],e[2*(b-2)+1]-e[2*(b-1)+1]).angle():Math.PI,l(e[2*(b-1)],e[2*(b-1)+1],d,t,r,a))}},t.reconstructLine=function(e,t){for(var r=new Float32Array(e.length/2),i=3*t,n=2*i;i<r.length;i+=3,n+=6)r[i]=e[n]+.5*(e[n+3]-e[n]),r[i+1]=e[n+1]+.5*(e[n+3+1]-e[n+1]),r[i+2]=e[n+2]+.5*(e[n+3+2]-e[n+2]);return r},t.reconstructLineWidth=function(e,t){var r=e[2*t+3]-e[2*t],i=e[2*t+3+1]-e[2*t+1],n=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(r*r+i*i+n*n)}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=r(0),s=r(36),l=function(e){function t(t,r,i,n,s){var l=e.call(this,void 0===t?new a.BufferGeometry:t,r)||this;return l.dimensionality=0,void 0===r&&(r=new o.HighPrecisionLineMaterial({color:n||o.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:o.HighPrecisionLineMaterial.DEFAULT_OPACITY})),l.matrixWorldInverse=new a.Matrix4,i&&l.setPositions(i),l}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=s.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;if(0===this.dimensionality||void 0===this.dimensionality)throw new Error("HighPrecisionLine: positions not specified.");this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,i,n,o,a){s.HighPrecisionUtils.updateHpUniforms(e,i,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(a.Line);t.HighPrecisionWireFrameLine=l;var u=function(e){function t(t,r,i,n,s){var l=e.call(this,void 0===t?new a.BufferGeometry:t,r)||this;return l.dimensionality=0,void 0===r&&(r=new o.HighPrecisionLineMaterial({color:n||o.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:o.HighPrecisionLineMaterial.DEFAULT_OPACITY})),l.matrixWorldInverse=new a.Matrix4,i&&l.setPositions(i),l}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e,t){this.dimensionality=s.HighPrecisionUtils.setPositions(this,e,t)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,i,n,o,a){s.HighPrecisionUtils.updateHpUniforms(e,i,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(a.Mesh);t.HighPrecisionLine=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=r(3),l=r(7),u=r(0),c=r(77);!function(e){e[e.NONE=0]="NONE",e[e.PAN=1]="PAN",e[e.ROTATE=2]="ROTATE",e[e.ORBIT=3]="ORBIT",e[e.TOUCH=4]="TOUCH"}(o||(o={})),function(e){e.Update="update",e.BeginInteraction="begin-interaction",e.EndInteraction="end-interaction"}(a=t.EventNames||(t.EventNames={}));var d={type:a.Update},h={type:a.BeginInteraction},f={type:a.EndInteraction},p=new u.Quaternion,m=new u.Quaternion,v=new u.Vector3(0,0,1),y=new u.Vector3(1,0,0),g=Math.PI/4,_=function(e){function t(t){var r=e.call(this)||this;return r.mapView=t,r.rotationMouseDeltaFactor=.1,r.orbitingMouseDeltaFactor=.1,r.orbitingTouchDeltaFactor=.1,r.enabled=!0,r.tiltEnabled=!0,r.rotateEnabled=!0,r.inertiaEnabled=!0,r.zoomInertiaDampingDuration=.5,r.panInertiaDampingDuration=1,r.zoomLevelDeltaOnMouseWheel=.2,r.minZoomLevel=0,r.maxZoomLevel=20,r.minCameraHeight=3,r.m_currentViewDirection=new u.Vector3,r.m_lastMousePosition=new u.Vector2(0,0),r.m_needsRenderLastFrame=!0,r.m_panIsAnimated=!1,r.m_panDistanceFrameDelta=new u.Vector3,r.m_panAnimationTime=0,r.m_panAnimationStartTime=0,r.m_lastAveragedPanDistance=0,r.m_currentInertialPanningSpeed=0,r.m_lastPanVector=new u.Vector3,r.m_recentPanDistances=[0,0,0,0,0],r.m_currentPanDistanceIndex=0,r.m_zoomIsAnimated=!1,r.m_zoomDeltaRequested=0,r.m_zoomTargetNormalizedCoordinates=new u.Vector2,r.m_zoomAnimationTime=0,r.m_zoomAnimationStartTime=0,r.m_startZoom=0,r.m_state=o.NONE,r.m_minPitchAngle=0,r.m_maxPitchAngle=g,r.m_touchState={touches:[],currentRotation:0,initialRotation:0},r.dispose=function(){},r.camera=t.camera,r.domElement=t.renderer.domElement,r.maxZoomLevel=t.maxZoomLevel,r.minZoomLevel=t.minZoomLevel,r.minCameraHeight=t.minCameraHeight,r.bindInputEvents(r.domElement),r.zoom=r.zoom.bind(r),r.pan=r.pan.bind(r),r}return n(t,e),t.create=function(e){return new t(e)},t.prototype.rotate=function(e,t){this.inertiaEnabled&&this.m_zoomIsAnimated&&this.stopZoom();var r=l.MapViewUtils.extractYawPitchRoll(this.camera.quaternion),i=r.yaw;this.rotateEnabled&&(i-=s.MathUtils.degToRad(e)),p.setFromAxisAngle(v,i);var n=s.MathUtils.degToRad(t),o=this.constrainPitchAngle(r.pitch,n);m.setFromAxisAngle(y,o),p.multiply(m),this.mapView.camera.quaternion.copy(p),this.mapView.camera.matrixWorldNeedsUpdate=!0},Object.defineProperty(t.prototype,"yawPitchRoll",{get:function(){var e=l.MapViewUtils.extractYawPitchRoll(this.camera.quaternion);return{yaw:s.MathUtils.radToDeg(e.yaw),pitch:s.MathUtils.radToDeg(e.pitch),roll:s.MathUtils.radToDeg(e.roll)}},enumerable:!0,configurable:!0}),t.prototype.orbitFocusPoint=function(e,t){this.inertiaEnabled&&this.m_zoomIsAnimated&&this.stopZoom(),this.mapView.camera.getWorldDirection(this.m_currentViewDirection);var r=c.directionToAzimuthAltitude(this.m_currentViewDirection),i=1/Math.sin(r.altitude)*this.mapView.camera.position.z,n=l.MapViewUtils.rayCastWorldCoordinates(this.mapView,0,0),o=this.getMinDelta(t);this.rotate(e,o),this.mapView.camera.getWorldDirection(this.m_currentViewDirection);var a=c.directionToAzimuthAltitude(this.m_currentViewDirection),s=Math.sin(a.altitude)*i;this.mapView.camera.position.z=s;var u=l.MapViewUtils.rayCastWorldCoordinates(this.mapView,0,0);if(n&&u){var d=n.sub(u);l.MapViewUtils.pan(this.mapView,d.x,d.y)}else this.updateMapView()},t.prototype.moveAlongTheViewDirection=function(e){this.mapView.camera.getWorldDirection(this.m_currentViewDirection),this.m_currentViewDirection.multiplyScalar(e),this.mapView.camera.position.z+=this.m_currentViewDirection.z,this.mapView.worldCenter.x+=this.m_currentViewDirection.x,this.mapView.worldCenter.y+=this.m_currentViewDirection.y,this.updateMapView()},t.prototype.setRotation=function(e,t){l.MapViewUtils.setRotation(this.mapView,e,t)},t.prototype.zoomOnTargetPosition=function(e,t,r){l.MapViewUtils.zoomOnTargetPosition(this.mapView,e,t,r)},Object.defineProperty(t.prototype,"cameraHeight",{get:function(){return this.mapView.camera.position.z},set:function(e){this.camera.position.setZ(e),this.camera.matrixWorldNeedsUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPitchAngle",{get:function(){return s.MathUtils.radToDeg(this.m_maxPitchAngle)},set:function(e){this.m_maxPitchAngle=s.MathUtils.degToRad(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPitchAngle",{get:function(){return s.MathUtils.radToDeg(this.m_minPitchAngle)},set:function(e){this.m_minPitchAngle=s.MathUtils.degToRad(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentZoom",{get:function(){return void 0!==this.m_currentZoom?this.m_currentZoom:l.MapViewUtils.calculateZoomLevelFromHeight(this.mapView.camera.position.z,this.mapView)},set:function(e){this.m_currentZoom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomLevelTargetted",{get:function(){return void 0===this.m_targettedZoom?this.currentZoom:this.m_targettedZoom},enumerable:!0,configurable:!0}),t.prototype.easeOutCubic=function(e,t,r){return e+(t-e)*(--r*r*r+1)},t.prototype.zoom=function(){if(0!==this.m_zoomDeltaRequested&&(this.m_targettedZoom=Math.max(Math.min(this.zoomLevelTargetted+this.m_zoomDeltaRequested,this.maxZoomLevel),this.minZoomLevel),this.m_zoomDeltaRequested=0),this.inertiaEnabled){this.m_zoomIsAnimated||(this.m_zoomIsAnimated=!0,this.mapView.addEventListener(l.MapViewEventNames.AfterRender,this.zoom));var e=performance.now();this.m_zoomAnimationTime=(e-this.m_zoomAnimationStartTime)/1e3,this.m_zoomAnimationTime>this.zoomInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_zoomAnimationTime=this.zoomInertiaDampingDuration,this.stopZoom()):this.m_needsRenderLastFrame=!0}this.currentZoom=this.inertiaEnabled?this.easeOutCubic(this.m_startZoom,this.zoomLevelTargetted,Math.min(1,this.m_zoomAnimationTime/this.zoomInertiaDampingDuration)):this.zoomLevelTargetted,l.MapViewUtils.zoomOnTargetPosition(this.mapView,this.m_zoomTargetNormalizedCoordinates.x,this.m_zoomTargetNormalizedCoordinates.y,this.currentZoom),this.updateMapView()},t.prototype.stopZoom=function(){this.mapView.removeEventListener(l.MapViewEventNames.AfterRender,this.zoom),this.m_zoomIsAnimated=!1,this.m_targettedZoom=this.m_currentZoom=void 0},t.prototype.pan=function(){if(this.m_state!==o.NONE||0!==this.m_lastAveragedPanDistance){this.inertiaEnabled&&!this.m_panIsAnimated&&(this.m_panIsAnimated=!0,this.mapView.addEventListener(l.MapViewEventNames.AfterRender,this.pan));var e=this.inertiaEnabled&&this.m_state===o.NONE&&this.m_lastAveragedPanDistance>0;if(e){var t=performance.now();this.m_panAnimationTime=(t-this.m_panAnimationStartTime)/1e3,this.m_panAnimationTime>this.panInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_panAnimationTime=this.panInertiaDampingDuration,this.mapView.removeEventListener(l.MapViewEventNames.AfterRender,this.pan),this.m_panIsAnimated=!1):this.m_needsRenderLastFrame=!0;var r=this.m_panAnimationTime/this.panInertiaDampingDuration;this.m_currentInertialPanningSpeed=this.easeOutCubic(this.m_lastAveragedPanDistance,0,Math.min(1,r)),0===this.m_currentInertialPanningSpeed&&(this.m_lastAveragedPanDistance=0),this.m_panDistanceFrameDelta.copy(this.m_lastPanVector).setLength(this.m_currentInertialPanningSpeed)}else{this.m_lastPanVector.copy(this.m_panDistanceFrameDelta);var i=this.m_lastPanVector.length();this.m_currentPanDistanceIndex=(this.m_currentPanDistanceIndex+1)%5,this.m_recentPanDistances[this.m_currentPanDistanceIndex]=i,this.m_lastAveragedPanDistance=this.m_recentPanDistances.reduce(function(e,t){return e+t})/5}l.MapViewUtils.pan(this.mapView,this.m_panDistanceFrameDelta.x,this.m_panDistanceFrameDelta.y),e||this.m_panDistanceFrameDelta.set(0,0,0),this.updateMapView()}},t.prototype.bindInputEvents=function(e){var t=this.contextMenu.bind(this),r=this.mouseDown.bind(this),i=this.mouseWheel.bind(this),n=this.touchStart.bind(this),o=this.touchEnd.bind(this),a=this.touchMove.bind(this);e.addEventListener("contextmenu",t,!1),e.addEventListener("mousedown",r,!1),e.addEventListener("wheel",i,!1),e.addEventListener("touchstart",n,!1),e.addEventListener("touchend",o,!1),e.addEventListener("touchmove",a,!1),this.dispose=function(){e.removeEventListener("contextmenu",t,!1),e.removeEventListener("mousedown",r,!1),e.removeEventListener("wheel",i,!1),e.removeEventListener("touchstart",n,!1),e.removeEventListener("touchend",o,!1),e.removeEventListener("touchmove",a,!1)}},t.prototype.updateMapView=function(){this.dispatchEvent(d),this.mapView.update()},t.prototype.mouseDown=function(e){if(!1!==this.enabled&&!e.shiftKey&&!e.ctrlKey&&(e.preventDefault(),e.stopPropagation(),this.m_state===o.NONE)){if(0===e.button)this.m_state=o.PAN;else if(1===e.button)this.m_state=o.ROTATE;else{if(2!==e.button||!this.tiltEnabled)return;this.m_state=o.ORBIT}this.dispatchEvent(h),this.m_lastMousePosition.setX(e.offsetX),this.m_lastMousePosition.setY(e.offsetY);var t=this.mouseMove.bind(this),r=this.mouseUp.bind(this);window.addEventListener("mousemove",t,!1),window.top.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",r,!1),window.top.addEventListener("mouseup",r,!1),this.m_cleanupMouseEventListeners=function(){window.removeEventListener("mousemove",t),window.top.removeEventListener("mousemove",t),window.removeEventListener("mouseup",r),window.top.removeEventListener("mouseup",r)}}},t.prototype.mouseMove=function(e){!1!==this.enabled&&(this.m_state===o.PAN?this.panFromTo(this.m_lastMousePosition.x,this.m_lastMousePosition.y,this.m_lastMousePosition.x+e.movementX,this.m_lastMousePosition.y+e.movementY):this.m_state===o.ROTATE?this.rotate(-this.rotationMouseDeltaFactor*e.movementX,this.rotationMouseDeltaFactor*e.movementY):this.m_state===o.ORBIT&&this.orbitFocusPoint(this.orbitingMouseDeltaFactor*e.movementX,-this.orbitingMouseDeltaFactor*e.movementY),this.m_lastMousePosition.setX(this.m_lastMousePosition.x+e.movementX),this.m_lastMousePosition.setY(this.m_lastMousePosition.y+e.movementY),this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation())},t.prototype.mouseUp=function(e){!1!==this.enabled&&(this.updateMapView(),e.preventDefault(),e.stopPropagation(),this.m_state=o.NONE,this.m_cleanupMouseEventListeners&&this.m_cleanupMouseEventListeners(),this.dispatchEvent(f))},t.prototype.mouseWheel=function(e){if(!1!==this.enabled){this.dispatchEvent(h),this.m_startZoom=this.currentZoom,this.m_zoomDeltaRequested=e.deltaY>0?-this.zoomLevelDeltaOnMouseWheel:this.zoomLevelDeltaOnMouseWheel,this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastAveragedPanDistance=0;var t=c.getWidthAndHeightFromCanvas(this.domElement),r=t.width,i=t.height;this.m_zoomTargetNormalizedCoordinates=c.calculateNormalizedDeviceCoordinates(e.offsetX,e.offsetY,r,i),this.m_zoomAnimationStartTime=performance.now(),this.zoom(),e.preventDefault(),e.stopPropagation(),this.dispatchEvent(f)}},t.prototype.calculateAngleFromTouchPointsInWorldspace=function(){if(this.m_touchState.touches.length<2)return 0;var e=this.m_touchState.touches[1].currentWorldPosition.x-this.m_touchState.touches[0].currentWorldPosition.x,t=this.m_touchState.touches[1].currentWorldPosition.y-this.m_touchState.touches[0].currentWorldPosition.y;return Math.atan2(t,e)},t.prototype.calculatePinchDistanceInWorldSpace=function(){if(this.m_touchState.touches.length<2)return 0;var e=this.m_touchState.touches[0].initialWorldPosition.clone().sub(this.m_touchState.touches[1].initialWorldPosition).length();return this.m_touchState.touches[0].currentWorldPosition.clone().sub(this.m_touchState.touches[1].currentWorldPosition).length()-e},t.prototype.convertTouchPoint=function(e){var t=new u.Vector2(e.pageX,e.pageY),r=c.getWidthAndHeightFromCanvas(this.domElement),i=r.width,n=r.height,o=c.calculateNormalizedDeviceCoordinates(t.x,t.y,i,n),a=l.MapViewUtils.rayCastWorldCoordinates(this.mapView,o.x,o.y);return a?{currentTouchPoint:t.clone(),lastTouchPoint:t.clone(),currentWorldPosition:a.clone(),initialWorldPosition:a.clone()}:null},t.prototype.setTouchState=function(e){this.m_touchState.touches=[];for(var t=0;t<e.length;++t){var r=this.convertTouchPoint(e[t]);r&&this.m_touchState.touches.push(r)}0!==this.m_touchState.touches.length&&(this.updateTouchState(),this.m_touchState.initialRotation=this.m_touchState.currentRotation)},t.prototype.updateTouchState=function(){this.m_touchState.currentRotation=this.calculateAngleFromTouchPointsInWorldspace()},t.prototype.updateTouches=function(e){for(var t=Math.min(e.length,this.m_touchState.touches.length),r=0;r<t;++r){var i=this.m_touchState.touches[r],n=this.convertTouchPoint(e[r]);n&&(n.initialWorldPosition=i.initialWorldPosition,n.lastTouchPoint=i.currentTouchPoint,this.m_touchState.touches[r]=n)}},t.prototype.touchStart=function(e){!1!==this.enabled&&(this.m_state=o.TOUCH,this.dispatchEvent(h),this.setTouchState(e.touches),e.preventDefault(),e.stopPropagation())},t.prototype.touchMove=function(e){if(!1!==this.enabled){if(this.updateTouches(e.touches),this.updateTouchState(),this.m_touchState.touches.length<=2){var t=this.m_touchState.touches[0].currentWorldPosition.clone(),r=this.m_touchState.touches[0].initialWorldPosition.clone();this.m_panDistanceFrameDelta=r.sub(t),this.m_startZoom=this.m_targettedZoom=this.currentZoom,this.m_panAnimationStartTime=performance.now(),this.pan()}if(2===this.m_touchState.touches.length){var i=this.m_touchState.currentRotation-this.m_touchState.initialRotation;this.rotate(s.MathUtils.radToDeg(i),0),this.moveAlongTheViewDirection(this.calculatePinchDistanceInWorldSpace())}if(3===this.m_touchState.touches.length&&this.tiltEnabled){var n=this.m_touchState.touches[0],o=n.lastTouchPoint.clone().sub(n.currentTouchPoint);this.orbitFocusPoint(this.orbitingTouchDeltaFactor*o.x,this.orbitingTouchDeltaFactor*o.y)}this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}},t.prototype.touchEnd=function(e){!1!==this.enabled&&(this.m_state=o.NONE,this.setTouchState(e.touches),this.dispatchEvent(f),this.updateMapView(),e.preventDefault(),e.stopPropagation())},t.prototype.contextMenu=function(e){e.preventDefault()},t.prototype.panFromTo=function(e,t,r,i){var n=c.getWidthAndHeightFromCanvas(this.domElement),o=n.width,a=n.height,s=c.calculateNormalizedDeviceCoordinates(e,t,o,a),u=c.calculateNormalizedDeviceCoordinates(r,i,o,a),d=l.MapViewUtils.rayCastWorldCoordinates(this.mapView,u.x,u.y),h=l.MapViewUtils.rayCastWorldCoordinates(this.mapView,s.x,s.y);d&&h&&(this.m_panDistanceFrameDelta=h.sub(d),this.stopZoom(),this.m_panAnimationStartTime=performance.now(),this.pan())},t.prototype.constrainPitchAngle=function(e,t){var r=s.MathUtils.clamp(e+t,this.m_minPitchAngle,this.m_maxPitchAngle);return this.tiltEnabled&&r<=this.m_maxPitchAngle&&r>=this.m_minPitchAngle&&(e=r),e},t.prototype.getMinDelta=function(e){var t=this;if(this.mapView.camera.position.z<this.minCameraHeight&&e>0)return 0;for(var r=function(e,r){var i=r.position,n=r.quaternion,o=new u.Quaternion,a=new u.Vector3,d=new u.Object3D;d.position.set(i.x,i.y,i.z),d.quaternion.set(n.x,n.y,n.z,n.w),d.getWorldDirection(a);var h=c.directionToAzimuthAltitude(a),f=1/Math.sin(h.altitude)*d.position.z,p=l.MapViewUtils.extractYawPitchRoll(d.quaternion),m=s.MathUtils.degToRad(e),v=t.constrainPitchAngle(p.pitch,m);o.setFromAxisAngle(y,v),d.quaternion.copy(o),d.matrixWorldNeedsUpdate=!0,d.getWorldDirection(a);var g=c.directionToAzimuthAltitude(a);return Math.sin(g.altitude)*f},i=e,n=0;n<10;n++){if(!(r(i,this.mapView.camera)<this.minCameraHeight))return i;i*=.5}return i},t}(u.EventDispatcher);t.MapControls=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);function n(e,t){if(null==e||""===e)return t;if(!e.match(o))return t;var r=Number.parseInt(e,10);return isNaN(r)?t:r}t.calculateNormalizedDeviceCoordinates=function(e,t,r,n){return new i.Vector2(e/r*2-1,-t/n*2+1)},t.directionToAzimuthAltitude=function(e){var t=e.clone().normalize(),r=new i.Vector2(t.x,t.y),n=new i.Vector2(r.length(),t.z).normalize();return{azimuth:Math.atan2(r.x,r.y),altitude:-Math.asin(n.y)}},t.azimuthAltitudeToDirection=function(e,t){e=e,t=t;var r=new i.Vector3,n=Math.cos(t);return r.setX(Math.sin(e)*n),r.setY(Math.cos(e)*n),r.setZ(Math.sin(t)),r},t.safeParseDecimalInt=n;var o=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:n(e.style.width,e.clientWidth),height:n(e.style.height,e.clientHeight)}}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),r(32);var o=r(2),a=r(7),s=r(1).LoggerManager.instance.create("TileLoader"),l=function(){function e(e,t,r,i,n){this.dataSource=e,this.tileKey=t,this.dataProvider=r,this.tileDecoder=i,this.priority=n,this.state=a.TileLoaderState.Initialized,this.loadAbortController=new AbortController}return e.prototype.loadAndDecode=function(){switch(this.state){case a.TileLoaderState.Loading:return this.donePromise;case a.TileLoaderState.Disposed:return s.warn("cannot load in disposed state"),Promise.resolve(a.TileLoaderState.Disposed);case a.TileLoaderState.Ready:case a.TileLoaderState.Failed:case a.TileLoaderState.Initialized:case a.TileLoaderState.Canceled:return this.ensureLoadingStarted(),this.donePromise;case a.TileLoaderState.Loaded:return this.startDecodeTile(),this.donePromise;case a.TileLoaderState.Decoding:return this.cancelDecoding(),this.ensureLoadingStarted(),this.donePromise}},e.prototype.waitSettled=function(){return this.donePromise?this.donePromise:Promise.resolve(this.state)},e.prototype.cancel=function(){switch(this.state){case a.TileLoaderState.Disposed:return void s.warn("attempting to cancel disposed TileLoader");case a.TileLoaderState.Loading:this.loadAbortController.abort(),this.loadAbortController=new AbortController;break;case a.TileLoaderState.Decoding:this.requestController&&(this.requestController.abort(),this.requestController=void 0)}this.onDone(a.TileLoaderState.Canceled)},e.prototype.dispose=function(){this.state!==a.TileLoaderState.Disposed&&(this.cancel(),this.state=a.TileLoaderState.Disposed)},Object.defineProperty(e.prototype,"isFinished",{get:function(){return this.state===a.TileLoaderState.Ready||this.state===a.TileLoaderState.Canceled||this.state===a.TileLoaderState.Failed},enumerable:!0,configurable:!0}),e.prototype.updatePriority=function(e){this.priority=e,void 0!==this.requestController&&(this.requestController.priority=e)},e.prototype.ensureLoadingStarted=function(){switch(this.state){case a.TileLoaderState.Ready:case a.TileLoaderState.Initialized:case a.TileLoaderState.Canceled:return void this.doStartLoad();case a.TileLoaderState.Loading:case a.TileLoaderState.Loaded:return void s.info("reusing already started load operation");case a.TileLoaderState.Decoding:return this.cancelDecoding(),void this.doStartLoad();case a.TileLoaderState.Disposed:return void s.warn("cannot load in disposed state")}},e.prototype.doStartLoad=function(){var e=this,t=this.loadAbortController.signal;this.dataProvider.getTile(this.tileKey,t).then(function(r){if(t.aborted){var i=new Error("Aborted");throw i.name="AbortError",i}e.onLoaded(r)}).catch(function(t){"AbortError"!==t.name&&"AbortError: Aborted"!==t.message&&e.onError(t)}),void 0===this.donePromise&&(this.donePromise=new Promise(function(t){e.resolveDonePromise=t})),this.state=a.TileLoaderState.Loading},e.prototype.onLoaded=function(e){this.state=a.TileLoaderState.Loaded,this.payload=e,(void 0===e.byteLength||0!==e.byteLength)&&e!=={}?this.startDecodeTile():this.onDone(a.TileLoaderState.Ready)},e.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=a.TileLoaderState.Decoding,this.payload=void 0;var r=new o.RequestController(this.priority);this.requestController=r;var i=this.dataSource;this.tileDecoder.decodeTile(t,this.tileKey,i.projection,this.dataSource.mapView.zoomLevel,r).then(function(t){r.signal.aborted||e.onDecoded(t)}).catch(function(t){"AbortError"!==t.name&&"AbortError: Aborted"!==t.message&&e.onError(t)})}else s.error("TileLoader#startDecodeTile: Cannot decode without payload")},e.prototype.onDecoded=function(e){this.decodedTile=e,this.onDone(a.TileLoaderState.Ready)},e.prototype.cancelDecoding=function(){void 0!==this.requestController&&(this.requestController.abort(),this.requestController=void 0)},e.prototype.onDone=function(e){this.resolveDonePromise&&(this.resolveDonePromise(e),this.resolveDonePromise=void 0,this.donePromise=void 0),this.state=e},e.prototype.onError=function(e){var t=this.dataSource;s.error("["+t.name+"]: failed to load tile "+this.tileKey.toHereTile(),e),this.error=e,this.onDone(a.TileLoaderState.Failed)},e}();t.TileLoader=l;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=a.TileLoaderState.Decoding,this.payload=void 0;var r=new o.RequestController(this.priority);this.requestController=r;var i=this.dataSource;this.tileDecoder.getTileInfo(t,this.tileKey,i.projection,this.dataSource.mapView.zoomLevel,r).then(function(t){r.signal.aborted||(e.tileInfo=t,e.onDone(a.TileLoaderState.Ready))}).catch(function(t){"AbortError"!==t.name&&"AbortError: Aborted"!==t.message&&e.onError(t)})}else s.error("TileInfoLoader#startDecodeTile: Cannot decode without payload")},t}(l);t.TileInfoLoader=u},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(76)),i(r(149)),i(r(77)),i(r(150))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),n=r(5),o=r(10),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=-Math.PI,r.min.y=.5*-Math.PI,r.min.z=e,r.max.x=Math.PI,r.max.y=.5*Math.PI,r.max.z=t,r},e.prototype.projectPoint=function(e,t){return t||(t={x:0,y:0,z:0}),t.x=e.longitude*a,t.y=e.latitude*a,t.z=e.altitude||0,t},e.prototype.unprojectPoint=function(e){return n.GeoCoordinates.fromRadians(e.y,e.x,e.z)},e.prototype.projectBox=function(e,t){return t||(t=o.MathUtils.newEmptyBox3()),this.projectPoint(new n.GeoCoordinates(e.south,e.west,e.minAltitude),t.min),this.projectPoint(new n.GeoCoordinates(e.north,e.east,e.maxAltitude),t.max),t},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)},e}();t.identityProjection=new s},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),o=function(){function e(e){this.tilingScheme=e}return e.prototype.visit=function(e){this.visitTileKey(n.TileKey.fromRowColumnLevel(0,0,0),e)},e.prototype.visitTileKey=function(e,t){var r,n;if(t(e,this.tilingScheme.getGeoBox(e)))try{for(var o=i(this.tilingScheme.getSubTileKeys(e)),a=o.next();!a.done;a=o.next()){var s=a.value;this.visitTileKey(s,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e}();t.QuadTree=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(38),n=r(41),o=r(17);t.hereTilingScheme=new o.TilingScheme(n.halfQuadTreeSubdivisionScheme,i.equirectangularProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(39),n=r(24),o=r(17);t.webMercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,i.webMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),n=r(24),o=r(17);t.mercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,i.mercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(88),o=r(51),a=o.MSAASampling.Level_1,s=o.MSAASampling.Level_4,l=function(){function e(e,t,r,l){void 0===l&&(l={msaaEnabled:!1}),this.m_readBuffer=new i.WebGLRenderTarget(e,t),this.m_msaaPass=new o.MSAARenderPass,this.m_msaaPass.enabled=void 0!==l&&!0===l.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===l.dynamicMsaaSamplingLevel?a:l.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===l.staticMsaaSamplingLevel?s:l.staticMsaaSamplingLevel,this.m_lowResPass=new n.LowResRenderPass(r),this.m_lowResPass.enabled=void 0!==r}return e.prototype.render=function(e,t,r,i){if(!i&&void 0!==this.m_lowResPass.pixelRatio){var n=void 0;return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,r,n,this.m_readBuffer)}if(e.getPixelRatio()>1.1)e.render(t,r);else{n=void 0;this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=i?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!0,this.m_msaaPass.render(e,t,r,n,this.m_readBuffer)):e.render(t,r,n)}},e.prototype.setSize=function(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),this.m_lowResPass.setSize(e,t)},Object.defineProperty(e.prototype,"lowResPixelRatio",{get:function(){return this.m_lowResPass.pixelRatio},set:function(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicMsaaSamplingLevel",{get:function(){return this.m_dynamicMsaaSamplingLevel},set:function(e){this.m_dynamicMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"msaaEnabled",{get:function(){return this.m_msaaPass.enabled},set:function(e){this.m_msaaPass.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"staticMsaaSamplingLevel",{get:function(){return this.m_staticMsaaSamplingLevel},set:function(e){this.m_staticMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),e}();t.MapRenderingManager=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=r(0),s=function(e){function t(t){var r=e.call(this)||this;return r.lowResPixelRatio=t,r.m_renderTarget=null,r.m_localCamera=new a.OrthographicCamera(-1,1,1,-1,0,1),r.m_quadScene=new a.Scene,r.m_quadUniforms=o.CopyShader.uniforms,r.m_quadMaterial=new o.CopyMaterial(r.m_quadUniforms),r.m_quad=new a.Mesh(new a.PlaneBufferGeometry(2,2),r.m_quadMaterial),r.m_savedWidth=0,r.m_savedHeight=0,r.m_quad.frustumCulled=!1,r.m_quadScene.add(r.m_quad),r.m_pixelRatio=t,r}return n(t,e),t.prototype.dispose=function(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return this.m_pixelRatio},set:function(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t,r,i,n){this.enabled&&void 0!==this.pixelRatio&&(null===this.m_renderTarget&&(this.m_savedWidth=n.width,this.m_savedHeight=n.height,this.m_renderTarget=new a.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1,e.render(t,r,this.m_renderTarget,!0),e.render(this.m_quadScene,this.m_localCamera,this.renderToScreen?void 0:i,!0))},t.prototype.setSize=function(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))},t}(r(29).Pass);t.LowResRenderPass=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(r){var i=this,n={};return void 0!==r&&void 0!==r.color&&(n.color=r.color),void 0!==r&&void 0!==r.lineWidth&&(n.lineWidth=r.lineWidth),void 0!==r&&void 0!==r.opacity&&(n.opacity=r.opacity),void 0!==r&&void 0!==r.fog&&(n.fog=r.fog),(i=e.call(this,n)||this).name="DashedLineMaterial",Object.assign(i.uniforms,{dashSize:new o.Uniform(t.DEFAULT_DASH_SIZE),gapSize:new o.Uniform(t.DEFAULT_GAP_SIZE)}),void 0!==r&&(void 0!==r.dashSize&&(i.dashSize=r.dashSize),void 0!==r.gapSize&&(i.gapSize=r.gapSize),void 0!==r.fog&&(i.fog=null!==r.fog)),i}return n(t,e),Object.defineProperty(t.prototype,"dashSize",{get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gapSize",{get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e,this.updateDashedFeature()},enumerable:!0,configurable:!0}),t.prototype.updateDashedFeature=function(){this.defines.DASHED_LINE=this.gapSize>0?1:0},t.DEFAULT_DASH_SIZE=1,t.DEFAULT_GAP_SIZE=1,t}(r(47).SolidLineMaterial);t.DashedLineMaterial=a},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=new Array),this.priority=e,this.elements=t}return e.prototype.clone=function(){return new e(this.priority,this.elements.slice())},e}();t.PriorityListGroup=n;var o=function(){function e(){this.groups=new Map}return e.prototype.add=function(e){this.getGroup(e.priority).elements.push(e)},e.prototype.remove=function(e){var t=this.getGroup(e.priority);if(void 0!==t){var r=t.elements.indexOf(e);if(r>=0){if(t.elements.splice(r,1),0===t.elements.length){var i=Math.floor(e.priority);this.groups.delete(i)}return!0}}return!1},e.prototype.clear=function(){this.groups.clear()},e.prototype.merge=function(e){var t,r;try{for(var n=i(e.groups),o=n.next();!o.done;o=n.next()){var a=o.value,s=this.findGroup(a[1].priority);void 0!==s?s.elements=s.elements.concat(a[1].elements):this.groups.set(Math.floor(a[1].priority),a[1].clone())}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this},Object.defineProperty(e.prototype,"sortedGroups",{get:function(){var e,t,r=[];try{for(var n=i(this.groups),o=n.next();!o.done;o=n.next()){var a=o.value;r.push(a[1])}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r.sort(function(e,t){return t.priority-e.priority}),r},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){var t,r;try{for(var n=i(this.groups),o=n.next();!o.done;o=n.next()){o.value[1].elements.forEach(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.findGroup=function(e){var t=Math.floor(e);return this.groups.get(t)},e.prototype.getGroup=function(e){var t=this.findGroup(e);if(void 0===t){var r=Math.floor(e);t=new n(r),this.groups.set(r,t)}return t},e}();t.GroupedPriorityList=o},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(48)),i(r(27)),i(r(49)),i(r(92)),i(r(94)),i(r(50))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(93),n=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance||(this.m_instance=new i.LoggerManagerImpl)},enumerable:!0,configurable:!0}),e}();t.LoggerManager=n},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(48),o=r(49),a=r(50),s=function(){function e(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new n.ConsoleChannel:new a.WorkerChannel}return e.prototype.getLoggerNames=function(){return this.m_loggers.map(function(e){return e.name})},e.prototype.getLogger=function(e){return this.m_loggers.find(function(t){return t.name===e})},e.prototype.create=function(e,t){var r=new o.Logger(e,this.channel,t);return this.m_loggers.push(r),r},e.prototype.dispose=function(e){var t=this.m_loggers.indexOf(e);if(t<0)throw new Error('Cannot unregister "'+e+'" : no such logger registered.');this.m_loggers.splice(t,1)},e.prototype.updateAll=function(e){var t,r;try{for(var n=i(this.m_loggers),o=n.next();!o.done;o=n.next()){o.value.update(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.update=function(e,t){var r,n;try{for(var o=i(this.m_loggers),a=o.next();!a.done;a=o.next()){var s=a.value;s.name===e&&s.update(t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e.prototype.enableAll=function(e){var t,r;try{for(var n=i(this.m_loggers),o=n.next();!o.done;o=n.next()){o.value.enabled=e}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.enable=function(e,t){this.update(e,{enabled:t})},e.prototype.setLogLevelForAll=function(e){var t,r;try{for(var n=i(this.m_loggers),o=n.next();!o.done;o=n.next()){o.value.level=e}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setLogLevel=function(e,t){this.update(e,{level:t})},e.prototype.setChannel=function(e){this.channel=e},e}();t.LoggerManagerImpl=s},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.channels=[],this.channels=e}return e.prototype.error=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.error.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.debug=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.debug.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.info=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.info.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.log=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.log.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.trace=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.trace.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.warn=function(e){for(var t,r,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];try{for(var s=i(this.channels),l=s.next();!l.done;l=s.next()){var u=l.value;u.warn.apply(u,o([e],n))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e}();t.MultiChannel=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=e,this.y=t,this.w=r,this.h=i}return e.prototype.set=function(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i},e.prototype.contains=function(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t},e.prototype.intersects=function(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y},e}();function r(e,t,r,i){return(e-r)*(e-r)+(t-i)*(t-i)}e.Box=t,e.distSquared=r,e.computeSquaredLineLength=function(e){for(var t=0,r=e.length-3,i=0;i<r;i+=2){var n=e[i+2]-e[i],o=e[i+3]-e[i+1];t+=n*n+o*o}return t},e.distToSegmentSquared=function(e,t,i,n,o,a){var s=r(i,n,o,a);if(0===s)return r(e,t,i,n);var l=((e-i)*(o-i)+(t-n)*(a-n))/s;return r(e,t,i+(l=Math.max(0,Math.min(1,l)))*(o-i),n+l*(a-n))}}(t.Math2D||(t.Math2D={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){return e<t?t:e>r?r:e}e.clamp=t,e.smoothStep=function(e,r,i){return(i=t((i-e)/(r-e),0,1))*i*(3-2*i)},e.smootherStep=function(e,r,i){return(i=t((i-e)/(r-e),0,1))*i*i*(i*(6*i-15)+10)},e.lerp=function(e,t,r,i,n){return(e-t)*(n-i)/(r-t)+i},e.min2=function(e,t){var r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.min(r,t)),r},e.max2=function(e,t){var r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.max(r,t)),r},e.isClamped=function(e,t,r){return!(void 0!==t&&e<t||void 0!==r&&e>r)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){e.prototype[r]=t.prototype[r]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t.prototype,r);void 0!==i&&void 0===i.get&&(e.prototype[r]=t.prototype[r])})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!0;t.assert=function(e,t){if(!i&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!i&&null==e)throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined or null");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.now=function(){return e.nowFunc()},e.getNowFunc=function(){return"undefined"!=typeof performance&&void 0!==performance.now?function(){return performance.now()}:function(){return(new Date).getTime()}},e.instance=new e,e.nowFunc=e.getNowFunc(),e}();t.PerformanceTimer=i},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(){for(var e,t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];try{for(var o=n(r),a=o.next();!a.done;a=o.next()){var s=a.value;if(null!=s)return s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.mergeWithOptions=function(e,t){var r=i({},e);if(null==t)return r;for(var n in e)if(e.hasOwnProperty(n)){var o=t[n];null!=o&&(r[n]=o)}return r}},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultUrlResolver=function(e){return void 0!==i?i(e):e},t.setDefaultUrlResolver=function(e){i=e},t.composeUrlResolvers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reduce(function(e,t){return void 0!==t?t(e):e},t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUrl=function(e,t){return i.test(t)?t:t.startsWith("/")?o(e)+t:(t.startsWith("./")&&(t=t.substr(2)),n(e)+t)};var i=new RegExp("^(?:[a-z]+:)?//","i");function n(e){if(void 0===e)return"./";var t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}function o(e){if(void 0===e)return"";var t=a(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function a(e){var t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),r=e.match(t);if(!r)throw new Error("getUrlHostAndProtocol: unable to parse URL '"+e+"'");return{protocol:r[1],host:r[2]}}t.baseUrl=n,t.getUrlOrigin=o,t.getUrlHostAndProtocol=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(26),s="\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\nvarying vec3 vColor;\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",l="\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",u=function(e){function t(r){var i=this,n={name:"EdgeMaterial",vertexShader:s,fragmentShader:l,uniforms:{edgeColor:new o.Uniform(new o.Color(t.DEFAULT_COLOR)),edgeColorMix:new o.Uniform(t.DEFAULT_COLOR_MIX),fadeNear:new o.Uniform(a.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new o.Uniform(a.FadingFeature.DEFAULT_FADE_FAR)},depthWrite:!1};return(i=e.call(this,n)||this).transparent=!0,a.FadingFeature.patchGlobalShaderChunks(),void 0!==r&&(void 0!==r.color&&i.color.set(r.color),void 0!==r.colorMix&&(i.colorMix=r.colorMix),void 0!==r.fadeNear&&(i.fadeNear=r.fadeNear),void 0!==r.fadeFar&&(i.fadeFar=r.fadeFar)),i}return n(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.edgeColor.value},set:function(e){this.uniforms.edgeColor.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorMix",{get:function(){return this.uniforms.edgeColorMix.value},set:function(e){this.uniforms.edgeColorMix.value=e,this.updateColorMixFeature()},enumerable:!0,configurable:!0}),t.prototype.updateColorMixFeature=function(){this.defines.USE_COLOR=this.colorMix>0?1:0},Object.defineProperty(t.prototype,"fadeNear",{get:function(){return this.uniforms.fadeNear.value},set:function(e){this.uniforms.fadeNear.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeFar",{get:function(){return this.uniforms.fadeFar.value},set:function(e){this.uniforms.fadeFar.value=e,void 0!==e&&e>0?(this.needsUpdate=this.needsUpdate||void 0===this.defines.USE_FADING,this.defines.USE_FADING=""):(this.needsUpdate=this.needsUpdate||void 0!==this.defines.USE_FADING,delete this.defines.USE_FADING)},enumerable:!0,configurable:!0}),t.DEFAULT_COLOR=0,t.DEFAULT_COLOR_MIX=0,t}(o.RawShaderMaterial);t.EdgeMaterial=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(28),s="\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",l="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",u=function(e){function t(r){var i=this;Object.assign(o.ShaderChunk,a.default);var n={name:"HighPrecisionLineMaterial",vertexShader:s,fragmentShader:l,uniforms:{diffuse:new o.Uniform(new o.Color(t.DEFAULT_COLOR)),opacity:new o.Uniform(t.DEFAULT_OPACITY),u_mvp:new o.Uniform(new o.Matrix4),u_eyepos:new o.Uniform(new o.Vector3),u_eyepos_lowpart:new o.Uniform(new o.Vector3)}};return Object.assign(n,r),(i=e.call(this,n)||this).type="HighPrecisionLineMaterial",i.isHighPrecisionLineMaterial=!0,i.dimensionality=3,void 0!==r&&(void 0!==r.color&&i.color.set(r.color),void 0!==r.opacity&&(i.opacity=r.opacity)),i.updateTransparencyFeature(),i}return n(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n}":s)},t.prototype.updateTransparencyFeature=function(){this.transparent=this.opacity<1},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t}(o.RawShaderMaterial);t.HighPrecisionLineMaterial=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(28),s="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",l=function(e){function t(r){var i=this;Object.assign(o.ShaderChunk,a.default);var n=r;return(i=e.call(this,n)||this).type="HighPrecisionPointMaterial",i.vertexShader=s,i.fragmentShader=o.ShaderChunk.points_frag,i.fog=!1,i.uniforms={diffuse:new o.Uniform(new o.Color(t.DEFAULT_COLOR)),opacity:new o.Uniform(t.DEFAULT_OPACITY),size:new o.Uniform(t.DEFAULT_SIZE),scale:new o.Uniform(t.DEFAULT_SCALE),map:new o.Uniform(new o.Texture),uvTransform:new o.Uniform(new o.Matrix3),u_mvp:new o.Uniform(new o.Matrix4),u_eyepos:new o.Uniform(new o.Vector3),u_eyepos_lowpart:new o.Uniform(new o.Vector3)},i.isHighPrecisionPointMaterial=!0,i.dimensionality=3,void 0!==r&&(void 0!==r.color&&i.color.set(r.color),void 0!==r.opacity&&(i.opacity=r.opacity),void 0!==r.size&&(i.size=r.size),void 0!==r.scale&&(i.scale=r.scale),void 0!==r.uvTransform&&(i.uvTransform=r.uvTransform),void 0!==r.map&&(i.map=r.map)),i}return n(t,e),Object.defineProperty(t.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvTransform",{get:function(){return this.uniforms.uvTransform.value},set:function(e){this.uniforms.uvTransform.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}":s)},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t.DEFAULT_SIZE=1,t.DEFAULT_SCALE=1,t}(o.PointsMaterial);t.HighPrecisionPointMaterial=l,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",s="\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor.a;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",l=function(e){function t(t){var r={name:"IconMaterial",vertexShader:a,fragmentShader:s,uniforms:{map:new o.Uniform(t.map)},depthTest:!0,depthWrite:!0,transparent:!0,vertexColors:o.VertexColors,premultipliedAlpha:!0,blending:o.NormalBlending};return e.call(this,r)||this}return n(t,e),Object.defineProperty(t.prototype,"map",{get:function(){return this.uniforms.map.value},enumerable:!0,configurable:!0}),t}(o.RawShaderMaterial);t.IconMaterial=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a="\nuniform float size;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",s="\nuniform vec3 diffuse;\n\nvoid main() {\n    float alpha = 1.0;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",l=1,u=function(e){function t(t){void 0===t&&(t={});var r=this;return t.depthTest=!1,(r=e.call(this,t)||this).isCirclePointsMaterial=!0,r.type="CirclePointsMaterial",r.vertexShader=a,r.fragmentShader=s,r.transparent=!0,r.m_size=t.size||l,r.m_color=new o.Color,r.uniforms={diffuse:new o.Uniform(r.m_color),size:new o.Uniform(r.m_size)},r.extensions.derivatives=!0,r}return n(t,e),Object.defineProperty(t.prototype,"size",{get:function(){return this.m_size},set:function(e){this.m_size=e,this.uniforms.size.value=e,this.needsUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return"#"+this.m_color.getHexString()},set:function(e){this.m_color.set(e),this.uniforms.diffuse.value.set(this.m_color),this.needsUpdate=!0},enumerable:!0,configurable:!0}),t}(o.ShaderMaterial);t.CirclePointsMaterial=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(46),s=function(e){function t(t){return e.call(this,{uniforms:t,vertexShader:a.CopyShader.vertexShader,fragmentShader:a.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:o.AdditiveBlending,depthTest:!1,depthWrite:!1})||this}return n(t,e),t}(o.ShaderMaterial);t.MSAAMaterial=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),l=r(1),u={type:"update"},c=function(e){function t(r,i){var n=e.call(this)||this;return n.enabled=!0,n.cacheable=!1,n.addTileBackground=!0,n.tileBackgroundColor=void 0,n.tileBackgroundIsVisible=!1,void 0!==r&&0!==r.length||(r="anonymous-datasource#"+ ++t.uniqueNameCounter),n.name=r,n.styleSetName=i,n}return n(t,e),Object.defineProperty(t.prototype,"styleSetName",{get:function(){return this.m_styleSetName},set:function(e){this.m_styleSetName=e,void 0!==this.m_mapView&&void 0!==e&&void 0!==this.m_mapView.theme.styles&&this.setStyleSet(this.m_mapView.theme.styles[e])},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.ready=function(){return!0},Object.defineProperty(t.prototype,"mapView",{get:function(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this.mapView.projection},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return o(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},t.prototype.attach=function(e){this.m_mapView=e},t.prototype.detach=function(e){l.assert(this.m_mapView===e),this.m_mapView=void 0},t.prototype.setStyleSet=function(e,t){},t.prototype.setLanguages=function(e){},t.prototype.updateTile=function(e){},t.prototype.shouldPreloadTiles=function(){return!1},Object.defineProperty(t.prototype,"minZoomLevel",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoomLevel",{get:function(){return 20},enumerable:!0,configurable:!0}),t.prototype.getDisplayZoomLevel=function(e){return s.Math.clamp(e,this.minZoomLevel,this.maxZoomLevel)},t.prototype.shouldRender=function(e,t){return t.level===e},t.prototype.shouldRenderText=function(e,t){return!0},t.prototype.requestUpdate=function(){this.dispatchEvent(u)},t.uniqueNameCounter=0,t}(s.EventDispatcher);t.DataSource=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),l=r(53),u=r(0),c=s.LoggerManager.instance.create("Theme"),d=function(){function e(){}return e.prototype.lookup=function(e){},e.prototype.unmap=function(){return{}},e}();t.Env=d;var h=function(e){function t(t,r,i){var n=e.call(this)||this;return n.name=t,n.value=r,n.parent=i,n}return n(t,e),t.prototype.lookup=function(e){return e===this.name?this.value:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};return e[this.name]=this.value,e},t}(d);t.Bind=h,t.EmptyEnv={lookup:function(e){},unmap:function(){return{}}};var f=function(e){function t(t,r){var i=e.call(this)||this;return i.entries=t,i.parent=r,i}return n(t,e),t.prototype.lookup=function(e){var t=this.entries[e];return void 0!==t?t:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};for(var t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e},t}(d);t.MapEnv=f;var p=function(){function e(e){this.kind=e}return e.parse=function(e){return new I(e).parse()},e}();t.Expr=p;var m,v,y=function(e){function t(t){var r=e.call(this,"var")||this;return r.name=t,r}return n(t,e),t.prototype.evaluate=function(e){return e.lookup(this.name)},t}(p),g=function(e){function t(t){var r=e.call(this,"number")||this;return r.value=t,r}return n(t,e),t.prototype.evaluate=function(){return this.value},t}(p),_=function(e){function t(t){var r=e.call(this,"string")||this;return r.value=t,r}return n(t,e),t.prototype.evaluate=function(){return this.value},t}(p),b=function(e){function t(t){var r=e.call(this,"has")||this;return r.attribute=t,r}return n(t,e),t.prototype.evaluate=function(e){return void 0!==e.lookup(this.attribute)},t}(p),x=function(e){function t(t,r){var i=e.call(this,"in")||this;return i.value=t,i.elements=r,i}return n(t,e),t.prototype.evaluate=function(e){var t,r,i=this.value.evaluate(e);try{for(var n=o(this.elements),a=n.next();!a.done;a=n.next()){if(i===a.value.evaluate(e))return!0}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!1},t}(p),w=function(e){function t(t){var r=e.call(this,"!")||this;return r.expr=t,r}return n(t,e),t.prototype.evaluate=function(e){return!this.expr.evaluate(e)},t}(p),S=function(e){function t(t,r,i){var n=e.call(this,t)||this;return n.op=t,n.left=r,n.right=i,n}return n(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e),r=this.right.evaluate(e);switch(this.op){case"~=":return"string"==typeof t&&"string"==typeof r&&-1!==t.indexOf(r);case"^=":return"string"==typeof t&&"string"==typeof r&&t.startsWith(r);case"$=":return"string"==typeof t&&"string"==typeof r&&t.endsWith(r);case"==":return t===r;case"!=":return t!==r;case"<":return void 0!==t&&void 0!==r?t<r:void 0;case">":return void 0!==t&&void 0!==r?t>r:void 0;case"<=":return void 0!==t&&void 0!==r?t<=r:void 0;case">=":return void 0!==t&&void 0!==r?t>=r:void 0}throw new Error("invalid relational op "+this.op)},t}(p),T=function(e){function t(t,r,i){var n=e.call(this,t)||this;return n.op=t,n.left=r,n.right=i,n}return n(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e);switch(this.op){case"||":return t||this.right.evaluate(e);case"&&":return t&&this.right.evaluate(e)}throw new Error("invalid logical op "+this.op)},t}(p);function C(e){switch(e){case m.Tab:case m.Lf:case m.Cr:case m.Space:return!0;default:return!1}}function P(e){return e>=m._0&&e<=m._9}function E(e){return e>=m.a&&e<=m.z||e>=m.A&&e<=m.Z}function M(e){return function(e){return E(e)||P(e)}(e)||e===m._||e===m.Dollar||e===m.Dot||e===m.LBracket||e===m.RBracket}function O(e){switch(e){case v.Eof:return"eof";case v.Error:return"error";case v.Identifier:return"identifier";case v.Number:return"number";case v.String:return"string";case v.Comma:return",";case v.LParen:return"(";case v.RParen:return")";case v.LBracket:return"[";case v.RBracket:return"]";case v.Exclaim:return"!";case v.TildeEqual:return"~=";case v.CaretEqual:return"^=";case v.DollarEqual:return"$=";case v.EqualEqual:return"==";case v.ExclaimEqual:return"!=";case v.Less:return"<";case v.Greater:return">";case v.LessEqual:return"<=";case v.GreaterEqual:return">=";case v.BarBar:return"||";case v.AmpAmp:return"&&";default:throw new Error("invalid token "+e)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(m||(m={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(v||(v={}));var A=function(){function e(e){this.code=e,this.m_token=v.Error,this.m_index=0,this.m_char=m.Lf}return e.prototype.token=function(){return this.m_token},e.prototype.text=function(){return this.m_text||""},e.prototype.next=function(){if(this.m_token=this.yylex(),this.m_token===v.Error)throw new Error("unexpected character "+this.m_char);return this.m_token},e.prototype.yyinp=function(){this.m_char=this.code.codePointAt(this.m_index++)||0},e.prototype.yylex=function(){for(this.m_text=void 0;C(this.m_char);)this.yyinp();if(0===this.m_char)return v.Eof;var e=this.m_char;switch(this.yyinp(),e){case m.LParen:return v.LParen;case m.RParen:return v.RParen;case m.LBracket:return v.LBracket;case m.RBracket:return v.RBracket;case m.Comma:return v.Comma;case m.SingleQuote:case m.DoubleQuote:for(var t=this.m_index-1;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),v.String;case m.Exclaim:return this.m_char===m.Equal?(this.yyinp(),v.ExclaimEqual):v.Exclaim;case m.Caret:return this.m_char===m.Equal?(this.yyinp(),v.CaretEqual):v.Error;case m.Tilde:return this.m_char===m.Equal?(this.yyinp(),v.TildeEqual):v.Error;case m.Equal:return this.m_char===m.Equal?(this.yyinp(),v.EqualEqual):v.Error;case m.Less:return this.m_char===m.Equal?(this.yyinp(),v.LessEqual):v.Less;case m.Greater:return this.m_char===m.Equal?(this.yyinp(),v.GreaterEqual):v.Greater;case m.Bar:return this.m_char===m.Bar?(this.yyinp(),v.BarBar):v.Error;case m.Amp:return this.m_char===m.Amp?(this.yyinp(),v.AmpAmp):v.Error;default:t=this.m_index-2;if(E(e)||e===m._||e===m.Dollar&&M(this.m_char)){for(;M(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),v.Identifier}if(P(e)){for(;P(this.m_char);)this.yyinp();if(this.m_char===m.Dot)for(this.yyinp();P(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),v.Number}if(e===m.Dollar)return this.m_char===m.Equal?(this.yyinp(),v.DollarEqual):v.Error}return v.Error},e}();function L(e){switch(e){case v.TildeEqual:return"~=";case v.CaretEqual:return"^=";case v.DollarEqual:return"$=";case v.EqualEqual:return"==";case v.ExclaimEqual:return"!=";default:return}}function R(e){switch(e){case v.Less:return"<";case v.Greater:return">";case v.LessEqual:return"<=";case v.GreaterEqual:return">=";default:return}}var I=function(){function e(e){this.lex=new A(e),this.lex.next()}return e.prototype.parse=function(){return this.parseLogicalOr()},e.prototype.yyexpect=function(e){if(this.lex.token()!==e)throw new Error("Syntax error: Expected token '"+O(e)+"' but found '"+O(this.lex.token())+"'");this.lex.next()},e.prototype.parsePrimary=function(){switch(this.lex.token()){case v.Identifier:var e=this.lex.text();if("has"!==e){var t=new y(e);return this.lex.next(),t}this.lex.next(),this.yyexpect(v.LParen);var r=this.lex.text();return this.yyexpect(v.Identifier),this.yyexpect(v.RParen),new b(r);case v.Number:t=new g(parseFloat(this.lex.text()));return this.lex.next(),t;case v.String:t=new _(this.lex.text());return this.lex.next(),t;case v.LParen:this.lex.next();t=this.parseLogicalOr();return this.yyexpect(v.RParen),t}throw new Error("Syntax error")},e.prototype.parseUnary=function(){return this.lex.token()===v.Exclaim?(this.lex.next(),new w(this.parseUnary())):this.parsePrimary()},e.prototype.parseRelational=function(){for(var e=this.parseUnary();;)if(this.lex.token()===v.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(v.LBracket);for(var t=[this.parsePrimary()];this.lex.token()===v.Comma;)this.lex.next(),t.push(this.parsePrimary());this.yyexpect(v.RBracket),e=new x(e,t)}else{var r=R(this.lex.token());if(void 0===r)break;this.lex.next();var i=this.parseUnary();e=new S(r,e,i)}return e},e.prototype.parseEquality=function(){for(var e=this.parseRelational();;){var t=L(this.lex.token());if(void 0===t)break;this.lex.next();var r=this.parseRelational();e=new S(t,e,r)}return e},e.prototype.parseLogicalAnd=function(){for(var e=this.parseEquality();this.lex.token()===v.AmpAmp;){this.lex.next();var t=this.parseEquality();e=new T("&&",e,t)}return e},e.prototype.parseLogicalOr=function(){for(var e=this.parseLogicalAnd();this.lex.token()===v.BarBar;){this.lex.next();var t=this.parseLogicalAnd();e=new T("||",e,t)}return e},e}();function F(e){!function(e){for(var t,r=function(r){e.zoomLevels.findIndex(function(t){return t===e.zoomLevels[r]})!==r&&(e.zoomLevels.splice(--r,1),e.values.splice(--r,1)),t=r},i=0;i<e.values.length;++i)r(i),i=t}(e);var t,r=new Float32Array(e.zoomLevels);switch(typeof e.values[0]){default:case"number":return t=new Float32Array(e.values),{interpolationMode:void 0!==e.interpolation?l.InterpolationMode[e.interpolation]:l.InterpolationMode.Discrete,zoomLevels:r,values:t};case"boolean":t=new Float32Array(e.values.length);for(var i=0;i<e.values.length;++i)t[i]=e.values[i]?1:0;return{interpolationMode:l.InterpolationMode.Discrete,zoomLevels:r,values:t};case"string":t=new Float32Array(3*e.values.length);for(i=0;i<e.values.length;++i)for(var n=+e.values[i].replace("#","0x"),o=[(n>>16&255)/255,(n>>8&255)/255,(n>>0&255)/255],a=0;a<3*e.values.length;++a)t[3*i+a]=o[a];return{interpolationMode:void 0!==e.interpolation?l.InterpolationMode[e.interpolation]:l.InterpolationMode.Discrete,zoomLevels:r,values:t}}}t.createLight=function(e){switch(e.type){case"ambient":return(t=new u.AmbientLight(e.color,e.intensity)).name=e.name,t;case"directional":var t;return(t=new u.DirectionalLight(e.color,e.intensity)).name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}};var D=function(){function e(e,t){var r,i,n=this;this.styleSet=e,this.validate=t,this.m_renderOrderBiasGroups=new Map,this.m_techniques=new Array;var s=0,l=function(e){var t,r;if(void 0!==e.renderOrderBiasGroup){var i=e.renderOrderBiasGroup?n.m_renderOrderBiasGroups.get(e.renderOrderBiasGroup):void 0;if(void 0!==e.renderOrderBiasRange&&void 0===i){void 0!==e.renderOrder&&c.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e);var u=a(e.renderOrderBiasRange,2),d=u[0],h=u[1];e.renderOrder=d<0?s+Math.abs(d):s,s+=Math.abs(d)+h,e.renderOrderBiasGroup&&n.m_renderOrderBiasGroups.set(e.renderOrderBiasGroup,e.renderOrder),s++}else i&&(void 0!==e.renderOrder&&c.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e),e.renderOrder=i)}if(void 0!==e.styles){n.validate&&(Array.isArray(e.styles)||c.error("ERROR: style.styles must be an Array:",e));try{for(var f=o(e.styles),p=f.next();!p.done;p=f.next()){var m=p.value;l(m)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}}else void 0!==e.technique&&void 0!==e.attr&&void 0===e.attr.renderOrder&&(e.attr._renderOrderAuto=s++)};try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var h=d.value;l(h)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}return e.prototype.getMatchingTechniques=function(e){var t,r,i=[],n=new Array;try{for(var a=o(this.styleSet),s=a.next();!s.done;s=a.next()){var l=s.value;if(this.validate&&0!==n.length)throw new Error("Internal error: style stack cleanup failed");if(this.processStyle(e,n,l,i))break}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return i},e.prototype.checkAddTechnique=function(e,t){var r=void 0===e._index?-1:e._index;return r<0?(t._index=r=this.m_techniques.length,this.m_techniques.push(t),e._index=r):t._index=r,r},Object.defineProperty(e.prototype,"techniques",{get:function(){return this.m_techniques},enumerable:!0,configurable:!0}),e.prototype.cleanupStyle=function(e,t){return"styles"===e?"[...]":e.startsWith("_")?void 0:t},e.prototype.processStyle=function(e,t,r,i){var n,a,s,l,u=this;if(void 0!==r.when&&(void 0===r._whenExpr&&(r._whenExpr=p.parse(r.when)),!r._whenExpr.evaluate(e)))return!1;if(void 0!==r.styles){if(r.debug&&c.log("\n======== style group =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle group:",JSON.stringify(r,this.cleanupStyle,2)),t.push(r),this.validate&&!Array.isArray(r.styles))return c.error("ERROR: style.styles must be an Array:",r),t.pop(),!1;try{for(var d=o(r.styles),h=d.next();!h.done;h=d.next()){var f=h.value;if(this.processStyle(e,t,f,i))return t.pop(),!0}}catch(e){n={error:e}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}t.pop()}else{if(void 0!==r.technique){if(void 0===r._index){var m={};m.name=r.technique;var v=function(e){void 0!==e.renderOrder&&(m.renderOrder=e.renderOrder),void 0!==e.transient&&(m.transient=e.transient),void 0!==e.renderOrderBiasProperty&&(m.renderOrderBiasProperty=e.renderOrderBiasProperty),void 0!==e.labelProperty&&(m.label=e.labelProperty),void 0!==e.renderOrderBiasRange&&(m.renderOrderBiasRange=e.renderOrderBiasRange),void 0!==e.renderOrderBiasGroup&&(m.renderOrderBiasGroup=e.renderOrderBiasGroup),void 0!==e.attr&&Object.getOwnPropertyNames(e.attr).forEach(function(t){if(u.validate&&("technique"===t?c.warn("WARNING: technique defined in attr (deprecated):",e):"renderOrder"===t&&c.warn("WARNING: renderOrder defined in attr (deprecated):",e)),void 0!==e.attr){var r=e.attr[t];if((i=r).values instanceof Array&&i.values.length>0&&void 0!==i.values[0]&&i.zoomLevels instanceof Array&&i.zoomLevels.length>0&&void 0!==i.zoomLevels[0]&&i.values.length===i.zoomLevels.length)switch(typeof r.values[0]){default:case"number":case"boolean":case"string":m[t]=F(r)}else m[t]=r}var i})};try{for(var y=o(t),g=y.next();!g.done;g=y.next()){v(f=g.value)}}catch(e){s={error:e}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}v(r),this.checkAddTechnique(r,m),i.push(m),r.debug&&c.log("\n======== style w/ technique =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle:",JSON.stringify(r,this.cleanupStyle,2),"\ntechnique:",JSON.stringify(m,this.cleanupStyle,2))}else i.push(this.m_techniques[r._index]);return!0===r.final}this.validate&&c.warn("WARNING: No technique defined in style. Either sub-styles or a technique must be defined:",JSON.stringify(r))}return!1},e}();t.StyleSetEvaluator=D;var k=function(){function e(e){this.theme=e}return e.prototype.visitStyles=function(e){var t,r,i=function(t){var r,n;if(e(t))return!0;if(void 0!==t.styles)try{for(var a=o(t.styles),s=a.next();!s.done;s=a.next()){var l=s.value;if(i(l))return!0}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!1};if(void 0!==this.theme.styles)for(var n in this.theme.styles)if(void 0!==this.theme.styles[n])try{for(var a=o(this.theme.styles[n]),s=a.next();!s.done;s=a.next()){var l=s.value;if(i(l))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},e}();t.ThemeVisitor=k},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(e.Requests||(e.Requests={})),e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t;!function(e){e.RegisterIndex="register-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=new AbortController),this.priority=e,this.abortController=t}return Object.defineProperty(e.prototype,"signal",{get:function(){return this.abortController.signal},enumerable:!0,configurable:!0}),e.prototype.abort=function(){this.abortController.abort()},e}();t.RequestController=i,function(e){var t,r;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(r=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(3);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return i.mercatorProjection;case"webMercator":return i.webMercatorProjection;default:throw new Error("Unknown projection "+e)}},t.getProjectionName=function(e){if(e===i.mercatorProjection)return"mercator";if(e===i.webMercatorProjection)return"webMercator";throw new Error("Unknown projection")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);new i.Vector2,new i.Vector2,new i.Vector2,new i.Vector2;t.addExtrudedWalls=function(e,t,r,i,n){for(var o=0;o<r.length;o+=2){var a=t+o,s=t+o+1,l=t+(o+2)%r.length,u=t+(o+3)%r.length;(void 0===i||i[o/2]||!i[o/2]&&!1!==n)&&e.push(a,s,u,u,l,a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=new i.Vector2,o=new i.Vector2,a=new i.Vector2,s=new i.Vector2;t.addPolygonEdges=function(e,t,r,i,l,u,c){for(var d=0;d<r.length;d+=2){var h=d/2;if(i[h])if(!0===l){var f=t+d,p=t+d+1,m=t+(d+2)%r.length,v=t+(d+3)%r.length;!0===u&&e.push(f,m),e.push(p,v);var y=(0===d?r.length:d)-2;if(i[y/2])if(void 0!==c){var g=r[d],_=r[d+1],b=r[(d+2)%r.length],x=r[(d+3)%r.length];n.set(g,_),o.set(b,x),a.set(r[y],r[y+1]),s.set(n.x,n.y),s.sub(a).normalize().dot(o.sub(n).normalize())<=c&&e.push(f,p)}else e.push(f,p)}else{var w=t+h;p=t+(h+1)%i.length,e.push(w,p)}}}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=function(){return function(e,t){void 0===t&&(t=5e3),this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}}();t.FeatureGroup=s;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userData=[],t}return n(t,e),t}(s);t.LineFeatureGroup=l;var u=function(e){function t(t,r){void 0===r&&(r=5e3);var i=e.call(this,t,r)||this;return i.groupNumRings=0,i.outerRingStartIndex=new Array(r),i.outerRingStartIndex.length=r,i.innerRingIsOuterContour=new Array(r),i.innerRingIsOuterContour.length=r,i.innerRingStartIndex=new Array(r),i.innerRingStartIndex.length=r,i}return n(t,e),t}(s);t.PolygonFeatureGroup=u;var c=function(){return function(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.pointGroup=new s(t),this.lineGroup=new l(t),this.polygonGroup=new u(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}}();t.ExtendedTileInfo=c,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function r(e){return e.numPositions===e.positions.length}e.finish=function(e){var r,i;t(e.pointGroup),t(r=e.lineGroup),void 0!==r.segmentIds&&(r.segmentIds.length=r.numFeatures,r.segmentStartOffsets.length=r.numFeatures,r.segmentEndOffsets.length=r.numFeatures),t(i=e.polygonGroup),i.outerRingStartIndex.length=i.numFeatures,i.innerRingIsOuterContour.length=i.groupNumRings,i.innerRingStartIndex.length=i.groupNumRings},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=r,e.tileInfoFinished=function(e){return r(e.pointGroup)&&r(e.lineGroup)&&r(e.polygonGroup)},e.getFeatureName=function(e,t,r,i){var n,a,s;if(t){var l=e.lookup("name:short");if("string"==typeof l&&l.length>0)return l}if(r){var u=e.lookup("iso_code");if("string"==typeof u&&u.length>0)return u}if(void 0!==i)try{for(var c=o(i),d=c.next();!d.done;d=c.next()){var h=d.value;if("string"==typeof(s=e.lookup("name:"+h)||e.lookup("name_"+h))&&s.length>0)return s}}catch(e){n={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}if("string"==typeof(s=e.lookup("name")))return s}}(c=t.ExtendedTileInfo||(t.ExtendedTileInfo={})),t.ExtendedTileInfo=c;var d=function(){function e(e,t,r){this.tileInfo=e,this.storeExtendedTags=t,this.languages=r,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}return e.prototype.addTechnique=function(e){if(void 0===e._index)throw new Error("ExtendedTileInfoEmitter#processPointFeature: Internal error - No technique index");var t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;t=this.tileInfo.techniqueCatalog.length;var r={};return Object.getOwnPropertyNames(e).forEach(function(t){t.startsWith("_")||(r[t]=e[t])}),r._index=e._index,this.techniqueIndexMap.set(e._index,t),this.tileInfo.techniqueCatalog.push(r),t},e.prototype.addFeature=function(e,t,r,i,n,o){var s=t,l=s.label,u=s.useAbbreviation,d=s.useIsoCode,h="string"==typeof l?r.lookup(l):c.getFeatureName(r,u,d,this.languages),f=-1;if(h&&"string"==typeof h&&(f=this.addText(h)),e.featureIds[e.numFeatures]=i,e.techniqueIndex[e.numFeatures]=n,e.textIndex[e.numFeatures]=f,e.positionIndex[e.numFeatures]=e.numPositions,o){var p=e;a.assert(void 0!==p.outerRingStartIndex),a.assert(void 0!==p.innerRingStartIndex),a.assert(void 0!==p.innerRingIsOuterContour),p.outerRingStartIndex[e.numFeatures]=p.groupNumRings}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(r.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(r.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(r.lookup("type"))),e.numFeatures++},e.prototype.addFeaturePoint=function(e,t,r){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=r},e.prototype.addFeaturePoints=function(e,t){for(var r=e.numPositions,i=t.length,n=e.positions,o=0;o<i;o++)n[r+o]=t[o];e.numPositions+=t.length},e.prototype.addRoadSegments=function(e,t,r,i){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=r,e.segmentEndOffsets[e.numFeatures-1]=i},e.prototype.addRingPoints=function(e,t,r){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=r?1:0,e.groupNumRings++;for(var i=e.numPositions,n=t.length,o=e.positions,a=0;a<n;a++)o[i+a]=t[a];e.numPositions+=t.length},e.prototype.finish=function(){c.finish(this.tileInfo)},e.prototype.addText=function(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)},e.prototype.addLayer=function(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)},e.prototype.addClass=function(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)},e.prototype.addType=function(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)},e.prototype.addStringValue=function(e,t,r){if(void 0===e)return-1;var i=e.toString(),n=r.get(i);return void 0!==n?n:(n=t.length,t.push(i),r.set(i,n),n)},e}();t.ExtendedTileInfoWriter=d;var h=function(){function e(){this.featureIndex=0,this.ringStart=0,this.numRings=0}return e.prototype.setup=function(e,t,r,i){this.polygons=e,this.featureIndex=t,this.ringStart=r,this.numRings=i},e.prototype.reset=function(){this.polygons=void 0,this.featureIndex=0,this.ringStart=0,this.numRings=0},e.prototype.isOuterRing=function(e){if(a.assert(e>=0),a.assert(e<this.numRings),a.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]},e.prototype.getPoints=function(e){if(a.assert(e>=0),a.assert(e<this.numRings),a.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");var t,r=this.polygons.innerRingStartIndex[this.ringStart+e];return t=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-r:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-r:this.polygons.positions.length-r,{points:this.polygons.positions,pointsStart:r,numPointValues:t}},e}(),f=function(){function e(e){this.tileInfo=e}return e.prototype.visitAll=function(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)},e.prototype.visitFeature=function(e,t){for(var r=0,i=this.tileInfo.pointGroup.numFeatures,n=this.tileInfo.pointGroup.featureIds,o=0;o<i;o++)n[o]===e&&(r++,this.visitPointFeature(o,t));var a=this.tileInfo.lineGroup.numFeatures,s=this.tileInfo.lineGroup.featureIds;for(o=0;o<a;o++)s[o]===e&&(r++,this.visitLineFeature(o,t));var l=this.tileInfo.polygonGroup.numFeatures,u=this.tileInfo.polygonGroup.featureIds;for(o=0;o<l;o++)u[o]===e&&(r++,this.visitPolygonFeature(o,t));return r},e.prototype.visitAllPointFeatures=function(e){for(var t=this.tileInfo.pointGroup.numFeatures,r=0;r<t;r++)this.visitPointFeature(r,e)},e.prototype.visitAllLineFeatures=function(e){for(var t=this.tileInfo.lineGroup.numFeatures,r=0;r<t;r++)this.visitLineFeature(r,e)},e.prototype.visitAllPolygonFeatures=function(e){for(var t=this.tileInfo.polygonGroup.numFeatures,r=0;r<t;r++)this.visitPolygonFeature(r,e)},e.prototype.getTag=function(e,t){return void 0!==t&&t[e]>=0?t[e]:-1},e.prototype.visitPointFeature=function(e,t){var r=this.tileInfo.pointGroup,i=r.positionIndex[e],n=r.positions[i],o=r.positions[i+1];t.acceptPoint&&t.acceptPoint(r.featureIds[e],r.techniqueIndex[e],n,o,r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex))},e.prototype.visitLineFeature=function(e,t){var r,i,n,o=this.tileInfo,a=o.lineGroup,s=a.numFeatures,l=a.positionIndex[e],u=e===s-1?a.positions.length-l:a.positionIndex[e+1]-l;void 0!==a.segmentIds&&(r=a.segmentIds[e],i=a.segmentStartOffsets[e],n=a.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(a.featureIds[e],a.techniqueIndex[e],a.textIndex[e],this.getTag(e,a.layerIndex),this.getTag(e,a.classIndex),this.getTag(e,a.typeIndex),o.lineGroup.positions,l,u,r,i,n)},e.prototype.visitPolygonFeature=function(t,r){if(void 0!==r.acceptPolygon){var i=this.tileInfo.polygonGroup,n=i.numFeatures,o=i.outerRingStartIndex[t],a=t===n-1?i.innerRingStartIndex.length-o:i.outerRingStartIndex[t+1]-o;e.polygonAccessor.setup(i,t,o,a),r.acceptPolygon(i.featureIds[t],i.techniqueIndex[t],i.textIndex[t],this.getTag(t,i.layerIndex),this.getTag(t,i.classIndex),this.getTag(t,i.typeIndex),e.polygonAccessor),e.polygonAccessor.reset()}},e.polygonAccessor=new h,e}();t.ExtendedTileInfoVisitor=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isLoading=function(e){return void 0!==e.loadingPromise}}(t.ImageItem||(t.ImageItem={}))},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(30),l=r(121),u=r(6),c=function(){function e(e,t,r,i,n,o,a,s,u,c,d){this.url=e,this.name=t,this.type=r,this.size=i,this.maxWidth=n,this.maxHeight=o,this.distanceRange=a,this.fonts=s,this.unicodeBlocks=u,this.maxCodePointCount=c,this.m_replacementGlyph=d,this.m_glyphTextureCache=new l.GlyphTextureCache(c,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}return e.load=function(t,r){return i(this,void 0,void 0,function(){var i,o,l,u,c,d,h;return n(this,function(n){switch(n.label){case 0:return i=new URL(t,window.location.href),[4,e.loadJSON(i.href)];case 1:return o=n.sent(),l=new URL(o.name+"_Assets/Extra/",i),[4,e.loadJSON(l.href+"Specials.json")];case 2:return u=n.sent(),[4,e.loadTexture(l.href+"Specials.png")];case 3:return(c=n.sent()).wrapS=a.ClampToEdgeWrapping,c.wrapT=a.ClampToEdgeWrapping,c.minFilter=a.NearestFilter,c.needsUpdate=!0,d=o.fonts.find(function(e){return"Extra"===e.name}),h=new s.GlyphData(65533,"Specials",u.chars[0].width,u.chars[0].height,u.chars[0].xadvance,u.chars[0].xoffset,u.chars[0].yoffset,0,0,1,1,c,d),[2,new e(i.href.substr(0,i.href.lastIndexOf("/")),o.name,o.type,o.size,o.maxWidth,o.maxHeight,o.distanceRange,o.fonts,o.supportedBlocks,r,h)]}})})},e.loadTexture=function(e){return new Promise(function(t){(new a.TextureLoader).load(e,t)})},e.loadJSON=function(e){return i(this,void 0,void 0,function(){var t,r;return n(this,function(i){switch(i.label){case 0:return[4,fetch(e)];case 1:if(!(t=i.sent()).ok)throw new Error(e+" Status Text:  "+t.statusText);return[4,t.text()];case 2:return r=i.sent(),[2,JSON.parse(r)]}})})},e.prototype.dispose=function(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()},e.prototype.clear=function(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()},e.prototype.update=function(e){this.m_glyphTextureCache.update(e)},Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_glyphTextureCache.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureSize",{get:function(){return this.m_glyphTextureCache.textureSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0},enumerable:!0,configurable:!0}),e.prototype.loadBlock=function(t,r,a,s){return i(this,void 0,void 0,function(){var i,l,u,c,d,h,f,p,m,v,y;return n(this,function(n){switch(n.label){case 0:if(u=this.getAssetsPath(a,r),c=u+"/"+t.name.replace(/ /g,"_")+".json",void 0!==(d=this.m_loadedJson.get(c)))return[3,7];if(void 0!==(h=this.m_loadingJson.get(c)))return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),h=e.loadJSON(c),this.m_loadingJson.set(c,h),[4,h];case 2:return d=n.sent(),this.m_loadingJson.delete(c),this.m_loadedJson.set(c,d),[3,4];case 3:return f=n.sent(),console.error(f),this.m_loadingJson.delete(c),[3,4];case 4:return[3,7];case 5:return[4,h];case 6:d=n.sent(),n.label=7;case 7:if(p=[],!0===s)try{for(m=o(d.pages),v=m.next();!v.done;v=m.next())y=v.value,p.push(this.loadPage(u+"/"+y))}catch(e){i={error:e}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(i)throw i.error}}return[4,Promise.all(p)];case 8:return n.sent(),[2,d]}})})},e.prototype.removeBlock=function(e,t,r){var i,n,a=this.getAssetsPath(r,t),s=a+"/"+e.name.replace(/ /g,"_")+".json",l=this.m_loadedJson.get(s);if(void 0!==l){try{for(var u=o(l.pages),c=u.next();!c.done;c=u.next()){var d=a+"/"+c.value;this.m_loadingPages.delete(d),this.m_loadedPages.delete(d)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}this.m_loadingJson.delete(s),this.m_loadedJson.delete(s)}},e.prototype.loadCharset=function(e,t){return i(this,void 0,void 0,function(){var r,i,a,s,l,c,d,h,f,p,m,v,y=this;return n(this,function(n){a=t.fontName,s=t.fontStyle,l=t.fontVariant===u.FontVariant.AllCaps||t.fontVariant===u.FontVariant.SmallCaps,c=(l?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,function(e,t){return t.indexOf(e)+1?"":e}),d=[],h=function(e){var t,r,i=e.codePointAt(0),n=f.getFont(i,a),l=n.name+"_"+s,u=l+"_"+i,c=f.m_loadedGlyphs.get(l);void 0===c&&(c=new Map,f.m_loadedGlyphs.set(l,c));var h=c.get(i);if(void 0===h){var p=f.m_loadingGlyphs.get(u);if(void 0===p){if(-1===n.charset.indexOf(String.fromCodePoint(i))){var m=f.createReplacementGlyph(i,e,n);return c.set(i,m),f.m_glyphTextureCache.add(u,m),"continue"}var v=void 0;try{for(var g=o(f.unicodeBlocks),_=g.next();!_.done;_=g.next()){var b=_.value;if(i>=b.min&&i<=b.max){v=b;break}}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}p=f.loadAssets(i,s,v,n),f.m_loadingGlyphs.set(u,p),p.then(function(e){y.m_loadingGlyphs.delete(u),c.set(i,e),y.m_glyphTextureCache.add(u,e)})}d.push(p)}else f.m_glyphTextureCache.has(u)||(d.push(Promise.resolve(h)),f.m_glyphTextureCache.add(u,h))},f=this;try{for(p=o(c),m=p.next();!m.done;m=p.next())v=m.value,h(v)}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}return[2,Promise.all(d)]})})},e.prototype.getGlyph=function(e,t,r){var i=this.m_loadedGlyphs.get(t.name+"_"+r);if(void 0!==i)return i.get(e)},e.prototype.getGlyphs=function(e,t,r){var i,n,a,s,l=[],c=t.fontName,d=t.fontStyle,h=t.fontVariant,f=h===u.FontVariant.AllCaps||h===u.FontVariant.SmallCaps;try{for(var p=o(e),m=p.next();!m.done;m=p.next()){var v=m.value,y=f?v.toUpperCase():v;try{for(var g=o(y),_=g.next();!_.done;_=g.next()){var b=_.value,x=b.codePointAt(0),w=this.getFont(x,c),S=this.getGlyph(x,w,d);if(void 0===S)return;l.push(S),void 0!==r&&r.push(b!==v)}}catch(e){a={error:e}}finally{try{_&&!_.done&&(s=g.return)&&s.call(g)}finally{if(a)throw a.error}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}return l},e.prototype.getFont=function(e,t){var r,i,n=this.fonts[0].name;try{for(var a=o(this.unicodeBlocks),s=a.next();!s.done;s=a.next()){var l=s.value;if(e>=l.min&&e<=l.max){n=void 0!==t&&void 0!==l.fonts.find(function(e){return e===t})?t:l.fonts[0];break}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return this.fonts.find(function(e){return e.name===n})},e.prototype.createReplacementGlyph=function(e,t,r){var i=this.m_replacementGlyph.clone();return i.codePoint=e,i.character=t,i.font=r,i},e.prototype.loadAssets=function(e,t,r,o){return i(this,void 0,void 0,function(){var i,a,l,u,c;return n(this,function(n){switch(n.label){case 0:return[4,this.loadBlock(r,o,t)];case 1:return i=n.sent(),a=i.chars.find(function(t){return t.id===e}),l=this.getAssetsPath(t,o),u=l+"/"+i.pages[a.page],[4,this.loadPage(u)];case 2:return c=n.sent(),[2,new s.GlyphData(a.id,r.name,a.width,a.height,a.xadvance,a.xoffset,a.yoffset,a.x/c.image.width,1-(a.y+a.height)/c.image.height,(a.x+a.width)/c.image.width,1-a.y/c.image.height,c,o)]}})})},e.prototype.loadPage=function(t){return i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return void 0!==(r=this.m_loadedPages.get(t))?[3,4]:void 0!==(i=this.m_loadingPages.get(t))?[3,2]:(i=e.loadTexture(t),this.m_loadingPages.set(t,i),[4,i]);case 1:return(r=n.sent()).wrapS=a.ClampToEdgeWrapping,r.wrapT=a.ClampToEdgeWrapping,r.minFilter=a.NearestFilter,r.needsUpdate=!0,this.m_loadingPages.delete(t)&&this.m_loadedPages.set(t,r),this.m_loadingPages.delete(t),[3,4];case 2:return[4,i];case 3:r=n.sent(),n.label=4;case 4:return[2,r]}})})},e.prototype.getAssetsPath=function(e,t){var r="_Assets/";switch(e){case u.FontStyle.Bold:void 0!==t.bold&&(r="_BoldAssets/");break;case u.FontStyle.Italic:void 0!==t.italic&&(r="_ItalicAssets/");break;case u.FontStyle.BoldItalic:void 0!==t.boldItalic?r="_BoldItalicAssets/":void 0!==t.italic?r="_ItalicAssets/":void 0!==t.bold&&(r="_BoldAssets/")}return this.url+"/"+this.name+r+t.name},e}();t.FontCatalog=c},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(56),o=r(0),a=r(30),s=r(19),l=r(57),u=r(6),c=4096,d=function(){function e(e,t,r){this.capacity=e,this.entryWidth=t,this.entryHeight=r;var i=Math.floor(Math.sqrt(e));this.m_cacheHeight=i*i<e?i+1:i,this.m_cacheWidth=i*this.m_cacheHeight<e?i+1:i,this.m_textureSize=new o.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*r),(this.m_textureSize.y>c||this.m_textureSize.x>c)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE ("+c+").\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new n.LRUCache(e),this.initCacheEntries(),this.m_scene=new o.Scene,this.m_camera=new o.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new o.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:o.ClampToEdgeWrapping,wrapT:o.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_textRenderStyle=new u.TextRenderStyle({fontSize:{unit:u.FontUnit.Percent,size:100,backgroundSize:0}}),this.m_copyMaterial=new l.GlyphCopyMaterial,this.m_copyTextureSet=new Set,this.m_copyTransform=new o.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3),this.m_copyGeometry=new s.TextGeometry(this.m_copyMaterial,this.m_copyMaterial,e),this.m_clearMaterial=new l.GlyphClearMaterial,this.m_clearGeometry=new s.TextGeometry(this.m_clearMaterial,this.m_clearMaterial,e),this.m_clearGlyph=this.initClearGlyph(),this.m_scene.add(this.m_clearGeometry.mesh,this.m_copyGeometry.mesh)}return e.prototype.dispose=function(){this.m_entryCache.clear(),this.m_scene.remove(this.m_clearGeometry.mesh,this.m_copyGeometry.mesh),this.m_rt.dispose(),this.m_clearMaterial.dispose(),this.m_copyMaterial.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_rt.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureSize",{get:function(){return this.m_textureSize},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r,n;if(void 0===this.m_entryCache.get(e)){var o=this.m_entryCache.oldest;if(null===o)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(o.value),this.m_copyTextureSet.add(t.texture);var a=0;try{for(var s=i(this.m_copyTextureSet.values()),l=s.next();!l.done;l=s.next()){if(l.value===t.texture)break;a++}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}t.copyIndex=a,this.m_copyTransform.set(1,0,o.value.location.x*this.entryWidth-t.offsetX,0,1,o.value.location.y*this.entryHeight-t.positions[0].y,0,0,0);for(var u=0;u<4;++u)this.m_copyPositions[u].set(t.positions[u].x,t.positions[u].y,t.positions[u].z),this.m_copyPositions[u].applyMatrix3(this.m_copyTransform);this.m_copyGeometry.add(t,this.m_copyPositions,0,0,!1,this.m_textRenderStyle,!0);var c=this.m_copyPositions[0].x/this.m_textureSize.x,d=this.m_copyPositions[0].y/this.m_textureSize.y,h=this.m_copyPositions[3].x/this.m_textureSize.x,f=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(c,d),t.dynamicTextureCoordinates[1].set(h,d),t.dynamicTextureCoordinates[2].set(c,f),t.dynamicTextureCoordinates[3].set(h,f),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:o.value.location})}},e.prototype.has=function(e){return this.m_entryCache.has(e)},e.prototype.get=function(e){return this.m_entryCache.get(e)},e.prototype.clear=function(){this.m_clearGeometry.clear(),this.m_copyGeometry.clear(),this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()},e.prototype.update=function(e){if(this.m_clearGeometry.update(),this.m_clearGeometry.drawCount>0&&(this.m_clearGeometry.mesh.visible=!0,this.m_copyGeometry.mesh.visible=!1,e.render(this.m_scene,this.m_camera,this.m_rt),this.m_clearGeometry.clear(),this.m_clearGeometry.mesh.visible=!1),this.m_copyGeometry.update(),this.m_copyGeometry.drawCount>0){this.m_copyGeometry.mesh.visible=!0;for(var t=Array.from(this.m_copyTextureSet),r=Math.ceil(this.m_copyTextureSet.size/8),i=0;i<r;i++){var n=8*i;this.m_copyMaterial.uniforms.pageOffset.value=n;for(var o=0;o<8;o++){var a=n+o;a<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+o].value=t[a])}e.render(this.m_scene,this.m_camera,this.m_rt)}this.m_copyTextureSet.clear(),this.m_copyGeometry.clear()}},e.prototype.initCacheEntries=function(){for(var e={name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""},t=new a.GlyphData(0,"",0,0,0,0,0,0,0,0,0,o.Texture.DEFAULT_IMAGE,e),r=0;r<this.m_cacheHeight;r++)for(var i=0;i<this.m_cacheWidth;i++){var n={glyphData:t,location:new o.Vector2(i,r)};this.m_entryCache.set("Dummy_"+(r*this.m_cacheHeight+i),n)}},e.prototype.initClearGlyph=function(){var e={name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""};return new a.GlyphData(0,"",this.entryWidth,this.entryHeight,this.entryWidth,0,0,0,0,1,1,o.Texture.DEFAULT_IMAGE,e)},e.prototype.clearCacheEntry=function(e){e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight,0),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight,0),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight,0),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight,0),this.m_clearGeometry.add(this.m_clearGlyph,this.m_copyPositions,0,0,!1,this.m_textRenderStyle,!0)},e}();t.GlyphTextureCache=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=function(){return function(e,t,r,i,n){this.key=e,this.value=t,this.size=r,this.newer=i,this.older=n}}();t.Entry=n;var o=function(){function e(e,t){void 0===t&&(t=function(){return 1}),this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}return e.prototype.forEach=function(e,t){for(var r=this.m_newest;null!==r;)e.call(t,r.value,r.key,this),r=r.older},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.m_capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.m_map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newest",{get:function(){return this.m_newest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldest",{get:function(){return this.m_oldest},enumerable:!0,configurable:!0}),e.prototype.setCapacity=function(e){this.m_capacity=e,this.evict()},e.prototype.set=function(e,t){var r=this.m_sizeFunction(t),o=this.m_map.get(e);if(void 0!==o)this.m_size=this.m_size-o.size+r,o.value=t,o.size=r,this.promote(o),this.evict();else{if(r>this.m_capacity)return;if(o=new n(e,t,r,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=o;else{i.assert(null!==this.m_newest);var a=this.m_newest;o.older=this.m_newest,a.newer=o,this.m_newest=o}this.m_map.set(e,o),this.m_size+=r,this.evict()}},e.prototype.get=function(e){var t=this.m_map.get(e);if(void 0!==t)return this.promote(t),t.value},e.prototype.has=function(e){return this.m_map.has(e)},e.prototype.clear=function(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()},e.prototype.evictAll=function(){var e=this.evictionCallback;void 0!==e&&this.forEach(function(t,r){return e(r,t)}),this.clear()},e.prototype.delete=function(e){var t=this.m_map.get(e);return void 0!==t&&(t===this.m_newest?this.m_newest=t.older:t.newer?t.newer.older=t.older:i.assert(!1),t===this.m_oldest?this.m_oldest=t.newer:t.older?t.older.newer=t.newer:i.assert(!1),this.m_size-=t.size,this.m_map.delete(e))},e.prototype.evict=function(){for(;this.m_size>this.m_capacity;){if(void 0===this.evictOldest())return}},e.prototype.evictOldest=function(){i.assert(null!==this.m_oldest);var e=this.m_oldest;i.assert(null===e.older);var t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&(i.assert(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;i.assert(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}var r=this.m_map.delete(t.key);return i.assert(!0===r),r&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t},e.prototype.promote=function(e){if(e!==this.m_newest){e.newer&&(i.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(i.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,i.assert(null!==this.m_newest);var t=this.m_newest;i.assert(null===t.newer),t.newer=e,this.m_newest=e}},e}();t.LRUCache=o},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(58),a=r(19),s=r(6),l=r(124),u=r(125),c=r(59),d=new n.Vector3,h={array:[new n.Box2],offset:0},f=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;var p=function(){function e(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.maxGlyphCount=e.maxGlyphCount,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=c.createSdfTextMaterial({fontCatalog:e.fontCatalog})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,isBackground:!0})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,scene:new n.Scene,geometry:new a.TextGeometry(this.m_material,this.m_bgMaterial,this.maxGlyphCount)},this.m_defaultLayer.scene.add(this.m_defaultLayer.geometry.backgroundMesh,this.m_defaultLayer.geometry.mesh),this.m_layers=[this.m_defaultLayer],this.m_defaultTextRenderStyle=new s.TextRenderStyle,this.m_currentTextRenderStyle=this.m_defaultTextRenderStyle,this.m_defaultTextLayoutStyle=new s.TextLayoutStyle,this.m_currentTextLayoutStyle=this.m_defaultTextLayoutStyle,this.m_lineTypesetter=new l.LineTypesetter,this.m_pathTypesetter=new u.PathTypesetter}return Object.defineProperty(e.prototype,"fontCatalog",{get:function(){return this.m_fontCatalog},set:function(e){this.m_fontCatalog=e;var t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;var r=this.m_bgMaterial;r.uniforms.sdfTexture.value=this.m_fontCatalog.texture,r.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),r.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.m_material},set:function(e){var t,r;this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;try{for(var n=i(this.m_layers),o=n.next();!o.done;o=n.next()){o.value.geometry.mesh.material=this.m_material}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundMaterial",{get:function(){return this.m_bgMaterial},set:function(e){var t,r;this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;try{for(var n=i(this.m_layers),o=n.next();!o.done;o=n.next()){o.value.geometry.backgroundMesh.material=this.m_bgMaterial}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textRenderStyle",{get:function(){return this.m_currentTextRenderStyle},set:function(e){this.m_currentTextRenderStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textLayoutStyle",{get:function(){return this.m_currentTextLayoutStyle},set:function(e){this.m_currentTextLayoutStyle=e},enumerable:!0,configurable:!0}),e.prototype.clear=function(){var e,t;try{for(var r=i(this.m_layers),n=r.next();!n.done;n=r.next()){n.value.geometry.clear()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.m_currentTextRenderStyle=this.m_defaultTextRenderStyle},e.prototype.render=function(e,t,r){var n,o;this.m_fontCatalog.update(this.m_renderer),void 0!==t&&this.m_renderer.setRenderTarget(t),!0===r&&this.m_renderer.clear(!0);try{for(var a=i(this.m_layers),s=a.next();!s.done;s=a.next()){var l=s.value;l.geometry.update(),this.m_renderer.clear(!1,!0),this.m_renderer.render(l.scene,e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}this.m_renderer.setRenderTarget()},e.prototype.addLayer=function(e){var t=this.getLayer(e);return void 0===t&&((t={id:e,scene:new n.Scene,geometry:new a.TextGeometry(this.m_material,this.m_bgMaterial,this.maxGlyphCount)}).scene.add(t.geometry.backgroundMesh,t.geometry.mesh),this.m_layers.push(t),this.m_layers.sort(function(e,t){return e.id-t.id})),t},e.prototype.getLayer=function(e){return this.m_layers.find(function(t){return t.id===e})},e.prototype.getAllLayers=function(){return this.m_layers},e.prototype.measureText=function(e,t,r){var i,n,o,a;if(d.set(0,0,0),void 0!==r){if(i=r.path,n=r.pathOverflow,a=r.outputCharacterBounds,void 0!==r.path){var s=r.path.getPoint(0);if(null===s)return!1;d.set(s.x,s.y,0)}r.letterCaseArray&&(o=r.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:i,textPathOverflow:n,bounds:t,individualBounds:a,letterCaseArray:o})},e.prototype.addText=function(e,t,r){var i,n,o;d.copy(t);var a=this.m_defaultLayer;if(void 0!==r){if(i=r.path,n=r.pathOverflow,void 0!==r.layer){var s=this.getLayer(r.layer);void 0===s&&(s=this.addLayer(r.layer)),a=s}void 0!==r.path&&d.set(0,0,d.z),r.letterCaseArray&&(o=r.letterCaseArray)}var l=a.geometry.drawCount,u=this.placeText({input:e,textPath:i,textPathOverflow:n,layer:a,letterCaseArray:o});return u&&void 0!==r?(!0===r.updatePosition&&t.copy(d),void 0!==r.pickingData&&a.geometry.addPickingData(l,a.geometry.drawCount,r.pickingData)):u||(a.geometry.m_drawCount=l),u},e.prototype.createTextBufferObject=function(e,t){var r;d.set(0,0,0),this.m_currentTextRenderStyle.fontVariant===s.FontVariant.SmallCaps&&(r=[]);var i,a,l,u,c=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,r);if(void 0!==c)return void 0!==t&&(i=t.path,a=t.pathOverflow,!0===t.outputBounds&&(l=new n.Box2),!0===t.outputCharacterBounds&&(u=[])),this.placeText({input:c,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:i,textPathOverflow:a,bounds:l,individualBounds:u,letterCaseArray:r}),new o.TextBufferObject(e,c,new Float32Array(f),this.m_currentTextRenderStyle,this.m_currentTextLayoutStyle,l,u)},e.prototype.addTextBufferObject=function(e,t){var r,i,n,o,a,s,l,u=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){var c=this.getLayer(t.layer);void 0===c&&(c=this.addLayer(t.layer)),u=c}r=t.position,i=t.scale,n=t.rotation,o=t.color,a=t.opacity,s=t.backgroundColor,l=t.backgroundOpacity}var d=u.geometry.drawCount,h=u.geometry.addTextBufferObject(e,r,i,n,o,a,s,l);return h&&void 0!==t?void 0!==t.pickingData&&u.geometry.addPickingData(d,u.geometry.drawCount,t.pickingData):h||(u.geometry.m_drawCount=d),h},e.prototype.pickText=function(e,t){var r,n;try{for(var o=i(this.m_layers),a=o.next();!a.done;a=o.next()){a.value.geometry.pick(e,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e.prototype.placeText=function(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;var t,r,i,n=this.m_currentTextRenderStyle.fontVariant===s.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(r=e.letterCaseArray);else if(r=[],void 0===(t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,n?r:void 0)))return!1;void 0!==e.individualBounds&&(h.array=e.individualBounds,h.offset=0,i=h),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(f=new Float32Array(t.length*a.QUAD_VERTEX_MEMORY_FOOTPRINT));var o=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:d,geometry:e.layer.geometry,smallCapsArray:n?r:void 0,globalBounds:e.bounds,individualBounds:i,vertexBuffer:!0===e.computeTextBuffer?f:void 0},u=!0;return o?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),u=this.m_pathTypesetter.arrangeGlyphs(l)):u=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==i&&(i.array.length=i.offset),u},e}();t.TextCanvas=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(19),o=r(6),a=r(31),s=r(12),l=function(){function e(){this.m_tempTransform=new i.Matrix3,this.m_tempCorners=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3],this.m_tempLineDirection=s.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=s.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}return e.prototype.arrangeGlyphs=function(e){this.m_currentParams=e,this.m_tempLineDirection=a.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;for(var t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,r=this.m_currentParams.position.x,i=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading,n=0,l=0,u=0,c=0,d=0,h=0,f=0,p=0,m=!1,v=0;v<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++v){var y=this.m_currentParams.glyphs[v];if(!y.isInCache&&!t)return!1;var g=s.UnicodeUtils.isNewLine(y.codePoint),_=s.UnicodeUtils.isWhiteSpace(y.codePoint);if(m||y.direction!==-this.m_tempLineDirection||(m=!0),s.UnicodeUtils.isPrintable(y.codePoint)&&(d+=(y.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?a.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,v,this.m_currentParams.textRenderStyle.fontVariant):1)),v===n&&(c=d,h=d,f=d),g||this.m_currentParams.textLayoutStyle.wrappingMode!==o.WrappingMode.None&&d>this.m_currentParams.textLayoutStyle.lineWidth){if(this.m_currentParams.textLayoutStyle.wrappingMode!==o.WrappingMode.None){var b=l,x=h;this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&f!==c&&(b=u,x=f),d=x,v=Math.min(g?n===v?b:v:b,this.m_currentParams.glyphs.length-1)}var w=this.m_tempLineDirection===s.UnicodeUtils.Direction.RTL&&m?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+d*w,!this.placeLine(n,v,this.m_tempLineDirection,m))return!1;for(this.m_currentParams.position.y-=i*this.m_tempScale,this.m_currentParams.position.x=r;v!==n&&v+1<this.m_currentParams.glyphs.length&&s.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[v+1].codePoint);)++v;if((n=v+1)===this.m_currentParams.glyphs.length)break;g&&(this.m_tempLineDirection=a.TypesettingUtils.getDirection(this.m_currentParams.glyphs,n),this.m_tempRunDirection=this.m_tempLineDirection),c=0,d=0,l=n,h=0,u=n,f=0,m=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.None||_||(l=v,h=d,this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&v+1<this.m_currentParams.glyphs.length&&(s.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[v+1].codePoint)||s.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[v+1].codePoint))&&(u=v,f=d))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&n<=this.m_currentParams.glyphs.length-1){var S=this.m_tempLineDirection===s.UnicodeUtils.Direction.RTL&&m?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+d*S),!this.placeLine(n,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,m))return!1}return!0},e.prototype.placeLine=function(e,t,r,i){if(!i)return this.placeRun(e,t,r);for(var n=this.m_currentParams.glyphs,o=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,c=this.m_currentParams.position,d=r===s.UnicodeUtils.Direction.RTL,h=c.x,f=0,p=e,m=e;m<=t;++m){var v=n[m];if(v.direction===-this.m_tempRunDirection){if(d&&(c.x=h+f),!this.placeRun(p,m-1,this.m_tempRunDirection))return!1;d||(c.x=h+f),p=m,this.m_tempRunDirection*=-1}else if(v.direction===s.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-r){for(var y=m;y+1<n.length&&1!==Math.abs(n[y].direction);)++y;if(n[y].direction!==this.m_tempRunDirection){if(d&&(c.x=h+f),!this.placeRun(p,m-1,this.m_tempRunDirection))return!1;d||(c.x=h+f),p=m,this.m_tempRunDirection*=-1}}f+=(v.advanceX+u.tracking)*this.m_tempScale*(this.m_tempSmallCaps?a.TypesettingUtils.getSmallCapsScale(n,o,m,l.fontVariant):1)*r}if(p<=t){if(d&&(c.x=h+f),!this.placeRun(p,t,this.m_tempRunDirection))return!1;d||(c.x=h+f)}return!0},e.prototype.placeRun=function(e,t,r){for(var i=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,u=this.m_currentParams.fontCatalog,c=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,f=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,m=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,y=r===s.UnicodeUtils.Direction.LTR?e:t,g=r===s.UnicodeUtils.Direction.LTR?t:e,_=y;r===s.UnicodeUtils.Direction.RTL?_>=g:_<=g;_+=r){var b=i[_];if(s.UnicodeUtils.isPrintable(b.codePoint))if(e===t||0===_||r!==s.UnicodeUtils.Direction.RTL||b.direction!==s.UnicodeUtils.Direction.Weak){var x=b.font,w=x.metrics,S=c.fontStyle,T=S===o.FontStyle.Bold&&void 0===x.bold||S===o.FontStyle.BoldItalic&&void 0===x.bold&&void 0===x.boldItalic,C=S===o.FontStyle.Italic&&void 0===x.italic||S===o.FontStyle.BoldItalic&&void 0===x.italic&&void 0===x.boldItalic,P=!!this.m_tempSmallCaps&&(l[_]&&c.fontVariant===o.FontVariant.SmallCaps),E=P?w.xHeight/w.capHeight:1,M=this.m_tempScale*E,O=((T?.02:0)+(P?.01:0))*(u.size/u.distanceRange),A=.5*this.m_tempPixelBgSize/(u.distanceRange*Math.max(M,1)),L=s.UnicodeUtils.isRtlMirrored(b.codePoint)&&r===s.UnicodeUtils.Direction.RTL,R=w.lineHeight-w.base-.5*w.distanceRange;a.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,h,M,d.lineRotation,c.rotation);for(var I=0;I<4;++I){var F=b.positions[I],D=C&&I>1?a.TypesettingUtils.OBLIQUE_OFFSET*w.size:0;this.m_tempCorners[I].set(F.x+D,F.y-R,F.z),this.m_tempCorners[I].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===v){if(!f.add(b,this.m_tempCorners,O,O+A,L,c))return!1}else void 0!==p&&a.TypesettingUtils.updateBounds(this.m_tempCorners,p,m),void 0!==v&&f.addToBuffer(v,_*n.QUAD_VERTEX_MEMORY_FOOTPRINT,b,this.m_tempCorners,O,O+A,L,c);h.x+=(b.advanceX+d.tracking)*M}else{for(var k=_,V=i[k-1];k!==e&&(V.direction===s.UnicodeUtils.Direction.Weak||V.direction===s.UnicodeUtils.Direction.Neutral&&!s.UnicodeUtils.isWhiteSpace(V.codePoint));)V=i[--k-1];this.placeRun(Math.max(k,e),_,s.UnicodeUtils.Direction.LTR),_=k}}return!0},e}();t.LineTypesetter=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(19),o=r(6),a=r(31),s=r(12),l=function(){function e(){this.m_tempTransform=new i.Matrix3,this.m_tempCorners=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3],this.m_tempLineDirection=s.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=s.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new i.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}return e.prototype.arrangeGlyphs=function(e){this.m_currentParams=e,this.m_tempLineDirection=a.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;for(var t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,r=!1,i=0,n=0;n<this.m_currentParams.glyphs.length;++n){var o=this.m_currentParams.glyphs[n];if(!o.isInCache&&!t)return!1;s.UnicodeUtils.isPrintable(o.codePoint)&&(r||o.direction!==-this.m_tempLineDirection||(r=!0),i+=(o.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?a.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,n,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*i/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,r)},e.prototype.placeLine=function(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);for(var r=this.m_currentParams.glyphs,i=0,n=i;n<r.length;++n){var o=r[n];if(o.direction===-this.m_tempRunDirection){if(!this.placeRun(i,n-1,this.m_tempRunDirection))return!1;i=n,this.m_tempRunDirection*=-1}else if(o.direction===s.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){for(var a=n;a+1<r.length&&1!==Math.abs(r[a].direction);)++a;if(r[a].direction!==this.m_tempRunDirection){if(!this.placeRun(i,n-1,this.m_tempRunDirection))return!1;i=n,this.m_tempRunDirection*=-1}}}return!(i<r.length&&!this.placeRun(i,r.length-1,this.m_tempRunDirection))},e.prototype.placeRun=function(e,t,r){for(var l=this.m_currentParams.glyphs,u=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,d=this.m_currentParams.textRenderStyle,h=this.m_currentParams.textLayoutStyle,f=this.m_currentParams.position,p=this.m_currentParams.geometry,m=this.m_currentParams.globalBounds,v=this.m_currentParams.individualBounds,y=this.m_currentParams.vertexBuffer,g=this.m_currentParams.path,_=d.rotation,b=h.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,x=r===s.UnicodeUtils.Direction.LTR?e:t,w=r===s.UnicodeUtils.Direction.LTR?t:e,S=x;r===s.UnicodeUtils.Direction.RTL?S>=w:S<=w;S+=r){var T=l[S];if(s.UnicodeUtils.isPrintable(T.codePoint))if(e===t||0===S||r!==s.UnicodeUtils.Direction.RTL||T.direction!==s.UnicodeUtils.Direction.Weak){var C=T.font,P=C.metrics,E=d.fontStyle,M=E===o.FontStyle.Bold&&void 0===C.bold||E===o.FontStyle.BoldItalic&&void 0===C.bold&&void 0===C.boldItalic,O=E===o.FontStyle.Italic&&void 0===C.italic||E===o.FontStyle.BoldItalic&&void 0===C.italic&&void 0===C.boldItalic,A=!!this.m_tempSmallCaps&&(u[S]&&d.fontVariant===o.FontVariant.SmallCaps),L=A?P.xHeight/P.capHeight:1,R=this.m_tempScale*L,I=((M?.02:0)+(A?.01:0))*(c.size/c.distanceRange),F=.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(R,1)),D=s.UnicodeUtils.isRtlMirrored(T.codePoint)&&r===s.UnicodeUtils.Direction.RTL,k=P.lineHeight-P.base-.5*P.distanceRange,V=g.getPoint(this.m_tempPathOffset);if(null===V)return this.m_currentParams.pathOverflow;var j=g.getTangent(this.m_tempPathOffset),U=new i.Vector2(-j.y,j.x).multiplyScalar(b),z=Math.atan2(j.y,j.x);this.m_tempPathPosition.set(U.x+V.x,U.y+V.y,f.z),d.rotation=_+z,a.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,R,h.lineRotation,d.rotation);for(var B=0;B<4;++B){var N=T.positions[B],G=O&&B>1?a.TypesettingUtils.OBLIQUE_OFFSET*P.size:0;this.m_tempCorners[B].set(N.x+G,N.y-k,N.z),this.m_tempCorners[B].applyMatrix3(this.m_tempTransform),this.m_tempCorners[B].x-=f.x,this.m_tempCorners[B].y-=f.y}if(void 0===m&&void 0===y){if(!p.add(T,this.m_tempCorners,I,I+F,D,d))return!1}else void 0!==m&&a.TypesettingUtils.updateBounds(this.m_tempCorners,m,v),void 0!==y&&p.addToBuffer(y,S*n.QUAD_VERTEX_MEMORY_FOOTPRINT,T,this.m_tempCorners,I,I+F,D,d);d.rotation=_,this.m_tempPathOffset+=(T.advanceX+h.tracking)*R/this.m_tempPathLength}else{for(var W=S,q=l[W-1];W!==e&&(q.direction===s.UnicodeUtils.Direction.Weak||q.direction===s.UnicodeUtils.Direction.Neutral&&!s.UnicodeUtils.isWhiteSpace(q.codePoint));)q=l[--W-1];this.placeRun(Math.max(W,e),S,s.UnicodeUtils.Direction.LTR),S=W}}return!0},e}();t.PathTypesetter=l},function(e,t,r){"use strict";var i,n,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(i||(i={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(n||(n={}));var a=function(){function e(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}return Object.defineProperty(e,"instance",{get:function(){return void 0===this.m_instance&&(this.m_instance=new e),this.m_instance},enumerable:!0,configurable:!0}),e.prototype.convert=function(e){for(var t="",r=0;r<e.length;++r){var o=e.charCodeAt(r);if(this.isArabicCharacter(o)){for(var a=r-1;a>=0&&this.isNeutral(e.charCodeAt(a));--a);var s=a>=0?e.charCodeAt(a):void 0;if(void 0!==s){var l=this.getCharacterMap(s);(void 0===l||void 0===l[i.Initial]&&void 0===l[i.Medial])&&(s=void 0)}for(var u=r+1;u<e.length&&this.isNeutral(e.charCodeAt(u));++u);var c=u<e.length?e.charCodeAt(u):void 0;if(void 0!==c){var d=this.getCharacterMap(c);(void 0===d||void 0===d[i.Medial]&&void 0===d[i.Final])&&(c=void 0)}if(1604===o&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){var h=this.getCombinedCharacterMap(o,c);t+=void 0!==s?String.fromCharCode(h[n.Connected]):String.fromCharCode(h[n.Isolated]),++r;continue}var f=this.getCharacterMap(o);void 0!==s&&void 0!==c&&void 0!==f[i.Medial]?t+=String.fromCharCode(f[i.Medial]):void 0!==s&&void 0!==f[i.Final]?t+=String.fromCharCode(f[i.Final]):void 0!==c&&void 0!==f[i.Initial]?t+=String.fromCharCode(f[i.Initial]):t+=String.fromCharCode(o)}else t+=String.fromCharCode(o)}return t},e.prototype.isArabicCharacter=function(e){return this.m_singleCharactersMap.has(e)},e.prototype.getCharacterMap=function(e){return this.m_singleCharactersMap.get(e)},e.prototype.getCombinedCharacterMap=function(e,t){var r=this.m_combinedCharactersMap.get(e);if(void 0!==r)return r.get(t)},e.prototype.isNeutral=function(e){var t,r;try{for(var i=o(this.m_neutralCharacters),n=i.next();!n.done;n=i.next()){if(n.value===e)return!0}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},e}();t.ContextualArabicConverter=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this)||this;return r.mapView=t,r}return n(t,e),t}(r(0).Raycaster);t.PickingRaycaster=o},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(1),a=r(0),s=r(8),l=r(129),u=r(62),c=o.LoggerManager.instance.create("PoiRenderer"),d=new a.Vector3(0),h=function(){function e(e,t,r,i){this.mapView=e,this.scene=t,this.imageItem=r,this.renderOrder=i,this.color=s.ColorCache.instance.getColor("#000000")}return e.prototype.init=function(){void 0===this.boxBuffer&&this.setup()},e.prototype.reset=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.reset()},e.prototype.update=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.updateBufferGeometry()},e.prototype.setup=function(){var e=new u.IconTexture(this.imageItem),t=new a.Texture(e.image.imageData,a.UVMapping,void 0,void 0,a.LinearFilter,a.LinearFilter,a.RGBAFormat);t.needsUpdate=!0,t.premultiplyAlpha=!0,t.generateMipmaps=!1,this.m_material=new n.IconMaterial({map:t}),this.boxBuffer=new l.BoxBuffer(this.m_material,this.renderOrder);var r=this.boxBuffer.mesh;r.frustumCulled=!1,this.scene.add(r),this.mapView.update()},e}(),f=function(){function e(e,t){this.mapView=e,this.textCanvas=t,this.batches=[],this.m_batchMap=new Map,devicePixelRatio=e.pixelRatio}return e.prototype.registerPoi=function(e){var t=e.imageItem,r=e.imageTexture,i=e.imageTextureName;if(void 0===t||void 0===i||void 0===r)return-1;var n,o,a=e.renderOrder,s=r.image,l=this.m_batchMap.get(s);if(void 0===l&&(l=new Map,this.m_batchMap.set(s,l)),void 0!==(n=l.get(a)))return n;n=this.batches.length;var u=this.textCanvas.getLayer(a);return void 0===u&&(this.textCanvas.addText("",d,{layer:a}),u=this.textCanvas.getLayer(a)),(o=new h(this.mapView,u.scene,t,a)).init(),l.set(a,n),this.batches.push(o),n},e.prototype.addPoi=function(e,t,r){var i=this.registerPoi(e);return o.assert(i>=0),i<0?-1:(o.assert(void 0!==e.uvBox),void 0===this.batches[i].boxBuffer&&this.batches[i].init(),this.batches[i].boxBuffer.addBox(t,e.uvBox,this.batches[i].color,r,e.textElement.renderDistance,e.textElement),i)},e.prototype.getBatch=function(e){if(e>=0)return o.assert(e<this.batches.length),this.batches[e]},e.prototype.reset=function(){var e,t;devicePixelRatio=this.mapView.pixelRatio;try{for(var r=i(this.batches),n=r.next();!n.done;n=r.next()){n.value.reset()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.update=function(){var e,t;try{for(var r=i(this.batches),n=r.next();!n.done;n=r.next()){n.value.update()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.pickTextElements=function(e,t){var r,n;try{for(var o=i(this.batches),a=o.next();!a.done;a=o.next()){var s=a.value;void 0===s.boxBuffer&&s.init(),s.boxBuffer.pickBoxes(e,t,s.imageItem.imageData)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e}(),p=function(){function e(e,t){this.mapView=e,this.textCanvas=t,this.m_tempScreenBox=new o.Math2D.Box,this.m_renderBuffer=new f(e,t)}return e.prototype.prepareRender=function(e){var t=e.poiInfo;return void 0!==t&&(void 0===t.poiRenderBatch&&this.preparePoi(e),void 0!==t.poiRenderBatch)},e.prototype.computeScreenBox=function(e,t,r,i,n){return!!this.computeIconScreenBox(e,t,r,n)&&i.isVisible(n)},e.prototype.isSpaceAvailable=function(e,t){return!e.isAllocated(t)},e.prototype.reset=function(){this.m_renderBuffer.reset()},e.prototype.renderPoi=function(e,t,r,i,n,a){o.assert(void 0!==e.poiRenderBatch),this.computeIconScreenBox(e,t,i,this.m_tempScreenBox)&&(n&&r.allocate(this.m_tempScreenBox),this.m_renderBuffer.addPoi(e,this.m_tempScreenBox,a))},e.prototype.poiIsRenderable=function(e){return void 0!==e.poiRenderBatch},e.prototype.update=function(){this.m_renderBuffer.update()},e.prototype.pickTextElements=function(e,t){this.m_renderBuffer.pickTextElements(e,t)},e.prototype.computeIconScreenBox=function(e,t,r,i){if(o.assert(void 0!==e.poiRenderBatch),void 0===this.m_renderBuffer.getBatch(e.poiRenderBatch))return!1;var n=e.computedWidth*r,a=e.computedHeight*r,s=e.technique,l=t.x+(void 0!==s.iconXOffset?s.iconXOffset:0),u=t.y+(void 0!==s.iconYOffset?s.iconYOffset:0);return i.x=l-n/2,i.y=u-a/2,i.w=n,i.h=a,!0},e.prototype.preparePoi=function(t){var r=this,i=t.poiInfo;if(void 0!==i&&t.visible&&void 0===i.poiRenderBatch&&!1!==i.isValid){if(void 0!==i.poiTableName){if(!this.mapView.poiManager.updatePoiFromPoiTable(t))return;if(i.poiTableName=void 0,!t.visible)return}var n=i.imageTextureName,o=this.mapView.poiManager.getImageTexture(n);if(void 0===o)return void 0===e.m_missingTextureName.get(n)&&(e.m_missingTextureName.set(n,!0),c.error("preparePoi: No imageTexture with name '"+n+"' found")),void(i.isValid=!1);var a=o.image,s=this.mapView.imageCache.findImageByName(a);if(void 0===s)return c.error("init: No imageItem found with name '"+a+"'"),void(i.isValid=!1);if(!s.loaded){if(void 0!==s.loadingPromise)return;var l=s.url,u=this.mapView.imageCache.loadImage(s);if(u instanceof Promise)return void u.then(function(e){void 0!==e?r.setupPoiInfo(i,o,e):c.error("preparePoi: Failed to load imageItem: '"+l)}).catch(function(e){c.error("preparePoi: Failed to load imageItem: '"+l,e),i.isValid=!1});s=u}this.setupPoiInfo(i,o,s)}},e.prototype.setupPoiInfo=function(e,t,r){if(o.assert(void 0===e.uvBox),void 0===r||void 0===r.imageData)return c.error("setupPoiInfo: No imageItem/imageData found"),e.poiRenderBatch=-1,void(e.isValid=!1);var i,n,a=e.technique,s=r.imageData.width,l=r.imageData.height,u=void 0!==t.width?t.width:s,d=void 0!==t.height?t.height:l,h=0,f=1,p=void 0!==a.iconScale?a.iconScale:1,m=void 0!==a.iconScale?a.iconScale:1,v=void 0!==t.width?t.width:s,y=void 0!==t.height?t.height:l,g=void 0!==t.xOffset?t.xOffset:0,_=void 0!==t.yOffset?t.yOffset:0;i=g/s,n=(g+v)/s;h=(l-_)/l,f=(l-_-y)/l,void 0!==a.screenWidth&&(m=p=a.screenWidth/s),void 0!==a.screenHeight&&(m=a.screenHeight/l,void 0===a.screenWidth&&(p=m)),e.computedWidth=u*p*devicePixelRatio,e.computedHeight=d*m*devicePixelRatio,e.uvBox={s0:i,t0:f,s1:n,t1:h},e.imageItem=r,e.imageTexture=t,e.poiRenderBatch=this.m_renderBuffer.registerPoi(e),e.isValid=!0,o.assert(void 0!==e.poiRenderBatch)},e.m_missingTextureName=new Map,e}();t.PoiRenderer=p},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(130),l=0,u=32768,c=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.type="BoxBufferMesh",i}return n(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return void 0===this.geometry||0===this.geometry.index.count},enumerable:!0,configurable:!0}),t}(a.Mesh);t.BoxBufferMesh=c;var d=function(){function e(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=l),void 0===i&&(i=u),this.material=e,this.renderOrder=t,this.startElementCount=r,this.maxElementCount=i,this.m_size=0,this.resizeBuffer(r),this.pickInfos=new Array}return e.prototype.clone=function(){return new e(this.material,this.renderOrder)},e.prototype.dispose=function(){void 0!==this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.internalMesh=void 0},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),e.prototype.reset=function(){void 0!==this.positionAttribute&&(this.positionAttribute.count=0,this.colorAttribute.count=0,this.uvAttribute.count=0,this.indexAttribute.count=0,this.pickInfos.length=0)},e.prototype.canAddElements=function(e){void 0===e&&(e=1);var t=this.indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.maxElementCount)return!1;var r=Math.min(this.maxElementCount,0===this.size?256:2*this.size);this.resize(r)}return!0},e.prototype.saveState=function(){return{positionAttributeCount:this.positionAttribute.count,colorAttributeCount:this.colorAttribute.count,uvAttributeCount:this.uvAttribute.count,indexAttributeCount:this.indexAttribute.count,pickInfoCount:this.pickInfos.length}},e.prototype.restoreState=function(e){this.positionAttribute.count=e.positionAttributeCount,this.colorAttribute.count=e.colorAttributeCount,this.uvAttribute.count=e.uvAttributeCount,this.indexAttribute.count=e.indexAttributeCount,this.pickInfos.length=e.pickInfoCount},e.prototype.addBox=function(e,t,r,i,n,o){if(!this.canAddElements())return!1;var a=t.s0,s=t.t0,l=t.s1,u=t.t1,c=e.x,d=e.y,h=e.w,f=e.h,p=Math.round(255*r.r),m=Math.round(255*r.g),v=Math.round(255*r.b),y=Math.round(255*i),g=this.positionAttribute,_=this.colorAttribute,b=this.uvAttribute,x=this.indexAttribute,w=g.count,S=x.count;return g.setXYZ(w,c,d,n),g.setXYZ(w+1,c+h,d,n),g.setXYZ(w+2,c,d+f,n),g.setXYZ(w+3,c+h,d+f,n),_.setXYZW(w,p,m,v,y),_.setXYZW(w+1,p,m,v,y),_.setXYZW(w+2,p,m,v,y),_.setXYZW(w+3,p,m,v,y),b.setXY(w,a,s),b.setXY(w+1,l,s),b.setXY(w+2,a,u),b.setXY(w+3,l,u),x.setX(S,w),x.setX(S+1,w+1),x.setX(S+2,w+2),x.setX(S+3,w+2),x.setX(S+4,w+1),x.setX(S+5,w+3),g.count+=4,_.count+=4,b.count+=4,x.count+=6,this.pickInfos.push(o),!0},e.prototype.updateBufferGeometry=function(){var e=this.positionAttribute,t=this.colorAttribute,r=this.uvAttribute,i=this.indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=4*r.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=i.count),void 0!==this.geometry&&(this.geometry.clearGroups(),this.geometry.addGroup(0,this.indexAttribute.count))},e.prototype.cleanUp=function(){0===this.indexAttribute.count&&this.size>l&&this.clearAttributes()},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.internalMesh.isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return void 0===this.internalMesh&&this.resize(),this.internalMesh},enumerable:!0,configurable:!0}),e.prototype.pickBoxes=function(e,t,r){for(var i=this.pickInfos.length,n=this.pickInfos,a=this.positionAttribute,s=e.x,l=e.y,u=document.createElement("canvas"),c=0;c<i;c++){var d=4*c,h=a.getX(d);if(!(s<h)){var f=a.getX(d+1);if(!(s>f)){var p=a.getY(d);if(!(l<p)){var m=a.getY(d+2);if(!(l>m)){var v=new o.Math2D.Box(h,p,f-h,m-p);void 0!==r&&void 0!==n[c].poiInfo&&void 0!==n[c].poiInfo.uvBox&&this.isPixelTransparent(r,s,l,v,n[c].poiInfo.uvBox,u)||void 0!==n[c]&&t(n[c])}}}}}},e.prototype.resize=function(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new a.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.addAttribute("position",this.positionAttribute),this.geometry.addAttribute("color",this.colorAttribute),this.geometry.addAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?(this.internalMesh=new c(this.geometry,this.material),this.internalMesh.renderOrder=this.renderOrder):this.internalMesh.geometry=this.geometry,this.internalMesh},e.prototype.isPixelTransparent=function(e,t,r,i,n,o){var a=!1,l=s.screenToUvCoordinates(t,r,i,n),u=l.u,c=l.v,d=e.width*u,h=e.height*c,f=s.getPixelFromImage(d,h,e,o);return void 0!==f&&0===f[3]&&(a=!0),a},e.prototype.clearAttributes=function(){this.positionAttribute=void 0,this.colorAttribute=void 0,this.uvAttribute=void 0,this.indexAttribute=void 0,this.resize(l,!0)},e.prototype.resizeBuffer=function(e){var t=new Float32Array(4*e*3);if(void 0!==this.positionAttribute&&this.positionAttribute.array.length>0){var r=this.positionAttribute.count;t.set(this.positionAttribute.array),this.positionAttribute.setArray(t),this.positionAttribute.count=r}else this.positionAttribute=new a.BufferAttribute(t,3),this.positionAttribute.count=0,this.positionAttribute.setDynamic(!0);var i=new Uint8Array(4*e*4);if(void 0!==this.colorAttribute){var n=this.colorAttribute.count;i.set(this.colorAttribute.array),this.colorAttribute.setArray(i),this.colorAttribute.count=n}else this.colorAttribute=new a.BufferAttribute(i,4,!0),this.colorAttribute.count=0,this.colorAttribute.setDynamic(!0);var o=new Float32Array(4*e*4);if(void 0!==this.uvAttribute){var s=this.uvAttribute.count;o.set(this.uvAttribute.array),this.uvAttribute.setArray(o),this.uvAttribute.count=s}else this.uvAttribute=new a.BufferAttribute(o,4),this.uvAttribute.count=0,this.uvAttribute.setDynamic(!0);var l=6*e*1,u=l>65535?new Uint32Array(l):new Uint16Array(l);if(void 0!==this.indexAttribute){var c=this.indexAttribute.count;u.set(this.indexAttribute.array),this.indexAttribute.setArray(u),this.indexAttribute.count=c}else this.indexAttribute=new a.BufferAttribute(u,1),this.indexAttribute.count=0,this.indexAttribute.setDynamic(!0);this.m_size=e},e}();t.BoxBuffer=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);function n(e,t,r,i){if(!(t>e.width||t<0||r>e.height||r<0)){var n;i.width=e.width,i.height=e.height;var o=i.getContext("2d");return null!==o&&(o.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),n=o.getImageData(t,r,1,1).data),n}}function o(e,t,r,i){if(!(t>e.width||t<0||r>e.height||r<0))return function(e,t,r){for(var i=t*r,n=e.data,o=new Uint8ClampedArray(r),a=0;a<r;a++)o[0]=n[i+a];return o}(e,r*e.width+t,i)}t.getPixelFromImage=function(e,t,r,i){var a;if(void 0!==r.close)void 0===i&&(i=document.createElement("canvas")),a=n(r,e,t,i);else{var s=r;a=o(s,e,t,s.data.length/(s.height*s.width))}return a},t.screenToUvCoordinates=function(e,t,r,n){var o=r.x,a=r.x+r.w,s=r.y,l=r.y+r.h;return{u:i.MathUtils.lerp(e,o,a,n.s0,n.s1),v:i.MathUtils.lerp(t,s,l,n.t0,n.t1)}},t.getPixelFromImageBitmap=n,t.getPixelFromImageData=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.getLengths=function(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths},t}(o.LineCurve);t.SimpleLineCurve=a;var s=function(){function e(e,t,r){this.path=e,this.index=t,this.t=r}return Object.defineProperty(e.prototype,"curve",{get:function(){return this.path.curves[this.index]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point},enumerable:!0,configurable:!0}),e}();t.PathParam=s;var l=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.getLengths=function(){if(this.m_cache)return this.m_cache;var e=0,t=new Array;return t.push(0),this.curves.forEach(function(r){var i=r;e+=i.v1.distanceTo(i.v2),t.push(e)}),this.m_cache=t,t},t.prototype.getParamAt=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;++i)if(!(r[i]<t)){var n=r[i]-t,o=this.curves[i].getLength();return new s(this,i,0===o?0:1-n/o)}return null},t}(o.Path);t.SimplePath=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(32);var i=r(1).LoggerManager.instance.create("WorkerLoader"),n=function(){function e(){}return e.startWorker=function(t){var r=this;return t.startsWith("blob:")?this.startWorkerImmediately(t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(t):this.startWorkerImmediately(t).catch(function(n){return i.log("#startWorker: worker construction failed, attempting load with blob"),r.directlyFallbackToBlobBasedLoading=!0,e.startWorkerBlob(t)})},e.startWorkerImmediately=function(e){try{var t=new Worker(e);return this.waitWorkerInitialized(t)}catch(e){return Promise.reject(e)}},e.startWorkerBlob=function(e){var t=this;return this.fetchScriptSourceToBlobUrl(e).then(function(e){return t.startWorkerImmediately(e)})},e.fetchScriptSourceToBlobUrl=function(e){var t=this,r=this.sourceLoaderCache.get(e);return void 0!==r?r:(r=fetch(e).then(function(e){return e.text()}).catch(function(e){throw new Error("WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: "+e)}).then(function(r){t.sourceLoaderCache.delete(e);var i=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(i)}),this.sourceLoaderCache.set(e,r),r)},e.waitWorkerInitialized=function(e){return new Promise(function(t,r){var i=function(r){e.removeEventListener("message",i),e.removeEventListener("error",n),t(e),setTimeout(function(){e.dispatchEvent(r)},0)},n=function(t){e.removeEventListener("message",i),e.removeEventListener("error",n),r(new Error("#waitWorkerInitialized: Error event before first message."))};e.addEventListener("message",i),e.addEventListener("error",n)})},e.directlyFallbackToBlobBasedLoading=!1,e.sourceLoaderCache=new Map,e}();t.WorkerLoader=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(60),s=r(134),l=o.LoggerManager.instance.create("ScreenCollissions"),u=function(){function e(){this.screenBounds=new o.Math2D.Box,this.rtree=new s,this.m_returnArray=[]}return e.toBox2D=function(e,t){t.x=e.min.x,t.y=e.min.y,t.w=e.max.x-e.min.x,t.h=e.max.y-e.min.y},e.prototype.reset=function(){this.rtree=new s},e.prototype.update=function(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()},e.prototype.allocate=function(e){this.rtree.insert(e,null)},e.prototype.isAllocated=function(e){return this.m_returnArray.length=0,this.m_returnArray=this.rtree.search(e,void 0,this.m_returnArray),0!==this.m_returnArray.length},e.prototype.isVisible=function(e){return this.screenBounds.intersects(e)},e}();t.ScreenCollisions=u;var c=function(e){function t(t){var r=e.call(this)||this;return r.m_renderContext=null,r.m_renderingEnabled=!1,r.m_numAllocations=0,r.m_numSuccessfulTests=0,r.m_numFailedTests=0,r.m_numSuccessfulVisibilityTests=0,r.m_numFailedVisibilityTests=0,null!=t&&(r.m_renderContext=t.getContext("2d")),r}return n(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0},t.prototype.update=function(t,r){this.m_renderingEnabled&&l.log("Allocations: "+this.m_numAllocations+" Successful Tests: "+this.m_numSuccessfulTests+" Failed Tests: "+this.m_numFailedTests+"  Successful Visibility Tests: "+this.m_numSuccessfulVisibilityTests+"  Failed Visibility Tests: "+this.m_numFailedVisibilityTests+" "),e.prototype.update.call(this,t,r),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=t,this.m_renderContext.canvas.height=r),this.m_renderingEnabled=a.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")},t.prototype.allocate=function(t){e.prototype.allocate.call(this,t),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(t.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.y-1,t.w,-t.h))},t.prototype.isAllocated=function(t){var r=e.prototype.isAllocated.call(this,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){var i=r?2:0;this.m_renderContext.strokeStyle=r?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(t.x-this.screenBounds.x-i,this.screenBounds.y+this.screenBounds.h-t.y-1+i,t.w+2*i,-t.h-2*i)}return r?this.m_numFailedTests++:this.m_numSuccessfulTests++,r},t.prototype.isVisible=function(t){var r=e.prototype.isVisible.call(this,t);return r?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,r},t}(u);t.ScreenCollisionsDebug=c},function(e,t,r){"use strict";var i=r(135),n=r(136);i.prototype.bbox=n.bbox,i.prototype.geoJSON=n.geoJSON,i.Rectangle=r(34),e.exports=i},function(e,t,r){"use strict";var i=r(34);function n(e){if(!(this instanceof n))return new n(e);var t=3,r=6;isNaN(e)||(t=Math.floor(e/2),r=e);var o={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=o;var a=function(e){for(var t,r=e.slice(),i=[];r.length;)(t=r.pop()).nodes?r=r.concat(t.nodes):t.leaf&&i.push(t);return i},s=function(e,r,n){var o,s,l,u=[],c=[],f=[];if(!e||!i.overlapRectangle(e,n))return f;var p={x:e.x,y:e.y,w:e.w,h:e.h,target:r};for(c.push(n.nodes.length),u.push(n);u.length>0;){if(o=u.pop(),s=c.pop()-1,"target"in p)for(;s>=0;){if(l=o.nodes[s],i.overlapRectangle(p,l)){if(p.target&&"leaf"in l&&l.leaf===p.target||!p.target&&("leaf"in l||i.containsRectangle(l,p))){f="nodes"in l?a(o.nodes.splice(s,1)):o.nodes.splice(s,1),i.makeMBR(o.nodes,o),delete p.target;break}"nodes"in l&&(0,c.push(s),u.push(o),o=l,s=l.nodes.length)}s--}else if("nodes"in p){o.nodes.splice(s+1,1),o.nodes.length>0&&i.makeMBR(o.nodes,o);for(var m=0;m<p.nodes.length;m++)h(p.nodes[m],o);p.nodes=[],0===u.length&&o.nodes.length<=1?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[],u.push(o),c.push(1)):u.length>0&&o.nodes.length<t?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[]):delete p.nodes}else i.makeMBR(o.nodes,o);1}return f},l=function(e){for(var t=c(e);e.length>0;)u(e,t[0],t[1]);return t},u=function(e,r,n){for(var o,a,s,l=i.squarifiedRatio(r.w,r.h,r.nodes.length+1),u=i.squarifiedRatio(n.w,n.h,n.nodes.length+1),c=e.length-1;c>=0;c--){var d=e[c],h={};h.x=Math.min(r.x,d.x),h.y=Math.min(r.y,d.y),h.w=Math.max(r.x+r.w,d.x+d.w)-h.x,h.h=Math.max(r.y+r.h,d.y+d.h)-h.y;var f=Math.abs(i.squarifiedRatio(h.w,h.h,r.nodes.length+2)-l),p={};p.x=Math.min(n.x,d.x),p.y=Math.min(n.y,d.y),p.w=Math.max(n.x+n.w,d.x+d.w)-p.x,p.h=Math.max(n.y+n.h,d.y+d.h)-p.y;var m=Math.abs(i.squarifiedRatio(p.w,p.h,n.nodes.length+2)-u);(!a||!o||Math.abs(m-f)<o)&&(a=c,o=Math.abs(m-f),s=m<f?n:r)}var v=e.splice(a,1)[0];r.nodes.length+e.length+1<=t?(r.nodes.push(v),i.expandRectangle(r,v)):n.nodes.length+e.length+1<=t?(n.nodes.push(v),i.expandRectangle(n,v)):(s.nodes.push(v),i.expandRectangle(s,v))},c=function(e){for(var t,r,i=e.length-1,n=0,o=e.length-1,a=0,s=e.length-2;s>=0;s--){var l=e[s];l.x>e[n].x?n=s:l.x+l.w<e[i].x+e[i].w&&(i=s),l.y>e[a].y?a=s:l.y+l.h<e[o].y+e[o].h&&(o=s)}return Math.abs(e[i].x+e[i].w-e[n].x)>Math.abs(e[o].y+e[o].h-e[a].y)?i>n?(t=e.splice(i,1)[0],r=e.splice(n,1)[0]):(r=e.splice(n,1)[0],t=e.splice(i,1)[0]):o>a?(t=e.splice(o,1)[0],r=e.splice(a,1)[0]):(r=e.splice(a,1)[0],t=e.splice(o,1)[0]),[{x:t.x,y:t.y,w:t.w,h:t.h,nodes:[t]},{x:r.x,y:r.y,w:r.w,h:r.h,nodes:[r]}]},d=function(e,t,r,n){var o=[];if(!i.overlapRectangle(e,n))return r;for(o.push(n.nodes);o.length>0;)for(var a=o.pop(),s=a.length-1;s>=0;s--){var l=a[s];i.overlapRectangle(e,l)&&("nodes"in l?o.push(l.nodes):"leaf"in l&&(t?r.push(l):r.push(l.leaf)))}return r},h=function(e,t){var n;if(0===t.nodes.length)return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,void t.nodes.push(e);for(var o,a=function(e,t){var r,n=-1,o=[],a=!0;o.push(t);for(var s=t.nodes;a||-1!==n;){a?a=!1:(o.push(s[n]),s=s[n].nodes,n=-1);for(var l=s.length-1;l>=0;l--){var u=s[l];if("leaf"in u){n=-1;break}var c=i.squarifiedRatio(u.w,u.h,u.nodes.length+1),d=Math.max(u.x+u.w,e.x+e.w)-Math.min(u.x,e.x),h=Math.max(u.y+u.h,e.y+e.h)-Math.min(u.y,e.y),f=i.squarifiedRatio(d,h,u.nodes.length+2);(n<0||Math.abs(f-c)<r)&&(r=Math.abs(f-c),n=l)}}return o}(e,t),s=e;a.length>0;){if(n&&"nodes"in n&&0===n.nodes.length){o=n,n=a.pop();for(var u=0;u<n.nodes.length;u++)if(n.nodes[u]===o||0===n.nodes[u].nodes.length){n.nodes.splice(u,1);break}}else n=a.pop();if("leaf"in s||"nodes"in s||Array.isArray(s)){if(Array.isArray(s)){for(var c=0;c<s.length;c++)i.expandRectangle(n,s[c]);n.nodes=n.nodes.concat(s)}else i.expandRectangle(n,s),n.nodes.push(s);if(n.nodes.length<=r)s={x:n.x,y:n.y,w:n.w,h:n.h};else{var d=l(n.nodes);s=d,a.length<1&&(n.nodes.push(d[0]),a.push(n),s=d[1])}}else i.expandRectangle(n,s),s={x:n.x,y:n.y,w:n.w,h:n.h}}};this.insertSubtree=h,this.getTree=function(){return o},this.setTree=function(e,t){return t||(t=o),i=e,(r=t).nodes=i.nodes,r.x=i.x,r.y=i.y,r.w=i.w,r.h=i.h,r;var r,i},this.search=function(e,t,r){return d(e,t,r=r||[],o)};this.remove=function(e,t){return t&&"function"!=typeof t?function(e,t){return s(e,t,o)}(e,t):function(e){for(var t,r=1,i=[];r>0;)r=(t=s(e,!1,o)).length,i=i.concat(t);return i}(e)},this.insert=function(e,t){return h({x:e.x,y:e.y,w:e.w,h:e.h,leaf:t},o)}}n.prototype.toJSON=function(e){return JSON.stringify(this.root,!1,e)},n.fromJSON=function(e){var t=new n;return t.setTree(JSON.parse(e)),t},e.exports=n,"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"object"==typeof e&&"[object Array]"==={}.toString.call(e)})},function(e,t,r){"use strict";var i=r(34),n=function(e,t){if(t&&t.bbox)return{leaf:t,x:t.bbox[0],y:t.bbox[1],w:t.bbox[2]-t.bbox[0],h:t.bbox[3]-t.bbox[1]};for(var r=e.length,i=0,n=new Array(r);i<r;)n[i]=[e[i][0],e[i][1]],i++;var o=n[0];r=n.length,i=1;for(var a={min:[].concat(o),max:[].concat(o)};i<r;)n[i][0]<a.min[0]?a.min[0]=n[i][0]:n[i][0]>a.max[0]&&(a.max[0]=n[i][0]),n[i][1]<a.min[1]?a.min[1]=n[i][1]:n[i][1]>a.max[1]&&(a.max[1]=n[i][1]),i++;var s={x:a.min[0],y:a.min[1],w:a.max[0]-a.min[0],h:a.max[1]-a.min[1]};return t&&(s.leaf=t),s},o={point:function(e,t){return t.insertSubtree({x:e.geometry.coordinates[0],y:e.geometry.coordinates[1],w:0,h:0,leaf:e},t.root)},multiPointLineString:function(e,t){return t.insertSubtree(n(e.geometry.coordinates,e),t.root)},multiLineStringPolygon:function(e,t){return t.insertSubtree(n(Array.prototype.concat.apply([],e.geometry.coordinates),e),t.root)},multiPolygon:function(e,t){return t.insertSubtree(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],e.geometry.coordinates)),e),t.root)},makeRec:function(e){return i(e.x,e.y,e.w,e.h)},geometryCollection:function(e,t){if(e.bbox)return t.insertSubtree({leaf:e,x:e.bbox[0],y:e.bbox[1],w:e.bbox[2]-e.bbox[0],h:e.bbox[3]-e.bbox[1]},t.root);for(var r,i=e.geometry.geometries,a=0,s=i.length,l=[];a<s;){switch((r=i[a]).type){case"Point":l.push(o.makeRec({x:r.coordinates[0],y:r.coordinates[1],w:0,h:0}));break;case"MultiPoint":case"LineString":l.push(o.makeRec(n(r.coordinates)));break;case"MultiLineString":case"Polygon":l.push(o.makeRec(n(Array.prototype.concat.apply([],r.coordinates))));break;case"MultiPolygon":l.push(o.makeRec(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],r.coordinates)))));break;case"GeometryCollection":s=(i=i.concat(r.geometries)).length}a++}var u=l[0];for(a=1,s=l.length;a<s;)u.expand(l[a]),a++;return t.insertSubtree({leaf:e,x:u.x(),y:u.y(),h:u.h(),w:u.w()},t.root)}};t.geoJSON=function(e){var t,r;if(Array.isArray(e))t=e.slice();else if(e.features&&Array.isArray(e.features))t=e.features.slice();else{if(!(e instanceof Object))throw"this isn't what we're looking for";t=[e]}for(var i=t.length,n=0;n<i;){if("Feature"===(r=t[n]).type)switch(r.geometry.type){case"Point":o.point(r,this);break;case"MultiPoint":case"LineString":o.multiPointLineString(r,this);break;case"MultiLineString":case"Polygon":o.multiLineStringPolygon(r,this);break;case"MultiPolygon":o.multiPolygon(r,this);break;case"GeometryCollection":o.geometryCollection(r,this)}n++}},t.bbox=function(){var e,t,r,i;switch(arguments.length){case 1:e=arguments[0][0][0],t=arguments[0][0][1],r=arguments[0][1][0],i=arguments[0][1][1];break;case 2:e=arguments[0][0],t=arguments[0][1],r=arguments[1][0],i=arguments[1][1];break;case 4:e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3]}return this.search({x:e,y:t,w:r-e,h:i-t})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){this.m_projectionViewMatrix=new i.Matrix4,this.m_viewMatrix=new i.Matrix4,this.m_cameraPosition=new i.Vector3,this.m_center=new i.Vector3,this.m_width=0,this.m_height=0,this.m_nearClipPlane=0,this.m_farClipPlane=0}return Object.defineProperty(e.prototype,"width",{get:function(){return this.m_width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.m_height},enumerable:!0,configurable:!0}),e.prototype.projectVector=function(e){return e.x-=this.m_center.x+this.m_cameraPosition.x,e.y-=this.m_center.y+this.m_cameraPosition.y,e.z-=this.m_center.z+this.m_cameraPosition.z,e.applyMatrix4(this.m_projectionViewMatrix),e},e.prototype.project=function(e,t){void 0===t&&(t=new i.Vector2);var r=this.projectVector(e.clone());if(r.z>0&&r.z<1)return t.set(r.x*this.m_width/2,r.y*this.m_height/2),t},e.prototype.update=function(e,t,r,n){this.m_width=r,this.m_height=n,e instanceof i.PerspectiveCamera&&(this.m_nearClipPlane=e.near,this.m_farClipPlane=e.far),this.m_center.copy(t),this.m_viewMatrix.makeRotationFromQuaternion(e.quaternion),this.m_viewMatrix.transpose(),this.m_cameraPosition.copy(e.position),this.m_projectionViewMatrix.multiplyMatrices(e.projectionMatrix,this.m_viewMatrix)},e}();t.ScreenProjector=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(139),o=function(){function e(e,t,r,o,a){void 0===a&&(a=n.DEFAULT_MONOMIAL_POWER),this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=r,this.m_monomialPower=a,this.m_gradient=new n.SkyGradientTexture(e,t,r,a),this.m_farClipPlaneDividedVertically=new i.Line3,this.m_groundPlane=new i.Plane(new i.Vector3(0,0,1)),this.m_bottomMidFarPoint=new i.Vector3,this.m_topMidFarPoint=new i.Vector3,this.m_horizonPosition=new i.Vector3,this.m_farClipPlaneCorners=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3],this.update(o)}return Object.defineProperty(e.prototype,"topColor",{get:function(){return this.m_topColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomColor",{get:function(){return this.m_bottomColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundColor",{get:function(){return this.m_groundColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monomialPower",{get:function(){return this.m_monomialPower},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_gradient.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizon",{get:function(){return this.m_horizonPosition},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.setHorizonPosition(e),this.updateTexturePosition()},e.prototype.updateColors=function(e,t,r){this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=r,this.m_gradient.update(e,t,r)},e.prototype.setHorizonPosition=function(e){this.setFarPlaneCornersFromCamera(e,this.m_farClipPlaneCorners);var t=this.m_farClipPlaneCorners[0],r=this.m_farClipPlaneCorners[1],i=this.m_farClipPlaneCorners[2],n=this.m_farClipPlaneCorners[3];this.setMidPoint(t,r,this.m_bottomMidFarPoint),this.setMidPoint(i,n,this.m_topMidFarPoint),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)},e.prototype.updateTexturePosition=function(){var e,t=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance();0===this.m_horizonPosition.length()?e=1:e=t-1/this.m_gradient.texture.image.height;this.m_bottomMidFarPoint.z<=0?this.m_gradient.updateYOffset(-e):this.m_gradient.updateYOffset(t)},e.prototype.setMidPoint=function(e,t,r){r.set((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},e.prototype.setFarPlaneCornersFromCamera=function(e,t){var r=0;function i(i,n,o){t[r++].set(i,n,o).unproject(e)}i(-1,-1,1),i(1,-1,1),i(-1,1,1),i(1,1,1)},e}();t.SkyBackground=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);t.DEFAULT_TEXTURE_HEIGHT=512;t.DEFAULT_MONOMIAL_POWER=1;var n=function(){function e(e,r,i,n,o){void 0===o&&(o=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=r,this.m_groundColor=i,this.m_monomialPower=n,this.m_height=o,this.m_texture=this.createTexture()}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_texture},enumerable:!0,configurable:!0}),e.prototype.updateYOffset=function(e){e<=0&&this.m_texture.offset.set(0,e)},e.prototype.update=function(e,r,i,n){void 0===n&&(n=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=r,this.m_groundColor=i,this.updateTextureColors()},e.prototype.updateTextureColors=function(){var e=this.m_texture.image.data;this.fillTextureData(e),this.m_texture.needsUpdate=!0},e.prototype.createTexture=function(){var e=1*this.m_height,t=new Uint8Array(3*e);this.fillTextureData(t);var r=new i.DataTexture(t,1,this.m_height,i.RGBFormat);return r.needsUpdate=!0,r.unpackAlignment=1,r},e.prototype.fillTextureData=function(e){var t=1*this.m_height,r=this.m_topColor,n=this.m_bottomColor,o=this.m_groundColor;e[0]=255*o.r,e[1]=255*o.g,e[2]=255*o.b;for(var a=new i.Color,s=1;s<t;s++){var l=a.copy(n).lerp(r,Math.pow(s/t,this.m_monomialPower)).multiplyScalar(255),u=l.r,c=l.g,d=l.b,h=3*s;e[h]=u,e[h+1]=c,e[h+2]=d}},e}();t.SkyGradientTexture=n},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(56),a=r(0),s=r(141),l=function(){return function(e,t){this.tile=e,this.area=t}}();t.TileEntry=l;var u=function(){return function(e,t){this.tileKey=e,this.area=t}}(),c=function(){function e(e){var t=this;this.disposedTiles=[],this.tileCache=new o.LRUCache(e.tileCacheSize),this.tileCache.evictionCallback=function(e,r){void 0!==r.tileLoader&&r.tileLoader.cancel(),t.disposedTiles.push(r)},this.tileCache.canEvict=function(e,t){return!t.isVisible}}return e.prototype.disposeTiles=function(){this.disposedTiles.forEach(function(e){e.dispose()}),this.disposedTiles.length=0},e.prototype.get=function(e){return this.tileCache.get(e)},e}(),d=function(){function e(e,t){this.camera=e,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_dataSourceCache=new Map,this.m_viewProjectionMatrix=new a.Matrix4,this.m_frustum=new a.Frustum,this.m_mapTileCuller=new s.MapTileCuller(e),this.options=t}return e.prototype.getDataSourceCacheSize=function(){return this.options.tileCacheSize},e.prototype.setDataSourceCacheSize=function(e){this.options.tileCacheSize=e,this.m_dataSourceCache.forEach(function(t){t.tileCache.setCapacity(e)})},e.prototype.getNumberOfVisibleTiles=function(){return this.options.maxVisibleDataSourceTiles},e.prototype.setNumberOfVisibleTiles=function(e){this.options.maxVisibleDataSourceTiles=e},e.prototype.updateRenderList=function(e,t,r,o){var s,l,c=this;this.m_viewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.m_frustum.setFromMatrix(this.m_viewProjectionMatrix);var d=n.TileKey.fromRowColumnLevel(0,0,0),h=new a.Box3,f=[],p=!0;this.options.extendedFrustumCulling&&this.m_mapTileCuller.setup();var m=function(i){var n=i.getDisplayZoomLevel(r),o=i.getTilingScheme(),s=[new u(d,0)],l=[],m=new Map;for(m.set(d.mortonCode(),1/0);s.length>0;){if(void 0!==(w=s.pop())){var y=m.get(w.tileKey.mortonCode());if(void 0===y)throw new Error("Unexpected tile key");y<=0||w.tileKey.level>n||(i.shouldRender(n,w.tileKey)&&l.push(w),o.getSubTileKeys(w.tileKey).forEach(function(t){var r=0;if(void 0===m.get(t.mortonCode())){var i=o.getGeoBox(t);if(c.options.projection.projectBox(i,h),h.min.sub(e),h.max.sub(e),(!c.options.extendedFrustumCulling||c.m_mapTileCuller.frustumIntersectsTileBox(h))&&c.m_frustum.intersectsBox(h)){var n=[new a.Vector3(h.min.x,h.min.y,0).applyMatrix4(c.m_viewProjectionMatrix),new a.Vector3(h.max.x,h.min.y,0).applyMatrix4(c.m_viewProjectionMatrix),new a.Vector3(h.max.x,h.max.y,0).applyMatrix4(c.m_viewProjectionMatrix),new a.Vector3(h.min.x,h.max.y,0).applyMatrix4(c.m_viewProjectionMatrix)];n.push(n[0]);for(var l=n.length,d=l-1,f=0;f<l;d=f++)r+=n[d].x*n[f].y-n[f].x*n[d].y;r=Math.abs(.5*r)}m.set(t.mortonCode(),r)}r>0&&s.push(new u(t,r))}))}}l.sort(function(e,t){var r=t.area-e.area,i=.001*(e.area+t.area);return Math.abs(r)<i?t.tileKey.mortonCode()-e.tileKey.mortonCode():r});for(var g=[],_=!0,b=0,x=0;x<l.length&&g.length<v.options.maxVisibleDataSourceTiles;x++){var w=l[x];if(i.shouldRender(n,w.tileKey)){var S=v.getTile(i,w.tileKey);void 0!==S&&(S.isVisible=!0,S.prepareForRender(),_=_&&S.hasGeometry,S.hasGeometry?(S.numFramesVisible++,S.frameNumVisible<0&&(S.frameNumVisible=i.mapView.frameNumber)):b++,g.push(S),S.visibleArea=w.area)}}f.push({dataSource:i,storageLevel:t,zoomLevel:n,allVisibleTileLoaded:_,numTilesLoading:b,visibleTiles:g,renderedTiles:g}),p=p&&_},v=this;try{for(var y=i(o),g=y.next();!g.done;g=y.next()){m(g.value)}}catch(e){s={error:e}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}return this.dataSourceTileList=f,this.allVisibleTilesLoaded=p,this.fillMissingTilesFromCache(),this.forEachCachedTile(function(e){e.isVisible||void 0===e.tileLoader||e.tileLoader.isFinished||(e.tileLoader.cancel(),c.disposeTile(e))}),f},e.prototype.getTile=function(e,t){if(!e.cacheable)return e.getTile(t);var r=this.getOrCreateCache(e).tileCache,i=r.get(t.mortonCode());return void 0!==i?i:(void 0!==(i=e.getTile(t))&&(r.set(t.mortonCode(),i),i.frameNumRequested=e.mapView.frameNumber),i)},e.prototype.removeDataSource=function(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(function(t){return t.dataSource.name!==e}),this.m_dataSourceCache.delete(e)},e.prototype.clearTileCache=function(e){if(void 0!==e){var t=this.m_dataSourceCache.get(e);t&&t.tileCache.evictAll()}else this.m_dataSourceCache.forEach(function(e){e.tileCache.evictAll()})},e.prototype.markTilesDirty=function(e){var t=this;if(void 0===e)this.dataSourceTileList.forEach(function(e){t.markDataSourceTilesDirty(e)});else{var r=this.dataSourceTileList.find(function(t){return t.dataSource===e});if(void 0===r)return;this.markDataSourceTilesDirty(r)}},e.prototype.disposePendingTiles=function(){this.m_dataSourceCache.forEach(function(e){e.disposeTiles()})},e.prototype.forEachVisibleTile=function(e){var t,r;try{for(var n=i(this.dataSourceTileList),o=n.next();!o.done;o=n.next()){o.value.visibleTiles.forEach(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.forEachCachedTile=function(e){this.m_dataSourceCache.forEach(function(t){t.tileCache.forEach(function(t){e(t)})})},e.prototype.disposeTile=function(e){var t=this.m_dataSourceCache.get(e.dataSource.name);t&&(t.tileCache.delete(e.tileKey.mortonCode()),e.dispose())},e.prototype.fillMissingTilesFromCache=function(){var e=this;this.dataSourceTileList.forEach(function(t){var r,i=t.dataSource,o=i.getTilingScheme(),a=t.zoomLevel,s=new Map,l=new Set;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.BOTH=2]="BOTH"}(r||(r={}));var u=e.m_dataSourceCache.get(i.name),c=e.options.quadTreeSearchDistanceUp>0&&void 0!==u&&a>i.minZoomLevel,d=e.options.quadTreeSearchDistanceDown>0&&void 0!==u&&a<i.maxZoomLevel;if(d||c){var h=d&&c?r.BOTH:d?r.DOWN:r.UP,f=new Map;if(t.visibleTiles.forEach(function(e){var t=e.tileKey.mortonCode();e.hasGeometry?s.set(t,e):f.set(t,h)}),0!==f.size){for(var p=function(){var t=new Map;f.forEach(function(i,c){if(i===r.BOTH||i===r.UP){var d=n.TileKey.parentMortonCode(c);if(!l.has(d)&&!s.get(d)){l.add(d);var h=u.get(d);if(void 0!==h&&h.hasGeometry)return void s.set(d,h);var f=h?h.tileKey:n.TileKey.fromMortonCode(d);Math.abs(a-f.level)<e.options.quadTreeSearchDistanceUp&&t.set(d,r.UP)}}if(i===r.BOTH||i===r.DOWN){var p=n.TileKey.fromMortonCode(c);o.getSubTileKeys(p).forEach(function(i){var n=i.mortonCode(),o=u.get(n);(l.add(n),void 0!==o&&o.hasGeometry)?s.set(n,o):Math.abs(i.level-a)<e.options.quadTreeSearchDistanceDown&&t.set(n,r.DOWN)})}}),f=t};void 0!==u&&0!==f.size;)p();t.renderedTiles=Array.from(s.values())}}})},e.prototype.getOrCreateCache=function(e){var t=e.name,r=this.m_dataSourceCache.get(t);return void 0===r&&(r=new c(this.options),this.m_dataSourceCache.set(t,r)),r},e.prototype.markDataSourceTilesDirty=function(e){var t=this.m_dataSourceCache.get(e.dataSource.name),r=new Set;e.visibleTiles.forEach(function(e){r.add(e.tileKey.mortonCode()),e.reload()}),e.renderedTiles.forEach(function(e){var t=e.tileKey.mortonCode();r.has(t)||(r.add(t),e.reload())}),void 0!==t&&t.tileCache.forEach(function(e,i){r.has(i)||(e.dispose(),t.tileCache.delete(i))})},e}();t.VisibleTileSet=d},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(){function e(e){this.m_camera=e,this.m_globalFrustumMin=new n.Vector3,this.m_globalFrustumMax=new n.Vector3,this.m_frustumCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]}return e.prototype.setup=function(){var e,t,r=this.getFrustumCorners(),n=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);try{for(var o=i(r),a=o.next();!a.done;a=o.next()){var s=a.value;s.applyMatrix4(n),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,s.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,s.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,s.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,s.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,s.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,s.z)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.frustumIntersectsTileBox=function(e){var t=this.m_globalFrustumMin,r=this.m_globalFrustumMax;return!(r.x<e.min.x||r.y<e.min.y||r.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)},e.prototype.getFrustumCorners=function(){var e=this.m_frustumCorners,t=new n.Camera;t.projectionMatrix.copy(this.m_camera.projectionMatrix);var r=0;function i(i,n,o){e[r++].set(i,n,o).unproject(t)}return i(-1,-1,-1),i(1,-1,-1),i(-1,1,-1),i(1,1,-1),i(-1,-1,1),i(1,-1,1),i(-1,1,1),i(1,1,1),e},e}();t.MapTileCuller=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(67),n=r(71),o=function(){function e(){}return e.getTiler=function(e,t){var r=this.getWorkerSet(t);return new n.WorkerBasedTiler(r,e)},e.getWorkerSet=function(e){void 0===e&&(e=this.defaultScriptUrl);var t=this.workerSets[e];return void 0===t&&(t=new i.ConcurrentWorkerSet({scriptUrl:e,workerCount:this.defaultWorkerCount}),this.workerSets[e]=t),t},e.destroyWorkerSet=function(e){var t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])},e.destroy=function(){var e=this;Object.keys(this.workerSets).forEach(function(t){e.workerSets[t].destroy()}),this.workerSets={}},e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=1,e.workerSets={},e}();t.ConcurrentTilerFacade=o},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=r(4),s=r(11),l=r(1),u=r(0),c=r(8),d=r(52),h=r(72),f=r(35),p=r(18),m=r(20),v=r(13),y=r(14);!function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed",e[e.Disposed=7]="Disposed"}(t.TileLoaderState||(t.TileLoaderState={}));var g=function(){function e(e,t){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=new Array,this.boundingBox=new u.Box3,this.center=new u.Vector3,this.frameNumRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.isVisible=!1,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_preparedTextPaths=new Array,this.m_userTextElements=[],this.m_textElementGroups=new l.GroupedPriorityList,this.m_placedTextElements=new l.GroupedPriorityList,this.m_numVertices=0,this.m_memoryUsage=void 0,this.m_textElementsChanged=!1,this.m_colorMap=new Map,this.m_visibleArea=0,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.projection.projectBox(this.geoBox,this.boundingBox),this.boundingBox.getCenter(this.center)}return Object.defineProperty(e.prototype,"projection",{get:function(){return this.dataSource.projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapView",{get:function(){return this.dataSource.mapView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placedTextElements",{get:function(){return this.m_placedTextElements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){if(void 0!==this.m_memoryUsage)return this.m_memoryUsage;var e=0;return void 0!==this.decodedTile&&(e+=y.MapViewUtils.estimateObjectSize(this.decodedTile)),e+=y.MapViewUtils.estimateObjectSize(this.textElementGroups),e+=y.MapViewUtils.estimateObjectSize(this.objects),e+=y.MapViewUtils.estimateObjectSize(this.preparedTextPaths),this.roadIntersectionData&&(e+=y.MapViewUtils.estimateObjectSize(this.roadIntersectionData)),this.m_memoryUsage=e,2*e},enumerable:!0,configurable:!0}),e.prototype.getUsageStatistics=function(){return{estimatedMemoryUsage:this.memoryUsage,numVertices:this.m_numVertices,numColors:c.ColorCache.instance.size,numObjects:this.objects.length,numGeometries:void 0!==this.m_decodedTile?this.m_decodedTile.geometries.length:0,numMaterials:this.getMaterialsCount()}},Object.defineProperty(e.prototype,"userTextElements",{get:function(){return this.m_userTextElements},enumerable:!0,configurable:!0}),e.prototype.addUserTextElement=function(e){this.m_userTextElements.push(e),this.textElementsChanged=!0},e.prototype.removeUserTextElement=function(e){var t=this.m_userTextElements.indexOf(e);return t>=0&&(this.m_userTextElements.splice(t,1),this.textElementsChanged=!0,!0)},e.prototype.addTextElement=function(e){this.textElementGroups.add(e),this.textElementsChanged=!0},e.prototype.removeTextElement=function(e){return!!this.textElementGroups.remove(e)&&(this.textElementsChanged=!0,!0)},Object.defineProperty(e.prototype,"textElementGroups",{get:function(){return this.m_textElementGroups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textElementsChanged",{get:function(){return this.m_textElementsChanged},set:function(e){this.m_textElementsChanged=e},enumerable:!0,configurable:!0}),e.prototype.prepareForRender=function(){var e=this;if(this.m_decodedTile&&!this.m_disposed&&this.isVisible){var t=this.m_decodedTile;void 0!==t.tileInfo&&(this.roadIntersectionData=this.dataSource.mapView.pickHandler.registerTile(this)),this.m_decodedTile=void 0,setTimeout(function(){var r=f.PerformanceStatistics.instance;if(!e.isVisible)return e.mapView.visibleTileSet.disposeTile(e),void(r.enabled&&r.currentFrame.addMessage("Decoded tile: "+e.dataSource.name+" # lvl="+e.tileKey.level+" col="+e.tileKey.column+" row="+e.tileKey.row+" DISCARDED - invisible"));var i=0;if(r.enabled&&(i=l.PerformanceTimer.now()),e.createGeometries(t),r.enabled){var n=l.PerformanceTimer.now()-i,o=r.currentFrame;o.addValue("geometry.geometryCreationTime",n),o.addValue("geometryCount.numGeometries",t.geometries.length),o.addValue("geometryCount.numTechniques",t.techniques.length),o.addValue("geometryCount.numPoiGeometries",void 0!==t.poiGeometries?t.poiGeometries.length:0),o.addValue("geometryCount.numTextGeometries",void 0!==t.textGeometries?t.textGeometries.length:0),o.addValue("geometryCount.numTextPathGeometries",void 0!==t.textPathGeometries?t.textPathGeometries.length:0),o.addMessage("Decoded tile: "+e.dataSource.name+" # lvl="+e.tileKey.level+" col="+e.tileKey.column+" row="+e.tileKey.row)}e.dataSource.requestUpdate()},0)}},e.prototype.willRender=function(e){return!0},e.prototype.didRender=function(){},Object.defineProperty(e.prototype,"visibleArea",{get:function(){return this.m_visibleArea},set:function(e){this.m_visibleArea=e,void 0!==this.tileLoader&&this.tileLoader.updatePriority(e)},enumerable:!0,configurable:!0}),e.prototype.createGeometries=function(e){this.clear(),this.preparePois(e),this.createTextElements(e),this.createObjects(e,this.objects),this.countVertices()},Object.defineProperty(e.prototype,"decodedTile",{get:function(){return this.m_decodedTile},enumerable:!0,configurable:!0}),e.prototype.setDecodedTile=function(e){this.m_decodedTile=e,this.invalidateUsageInfoCache();var t=f.PerformanceStatistics.instance;t.enabled&&void 0!==e.decodeTime&&t.currentFrame.addValue("decode.decodingTime",e.decodeTime)},e.prototype.shouldDisposeObjectGeometry=function(e){return!0},e.prototype.shouldDisposeObjectMaterial=function(e){return!0},Object.defineProperty(e.prototype,"disposed",{get:function(){return this.m_disposed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeometry",{get:function(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry},enumerable:!0,configurable:!0}),e.prototype.forceHasGeometry=function(e){this.m_forceHasGeometry=e},Object.defineProperty(e.prototype,"tileLoader",{get:function(){return this.m_tileLoader},set:function(e){this.m_tileLoader=e},enumerable:!0,configurable:!0}),e.prototype.reload=function(){this.dataSource.updateTile(this)},e.prototype.clear=function(){var e=this,t=function(t){void 0!==t.geometry&&e.shouldDisposeObjectGeometry(t)&&t.geometry.dispose(),void 0!==t.material&&e.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(function(e){void 0!==e&&e.dispose()}):t.material.dispose())};this.objects.forEach(function(e){e.traverse(function(e){t(e)}),t(e)}),this.objects.length=0,this.m_preparedTextPaths&&(this.m_preparedTextPaths=[]),this.placedTextElements.clear(),this.textElementGroups.clear(),this.userTextElements.length=0,this.invalidateUsageInfoCache()},e.prototype.dispose=function(){this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.dispose(),this.m_tileLoader=void 0),this.clear(),this.userTextElements.length=0,this.m_disposed=!0,this.isVisible=!1)},Object.defineProperty(e.prototype,"preparedTextPaths",{get:function(){return this.m_preparedTextPaths},enumerable:!0,configurable:!0}),e.prototype.prepareTextPaths=function(e){for(var t=new Array,r=Math.PI/8,i=e.slice(),n=new u.Vector2,o=new u.Vector2,a=new u.Vector2;i.length>0;){var s=i.pop();if(void 0===s)break;for(var l=-1,c=0;c<s.path.length-2;c+=2){n.set(s.path[c],s.path[c+1]),o.set(s.path[c+2],s.path[c+3]);var d=o.sub(n).normalize();if(c>0){var h=Math.atan2(a.x*d.y-d.x*a.y,d.dot(a));if(Math.abs(h)>r){l=c;break}}a.set(d.x,d.y)}if(l>0){var f={path:s.path.slice(0,l+2),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};t.push(f);var p={path:s.path.slice(l),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};i.push(p)}else t.push(s)}return t},e.prototype.createTextElements=function(e){var t,r,i,a,c,d;void 0!==e.textPathGeometries&&e.textPathGeometries.length,void 0!==e.textGeometries&&e.textGeometries.length;var h=Math.floor(this.mapView.zoomLevel);if(void 0!==e.textPathGeometries){this.m_preparedTextPaths=this.prepareTextPaths(e.textPathGeometries);var f=0;try{for(var v=n(this.preparedTextPaths),y=v.next();!y.done;y=v.next()){var g=y.value;"text"===(P=e.techniques[g.technique]).name&&(g.pathLengthSqr>f&&(f=g.pathLengthSqr))}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}try{for(var _=n(this.preparedTextPaths),b=_.next();!b.done;b=_.next()){g=b.value;if("text"===(P=e.techniques[g.technique]).name){for(var x=[],w=0;w<g.path.length;w+=2)x.push(new u.Vector2(g.path[w],g.path[w+1]));var S=l.getOptionValue(o.getPropertyValue(P.priority,h),0)+(f>0?.1*g.pathLengthSqr/f:0);(A=new p.TextElement(s.ContextualArabicConverter.instance.convert(g.text),x,this.getRenderStyle(P),this.getLayoutStyle(P),S,void 0!==P.xOffset?P.xOffset:0,void 0!==P.yOffset?P.yOffset:0,g.featureId,P.style,o.getPropertyValue(P.fadeNear,h),o.getPropertyValue(P.fadeFar,h))).minZoomLevel=void 0!==P.minZoomLevel?P.minZoomLevel:this.mapView.minZoomLevel,A.maxZoomLevel=void 0!==P.maxZoomLevel?P.maxZoomLevel:this.mapView.maxZoomLevel,A.distanceScale=void 0!==P.distanceScale?P.distanceScale:m.DEFAULT_TEXT_DISTANCE_SCALE,A.mayOverlap=!0===P.mayOverlap,A.reserveSpace=!1!==P.reserveSpace,this.addTextElement(A),0}}}catch(e){i={error:e}}finally{try{b&&!b.done&&(a=_.return)&&a.call(_)}finally{if(i)throw i.error}}}if(void 0!==e.textGeometries)try{for(var T=n(e.textGeometries),C=T.next();!C.done;C=T.next()){var P,E=C.value;if(void 0!==E.technique&&void 0!==E.stringCatalog)if("text"===(P=e.techniques[E.technique]).name){var M=new u.BufferAttribute(new Float32Array(E.positions.buffer),E.positions.itemCount),O=M.count;if(!(O<1))for(S=l.getOptionValue(o.getPropertyValue(P.priority,h),0),w=0;w<O;++w){var A,L=M.getX(w),R=M.getY(w),I=E.stringCatalog[E.texts[w]];if(void 0!==I)(A=new p.TextElement(s.ContextualArabicConverter.instance.convert(I),new u.Vector2(L,R),this.getRenderStyle(P),this.getLayoutStyle(P),S,P.xOffset||0,P.yOffset||0,E.featureId,P.style)).minZoomLevel=void 0!==P.minZoomLevel?P.minZoomLevel:this.mapView.minZoomLevel,A.maxZoomLevel=void 0!==P.maxZoomLevel?P.maxZoomLevel:this.mapView.maxZoomLevel,A.mayOverlap=!0===P.mayOverlap,A.reserveSpace=!1!==P.reserveSpace,A.fadeNear=o.getPropertyValue(P.fadeNear,h),A.fadeFar=o.getPropertyValue(P.fadeFar,h),this.addTextElement(A),0}}}}catch(e){c={error:e}}finally{try{C&&!C.done&&(d=T.return)&&d.call(T)}finally{if(c)throw c.error}}},e.prototype.registerTileObject=function(e){var t=e.userData||{};t.tileKey=this.tileKey,t.dataSource=this.dataSource.name},e.prototype.createPlane=function(e,t,r,i,n){var o=new u.PlaneGeometry(e,t,1),s=new a.MapMeshBasicMaterial({color:i,visible:n,depthTest:!1}),l=new u.Mesh(o,s);return l.position.copy(r),l.renderOrder=Number.MIN_SAFE_INTEGER,l},e.prototype.createObjects=function(e,t){var r,i,s=this,c=[],f=this.mapView.zoomLevel;if(this.dataSource.addTileBackground){var p=new u.Vector3;this.boundingBox.getSize(p);var m=this.createPlane(p.x,p.y,this.center,void 0===this.dataSource.tileBackgroundColor?this.mapView.clearColor:this.dataSource.tileBackgroundColor,this.dataSource.tileBackgroundIsVisible);this.registerTileObject(m),t.push(m)}try{for(var v=n(e.geometries),y=v.next();!y.done;y=v.next())for(var g,_=y.value,b=_.groups,x=b.length,w=function(r){for(var i,p,m=b[r++],v=m.start,y=m.technique,w=e.techniques[y],T=m.count;r<x&&b[r].technique===y&&v+T===b[r].start;++r)T+=b[r].count;var C=d.getObjectConstructor(w);if(void 0===C)return g=r,"continue";var P=c[y];if(void 0===P){if(void 0===(P=d.createMaterial({technique:w,level:Math.floor(f),fog:null!==S.mapView.scene.fog},function(){s.dataSource.requestUpdate()})))return g=r,"continue";c[y]=P}var E=new u.BufferGeometry;if(_.vertexAttributes.forEach(function(e){var t=d.getBufferAttribute(e);E.addAttribute(e.name,t)}),void 0!==_.interleavedVertexAttributes&&_.interleavedVertexAttributes.forEach(function(e){var t=o.getArrayConstructor(e.type),r=new u.InterleavedBuffer(new t(e.buffer),e.stride);e.attributes.forEach(function(e){var t=new u.InterleavedBufferAttribute(r,e.itemSize,e.offset,!1);E.addAttribute(e.name,t)})}),_.index&&E.setIndex(d.getBufferAttribute(_.index)),E.getAttribute("normal")||!o.isStandardTechnique(w)&&!o.isStandardTexturedTechnique(w)||E.computeVertexNormals(),E.addGroup(v,T),o.isSolidLineTechnique(w)||o.isDashedLineTechnique(w)){var M=P;if(M.uniforms.opacity.value=P.opacity,!1!==w.clipping){var O=M.uniforms.tileSize,A=new u.Vector3;S.boundingBox.getSize(A),O.value.x=A.x,O.value.y=A.y,M.defines.TILE_CLIP=1}}var L=o.isExtrudedPolygonTechnique(w)&&void 0!==_.edgeIndex,R=o.isFillTechnique(w)&&void 0!==_.edgeIndex;(L||R)&&(P.polygonOffset=!0,P.polygonOffsetFactor=.75,P.polygonOffsetUnits=4);var I=new C(E,P);if(I.frustumCulled=!1,void 0!==w.renderOrder)I.renderOrder=w.renderOrder;else{if(void 0===w._renderOrderAuto)throw new Error("Technique has no renderOrderAuto");I.renderOrder=w._renderOrderAuto}if(void 0!==m.renderOrderOffset&&(I.renderOrder+=m.renderOrderOffset),void 0!==_.uuid&&(I.userData.geometryId=_.uuid),(o.isCirclesTechnique(w)||o.isSquaresTechnique(w))&&void 0!==w.enablePicking&&(I.enableRayTesting=w.enablePicking),o.isSolidLineTechnique(w)||o.isDashedLineTechnique(w)){var F=S.getFadingParams(w);a.FadingFeature.addRenderHelper(I,F.fadeNear,F.fadeFar,!0,!1,function(e,t){var r=t,i="Pixel"===o.getPropertyValue(w.metricUnit,s.tileKey.level)?.5*s.mapView.pixelToWorld:1;if(r.lineWidth=l.getOptionValue(o.getPropertyValue(w.lineWidth,s.mapView.zoomLevel),a.SolidLineMaterial.DEFAULT_WIDTH)*i,o.isDashedLineTechnique(w)){var n=r;n.dashSize=l.getOptionValue(o.getPropertyValue(w.dashSize,s.mapView.zoomLevel),a.DashedLineMaterial.DEFAULT_DASH_SIZE)*i,n.gapSize=l.getOptionValue(o.getPropertyValue(w.gapSize,s.mapView.zoomLevel),a.DashedLineMaterial.DEFAULT_GAP_SIZE)*i}})}if(o.isExtrudedLineTechnique(w)&&void 0!==w.fadeFar){F=S.getFadingParams(w);a.FadingFeature.addRenderHelper(I,F.fadeNear,F.fadeFar,!0,!0)}if(S.addFeatureData(_,w,I),(o.isExtrudedPolygonTechnique(w)||o.isFillTechnique(w))&&void 0!==w.fadeFar){F=S.getFadingParams(w);a.FadingFeature.addRenderHelper(I,F.fadeNear,F.fadeFar,!0,!0)}if("extruded-polygon"===w.name&&h.isRenderDepthPrePassEnabled(w)){var D=h.createDepthPrePassMesh(I);t.push(D),h.setDepthPrePassStencil(D,I)}if(S.registerTileObject(I),t.push(I),L){var k=new u.BufferGeometry;k.addAttribute("position",E.getAttribute("position")),k.addAttribute("color",E.getAttribute("color")),k.setIndex(d.getBufferAttribute(_.edgeIndex));var V=w,j={color:(F=S.getPolygonFadingParams(V)).color,colorMix:F.colorMix,fadeNear:F.lineFadeNear,fadeFar:F.lineFadeFar},U=new a.EdgeMaterial(j),z=new u.LineSegments(k,U);z.renderOrder=I.renderOrder+.1,a.FadingFeature.addRenderHelper(z,F.lineFadeNear,F.lineFadeFar,!1,!1),S.registerTileObject(z),t.push(z)}if(R){var B=_.edgeIndex;try{for(var N=n(B),G=N.next();!G.done;G=N.next()){var W=G.value,q=new u.BufferGeometry;q.addAttribute("position",E.getAttribute("position")),q.setIndex(d.getBufferAttribute(W));var H=w,X=(j={color:(F=S.getPolygonFadingParams(H)).color,colorMix:F.colorMix,fadeNear:F.lineFadeNear,fadeFar:F.lineFadeFar},new a.EdgeMaterial(j)),Y=new u.LineSegments(q,X);Y.renderOrder=I.renderOrder+.1,a.FadingFeature.addRenderHelper(Y,F.lineFadeNear,F.lineFadeFar,!0,!1),S.registerTileObject(Y),t.push(Y)}}catch(e){i={error:e}}finally{try{G&&!G.done&&(p=N.return)&&p.call(N)}finally{if(i)throw i.error}}}g=r},S=this,T=0;T<x;)w(T),T=g}catch(e){r={error:e}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}},e.prototype.invalidateUsageInfoCache=function(){this.m_numVertices=0,this.m_memoryUsage=void 0},e.prototype.countVertices=function(){var e=this;this.objects.filter(function(e){return e instanceof u.Mesh}).forEach(function(t){var r=t;r.geometry instanceof u.BufferGeometry&&(void 0!==r.geometry.index&&null!==r.geometry.index?e.m_numVertices+=r.geometry.index.count:e.m_numVertices+=r.geometry.getAttribute("position").count/3),r.geometry instanceof u.Geometry&&(e.m_numVertices=r.geometry.vertices.length)})},e.prototype.preparePois=function(e){void 0!==e.poiGeometries&&this.mapView.poiManager.addPois(this,e)},e.prototype.getRenderStyle=function(e){var t=v.computeStyleCacheId(this.dataSource.name,e,this.mapView.zoomLevel),r=this.mapView.textRenderStyleCache.get(t);if(void 0===r){var n=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.defaultStyle.renderParams:{fontSize:{unit:s.FontUnit.Pixel,size:32,backgroundSize:8}},a=l.getOptionValue(o.getPropertyValue(e.size,Math.floor(this.mapView.zoomLevel)),n.fontSize.size),u=l.getOptionValue(o.getPropertyValue(e.backgroundSize,Math.floor(this.mapView.zoomLevel)),n.fontSize.backgroundSize),d=o.getPropertyValue(e.color,Math.floor(this.mapView.zoomLevel));void 0!==d&&this.m_colorMap.set(t,c.ColorCache.instance.getColor(d));var h=l.getOptionValue(this.m_colorMap.get(t),n.color),f=o.getPropertyValue(e.backgroundColor,Math.floor(this.mapView.zoomLevel));void 0!==f&&this.m_colorMap.set(t+"_bg",c.ColorCache.instance.getColor(f));var p=l.getOptionValue(this.m_colorMap.get(t+"_bg"),n.backgroundColor),m=l.getOptionValue(o.getPropertyValue(e.backgroundAlpha,Math.floor(this.mapView.zoomLevel)),n.backgroundOpacity),y=!0===e.smallCaps||n.fontVariant===s.FontVariant.SmallCaps,g=!0===e.allCaps||n.fontVariant===s.FontVariant.AllCaps,_=y?s.FontVariant.SmallCaps:g?s.FontVariant.AllCaps:void 0,b=!0===e.bold?e.oblique?s.FontStyle.BoldItalic:s.FontStyle.Bold:!0===e.oblique?s.FontStyle.Italic:n.fontStyle,x={fontSize:{unit:s.FontUnit.Pixel,size:a,backgroundSize:u},color:h,backgroundColor:p,backgroundOpacity:m,fontVariant:_,fontStyle:b},w=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.getTextElementStyle(e.style).renderParams:{};r=new s.TextRenderStyle(i({},w,x)),this.mapView.textRenderStyleCache.set(t,r)}return r},e.prototype.getLayoutStyle=function(e){var t=v.computeStyleCacheId(this.dataSource.name,e,this.mapView.zoomLevel),r=this.mapView.textLayoutStyleCache.get(t);if(void 0===r){var n=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.defaultStyle.layoutParams:{},o=l.getOptionValue(e.tracking,n.tracking),a=n.horizontalAlignment;"Left"!==e.hAlignment&&"Center"!==e.hAlignment&&"Right"!==e.hAlignment||(a=s.HorizontalAlignment[e.hAlignment]);var u=n.verticalAlignment;"Above"!==e.vAlignment&&"Center"!==e.vAlignment&&"Below"!==e.vAlignment||(u=s.VerticalAlignment[e.vAlignment]);var c={tracking:o,horizontalAlignment:a,verticalAlignment:u},d=void 0!==this.mapView.textElementsRenderer?this.mapView.textElementsRenderer.getTextElementStyle(e.style).layoutParams:{};r=new s.TextLayoutStyle(i({},d,c)),this.mapView.textLayoutStyleCache.set(t,r)}return r},e.prototype.getMaterialsCount=function(){var e=0;return this.objects.forEach(function(t){t.material&&(Array.isArray(t.material)?e+=t.material.length:e+=1)}),e},e.prototype.addFeatureData=function(e,t,r){if((void 0!==e.featureIds&&e.featureIds.length>0||"circles"===t.name||"squares"===t.name)&&"solid-line"!==t.name&&"dashed-line"!==t.name){var i={geometryType:e.type,ids:e.featureIds,starts:e.featureStarts};r.userData.feature=i,void 0!==e.objInfos&&(r.userData.feature.objInfos=e.objInfos)}},e.prototype.getFadingParams=function(e){var t=this.mapView.zoomLevel;return{fadeNear:void 0!==e.fadeNear?o.getPropertyValue(e.fadeNear,t):a.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==e.fadeFar?o.getPropertyValue(e.fadeFar,t):a.FadingFeature.DEFAULT_FADE_FAR}},e.prototype.getPolygonFadingParams=function(e){var t=a.EdgeMaterial.DEFAULT_COLOR,r=a.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==e.lineColor&&(t=e.lineColor,o.isExtrudedPolygonTechnique(e))){var i=e;r=void 0!==i.lineColorMix?i.lineColorMix:a.EdgeMaterial.DEFAULT_COLOR_MIX}var n=this.mapView.zoomLevel,s=void 0!==e.fadeNear?o.getPropertyValue(e.fadeNear,n):a.FadingFeature.DEFAULT_FADE_NEAR,l=void 0!==e.fadeFar?o.getPropertyValue(e.fadeFar,n):a.FadingFeature.DEFAULT_FADE_FAR;return{color:t,colorMix:r,fadeNear:s,fadeFar:l,lineFadeNear:void 0!==e.lineFadeNear?o.getPropertyValue(e.lineFadeNear,n):s,lineFadeFar:void 0!==e.lineFadeFar?o.getPropertyValue(e.lineFadeFar,n):l}},e}();t.Tile=g},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(1),a=r(73),s=o.LoggerManager.instance.create("TileDataAccessor"),l=function(){function e(e,t,r){this.tile=e,this.visitor=t,this.m_wantsPoints=!0,this.m_wantsLines=!0,this.m_wantsAreas=!0,this.m_wantsObject3D=!0;var i=!0===r.wantsAll;this.m_wantsPoints=i||!(!1===r.wantsPoints),this.m_wantsLines=i||!(!1===r.wantsLines),this.m_wantsAreas=i||!(!1===r.wantsAreas),this.m_wantsObject3D=i||!(!1===r.wantsObject3D)}return e.prototype.visitAll=function(){var e,t,r=this.tile.objects;try{for(var n=i(r),o=n.next();!o.done;o=n.next()){var a=o.value;this.visitObject(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.visitObject=function(e){var t=void 0!==e.userData?e.userData.feature:void 0;if(void 0!==t&&(void 0===t.ids||1!==t.ids.length||this.visitor.wantsFeature(t.ids[0]))){var r=t.geometryType;if(void 0!==r){switch(o.assert(void 0!==t.ids,"featureData.ids missing"),o.assert(Array.isArray(t.ids),"featureData.ids is not an array"),o.assert(void 0!==t.starts,"featureData.starts missing"),o.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.ids&&void 0!==t.starts&&o.assert(t.ids.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),r){case n.GeometryType.Point:case n.GeometryType.Text:if(!this.m_wantsPoints)return;break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case n.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:s.warn("#visitObject: invalid geometryType")}if("Mesh"===e.type){var i=e;this.visitMesh(i,t)}else s.warn("#visitObject: visiting object failed, not of type 'Mesh'",e)}else s.warn("#visitObject: visiting object failed, no geometryType",e)}},e.prototype.getBufferGeometry=function(e){var t=e.geometry;if("BufferGeometry"===t.type){var r=t;if(r.getAttribute("position"))return r;s.warn("#visitLines: BufferGeometry has no position attribute")}else s.warn("#visitObject: object does not have BufferGeometry")},e.prototype.getGeometryAccessor=function(e,t,r){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new a.BufferedGeometryLineAccessor(t,e,r);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:return;case n.GeometryType.Object3D:return new a.BufferedGeometryObject3dAccessor(t,e,r);default:s.warn("#getGeometryAccessor: invalid geometryType")}},e.prototype.getIndexedGeometryAccessor=function(e,t,r){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new a.IndexedBufferedGeometryLineAccessor(t,e,r);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:case n.GeometryType.Object3D:return;default:s.warn("#getIndexedGeometryAccessor: invalid geometryType")}},e.prototype.visitMesh=function(e,t){var r=t.ids,i=t.starts,l=t.geometryType;if(void 0!==r&&void 0!==i&&void 0!==l)for(var u,c=0;c<r.length;c++){var d=r[c];if(this.visitor.wantsFeature(d)){var h,f=i[c];if(void 0===u){var p=this.getBufferGeometry(e);if(void 0===p)continue;if(void 0===(u=null!==p.index?this.getIndexedGeometryAccessor(l,e,p):this.getGeometryAccessor(l,e,p))){s.warn("#visitObject: no accessor geometryType",l);continue}}switch(h=c<i.length-1?i[c+1]:u.getCount(),u.setRange(f,h),l){case n.GeometryType.Point:case n.GeometryType.Text:this.visitor.visitPoint(d);break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:o.assert(a.isLineAccessor(u)),this.visitor.visitLine(d,u);break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:this.visitor.visitArea(d);break;case n.GeometryType.Object3D:o.assert(a.isObject3dAccessor(u)),this.visitor.visitObject3D(d,u);break;default:s.warn("#visitObject: invalid geometryType")}}}},e}();t.TileDataAccessor=l},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(146)),i(r(74)),i(r(75)),i(r(36))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){return function(){this.vertices=[],this.indices=[]}}();function o(e,t,r){if(void 0===t&&(t=new n),void 0===r&&(r=!1),0===e.length)return t;var i=e.length/2,o=t.vertices,a=t.indices,s=[],l=[],u=[],c=t.vertices.length/12,d=0;l.push(0);for(var h=0;h<i-1;++h){var f=e[2*(h+1)]-e[2*h],p=e[2*(h+1)+1]-e[2*h+1],m=Math.sqrt(f*f+p*p);s[h]=m,d+=m,l.push(d),u.push([f,p])}var v=e[0]===e[e.length-2]&&e[1]===e[e.length-1];for(h=0;h<i;++h){var y=e[2*h],g=e[2*h+1],_=v&&0===h?u[u.length-1]:u[Math.max(0,h-1)],b=v&&h===i-1?u[0]:u[Math.min(h,u.length-1)];if(h>0){var x=l[h-1],w=l[h];if(r){var S=y-(C=Math.fround(y)),T=g-(P=Math.fround(g));o.push(C,P,S,T,x,w,_[0],_[1],b[0],b[1],0,0,1,-1),o.push(C,P,S,T,x,w,_[0],_[1],b[0],b[1],0,0,1,1)}else o.push(y,g,x,w,_[0],_[1],b[0],b[1],0,0,1,-1),o.push(y,g,x,w,_[0],_[1],b[0],b[1],0,0,1,1)}if(h+1<i){x=l[Math.min(h,l.length-1)],w=l[Math.min(h+1,l.length-1)];if(r){var C,P;S=y-(C=Math.fround(y)),T=g-(P=Math.fround(g));o.push(C,P,S,T,x,w,_[0],_[1],b[0],b[1],0,0,-1,-1),o.push(C,P,S,T,x,w,_[0],_[1],b[0],b[1],0,0,-1,1)}else o.push(y,g,x,w,_[0],_[1],b[0],b[1],0,0,-1,-1),o.push(y,g,x,w,_[0],_[1],b[0],b[1],0,0,-1,1)}}for(h=0;h<i-1;++h){var E=c+4*h;a.push(E,E+1,E+2,E+2,E+1,E+3)}return t}function a(e,t){if(void 0===t&&(t=new n),0===e.length)return t;for(var r=e.length/2,i=t.vertices,o=t.indices,a=i.length/3,s=0;s<r;++s,a++){var l=e[2*s],u=e[2*s+1];s>0&&o.push(a),s<r-1&&o.push(a),i.push(l,u,0)}return t}t.LineGeometry=n,t.createLineGeometry=o,t.createSimpleLineGeometry=a,t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"segment",itemSize:2,offset:2},{name:"tangents",itemSize:4,offset:4},{name:"angles",itemSize:2,offset:8},{name:"texcoord",itemSize:2,offset:10}],t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"positionLow",itemSize:2,offset:2},{name:"segment",itemSize:2,offset:4},{name:"tangents",itemSize:4,offset:6},{name:"angles",itemSize:2,offset:10},{name:"texcoord",itemSize:2,offset:12}];var s=function(){function e(e){void 0===e&&(e=!1),this.highPrecision=e,this.g=new n}return e.createGeometry=function(e,r,n,o){void 0===o&&(o=!1);var a=new i.InterleavedBuffer(new Float32Array(e),o?14:12);return(o?t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS:t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS).forEach(function(e){var t=new i.InterleavedBufferAttribute(a,e.itemSize,e.offset,!1);n.addAttribute(e.name,t)}),n.setIndex(new i.BufferAttribute(new Uint32Array(r),1)),n},e.prototype.clear=function(){this.g.vertices=[],this.g.indices=[]},e.prototype.add=function(e,t){return void 0===t&&(t=!1),t?a(e,this.g):o(e,this.g,this.highPrecision),this},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.g.vertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this.g.indices},enumerable:!0,configurable:!0}),e.prototype.createGeometry=function(t){return void 0===t&&(t=new i.BufferGeometry),e.createGeometry(this.g.vertices,this.g.indices,t,this.highPrecision)},e}();t.Lines=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(4),s=r(36),l=function(e){function t(t,r,i,n,s){var l=this;return void 0===r&&(r=new a.HighPrecisionPointMaterial({color:n||a.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:1})),(l=e.call(this,void 0===t?new o.BufferGeometry:t,r)||this).matrixWorldInverse=new o.Matrix4,i&&l.setPositions(i),l}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),t.prototype.clearGeometry=function(){return this.geometry=new o.BufferGeometry},Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=s.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,i,n,o,a){s.HighPrecisionUtils.updateHpUniforms(e,i,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(o.Points);t.HighPrecisionPoints=l},function(e,t,r){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(33),a=r(65),s=function(){function e(e,t){var r=this;if(this.m_defaults=new Map,this.m_mapViews=[],this.update=function(){var e,t,a=r.m_mapViews.map(function(e){return e.copyrightInfo}).reduce(o.CopyrightInfo.mergeArrays,r.staticInfo||[]);if(0!==a.length){if(r.m_element.style.display="block",0!==r.m_defaults.size)try{for(var s=i(a),l=s.next();!l.done;l=s.next()){var u=l.value,c=r.m_defaults.get(u.id);void 0!==c&&(u.year=n.getOptionValue(u.year,c.year),u.label=n.getOptionValue(u.label,c.label),u.link=n.getOptionValue(u.link,c.link))}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}var d=o.CopyrightInfo.mergeArrays(a);r.m_element.innerHTML=o.CopyrightInfo.formatAsHtml(d)}else r.m_element.style.display="none"},"string"==typeof e){if(this.m_element=document.getElementById(e),!this.m_element)throw new Error("CopyrightElementHandler: unable to find DOM element "+e)}else this.m_element=e;void 0!==t&&this.attach(t)}return e.install=function(t,r){return new e(t,r)},e.prototype.destroy=function(){var e,t;try{for(var r=i(this.m_mapViews),n=r.next();!n.done;n=r.next()){n.value.removeEventListener(a.MapViewEventNames.CopyrightChanged,this.update)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.attach=function(e){return this.m_mapViews.push(e),e.addEventListener(a.MapViewEventNames.CopyrightChanged,this.update),this.update(),this},e.prototype.detach=function(e){return e.removeEventListener(a.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter(function(t){return t!==e}),this.update(),this},e.prototype.setDefaults=function(e){var t,r;if(this.m_defaults.clear(),void 0!==e)try{for(var n=i(e),o=n.next();!o.done;o=n.next()){var a=o.value;this.m_defaults.set(a.id,a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this},e.prototype.setStaticCopyightInfo=function(e){return this.staticInfo=e,this},e}();t.CopyrightElementHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.element=e,this.onLongPress=t,this.timeout=500,this.moveThreshold=5,this.buttonId=0,this.m_mouseDownEvent=void 0,this.m_timerId=void 0,this.m_moveHandlerRegistered=!1,this.m_boundMouseMoveHandler=this.onMouseMove.bind(this),this.m_boundMouseDownHandler=this.onMousedown.bind(this),this.m_boundMouseUpHandler=this.onMouseup.bind(this),this.element.addEventListener("mousedown",this.m_boundMouseDownHandler),this.element.addEventListener("mouseup",this.m_boundMouseUpHandler)}return e.prototype.dispose=function(){this.cancel(),this.element.removeEventListener("mousedown",this.m_boundMouseDownHandler),this.element.removeEventListener("mouseup",this.m_boundMouseUpHandler)},e.prototype.onMousedown=function(e){var t=this;e.button===this.buttonId&&(this.cancelTimer(),this.m_mouseDownEvent=e,this.m_timerId=setTimeout(function(){return t.onTimeout()},this.timeout),this.addMouseMoveHandler())},e.prototype.onMouseup=function(e){e.button===this.buttonId&&this.cancel()},e.prototype.onMouseMove=function(e){void 0!==this.m_mouseDownEvent&&(Math.abs(e.clientX-this.m_mouseDownEvent.clientX)+Math.abs(e.clientY-this.m_mouseDownEvent.clientY)>=this.moveThreshold&&this.cancel())},e.prototype.cancel=function(){this.m_mouseDownEvent=void 0,this.cancelTimer(),this.removeMouseMoveHandler()},e.prototype.cancelTimer=function(){void 0!==this.m_timerId&&(clearTimeout(this.m_timerId),this.m_timerId=void 0)},e.prototype.addMouseMoveHandler=function(){this.m_moveHandlerRegistered||(this.element.addEventListener("mousemove",this.m_boundMouseMoveHandler),this.m_moveHandlerRegistered=!0)},e.prototype.removeMouseMoveHandler=function(){this.m_moveHandlerRegistered&&(this.element.removeEventListener("mousemove",this.m_boundMouseMoveHandler),this.m_moveHandlerRegistered=!1)},e.prototype.onTimeout=function(){var e=this.m_mouseDownEvent;this.m_timerId=void 0,this.cancel(),void 0!==e&&this.onLongPress(e)},e}();t.LongPressHandler=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a,s,l=r(3),u=r(76),c=r(1),d=r(151),h=r(0);!function(e){e[e.Linear=0]="Linear",e[e.QuadraticIn=1]="QuadraticIn",e[e.QuadraticOut=2]="QuadraticOut",e[e.QuadraticInOut=3]="QuadraticInOut",e[e.CubicIn=4]="CubicIn",e[e.CubicOut=5]="CubicOut",e[e.CubicInOut=6]="CubicInOut",e[e.QuarticIn=7]="QuarticIn",e[e.QuarticOut=8]="QuarticOut",e[e.QuarticInOut=9]="QuarticInOut",e[e.QuinticIn=10]="QuinticIn",e[e.QuinticOut=11]="QuinticOut",e[e.QuinticInOut=12]="QuinticInOut",e[e.SinusoidalIn=13]="SinusoidalIn",e[e.SinusoidalOut=14]="SinusoidalOut",e[e.SinusoidalInOut=15]="SinusoidalInOut",e[e.ExponentialIn=16]="ExponentialIn",e[e.ExponentialOut=17]="ExponentialOut",e[e.ExponentialInOut=18]="ExponentialInOut",e[e.CircularIn=19]="CircularIn",e[e.CircularOut=20]="CircularOut",e[e.CircularInOut=21]="CircularInOut",e[e.ElasticIn=22]="ElasticIn",e[e.ElasticOut=23]="ElasticOut",e[e.ElasticInOut=24]="ElasticInOut",e[e.BackIn=25]="BackIn",e[e.BackOut=26]="BackOut",e[e.BackInOut=27]="BackInOut",e[e.BounceIn=28]="BounceIn",e[e.BounceOut=29]="BounceOut",e[e.BounceInOut=30]="BounceInOut"}(a=t.EasingFunction||(t.EasingFunction={})),function(e){e[e.Linear=0]="Linear",e[e.Bezier=1]="Bezier",e[e.CatmullRom=2]="CatmullRom"}(s=t.InterpolationFunction||(t.InterpolationFunction={}));var f=function(){function e(e,t){this.mapView=e,this.name=t,this.running=!1,this.stopped=!1,this.duration=1e4,this.repeat=0,this.easing=d.Easing.Linear.None,function(){if(void 0!==m)return;m=new Map,v=new Map,m.set(a.Linear,d.Easing.Linear.None),m.set(a.QuadraticIn,d.Easing.Quadratic.In),m.set(a.QuadraticOut,d.Easing.Quadratic.Out),m.set(a.QuadraticInOut,d.Easing.Quadratic.InOut),m.set(a.CubicIn,d.Easing.Cubic.In),m.set(a.CubicOut,d.Easing.Cubic.Out),m.set(a.CubicInOut,d.Easing.Cubic.InOut),m.set(a.QuarticIn,d.Easing.Quartic.In),m.set(a.QuarticOut,d.Easing.Quartic.Out),m.set(a.QuarticInOut,d.Easing.Quartic.InOut),m.set(a.QuinticIn,d.Easing.Quintic.In),m.set(a.QuinticOut,d.Easing.Quintic.Out),m.set(a.QuinticInOut,d.Easing.Quintic.InOut),m.set(a.SinusoidalIn,d.Easing.Sinusoidal.In),m.set(a.SinusoidalOut,d.Easing.Sinusoidal.Out),m.set(a.SinusoidalInOut,d.Easing.Sinusoidal.InOut),m.set(a.ExponentialIn,d.Easing.Exponential.In),m.set(a.ExponentialOut,d.Easing.Exponential.Out),m.set(a.ExponentialInOut,d.Easing.Exponential.InOut),m.set(a.CircularIn,d.Easing.Circular.In),m.set(a.CircularOut,d.Easing.Circular.Out),m.set(a.CircularOut,d.Easing.Circular.InOut),m.set(a.ElasticIn,d.Easing.Elastic.In),m.set(a.ElasticOut,d.Easing.Elastic.Out),m.set(a.ElasticInOut,d.Easing.Elastic.InOut),m.set(a.BackIn,d.Easing.Back.In),m.set(a.BackOut,d.Easing.Back.Out),m.set(a.BackInOut,d.Easing.Back.InOut),m.set(a.BounceIn,d.Easing.Bounce.In),m.set(a.BounceOut,d.Easing.Bounce.Out),m.set(a.BounceInOut,d.Easing.Bounce.InOut),v.set(s.Linear,d.Interpolation.Linear),v.set(s.Bezier,d.Interpolation.Bezier),v.set(s.CatmullRom,d.Interpolation.CatmullRom)}()}return e.prototype.update=function(e){return!!this.tween&&this.tween.update(e||c.PerformanceTimer.now())},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.running},enumerable:!0,configurable:!0}),e}();t.CameraAnimation=f;var p=function(e){function t(t,r,i,n){var o=e.call(this,t,n)||this;return o.m_mapControls=r,o.startAngle=0,o.endAngle=360,o.m_axis=new h.Vector3(0,0,1),o.beginInteractionListener=function(){o.stopped||o.stopTween()},o.endInteractionListener=function(){o.stopped||o.startTween()},void 0!==i.axis&&(o.m_axis=i.axis),void 0!==i.startAngle&&(o.startAngle=i.startAngle),void 0!==i.endAngle&&(o.endAngle=i.endAngle),void 0!==i.duration&&(o.duration=i.duration),void 0!==i.repeat&&(o.repeat=i.repeat),void 0!==i.easing&&(o.easing="function"==typeof i.easing?i.easing:m.get(i.easing)||d.Easing.Linear.None),o.m_lastRotationValue=o.startAngle,o}return n(t,e),t.prototype.start=function(e,t){if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.running=!0,this.onFinished=t,this.stopped=!1,this.m_mapControls&&(this.m_mapControls.addEventListener(u.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.addEventListener(u.EventNames.EndInteraction,this.endInteractionListener)),this.startTween(e),this.mapView.beginAnimation()},t.prototype.stop=function(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.stopped=!0,this.mapView.endAnimation(),this.tween&&this.tween.stop(),this.m_mapControls&&(this.m_mapControls.removeEventListener(u.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.removeEventListener(u.EventNames.EndInteraction,this.endInteractionListener))},t.prototype.startTween=function(e){var t=this,r=new h.Quaternion;this.m_userCamerRotation=new h.Quaternion,this.mapView.camera.getWorldQuaternion(this.m_userCamerRotation),this.tween=new d.Tween({rotation:0}).to({rotation:this.endAngle-this.m_lastRotationValue},this.duration).onComplete(function(){t.stop(),t.onFinished&&t.onFinished()}).onUpdate(function(e){var i=e.rotation;t.m_lastRotationValue=i,r.setFromEuler(new h.Euler(0,0,l.MathUtils.degToRad(i))),void 0!==t.m_userCamerRotation&&r.multiply(t.m_userCamerRotation),t.mapView.camera.quaternion.copy(r)}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.start(e)},t.prototype.stopTween=function(){this.tween&&this.tween.stop()},t}(f);t.CameraRotationAnimation=p;var m,v,y=function(e){function t(t,r,i){var n=e.call(this,t,i)||this;return n.name=i,n.interpolation=d.Interpolation.CatmullRom,void 0!==r.duration&&(n.duration=r.duration),void 0!==r.repeat&&(n.repeat=r.repeat),void 0!==r.easing&&(n.easing="function"==typeof r.easing?r.easing:m.get(r.easing)||d.Easing.Linear.None),void 0!==r.interpolation&&(n.interpolation="function"==typeof r.interpolation?r.interpolation:v.get(r.interpolation)||d.Interpolation.Linear),n.m_geoCoordinates=void 0!==r.geoCoordinates?r.geoCoordinates:[],n}return n(t,e),t.prototype.addPosition=function(e){this.m_geoCoordinates.push(e)},t.prototype.start=function(e,t){var r,i,n=this;if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:"");this.onFinished=t,this.running=!0;var a=new l.GeoCoordinates(this.mapView.geoCenter.latitude,this.mapView.geoCenter.longitude,this.mapView.camera.position.z),s={latitude:new Array,longitude:new Array,altitude:new Array};try{for(var u=o(this.m_geoCoordinates),c=u.next();!c.done;c=u.next()){var h=c.value;s.latitude.push(h.latitude),s.longitude.push(h.longitude),s.altitude.push(h.altitude||this.mapView.camera.position.z)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}this.tween=new d.Tween(a).to(s,this.duration).onComplete(function(){n.stop(),n.onFinished&&n.onFinished()}).onUpdate(function(e){var t=e.latitude,r=e.longitude,i=e.altitude;n.mapView.geoCenter=new l.GeoCoordinates(t,r,i),n.mapView.camera.position.z=i}),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.interpolation(this.interpolation),this.tween.start(e),this.mapView.beginAnimation()},t.prototype.stop=function(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:"");this.running=!1,this.mapView.endAnimation(),this.tween&&this.tween.stop()},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!0,configurable:!0}),t}(f);t.CameraPanAnimation=y},function(e,t,r){(function(r){var i,n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:a.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var n=this._tweens[r[i]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[r[i]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o,a=new n;a.Group=n,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof window&&void 0!==r&&r.hrtime?a.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?a.now=window.performance.now.bind(window.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?a.now()+parseFloat(e):e:a.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,i=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,i):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},a.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-a.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*a.Easing.Bounce.In(2*e):.5*a.Easing.Bounce.Out(2*e-1)+.5}}},a.Interpolation={Linear:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=a.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[r],e[r-1],r-i):o(e[n],e[n+1>r?r:n+1],i-n)},Bezier:function(e,t){for(var r=0,i=e.length-1,n=Math.pow,o=a.Interpolation.Utils.Bernstein,s=0;s<=i;s++)r+=n(1-t,i-s)*n(t,s)*e[s]*o(i,s);return r},CatmullRom:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=a.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(n=Math.floor(i=r*(1+t))),o(e[(n-1+r)%r],e[n],e[(n+1)%r],e[(n+2)%r],i-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[r]-(o(e[r],e[r],e[r-1],e[r-1],i-r)-e[r]):o(e[n?n-1:0],e[n],e[r<n+1?r:n+1],e[r<n+2?r:n+2],i-n)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=a.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(o=[1],function(e){var t=1;if(o[e])return o[e];for(var r=e;r>1;r--)t*=r;return o[e]=t,t}),CatmullRom:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}}},void 0===(i=function(){return a}.apply(t,[]))||(e.exports=i)}).call(this,r(152))},function(e,t){var r,i,n=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(7),l=r(78),u=function(){function e(e){this.m_modelConstructor=e}return e.prototype.create=function(e,t){return new this.m_modelConstructor(e,t)},e}();t.TileFactory=u;var c=function(e){function t(t,r){var i=e.call(this,r.name,r.styleSetName)||this;if(i.m_tileFactory=t,i.m_options=r,i.m_isReady=!1,r.decoder)i.m_decoder=r.decoder;else{if(!r.concurrentDecoderServiceName)throw new Error("TileDataSource["+i.name+"]: unable to create, missing decoder or concurrentDecoderServiceName");i.m_decoder=s.ConcurrentDecoderFacade.getTileDecoder(r.concurrentDecoderServiceName,r.concurrentDecoderScriptUrl)}return i.cacheable=!0,i}return n(t,e),t.prototype.dispose=function(){this.decoder.dispose()},t.prototype.ready=function(){return this.m_isReady&&this.m_options.dataProvider.ready()},Object.defineProperty(t.prototype,"decoder",{get:function(){return this.m_decoder},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return o(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.m_options.dataProvider.connect(),this.m_decoder.connect()])];case 1:return e.sent(),this.m_isReady=!0,[2]}})})},t.prototype.setStyleSet=function(e,t){this.m_decoder.configure(e,t),this.mapView.markTilesDirty(this)},t.prototype.dataProvider=function(){return this.m_options.dataProvider},t.prototype.getTilingScheme=function(){return this.m_options.tilingScheme},t.prototype.getTile=function(e){var t=this.m_tileFactory.create(this,e);return t.tileLoader=new l.TileLoader(this,e,this.m_options.dataProvider,this.decoder,0),this.updateTile(t),t},t.prototype.getTileInfo=function(e){var t=this;return new Promise(function(r,i){var n=new l.TileInfoLoader(t,e,t.m_options.dataProvider,t.decoder,0);n.loadAndDecode().then(function(e){e===s.TileLoaderState.Ready?r(n.tileInfo):i(new Error("TileDataSource#getInfoTile wrong final state: "+e))})})},t.prototype.updateTile=function(e){var t=this,r=e.tileLoader;void 0!==r&&r.loadAndDecode().then(function(){if(r.decodedTile&&t.decodedTileHasGeometry(r.decodedTile)){var i=r.decodedTile;e.copyrightInfo=void 0!==i.copyrightHolderIds?i.copyrightHolderIds.map(function(e){return{id:e}}):t.m_options.copyrightInfo,e.setDecodedTile(r.decodedTile)}else e.forceHasGeometry(!0);t.requestUpdate()})},t.prototype.decodedTileHasGeometry=function(e){return e.geometries.length||void 0!==e.poiGeometries&&e.poiGeometries.length||void 0!==e.textGeometries&&e.textGeometries.length||void 0!==e.textPathGeometries&&e.textPathGeometries.length},t}(s.DataSource);t.TileDataSource=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),n=function(){function e(){}return e.prototype.dispose=function(){},e.prototype.decodeTile=function(e,t,r,i){return void 0===this.m_styleSetEvaluator?Promise.reject(new Error("No style is defined")):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,r,i)},e.prototype.getTileInfo=function(e,t,r,i){return Promise.resolve(void 0)},e.prototype.configure=function(e,t,r){void 0!==e&&(this.m_styleSetEvaluator=new i.StyleSetEvaluator(e)),void 0!==t&&(this.languages=t)},e}();t.ThemedTileDecoder=n},function(e,t,r){"use strict";function i(e,t){var r=e.__state.conversionName.toString(),i=Math.round(e.r),n=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===r||"SIX_CHAR_HEX"===r){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===r?"rgb("+i+","+n+","+o+")":"CSS_RGBA"===r?"rgba("+i+","+n+","+o+","+a+")":"HEX"===r?"0x"+e.hex.toString(16):"RGB_ARRAY"===r?"["+i+","+n+","+o+"]":"RGBA_ARRAY"===r?"["+i+","+n+","+o+","+a+"]":"RGB_OBJ"===r?"{r:"+i+",g:"+n+",b:"+o+"}":"RGBA_OBJ"===r?"{r:"+i+",g:"+n+",b:"+o+",a:"+a+"}":"HSV_OBJ"===r?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===r?"{h:"+s+",s:"+l+",v:"+u+",a:"+a+"}":"unknown format"}r.r(t);var n=Array.prototype.forEach,o=Array.prototype.slice,a={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(t[r])||(e[r]=t[r])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(e[r])&&(e[r]=t[r])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,t,r){if(e)if(n&&e.forEach&&e.forEach===n)e.forEach(t,r);else if(e.length===e.length+0){var i,o=void 0;for(o=0,i=e.length;o<i;o++)if(o in e&&t.call(r,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(r,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,r){var i=void 0;return function(){var n=this,o=arguments;var a=r||!i;clearTimeout(i),i=setTimeout(function(){i=null,r||e.apply(n,o)},t),a&&e.apply(n,o)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},s=[{litmus:a.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:i},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:i},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:i},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:i}}},{litmus:a.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:a.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:a.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b)&&a.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v)&&a.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],l=void 0,u=void 0,c=function(){u=!1;var e=arguments.length>1?a.toArray(arguments):arguments[0];return a.each(s,function(t){if(t.litmus(e))return a.each(t.conversions,function(t,r){if(l=t.read(e),!1===u&&!1!==l)return u=l,l.conversionName=r,l.conversion=t,a.BREAK}),a.BREAK}),u},d=void 0,h={hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),l=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,r){var i=Math.min(e,t,r),n=Math.max(e,t,r),o=n-i,a=void 0;return 0===n?{h:NaN,s:0,v:0}:(a=e===n?(t-r)/o:t===n?2+(r-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/n,v:n/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(d=8*t)|e&~(255<<d)}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),v=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(i):void 0},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(){function e(){if(p(this,e),this.__state=c.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(e,[{key:"toString",value:function(){return i(this)}},{key:"toHexString",value:function(){return i(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(_.recalculateRGB(this,t,r),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function x(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(_.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,r){if("HEX"===e.__state.space)e.__state[t]=h.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");a.extend(e.__state,h.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=h.rgb_to_hsv(e.r,e.g,e.b);a.extend(e.__state,{s:t.s,v:t.v}),a.isNaN(t.h)?a.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(_.prototype,"r",2),b(_.prototype,"g",1),b(_.prototype,"b",0),x(_.prototype,"h"),x(_.prototype,"s"),x(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var w=function(){function e(t,r){p(this,e),this.initialValue=t[r],this.domElement=document.createElement("div"),this.object=t,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return m(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),S={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){a.each(e,function(e){S[e]=t})});var T=/(\d+(\.\d+)?)px/;function C(e){if("0"===e||a.isUndefined(e))return 0;var t=e.match(T);return a.isNull(t)?0:parseFloat(t[1])}var P={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){var i=r,n=t;a.isUndefined(n)&&(n=!0),a.isUndefined(i)&&(i=!0),e.style.position="absolute",n&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,i){var n=r||{},o=S[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var l=n.x||n.clientX||0,u=n.y||n.clientY||0;s.initMouseEvent(t,n.bubbles||!1,n.cancelable||!0,window,n.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;a.defaults(n,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,n.bubbles||!1,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:s.initEvent(t,n.bubbles||!1,n.cancelable||!0)}a.defaults(s,i),e.dispatchEvent(s)},bind:function(e,t,r,i){var n=i||!1;return e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,r),P},unbind:function(e,t,r,i){var n=i||!1;return e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent&&e.detachEvent("on"+t,r),P},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);-1===r.indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return P},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),i=r.indexOf(t);-1!==i&&(r.splice(i,1),e.className=r.join(" "))}else e.className=void 0;return P},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return C(t["border-left-width"])+C(t["border-right-width"])+C(t["padding-left"])+C(t["padding-right"])+C(t.width)},getHeight:function(e){var t=getComputedStyle(e);return C(t["border-top-width"])+C(t["border-bottom-width"])+C(t["padding-top"])+C(t["padding-bottom"])+C(t.height)},getOffset:function(e){var t=e,r={left:0,top:0};if(t.offsetParent)do{r.left+=t.offsetLeft,r.top+=t.offsetTop,t=t.offsetParent}while(t);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},E=function(e){function t(e,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),n=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),P.bind(i.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return y(t,w),m(t,[{key:"setValue",value:function(e){var r=v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),M=function(e){function t(e,r,i){p(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),o=i,s=n;if(n.__select=document.createElement("select"),a.isArray(o)){var l={};a.each(o,function(e){l[e]=e}),o=l}return a.each(o,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),s.__select.appendChild(r)}),n.updateDisplay(),P.bind(n.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),n.domElement.appendChild(n.__select),n}return y(t,w),m(t,[{key:"setValue",value:function(e){var r=v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return P.isActive(this.__select)?this:(this.__select.value=this.getValue(),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),O=function(e){function t(e,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),n=i;function o(){n.setValue(n.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),P.bind(i.__input,"keyup",o),P.bind(i.__input,"change",o),P.bind(i.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),P.bind(i.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return y(t,w),m(t,[{key:"updateDisplay",value:function(){return P.isActive(this.__input)||(this.__input.value=this.getValue()),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function A(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var L=function(e){function t(e,r,i){p(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),o=i||{};return n.__min=o.min,n.__max=o.max,n.__step=o.step,a.isUndefined(n.__step)?0===n.initialValue?n.__impliedStep=1:n.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(n.initialValue))/Math.LN10))/10:n.__impliedStep=n.__step,n.__precision=A(n.__impliedStep),n}return y(t,w),m(t,[{key:"setValue",value:function(e){var r=e;return void 0!==this.__min&&r<this.__min?r=this.__min:void 0!==this.__max&&r>this.__max&&(r=this.__max),void 0!==this.__step&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=A(e),this}}]),t}();var R=function(e){function t(e,r,i){p(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));n.__truncationSuspended=!1;var o=n,s=void 0;function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function u(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function c(){P.unbind(window,"mousemove",u),P.unbind(window,"mouseup",c),l()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),P.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);a.isNaN(e)||o.setValue(e)}),P.bind(n.__input,"blur",function(){l()}),P.bind(n.__input,"mousedown",function(e){P.bind(window,"mousemove",u),P.bind(window,"mouseup",c),s=e.clientY}),P.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return y(t,L),m(t,[{key:"updateDisplay",value:function(){var e,r,i;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),r=this.__precision,i=Math.pow(10,r),Math.round(e*i)/i),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function I(e,t,r,i,n){return i+(e-t)/(r-t)*(n-i)}var F=function(e){function t(e,r,i,n,o){p(this,t);var a=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,{min:i,max:n,step:o})),s=a;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(I(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){P.unbind(window,"mousemove",l),P.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,r=s.__background.getBoundingClientRect();s.setValue(I(t,r.left,r.right,s.__min,s.__max))}function d(){P.unbind(window,"touchmove",c),P.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),P.bind(a.__background,"mousedown",function(e){document.activeElement.blur(),P.bind(window,"mousemove",l),P.bind(window,"mouseup",u),l(e)}),P.bind(a.__background,"touchstart",function(e){if(1!==e.touches.length)return;P.bind(window,"touchmove",c),P.bind(window,"touchend",d),c(e)}),P.addClass(a.__background,"slider"),P.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return y(t,L),m(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),D=function(e){function t(e,r,i){p(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),o=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===i?"Fire":i,P.bind(n.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),P.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}return y(t,w),m(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),k=function(e){function t(e,r){p(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.__color=new _(i.getValue()),i.__temp=new _(0);var n=i;i.domElement=document.createElement("div"),P.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",P.bind(i.__input,"keydown",function(e){13===e.keyCode&&f.call(this)}),P.bind(i.__input,"blur",f),P.bind(i.__selector,"mousedown",function(){P.addClass(this,"drag").bind(window,"mouseup",function(){P.removeClass(n.__selector,"drag")})}),P.bind(i.__selector,"touchstart",function(){P.addClass(this,"drag").bind(window,"touchend",function(){P.removeClass(n.__selector,"drag")})});var o,s=document.createElement("div");function l(e){v(e),P.bind(window,"mousemove",v),P.bind(window,"touchmove",v),P.bind(window,"mouseup",d),P.bind(window,"touchend",d)}function u(e){y(e),P.bind(window,"mousemove",y),P.bind(window,"touchmove",y),P.bind(window,"mouseup",h),P.bind(window,"touchend",h)}function d(){P.unbind(window,"mousemove",v),P.unbind(window,"touchmove",v),P.unbind(window,"mouseup",d),P.unbind(window,"touchend",d),m()}function h(){P.unbind(window,"mousemove",y),P.unbind(window,"touchmove",y),P.unbind(window,"mouseup",h),P.unbind(window,"touchend",h),m()}function f(){var e=c(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function m(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),r=e.touches&&e.touches[0]||e,i=r.clientX,o=r.clientY,a=(i-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),n.__color.v=s,n.__color.s=a,n.setValue(n.__color.toOriginal()),!1}function y(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),r=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),n.__color.h=360*r,n.setValue(n.__color.toOriginal()),!1}return a.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),a.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),a.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),a.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),a.extend(s.style,{width:"100%",height:"100%",background:"none"}),j(s,"top","rgba(0,0,0,0)","#000"),a.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=i.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),P.bind(i.__saturation_field,"mousedown",l),P.bind(i.__saturation_field,"touchstart",l),P.bind(i.__field_knob,"mousedown",l),P.bind(i.__field_knob,"touchstart",l),P.bind(i.__hue_field,"mousedown",u),P.bind(i.__hue_field,"touchstart",u),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return y(t,w),m(t,[{key:"updateDisplay",value:function(){var e=c(this.getValue());if(!1!==e){var t=!1;a.each(_.COMPONENTS,function(r){if(!a.isUndefined(e[r])&&!a.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r])return t=!0,{}},this),t&&a.extend(this.__color.__state,e)}a.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,i=255-r;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,j(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),a.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(),V=["-moz-","-o-","-webkit-","-ms-",""];function j(e,t,r,i){e.style.background="",a.each(V,function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+r+" 0%, "+i+" 100%); "})}var U=function(e,t){var r=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var n=r.getElementsByTagName("head")[0];try{n.appendChild(i)}catch(e){}},z=function(e,t){var r=e[t];return a.isArray(arguments[2])||a.isObject(arguments[2])?new M(e,t,arguments[2]):a.isNumber(r)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?a.isNumber(arguments[4])?new F(e,t,arguments[2],arguments[3],arguments[4]):new F(e,t,arguments[2],arguments[3]):a.isNumber(arguments[4])?new R(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new R(e,t,{min:arguments[2],max:arguments[3]}):a.isString(r)?new O(e,t):a.isFunction(r)?new D(e,t,""):a.isBoolean(r)?new E(e,t):null};var B=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},N=function(){function e(){p(this,e),this.backgroundElement=document.createElement("div"),a.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),P.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),a.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;P.bind(this.backgroundElement,"click",function(){t.hide()})}return m(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),a.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",P.unbind(e.domElement,"webkitTransitionEnd",t),P.unbind(e.domElement,"transitionend",t),P.unbind(e.domElement,"oTransitionEnd",t)};P.bind(this.domElement,"webkitTransitionEnd",t),P.bind(this.domElement,"transitionend",t),P.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-P.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-P.getHeight(this.domElement)/2+"px"}}]),e}();U(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var G="Default",W=function(){try{return!!window.localStorage}catch(e){return!1}}(),q=void 0,H=!0,X=void 0,Y=!1,Z=[],Q=function e(t){var r=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),P.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=a.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=a.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),a.isUndefined(i.load)?i.load={preset:G}:i.preset&&(i.load.preset=i.preset),a.isUndefined(i.parent)&&i.hideable&&Z.push(this),i.resizable=a.isUndefined(i.parent)&&i.resizable,i.autoPlace&&a.isUndefined(i.scrollable)&&(i.scrollable=!0);var n,o=W&&"true"===localStorage.getItem(re(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:i.load.preset},set:function(e){r.parent?r.getRoot().preset=e:i.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),r.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,ae(r,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,l&&(l.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?P.addClass(r.__ul,e.CLASS_CLOSED):P.removeClass(r.__ul,e.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return o},set:function(e){W&&(o=e,e?P.bind(window,"unload",s):P.unbind(window,"unload",s),localStorage.setItem(re(r,"isLocal"),e))}}}),a.isUndefined(i.parent)){if(this.closed=i.closed||!1,P.addClass(this.domElement,e.CLASS_MAIN),P.makeSelectable(this.domElement,!1),W&&o){r.useLocalStorage=!0;var u=localStorage.getItem(re(this,"gui"));u&&(i.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,P.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(P.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(P.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),P.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{void 0===i.closed&&(i.closed=!0);var c=document.createTextNode(i.name);P.addClass(c,"controller-name"),l=K(r,c);P.addClass(this.__ul,e.CLASS_CLOSED),P.addClass(l,"title"),P.bind(l,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),i.closed||(this.closed=!1)}i.autoPlace&&(a.isUndefined(i.parent)&&(H&&(X=document.createElement("div"),P.addClass(X,"dg"),P.addClass(X,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(X),H=!1),X.appendChild(this.domElement),P.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ae(r,i.width)),this.__resizeHandler=function(){r.onResizeDebounced()},P.bind(window,"resize",this.__resizeHandler),P.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),P.bind(this.__ul,"transitionend",this.__resizeHandler),P.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&oe(this),s=function(){W&&"true"===localStorage.getItem(re(r,"isLocal"))&&localStorage.setItem(re(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((n=r.getRoot()).width+=1,a.defer(function(){n.width-=1}))};function K(e,t,r){var i=document.createElement("li");return t&&i.appendChild(t),r?e.__ul.insertBefore(i,r):e.__ul.appendChild(i),e.onResize(),i}function J(e){P.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&P.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function $(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];r.innerHTML=t?r.value+"*":r.value}function ee(e,t){var r=e.getRoot(),i=r.__rememberedObjects.indexOf(t.object);if(-1!==i){var n=r.__rememberedObjectIndecesToControllers[i];if(void 0===n&&(n={},r.__rememberedObjectIndecesToControllers[i]=n),n[t.property]=t,r.load&&r.load.remembered){var o=r.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[G])return;a=o[G]}if(a[i]&&void 0!==a[i][t.property]){var s=a[i][t.property];t.initialValue=s,t.setValue(s)}}}}function te(e,t,r,i){if(void 0===t[r])throw new Error('Object "'+t+'" has no property "'+r+'"');var n=void 0;if(i.color)n=new k(t,r);else{var o=[t,r].concat(i.factoryArgs);n=z.apply(e,o)}i.before instanceof w&&(i.before=i.before.__li),ee(e,n),P.addClass(n.domElement,"c");var s=document.createElement("span");P.addClass(s,"property-name"),s.innerHTML=n.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(n.domElement);var u=K(e,l,i.before);return P.addClass(u,Q.CLASS_CONTROLLER_ROW),n instanceof k?P.addClass(u,"color"):P.addClass(u,f(n.getValue())),function(e,t,r){if(r.__li=t,r.__gui=e,a.extend(r,{options:function(t){if(arguments.length>1){var i=r.__li.nextElementSibling;return r.remove(),te(e,r.object,r.property,{before:i,factoryArgs:[a.toArray(arguments)]})}if(a.isArray(t)||a.isObject(t)){var n=r.__li.nextElementSibling;return r.remove(),te(e,r.object,r.property,{before:n,factoryArgs:[t]})}},name:function(e){return r.__li.firstElementChild.firstElementChild.innerHTML=e,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof F){var i=new R(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});a.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=r[e],n=i[e];r[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(i,e),t.apply(r,e)}}),P.addClass(t,"has-slider"),r.domElement.insertBefore(i.domElement,r.domElement.firstElementChild)}else if(r instanceof R){var n=function(t){if(a.isNumber(r.__min)&&a.isNumber(r.__max)){var i=r.__li.firstElementChild.firstElementChild.innerHTML,n=r.__gui.__listening.indexOf(r)>-1;r.remove();var o=te(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return o.name(i),n&&o.listen(),o}return t};r.min=a.compose(n,r.min),r.max=a.compose(n,r.max)}else r instanceof E?(P.bind(t,"click",function(){P.fakeEvent(r.__checkbox,"click")}),P.bind(r.__checkbox,"click",function(e){e.stopPropagation()})):r instanceof D?(P.bind(t,"click",function(){P.fakeEvent(r.__button,"click")}),P.bind(t,"mouseover",function(){P.addClass(r.__button,"hover")}),P.bind(t,"mouseout",function(){P.removeClass(r.__button,"hover")})):r instanceof k&&(P.addClass(t,"color"),r.updateDisplay=a.compose(function(e){return t.style.borderLeftColor=r.__color.toString(),e},r.updateDisplay),r.updateDisplay());r.setValue=a.compose(function(t){return e.getRoot().__preset_select&&r.isModified()&&$(e.getRoot(),!0),t},r.setValue)}(e,u,n),e.__controllers.push(n),n}function re(e,t){return document.location.href+"."+t}function ie(e,t,r){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ne(e,t){t.style.display=e.useLocalStorage?"block":"none"}function oe(e){var t=void 0;function r(r){return r.preventDefault(),e.width+=t-r.clientX,e.onResize(),t=r.clientX,!1}function i(){P.removeClass(e.__closeButton,Q.CLASS_DRAG),P.unbind(window,"mousemove",r),P.unbind(window,"mouseup",i)}function n(n){return n.preventDefault(),t=n.clientX,P.addClass(e.__closeButton,Q.CLASS_DRAG),P.bind(window,"mousemove",r),P.bind(window,"mouseup",i),!1}e.__resize_handle=document.createElement("div"),a.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),P.bind(e.__resize_handle,"mousedown",n),P.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function se(e,t){var r={};return a.each(e.__rememberedObjects,function(i,n){var o={},s=e.__rememberedObjectIndecesToControllers[n];a.each(s,function(e,r){o[r]=t?e.initialValue:e.getValue()}),r[n]=o}),r}Q.toggleHide=function(){Y=!Y,a.each(Z,function(e){e.domElement.style.display=Y?"none":""})},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Q.toggleHide()},P.bind(window,"keydown",Q._keydownHandler,!1),a.extend(Q.prototype,{add:function(e,t){return te(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return te(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;a.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&X.removeChild(this.domElement);var e=this;a.each(this.__folders,function(t){e.removeFolder(t)}),P.unbind(window,"keydown",Q._keydownHandler,!1),J(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new Q(t);this.__folders[e]=r;var i=K(this,r.domElement);return P.addClass(i,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],J(e);var t=this;a.each(e.__folders,function(t){e.removeFolder(t)}),a.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=P.getOffset(e.__ul).top,r=0;a.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(r+=P.getHeight(t))}),window.innerHeight-t-20<r?(P.addClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(P.removeClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&a.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:a.debounce(function(){this.onResize()},50),remember:function(){if(a.isUndefined(q)&&((q=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;a.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");P.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),P.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",P.addClass(r,"button gears");var i=document.createElement("span");i.innerHTML="Save",P.addClass(i,"button"),P.addClass(i,"save");var n=document.createElement("span");n.innerHTML="New",P.addClass(n,"button"),P.addClass(n,"save-as");var o=document.createElement("span");o.innerHTML="Revert",P.addClass(o,"button"),P.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?a.each(e.load.remembered,function(t,r){ie(e,r,r===e.preset)}):ie(e,G,!1);if(P.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(r),t.appendChild(i),t.appendChild(n),t.appendChild(o),W){var l=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(re(e,"isLocal"))&&u.setAttribute("checked","checked"),ne(e,l),P.bind(u,"change",function(){e.useLocalStorage=!e.useLocalStorage,ne(e,l)})}var d=document.getElementById("dg-new-constructor");P.bind(d,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||q.hide()}),P.bind(r,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),q.show(),d.focus(),d.select()}),P.bind(i,"click",function(){e.save()}),P.bind(n,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),P.bind(o,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=se(this)),e.folders={},a.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=se(this),$(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[G]=se(this,!0)),this.load.remembered[e]=se(this),this.preset=e,ie(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){a.each(this.__controllers,function(t){this.getRoot().load.remembered?ee(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),a.each(this.__folders,function(e){e.revert(e)}),e||$(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&B.call(window,function(){e(t)});a.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){a.each(this.__controllers,function(e){e.updateDisplay()}),a.each(this.__folders,function(e){e.updateDisplay()})}});var le=Q,ue=r(0),ce=r(7),de=r(3),he=r(79),fe=r(22);var pe=()=>"\nvarying float vAltitude;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n\nattribute vec2 octNormal;\n\nuniform bool useOctNormal;\n\n#include <fog_pars_vertex>\n\nvec2 signNotZero(vec2 v) {\n  return vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\n\nvec3 oct_to_float32x3(vec2 e) {\n  vec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\n  if (v.z < 0.0) {\n    v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n  }\n  return normalize(v);\n}\n\nvec2 snorm_to_float32x2(vec2 s) {\n  vec2 v = ((s / 255.0) * 2.0) - 1.0;\n  return v;\n}\n\nvoid main() {\n  vAltitude = position[2]; // z value\n\n  if (useOctNormal) {\n    vec2 floatOctNormal = snorm_to_float32x2(octNormal);\n    vec3 decNormal = oct_to_float32x3(floatOctNormal);\n    vNormal = decNormal;\n  } else {\n    vNormal = normal;\n  }\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  \n  #include <begin_vertex>\n  #include <project_vertex>\n  #include <fog_vertex>\n}\n";var me=e=>`\n#define COLOR_STEPS_COUNT ${e.COLOR_STEPS_COUNT}\n\nvarying float vAltitude;\nvarying vec2 vUv;\nvarying vec3 vNormal;\n\nuniform vec3 colorSteps[COLOR_STEPS_COUNT];\nuniform float altitudeSteps[COLOR_STEPS_COUNT];\n\nuniform sampler2D texture;\nuniform int hasTexture;\nuniform float textureIntensity;\nuniform vec3 lightVector;\nuniform float opacity;\n\n#include <fog_pars_fragment>\n\nvoid main() {\n  vec3 altitudeColor;\n  float lowestAltitude = altitudeSteps[0];\n  float highestAlttitude = altitudeSteps[COLOR_STEPS_COUNT - 1];\n  vec3 lowestAltitudeColor = colorSteps[0];\n  vec3 highestAltitudeColor = colorSteps[COLOR_STEPS_COUNT - 1];\n\n  if (vAltitude < lowestAltitude) {\n    altitudeColor = lowestAltitudeColor;\n  }\n\n  if (vAltitude > highestAlttitude) {\n    altitudeColor = highestAltitudeColor;\n  }\n\n  for(int i = 0; i < COLOR_STEPS_COUNT - 1; i++) {\n    if (vAltitude > altitudeSteps[i] && vAltitude <= altitudeSteps[i + 1]) {\n      altitudeColor = mix(\n        colorSteps[i],\n        colorSteps[i + 1],\n        (vAltitude - altitudeSteps[i]) / (altitudeSteps[i + 1] - altitudeSteps[i])\n      );\n    }\n  }\n\n  if (hasTexture == 1) {\n    vec4 texColor = texture2D(texture, vUv);\n\n    gl_FragColor = vec4(mix(altitudeColor.xyz, texColor.xyz, textureIntensity), 1.0);\n  } else {\n    vec3 color = altitudeColor * clamp(dot(vNormal, normalize(lightVector)), 0.3, 1.0); \n  \n    gl_FragColor = vec4(color, opacity);\n  }\n  \n  #include <fog_fragment>\n}\n`;const ve={colorSteps:[{color:new ue.Vector3(0,0,0),altitude:-300},{color:new ue.Vector3(1,1,1),altitude:8848}],texture:null,textureIntensity:.4,lightVector:new ue.Vector3(1,0,.5),opacity:1};class ye extends ue.ShaderMaterial{constructor(e,t){const r=Object.assign({},ve,t),i=r.colorSteps.slice().sort((e,t)=>e.altitude>=t.altitude),n=i.map(e=>e.color),o=i.map(e=>e.altitude),a=ue.UniformsUtils.merge([{useOctNormal:{value:ye.containsOctNormals(e)},colorSteps:{value:n},altitudeSteps:{value:o},textureIntensity:{value:r.textureIntensity},hasTexture:{value:null===r.texture?0:1},texture:{value:r.texture},lightVector:{value:r.lightVector},opacity:{value:r.opacity}},ue.UniformsLib.fog]);super({vertexShader:pe(),fragmentShader:me({COLOR_STEPS_COUNT:i.length}),uniforms:a})}static containsOctNormals(e){return void 0!==e.geometries[0].vertexAttributes.find(this.isOctNormalAttribute)}static isOctNormalAttribute(e){return"octNormal"===e.name}}class ge extends fe.TileFactory{constructor(e){super(_e),this.options=e}create(e,t){return new _e(e,t,this.options)}}class _e extends ce.Tile{constructor(e,t,r){super(e,t),this.getTileMaterial=r.getTileMaterial,this.getCustomObjects=r.getCustomObjects,this.decodedTileGeometry=null,this.scaledPositionArray=null,this.tileSize=this.getTileSize(this.tileKey,this.projection,this.dataSource.getTilingScheme())}generateTileMaterial(e){return this.getTileMaterial?this.getTileMaterial(this,e):Promise.resolve(new ye(e))}getTileSize(e,t,r){const i=new ue.Box3,n=new ue.Vector3,o=r.getGeoBox(e);return t.projectBox(o,i),i.getSize(n),n}scaleVertices(e,t,r){const i=r.x,n=r.y,o=t.maxHeight-t.minHeight,a=new Float32Array(e.length);for(let s=0;s<e.length;s+=3)a[s]=e[s]*i-r.x/2,a[s+1]=e[s+1]*n-r.y/2,a[s+2]=e[s+2]*o+t.minHeight;return a}findVertexAttribute(e,t){return e.find(e=>e.name===t)}createObjects(e,t){this.decodedTileGeometry=e.geometries[0];const r=this.findVertexAttribute(this.decodedTileGeometry.vertexAttributes,"position"),i=r.buffer,n=r.metadata;this.scaledPositionArray=this.scaleVertices(i,n,this.tileSize),this.generateTileMaterial(e).then(r=>this.createTileObjects(r,e.geometries[0],t)),this.getCustomObjects&&Promise.resolve(this.getCustomObjects(this)).then(()=>this.dataSource.requestUpdate())}createTileObjects(e,t,r){const i=new ue.BufferGeometry,n=new ue.Mesh(i,e);t.vertexAttributes.forEach(e=>{const t="position"===e.name?this.scaledPositionArray:e.buffer;i.addAttribute(e.name,new ue.BufferAttribute(t,e.itemCount))}),void 0!==t.index&&i.setIndex(new ue.BufferAttribute(t.index.buffer,1)),i.attributes.normal||i.attributes.octNormal||i.computeVertexNormals(),this.registerTileObject(n),r.push(n),this.dataSource.requestUpdate()}calculateLocalDisplacement(e){const t=this.projection.projectPoint(e,new ue.Vector3).sub(this.center),r=this.decodedTileGeometry.index.buffer,i=this.scaledPositionArray,n=new ue.Vector3(0,0,0);for(let e=0;e<r.length;e+=3){const o=3*r[e],a=3*r[e+1],s=3*r[e+2],l=new ue.Vector3(i[o],i[o+1],i[o+2]),u=new ue.Vector3(i[a],i[a+1],i[a+2]),c=new ue.Vector3(i[s],i[s+1],i[s+2]),d=new ue.Triangle(l,u,c),h=new ue.Triangle(l.clone().setZ(0),u.clone().setZ(0),c.clone().setZ(0));if(h.containsPoint(t)){const e=h.getBarycoord(t,new ue.Vector3),r=e.x*d.a.z+e.y*d.b.z+e.z*d.c.z;n.set(t.x,t.y,r);break}}return n}addObject(e,t){this.geoBox.contains(e)&&(t.displacement=this.calculateLocalDisplacement(e),this.registerTileObject(t),this.objects.push(t))}}class be{constructor(e){if(void 0===e)throw new Error('"fetchTile()" method was not provided');this.fetchTile=e}connect(){return Promise.resolve()}ready(){return!0}getTile(e){return this.fetchTile(e)}}class xe extends fe.TileDataSource{constructor(e){if(void 0===e.tilingScheme)throw new Error('No "tilingScheme" option provided.');if(void 0===e.concurrentDecoderServiceName)throw new Error('No "concurrentDecoderServiceName" option provided. It should be an ID of one of the supported decoders.');if(void 0===e.concurrentDecoderScriptUrl)throw new Error('No "concurrentDecoderScriptUrl" option provided. It should be URL of a decoder worker used to decode tiles.');super(new ge(e),{id:"terrain",tilingScheme:e.tilingScheme,dataProvider:new be(e.fetchTile),useWorker:!0,concurrentDecoderServiceName:e.concurrentDecoderServiceName,concurrentDecoderScriptUrl:e.concurrentDecoderScriptUrl}),this.options=e,void 0!==e.decoderOptions&&this.decoder.connect().then(()=>{this.decoder.configure(e.decoderOptions)})}connect(){return this.decoder.connect()}ready(){return!0}shouldPreloadTiles(){return!0}getDisplayZoomLevel(e){return void 0!==this.options.getDisplayZoomLevel?this.options.getDisplayZoomLevel(e):e}}new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);const we={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4};we.extensions;const Se="quantized-mesh-tile-decoder";var Te={APP_ID:"cJ7gyg679deVM55KumC5",APP_CODE:"tJ69vQOiDh26e1R_esdVaA",CESIUM_USER_ACCESS_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjNTJiNGQ3Ny05N2EzLTRiOTQtYWFiYS05NmE3MzAxN2FmODciLCJpZCI6MjgxOCwic2NvcGVzIjpbImFzciJdLCJhc3NldHMiOlsxXSwiaWF0IjoxNTQ3MjA2NjM5fQ.cFwN3KPr0VmuVEvak282nc9L-eG8SylHJCkqUFNOpN4"};const Ce=["Grand Teton National Park (Quantized Mesh)","Cesium World Terrain (Quantized Mesh)"],Pe=["Elevation Styling","Texture","Wireframe"];const Ee=new ue.TextureLoader;function Me(e){const t=function(e){const t=de.mercatorTilingScheme.getTileKey(e.geoBox.center,e.tileKey.level);return`https://${Math.round(3*Math.random())+1}.aerial.maps.api.here.com/maptile/2.1/basetile/newest/satellite.day/${t.level}/${t.column}/${t.rowCount()-t.row-1}/512/png?app_id=${Te.APP_ID}&app_code=${Te.APP_CODE}`}(e);return new Promise((e,r)=>{Ee.load(t,e,void 0,r)})}Ee.crossOrigin="";const Oe=[{color:new ue.Vector3(.670588235,.850980392,.91372549),altitude:700},{color:new ue.Vector3(.109803922,.564705882,.6),altitude:1500},{color:new ue.Vector3(.403921569,.662745098,.811764706),altitude:2e3},{color:new ue.Vector3(.741176471,.788235294,.882352941),altitude:2800},{color:new ue.Vector3(1,1,1),altitude:3e3}],Ae=new ue.Vector3(.7,0,.5),Le=new ue.Vector3(0,-1,0);function Re(e,t,r){switch(r.style){case Pe[0]:return Promise.resolve(new ye(t,{colorSteps:Oe,lightVector:r.dataset===Ce[1]?Le:Ae}));case Pe[1]:return Me(e).then(e=>(e.minFilter=ue.LinearFilter,e.magFilter=ue.LinearFilter,e.generateMipmaps=!1,e.wrapS=e.wrapT=ue.ClampToEdgeWrapping,new ue.MeshBasicMaterial({map:e})));case Pe[2]:return Promise.resolve(new ue.MeshBasicMaterial({color:0,wireframe:!0}))}}const Ie={currentDataset:Ce[0],isAttributionPopupVisible:!1},Fe=document.querySelector(".attribution-trigger"),De=document.querySelector(".attribution-popup"),ke=document.querySelector(".cesium-attribution"),Ve=document.querySelector(".sample-attribution"),je=document.querySelector(".cesium-ion-logo");function Ue(e){Fe.classList.toggle("active",e.isAttributionPopupVisible),De.style.display=e.isAttributionPopupVisible?"block":"none",Ve.style.display=e.currentDataset===Ce[0]?"block":"none",ke.style.display=e.currentDataset===Ce[1]?"block":"none",je.style.display=e.currentDataset===Ce[1]?"block":"none"}Fe.addEventListener("click",function(){Ie.isAttributionPopupVisible=!Ie.isAttributionPopupVisible,Ue(Ie)}),window.addEventListener("message",function(e){if("object"!=typeof e.data||"dataset-change"!==e.data.type)return;Ie.currentDataset=e.data.dataset,Ue(Ie)}),Ue(Ie);const ze="./dist/quantized-mesh-decoder.bundle.js";function Be(e,t){return new xe({concurrentDecoderServiceName:Se,concurrentDecoderScriptUrl:ze,tilingScheme:de.hereTilingScheme,fetchTile:t=>(function(e,t){const r=e.column,i=e.row,n=`https://assets.cesium.com/1/${e.level-1}/${r}/${i}.terrain?extensions=octvertexnormals&v=1.1.0`;return window.fetch(n,{headers:{Accept:`application/vnd.quantized-mesh,application/octet-stream;q=0.9;access_token=${t};`}}).then(e=>{if(200!==e.status)throw new Error(`Unable to load tile ${n}`);return e.arrayBuffer()}).catch(e=>{console.log(e)})})(t,e),getTileMaterial:(e,r)=>Re(e,r,t)})}function Ne(e){return new xe({concurrentDecoderServiceName:Se,concurrentDecoderScriptUrl:ze,tilingScheme:de.webMercatorTilingScheme,fetchTile:e=>(function(e){const t=e.column,r=e.rowCount()-e.row-1,i=`https://nikgarmash.com/grand-teton-tiles/tiles/${e.level}/${t}/${r}.terrain`;return window.fetch(i).then(e=>{if(200!==e.status)throw new Error(`Unable to load tile ${i}`);return e.arrayBuffer()}).catch(e=>{console.log(e)})})(e),getTileMaterial:(t,r)=>Re(t,r,e),getDisplayZoomLevel:e=>ue.Math.clamp(e+2,8,14)})}(function(){const e=`https://api.cesium.com/v1/assets/1/endpoint?access_token=${Te.CESIUM_USER_ACCESS_TOKEN}`;return window.fetch(e).then(e=>e.json()).then(e=>e.accessToken).catch(e=>console.log(e))})().then(e=>{const t={dataset:Ce[0],style:Pe[0]},r=function(e){const t=new ce.MapView({minZoomLevel:8,maxZoomLevel:14,canvas:e,maxVisibleDataSourceTiles:300,tileCacheSize:1e3});return new he.MapControls(t),t.resize(window.innerWidth,window.innerHeight),t.zoomLevelBias=.5,window.addEventListener("resize",()=>{t.resize(window.innerWidth,window.innerHeight)}),t}(document.getElementById("map")),i=Be(e,t),n=Ne(t);r.addDataSource(i),r.addDataSource(n),n.enabled=t.dataset===Ce[0],i.enabled=t.dataset===Ce[1],r.setCameraGeolocationAndZoom(new de.GeoCoordinates(43.7519975195926,-110.73214288570348),12),r.camera.rotateX(ue.Math.degToRad(35));const o=new le({width:300}),a=o.add(t,"dataset",Ce),s=o.add(t,"style",Pe);function l(){r.clearTileCache(),r.update()}a.onChange(e=>{n.enabled=e===Ce[0],i.enabled=e===Ce[1],s.setValue(Pe[0]),s.updateDisplay(),s.domElement.querySelectorAll("option[value*=Texture]").forEach(t=>{t.disabled=e===Ce[1]}),l(),window.postMessage({type:"dataset-change",dataset:e},"*")}),s.onChange(l)})}]);
//# sourceMappingURL=app.bundle.js.map