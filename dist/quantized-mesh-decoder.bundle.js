!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=180/Math.PI,i=Math.PI/180;class s{constructor(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n}static fromDegrees(e,t,n){return new s(e,t,n)}static fromRadians(e,t,n){return new s(e*r,t*r,n)}get latitudeInRadians(){return this.latitude*i}get longitudeInRadians(){return this.longitude*i}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;if(isNaN(e)||isNaN(t))return this;if(e>90){let n=(e+90)%360;n>=180&&(t+=180,n=360-n),e=n-90}if(e<-90){let n=(e-90)%360;n<=-180&&(t+=180,n=-360-n),e=n+90}return(t<-180||t>180)&&(t=(t+180)%360-180),e===this.latitude&&t===this.longitude?this:new s(e,t,this.altitude)}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new s(this.latitude,this.longitude,this.altitude)}}t.GeoCoordinates=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=Math.PI/180,i=180/Math.PI;!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function n(e,n){const r=(e=t(e))-(n=t(n));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,n,r){return void 0===r?{x:e,y:t,z:n}:(r.x=e,r.y=t,r.z=n,r)},e.degToRad=function(e){return e*r},e.radToDeg=function(e){return e*i},e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.normalizeAngleDeg=t,e.angleDistanceDeg=n,e.interpolateAnglesDeg=function(e,t,r){return(e+n(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(38)),r(n(39)),r(n(43)),r(n(44)),r(n(45)),r(n(46)),r(n(47)),r(n(48)),r(n(49)),r(n(50)),r(n(51))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=Math.PI/180;class s{constructor(e,t){this.southWest=e,this.northEast=t}static fromCoordinates(e,t){return new s(e,t)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:n}=this,{minAltitude:i,altitudeSpan:s}=this;let o;if(void 0!==i&&void 0!==s&&(o=i+.5*s),t<n)return new r.GeoCoordinates(e,.5*(t+n),o);let a=.5*(360+n+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return this.latitudeSpan*i}get longitudeSpanInRadians(){return this.longitudeSpan*i}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,n=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?n:r)&&this.containsHelper(e)}clone(){return new s(this.southWest,this.northEast)}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:n}=this;return n>t?e.longitude>=t&&e.longitude<n:e.longitude>n||e.longitude<=t}}t.GeoBox=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(4)),r(n(52)),r(n(0)),r(n(8)),r(n(21)),r(n(53)),r(n(6)),r(n(14)),r(n(22)),r(n(54)),r(n(23)),r(n(24)),r(n(15)),r(n(55)),r(n(25)),r(n(9)),r(n(26)),r(n(27)),r(n(10)),r(n(56)),r(n(57)),r(n(58)),r(n(59)),r(n(5)),r(n(2)),r(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}r.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,r.EQUATORIAL_RADIUS=6378137,r.MIN_ELEVATION=-433,r.MAX_ELEVATION=8848,t.EarthConstants=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class i{constructor(e,t,n){this.row=e,this.column=t,this.level=n}static fromRowColumnLevel(e,t,n){return new i(e,t,n)}static fromQuadKey(e){const t=e.length;let n=0,r=0;for(let i=0;i<e.length;++i){const s=1<<i,o=parseInt(e.charAt(t-i-1),10);1&o&&(r|=s),2&o&&(n|=s)}return i.fromRowColumnLevel(n,r,t)}static fromMortonCode(e){let t=0,n=0,r=0,s=e;for(;s>1;){const e=1<<t;1&s&&(r|=e),2&s&&(n|=e),t++,s=(s-(3&s))/4}const o=i.fromRowColumnLevel(n,r,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=i.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,n,r,s){return i.fromRowColumnLevel(Math.floor(n/(s/i.rowsAtLevel(e))),Math.floor(t/(r/i.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return i.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let n=this.row,r=this.column;return e>=0?(n<<=e,r<<=e):(n>>>=-e,r>>>=-e),i.fromRowColumnLevel(n,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,n=r[this.level<<1];for(let i=0;i<this.level;++i)1&e&&(n+=r[2*i]),1&t&&(n+=r[2*i+1]),e>>>=1,t>>>=1;this.m_mortonCode=n}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const n=1<<t-1,r=0!=(this.column&n),i=0!=(this.row&n);e+=r&&i?"3":i?"2":r?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=i.fromQuadKey(0===e.length?"-":e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}addedSubHereTile(e){const t=i.fromHereTile(e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return i.rowsAtLevel(this.level)}columnCount(){return i.columnsAtLevel(this.level)}}t.TileKey=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(23),i=n(26),s=n(27);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return i.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return i.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(63)),r(n(30)),r(n(20)),r(n(29)),r(n(64)),r(n(65)),r(n(66)),r(n(67)),r(n(68)),r(n(69))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),i=n(3).LoggerManager.instance.create("WorkerService",{enabled:!1});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(r.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,n={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,n),this.tryHandleRequest(t.request).then(e=>{this.doSendResponse(n,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)}).catch(e=>{this.doSendResponse(n,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,error:e.toString()})})}else this.tryHandleMessage(e.data)}catch(t){i.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){i.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){i.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return i.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,n){e.responseSent||(self.postMessage(t,n),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach(e=>{this.doSendResponse(e,{service:this.serviceId,type:r.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,error:"cancelled"})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(5),o=n(1),a=n(2),u=n(8),l=n(6);class c{constructor(){this.type=l.ProjectionType.Planar}static clamp(e,t,n){return Math.min(Math.max(t,e),n)}static latitudeClamp(e){return c.clamp(e,-c.MAXIMUM_LATITUDE,c.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return c.latitudeProject(c.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/u.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5))}worldExtent(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.max.y=u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n.max.z=t,n}projectPoint(e,t){let n;return n=e instanceof i.GeoCoordinates?e:new i.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.y=(.5*c.latitudeClampProject(n.latitudeInRadians)+.5)*u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.z=n.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(c.unprojectLatitude(2*(e.y/u.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5)),e.x/u.EarthConstants.EQUATORIAL_CIRCUMFERENCE*2*Math.PI-Math.PI,e.z)}projectBox(e,t){const n=this.projectPoint(e.center),r=(.5*c.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,i=(.5*c.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*u.EarthConstants.EQUATORIAL_CIRCUMFERENCE,l=.5*(r+i);n.y=l;const h=r-i,d=e.longitudeSpan/360*u.EarthConstants.EQUATORIAL_CIRCUMFERENCE;if(t||(t=o.MathUtils.newEmptyBox3()),s.isBox3Like(t)){t.min.x=n.x-.5*d,t.min.y=n.y-.5*h,t.max.x=n.x+.5*d,t.max.y=n.y+.5*h;const r=e.altitudeSpan;void 0!==r?(t.min.z=n.z-.5*r,t.max.z=n.z+.5*r):(t.min.z=0,t.max.z=0)}else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=n.x,t.position.y=n.y,t.position.z=n.z,t.extents.x=.5*d,t.extents.y=.5*h,t.extents.z=Math.max(Number.EPSILON,.5*(e.altitudeSpan||0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}}c.MAXIMUM_LATITUDE=1.4844222297453322,t.MercatorProjection=c,t.mercatorProjection=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(13);t.Logger=class{constructor(e,t,n){this.name=e,this.m_channel=t,this.enabled=!0,this.level=r.LogLevel.Trace,void 0!==n&&this.update(n)}error(e,...t){this.enabled&&this.level<=r.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=r.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=r.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=r.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=r.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=r.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(13);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Error};self.postMessage(i)}debug(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Debug};self.postMessage(i)}info(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Info};self.postMessage(i)}log(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Log};self.postMessage(i)}trace(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Trace};self.postMessage(i)}warn(e,...n){const i={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Warn};self.postMessage(i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.kind=e}static parse(e){return new I(e).parse()}}t.Expr=r;class i{lookup(e){}unmap(){return{}}}t.Env=i;t.MapEnv=class extends i{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){const t=this.entries[e];return void 0!==t?t:this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}};class s extends r{constructor(e){super("var"),this.name=e}evaluate(e){return e.lookup(this.name)}}class o extends r{constructor(e){super("number"),this.value=e}evaluate(){return this.value}}class a extends r{constructor(e){super("string"),this.value=e}evaluate(){return this.value}}class u extends r{constructor(e){super("has"),this.attribute=e}evaluate(e){return void 0!==e.lookup(this.attribute)}}class l extends r{constructor(e,t){super("in"),this.value=e,this.elements=t}evaluate(e){const t=this.value.evaluate(e);for(const n of this.elements){if(t===n.evaluate(e))return!0}return!1}}class c extends r{constructor(e){super("!"),this.expr=e}evaluate(e){return!this.expr.evaluate(e)}}class h extends r{constructor(e,t,n){super(e),this.op=e,this.left=t,this.right=n}evaluate(e){const t=this.left.evaluate(e),n=this.right.evaluate(e);switch(this.op){case"~=":return"string"==typeof t&&"string"==typeof n&&-1!==t.indexOf(n);case"^=":return"string"==typeof t&&"string"==typeof n&&t.startsWith(n);case"$=":return"string"==typeof t&&"string"==typeof n&&t.endsWith(n);case"==":return t===n;case"!=":return t!==n;case"<":return void 0!==t&&void 0!==n?t<n:void 0;case">":return void 0!==t&&void 0!==n?t>n:void 0;case"<=":return void 0!==t&&void 0!==n?t<=n:void 0;case">=":return void 0!==t&&void 0!==n?t>=n:void 0}throw new Error("invalid relational op "+this.op)}}class d extends r{constructor(e,t,n){super(e),this.op=e,this.left=t,this.right=n}evaluate(e){const t=this.left.evaluate(e);switch(this.op){case"||":return t||this.right.evaluate(e);case"&&":return t&&this.right.evaluate(e)}throw new Error("invalid logical op "+this.op)}}var f,g;function p(e){switch(e){case f.Tab:case f.Lf:case f.Cr:case f.Space:return!0;default:return!1}}function m(e){return e>=f._0&&e<=f._9}function y(e){return e>=f.a&&e<=f.z||e>=f.A&&e<=f.Z}function x(e){return function(e){return y(e)||m(e)}(e)||e===f._||e===f.Dollar||e===f.Dot||e===f.LBracket||e===f.RBracket}function v(e){switch(e){case g.Eof:return"eof";case g.Error:return"error";case g.Identifier:return"identifier";case g.Number:return"number";case g.String:return"string";case g.Comma:return",";case g.LParen:return"(";case g.RParen:return")";case g.LBracket:return"[";case g.RBracket:return"]";case g.Exclaim:return"!";case g.TildeEqual:return"~=";case g.CaretEqual:return"^=";case g.DollarEqual:return"$=";case g.EqualEqual:return"==";case g.ExclaimEqual:return"!=";case g.Less:return"<";case g.Greater:return">";case g.LessEqual:return"<=";case g.GreaterEqual:return">=";case g.BarBar:return"||";case g.AmpAmp:return"&&";default:throw new Error("invalid token "+e)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(f||(f={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(g||(g={}));class E{constructor(e){this.code=e,this.m_token=g.Error,this.m_index=0,this.m_char=f.Lf}token(){return this.m_token}text(){return this.m_text||""}next(){if(this.m_token=this.yylex(),this.m_token===g.Error)throw new Error("unexpected character "+this.m_char);return this.m_token}yyinp(){this.m_char=this.code.codePointAt(this.m_index++)||0}yylex(){for(this.m_text=void 0;p(this.m_char);)this.yyinp();if(0===this.m_char)return g.Eof;const e=this.m_char;switch(this.yyinp(),e){case f.LParen:return g.LParen;case f.RParen:return g.RParen;case f.LBracket:return g.LBracket;case f.RBracket:return g.RBracket;case f.Comma:return g.Comma;case f.SingleQuote:case f.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),g.String}case f.Exclaim:return this.m_char===f.Equal?(this.yyinp(),g.ExclaimEqual):g.Exclaim;case f.Caret:return this.m_char===f.Equal?(this.yyinp(),g.CaretEqual):g.Error;case f.Tilde:return this.m_char===f.Equal?(this.yyinp(),g.TildeEqual):g.Error;case f.Equal:return this.m_char===f.Equal?(this.yyinp(),g.EqualEqual):g.Error;case f.Less:return this.m_char===f.Equal?(this.yyinp(),g.LessEqual):g.Less;case f.Greater:return this.m_char===f.Equal?(this.yyinp(),g.GreaterEqual):g.Greater;case f.Bar:return this.m_char===f.Bar?(this.yyinp(),g.BarBar):g.Error;case f.Amp:return this.m_char===f.Amp?(this.yyinp(),g.AmpAmp):g.Error;default:{const t=this.m_index-2;if(y(e)||e===f._||e===f.Dollar&&x(this.m_char)){for(;x(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),g.Identifier}if(m(e)){for(;m(this.m_char);)this.yyinp();if(this.m_char===f.Dot)for(this.yyinp();m(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),g.Number}if(e===f.Dollar)return this.m_char===f.Equal?(this.yyinp(),g.DollarEqual):g.Error}}return g.Error}}function M(e){switch(e){case g.TildeEqual:return"~=";case g.CaretEqual:return"^=";case g.DollarEqual:return"$=";case g.EqualEqual:return"==";case g.ExclaimEqual:return"!=";default:return}}function _(e){switch(e){case g.Less:return"<";case g.Greater:return">";case g.LessEqual:return"<=";case g.GreaterEqual:return">=";default:return}}class I{constructor(e){this.lex=new E(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${v(e)}' but found '${v(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case g.Identifier:{const e=this.lex.text();if("has"!==e){const t=new s(e);return this.lex.next(),t}this.lex.next(),this.yyexpect(g.LParen);const t=this.lex.text();return this.yyexpect(g.Identifier),this.yyexpect(g.RParen),new u(t)}case g.Number:{const e=new o(parseFloat(this.lex.text()));return this.lex.next(),e}case g.String:{const e=new a(this.lex.text());return this.lex.next(),e}case g.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(g.RParen),e}}throw new Error("Syntax error")}parseUnary(){return this.lex.token()===g.Exclaim?(this.lex.next(),new c(this.parseUnary())):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===g.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(g.LBracket);const t=[this.parsePrimary()];for(;this.lex.token()===g.Comma;)this.lex.next(),t.push(this.parsePrimary());this.yyexpect(g.RBracket),e=new l(e,t)}else{const t=_(this.lex.token());if(void 0===t)break;this.lex.next();const n=this.parseUnary();e=new h(t,e,n)}return e}parseEquality(){let e=this.parseRelational();for(;;){const t=M(this.lex.token());if(void 0===t)break;this.lex.next();const n=this.parseRelational();e=new h(t,e,n)}return e}parseLogicalAnd(){let e=this.parseEquality();for(;this.lex.token()===g.AmpAmp;){this.lex.next();const t=this.parseEquality();e=new d("&&",e,t)}return e}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.lex.token()===g.BarBar;){this.lex.next();const t=this.parseLogicalAnd();e=new d("||",e,t)}return e}}t.Parser=I},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7),i=n(28),s=[i.DiscreteInterpolant,i.LinearInterpolant,i.CubicInterpolant];function o(e){return void 0!==e&&e.values instanceof Array&&e.values.length>0&&void 0!==e.values[0]&&e.zoomLevels instanceof Array&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length}function a(e){return void 0!==e&&void 0!==e.interpolationMode&&void 0!==e.zoomLevels&&void 0!==e.values&&e.values.length>0&&(e.zoomLevels.length===e.values.length/3||e.zoomLevels.length===e.values.length)}t.getPropertyValue=function(e,t){if(a(e)){const n=e.values.length/e.zoomLevels.length,i=n>1,o=new s[e.interpolationMode](e.zoomLevels,e.values,n);o.evaluate(t);let a=i?"#":0;for(const e of o.resultBuffer){a+=i?("0"+(255*r.MathUtils.clamp(e,0,1)|0).toString(16)).slice(-2):e}return a}if(o(e))throw new Error("Invalid property definition");return e},t.isInterpolatedPropertyDefinition=o,t.isInterpolatedProperty=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(5),o=n(1),a=n(2),u=n(6),l=Math.PI/180;class c{constructor(){this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=1,n.max.y=.5,n.max.z=t,n}projectPoint(e,t){return void 0===t&&(t={x:0,y:0,z:0}),t.x=(e.longitude*l+Math.PI)*c.geoToWorldScale,t.y=(e.latitude*l+.5*Math.PI)*c.geoToWorldScale,t.z=e.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(e.y*c.worldToGeoScale-.5*Math.PI,e.x*c.worldToGeoScale-Math.PI,e.z)}projectBox(e,t){const n=this.projectPoint(new i.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:r,longitudeSpanInRadians:u,altitudeSpan:l}=e,h=u*c.geoToWorldScale,d=r*c.geoToWorldScale;return t||(t=o.MathUtils.newEmptyBox3()),s.isBox3Like(t)?(t.min.x=n.x-.5*h,t.min.y=n.y-.5*d,t.max.x=n.x+.5*h,t.max.y=n.y+.5*d,void 0!==l?(t.min.z=n.z-.5*l,t.max.z=n.z+.5*l):(t.min.z=0,t.max.z=0)):a.isOrientedBox3Like(t)&&(o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=n.x,t.position.y=n.y,t.position.z=n.z,t.extents.x=.5*h,t.extents.y=.5*d,t.extents.z=Math.max(Number.EPSILON,.5*(l||0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}}c.geoToWorldScale=1/(2*Math.PI),c.worldToGeoScale=2*Math.PI/1,t.equirectangularProjection=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(1),o=n(2),a=n(8),u=n(14);class l extends u.MercatorProjection{projectPoint(e,t){let n;n=e instanceof i.GeoCoordinates?e:new i.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;const r=Math.sin(u.MercatorProjection.latitudeClamp(n.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.z=n.altitude||0,t}unprojectPoint(e){const t=e.x/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5,n=.5-e.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r=360*t,s=90-360*Math.atan(Math.exp(2*-n*Math.PI))/Math.PI;return new i.GeoCoordinates(s,r,e.z)}projectBox(e,t){const n=super.projectBox(e,t);return o.isOrientedBox3Like(n)&&(s.MathUtils.newVector3(1,0,0,n.xAxis),s.MathUtils.newVector3(0,-1,0,n.yAxis),s.MathUtils.newVector3(0,0,-1,n.zAxis)),n}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return new r.GeoBox(new i.GeoCoordinates(n.latitude,t.longitude,t.altitude),new i.GeoCoordinates(t.latitude,n.longitude,n.altitude))}}l.MAXIMUM_LATITUDE=1.4844222297453322,t.webMercatorProjection=new l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,n=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=n,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,n);const{min:r,max:i}=this.m_worldBox;this.m_worldDimensions={x:i.x-r.x,y:i.y-r.y,z:i.z-r.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const n=e.level,i=this.subdivisionScheme.getLevelDimensionX(n),s=this.subdivisionScheme.getLevelDimensionY(n),o=this.m_worldDimensions.x/i,a=this.m_worldDimensions.y/s,u=this.m_worldBox.min.x+o*e.column,l=this.m_worldBox.min.y+a*e.row;return t||(t=r.MathUtils.newEmptyBox3()),t.min.x=u,t.min.y=l,t.min.z=this.m_worldBox.min.z,t.max.x=u+o,t.max.y=l+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9);class i{constructor(e,t,n){this.m_tileKey=e,this.m_level=t,this.m_count=1<<(t<<1),this.m_mask=n,this.m_shift=t>2?t-2<<1:0}get length(){return this.m_count}get level(){return this.m_level}get tileKey(){return this.m_tileKey}iterator(){return new i.Iterator(this)}skip(e){if(-1!==this.m_mask)for(;e<this.m_count&&0==(this.m_mask&1<<(e>>this.m_shift));)++e;return e}}t.SubTiles=i,function(e){e.Iterator=class{constructor(e,t=0){this.m_parent=e,this.m_index=e.skip(t)}get value(){const e=this.m_parent.tileKey,t=this.m_parent.level;return r.TileKey.fromRowColumnLevel(e.row<<t|this.m_index>>t,e.column<<t|this.m_index&(1<<t)-1,e.level+t)}next(){this.m_index=this.m_parent.skip(++this.m_index)}}}(i=t.SubTiles||(t.SubTiles={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(9);class s{static geoCoordinatesToTileKey(e,t,n){const r=e.projection,s=e.subdivisionScheme,o=r.projectPoint(t),a=s.getLevelDimensionX(n),u=s.getLevelDimensionY(n),{min:l,max:c}=r.worldExtent(0,0),h=c.x-l.x,d=c.y-l.y;if(o.x<l.x||o.x>c.x)return null;if(o.y<l.y||o.y>c.y)return null;const f=Math.min(a-1,Math.floor(a*(o.x-l.x)/h)),g=Math.min(u-1,Math.floor(u*(o.y-l.y)/d));return i.TileKey.fromRowColumnLevel(g,f,n)}static geoRectangleToTileKeys(e,t,n){const o=(e,t,n)=>e<t?n-(t-e)%(n-t):t+(e-t)%(n-t),a=(e,t,n)=>Math.min(Math.max(e,t),n),u=o(t.southWest.longitudeInRadians,-Math.PI,Math.PI),l=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=o(t.northEast.longitudeInRadians,-Math.PI,Math.PI),h=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(l,u),n),f=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(h,c),n),g=e.subdivisionScheme.getLevelDimensionX(n);if(!d||!f)throw new Error("Invalid coordinates");const p=d.column;let m=f.column;u>c&&(m+=m!==p?g:g-1);const y=Math.min(d.row,f.row),x=Math.max(d.row,f.row),v=new Array;for(let e=y;e<=x;++e)for(let t=p;t<=m;++t)v.push(i.TileKey.fromRowColumnLevel(e,t%g,n));return v}}t.TileKeyUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(25);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=~(-1<<this.m_subdivisionScheme.getSubdivisionX(e.level)*this.m_subdivisionScheme.getSubdivisionY(e.level)),n=new r.SubTiles(e,1,t),i=n.iterator(),s=new Array;for(let e=0;e<n.length;++e)s.push(i.value),i.next();return s}}},function(e,t){e.exports=THREE},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic"}(t.InterpolationMode||(t.InterpolationMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,n){"use strict";n.r(t);const r=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function i(e){return e>>1^-(1&e)}function s(e,t,n,r,i=!0){let s;if(s=2===r?new Uint16Array(e,t,n):new Uint32Array(e,t,n),!i)return s;let o=0;for(let e=0;e<s.length;++e){let t=s[e];s[e]=o-t,0===t&&++o}return s}function o(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const a=1,u=2,l=3,c=4,h={maxDecodingStep:c};function d(e,t){const n=Object.assign({},h,t),d=new DataView(e),{header:f,headerEndPosition:g}=function(e){let t=0;const n={};for(let[i,s]of r){const r=8===s?e.getFloat64:e.getFloat32;n[i]=r.call(e,t,!0),t+=s}return{header:n,headerEndPosition:t}}(d);if(n.maxDecodingStep<a)return{header:f};const{vertexData:p,vertexDataEndPosition:m}=function(e,t){let n=t;const r=e.getUint32(n,!0),s=new Uint16Array(3*r);n+=Uint32Array.BYTES_PER_ELEMENT;const o=Uint16Array.BYTES_PER_ELEMENT,a=r*o,u=n,l=u+a,c=l+a;let h=0,d=0,f=0;for(let t=0;t<r;t++)h+=i(e.getUint16(u+o*t,!0)),d+=i(e.getUint16(l+o*t,!0)),f+=i(e.getUint16(c+o*t,!0)),s[t]=h,s[t+r]=d,s[t+2*r]=f;return n+=3*a,{vertexData:s,vertexDataEndPosition:n}}(d,g);if(n.maxDecodingStep<u)return{header:f,vertexData:p};const{triangleIndices:y,triangleIndicesEndPosition:x}=function(e,t,n){let r=n;const i=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;r%i!=0&&(r+=i-r%i);const o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=3*o,u=s(e.buffer,r,a,i);return r+=a*i,{triangleIndicesEndPosition:r,triangleIndices:u}}(d,p,m);if(n.maxDecodingStep<l)return{header:f,vertexData:p,triangleIndices:y};const{westIndices:v,southIndices:E,eastIndices:M,northIndices:_,edgeIndicesEndPosition:I}=function(e,t,n){let r=n;const i=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=s(e.buffer,r,o,i,!1);r+=o*i;const u=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const l=s(e.buffer,r,u,i,!1);r+=u*i;const c=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const h=s(e.buffer,r,c,i,!1);r+=c*i;const d=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const f=s(e.buffer,r,d,i,!1);return r+=d*i,{edgeIndicesEndPosition:r,westIndices:a,southIndices:l,eastIndices:h,northIndices:f}}(d,p,x);if(n.maxDecodingStep<c)return{header:f,vertexData:p,triangleIndices:y,westIndices:v,northIndices:_,eastIndices:M,southIndices:E};const{extensions:P}=function(e,t){const n={};if(e.byteLength<=t)return{extensions:n,extensionsEndPosition:t};let r=t;for(;r<e.byteLength;){const t=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;const s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=new DataView(e.buffer,r,s);switch(t){case 1:n.vertexNormals=(i=a,new Uint8Array(i.buffer,i.byteOffset,i.byteLength));break;case 2:n.waterMask=o(a);break;default:console.warn("Unknown extension with id "+t)}r+=s}var i;return{extensions:n,extensionsEndPosition:r}}(d,I);return{header:f,vertexData:p,triangleIndices:y,westIndices:v,northIndices:_,eastIndices:M,southIndices:E,extensions:P}}n.d(t,"QUANTIZED_MESH_TILE_DECODER_ID",(function(){return f})),n.d(t,"QuantizedMeshTileDecoder",(function(){return g}));const f="quantized-mesh-tile-decoder";class g{connect(){return Promise.resolve()}constructPositionArray(e){const t=e.length/3,n=new Float32Array(e.length);for(let r=0;r<t;r++)n[3*r]=e[r]/32767,n[3*r+1]=e[r+t]/32767,n[3*r+2]=e[r+2*t]/32767;return n}constructUvArray(e){return e.filter((e,t)=>t%3<2)}decodeTile(e){const t=d(e),n=this.constructPositionArray(t.vertexData),r=this.constructUvArray(n),i=[];i.push({name:"position",type:"float",buffer:n,itemCount:3,metadata:t.header},{name:"uv",type:"float",buffer:r,itemCount:2}),Object.keys(t.extensions).forEach(e=>{if("vertexNormals"===e&&t.extensions[e].byteLength>0){let n=new Uint8Array(t.extensions[e]);i.push({name:"octNormal",type:"float",buffer:n,itemCount:2})}});const s={techniques:[],geometries:[{index:{name:"index",type:"uint16",buffer:t.triangleIndices,itemCount:1},vertexAttributes:i}]};return Promise.resolve(s)}}},function(e,t,n){importScripts("three/build/three.js"),n(33)},function(e,t,n){const{WorkerServiceManager:r,TileDecoderService:i}=n(34),{QUANTIZED_MESH_TILE_DECODER_ID:s}=n(31),{QuantizedMeshTileDecoder:o}=n(31);r.getInstance().register({serviceType:s,factory:e=>i.start(e,new o)})},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(35)),r(n(62)),r(n(70)),r(n(12)),r(n(71))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(36);t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,n){return void 0===this.m_styleSetEvaluator?Promise.reject(new Error("No style is defined")):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,n)}getTileInfo(e,t,n){return Promise.resolve(void 0)}configure(e,t,n){void 0!==e&&(this.m_styleSetEvaluator=new r.StyleSetEvaluator(e)),void 0!==t&&(this.languages=t),void 0!==n&&void 0!==n.storageLevelOffset&&(this.m_storageLevelOffset=n.storageLevelOffset)}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(37)),r(n(60)),r(n(61)),r(n(19))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(19),s=n(20),o=n(29);t.logger=r.LoggerManager.instance.create("StyleSetEvaluator");function a(e){!function(e){for(let t=0;t<e.values.length;++t){e.zoomLevels.findIndex(n=>n===e.zoomLevels[t])!==t&&(e.zoomLevels.splice(--t,1),e.values.splice(--t,1))}}(e);const t=new Float32Array(e.zoomLevels);let n;switch(typeof e.values[0]){default:case"number":return n=new Float32Array(e.values),{interpolationMode:void 0!==e.interpolation?o.InterpolationMode[e.interpolation]:o.InterpolationMode.Discrete,zoomLevels:t,values:n};case"boolean":n=new Float32Array(e.values.length);for(let t=0;t<e.values.length;++t)n[t]=e.values[t]?1:0;return{interpolationMode:o.InterpolationMode.Discrete,zoomLevels:t,values:n};case"string":n=new Float32Array(3*e.values.length);for(let t=0;t<e.values.length;++t){const r=+e.values[t].replace("#","0x"),i=[(r>>16&255)/255,(r>>8&255)/255,(r>>0&255)/255];for(let r=0;r<3*e.values.length;++r)n[3*t+r]=i[r]}return{interpolationMode:void 0!==e.interpolation?o.InterpolationMode[e.interpolation]:o.InterpolationMode.Discrete,zoomLevels:t,values:n}}}t.StyleSetEvaluator=class{constructor(e){this.m_renderOrderBiasGroups=new Map,this.m_techniques=[];let n=0;const r=e=>Object.assign({},e,{styles:void 0!==e.styles?e.styles.map(e=>r(e)):void 0});this.styleSet=e.map(e=>r(e));const i=e=>{if(void 0!==e.renderOrderBiasGroup){const r=e.renderOrderBiasGroup?this.m_renderOrderBiasGroups.get(e.renderOrderBiasGroup):void 0;if(void 0!==e.renderOrderBiasRange&&void 0===r){void 0!==e.renderOrder&&t.logger.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e);const[r,i]=e.renderOrderBiasRange;e.renderOrder=r<0?n+Math.abs(r):n,n+=Math.abs(r)+i,e.renderOrderBiasGroup&&this.m_renderOrderBiasGroups.set(e.renderOrderBiasGroup,e.renderOrder),n++}else r&&(void 0!==e.renderOrder&&t.logger.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e),e.renderOrder=r)}if(void 0!==e.styles)for(const t of e.styles)i(t);else void 0!==e.technique&&void 0===e.renderOrder&&(e.renderOrder=n++)};for(const e of this.styleSet)i(e)}getMatchingTechniques(e){const t=[],n=new Array;for(const r of this.styleSet){if(0!==n.length)throw new Error("Internal error: style stack cleanup failed");if(this.processStyle(e,n,r,t))break}return t}addTechniqueToIndex(e){const t=this.m_techniques.length;return e._index=t,this.m_techniques.push(e),t}get techniques(){return this.m_techniques}cleanupStyle(e,t){return"styles"===e?"[...]":e.startsWith("_")?void 0:t}processStyle(e,n,r,s){if(void 0!==r.when&&(void 0===r._whenExpr&&(r._whenExpr=i.Expr.parse(r.when)),!r._whenExpr.evaluate(e)))return!1;if(void 0!==r.styles){r.debug&&t.logger.log("\n======== style group =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle group:",JSON.stringify(r,this.cleanupStyle,2)),n.push(r);for(const t of r.styles)if(this.processStyle(e,n,t,s))return n.pop(),!0;n.pop()}else if(void 0!==r.technique){if("none"!==r.technique)if(void 0===r._index){const i=this.createTechnique(r,n);s.push(i),r.debug&&t.logger.log("\n======== style w/ technique =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle:",JSON.stringify(r,this.cleanupStyle,2),"\ntechnique:",JSON.stringify(i,this.cleanupStyle,2))}else s.push(this.m_techniques[r._index]);return!0===r.final}return!1}createTechnique(e,t){const n={};n.name=e.technique;const r=e=>{void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.transient&&(n.transient=e.transient),void 0!==e.renderOrderBiasProperty&&(n.renderOrderBiasProperty=e.renderOrderBiasProperty),void 0!==e.labelProperty&&(n.label=e.labelProperty),void 0!==e.renderOrderBiasRange&&(n.renderOrderBiasRange=e.renderOrderBiasRange),void 0!==e.renderOrderBiasGroup&&(n.renderOrderBiasGroup=e.renderOrderBiasGroup),void 0!==e.secondaryRenderOrder&&(n.secondaryRenderOrder=e.secondaryRenderOrder),void 0!==e.attr&&Object.getOwnPropertyNames(e.attr).forEach(t=>{const r=e.attr[t];if(s.isInterpolatedPropertyDefinition(r))switch(typeof r.values[0]){default:case"number":case"boolean":case"string":n[t]=a(r)}else n[t]=r})};for(const e of t)r(e);return r(e),e._index=this.addTechniqueToIndex(n),n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new r(this.priority,this.elements.slice())}}t.PriorityListGroup=r;t.GroupedPriorityList=class{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.getGroup(e.priority);if(void 0!==t){const n=t.elements.indexOf(e);if(n>=0){if(t.elements.splice(n,1),0===t.elements.length){const t=Math.floor(e.priority);this.groups.delete(t)}return!0}}return!1}clear(){this.groups.clear()}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):this.groups.set(Math.floor(t[1].priority),t[1].clone())}return this}get sortedGroups(){const e=[];for(const t of this.groups)e.push(t[1]);return e.sort((e,t)=>t.priority-e.priority),e}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const n=Math.floor(e);t=new r(n),this.groups.set(n,t)}return t}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(16)),r(n(13)),r(n(17)),r(n(40)),r(n(42)),r(n(18))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(41);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(16),i=n(17),s=n(18);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new r.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t){const n=new i.Logger(e,this.channel,t);return this.m_loggers.push(n),n}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const n of this.m_loggers)n.name===e&&n.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const n of this.channels)n.error(e,...t)}debug(e,...t){for(const n of this.channels)n.debug(e,...t)}info(e,...t){for(const n of this.channels)n.info(e,...t)}log(e,...t){for(const n of this.channels)n.log(e,...t)}trace(e,...t){for(const n of this.channels)n.trace(e,...t)}warn(e,...t){for(const n of this.channels)n.warn(e,...t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n,r){return(e-n)*(e-n)+(t-r)*(t-r)}e.Box=class{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}set(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const n=e.length-4;for(let r=0;r<n;r+=3){const n=e[r+3]-e[r],i=e[r+4]-e[r+1];t+=n*n+i*i}return t},e.distToSegmentSquared=function(e,n,r,i,s,o){const a=t(r,i,s,o);if(0===a)return t(e,n,r,i);let u=((e-r)*(s-r)+(n-i)*(o-i))/a;return u=Math.max(0,Math.min(1,u)),t(e,n,r+u*(s-r),i+u*(o-i))}}(t.Math2D||(t.Math2D={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){return e<t?t:e>n?n:e}e.clamp=t,e.smoothStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,n,r){return(r=t((r-e)/(n-e),0,1))*r*r*(r*(6*r-15)+10)},e.lerp=function(e,t,n,r,i){return(e-t)*(i-r)/(n-t)+r},e.min2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.min(n,t)),n},e.max2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.max(n,t)),n},e.isClamped=function(e,t,n){return!(void 0!==t&&e<t)&&!(void 0!==n&&e>n)},e.easeInOutCubic=function(e,t,n){return e+(t-e)*(n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{e.prototype[n]=t.prototype[n]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{const r=Object.getOwnPropertyDescriptor(t.prototype,n);void 0!==r&&void 0===r.get&&(e.prototype[n]=t.prototype[n])})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.assert=function(e,t){0},t.assertExists=function(e,t){return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static now(){return r.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}r.instance=new r,r.nowFunc=r.getNowFunc(),t.PerformanceTimer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t},t.mergeWithOptions=function(e,t){const n=Object.assign({},e);if(null==t)return n;for(const r in e)if(e.hasOwnProperty(r)){const e=t[r];null!=e&&(n[r]=e)}return n}},function(e,t,n){"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultUrlResolver=function(e){return void 0!==r?r(e):e},t.setDefaultUrlResolver=function(e){r=e},t.composeUrlResolvers=function(...e){return t=>e.reduce((e,t)=>void 0!==t?t(e):e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUrl=function(e,t){if(r.test(t))return t;if(t.startsWith("/")){return s(e)+t}return t.startsWith("./")&&(t=t.substr(2)),i(e)+t};const r=new RegExp("^(?:[a-z]+:)?//","i");function i(e){if(void 0===e)return"./";const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}function s(e){if(void 0===e)return"";const t=o(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function o(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),n=e.match(t);if(!n)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:n[1],host:n[2]}}t.baseUrl=i,t.getUrlOrigin=s,t.getUrlHostAndProtocol=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=function(e,t){return function(...n){return e&&e.apply(this,n),t.apply(this,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(5),o=n(1),a=n(2),u=n(6),l=Math.PI/180;t.identityProjection=new class{constructor(){this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=o.MathUtils.newEmptyBox3()),n.min.x=-Math.PI,n.min.y=.5*-Math.PI,n.min.z=e,n.max.x=Math.PI,n.max.y=.5*Math.PI,n.max.z=t,n}projectPoint(e,t){return t||(t={x:0,y:0,z:0}),t.x=e.longitude*l,t.y=e.latitude*l,t.z=e.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(e.y,e.x,e.z)}projectBox(e,t){t||(t=o.MathUtils.newEmptyBox3());const n=this.projectPoint(new i.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new i.GeoCoordinates(e.north,e.east,e.maxAltitude));return s.isBox3Like(t)?(t.min.x=n.x,t.min.y=n.y,t.min.z=n.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):a.isOrientedBox3Like(t)&&(o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.x+r.x),t.position.y=.5*(n.y+r.y),t.position.z=.5*(n.z+r.z),t.extents.x=.5*(r.x-n.x),t.extents.y=.5*(r.y-n.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-n.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(5),s=n(1),o=n(2),a=n(8),u=n(6);function l(e){const t=1/Math.PI,n=Math.floor(2*(e*t+1));return s.MathUtils.clamp(n,0,4)}function c(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function h(e,t){const n=.5*(a.EarthConstants.EQUATORIAL_RADIUS+(e.maxAltitude||0)),r=s.MathUtils.degToRad(e.west),i=s.MathUtils.degToRad(e.east),o=l(r),u=l(i);let c=Math.cos(r),h=c,d=Math.sin(r),f=d;for(let e=o+1;e<=u;e++){const t=(e+1&1)*((2&e)-1);c=Math.min(t,c),h=Math.max(t,h);const n=(1&e)*((2&e)-1);d=Math.min(n,d),f=Math.max(n,f)}const g=Math.cos(i);c=Math.min(g,c),h=Math.max(g,h);const p=Math.sin(i);d=Math.min(p,d),f=Math.max(p,f);const m=(h+c)*n,y=(h-c)*n,x=(f+d)*n,v=(f-d)*n,E=s.MathUtils.degToRad(e.south),M=s.MathUtils.degToRad(e.north),_=Math.sin(M),I=Math.sin(E),P=(_+I)*n,w=(_-I)*n;return t.min.x=m-y,t.min.y=x-v,t.min.z=P-w,t.max.x=m+y,t.max.y=x+v,t.max.z=P+w,t}t.sphereProjection=new class{constructor(){this.type=u.ProjectionType.Spherical}worldExtent(e,t,n=s.MathUtils.newEmptyBox3()){const r=a.EarthConstants.EQUATORIAL_RADIUS+t;return n.min.x=-r,n.min.y=-r,n.min.z=-r,n.max.x=r,n.max.y=r,n.max.z=r,n}projectPoint(e,t=s.MathUtils.newVector3(0,0,0)){return function(e,t){const n=a.EarthConstants.EQUATORIAL_RADIUS+(e.altitude||0),r=s.MathUtils.degToRad(e.latitude),i=s.MathUtils.degToRad(e.longitude),o=Math.cos(r);return t.x=n*o*Math.cos(i),t.y=n*o*Math.sin(i),t.z=n*Math.sin(r),t}(e,t)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,n=Math.sqrt(t),i=e.z/n;if(isNaN(i))return r.GeoCoordinates.fromRadians(0,0,-a.EarthConstants.EQUATORIAL_RADIUS);const s=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(i),Math.atan2(e.y,e.x),s-a.EarthConstants.EQUATORIAL_RADIUS)}projectBox(e,t=s.MathUtils.newEmptyBox3()){if(i.isBox3Like(t))return h(e,t);if(o.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const n=h(e,s.MathUtils.newEmptyBox3());return s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.max.x+n.min.x),t.position.y=.5*(n.max.y+n.min.y),t.position.z=.5*(n.max.z+n.min.z),t.extents.x=.5*(n.max.x-n.min.x),t.extents.y=.5*(n.max.y-n.min.y),t.extents.z=.5*(n.max.z-n.min.z),t}const{south:n,west:r,north:i,east:o,center:u}=e,l=u.longitude,c=u.latitude,d=Math.cos(s.MathUtils.degToRad(n)),f=Math.sin(s.MathUtils.degToRad(n)),g=Math.cos(s.MathUtils.degToRad(r)),p=Math.sin(s.MathUtils.degToRad(r)),m=Math.cos(s.MathUtils.degToRad(i)),y=Math.sin(s.MathUtils.degToRad(i)),x=Math.cos(s.MathUtils.degToRad(o)),v=Math.sin(s.MathUtils.degToRad(o)),E=Math.cos(s.MathUtils.degToRad(l)),M=Math.sin(s.MathUtils.degToRad(l)),_=Math.cos(s.MathUtils.degToRad(c)),I=Math.sin(s.MathUtils.degToRad(c));let P,w,T;s.MathUtils.newVector3(E*_,M*_,I,t.zAxis),s.MathUtils.newVector3(-M,E,0,t.xAxis),s.MathUtils.newVector3(-E*I,-M*I,_,t.yAxis),n>=0?(P=Math.abs(d*(E*(p-v)+M*(x-g))),w=_*f-I*d,T=_*y-I*m*(E*x+M*v)):(i<=0?(P=Math.abs(m*(E*(p-v)+M*(x-g))),T=_*y-I*m):(P=Math.abs(E*(p-v)+M*(x-g)),T=_*y-I*m*(M*v+E*x)),w=_*f-I*d*(E*x+M*v));const S=.5*(a.EarthConstants.EQUATORIAL_RADIUS+(e.maxAltitude||0)),R=.5*(a.EarthConstants.EQUATORIAL_RADIUS+(e.minAltitude||0)),L=_*(E*x+M*v),b=Math.min(m*L+y*I,d*L+f*I);return s.MathUtils.newVector3(P*S,(T-w)*S,S-b*R,t.extents),s.MathUtils.newVector3(0,(w+T)*S,S+S,t.position),function(e,t,n,r){const i=e.x*r.x+t.x*r.y+n.x*r.z,s=e.y*r.x+t.y*r.y+n.y*r.z,o=e.z*r.x+t.z*r.y+n.z*r.z;r.x=i,r.y=s,r.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return c(e)-a.EarthConstants.EQUATORIAL_RADIUS}scalePointToSurface(e){const t=a.EarthConstants.EQUATORIAL_RADIUS/(c(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(r.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const n of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(n,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(21),i=n(24),s=n(10);t.hereTilingScheme=new s.TilingScheme(i.halfQuadTreeSubdivisionScheme,r.equirectangularProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(22),i=n(15),s=n(10);t.webMercatorTilingScheme=new s.TilingScheme(i.quadTreeSubdivisionScheme,r.webMercatorProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(14),i=n(15),s=n(10);t.mercatorTilingScheme=new s.TilingScheme(i.quadTreeSubdivisionScheme,r.mercatorProjection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addExtrudedWalls=function(e,t,n,r,i,s){const o=r.length/n;for(let n=0;n<o;++n){const r=t+2*n,a=r+1,u=t+(n+1)%o*2,l=u+1;(!1!==s||void 0===i||i[n])&&e.push(r,a,l,l,u,r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(28),i=new r.Vector2,s=new r.Vector2,o=new r.Vector2,a=new r.Vector2;t.addPolygonEdges=function(e,t,n,r,u,l,c,h){for(let d=0;d<u.length;++d)if(u[d])if(!0===l){const l=t+2*d,f=l+1,g=t+(d+1)%u.length*2,p=g+1;!0===c&&e.push(l,g),e.push(f,p);const m=(0===d?u.length:d)-1;if(u[m])if(void 0!==h){const t=r[d*n],c=r[d*n+1],g=r[(d+1)%u.length*n],p=r[(d+1)%u.length*n+1];i.set(t,c),s.set(g,p),o.set(r[m*n],r[m*n+1]),a.set(i.x,i.y),a.sub(o).normalize().dot(s.sub(i).normalize())<=h&&e.push(l,f)}else e.push(l,f)}else{const n=t+d,r=t+(d+1)%u.length;e.push(n,r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),i=n(7),s=n(3),o=n(12),a=s.LoggerManager.instance.create("TileDecoderService");class u extends o.WorkerService{constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}static start(e,t){return new u(e,t)}handleRequest(e){return r.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):r.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){r.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):a.error(`[${this.serviceId}]: invalid message ${e.type}`)}handleDecodeTileRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),n=r.getProjection(e.projection);return this.m_decoder.decodeTile(e.data,t,n).then(e=>{const t=[];return e.geometries.forEach(e=>{e.vertexAttributes.forEach(e=>{e.buffer instanceof ArrayBuffer&&t.push(e.buffer)}),e.index&&e.index.buffer instanceof ArrayBuffer&&t.push(e.index.buffer)}),e.techniques.forEach(e=>{r.addBuffersToTransferList(e,t)}),{response:e,transferList:t}})}handleTileInfoRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),n=r.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,n).then(e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}))}handleConfigurationMessage(e){this.m_decoder.configure(e.styleSet,e.languages,e.options)}}t.TileDecoderService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(30);function i(e){return"extruded-line"===e.name}function s(e){return i(e)&&"standard"===e.shading}function o(e){return"extruded-polygon"===e.name}function a(e){return"standard"===e.name}function u(e){return"terrain"===e.name}t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isDashedLineTechnique=function(e){return"dashed-line"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=i,t.isBasicExtrudedLineTechnique=function(e){return i(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=s,t.isFillTechnique=function(e){return"fill"===e.name},t.isExtrudedPolygonTechnique=o,t.isStandardTechnique=a,t.isTerrainTechnique=u,t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.needsVertexNormals=function(e){return a(e)||u(e)||s(e)},t.textureCoordinateType=function(e){return a(e)||o(e)||u(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,n=[]){if(a(e)||o(e)||u(e))for(const i of t.TEXTURE_PROPERTY_KEYS){const t=e[i];r.isTextureBuffer(t)&&n.push(t.buffer)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,n;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(n=e.Requests||(e.Requests={})),e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;!function(e){e.RegisterIndex="register-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,n;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(n=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===n.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===n.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return r.mercatorProjection;case"webMercator":return r.webMercatorProjection;case"sphere":return r.sphereProjection;default:throw new Error("Unknown projection "+e)}},t.getProjectionName=function(e){if(e===r.mercatorProjection)return"mercator";if(e===r.webMercatorProjection)return"webMercator";if(e===r.sphereProjection)return"sphere";throw new Error("Unknown projection")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);class i{constructor(e,t=5e3){this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}getNumBytes(){return 8*(this.featureIds.length+this.techniqueIndex.length+this.textIndex.length+this.positionIndex.length+this.positions.length+(void 0!==this.layerIndex?this.layerIndex.length:0)+(void 0!==this.classIndex?this.classIndex.length:0)+(void 0!==this.typeIndex?this.typeIndex.length:0))}}t.FeatureGroup=i;class s extends i{constructor(){super(...arguments),this.userData=[]}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.segmentIds?this.segmentIds.length:0)+(void 0!==this.segmentStartOffsets?this.segmentStartOffsets.length:0)+(void 0!==this.segmentEndOffsets?this.segmentEndOffsets.length:0))}}t.LineFeatureGroup=s;class o extends i{constructor(e,t=5e3){super(e,t),this.groupNumRings=0,this.outerRingStartIndex=new Array(t),this.outerRingStartIndex.length=t,this.innerRingIsOuterContour=new Array(t),this.innerRingIsOuterContour.length=t,this.innerRingStartIndex=new Array(t),this.innerRingStartIndex.length=t}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.outerRingStartIndex?this.outerRingStartIndex.length:0)+(void 0!==this.innerRingIsOuterContour?this.innerRingIsOuterContour.length:0)+(void 0!==this.innerRingStartIndex?this.innerRingStartIndex.length:0))}}t.PolygonFeatureGroup=o;class a{constructor(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.numBytes=0,this.pointGroup=new i(t),this.lineGroup=new s(t),this.polygonGroup=new o(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}getNumBytes(){let e=100;for(const t of this.textCatalog)e+=2*t.length;if(e+=100*this.techniqueCatalog.length,e+=this.pointGroup.getNumBytes(),e+=this.lineGroup.getNumBytes(),e+=this.polygonGroup.getNumBytes(),void 0!==this.layerCatalog){for(const t of this.layerCatalog)e+=2*t.length;for(const t of this.classCatalog)e+=2*t.length;for(const t of this.typeCatalog)e+=2*t.length}return e}}t.ExtendedTileInfo=a,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function n(e){return e.numPositions===e.positions.length}e.finish=function(e){var n,r;t(e.pointGroup),t(n=e.lineGroup),void 0!==n.segmentIds&&(n.segmentIds.length=n.numFeatures,n.segmentStartOffsets.length=n.numFeatures,n.segmentEndOffsets.length=n.numFeatures),t(r=e.polygonGroup),r.outerRingStartIndex.length=r.numFeatures,r.innerRingIsOuterContour.length=r.groupNumRings,r.innerRingStartIndex.length=r.groupNumRings,e.numBytes=e.getNumBytes()},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=n,e.tileInfoFinished=function(e){return n(e.pointGroup)&&n(e.lineGroup)&&n(e.polygonGroup)},e.getFeatureName=function(e,t,n,r){let i;if(t){const t=e.lookup("name:short");if("string"==typeof t&&t.length>0)return t}if(n){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==r)for(const t of r)if(i=e.lookup("name:"+t)||e.lookup("name_"+t),"string"==typeof i&&i.length>0)return i;if(i=e.lookup("name"),"string"==typeof i)return i}}(a=t.ExtendedTileInfo||(t.ExtendedTileInfo={}));t.ExtendedTileInfoWriter=class{constructor(e,t,n){this.tileInfo=e,this.storeExtendedTags=t,this.languages=n,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}addTechnique(e){let t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;t=this.tileInfo.techniqueCatalog.length;const n={};return Object.getOwnPropertyNames(e).forEach(t=>{t.startsWith("_")||(n[t]=e[t])}),n._index=e._index,this.techniqueIndexMap.set(e._index,t),this.tileInfo.techniqueCatalog.push(n),t}addFeature(e,t,n,i,s,o){const u=t,l=u.label,c=u.useAbbreviation,h=u.useIsoCode,d="string"==typeof l?n.lookup(l):a.getFeatureName(n,c,h,this.languages);let f=-1;if(d&&"string"==typeof d&&(f=this.addText(d)),e.featureIds[e.numFeatures]=i,e.techniqueIndex[e.numFeatures]=s,e.textIndex[e.numFeatures]=f,e.positionIndex[e.numFeatures]=e.numPositions,o){const t=e;r.assert(void 0!==t.outerRingStartIndex),r.assert(void 0!==t.innerRingStartIndex),r.assert(void 0!==t.innerRingIsOuterContour),t.outerRingStartIndex[e.numFeatures]=t.groupNumRings}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(n.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(n.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(n.lookup("type"))),e.numFeatures++}addFeaturePoint(e,t,n){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=n}addFeaturePoints(e,t){const n=e.numPositions,r=t.length,i=e.positions;for(let e=0;e<r;e++)i[n+e]=t[e];e.numPositions+=t.length}addRoadSegments(e,t,n,r){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=n,e.segmentEndOffsets[e.numFeatures-1]=r}addRingPoints(e,t,n){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=n?1:0,e.groupNumRings++;const r=e.numPositions,i=t.length,s=e.positions;for(let e=0;e<i;e++)s[r+e]=t[e];e.numPositions+=t.length}finish(){a.finish(this.tileInfo)}addText(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)}addLayer(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)}addClass(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)}addType(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)}addStringValue(e,t,n){if(void 0===e)return-1;const r=e.toString();let i=n.get(r);return void 0!==i||(i=t.length,t.push(r),n.set(r,i)),i}};class u{constructor(e){this.tileInfo=e}visitAll(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)}visitFeature(e,t){let n=0;const r=this.tileInfo.pointGroup.numFeatures,i=this.tileInfo.pointGroup.featureIds;for(let s=0;s<r;s++)i[s]===e&&(n++,this.visitPointFeature(s,t));const s=this.tileInfo.lineGroup.numFeatures,o=this.tileInfo.lineGroup.featureIds;for(let r=0;r<s;r++)o[r]===e&&(n++,this.visitLineFeature(r,t));const a=this.tileInfo.polygonGroup.numFeatures,u=this.tileInfo.polygonGroup.featureIds;for(let r=0;r<a;r++)u[r]===e&&(n++,this.visitPolygonFeature(r,t));return n}visitAllPointFeatures(e){const t=this.tileInfo.pointGroup.numFeatures;for(let n=0;n<t;n++)this.visitPointFeature(n,e)}visitAllLineFeatures(e){const t=this.tileInfo.lineGroup.numFeatures;for(let n=0;n<t;n++)this.visitLineFeature(n,e)}visitAllPolygonFeatures(e){const t=this.tileInfo.polygonGroup.numFeatures;for(let n=0;n<t;n++)this.visitPolygonFeature(n,e)}getTag(e,t){return void 0!==t&&t[e]>=0?t[e]:-1}visitPointFeature(e,t){const n=this.tileInfo.pointGroup,r=n.positionIndex[e],i=n.positions[r],s=n.positions[r+1];t.acceptPoint&&t.acceptPoint(n.featureIds[e],n.techniqueIndex[e],i,s,n.textIndex[e],this.getTag(e,n.layerIndex),this.getTag(e,n.classIndex),this.getTag(e,n.typeIndex))}visitLineFeature(e,t){const n=this.tileInfo,r=n.lineGroup,i=r.numFeatures,s=r.positionIndex[e],o=e===i-1?r.positions.length-s:r.positionIndex[e+1]-s;let a,u,l;void 0!==r.segmentIds&&(a=r.segmentIds[e],u=r.segmentStartOffsets[e],l=r.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(r.featureIds[e],r.techniqueIndex[e],r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex),n.lineGroup.positions,s,o,a,u,l)}visitPolygonFeature(e,t){if(void 0===t.acceptPolygon)return;const n=this.tileInfo.polygonGroup,r=n.numFeatures,i=n.outerRingStartIndex[e],s=e===r-1?n.innerRingStartIndex.length-i:n.outerRingStartIndex[e+1]-i;u.polygonAccessor.setup(n,e,i,s),t.acceptPolygon(n.featureIds[e],n.techniqueIndex[e],n.textIndex[e],this.getTag(e,n.layerIndex),this.getTag(e,n.classIndex),this.getTag(e,n.typeIndex),u.polygonAccessor),u.polygonAccessor.reset()}}u.polygonAccessor=new class{constructor(){this.featureIndex=0,this.ringStart=0,this.numRings=0}setup(e,t,n,r){this.polygons=e,this.featureIndex=t,this.ringStart=n,this.numRings=r}reset(){this.polygons=void 0,this.featureIndex=0,this.ringStart=0,this.numRings=0}isOuterRing(e){if(r.assert(e>=0),r.assert(e<this.numRings),r.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]}getPoints(e){if(r.assert(e>=0),r.assert(e<this.numRings),r.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");const t=this.polygons.innerRingStartIndex[this.ringStart+e];let n;return n=e<this.numRings-1||this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.polygons.positions.length-t,{points:this.polygons.positions,pointsStart:t,numPointValues:n}}},t.ExtendedTileInfoVisitor=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=n=>{if(e(n))return!0;if(void 0!==n.styles)for(const e of n.styles)if(t(e))return!0;return!1};if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const n of this.theme.styles[e])if(t(n))return!0;return!1}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(11),s=n(7),o=n(3),a=n(12),u=n(72),l=o.LoggerManager.instance.create("TilerService");class c extends a.WorkerService{constructor(e){super(e),this.serviceId=e,this.m_tileIndexMap=new Map}static start(e){return new c(e)}handleRequest(e){return i.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):i.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}handleTileRequest(e){return r(this,void 0,void 0,(function*(){const t=this.m_tileIndexMap.get(e.index);if(void 0===t)return{response:{}};const n=s.TileKey.fromMortonCode(e.tileKey);return{response:t.getTile(n.level,n.column,n.row)||{}}}))}handleRegisterIndexRequest(e){return r(this,void 0,void 0,(function*(){let t=this.m_tileIndexMap.get(e.id);if(void 0===t){let n=e.input;if("string"==typeof e.input){const t=yield fetch(e.input);if(!t.ok)return l.error(`${e.input} Status Text:  ${t.statusText}`),{response:{}};n=yield t.json()}t=u.default(n,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:0,lineMetrics:!1,promoteId:null,generateId:!1,debug:0}),this.m_tileIndexMap.set(e.id,t)}return{response:{}}}))}}t.TilerService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),i=n(12);class s extends i.WorkerService{constructor(e=r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}static getInstance(){return void 0===this.m_service&&(this.m_service=new s(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===r.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const n=t(e.targetServiceId);this.m_services.set(e.targetServiceId,n)}if(e.type===r.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=s},function(e,t,n){"use strict";function r(e,t,n,r,i,s){var o=i-n,a=s-r;if(0!==o||0!==a){var u=((e-n)*o+(t-r)*a)/(o*o+a*a);u>1?(n=i,r=s):u>0&&(n+=o*u,r+=a*u)}return(o=e-n)*o+(a=t-r)*a}function i(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)s(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)s(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)s(e,t[r][i])}(i),i}function s(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function o(e,t,n,r){if(t.geometry){var s=t.geometry.coordinates,c=t.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],f=t.id;if(n.promoteId?f=t.properties[n.promoteId]:n.generateId&&(f=r||0),"Point"===c)a(s,d);else if("MultiPoint"===c)for(var g=0;g<s.length;g++)a(s[g],d);else if("LineString"===c)u(s,d,h,!1);else if("MultiLineString"===c){if(n.lineMetrics){for(g=0;g<s.length;g++)d=[],u(s[g],d,h,!1),e.push(i(f,"LineString",d,t.properties));return}l(s,d,h,!1)}else if("Polygon"===c)l(s,d,h,!0);else{if("MultiPolygon"!==c){if("GeometryCollection"===c){for(g=0;g<t.geometry.geometries.length;g++)o(e,{id:f,geometry:t.geometry.geometries[g],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(g=0;g<s.length;g++){var p=[];l(s[g],p,h,!0),d.push(p)}}e.push(i(f,c,d,t.properties))}}function a(e,t){t.push(c(e[0])),t.push(h(e[1])),t.push(0)}function u(e,t,n,i){for(var s,o,a=0,u=0;u<e.length;u++){var l=c(e[u][0]),d=h(e[u][1]);t.push(l),t.push(d),t.push(0),u>0&&(a+=i?(s*d-l*o)/2:Math.sqrt(Math.pow(l-s,2)+Math.pow(d-o,2))),s=l,o=d}var f=t.length-3;t[2]=1,function e(t,n,i,s){for(var o,a=s,u=i-n>>1,l=i-n,c=t[n],h=t[n+1],d=t[i],f=t[i+1],g=n+3;g<i;g+=3){var p=r(t[g],t[g+1],c,h,d,f);if(p>a)o=g,a=p;else if(p===a){var m=Math.abs(g-u);m<l&&(o=g,l=m)}}a>s&&(o-n>3&&e(t,n,o,s),t[o+2]=a,i-o>3&&e(t,o,i,s))}(t,0,f,n),t[f+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function l(e,t,n,r){for(var i=0;i<e.length;i++){var s=[];u(e[i],s,n,r),t.push(s)}}function c(e){return e/360+.5}function h(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function d(e,t,n,r,s,o,a,u){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],d=h.geometry,p=h.type,y=0===s?h.minX:h.minY,x=0===s?h.maxX:h.maxY;if(y>=n&&x<r)l.push(h);else if(!(x<n||y>=r)){var v=[];if("Point"===p||"MultiPoint"===p)f(d,v,n,r,s);else if("LineString"===p)g(d,v,n,r,s,!1,u.lineMetrics);else if("MultiLineString"===p)m(d,v,n,r,s,!1);else if("Polygon"===p)m(d,v,n,r,s,!0);else if("MultiPolygon"===p)for(var E=0;E<d.length;E++){var M=[];m(d[E],M,n,r,s,!0),M.length&&v.push(M)}if(v.length){if(u.lineMetrics&&"LineString"===p){for(E=0;E<v.length;E++)l.push(i(h.id,p,v[E],h.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),l.push(i(h.id,p,v,h.tags))}}}return l.length?l:null}function f(e,t,n,r,i){for(var s=0;s<e.length;s+=3){var o=e[s+i];o>=n&&o<=r&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function g(e,t,n,r,i,s,o){for(var a,u,l=p(e),c=0===i?x:v,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],g=e[d+1],m=e[d+2],E=e[d+3],M=e[d+4],_=0===i?f:g,I=0===i?E:M,P=!1;o&&(a=Math.sqrt(Math.pow(f-E,2)+Math.pow(g-M,2))),_<n?I>n&&(u=c(l,f,g,E,M,n),o&&(l.start=h+a*u)):_>r?I<r&&(u=c(l,f,g,E,M,r),o&&(l.start=h+a*u)):y(l,f,g,m),I<n&&_>=n&&(u=c(l,f,g,E,M,n),P=!0),I>r&&_<=r&&(u=c(l,f,g,E,M,r),P=!0),!s&&P&&(o&&(l.end=h+a*u),t.push(l),l=p(e)),o&&(h+=a)}var w=e.length-3;f=e[w],g=e[w+1],m=e[w+2],(_=0===i?f:g)>=n&&_<=r&&y(l,f,g,m),w=l.length-3,s&&w>=3&&(l[w]!==l[0]||l[w+1]!==l[1])&&y(l,l[0],l[1],l[2]),l.length&&t.push(l)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function m(e,t,n,r,i,s){for(var o=0;o<e.length;o++)g(e[o],t,n,r,i,s,!1)}function y(e,t,n,r){e.push(t),e.push(n),e.push(r)}function x(e,t,n,r,i,s){var o=(s-t)/(r-t);return e.push(s),e.push(n+(i-n)*o),e.push(1),o}function v(e,t,n,r,i,s){var o=(s-n)/(i-n);return e.push(t+(r-t)*o),e.push(s),e.push(1),o}function E(e,t){for(var n=[],r=0;r<e.length;r++){var s,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)s=M(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){s=[];for(var u=0;u<o.geometry.length;u++)s.push(M(o.geometry[u],t))}else if("MultiPolygon"===a)for(s=[],u=0;u<o.geometry.length;u++){for(var l=[],c=0;c<o.geometry[u].length;c++)l.push(M(o.geometry[u][c],t));s.push(l)}n.push(i(o.id,a,s,o.tags))}return n}function M(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function _(e,t){if(e.transformed)return e;var n,r,i,s=1<<e.z,o=e.x,a=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(I(l[r],l[r+1],t,s,o,a));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(I(l[r][i],l[r][i+1],t,s,o,a));u.geometry.push(h)}}return e.transformed=!0,e}function I(e,t,n,r,i,s){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-s))]}function P(e,t,n,r,i){for(var s=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,w(o,e[a],s,i);var u=e[a].minX,l=e[a].minY,c=e[a].maxX,h=e[a].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function w(e,t,n,r){var i=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<i.length;a+=3)o.push(i[a]),o.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)T(o,i,e,n,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<i.length;a++)T(o,i[a],e,n,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var u=0;u<i.length;u++){var l=i[u];for(a=0;a<l.length;a++)T(o,l[a],e,n,!0,0===a)}if(o.length){var c=t.tags||null;if("LineString"===s&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:c};null!==t.id&&(d.id=t.id),e.features.push(d)}}function T(e,t,n,r,i,s){var o=r*r;if(r>0&&t.size<(i?o:r))n.numPoints+=t.length/3;else{for(var a=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>o)&&(n.numSimplified++,a.push(t[u]),a.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,s=i-2;r<i;s=r,r+=2)n+=(e[r]-e[s])*(e[r+1]+e[s+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],a=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=a}}(a,s),e.push(a)}}function S(e,t){return new R(e,t)}function R(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)o(n,e.features[r],t,r);else"Feature"===e.type?o(n,e,t):o(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=d(e,1,-1-n,n,0,-1,2,t),s=d(e,1,1-n,2+n,0,-1,2,t);return(i||s)&&(r=d(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=E(i,1).concat(r)),s&&(r=r.concat(E(s,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function L(e,t,n){return 32*((1<<e)*n+t)+e}n.r(t),n.d(t,"default",(function(){return S})),R.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},R.prototype.splitTile=function(e,t,n,r,i,s,o){for(var a=[e,t,n,r],u=this.options,l=u.debug;a.length;){r=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var c=1<<t,h=L(t,n,r),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=P(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var g="z"+t;this.stats[g]=(this.stats[g]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var p=1<<i-t;if(n!==Math.floor(s/p)||r!==Math.floor(o/p))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){l>1&&console.time("clipping");var m,y,x,v,E,M,_=.5*u.buffer/u.extent,I=.5-_,w=.5+_,T=1+_;m=y=x=v=null,E=d(e,c,n-_,n+w,0,f.minX,f.maxX,u),M=d(e,c,n+I,n+T,0,f.minX,f.maxX,u),e=null,E&&(m=d(E,c,r-_,r+w,1,f.minY,f.maxY,u),y=d(E,c,r+I,r+T,1,f.minY,f.maxY,u),E=null),M&&(x=d(M,c,r-_,r+w,1,f.minY,f.maxY,u),v=d(M,c,r+I,r+T,1,f.minY,f.maxY,u),M=null),l>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*n,2*r),a.push(y||[],t+1,2*n,2*r+1),a.push(x||[],t+1,2*n+1,2*r),a.push(v||[],t+1,2*n+1,2*r+1)}}},R.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,s=r.debug;if(e<0||e>24)return null;var o=1<<e,a=L(e,t=(t%o+o)%o,n);if(this.tiles[a])return _(this.tiles[a],i);s>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[L(l,c,h)];return u&&u.source?(s>1&&console.log("found parent tile z%d-%d-%d",l,c,h),s>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),s>1&&console.timeEnd("drilling down"),this.tiles[a]?_(this.tiles[a],i):null):null}}]);
//# sourceMappingURL=quantized-mesh-decoder.bundle.js.map