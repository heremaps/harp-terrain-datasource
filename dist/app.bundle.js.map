{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"THREE\"","webpack:///./node_modules/@here/harp-utils/index.js","webpack:///./node_modules/@here/harp-geoutils/index.js","webpack:///./node_modules/@here/harp-datasource-protocol/index.js","webpack:///./node_modules/@here/harp-materials/index.js","webpack:///./node_modules/@here/harp-geoutils/lib/coordinates/GeoCoordinates.js","webpack:///./node_modules/@here/harp-mapview/index.js","webpack:///./node_modules/@here/harp-geoutils/lib/math/MathUtils.js","webpack:///./node_modules/@here/harp-geoutils/lib/math/OrientedBox3Like.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/TextStyle.js","webpack:///./node_modules/@here/harp-mapview/lib/ColorCache.js","webpack:///./node_modules/@here/harp-mapview/lib/AnimatedExtrusionHandler.js","webpack:///./node_modules/@here/harp-geoutils/lib/coordinates/GeoBox.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/EarthConstants.js","webpack:///./node_modules/@here/harp-geoutils/lib/math/Box3Like.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/Projection.js","webpack:///./node_modules/@here/harp-mapview/lib/Utils.js","webpack:///./node_modules/@here/harp-text-canvas/index.js","webpack:///./node_modules/@here/harp-text-canvas/lib/utils/UnicodeUtils.js","webpack:///./node_modules/@here/harp-mapview/lib/text/TextStyleCache.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/TileKey.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/TilingScheme.js","webpack:///./node_modules/@here/harp-mapview/lib/text/TextElement.js","webpack:///./node_modules/@here/harp-mapview/lib/text/TextElementsRenderer.js","webpack:///./node_modules/@here/harp-mapview/lib/PickHandler.js","webpack:///./node_modules/@here/harp-mapview-decoder/index.js","webpack:///./node_modules/@here/harp-materials/lib/MapMeshMaterials.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/ILogger.js","webpack:///./node_modules/@here/harp-materials/lib/ShaderChunks/LinesChunks.js","webpack:///./node_modules/@here/harp-mapview/lib/MapView.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/MercatorProjection.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/QuadTreeSubdivisionScheme.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/GlyphData.js","webpack:///./node_modules/@here/harp-lrucache/index.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/TextGeometry.js","webpack:///./node_modules/@here/harp-text-canvas/lib/utils/TypesettingUtils.js","webpack:///./node_modules/@here/harp-mapview/lib/MapViewPoints.js","webpack:///./node_modules/@here/harp-mapview/lib/Statistics.js","webpack:///./node_modules/@here/harp-mapview/lib/composing/Pass.js","webpack:///./node_modules/@here/harp-fetch/index.web.js","webpack:///./node_modules/@here/harp-mapview/lib/CopyrightInfo.js","webpack:///./node_modules/rtree/lib/rectangle.js","webpack:///./node_modules/@here/harp-lines/lib/HighPrecisionUtils.js","webpack:///./node_modules/@here/harp-materials/lib/CopyMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/SolidLineMaterial.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/ConsoleChannel.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/Logger.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/WorkerChannel.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/EquirectangularProjection.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/WebMercatorProjection.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/FlatTileBoundingBoxGenerator.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/HalfQuadTreeSubdivisionScheme.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/SubTiles.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/TileKeyUtils.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/TileTreeTraverse.js","webpack:///./node_modules/@here/harp-mapview/lib/CameraMovementDetector.js","webpack:///./node_modules/@here/harp-mapview/lib/Tile.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/TechniqueParams.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/InterpolatedProperty.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/InterpolatedPropertyDefs.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/TextMaterials.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/TextBufferObject.js","webpack:///./node_modules/@here/harp-text-canvas/lib/utils/MaterialUtils.js","webpack:///./node_modules/@here/harp-mapview/lib/DecodedTileHelpers.js","webpack:///./node_modules/@here/harp-mapview/lib/ThemeHelpers.js","webpack:///./node_modules/@here/harp-mapview/lib/DepthPrePass.js","webpack:///./node_modules/@here/harp-mapview/lib/DebugContext.js","webpack:///./node_modules/@here/harp-mapview/lib/RoadPicker.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/Poi.js","webpack:///./node_modules/@here/harp-mapview/lib/composing/index.js","webpack:///./node_modules/@here/harp-mapview/lib/composing/MSAARenderPass.js","webpack:///./node_modules/@here/harp-mapview/lib/ConcurrentDecoderFacade.js","webpack:///./node_modules/@here/harp-mapview/lib/ConcurrentWorkerSet.js","webpack:///./node_modules/@here/harp-mapview/lib/WorkerBasedDecoder.js","webpack:///./node_modules/@here/harp-mapview/lib/image/MapViewImageCache.js","webpack:///./node_modules/@here/harp-mapview/lib/image/ImageCache.js","webpack:///./node_modules/@here/harp-mapview/lib/MapViewFog.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/PoiManager.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/PoiTableManager.js","webpack:///./node_modules/@here/harp-mapview/lib/ThemeLoader.js","webpack:///./node_modules/@here/harp-mapview/lib/VisibleTileSet.js","webpack:///./node_modules/@here/harp-mapview/lib/ElevationRangeSource.js","webpack:///./node_modules/@here/harp-mapview/lib/WorkerBasedTiler.js","webpack:///./node_modules/@here/harp-mapview/lib/TileGeometry.js","webpack:///./node_modules/@here/harp-lines/lib/TriangulateLines.js","webpack:///./node_modules/@here/harp-lines/lib/HighPrecisionLines.js","webpack:///./node_modules/@here/harp-map-controls/lib/MapControls.js","webpack:///./node_modules/@here/harp-map-controls/lib/Utils.js","webpack:///./node_modules/@here/harp-mapview-decoder/lib/TileLoader.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/Expr.js","webpack:///./node_modules/@here/harp-map-controls/index.js","webpack:///./node_modules/@here/harp-materials/lib/DashedLineMaterial.js","webpack:///./node_modules/@here/harp-utils/lib/GroupedPriorityList.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/index.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/LoggerManager.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/LoggerManagerImpl.js","webpack:///./node_modules/@here/harp-utils/lib/Logger/MultiChannel.js","webpack:///./node_modules/@here/harp-utils/lib/Math2D.js","webpack:///./node_modules/@here/harp-utils/lib/MathUtils.js","webpack:///./node_modules/@here/harp-utils/lib/Mixins.js","webpack:///./node_modules/@here/harp-utils/lib/assert.js","webpack:///./node_modules/@here/harp-utils/lib/PerformanceTimer.js","webpack:///./node_modules/@here/harp-utils/lib/OptionsUtils.js","webpack:///./node_modules/@here/harp-utils/lib/UrlResolver.js","webpack:///./node_modules/@here/harp-utils/lib/UrlUtils.js","webpack:///./node_modules/@here/harp-utils/lib/Functions.js","webpack:///./node_modules/@here/harp-materials/lib/Utils.js","webpack:///./node_modules/@here/harp-materials/lib/ShaderChunks/ExtrusionChunks.js","webpack:///./node_modules/@here/harp-materials/lib/ShaderChunks/FadingChunks.js","webpack:///./node_modules/@here/harp-materials/lib/EdgeMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/HighPrecisionLineMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/HighPrecisionPointMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/IconMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/CirclePointsMaterial.js","webpack:///./node_modules/@here/harp-materials/lib/MSAAMaterial.js","webpack:///./node_modules/@here/harp-geoutils/lib/coordinates/GeoCoordinatesLike.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/IdentityProjection.js","webpack:///./node_modules/@here/harp-geoutils/lib/projection/SphereProjection.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/QuadTree.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/HereTilingScheme.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/WebMercatorTilingScheme.js","webpack:///./node_modules/@here/harp-geoutils/lib/tiling/MercatorTilingScheme.js","webpack:///./node_modules/@here/harp-geoutils/lib/math/Vector3Like.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/Techniques.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/WorkerServiceProtocol.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/WorkerTilerProtocol.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/WorkerDecoderProtocol.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/DecodedTile.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/TileInfo.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/ThemeVisitor.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/FontCatalog.js","webpack:///./node_modules/@here/harp-text-canvas/lib/rendering/GlyphTextureCache.js","webpack:///./node_modules/@here/harp-lrucache/lib/LRUCache.js","webpack:///./node_modules/@here/harp-text-canvas/lib/TextCanvas.js","webpack:///./node_modules/@here/harp-text-canvas/lib/typesetting/LineTypesetter.js","webpack:///./node_modules/@here/harp-text-canvas/lib/typesetting/PathTypesetter.js","webpack:///./node_modules/@here/harp-text-canvas/lib/utils/ContextualArabicConverter.js","webpack:///./node_modules/@here/harp-mapview/lib/PickingRaycaster.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/PoiRenderer.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/BoxBuffer.js","webpack:///./node_modules/@here/harp-mapview/lib/poi/PixelPicker.js","webpack:///./node_modules/@here/harp-mapview/lib/text/SimplePath.js","webpack:///./node_modules/@here/harp-mapview/lib/composing/MapRenderingManager.js","webpack:///./node_modules/@here/harp-mapview/lib/composing/LowResRenderPass.js","webpack:///./node_modules/@here/harp-mapview/lib/workers/WorkerLoader.js","webpack:///./node_modules/@here/harp-mapview/lib/ScreenCollisions.js","webpack:///./node_modules/rtree/lib/index.js","webpack:///./node_modules/rtree/lib/rtree.js","webpack:///./node_modules/rtree/lib/geojson.js","webpack:///./node_modules/@here/harp-mapview/lib/ScreenProjector.js","webpack:///./node_modules/@here/harp-mapview/lib/SkyBackground.js","webpack:///./node_modules/@here/harp-mapview/lib/SkyGradientTexture.js","webpack:///./node_modules/@here/harp-mapview/lib/MapTileCuller.js","webpack:///./node_modules/@here/harp-mapview/lib/DataSource.js","webpack:///./node_modules/@here/harp-mapview/lib/image/Image.js","webpack:///./node_modules/@here/harp-mapview/lib/ConcurrentTilerFacade.js","webpack:///./node_modules/@here/harp-mapview/lib/TileDataAccessor.js","webpack:///./node_modules/@here/harp-lines/index.js","webpack:///./node_modules/@here/harp-lines/lib/Lines.js","webpack:///./node_modules/@here/harp-lines/lib/HighPrecisionPoints.js","webpack:///./node_modules/@here/harp-mapview/lib/CopyrightElementHandler.js","webpack:///./node_modules/@here/harp-map-controls/lib/MapControlsUI.js","webpack:///./node_modules/@here/harp-map-controls/lib/LongPressHandler.js","webpack:///./node_modules/@here/harp-map-controls/lib/MapAnimations.js","webpack:///./node_modules/@tweenjs/tween.js/src/Tween.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/@here/harp-mapview-decoder/lib/TileDataSource.js","webpack:///./node_modules/@here/harp-mapview-decoder/lib/ThemedTileDecoder.js","webpack:///./node_modules/@here/harp-datasource-protocol/index-decoder.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/StyleSetEvaluator.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/Extruder.js","webpack:///./node_modules/@here/harp-datasource-protocol/lib/Outliner.js","webpack:///./node_modules/dat.gui/build/dat.gui.module.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/shaders/vertex.glsl.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/shaders/fragment.glsl.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/elevation-styling.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/terrain-tile.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/terrain-data-provider.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/index.js","webpack:///./node_modules/@here/quantized-mesh-decoder/src/index.js","webpack:///./src/config.js","webpack:///./src/constants.js","webpack:///./src/get-tile-material.js","webpack:///./src/attribution-ui.js","webpack:///./src/app.js","webpack:///./node_modules/@here/harp-terrain-datasource/src/quantized-mesh/tile-decoder.js","webpack:///./src/fetch-cesium-tile.js","webpack:///./src/fetch-sample-tile.js"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","exports","THREE","__export","m","p","defineProperty","RAD2DEG","Math","PI","DEG2RAD","GeoCoordinates","latitude","longitude","altitude","this","isNaN","wrapped","other","MathUtils","normalizeAngleDeg","a","angleDistanceDeg","b","d","newEmptyBox3","min","x","Infinity","y","z","max","newVector3","v","undefined","degToRad","degrees","radToDeg","radians","clamp","interpolateAnglesDeg","p0","p1","t","isOrientedBox3Like","obb","position","xAxis","yAxis","zAxis","extents","FontUnit","FontStyle","FontVariant","VerticalAlignment","HorizontalAlignment","WrappingMode","DefaultTextStyle","DEFAULT_FONT_NAME","DEFAULT_FONT_SIZE","unit","freeze","Pixel","size","backgroundSize","DEFAULT_FONT_STYLE","Regular","DEFAULT_FONT_VARIANT","DEFAULT_ROTATION","DEFAULT_COLOR","Color","DEFAULT_OPACITY","DEFAULT_BACKGROUND_COLOR","DEFAULT_BACKGROUND_OPACITY","DEFAULT_TRACKING","DEFAULT_LEADING","DEFAULT_MAX_LINES","DEFAULT_LINE_WIDTH","DEFAULT_LINE_ROTATION","DEFAULT_WRAPPING_MODE","Word","DEFAULT_VERTICAL_ALIGNMENT","Above","DEFAULT_HORIZONTAL_ALIGNMENT","Left","TextRenderStyle","params","m_params","fontName","fontSize","fontStyle","fontVariant","rotation","color","opacity","backgroundColor","backgroundOpacity","assign","TextLayoutStyle","tracking","leading","maxLines","lineWidth","lineRotation","wrappingMode","verticalAlignment","horizontalAlignment","ColorCache","m_map","Map","m_instance","colorCode","set","clear","harp_materials_1","harp_utils_1","MapView_1","AnimatedExtrusionState","AnimatedExtrusionHandler","m_mapView","enabled","duration","forceEnabled","m_tileHandlerMap","m_zoomDirection","m_zoomLevelPrevious","zoomLevel","forEach","tileHandler","getDataSourceByName","tile","dataSource","name","zoomLevelChanged","m_forceAnimatedExtrusion","animatedExtrusion","m_forceAnimatedExtrusionDuration","extrusionDuration","delete","tileKeys","tileKey","mortonCode","AnimatedExtrusionTileHandler","m_tile","extrudedObjects","m_animatedExtrusionDuration","m_extrudedObjects","m_animatedExtrusionRatio","DEFAULT_RATIO_MAX","m_animatedExtrusionState","None","m_animatedExtrusionStartTime","animateExtrusion","event","Playing","Started","currentTime","Date","now","timeProgress","extrusionRatio","easeInOutCubic","DEFAULT_RATIO_MIN","Finished","stopExtrusionAnimation","requestUpdate","mapView","m_animatedExtrusionHandler","animatedExtrusionHandler","extrudedObject","materialFeature","ExtrusionFeature","addRenderHelper","push","startExtrusionAnimationIfNeeded","zoomDirection","material","removeTile","isVisible","result","childTileKeys","getTilingScheme","getSubTileKeys","concat","quadTreeSearchDistanceUp","quadTreeSearchDistanceDown","visibleTileSet","options","extrusionStartTime","nextLevelDiff","getChildTiles","find","level","parentTileKey","parent","startExtrusionAnimation","startTime","addEventListener","MapViewEventNames","AfterRender","removeEventListener","GeoCoordinates_1","GeoBox","southWest","northEast","south","north","west","east","minAltitude","altitudeSpan","latitudeSpan","longitudeSpan","maxAltitude","width","point","containsHelper","isFlat","isSameAltitude","isWithinAltitudeRange","EarthConstants","EQUATORIAL_CIRCUMFERENCE","EQUATORIAL_RADIUS","MIN_ELEVATION","MAX_ELEVATION","isBox3Like","box3","ProjectionType","geoUtils","EarthConstants_1","Tile_1","logger","LoggerManager","instance","create","MapViewUtils","groundPlane","Plane","Vector3","cameraZPosition","rotationMatrix","Matrix4","unprojectionMatrix","rayCaster","Raycaster","yawQuaternion","Quaternion","pitchQuaternion","yawAxis","pitchAxis","rayCastWorldCoordinates","pointOnScreenXinNDC","pointOnScreenYinNDC","pointInNDCPosition","worldPosition","worldCenter","copy","camera","extractRotation","matrixWorld","multiplyMatrices","getInverse","projectionMatrix","pointInCameraSpace","applyMatrix4","normalize","vec3","rayGroundPlaneIntersectionPosition","ray","intersectPlane","setX","setY","calculateDistanceToGroundFromZoomLevel","cameraPitch","extractYawPitchRoll","quaternion","pitch","tileSize","pow","focalLength","cos","pan","offsetX","offsetY","currentWorldPosition","update","q","ysqr","t0","w","t1","atan2","t2","roll","asin","t3","t4","yaw","estimateTextureSize","texture","objectSize","visitedObjects","image","uuid","imageBytes","height","heapSize","gpuSize","estimateMaterialSize","RawShaderMaterial","ShaderMaterial","rawMaterial","uniforms","uniform","Texture","MeshBasicMaterial","MapMeshBasicMaterial","meshMaterial","map","aoMap","specularMap","alphaMap","envMap","MapMeshStandardMaterial","standardMaterial","lightMap","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","LineBasicMaterial","LineDashedMaterial","warn","estimateAttributeSize","attribute","attrName","generateUUID","attrBytes","bytesPerElement","array","BYTES_PER_ELEMENT","InterleavedBufferAttribute","BufferAttribute","count","itemSize","getIsoLanguageCode","language","substring","zoomOnTargetPosition","targetPositionOnScreenXinNDC","targetPositionOnScreenYinNDC","targetPosition","setZ","matrixWorldNeedsUpdate","newTargetPosition","diff","sub","getCameraCoordinatesFromTargetCoordinates","targetCoordinates","zoom","yawDeg","pitchDeg","worldCameraHeight","pitchRad","worldTargetCameraDistance","tan","yawRad","worldTargetCoordinates","projection","projectPoint","cameraWorldCoordinates","sin","unprojectPoint","setRotation","setFromAxisAngle","multiply","rayCastGeoCoordinates","worldCoordinates","calculateZoomLevelFromDistance","distance","log2","minZoomLevel","maxZoomLevel","calculateDepthFromClipDistance","clipDistance","perspCam","cameraRange","far","near","viewSpaceDistance","cameraToWorldDistance","calculateVerticalFovByHorizontalFov","hFov","aspect","atan","calculateHorizontalFovByVerticalFov","vFov","calculateFocalLengthByVerticalFov","calculateFovByFocalLength","calculateScreenSizeByFocalLength","worldSize","calculateWorldSizeByFocalLength","screenSize","estimateObject3dSize","parentSize","isObject3D","Scene","isMesh","isLine","isPoints","mesh","Array","isArray","materials","geometry","bufferGeometry","Geometry","vertices","length","faces","_bufferGeometry","BufferGeometry","attributes","index","estimateGeometrySize","featureData","userData","feature","getFeatureDataSize","estimateMeshSize","children","child","getBrowserLanguages","navigator","languages","languageList","lang","powerOfTwo","TileOffsetUtils","getKeyForTileKeyAndOffset","offset","bitshift","shiftedOffset","offsetBits","totalOffsetsToStore","i","assert","getShiftedOffset","extractOffsetAndMortonKeyFromKey","num","getParentKeyFromKey","calculatedKey","TileKey","fromMortonCode","parentMortonCode","UnicodeUtils","Direction","whiteSpaceRanges","isWhiteSpace","codePoint","range","newLineRanges","isNewLine","nonPrintableRanges","isPrintable","rtlBlocks","neutralBidirectionalRanges","weakBidirectionalRanges","getDirection","block","weakRange","Weak","neutralRange","Neutral","element","RTL","LTR","rtlMirroredCodePoints","isRtlMirrored","harp_text_canvas_1","ColorCache_1","DEFAULT_TEXT_STYLE_CACHE_ID","computeStyleCacheId","datasourceName","technique","renderOrder","TextRenderStyleCache","getColor","id","TextLayoutStyleCache","Center","row","column","quadkey","mask","parseInt","charAt","fromRowColumnLevel","quadKey64","quadKey","m_mortonCode","quadkey64","m_hereTile","coordX","coordY","totalWidth","totalHeight","floor","rowsAtLevel","columnsAtLevel","Error","delta","changedLevelBy","toString","col","qnr","subQuad","fromQuadKey","fromHereTile","msb","FlatTileBoundingBoxGenerator_1","TileKeyUtils_1","TileTreeTraverse_1","TilingScheme","subdivisionScheme","boundingBoxGenerator","FlatTileBoundingBoxGenerator","tileTreeTraverse","TileTreeTraverse","subTiles","geoPoint","TileKeyUtils","geoCoordinatesToTileKey","geoBox","geoRectangleToTileKeys","getGeoBox","getWorldBox","harp_datasource_protocol_1","FadingState","LoadingState","DEFAULT_FADE_TIME","RenderState","state","Undefined","lastFrameNumber","Number","MIN_SAFE_INTEGER","fadingTime","FadingIn","FadingOut","FadedIn","FadedOut","TextElement","text","points","renderParams","layoutParams","priority","xOffset","yOffset","featureId","style","fadeNear","fadeFar","visible","distanceScale","sortPriority","renderStyle","layoutStyle","Vector2","mayOverlap","reserveSpace","m_poiInfo","isLineMarkerTechnique","alwaysOnTop","currentViewDistance","poiInfo","poiRenderOrder","min2","iconMinZoomLevel","textMinZoomLevel","max2","iconMaxZoomLevel","textMaxZoomLevel","DebugContext_1","PickHandler_1","PoiRenderer_1","SimplePath_1","TextElement_1","TextStyleCache_1","DEFAULT_TEXT_DISTANCE_SCALE","tempBox","Box2","tempBoxes","tempBox2D","Math2D","Box","tempPosition","tempPoiPosition","tempScreenPosition","tempPoiScreenPosition","TileTextElements","textElements","TextElementLists","textElementLists","n","list","TextElementsRenderer","m_screenCollisions","m_screenProjector","m_minNumGlyphs","m_maxNumGlyphs","m_theme","m_maxNumVisibleLabels","m_numSecondChanceLabels","m_maxDistanceRatioForLabels","m_labelStartScaleDistance","m_initializedTextElementCount","m_textRenderers","m_textStyles","m_defaultStyle","fontCatalog","textRenderStyleCache","textLayoutStyleCache","m_lastRenderedTextElements","m_secondChanceTextElements","m_tmpVector","m_overloaded","m_catalogsLoading","initializeDefaultAssets","initializeTextCanvases","debugGlyphs","debugContext","getValue","m_debugGlyphTextureCacheMesh","m_debugGlyphTextureCacheWireMesh","textRenderer","textCanvas","render","reset","poiRenderer","placeAllLabels","cameraIsMoving","animating","updatePending","time","frameNumber","renderList","dataSourceTileList","clone","add","renderListEntry","visibleTiles","textElement","userTextElements","tileCenterX","center","tileCenterY","updateViewDistance","renderTextElements","checkIfOverloaded","renderStartTime","overloaded","isDynamicFrame","PerformanceTimer","renderTileList","renderedTiles","allRenderableTextElements","renderOverlayTextElements","screenPosition","pickResults","pickHandler","pickData","pickObjectType","isDuplicate","some","pickResult","type","pickText","PickObjectType","Text","pickTextElements","Icon","styleId","isLoading","iconRenderState","textRenderState","textElementGroups","memoryUsage","renderer","getMemoryUsage","fontCatalogs","url","defaultFontCatalog","defaultFontCatalogName","textStyles","styles","themedDefaultStyle","createTextElementStyle","defaultTextStyle","styleName","getOptionValue","fontCatalogName","smallCaps","SmallCaps","allCaps","AllCaps","bold","oblique","BoldItalic","Bold","Italic","backgroundAlpha","promises","fontCatalogConfig","fontCatalogPromise","FontCatalog","load","then","loadedFontCatalog","loadedTextCanvas","TextCanvas","minGlyphCount","maxGlyphCount","PoiRenderer","catch","error","Promise","all","initializeTextElementStyles","planeGeometry","PlaneGeometry","textureSize","maxWidth","maxHeight","transparent","depthWrite","depthTest","Mesh","wireframe","WireframeGeometry","wireframeMaterial","LineSegments","getLayer","DEFAULT_TEXT_CANVAS_LAYER","storage","scene","defaultTextCanvas","defaultPoiRenderer","styledTextRenderer","viewDistance","pos","position3","distanceTo","posPoint","pathPoints","viewDistance0","viewDistance1","maxViewDistance","indexPriorityFactor","sort","placementStartTime","tileList","placeTextElements","storageLevel","tileDataSource","sortedTiles","prepareUserTextElements","sortedGroups","createSortedGroupsForSorting","numTextElementsPlaced","selectTextElementsToPlaceByDistance","tilesToRender","placedTextElements","shouldRenderText","groupedPriorityLists","group","groups","values","elements","foundGroup","g","lists","farDistanceLimitRatio","maxDistance","getMaxDistance","tileTextElements","worldOffsetX","worldExtent","poiTableName","poiManager","updatePoiFromPoiTable","isClamped","textDistance","getSize","screenXOrigin","screenYOrigin","tempAdditionParams","tempBufferAdditionParams","textElementStyle","getTextElementStyle","layer","isPathLabel","path","isLineMarker","loadingState","Requested","Loaded","loadCharset","textRenderStyle","textLayoutStyle","glyphCaseArray","glyphs","getGlyphs","Initialized","drawCount","capacity","textPath","screenPoints","pt","pX","pY","SimplePath","LineCurve","pathOverflow","letterCaseArray","addText","label","cameraFar","distanceFadeValue","renderedTextElements","secondChanceTextElements","currentlyRenderingPlacedElements","maxNumRenderedLabels","numSecondChanceLabels","labelStartScaleDistance","numRenderedTextElements","shieldGroups","textMaxDistance","poiTextMaxDistance","fadeAnimationRunning","tempPoiMeasurementParams","tempMeasurementParams","screenPointsResult","checkForSmallLabels","dbgPathTooSmall","numPathTooSmall","bounds","measureText","addPointLabel","pointLabel","textScale","startScaleDistance","distanceFadeFactor","getDistanceFadingFactor","iconSpaceAvailable","renderIcon","prepareRender","isValid","computeScreenBox","isSpaceAvailable","isFadingOut","isFadedOut","startFadeIn","startFadeOut","isFading","updateFading","ignoreDistance","iconIsOptional","renderDistance","h","textIsOptional","textIsFadingIn","isFadingIn","textIsFadingOut","textSpaceAvailable","isAllocated","textMayOverlap","textBufferObject","createTextBufferObject","textReservesSpace","allocate","renderTextDuringMovements","textFading","checkStartFadeIn","scale","addTextBufferObject","numRenderedPoiTexts","iconStartedFadeOut","checkStartFadeOut","poiIsRenderable","iconStartedFadeIn","renderPoi","addPoiLabel","poiLabel","project","fadingDisabled","addLineMarkerLabel","lineMarkerLabel","shieldGroup","shieldGroupIndex","iconRenderStates","renderStates","renderState","lineTechnique","minDistanceSqr","minDistance","tooClose","j","distSquared","addPathLabel","pathLabel","Path","SimpleLineCurve","getPoint","textRenderDistance","prevSize","outputCharacterBounds","charBounds","startedFadeIn","prevOpacity","prevBgOpacity","indexOfFirstVisibleScreenPoint","minX","MAX_SAFE_INTEGER","maxX","minY","maxY","screenPoint","projectInPlace","firstIndex","findIndex","p2","screenBounds","contains","minScreenSpace","consideredTextElements","GroupedPriorityList","merge","maxNumRenderedTextElements","elementGroup","textElementsInGroup","sortTextElements","numTextElementsInScene","forceFadeIn","fadeAnimationStarted","forceFadeOut","startValue","endValue","smootherStep","MapViewPoints_1","PickingRaycaster_1","RoadPicker_1","PickHandler","enableRoadPicking","m_plane","m_rayCaster","PickingRaycaster","m_roadPicker","RoadPicker","registerTile","worldPos","getNormalizedScreenCoordinates","textElementsRenderer","clientWidth","clientHeight","canvas","screenX","pixelRatio","screenY","scenePosition","setFromCamera","intersects","intersectObjects","worldRootObject","intersect","Unspecified","intersection","addObjInfo","ids","geometryType","GeometryType","Point","Line","ExtrudedLine","SolidLine","TextPath","Polygon","ExtrudedPolygon","Area","Object3D","planeIntersectPosition","cameraPos","forEachVisibleTile","intersectRoads","MapViewPoints","objInfos","starts","faceIndex","objInfosIndex","polygonStartFace","AnimatedExtrusionHandler_1","Utils_1","ExtrusionChunks_1","FadingChunks_1","FadingFeature","DEFAULT_FADE_NEAR","DEFAULT_FADE_FAR","patchGlobalShaderChunks","ShaderChunk","fading_pars_vertex","default","updateDistanceFadeFeature","fadingMaterial","needsUpdate","defines","FADING_MATERIAL","onBeforeCompile","shader","vertexShader","insertShaderInclude","fragmentShader","forceMaterialToTransparent","updateUniforms","additionalCallback","onBeforeRender","chainCallbacks","properties","uniformsNeedUpdate","onAfterRender","geom","FadingFeatureMixin","m_fadeNear","m_fadeFar","getFadeNear","val","setFadeNear","getFadeFar","setFadeFar","source","extrusion_pars_vertex","updateExtrusionFeature","extrusionMaterial","EXTRUSION_MATERIAL","ExtrusionFeatureMixin","m_extrusion","getExtrusionRatio","setExtrusionRatio","super","addFadingProperties","applyFadingParameters","addExtrusionProperties","applyExtrusionParameters","copyFadingParameters","copyExtrusionParameters","MeshStandardMaterial","applyMixinsWithoutProperties","LogLevel","LoggerOptions","extrude_line_vert_func","join_dist_func","tile_clip_func","high_precision_vert_func","harp_geoutils_1","CameraMovementDetector_1","composing_1","ConcurrentDecoderFacade_1","CopyrightInfo_1","MapViewImageCache_1","MapViewFog_1","PoiManager_1","PoiTableManager_1","ScreenCollisions_1","ScreenProjector_1","SkyBackground_1","Statistics_1","TextElementsRenderer_1","ThemeHelpers_1","ThemeLoader_1","VisibleTileSet_1","EYE_INVERSE","DEFAULT_FOV_CALCULATION","fov","RENDER_EVENT","Render","DID_RENDER_EVENT","FIRST_FRAME_EVENT","FirstFrame","FRAME_COMPLETE_EVENT","FrameComplete","THEME_LOADED_EVENT","ThemeLoaded","ANIMATION_STARTED_EVENT","AnimationStarted","ANIMATION_FINISHED_EVENT","AnimationFinished","MOVEMENT_STARTED_EVENT","MovementStarted","MOVEMENT_FINISHED_EVENT","MovementFinished","CONTEXT_LOST_EVENT","ContextLost","CONTEXT_RESTORED_EVENT","ContextRestored","COPYRIGHT_CHANGED_EVENT","CopyrightChanged","tmpVector","MapViewDefaults","mercatorProjection","maxVisibleDataSourceTiles","extendedFrustumCulling","tileCacheSize","resourceComputationType","ResourceComputationType","EstimationInMb","window","devicePixelRatio","MapView","EventDispatcher","ScreenProjector","ScreenCollisions","m_visibleTileSetLock","m_zoomLevel","m_minZoomLevel","m_maxZoomLevel","m_minCameraHeight","m_screenCamera","OrthographicCamera","m_tempVector3","m_scene","m_fog","MapViewFog","m_worldCenter","m_mapTilesRoot","m_animationCount","m_drawing","m_updatePending","m_frameNumber","m_maxFps","m_detectedFps","m_textRenderStyleCache","m_textLayoutStyleCache","m_overlayTextElements","m_forceCameraAspect","m_tileDataSources","m_connectedDataSources","Set","m_raycaster","m_firstFrameRendered","m_firstFrameComplete","m_frameTimeIndex","m_frameTimeRing","m_imageCache","MapViewImageCache","m_poiManager","PoiManager","m_poiTableManager","PoiTableManager","m_lastTileIds","m_copyrightInfo","onWebGLContextLost","dispatchEvent","log","onWebGLContextRestored","clearColor","m_renderer","setClearColor","m_options","minCameraHeight","decoderUrl","ConcurrentDecoderFacade","defaultScriptUrl","decoderCount","defaultWorkerCount","m_visibleTileSetOptions","m_pixelRatio","maxFps","enableStatistics","m_languages","handleRequestAnimationFrame","renderFunc","handlePostponedAnimationFrame","postponedAnimationFrame","m_pickHandler","setupStats","WebGLRenderer","antialias","enableNativeWebglAntialias","alpha","preserveDrawingBuffer","autoClear","info","autoReset","setupRenderer","fovCalculation","getCanvasClientSize","m_camera","PerspectiveCamera","m_lookAtDistance","m_focalLength","setupCamera","m_movementDetector","CameraMovementDetector","movementThrottleTimeout","movementStarted","movementFinished","mapPassAntialiasSettings","customAntialiasSettings","mapRenderingManager","MapRenderingManager","dynamicPixelRatio","m_visibleTiles","VisibleTileSet","initTheme","drawFrame","m_textElementsRenderer","m_animationFrameHandle","cancelAnimationFrame","dispose","clearTileCache","getDataSourceCacheSize","numVisibleTiles","setDataSourceCacheSize","setNumberOfVisibleTiles","updateImages","updateLighting","updateTextRenderer","updateSkyBackground","m_pointOfView","pointOfView","theme","fog","sky","lights","images","imageTextures","poiTables","loadPoiTables","styleSetName","styleSet","getDataSourcesByStyleSetName","ds","setStyleSet","fps","setLanguages","disableFading","listener","m_collisionDebugCanvas","rendererClearColor","getClearColor","getHex","geoCenter","calculateFocalLength","updateCameras","dataSourceName","filter","attach","connect","resolve","resolveOnce","indexOf","Update","DataSourceConnect","dsIndex","detach","removeDataSource","splice","geoPos","m_pixelToWorld","lookAtDistance","pixelToWorld","getPixelRatio","setPixelRatio","ratio","lowResPixelRatio","getWorldPositionAt","intersectMapObjects","setSize","collisionDebugCanvas","fun","visitor","forEachCachedTile","markTilesDirty","setFovOnCamera","nearPlane","farPlane","farPlaneEvaluator","getWorldDirection","angle","angleTo","nearFarPlane","updateProjectionMatrix","updateMatrixWorld","left","right","bottom","top","cameraPosZ","abs","zoomLevelDistance","m_previousRequestAnimationTime","currentFps","capturedFrames","sum","requestAnimationFrame","vSyncFrameTime","frameInterval","previousFrameTime","m_previousFrameTimeStamp","targetTime","m_targetRequestAnimationTime","detectCurrentFps","enabledDataSources","ready","has","stats","PerformanceStatistics","gatherStatistics","frameStartTime","currentFrameEvent","setupTime","cullTime","textPlacementTime","drawTime","textDrawTime","endTime","currentFrame","setValue","timeSincePreviousFrame","m_thisFrameTilesChanged","remove","lockVisibleTileSet","updateRenderList","getEnabledTileDataSources","renderTileObjects","frameNumLastVisible","addValue","numTilesLoading","checkCameraMoved","prepareRenderTextElements","m_skyBackground","finishRenderTextElements","appResults","allVisibleTilesLoaded","loading","disposePendingTiles","checkCopyrightUpdates","storeFrameInfo","willRender","objects","displacement","didRender","debugCameraActive","shouldDrawText","checkIfTextElementsChanged","checkIfTilesChanged","placeAllTileLabels","labelVisibilityEvaluator","maxLabelAngle","renderUserTextElements","renderAllTileText","renderOverlay","renderText","ThemeLoader","loadAsync","lookAt","resize","SkyBackground","updateSkyBackgroundColors","addNewSkyBackground","removeSkyBackGround","skyBackground","groundColor","colorTop","colorBottom","monomialPower","background","updateColors","m_createdLights","light","lightDescription","createLight","setTimeout","textElementsChanged","tileIdList","newTileIds","join","newCopyrightInfo","getRenderedTilesCopyrightInfo","allEqual","tileCopyrightInfo","copyrightInfo","CopyrightInfo","mergeArrays","keys","addImage","preload","atlas","addTextureAtlas","imageTexture","addImageTexture","poiTableManager","enable","minNumGlyphs","maxNumGlyphs","maxNumVisibleLabels","maxDistanceRatioForLabels","limitFov","round","GeoBox_1","Box3Like_1","MathUtils_1","OrientedBox3Like_1","Projection_1","MercatorProjection","Planar","MAXIMUM_LATITUDE","latitudeProject","latitudeClamp","exp","worldPoint","cosh","geoPointLike","latitudeClampProject","latitudeInRadians","fromRadians","unprojectLatitude","worldNorth","worldSouth","worldYCenter","EPSILON","worldBox","minGeo","maxGeo","fromCoordinates","quadTreeSubdivisionScheme","UnicodeUtils_1","GlyphData","advanceX","u0","v0","u1","v1","font","positions","sourceTextureCoordinates","dynamicTextureCoordinates","copyIndex","isInCache","character","String","fromCodePoint","direction","metrics","lineHeight","MAX_CAPACITY","VERTEX_BUFFER_STRIDE","INDEX_BUFFER_STRIDE","VERTICES_PER_QUAD","INDICES_PER_QUAD","QUAD_VERTEX_MEMORY_FOOTPRINT","QUAD_INDEX_MEMORY_FOOTPRINT","TextGeometry","backgroundMaterial","initialSize","m_currentCapacity","m_drawCount","m_updateOffset","m_pickingCount","m_vertexBuffer","InterleavedBuffer","Float32Array","setDynamic","m_positionAttribute","m_uvAttribute","m_colorAttribute","m_bgColorAttribute","m_indexBuffer","Uint32Array","m_geometry","addAttribute","setIndex","m_pickingDataArray","m_mesh","m_bgMesh","updateRange","setDrawRange","glyphData","corners","weight","bgWeight","mirrored","newSize","resizeBuffers","baseVertex","baseIndex","setXYZW","mirroredUVIdx","r","buffer","vertexOffset","bgColor","bgOpacity","s","cosR","sinR","offsetZ","rotSign","red","green","blue","bgRed","bgGreen","bgBlue","bgAlpha","targetOffset","srcOffset","glyph","bw","startIdx","endIdx","pickingData","start","end","data","pickCallback","positionIndex","getX","getY","numBytes","newVertexBuffer","newIndexBuffer","TextStyle_1","TypesettingUtils","EM_TO_PX","PT_TO_PX","OBLIQUE_ANGLE","OBLIQUE_OFFSET","getPixelSize","originalSize","Em","Percent","getSmallCapsScale","smallCapsTransformations","xHeight","capHeight","computeGlyphTransform","transform","localRotation","cosAngle","sinAngle","localCosAngle","localSinAngle","updateBounds","globalBounds","individualBounds","Points","arguments","enableRayTesting","raycaster","screenCoords","origin","mouseCoords","ceil","indices","il","fromArray","pointInfo","getPointInfo","pointIsOnScreen","testPoint","absoluteScreenPosition","l","relativeScreenPosition","Circles","pickCoordinates","dx","dy","sqrt","Squares","halfSize","RingBuffer","head","tail","next","enqOne","previous","Iterator","m_buffer","m_index","SimpleTimer","statistics","running","m_currentValue","SampledTimer","numResets","maxNumSamples","samples","getStats","computeArrayStats","asArray","median","median90","median95","median97","median99","median999","mid","avg","numSamples","MultiStageTimer","stages","stage","hasTimer","getTimer","currentStage","stop","Statistics","timers","nullTimer","keepSamples","timer","addTimer","header","footer","maxNameLength","print","toFixed","repeat","simpleStats","FrameStats","entries","messages","oldValue","message","FrameStatsArray","frameEntries","frameStats","currentSize","enq","maxNumFrames","configs","m_frameEvents","clearFrames","webGlInfo","calls","memory","geometries","lines","programs","textures","triangles","performance","totalJSHeapSize","usedJSHeapSize","jsHeapSizeLimit","addFrame","frames","plainObject","Pass","renderToScreen","writeBuffer","readBuffer","sourceInfo","existingInfo","findItem","year","link","formatAsHtml","filtered","entry","Rectangle","x2","y2","x1","y1","overlap","expand","nx","ny","ax","ay","ax2","ay2","overlapRectangle","containsRectangle","expandRectangle","axw","bxw","ayh","byh","makeMBR","nodes","rect","len","squarifiedRatio","fill","lperi","larea","three_1","HPL","HPP","TriangulateLines_1","HighPrecisionUtils","doubleToFloatVec","fround","createHighPrecisionCameraPos","objectInverseWorldMatrix","mvp","matrixWorldInverse","eyePos","eyePosFloat","viewProjection","eyePosHi","eyePosLo","createAttributes","positionVec","positionVecLow","addHPValue","major","addHPVector","vec","positionHigh","Float32BufferAttribute","positionLow","addInterleavedAttributes3","stride","positionOffset","newPositions","majorX","minorX","majorY","minorY","majorZ","minorZ","setPositions","makeFloatVec","minorVec","updateHpUniforms","shaderMaterial","highPrecisionCameraInfo","isMaterial","u_mvp","u_eyepos","u_eyepos_lowpart","toArray","convertPositions","vAny","returnPositions","createLine","linePositions","addCircles","wireFrame","triangulateLine","hpLineGeometry","hpPositions","positionAttribute","positionLowAttribute","hpSolidMaterial","HighPrecisionLineMaterial","lineObject","HighPrecisionWireFrameLine","HighPrecisionLine","setupForRendering","createPoints","pointPositions","materialParameters","hpPointsGeometry","hpPointsMaterial","isHighPrecisionPointMaterial","HighPrecisionPointMaterial","pointsObject","HighPrecisionPoints","CopyShader","tDiffuse","CopyMaterial","premultipliedAlpha","blending","NoBlending","MapMeshMaterials_1","LinesChunks_1","SolidLineMaterial","DASHED_LINE","TILE_CLIP","hasFog","USE_FOG","UniformsUtils","diffuse","Uniform","DEFAULT_WIDTH","UniformsLib","extensions","derivatives","enableFog","USE_FADING","ConsoleChannel","optionalParams","console","debug","trace","ILogger_1","Logger","m_channel","Trace","prefix","Debug","Info","Log","Warn","WORKERCHANNEL_MSG_TYPE","WorkerChannel","workerMessage","self","postMessage","EquirectangularProjection","_worldPoint","geoToWorldScale","worldToGeoScale","latitudeSpanInRadians","longitudeSpanInRadians","sizeX","sizeY","equirectangularProjection","MercatorProjection_1","WebMercatorProjection","sy","projectBox","webMercatorProjection","tilingScheme","minElevation","maxElevation","m_tilingScheme","m_worldBox","m_worldDimensions","levelDimensionX","getLevelDimensionX","levelDimensionY","getLevelDimensionY","originX","originY","unprojectBox","halfQuadTreeSubdivisionScheme","TileKey_1","SubTiles","m_tileKey","m_level","m_count","m_mask","m_shift","m_parent","skip","parentKey","subLevel","cx","cy","worldSizeX","worldSizeY","wrap","lower","upper","minVal","maxVal","southWestLongitude","longitudeInRadians","southWestLatitude","northEastLongitude","northEastLatitude","minTileKey","maxTileKey","columnCount","minColumn","maxColumn","minRow","maxRow","SubTiles_1","m_subdivisionScheme","subTileMask","getSubdivisionX","getSubdivisionY","it","iterator","m_throttlingTimeout","m_movementStartedFunc","m_movementFinishedFunc","m_lastCameraPos","m_newCameraPos","m_lastWorldCenter","m_throttlingTimerId","m_movementDetectorDeadline","onDeadlineTimer","startMovementFinishedTimer","newYawPitchRoll","newCameraPos","getWorldPosition","cameraMoved","m_lastYawPitchRoll","equals","m_cameraMovedLastFrame","NaN","removeMovementFinishedTimer","remainingTime","clearTimeout","DecodedTileHelpers_1","DepthPrePass_1","defaultEmptyDecodedTile","techniques","TileLoaderState","Tile","dependencies","boundingBox","Box3","frameNumLastRequested","frameNumVisible","numFramesVisible","m_disposed","m_forceHasGeometry","m_preparedTextPaths","m_userTextElements","m_textElementGroups","m_placedTextElements","m_textElementsChanged","m_colorMap","m_visibleArea","m_ownedTextures","WeakSet","getCenter","m_resourceInfo","computeResourceInfo","foundIndex","changed","m_decodedTile","decodedTile","tileInfo","roadIntersectionData","addTileBackground","addGroundPlane","disposeTile","addMessage","createGeometries","geometryCreationTime","poiGeometries","textGeometries","textPathGeometries","_zoomLevel","area","tileLoader","updatePriority","preparePois","createTextElements","createObjects","countVertices","invalidateResourceInfo","decodeTime","setDecodedTile","m_tileLoader","updateTile","disposeMaterial","getOwnPropertyNames","materialProperty","shouldDisposeTexture","disposeObject","shouldDisposeObjectGeometry","shouldDisposeObjectMaterial","rootObject","traverse","m_animatedExtrusionTileHandler","cancel","processedPaths","MAX_CORNER_ANGLE","newPaths","slice","previousTangent","pop","splitIndex","tangent","theta","dot","firstTextPath","pathLengthSqr","secondTextPath","displayZoomLevel","prepareTextPaths","maxPathLengthSqr","preparedTextPaths","isTextTechnique","getPropertyValue","ContextualArabicConverter","convert","getRenderStyle","getLayoutStyle","addTextElement","stringCatalog","itemCount","numPositions","texts","planeCenter","colorHex","plane","srcGeometry","groupCount","groupIndex","techniqueIndex","ObjectCtor","getObjectConstructor","onMaterialUpdated","addOwnedTexture","createMaterial","isTerrainTechnique","heightBasedColors","replace","vertexAttributes","vertexAttribute","getBufferAttribute","interleavedVertexAttributes","attr","ArrayCtor","getArrayConstructor","interleavedAttr","getAttribute","needsVertexNormals","computeVertexNormals","addGroup","isSolidLineTechnique","isDashedLineTechnique","lineMaterial","clipping","hasExtrudedOutlines","isExtrudedPolygonTechnique","edgeIndex","hasFillOutlines","isFillTechnique","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","hasSolidLinesOutlines","secondaryWidth","frustumCulled","renderOrderOffset","geometryId","isCirclesTechnique","isSquaresTechnique","enablePicking","fadingParams","getFadingParams","mat","unitFactor","metricUnit","dashedLineMaterial","dashSize","DashedLineMaterial","DEFAULT_DASH_SIZE","gapSize","DEFAULT_GAP_SIZE","isExtrudedLineTechnique","addFeatureData","extrusionAnimatonEnabled","isRenderDepthPrePassEnabled","depthPassMesh","createDepthPrePassMesh","setDepthPrePassStencil","registerTileObject","edgeGeometry","colorAttribute","extrudedPolygonTechnique","getPolygonFadingParams","materialParams","colorMix","lineFadeNear","lineFadeFar","edgeMaterial","EdgeMaterial","edgeObj","extrusionAnimatonDuration","animateExtrusionDuration","edgeIndexBuffers","edgeIndexBufferAttribute","outlineGeometry","fillTechnique","outlineMaterial","outlineObj","outlineTechnique","outlineColor","secondaryColor","secondaryRenderOrder","numVertices","addPois","cacheId","defaultRenderParams","defaultStyle","textSize","bgSize","hexColor","styleColor","hexBgColor","styleBgColor","isSmallCaps","isAllCaps","styleFontVariant","styleFontStyle","themeRenderParams","defaultLayoutParams","trackingFactor","hAlignment","vAlignment","themeLayoutParams","num3dObjects","numTextElements","numUserTextElements","aggregatedObjSize","intersectionData","numEntries","getRoadIntersectionDataSize","featureIds","featureStarts","DEFAULT_COLOR_MIX","lineColor","lineColorMix","planeSize","createPlane","tileBackgroundColor","tileBackgroundIsVisible","TextureCoordinateType","PoiStackMode","isTextureBuffer","interpolants","DiscreteInterpolant","LinearInterpolant","CubicInterpolant","isInterpolatedPropertyDefinition","zoomLevels","isInterpolatedProperty","interpolationMode","nChannels","isMultiChannel","interpolant","evaluate","resultBuffer","InterpolationMode","SdfShaderChunks","sdf_attributes","sdf_varying","sdf_varying_computation","sdf_frag_uniforms","sdf_sampling_functions","GlyphClearMaterial","GlyphCopyMaterial","pageOffset","page0","DEFAULT_IMAGE","page1","page2","page3","page4","page5","page6","page7","SdfTextMaterial","vertexSource","fragmentSource","sdfTexture","sdfParams","Vector4","distanceRange","MSDF","isMsdf","BG_TEXT","isBackground","side","DoubleSide","TextBufferObject","characterBounds","TextMaterials_1","createSdfTextMaterial","DEFAULT_SKIP_PROPERTIES","TEXTURE_PROPERTY_KEYS","getMaterialConstructor","shading","PointsMaterial","CirclePointsMaterial","applyTechniqueToMaterial","skipExtraProps","propertyName","startsWith","BASE_TECHNIQUE_NON_MATERIAL_PROPS","prop","textureReadyCallback","Constructor","settings","flatShading","isStandardTechnique","texturePropertyName","textureProperty","onLoad","wrapS","toWrappingMode","wrapT","magFilter","toTextureFilter","minFilter","flipY","repeatU","repeatV","onError","textureUrl","dataTextureProperties","DataTexture","format","toPixelFormat","toTextureDataType","textureBlob","Blob","URL","createObjectURL","TextureLoader","isShaderTechnique","Uint16Array","primitive","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","DepthFormat","DepthStencilFormat","RedFormat","dataType","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","mode","ClampToEdgeWrapping","RepeatWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","AmbientLight","intensity","DirectionalLight","castShadow","createDepthPrePassMaterial","baseMaterial","depthFunc","EqualDepth","colorWrite","depthPassMaterial","LessDepth","DEPTH_PRE_PASS_STENCIL_MASK","enableDepthPrePass","originalGeometry","depthPassGeometry","uvAttribute","materialIndex","depthMesh","colorMesh","gl","context","buffers","stencil","setTest","setMask","setOp","KEEP","REPLACE","setFunc","ALWAYS","ZERO","EQUAL","isNode","DebugOption","SET_EVENT_TYPE","DebugContext","m_optionsMap","__debugContext","opt","hasEventListener","option","extendedTileInfo","lineFeatures","lineGroup","numFeatures","widths","techniqueCatalog","getLineWidthInWorldUnit","pickPos","results","distanceToPoint","techniqueIndices","px","py","pickDistance","transient","featureStart","featureEnd","startX","startY","lineWidthSqr","closestDistSqr","MAX_VALUE","endX","endY","distSqr","distToSegmentSquared","roadPickResult","distFromCenter","addUserData","solidLineTech","ImageOrigin","IconTexture","MapRenderingManager_1","Pass_1","MSAARenderPass_1","MSAARenderPass","MSAASampling","samplingLevel","Level_1","m_renderTarget","m_localCamera","m_quadScene","m_quadUniforms","m_quadMaterial","MSAAMaterial","m_quad","PlaneBufferGeometry","WebGLRenderTarget","offsets","OffsetVectors","oldClearColor","oldView","view","fullWidth","fullHeight","oldRenderTarget","getRenderTarget","setViewOffset","uniformCenteredDistribution","sampleWeight","setRenderTarget","ConcurrentWorkerSet_1","WorkerBasedDecoder_1","decoderServiceType","scriptUrl","workerSet","getWorkerSet","WorkerBasedDecoder","workerSets","ConcurrentWorkerSet","workerCount","destroy","__awaiter","thisArg","_arguments","P","generator","reject","fulfilled","step","e","rejected","done","apply","WorkerLoader_1","isLoggingMessage","m_workerChannelLogger","m_eventListeners","m_workers","m_workerListeners","m_availableWorkers","m_workerPromises","m_readyPromises","m_requests","m_workerRequestQueue","m_nextMessageId","m_stopped","m_referenceCount","onWorkerMessage","workerId","WorkerServiceProtocol","isResponseMessage","response","messageId","worker","checkWorkerRequestQueue","resolver","isInitializedMessage","readyPromise","getReadyPromise","service","eventHandler","hardwareConcurrency","workerPromise","WorkerLoader","startWorker","evt","waitForAllResponses","terminateWorkers","serviceId","ensureStarted","promise","callback","request","transferList","requestController","ServiceMessageName","Request","postRequestMessage","signal","aborted","err","RequestController","unshift","terminate","newPromise","that","nextUniqueServiceId","m_serviceCreated","addReference","broadcastRequest","WORKER_SERVICE_MANAGER_SERVICE_ID","Requests","DestroyService","targetServiceId","removeReference","CreateService","targetServiceType","tileKeyCode","WorkerDecoderProtocol","DecodeTileRequest","getProjectionName","ArrayBuffer","invokeRequest","TileInfoRequest","DecoderMessageName","Configuration","broadcastMessage","ImageCache_1","m_name2Url","m_url2Name","hasName","oldNames","imageItem","ImageCache","findImage","registerImage","startLoading","loadImage","m_images","imageData","imageCacheItem","findImageCacheItem","mapViews","loaded","itemsToRemove","mapViewIndex","keyToDelete","loadingPromise","imageLoader","ImageLoader","renderImage","ex","errorEvent","createImageBitmap","premultiplyAlpha","imageOrientation","imageBitmap","document","createElement","getContext","drawImage","getImageData","m_enabled","Fog","m_fogIsDefined","m_cachedTheme","startRatio","setFogInRawShaderMaterials","Material","updateFog","m_imageTextures","m_poiShieldGroups","assertExists","poiGeometry","isPoiTechnique","showOnMap","addLineMarker","poiTechnique","imageTextureName","poiTable","poiName","checkCreateTextElement","imageName","fetch","ok","statusText","json","jsonAtlas","textureName","imageTextureDef","reason","getPoiTable","loadedOk","m_missingPoiTableName","poiTableEntry","poiDict","m_missingPoiName","iconName","iconMinLevel","iconMaxLevel","textMinLevel","textMaxLevel","updateMinMaxZoomLevelsFromPoiInfo","techniqueIdx","groupKey","positionArray","textReserveSpace","iconMayOverlap","iconReserveSpace","PoiTableEntry","jsonEntry","isOK","altNames","stackMode","str","Show","Hide","ShowParent","PoiTable","useAltNamesForKey","poiList","m_isLoading","m_loadedOk","poiTableUrl","jsonPoiTable","tableEntry","verifyJSON","newPoiEntry","setup","altName","finishedLoading","m_poiTables","loadPromises","themeUrl","childUrlResolver","composeUrlResolvers","childUrl","resolveReferenceUrl","defaultUrlResolver","poiTableRef","addTable","tableUrl","finishLoading","resolveUrls","harp_lrucache_1","ElevationRangeSource_1","MapTileCuller_1","TileKeyEntry","DataSourceCache","disposedTiles","tileCache","LRUCache","evictionCallback","_","canEvict","tileCode","m_dataSourceCache","m_viewProjectionMatrix","m_frustum","Frustum","m_ResourceComputationType","m_mapTileCuller","MapTileCuller","computationType","dataStore","setCapacity","shrinkToCapacity","dataSources","setFromMatrix","newRenderList","elevationRangeSource","getElevationRangeSource","visibleTileResult","getVisibleTilesForDataSources","tiles","areaDiff","minDiff","actuallyVisibleTiles","allDataSourceTilesLoaded","getDisplayZoomLevel","tileEntry","shouldRender","getTile","prepareForRender","hasGeometry","visibleArea","allVisibleTileLoaded","allBoundingBoxesFinal","fillMissingTilesFromCache","isFinished","cache","tileToUpdate","cacheable","resultTile","getOrCreateCache","tileKeyMortonCode","evictAll","dataSourceCache","markDataSourceTilesDirty","disposeTiles","listEntry","projectionType","childTileKey","longitudeOffset","workList","item","rootTileKey","tileWrappingEnabled","worldGeoPoint","startOffset","totalAngleRad","worldLengthHorizontal","worldLeftPoint","worldLeftGeoPoint","offsetRange","SQRT2","checkedTiles","SearchDirection","cacheSearchUp","cacheSearchDown","defaultSearchDirection","BOTH","DOWN","UP","incompleteTiles","nextLevelCandidates","searchDirection","parentCode","parentTile","childTileCode","childTile","from","retainedTiles","reload","useElevationRangeSource","tileBounds","getRequiredInitialRootTileKeys","tileFrustumIntersectionCache","createIntersectionCache","uniqueKey","tileKeyAndOffset","getElevationRange","calculationStatus","CalculationStatus","FinalPrecise","subTileArea","computeSubTileArea","frustumIntersectsTileBox","intersectsBox","contour","WorkerBasedTiler","tilerServiceType","indexId","input","WorkerTilerProtocol","RegisterIndex","href","TileRequest","harp_lines_1","isLineAccessor","arg","isObject3dAccessor","BufferedGeometryAccessorBase","startCapSize","endCapSize","constructor","rawShaderMaterial","BufferedGeometryAccessor","checkSetUp","positionsArray","subarray","BufferedGeometryLineAccessor","BufferedGeometryObject3dAccessor","getVertices","IndexedBufferedGeometryAccessor","IndexedBufferedGeometryLineAccessor","reconstructLineWidth","k","UNIT_Z","POINTS","BEVEL_POINTS","STEP","addCircle","lineAngle","radius","SECTORS_IN_CIRCLE","numCirclePoints","startWithCircle","endWithCircle","angleVec","prevBt","bt","averageBt","p3","N","useBevel","cross","multiplyScalar","inclineWidth","o","reconstructLine","inBuffer","outBuffer","i2","startIndex","xd","yd","zd","HighPrecisionUtils_1","_renderer","_scene","_geometry","_material","_group","force","doUpdateMatrixWorldInverse","harp_mapview_1","utils","State","TiltState","EventNames","MAPCONTROL_EVENT","MAPCONTROL_EVENT_BEGIN_INTERACTION","BeginInteraction","MAPCONTROL_EVENT_END_INTERACTION","EndInteraction","DEFAULT_MAX_PITCH_ANGLE","MapControls","rotationMouseDeltaFactor","orbitingMouseDeltaFactor","orbitingTouchDeltaFactor","tiltEnabled","rotateEnabled","inertiaEnabled","zoomInertiaDampingDuration","panInertiaDampingDuration","tiltToggleDuration","tiltAngle","zoomLevelDeltaOnMouseWheel","zoomLevelDeltaOnControl","m_currentViewDirection","m_lastMousePosition","m_mouseDelta","m_needsRenderLastFrame","m_panIsAnimated","m_panDistanceFrameDelta","m_panAnimationTime","m_panAnimationStartTime","m_lastAveragedPanDistance","m_currentInertialPanningSpeed","m_lastPanVector","m_recentPanDistances","m_currentPanDistanceIndex","m_zoomIsAnimated","m_zoomDeltaRequested","m_zoomTargetNormalizedCoordinates","m_zoomAnimationTime","m_zoomAnimationStartTime","m_startZoom","m_tiltIsAnimated","m_pitchRequested","m_tiltAnimationTime","m_tiltAnimationStartTime","m_startPitch","m_state","NONE","m_tmpVector2","m_tmpVector3","m_minPitchAngle","m_maxPitchAngle","m_touchState","touches","currentRotation","initialRotation","domElement","bindInputEvents","handleZoom","tilt","deltaYaw","deltaPitch","stopZoom","yawPitchRoll","yawAngle","deltaPitchRadians","pitchAngle","constrainPitchAngle","ypr","deltaAzimuth","deltaAltitude","currentAzimuthAltitude","directionToAzimuthAltitude","topElevation","focusPointInWorldPosition","deltaAltitudeConstrained","getMinDelta","rotate","newAzimuthAltitude","newElevation","newFocusPointInWorldPosition","updateMapView","amount","screenTarget","currentZoom","zoomLevelTargetted","currentPitch","aimTilt","m_tiltState","Down","Tilted","m_targettedZoom","m_currentZoom","m_currentPitch","m_targettedPitch","maxPitchAngle","stopTilt","easeOutCubic","targettedPitch","initialPitch","deltaAngle","oldCameraDistance","newHeight","orbitFocusPoint","applyInertia","animationTime","setLength","panDistance","reduce","onContextMenu","contextMenu","onMouseDown","mouseDown","onMouseWheel","mouseWheel","onTouchStart","touchStart","onTouchEnd","touchEnd","onTouchMove","touchMove","shiftKey","ctrlKey","preventDefault","stopPropagation","button","PAN","ROTATE","ORBIT","clientX","clientY","onMouseMove","mouseMove","onMouseUp","mouseUp","m_cleanupMouseEventListeners","panFromTo","getWidthAndHeightFromCanvas","calculateNormalizedDeviceCoordinates","setZoomLevel","deltaY","initialDistance","subVectors","initialWorldPosition","touch","newTouchPoint","pageX","pageY","touchPointInNDC","newWorldPosition","currentTouchPoint","lastTouchPoint","touchState","convertTouchPoint","updateTouchState","calculateAngleFromTouchPointsInWorldspace","oldTouchState","newTouchState","TOUCH","setTouchState","updateTouches","deltaRotation","moveAlongTheViewDirection","calculatePinchDistanceInWorldSpace","firstTouch","fromX","fromY","toX","toY","to","toWorld","fromWorld","tmpPitchAngle","checkMinCamHeight","deltaAlt","cameraQuat","newPitchQuaternion","viewDirection","mockCamera","constrainedDeltaAltitude","safeParseDecimalInt","fallback","match","integerRe","screenCoordinateX","screenCoordinateY","screenSizeX","screenSizeY","normalizedDirection","xy","nxz","azimuth","azimuthAltitudeToDirection","cosAltitude","TileLoader","dataProvider","tileDecoder","loadAbortController","AbortController","countRequests","Loading","donePromise","Ready","Failed","Canceled","ensureLoadingStarted","startDecodeTile","Decoding","cancelDecoding","abort","onDone","doStartLoad","myLoadCancellationToken","payload","onLoaded","resolveDonePromise","rejectedDonePromise","byteLength","decodeTile","onDecoded","doneState","toHereTile","TileInfoLoader","getTileInfo","Expr","kind","code","Parser","parse","Env","_name","MapEnv","lookup","obj","unmap","VarExpr","env","NumberLiteralExpr","StringLiteralExpr","HasAttributeExpr","ContainsExpr","NotExpr","expr","BinaryExpr","op","endsWith","LogicalExpr","Character","Token","isSpace","codepoint","Tab","Lf","Cr","Space","isNumber","_0","_9","isLetter","A","Z","isIdentChar","isLetterOrNumber","Dollar","Dot","LBracket","RBracket","tokenSpell","token","Eof","Identifier","Comma","LParen","RParen","Exclaim","TildeEqual","CaretEqual","DollarEqual","EqualEqual","ExclaimEqual","Less","Greater","LessEqual","GreaterEqual","BarBar","AmpAmp","Lexer","m_token","m_char","m_text","yylex","codePointAt","yyinp","ch","SingleQuote","DoubleQuote","Equal","Caret","Tilde","Bar","Amp","getEqualityOp","getRelationalOp","lex","parseLogicalOr","yyexpect","parseFloat","parseUnary","parsePrimary","parseRelational","parseEquality","parseLogicalAnd","SolidLineMaterial_1","shaderParams","updateDashedFeature","PriorityListGroup","getGroup","normalizedPriority","otherGroup","findGroup","priorityList","LoggerManagerImpl_1","LoggerManagerImpl","ConsoleChannel_1","Logger_1","WorkerChannel_1","m_loggers","channel","loggerName","found","config","MultiChannel","channels","bx","by","computeSquaredLineLength","line","squaredLineLength","xDiff","yDiff","l0x","l0y","l1x","l1y","lineLengthSuared","smoothStep","edge0","edge1","lerp","inMin","inMax","outMin","outMax","lowerBound","upperBound","applyMixins","derivedCtor","baseCtors","baseCtor","descriptor","getOwnPropertyDescriptor","condition","nowFunc","getTime","getNowFunc","candidate","mergeWithOptions","parameters","optionValue","customDefaultUrlResolver","setDefaultUrlResolver","resolvers","originalUrl","parentUrl","absoluteUrlWithOriginRe","test","getUrlOrigin","substr","baseUrl","RegExp","idx","lastIndexOf","parsed","getUrlHostAndProtocol","protocol","host","urlOriginRe","f1","f2","args","shaderContent","shaderName","insertedShaderName","addTab","tabChar","extrusion_vertex","extrusion_pars_fragment","extrusion_fragment","fading_vertex","fading_pars_fragment","fading_fragment","edgeColor","edgeColorMix","updateColorMixFeature","USE_COLOR","USE_EXTRUSION","isHighPrecisionLineMaterial","updateTransparencyFeature","points_frag","DEFAULT_SIZE","DEFAULT_SCALE","uvTransform","Matrix3","IconMaterial","vertexColors","VertexColors","NormalBlending","isCirclePointsMaterial","m_size","m_color","getHexString","CopyMaterial_1","AdditiveBlending","isGeoCoordinatesLike","identityProjection","getLongitudeQuadrant","oneOverPI","quadrantIndex","lengthOfVector3","makeBox3","halfEquatorialRadius","minLongitude","maxLongitude","minLongitudeQuadrant","maxLongitudeQuadrant","xMin","xMax","yMin","yMax","cosMaxLongitude","sinMaxLongitude","xCenter","xExtent","yCenter","yExtent","minLatitude","maxLatutide","zMax","zMin","zCenter","zExtent","sphereProjection","Spherical","_minElevation","worldpoint","cosLatitude","parallelRadiusSq","parallelRadius","midX","midY","cosSouth","sinSouth","cosWest","sinWest","cosNorth","sinNorth","cosEast","sinEast","cosMidX","sinMidX","cosMidY","sinMidY","rMax","rMin","minZ","_worldBox","QuadTree","accept","visitTileKey","subTileKey","EquirectangularProjection_1","HalfQuadTreeSubdivisionScheme_1","TilingScheme_1","hereTilingScheme","WebMercatorProjection_1","QuadTreeSubdivisionScheme_1","webMercatorTilingScheme","mercatorTilingScheme","isVector3Like","TechniqueParams_1","isStandardExtrudedLineTechnique","isLineTechnique","isSegmentsTechnique","isBasicExtrudedLineTechnique","textureCoordinateType","addBuffersToTransferList","texturePropertyKey","isRequestMessage","Response","isRegisterIndexRequest","isTileRequest","abortController","isConfigurationMessage","isDecodeTileRequest","isTileInfoRequest","getProjection","projectionName","FeatureGroup","storeExtendedTags","startSize","textIndex","layerIndex","classIndex","typeIndex","LineFeatureGroup","getNumBytes","segmentIds","segmentStartOffsets","segmentEndOffsets","PolygonFeatureGroup","groupNumRings","outerRingStartIndex","innerRingIsOuterContour","innerRingStartIndex","ExtendedTileInfo","textCatalog","pointGroup","polygonGroup","layerCatalog","classCatalog","typeCatalog","finishFeatureGroup","featureGroup","featureGroupFinished","finish","featureGroupSize","tileInfoFinished","getFeatureName","useAbbreviation","useIsoCode","abbreviation","isoCode","ExtendedTileInfoWriter","techniqueIndexMap","stringMap","layerMap","classMap","typeMap","infoTileTechniqueIndex","_index","storedTechnique","isPolygonGroup","textTechnique","textLabel","stringIndex","addLayer","addClass","addType","segmentId","endOffset","isOuterRing","addStringValue","catalog","ExtendedTileInfoVisitor","handler","visitAllPointFeatures","visitAllLineFeatures","visitAllPolygonFeatures","numFeaturesFound","numPointFeatures","pointFeatures","visitPointFeature","numLineFeatures","visitLineFeature","numPolygonFeatures","polygonsFeatures","visitPolygonFeature","featureIndex","acceptPoint","getTag","positionsStart","numPointValues","acceptLine","acceptPolygon","polygons","ringStart","numRings","polygonAccessor","ringIndex","pointsStart","ThemeVisitor","visitFunc","visit","currStyle","GlyphData_1","GlyphTextureCache_1","fonts","unicodeBlocks","maxCodePointCount","m_replacementGlyph","m_glyphTextureCache","GlyphTextureCache","m_loadingJson","m_loadingPages","m_loadingGlyphs","m_loadedJson","m_loadedPages","m_loadedGlyphs","location","loadJSON","replacementDirUrl","replacementJson","replacementTexture","loadTexture","replacementFont","replacementGlyph","chars","xadvance","xoffset","yoffset","supportedBlocks","rawJSON","JSON","loadPages","assetsPath","getAssetsPath","jsonPath","jsonPromise","pagePromises","page","pages","loadPage","pagePath","charset","toUpperCase","c","glyphPromises","char","getFont","fontHash","glyphHash","fontGlyphMap","glyphPromise","createReplacementGlyph","charUnicodeBlock","loadAssets","loadedGlyph","shouldTransform","transformedCharacter","getGlyph","selectedFontName","textureBytes","loadedPage","loadBlock","sourceGlyphData","texturePath","pagePromise","fontStylePath","italic","boldItalic","entryWidth","entryHeight","nRows","m_cacheHeight","m_cacheWidth","m_textureSize","m_entryCache","initCacheEntries","m_rt","depthBuffer","stencilBuffer","m_copyTextureSet","m_copyTransform","m_copyPositions","m_copyMaterial","m_copyVertexBuffer","m_copyPositionAttribute","m_copyUVAttribute","m_copyGeometry","copyIndexBuffer","m_copyMesh","m_copyGeometryDrawCount","m_clearMaterial","m_clearPositionAttribute","m_clearGeometry","clearIndexBuffer","m_clearMesh","m_clearGeometryDrawCount","hash","oldestEntry","oldest","clearCacheEntry","copyGlyphToCache","willClearGeometry","willCopyGeometry","srcPages","nCopies","pageIndex","dummyFont","base","lineGap","dummyGlyphData","dummyEntry","cacheLocation","copyTextureIndex","applyMatrix3","setXYZ","setXY","Entry","newer","older","cacheCapacity","sizeFunction","m_newest","m_oldest","m_capacity","m_sizeFunction","callbackfn","newCapacity","evict","entrySize","valueSize","promote","newest","cb","evictOldest","itemToRemove","isOk","TextBufferObject_1","TextGeometry_1","LineTypesetter_1","PathTypesetter_1","MaterialUtils_1","tempTextPosition","tempTextBounds","tempVertexBuffer","m_fontCatalog","m_ownsMaterial","m_material","m_ownsBgMaterial","m_bgMaterial","m_defaultLayer","m_layers","m_defaultTextRenderStyle","m_currentTextRenderStyle","m_defaultTextLayoutStyle","m_currentTextLayoutStyle","m_lineTypesetter","LineTypesetter","m_pathTypesetter","PathTypesetter","bgMaterial","backgroundMesh","target","oldTarget","layerId","outputBounds","upperCaseArray","pathOrigin","placeText","textPathOverflow","targetLayer","tempLayer","prevDrawCount","updatePosition","addPickingData","glyphArray","smallCapsEnabled","textBounds","storeStyles","computeTextBuffer","pick","updateMemoryUsage","glyphBounds","isPath","typesettingParams","smallCapsArray","vertexBuffer","arrangeGlyphs","TypesettingUtils_1","m_tempTransform","m_tempCorners","m_tempLineDirection","m_tempRunDirection","m_tempPixelSize","m_tempPixelBgSize","m_tempScale","m_tempSmallCaps","m_currentParams","isOnlyMeasured","lineStartIdx","glyphWrapIdx","wordWrapIdx","lineStartX","lineCurrX","glyphWrapX","wordWrapX","lineCount","isBidirectionalLine","wrapPointIdx","wrapPointX","lineAlignment","placeLine","isBidirectional","placeRun","glyphDataArray","isRTL","runStart","neutralIdx","weakRunStart","weakGlyph","glyphFont","glyphFontMetrics","isBoldEmulated","isItalicEmulated","smallCapsScale","glyphScale","emulationWeight","isMirrored","verticalOffset","glyphVertexPosition","horizontalOffset","addToBuffer","m_tempPathPosition","m_tempPathLength","m_tempPathOffset","getLength","pathWidth","defaultGlyphRotation","normalDisplacement","textPoint","getTangent","normal","ContextualForm","CombinedForm","m_singleCharactersMap","m_combinedCharactersMap","m_neutralCharacters","output","currentCodePoint","charCodeAt","isArabicCharacter","prevIndex","isNeutral","prevCodePoint","prevMap","getCharacterMap","Initial","Medial","nextIndex","nextCodePoint","nextMap","Final","combinedMap","getCombinedCharacterMap","fromCharCode","Connected","Isolated","BoxBuffer_1","Poi_1","tempPos","PoiRenderBufferBatch","boxBuffer","init","updateBufferGeometry","iconTexture","UVMapping","generateMipmaps","BoxBuffer","PoiRenderBuffer","batches","m_batchMap","batchKey","mappedIndex","bufferBatch","batchSet","screenBox","batchIndex","registerPoi","uvBox","addBox","batch","pickBoxes","m_tempScreenBox","m_renderBuffer","poiRenderBatch","preparePoi","screenCollisions","tempScreenBox","computeIconScreenBox","allocateScreenSpace","addPoi","getBatch","computedWidth","computedHeight","centerX","iconXOffset","centerY","iconYOffset","getImageTexture","m_missingTextureName","imageDefinition","imageCache","findImageByName","imageUrl","loadedImageItem","setupPoiInfo","imageWidth","imageHeight","iconWidth","iconHeight","minS","maxS","minT","maxT","iconScaleH","iconScale","iconScaleV","screenWidth","screenHeight","s0","s1","PixelPicker_1","BoxBufferMesh","startElementCount","maxElementCount","resizeBuffer","pickInfos","internalMesh","indexAttribute","glyphCount","positionAttributeCount","colorAttributeCount","uvAttributeCount","indexAttributeCount","pickInfoCount","pickInfo","canAddElements","clearGroups","clearAttributes","isEmpty","pickInfoIndex","box","isPixelTransparent","forceResize","xScreenPos","yScreenPos","pixelIsTransparent","u","screenToUvCoordinates","pixel","getPixelFromImage","newPositionArray","setArray","newColorArray","Uint8Array","newUvArray","numIndexValues","newIndexArray","getPixelFromImageBitmap","xPos","yPos","pixelData","getPixelFromImageData","imgData","strd","Uint8ClampedArray","getPixel","pickedColor","close","pixelsData","v2","m_lengths","PathParam","curves","m_point","curve","m_cache","lengths","lineCurve","curveLengths","getCurveLengths","segmentLength","LowResRenderPass_1","DEFAULT_DYNAMIC_MSAA_SAMPLING_LEVEL","DEFAULT_STATIC_MSAA_SAMPLING_LEVEL","Level_4","antialiasSettings","msaaEnabled","m_readBuffer","m_msaaPass","m_dynamicMsaaSamplingLevel","dynamicMsaaSamplingLevel","m_staticMsaaSamplingLevel","staticMsaaSamplingLevel","m_lowResPass","LowResRenderPass","isStaticFrame","m_savedWidth","m_savedHeight","startWorkerImmediately","directlyFallbackToBlobBasedLoading","startWorkerBlob","Worker","waitWorkerInitialized","fetchScriptSourceToBlobUrl","blobUrl","sourceLoaderCache","scriptSource","blob","firstMessageCallback","errorCallback","RTree","rtree","m_returnArray","threeBox","box2","insert","search","ScreenCollisionsDebug","debugCanvas","m_renderContext","m_renderingEnabled","m_numAllocations","m_numSuccessfulTests","m_numFailedTests","m_numSuccessfulVisibilityTests","m_numFailedVisibilityTests","strokeStyle","strokeRect","isFailed","geojson","bbox","geoJSON","rectangle","minWidth","rootTree","root","flatten","tree","current","todo","leaf","removeSubtree","ltree","hitStack","countStack","retArray","retObj","insertSubtree","searchSubtree","linearSplit","pickLinear","pickNext","highAreaDelta","highAreaNode","lowestGrowthGroup","areaA","areaB","newAreaA","changeNewAreaA","newAreaB","changeNewAreaB","tempNode","lowestHighX","highestLowX","lowestHighY","highestLowY","returnNode","returnArray","node","bc","pbc","treeStack","bestChoiceArea","bestChoiceIndex","bestChoiceStack","first","oldLRatio","nw","nh","lratio","chooseLeafSubtree","ai","getTree","setTree","newTree","where","moreTree","removeObj","deleted","numberDeleted","removeArea","toJSON","printing","stringify","fromJSON","rt","ar","temp","out","coordinates","geos","makeRec","prelim","features","multiPointLineString","multiLineStringPolygon","multiPolygon","geometryCollection","m_projectionViewMatrix","m_viewMatrix","m_cameraPosition","m_center","m_width","m_height","m_nearClipPlane","m_farClipPlane","projectVector","tempV3","makeRotationFromQuaternion","transpose","tempV2","SkyGradientTexture_1","m_topColor","m_bottomColor","m_groundColor","m_monomialPower","DEFAULT_MONOMIAL_POWER","m_gradient","SkyGradientTexture","m_farClipPlaneDividedVertically","Line3","m_groundPlane","m_bottomMidFarPoint","m_topMidFarPoint","m_horizonPosition","m_farClipPlaneCorners","setHorizonPosition","updateTexturePosition","topColor","bottomColor","setFarPlaneCornersFromCamera","bottomLeftFarCorner","bottomRightFarCorner","topLeftFarCorner","topRightFarCorner","setMidPoint","intersectLine","skyRatio","updateYOffset","destination","cornerIndex","addPoint","unproject","DEFAULT_TEXTURE_HEIGHT","m_texture","createTexture","updateTextureColors","fillTextureData","unpackAlignment","interpolatedColor","m_globalFrustumMin","m_globalFrustumMax","m_frustumCorners","frustumCorners","getFrustumCorners","matrix","frustumCorner","globalFrustumMin","globalFrustumMax","invProjMatrix","projectionMatrixInverse","UPDATE_EVENT","DataSource","uniqueName","storageLevelOffset","m_storageLevelOffset","uniqueNameCounter","m_styleSetName","levelOffset","ImageItem","WorkerBasedTiler_1","ConcurrentTilerFacade","TileGeometry_1","TileDataAccessor","m_wantsPoints","m_wantsLines","m_wantsAreas","m_wantsObject3D","wantsAll","wantsPoints","wantsLines","wantsAreas","wantsObject3D","visitObject","wantsFeature","visitMesh","meshObject","geometryAccessor","getBufferGeometry","getIndexedGeometryAccessor","getGeometryAccessor","getCount","setRange","visitPoint","visitLine","visitArea","visitObject3D","tmpV","tmpNormal","tmpTangent0","tmpTangent1","tmpBitangent","LINE_VERTEX_ATTRIBUTES","HP_LINE_VERTEX_ATTRIBUTES","LineGeometry","createLineGeometry","polyline","highPrecision","pointCount","segments","tangents","sqrLength","isClosed","T1","T2","highComp","lowComp","setComponent","computeBitangent","createSimpleLineGeometry","LineGroup","isSimple","m_origin","descriptors","descr","createGeometry","acos","sign","isHighPrecisionPointsMaterial","dimensionality","setDimensionality","CopyrightElementHandler","m_defaults","m_mapViews","mergedCopyrightInfo","staticInfo","m_element","display","defaults","deduped","innerHTML","getElementById","MapControlsUI","controls","zoomInButton","innerText","zoomOutButton","tiltButton","zoomLevelElement","div","toLocaleString","minimumFractionDigits","maximumFractionDigits","updateZoom","blur","appendChild","toggleTilt","className","disableDefaultStyle","initStyle","cssText","createTextNode","LongPressHandler","onLongPress","timeout","moveThreshold","buttonId","m_mouseDownEvent","m_timerId","m_moveHandlerRegistered","m_boundMouseMoveHandler","m_boundMouseDownHandler","onMousedown","m_boundMouseUpHandler","onMouseup","cancelTimer","onTimeout","addMouseMoveHandler","removeMouseMoveHandler","MapControls_1","TWEEN","EasingFunction","InterpolationFunction","CameraAnimation","stopped","easing","Easing","Linear","easingMap","interpolationMap","QuadraticIn","Quadratic","In","QuadraticOut","Out","QuadraticInOut","InOut","CubicIn","Cubic","CubicOut","CubicInOut","QuarticIn","Quartic","QuarticOut","QuarticInOut","QuinticIn","Quintic","QuinticOut","QuinticInOut","SinusoidalIn","Sinusoidal","SinusoidalOut","SinusoidalInOut","ExponentialIn","Exponential","ExponentialOut","ExponentialInOut","CircularIn","Circular","CircularOut","ElasticIn","Elastic","ElasticOut","ElasticInOut","BackIn","Back","BackOut","BackInOut","BounceIn","Bounce","BounceOut","BounceInOut","Interpolation","Bezier","CatmullRom","checkSetupTween","tween","CameraRotationAnimation","m_mapControls","startAngle","endAngle","m_axis","beginInteractionListener","stopTween","endInteractionListener","startTween","axis","m_lastRotationValue","onFinished","beginAnimation","endAnimation","rotZ","m_userCamerRotation","getWorldQuaternion","Tween","onComplete","onUpdate","setFromEuler","Euler","CameraPanAnimation","interpolation","m_geoCoordinates","geoCoordinates","_Group","_tweens","_tweensAddedDuringUpdate","getAll","tweenId","removeAll","getId","preserve","tweenIds","_isPlaying","Group","_nextId","nextId","process","hrtime","_object","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_repeat","_repeatDelayTime","_yoyo","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallback","_onStartCallbackFired","_onUpdateCallback","_onRepeatCallback","_onCompleteCallback","_onStopCallback","_id","isPlaying","stopChainedTweens","numChainedTweens","delay","times","repeatDelay","yoyo","easingFunction","interpolationFunction","chain","onStart","onRepeat","onStop","elapsed","isFinite","tmp","f","fn","Utils","pw","bn","Bernstein","fc","Factorial","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","run","marker","runClearTimeout","Item","noop","nextTick","title","browser","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","TileLoader_1","TileFactory","m_modelConstructor","TileDataSource","m_tileFactory","m_isReady","decoder","m_decoder","concurrentDecoderServiceName","getTileDecoder","concurrentDecoderScriptUrl","configure","m_tileLoaderCache","getCacheCount","newTileLoader","setDecodedTileOnTile","loadAndDecode","tileLoaderState","loaderState","decodedTileHasGeometry","copyrightHolderIds","forceHasGeometry","index_decoder_1","ThemedTileDecoder","m_styleSetEvaluator","decodeThemedTile","StyleSetEvaluator","Expr_1","InterpolatedProperty_1","InterpolatedPropertyDefs_1","createInterpolatedProperty","removeDuplicatePropertyValues","propKeys","propValues","Discrete","m_renderOrderBiasGroups","m_techniques","techniqueRenderOrder","cloneStyle","subStyle","computeDefaultRenderOrder","renderOrderBiasGroup","renderOrderBiasGroupOrder","renderOrderBiasRange","minRange","maxRange","styleStack","processStyle","when","_whenExpr","cleanupStyle","createTechnique","final","addAttributes","renderOrderBiasProperty","labelProperty","addTechniqueToIndex","addExtrudedWalls","indexBuffer","vertexStride","contourEdges","boundaryWalls","nSegments","vFootprint0","vRoof0","vFootprint1","vRoof1","currEdgeStart","currEdgeGoal","prevEdgeStart","prevEdgeGoal","addPolygonEdges","polygonContour","polygonContourEdges","isExtruded","addFootprintEdges","wallEdgeSlope","prevEdgeIdx","v0x","v0y","v1x","v1y","vFoot0","colorToString","forceCSSHex","colorFormat","__state","conversionName","hex","ARR_EACH","ARR_SLICE","Common","BREAK","extend","each","isObject","isUndefined","compose","toCall","itr","scope","_key","defer","fnc","debounce","func","threshold","callImmediately","delayed","callNow","isNull","_isNaN","_x","isString","isBoolean","isFunction","INTERPRETATIONS","litmus","conversions","THREE_CHAR_HEX","read","original","space","write","SIX_CHAR_HEX","CSS_RGB","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","toReturn","interpret","family","conversion","tmpComponent","ColorMath","hsv_to_rgb","hi","rgb_to_hsv","rgb_to_hex","hex_with_component","component_from_hex","componentIndex","_typeof","Symbol","classCallCheck","TypeError","createClass","defineProperties","props","configurable","writable","protoProps","staticProps","receiver","Function","desc","getPrototypeOf","inherits","subClass","superClass","setPrototypeOf","__proto__","possibleConstructorReturn","ReferenceError","defineRGBComponent","component","componentHexIndex","recalculateRGB","defineHSVComponent","recalculateHSV","COMPONENTS","Controller","initialValue","__onChange","__onFinishChange","newValue","updateDisplay","EVENT_MAP_INV","HTMLEvents","MouseEvents","KeyboardEvents","CSS_VALUE_PIXELS","cssValueToPixels","dom","makeSelectable","elem","selectable","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","makeFullscreen","hor","vert","vertical","horizontal","fakeEvent","eventType","pars","aux","createEvent","initMouseEvent","bubbles","cancelable","clickCount","initKeyboardEvent","initKeyEvent","altKey","metaKey","keyCode","charCode","initEvent","newBool","bool","attachEvent","unbind","detachEvent","classes","split","removeClass","removeAttribute","hasClass","getWidth","getComputedStyle","getHeight","getOffset","el","offsetParent","offsetLeft","offsetTop","isActive","activeElement","BooleanController","_Controller","_this2","_this","__prev","__checkbox","setAttribute","checked","OptionController","opts","__select","desiredValue","selectedIndex","StringController","onChange","__input","numDecimals","NumberController","_params","__min","__max","__step","__impliedStep","LN10","__precision","_v","minValue","maxValue","stepValue","NumberControllerBox","_NumberController","__truncationSuspended","prevY","onFinish","onMouseDrag","attempted","decimals","tenTo","i1","o1","o2","NumberControllerSlider","bgRect","__background","getBoundingClientRect","__foreground","pct","FunctionController","__button","fire","ColorController","__color","__temp","__selector","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input_textShadow","onBlur","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","toOriginal","fieldRect","_ref","padding","boxShadow","border","borderRadius","zIndex","borderRight","marginRight","cursor","linearGradient","outline","textAlign","fontWeight","textShadow","mismatch","flip","_flip","marginLeft","marginTop","toHexString","vendors","vendor","css","cssContent","indoc","doc","injected","getElementsByTagName","saveDialogContents","ControllerFactory","requestAnimationFrame$1","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","CenteredDiv","backgroundElement","WebkitTransition","transition","body","hide","webkitTransform","layout","innerWidth","innerHeight","___$insertStyle","SUPPORTS_LOCAL_STORAGE","localStorage","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","__ul","__folders","__controllers","__rememberedObjects","__rememberedObjectIndecesToControllers","__listening","closeOnTop","autoPlace","resizable","hideable","preset","scrollable","useLocalStorage","getItem","getLocalStorageHash","saveToLocalStorage","titleRow","getRoot","gui","__preset_select","setPresetSelectIndex","revert","setWidth","closed","CLASS_CLOSED","onResize","__closeButton","TEXT_OPEN","TEXT_CLOSED","setItem","CLASS_MAIN","savedGui","CLASS_CLOSE_BUTTON","CLASS_CLOSE_TOP","insertBefore","childNodes","CLASS_CLOSE_BOTTOM","titleRowName","addRow","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","__resizeHandler","onResizeDebounced","addResizeHandle","getSaveObject","saveToLocalStorageIfPossible","newDom","liBefore","li","removeListeners","markPresetModified","modified","recallSavedValue","controller","matchedIndex","controllerMap","remembered","presetMap","_add","factoryArgs","before","__li","container","CLASS_CONTROLLER_ROW","__gui","_options","nextSibling","nextElementSibling","_nextSibling","firstElementChild","listen","method","pc","pb","returned","oldName","wasListening","newController","borderLeftColor","isModified","augmentController","addPresetOption","setSelected","showHideExplain","explain","addSaveMenu","__save_row","firstChild","gears","button2","button3","select","localStorageCheckBox","newConstructorTextArea","which","show","focus","save","presetName","prompt","saveAs","pmouseX","drag","dragStop","CLASS_DRAG","dragStart","__resize_handle","getCurrentPreset","useInitialValues","savedValues","toggleHide","CLASS_TOO_TALL","_keydownHandler","addColor","removeChild","subfolder","removeFolder","addFolder","newGuiParams","folders","folder","parentElement","open","offsetHeight","remember","updateDisplays","controllerArray","GUI$1","vars","COLOR_STEPS_COUNT","stylingOptionsDefaults","colorSteps","textureIntensity","lightVector","stylingOptions","sortedColorSteps","colors","altitudes","useOctNormal","containsOctNormals","altitudeSteps","hasTexture","isOctNormalAttribute","getTileMaterial","getCustomObjects","decodedTileGeometry","scaledPositionArray","getTileSize","tileHeader","xScale","yScale","zScale","minHeight","attributeArray","vertexPosition","findVertexAttribute","metadata","scaleVertices","generateTileMaterial","createTileObjects","tileGeometry","tileMesh","octNormal","localCoordinates","index1","index2","index3","v3","triangle","planeTriangle","containsPoint","rationVector","getBarycoord","displacementZ","calculateLocalDisplacement","TerrainDataProvider","fetchTile","useWorker","decoderOptions","Float64Array","datasetList","stylesList","textureLoader","fetchTileTexture","textureTileKey","getTileKey","random","rowCount","getTileTextureUrl","crossOrigin","defaultColorSteps","defaultLighting","cesiumLighting","mapTile","dataset","currentDataset","isAttributionPopupVisible","attributionTrigger","querySelector","attributionPopup","cesiumAttribution","sampleAttribution","cesiumIonLogo","updateUi","classList","toggle","createCesiumWorldTerrainDataSource","worldTerrainToken","headers","res","status","arrayBuffer","fetchCesiumWorldTerrainTile","createSampleTilesDataSource","fetchSampleTile","endpoint","accessToken","fetchWorldTerrainToken","uiOptions","zoomLevelBias","initializeMapView","cesiumWorldTerrainDataSource","sampleDataSource","addDataSource","setCameraGeolocationAndZoom","rotateX","datasetController","styleController","updateTiles","querySelectorAll","disabled"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 172);\n","module.exports = THREE;","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/GroupedPriorityList\"));\n__export(require(\"./lib/Logger\"));\n__export(require(\"./lib/Math2D\"));\n__export(require(\"./lib/MathUtils\"));\n__export(require(\"./lib/Mixins\"));\n__export(require(\"./lib/assert\"));\n__export(require(\"./lib/PerformanceTimer\"));\n__export(require(\"./lib/OptionsUtils\"));\n__export(require(\"./lib/UrlResolver\"));\n__export(require(\"./lib/UrlUtils\"));\n__export(require(\"./lib/Functions\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/coordinates/GeoBox\"));\n__export(require(\"./lib/coordinates/GeoCoordinatesLike\"));\n__export(require(\"./lib/coordinates/GeoCoordinates\"));\n__export(require(\"./lib/projection/EarthConstants\"));\n__export(require(\"./lib/projection/EquirectangularProjection\"));\n__export(require(\"./lib/projection/IdentityProjection\"));\n__export(require(\"./lib/projection/Projection\"));\n__export(require(\"./lib/projection/MercatorProjection\"));\n__export(require(\"./lib/projection/WebMercatorProjection\"));\n__export(require(\"./lib/projection/SphereProjection\"));\n__export(require(\"./lib/tiling/FlatTileBoundingBoxGenerator\"));\n__export(require(\"./lib/tiling/HalfQuadTreeSubdivisionScheme\"));\n__export(require(\"./lib/tiling/QuadTreeSubdivisionScheme\"));\n__export(require(\"./lib/tiling/QuadTree\"));\n__export(require(\"./lib/tiling/SubTiles\"));\n__export(require(\"./lib/tiling/TileKey\"));\n__export(require(\"./lib/tiling/TileKeyUtils\"));\n__export(require(\"./lib/tiling/TileTreeTraverse\"));\n__export(require(\"./lib/tiling/TilingScheme\"));\n__export(require(\"./lib/tiling/HereTilingScheme\"));\n__export(require(\"./lib/tiling/WebMercatorTilingScheme\"));\n__export(require(\"./lib/tiling/MercatorTilingScheme\"));\n__export(require(\"./lib/math/Vector3Like\"));\n__export(require(\"./lib/math/Box3Like\"));\n__export(require(\"./lib/math/OrientedBox3Like\"));\n__export(require(\"./lib/math/MathUtils\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/Techniques\"));\n__export(require(\"./lib/TechniqueParams\"));\n__export(require(\"./lib/InterpolatedProperty\"));\n__export(require(\"./lib/InterpolatedPropertyDefs\"));\n__export(require(\"./lib/WorkerServiceProtocol\"));\n__export(require(\"./lib/WorkerTilerProtocol\"));\n__export(require(\"./lib/WorkerDecoderProtocol\"));\n__export(require(\"./lib/DecodedTile\"));\n__export(require(\"./lib/TileInfo\"));\n__export(require(\"./lib/ThemeVisitor\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/CopyMaterial\"));\n__export(require(\"./lib/DashedLineMaterial\"));\n__export(require(\"./lib/EdgeMaterial\"));\n__export(require(\"./lib/MapMeshMaterials\"));\n__export(require(\"./lib/HighPrecisionLineMaterial\"));\n__export(require(\"./lib/HighPrecisionPointMaterial\"));\n__export(require(\"./lib/IconMaterial\"));\n__export(require(\"./lib/SolidLineMaterial\"));\n__export(require(\"./lib/CirclePointsMaterial\"));\n__export(require(\"./lib/MSAAMaterial\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst RAD2DEG = 180.0 / Math.PI;\nconst DEG2RAD = Math.PI / 180.0;\n/**\n * `GeoCoordinates` is used to represent geo positions.\n */\nclass GeoCoordinates {\n    /**\n     * Creates a `GeoCoordinates` from the given latitude, longitude, and optional altitude.\n     *\n     * @param latitude Latitude in degrees.\n     * @param longitude Longitude in degrees.\n     * @param altitude Altitude in meters.\n     */\n    constructor(latitude, longitude, altitude) {\n        this.latitude = latitude;\n        this.longitude = longitude;\n        this.altitude = altitude;\n    }\n    /**\n     * Returns a `GeoCoordinates` from the given latitude, longitude, and optional altitude.\n     *\n     * @param latitude Latitude in degrees.\n     * @param longitude Longitude in degrees.\n     * @param altitude Altitude in meters.\n     */\n    static fromDegrees(latitude, longitude, altitude) {\n        return new GeoCoordinates(latitude, longitude, altitude);\n    }\n    /**\n     * Returns a `GeoCoordinates` from the given latitude, longitude, and optional altitude.\n     *\n     * @param latitude Latitude in radians.\n     * @param longitude Longitude in radians.\n     * @param altitude Altitude in meters.\n     */\n    static fromRadians(latitude, longitude, altitude) {\n        return new GeoCoordinates(latitude * RAD2DEG, longitude * RAD2DEG, altitude);\n    }\n    /**\n     * Returns the latitude in radians.\n     */\n    get latitudeInRadians() {\n        return this.latitude * DEG2RAD;\n    }\n    /**\n     * Returns the longitude in radians.\n     */\n    get longitudeInRadians() {\n        return this.longitude * DEG2RAD;\n    }\n    /**\n     * Returns the latitude in degrees.\n     * @deprecated Use the [[latitude]] property instead.\n     */\n    get latitudeInDegrees() {\n        return this.latitude;\n    } // compat api\n    /**\n     * Returns the longitude in degrees.\n     * @deprecated Use the [[longitude]] property instead.\n     */\n    get longitudeInDegrees() {\n        return this.longitude;\n    } // compat api\n    /**\n     * Returns `true` if this `GeoCoordinates` is valid; returns `false` otherwise.\n     */\n    isValid() {\n        return !isNaN(this.latitude) && !isNaN(this.longitude);\n    }\n    /**\n     * Returns the normalized `GeoCoordinates`.\n     */\n    normalized() {\n        let { latitude, longitude } = this;\n        if (isNaN(latitude) || isNaN(longitude)) {\n            return this;\n        }\n        if (latitude > 90) {\n            let wrapped = (latitude + 90) % 360;\n            if (wrapped >= 180) {\n                longitude += 180;\n                wrapped = 360 - wrapped;\n            }\n            latitude = wrapped - 90;\n        }\n        if (latitude < -90) {\n            let wrapped = (latitude - 90) % 360;\n            if (wrapped <= -180) {\n                longitude += 180;\n                wrapped = -360 - wrapped;\n            }\n            latitude = wrapped + 90;\n        }\n        if (longitude < -180 || longitude > 180) {\n            longitude = ((longitude + 180) % 360) - 180;\n        }\n        if (latitude === this.latitude && longitude === this.longitude) {\n            return this;\n        }\n        return new GeoCoordinates(latitude, longitude, this.altitude);\n    }\n    /**\n     * Returns `true` if this `GeoCoordinates` is equal to the other.\n     *\n     * @param other GeoCoordinatesLike to compare to.\n     */\n    equals(other) {\n        return (this.latitude === other.latitude &&\n            this.longitude === other.longitude &&\n            this.altitude === other.altitude);\n    }\n    /**\n     * Copy values from the other.\n     *\n     * @param other GeoCoordinatesLike to copy all values from.\n     */\n    copy(other) {\n        this.latitude = other.latitude;\n        this.longitude = other.longitude;\n        this.altitude = other.altitude;\n        return this;\n    }\n    /**\n     * Clones this `GeoCoordinates`.\n     * @deprecated\n     */\n    clone() {\n        return new GeoCoordinates(this.latitude, this.longitude, this.altitude);\n    }\n}\nexports.GeoCoordinates = GeoCoordinates;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/AnimatedExtrusionHandler\"));\n__export(require(\"./lib/CameraMovementDetector\"));\n__export(require(\"./lib/ColorCache\"));\n__export(require(\"./lib/MapViewPoints\"));\n__export(require(\"./lib/composing\"));\n__export(require(\"./lib/DataSource\"));\n__export(require(\"./lib/DecodedTileHelpers\"));\n__export(require(\"./lib/ElevationRangeSource\"));\n__export(require(\"./lib/image/Image\"));\n__export(require(\"./lib/image/ImageCache\"));\n__export(require(\"./lib/image/MapViewImageCache\"));\n__export(require(\"./lib/text/TextElement\"));\n__export(require(\"./lib/text/TextElementsRenderer\"));\n__export(require(\"./lib/text/TextStyleCache\"));\n__export(require(\"./lib/poi/Poi\"));\n__export(require(\"./lib/poi/PoiManager\"));\n__export(require(\"./lib/poi/PoiTableManager\"));\n__export(require(\"./lib/MapView\"));\n__export(require(\"./lib/MapViewFog\"));\n__export(require(\"./lib/PickHandler\"));\n__export(require(\"./lib/ConcurrentDecoderFacade\"));\n__export(require(\"./lib/ConcurrentTilerFacade\"));\n__export(require(\"./lib/WorkerBasedDecoder\"));\n__export(require(\"./lib/WorkerBasedTiler\"));\n__export(require(\"./lib/Tile\"));\n__export(require(\"./lib/TileDataAccessor\"));\n__export(require(\"./lib/TileGeometry\"));\n__export(require(\"./lib/Utils\"));\n__export(require(\"./lib/ThemeLoader\"));\n__export(require(\"./lib/RoadPicker\"));\n__export(require(\"./lib/Statistics\"));\n__export(require(\"./lib/DepthPrePass\"));\n__export(require(\"./lib/CopyrightInfo\"));\n__export(require(\"./lib/CopyrightElementHandler\"));\n__export(require(\"./lib/VisibleTileSet\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst DEG2RAD = Math.PI / 180;\nconst RAD2DEG = 180 / Math.PI;\nvar MathUtils;\n(function (MathUtils) {\n    /**\n     * Creates a new empty bounding box.\n     */\n    function newEmptyBox3() {\n        return {\n            min: { x: Infinity, y: Infinity, z: Infinity },\n            max: { x: -Infinity, y: -Infinity, z: -Infinity }\n        };\n    }\n    MathUtils.newEmptyBox3 = newEmptyBox3;\n    /**\n     * Set the components of the given [Vector3Like] instance.\n     *\n     * @param x The x component.\n     * @param y The y component.\n     * @param z The z component.\n     * @param v The [Vector3Like]\n     */\n    function newVector3(x, y, z, v) {\n        if (v === undefined) {\n            return { x, y, z };\n        }\n        v.x = x;\n        v.y = y;\n        v.z = z;\n        return v;\n    }\n    MathUtils.newVector3 = newVector3;\n    /**\n     * Converts an angle measured in degrees to an equivalent value in radians.\n     *\n     * @param degrees Value in degrees.\n     * @returns Value in radians.\n     */\n    function degToRad(degrees) {\n        return degrees * DEG2RAD;\n    }\n    MathUtils.degToRad = degToRad;\n    /**\n     * Converts an angle measured in radians to an equivalent value in degrees.\n     *\n     * @param degrees Value in radians.\n     * @returns Value in degrees.\n     */\n    function radToDeg(radians) {\n        return radians * RAD2DEG;\n    }\n    MathUtils.radToDeg = radToDeg;\n    /**\n     * Ensures that input value fits in a given range.\n     *\n     * @param value The value to be clamped.\n     * @param min Minimum value.\n     * @param max Maximum value.\n     * @returns Clamped value.\n     */\n    function clamp(value, min, max) {\n        return value < min ? min : value > max ? max : value;\n    }\n    MathUtils.clamp = clamp;\n    /**\n     * Normalize angle in degrees to range `[0, 360)`.\n     *\n     * @param a Angle in degrees.\n     * @returns Angle in degrees in range `[0, 360)`.\n     */\n    function normalizeAngleDeg(a) {\n        a = a % 360;\n        if (a < 0) {\n            a = a + 360;\n        }\n        return a;\n    }\n    MathUtils.normalizeAngleDeg = normalizeAngleDeg;\n    /**\n     * Return the minimal delta between angles `a` and `b` given in degrees.\n     *\n     * Equivalent to `a - b` in coordinate space with exception vector direction can be reversed\n     * that if `abs(a-b) > 180` because trip is shorter in 'other' direction.\n     *\n     * Useful when interpolating between `b` and `a` in angle space.\n     *\n     * @param a Start angle in degrees.\n     * @param b End angle in degrees.\n     * @returns Angle that that satisfies condition `a - b - d = 0` in angle space.\n     */\n    function angleDistanceDeg(a, b) {\n        a = normalizeAngleDeg(a);\n        b = normalizeAngleDeg(b);\n        const d = a - b;\n        if (d > 180) {\n            return d - 360;\n        }\n        else if (d <= -180) {\n            return d + 360;\n        }\n        else {\n            return d;\n        }\n    }\n    MathUtils.angleDistanceDeg = angleDistanceDeg;\n    /**\n     * Interpolate linearly between two angles given in degrees.\n     *\n     * @param p0 Angle from in degrees\n     * @param p1 Angle to in degrees\n     * @param t Interpolation factor (alpha), in range `0-1`.\n     */\n    function interpolateAnglesDeg(p0, p1, t) {\n        // hand crafted version,\n        // see stack for maybe better versions:\n        //    https://stackoverflow.com/questions/2708476/rotation-interpolation\n        const d = angleDistanceDeg(p1, p0);\n        const r = (p0 + d * t) % 360;\n        return r;\n    }\n    MathUtils.interpolateAnglesDeg = interpolateAnglesDeg;\n})(MathUtils = exports.MathUtils || (exports.MathUtils = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Returns true if the given object implements the interface [[OrientedBox3Like]].\n *\n * @param object The object.\n */\nfunction isOrientedBox3Like(object) {\n    const obb = object;\n    return (obb.position !== undefined &&\n        obb.xAxis !== undefined &&\n        obb.yAxis !== undefined &&\n        obb.zAxis !== undefined &&\n        obb.extents !== undefined);\n}\nexports.isOrientedBox3Like = isOrientedBox3Like;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * Unit of measurement used to specify a font's size.\n */\nvar FontUnit;\n(function (FontUnit) {\n    FontUnit[FontUnit[\"Em\"] = 0] = \"Em\";\n    FontUnit[FontUnit[\"Pixel\"] = 1] = \"Pixel\";\n    FontUnit[FontUnit[\"Point\"] = 2] = \"Point\";\n    FontUnit[FontUnit[\"Percent\"] = 3] = \"Percent\";\n})(FontUnit = exports.FontUnit || (exports.FontUnit = {}));\n/**\n * Style to be used when rendering glyphs.\n */\nvar FontStyle;\n(function (FontStyle) {\n    FontStyle[FontStyle[\"Regular\"] = 0] = \"Regular\";\n    FontStyle[FontStyle[\"Bold\"] = 1] = \"Bold\";\n    FontStyle[FontStyle[\"Italic\"] = 2] = \"Italic\";\n    FontStyle[FontStyle[\"BoldItalic\"] = 3] = \"BoldItalic\";\n})(FontStyle = exports.FontStyle || (exports.FontStyle = {}));\n/**\n * Variant to be used when rendering.\n */\nvar FontVariant;\n(function (FontVariant) {\n    FontVariant[FontVariant[\"Regular\"] = 0] = \"Regular\";\n    FontVariant[FontVariant[\"AllCaps\"] = 1] = \"AllCaps\";\n    FontVariant[FontVariant[\"SmallCaps\"] = 2] = \"SmallCaps\";\n})(FontVariant = exports.FontVariant || (exports.FontVariant = {}));\n/**\n * Vertical alignment to be used when placing text.\n */\nvar VerticalAlignment;\n(function (VerticalAlignment) {\n    VerticalAlignment[VerticalAlignment[\"Above\"] = 0] = \"Above\";\n    VerticalAlignment[VerticalAlignment[\"Center\"] = -0.5] = \"Center\";\n    VerticalAlignment[VerticalAlignment[\"Below\"] = -1] = \"Below\";\n})(VerticalAlignment = exports.VerticalAlignment || (exports.VerticalAlignment = {}));\n/**\n * Horizontal alignment to be used when placing text.\n */\nvar HorizontalAlignment;\n(function (HorizontalAlignment) {\n    HorizontalAlignment[HorizontalAlignment[\"Left\"] = 0] = \"Left\";\n    HorizontalAlignment[HorizontalAlignment[\"Center\"] = -0.5] = \"Center\";\n    HorizontalAlignment[HorizontalAlignment[\"Right\"] = -1] = \"Right\";\n})(HorizontalAlignment = exports.HorizontalAlignment || (exports.HorizontalAlignment = {}));\n/**\n * Text wrapping rule used when `lineWidth` is reached.\n */\nvar WrappingMode;\n(function (WrappingMode) {\n    WrappingMode[WrappingMode[\"None\"] = 0] = \"None\";\n    WrappingMode[WrappingMode[\"Character\"] = 1] = \"Character\";\n    WrappingMode[WrappingMode[\"Word\"] = 2] = \"Word\";\n})(WrappingMode = exports.WrappingMode || (exports.WrappingMode = {}));\n/**\n * Namespace containing default values for all members of [[TextRenderParameters]] and\n * [[TextLayoutParameters]].\n */\nvar DefaultTextStyle;\n(function (DefaultTextStyle) {\n    DefaultTextStyle.DEFAULT_FONT_NAME = \"\";\n    DefaultTextStyle.DEFAULT_FONT_SIZE = {\n        unit: Object.freeze(FontUnit.Pixel),\n        size: Object.freeze(16.0),\n        backgroundSize: Object.freeze(0.0)\n    };\n    DefaultTextStyle.DEFAULT_FONT_STYLE = FontStyle.Regular;\n    DefaultTextStyle.DEFAULT_FONT_VARIANT = FontVariant.Regular;\n    DefaultTextStyle.DEFAULT_ROTATION = 0.0;\n    DefaultTextStyle.DEFAULT_COLOR = new THREE.Color(0x000000);\n    DefaultTextStyle.DEFAULT_OPACITY = 1.0;\n    DefaultTextStyle.DEFAULT_BACKGROUND_COLOR = new THREE.Color(0x000000);\n    DefaultTextStyle.DEFAULT_BACKGROUND_OPACITY = 0.0;\n    DefaultTextStyle.DEFAULT_TRACKING = 0.0;\n    DefaultTextStyle.DEFAULT_LEADING = 0.0;\n    DefaultTextStyle.DEFAULT_MAX_LINES = Infinity;\n    DefaultTextStyle.DEFAULT_LINE_WIDTH = Infinity;\n    DefaultTextStyle.DEFAULT_LINE_ROTATION = 0.0;\n    DefaultTextStyle.DEFAULT_WRAPPING_MODE = WrappingMode.Word;\n    DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT = VerticalAlignment.Above;\n    DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT = HorizontalAlignment.Left;\n})(DefaultTextStyle = exports.DefaultTextStyle || (exports.DefaultTextStyle = {}));\n/**\n * [[TextCanvas]] text rendering style.\n */\nclass TextRenderStyle {\n    /**\n     * Creates a new `TextRenderStyle`.\n     *\n     * @param params Input [[TextRenderParameters]].\n     *\n     * @returns New `TextRenderStyle`.\n     */\n    constructor(params = {}) {\n        this.m_params = {\n            fontName: params.fontName !== undefined\n                ? params.fontName\n                : DefaultTextStyle.DEFAULT_FONT_NAME,\n            fontSize: params.fontSize !== undefined\n                ? params.fontSize\n                : {\n                    unit: DefaultTextStyle.DEFAULT_FONT_SIZE.unit,\n                    size: DefaultTextStyle.DEFAULT_FONT_SIZE.size,\n                    backgroundSize: DefaultTextStyle.DEFAULT_FONT_SIZE.backgroundSize\n                },\n            fontStyle: params.fontStyle !== undefined\n                ? params.fontStyle\n                : DefaultTextStyle.DEFAULT_FONT_STYLE,\n            fontVariant: params.fontVariant !== undefined\n                ? params.fontVariant\n                : DefaultTextStyle.DEFAULT_FONT_VARIANT,\n            rotation: params.rotation !== undefined ? params.rotation : DefaultTextStyle.DEFAULT_ROTATION,\n            color: params.color !== undefined\n                ? params.color\n                : new THREE.Color(DefaultTextStyle.DEFAULT_COLOR),\n            opacity: params.opacity !== undefined ? params.opacity : DefaultTextStyle.DEFAULT_OPACITY,\n            backgroundColor: params.backgroundColor !== undefined\n                ? params.backgroundColor\n                : new THREE.Color(DefaultTextStyle.DEFAULT_BACKGROUND_COLOR),\n            backgroundOpacity: params.backgroundOpacity !== undefined\n                ? params.backgroundOpacity\n                : DefaultTextStyle.DEFAULT_BACKGROUND_OPACITY\n        };\n    }\n    /**\n     * Current [[TextRenderParameters]] for this style.\n     */\n    get params() {\n        return this.m_params;\n    }\n    set params(value) {\n        this.m_params = Object.assign({}, this.m_params, value);\n    }\n    /**\n     * Name of the preferred [[Font]] to be used when rendering.\n     */\n    get fontName() {\n        return this.m_params.fontName;\n    }\n    set fontName(value) {\n        this.m_params.fontName = value;\n    }\n    /**\n     * Collection of unit and sizes to apply for the currently active [[Font]].\n     */\n    get fontSize() {\n        return this.m_params.fontSize;\n    }\n    set fontSize(value) {\n        this.m_params.fontSize = value;\n    }\n    /**\n     * Glyph style to apply for the currently active [[Font]].\n     */\n    get fontStyle() {\n        return this.m_params.fontStyle;\n    }\n    set fontStyle(value) {\n        this.m_params.fontStyle = value;\n    }\n    /**\n     * Glyph variant to apply for the currently active [[Font]].\n     */\n    get fontVariant() {\n        return this.m_params.fontVariant;\n    }\n    set fontVariant(value) {\n        this.m_params.fontVariant = value;\n    }\n    /**\n     * Glyph local rotation (radians).\n     */\n    get rotation() {\n        return this.m_params.rotation;\n    }\n    set rotation(value) {\n        this.m_params.rotation = value;\n    }\n    /**\n     * Glyph color.\n     */\n    get color() {\n        return this.m_params.color;\n    }\n    set color(value) {\n        this.m_params.color = value;\n    }\n    /**\n     * Glyph background color.\n     */\n    get backgroundColor() {\n        return this.m_params.backgroundColor;\n    }\n    set backgroundColor(value) {\n        this.m_params.backgroundColor = value;\n    }\n    /**\n     * Glyph opacity.\n     */\n    get opacity() {\n        return this.m_params.opacity;\n    }\n    set opacity(value) {\n        this.m_params.opacity = value;\n    }\n    /**\n     * Glyph background opacity.\n     */\n    get backgroundOpacity() {\n        return this.m_params.backgroundOpacity;\n    }\n    set backgroundOpacity(value) {\n        this.m_params.backgroundOpacity = value;\n    }\n    /**\n     * Clone this `TextRenderStyle`.\n     *\n     * @param params Input [[TextRenderParameters]].\n     *\n     * @returns Cloned `TextRenderStyle`.\n     */\n    clone(params = {}) {\n        return new TextRenderStyle(Object.assign({}, this.m_params, params));\n    }\n}\nexports.TextRenderStyle = TextRenderStyle;\n/**\n * [[TextCanvas]] text rendering style.\n */\nclass TextLayoutStyle {\n    /**\n     * Creates a new `TextLayoutStyle`.\n     *\n     * @param params Input [[TextLayoutParameters]].\n     *\n     * @returns New `TextLayoutStyle`.\n     */\n    constructor(params = {}) {\n        this.m_params = {\n            tracking: params.tracking !== undefined ? params.tracking : DefaultTextStyle.DEFAULT_TRACKING,\n            leading: params.leading !== undefined ? params.leading : DefaultTextStyle.DEFAULT_LEADING,\n            maxLines: params.maxLines !== undefined\n                ? params.maxLines\n                : DefaultTextStyle.DEFAULT_MAX_LINES,\n            lineWidth: params.lineWidth !== undefined\n                ? params.lineWidth\n                : DefaultTextStyle.DEFAULT_LINE_WIDTH,\n            lineRotation: params.lineRotation !== undefined\n                ? params.lineRotation\n                : DefaultTextStyle.DEFAULT_LINE_ROTATION,\n            wrappingMode: params.wrappingMode !== undefined\n                ? params.wrappingMode\n                : DefaultTextStyle.DEFAULT_WRAPPING_MODE,\n            verticalAlignment: params.verticalAlignment !== undefined\n                ? params.verticalAlignment\n                : DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,\n            horizontalAlignment: params.horizontalAlignment !== undefined\n                ? params.horizontalAlignment\n                : DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT\n        };\n    }\n    /**\n     * Current [[TextLayoutParameters]] for this style.\n     */\n    get params() {\n        return this.m_params;\n    }\n    set params(value) {\n        this.m_params = Object.assign({}, this.m_params, value);\n    }\n    /**\n     * Inter-glyph spacing (pixels). Scaled by [[FontSize]].\n     */\n    get tracking() {\n        return this.m_params.tracking;\n    }\n    set tracking(value) {\n        this.m_params.tracking = value;\n    }\n    /**\n     * Inter-line spacing (pixels). Scaled by [[FontSize]].\n     */\n    get leading() {\n        return this.m_params.leading;\n    }\n    set leading(value) {\n        this.m_params.leading = value;\n    }\n    /**\n     * Maximum number of lines to be considered when using [[TextCanvas]].\n     */\n    get maxLines() {\n        return this.m_params.maxLines;\n    }\n    set maxLines(value) {\n        this.m_params.maxLines = value;\n    }\n    /**\n     * Maximum line width (pixels).\n     */\n    get lineWidth() {\n        return this.m_params.lineWidth;\n    }\n    set lineWidth(value) {\n        this.m_params.lineWidth = value;\n    }\n    /**\n     * Line typesetting rotation (radians).\n     */\n    get lineRotation() {\n        return this.m_params.lineRotation;\n    }\n    set lineRotation(value) {\n        this.m_params.lineRotation = value;\n    }\n    /**\n     * Wrapping (line-breaking) mode.\n     */\n    get wrappingMode() {\n        return this.m_params.wrappingMode;\n    }\n    set wrappingMode(value) {\n        this.m_params.wrappingMode = value;\n    }\n    /**\n     * Text position regarding the baseline.\n     */\n    get verticalAlignment() {\n        return this.m_params.verticalAlignment;\n    }\n    set verticalAlignment(value) {\n        this.m_params.verticalAlignment = value;\n    }\n    /**\n     * Text position inside a line.\n     */\n    get horizontalAlignment() {\n        return this.m_params.horizontalAlignment;\n    }\n    set horizontalAlignment(value) {\n        this.m_params.horizontalAlignment = value;\n    }\n    /**\n     * Clone this `TextLayoutStyle`.\n     *\n     * @param params Input [[TextLayoutParameters]].\n     *\n     * @returns Cloned `TextLayoutStyle`.\n     */\n    clone(params = {}) {\n        return new TextLayoutStyle(Object.assign({}, this.m_params, params));\n    }\n}\nexports.TextLayoutStyle = TextLayoutStyle;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * Use `ColorCache` to reuse a color specified by name and save allocation as well as\n * setup time.\n *\n * Implemented as a singleton. Do not modify colors after getting them from the `ColorCache`.\n */\nclass ColorCache {\n    constructor() {\n        this.m_map = new Map();\n    }\n    /**\n     * Return instance of `ColorCache`.\n     */\n    static get instance() {\n        return this.m_instance;\n    }\n    /**\n     * Returns the color for the given `colorCode`. This function may reuse a previously generated\n     * color, so you cannot modify the contents of the color.\n     *\n     * @param colorCode ThreeJS color code or name. You must provide a valid color code or name,\n     * as this function does not do any validation.\n     */\n    getColor(colorCode) {\n        let color = this.m_map.get(colorCode);\n        if (color !== undefined) {\n            return color;\n        }\n        color = new THREE.Color(colorCode);\n        this.m_map.set(colorCode, color);\n        return color;\n    }\n    /**\n     * Returns the number of elements in the cache.\n     */\n    get size() {\n        return this.m_map.size;\n    }\n    /**\n     * Clears the cache. Only references to the THREE.Color are removed from the cache.\n     * Consequently, clearing the cache does not cause any negative visual impact.\n     */\n    clear() {\n        this.m_map.clear();\n    }\n}\nColorCache.m_instance = new ColorCache();\nexports.ColorCache = ColorCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst MapView_1 = require(\"./MapView\");\n/**\n * Animation states for extrusion effect\n */\nvar AnimatedExtrusionState;\n(function (AnimatedExtrusionState) {\n    AnimatedExtrusionState[AnimatedExtrusionState[\"None\"] = 0] = \"None\";\n    AnimatedExtrusionState[AnimatedExtrusionState[\"Started\"] = 1] = \"Started\";\n    AnimatedExtrusionState[AnimatedExtrusionState[\"Playing\"] = 2] = \"Playing\";\n    AnimatedExtrusionState[AnimatedExtrusionState[\"Finished\"] = 3] = \"Finished\";\n})(AnimatedExtrusionState = exports.AnimatedExtrusionState || (exports.AnimatedExtrusionState = {}));\n/**\n * Handles animated extrusion effect of the buildings in [[MapView]].\n */\nclass AnimatedExtrusionHandler {\n    /**\n     * Creates an [[AnimatedExtrusionHandler]] in [[MapView]].\n     *\n     * @param m_mapView Instance of [[MapView]] that passes `zoomLevel`\n     * through the `zoom` poperty update\n     */\n    constructor(m_mapView) {\n        this.m_mapView = m_mapView;\n        /**\n         * Animate the extrusion of the buildings if set to `true`.\n         */\n        this.enabled = true;\n        /**\n         * Duration of the building's extrusion in milliseconds\n         */\n        this.duration = 750;\n        /**\n         * If `forceEnabled` is set to `true` then `animateExtrusion` and `animateExtrusionDuration`\n         * values from [[extrudedPolygonTechnique]] will be ignored in [[Tile]] and\n         * `AnimatedExtrusionHandler.enabled` with `AnimatedExtrusionHandler.duration` will be used\n         */\n        this.forceEnabled = false;\n        this.m_tileHandlerMap = new Map();\n        this.m_zoomDirection = 0;\n        this.m_zoomLevelPrevious = this.m_mapView.zoomLevel;\n    }\n    /**\n     * Returns direction of the last zoom event.\n     * Zoom in - positive value, zoom out - negative value\n     */\n    get zoomDirection() {\n        return this.m_zoomDirection;\n    }\n    /**\n     * [[MapView]] updates zoom level. Then [[AnimatedExtrusionTileHandler]] calculates actual\n     * extrusion ratio and trigger animation\n     */\n    set zoom(zoomLevel) {\n        // if zoomLevel has been changed since last render\n        if (this.m_zoomLevelPrevious !== zoomLevel) {\n            this.m_tileHandlerMap.forEach(tileHandler => {\n                if (this.m_mapView.getDataSourceByName(tileHandler.tile.dataSource.name) !==\n                    undefined) {\n                    this.m_zoomDirection = zoomLevel > this.m_zoomLevelPrevious ? 1 : -1;\n                    tileHandler.zoomLevelChanged(this.m_zoomDirection);\n                }\n            });\n            this.m_zoomLevelPrevious = zoomLevel;\n        }\n    }\n    /**\n     * Checks whether animated extrusion effect was forcibly turned off/on in [[MapView]]\n     */\n    get forceAnimatedExtrusion() {\n        return this.m_forceAnimatedExtrusion;\n    }\n    /**\n     * If set to `true` it will force the animation extrusion effect to run.\n     * In case it was set to `false` animation extrusion effect will be switched off.\n     */\n    set forceAnimatedExtrusion(animatedExtrusion) {\n        this.m_forceAnimatedExtrusion = animatedExtrusion;\n    }\n    /**\n     * Returns `animatedExtrusionDuration` value that was set in [[MapView]].\n     */\n    get forceAnimatedExtrusionDuration() {\n        return this.m_forceAnimatedExtrusionDuration;\n    }\n    /**\n     * If value is set, it will overlap in [[Tile]] with\n     * `animatedExtrusionDuration` property from [[ExtrudedPolygonTechnique]]\n     * and `DEFAULT_DURATION` from [[AnimatedExtrusionTileHandler]].\n     */\n    set forceAnimatedExtrusionDuration(extrusionDuration) {\n        this.m_forceAnimatedExtrusionDuration = extrusionDuration;\n    }\n    /**\n     * Adds an [[AnimatedExtrusionTileHandler]] to [[AnimatedExtrusionHandler]]\n     */\n    add(tileHandler) {\n        this.m_tileHandlerMap.set(tileHandler.tile, tileHandler);\n    }\n    /**\n     * Removes tile from the list subscribed for extrusion ratio updates\n     */\n    removeTile(tile) {\n        this.m_tileHandlerMap.delete(tile);\n    }\n    /**\n     * Returns first [[AnimatedExtrusionTileHandler]] existed from the list of [[Tile]]s\n     */\n    find(tileKeys) {\n        for (const tileHandler of this.m_tileHandlerMap) {\n            for (const tileKey of tileKeys) {\n                if (tileKey !== undefined &&\n                    tileHandler[0].tileKey.mortonCode() === tileKey.mortonCode()) {\n                    return tileHandler[1];\n                }\n            }\n        }\n        return undefined;\n    }\n}\nexports.AnimatedExtrusionHandler = AnimatedExtrusionHandler;\n/**\n * Implements animated extrusion effect for the extruded objects in the [[Tile]]\n */\nclass AnimatedExtrusionTileHandler {\n    constructor(m_tile, extrudedObjects, m_animatedExtrusionDuration) {\n        this.m_tile = m_tile;\n        this.m_animatedExtrusionDuration = m_animatedExtrusionDuration;\n        this.m_extrudedObjects = [];\n        this.m_animatedExtrusionRatio = AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX;\n        this.m_animatedExtrusionState = AnimatedExtrusionState.None;\n        this.m_animatedExtrusionStartTime = undefined;\n        this.animateExtrusion = (event) => {\n            if (this.m_animatedExtrusionState !== AnimatedExtrusionState.Playing) {\n                if (this.m_animatedExtrusionState === AnimatedExtrusionState.Started) {\n                    this.m_animatedExtrusionState = AnimatedExtrusionState.Playing;\n                }\n                else {\n                    return;\n                }\n            }\n            const currentTime = Date.now();\n            if (this.m_animatedExtrusionStartTime === undefined ||\n                this.m_animatedExtrusionStartTime <= 0) {\n                this.m_animatedExtrusionStartTime = currentTime;\n            }\n            const timeProgress = Math.min(currentTime - this.m_animatedExtrusionStartTime, this.m_animatedExtrusionDuration);\n            this.extrusionRatio = harp_utils_1.MathUtils.easeInOutCubic(AnimatedExtrusionTileHandler.DEFAULT_RATIO_MIN, AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX, timeProgress / this.m_animatedExtrusionDuration);\n            if (timeProgress >= this.m_animatedExtrusionDuration) {\n                this.m_animatedExtrusionState = AnimatedExtrusionState.Finished;\n                this.stopExtrusionAnimation();\n            }\n            this.m_tile.dataSource.requestUpdate();\n        };\n        this.m_mapView = m_tile.mapView;\n        this.m_animatedExtrusionHandler = this.m_mapView.animatedExtrusionHandler;\n        extrudedObjects.forEach(extrudedObject => {\n            if (extrudedObject.materialFeature) {\n                harp_materials_1.ExtrusionFeature.addRenderHelper(extrudedObject.object);\n            }\n            this.m_extrudedObjects.push(extrudedObject.object);\n        });\n        this.startExtrusionAnimationIfNeeded(this.m_animatedExtrusionHandler.zoomDirection);\n    }\n    /**\n     * Set an extrusion ratio value for the materials [[MapMeshBasicMaterial]]\n     * and [[EdgeMaterial]]. Controlled by [[AnimatedExtrusionHandler]]\n     * for extrusion animation effect.\n     */\n    set extrusionRatio(value) {\n        this.m_animatedExtrusionRatio = value;\n        this.m_extrudedObjects.forEach(object => {\n            const material = object\n                .material;\n            material.extrusionRatio = this.m_animatedExtrusionRatio;\n        });\n    }\n    /**\n     * Returns the [[Tile]] related to [[AnimatedExtrusionTileHandler]]\n     */\n    get tile() {\n        return this.m_tile;\n    }\n    /**\n     * Return the current state of animated extrusion effect\n     */\n    get animationState() {\n        return this.m_animatedExtrusionState;\n    }\n    /**\n     * Cancel animation and remove from [[AnimatedExtrusionHandler]]\n     */\n    dispose() {\n        this.stopExtrusionAnimation();\n        this.m_animatedExtrusionHandler.removeTile(this.m_tile);\n    }\n    /**\n     * Start / Stop extrusion animation if zoom level was changed\n     */\n    zoomLevelChanged(zoomDirection) {\n        if (this.m_tile.isVisible === false &&\n            this.m_animatedExtrusionState !== AnimatedExtrusionState.None) {\n            this.m_animatedExtrusionState = AnimatedExtrusionState.None;\n            this.stopExtrusionAnimation();\n        }\n        if (this.m_tile.isVisible === true &&\n            this.m_animatedExtrusionState === AnimatedExtrusionState.None) {\n            this.startExtrusionAnimationIfNeeded(zoomDirection);\n        }\n    }\n    getChildTiles(tileKeys) {\n        let result = [];\n        tileKeys.forEach(tileKey => {\n            const dataSource = this.tile.dataSource;\n            const childTileKeys = dataSource.getTilingScheme().getSubTileKeys(tileKey);\n            result = result.concat(childTileKeys);\n        });\n        return result;\n    }\n    // search for the [[Tile]] with extrusion animation started\n    startExtrusionAnimationIfNeeded(zoomDirection) {\n        const { quadTreeSearchDistanceUp, quadTreeSearchDistanceDown } = this.tile.mapView.visibleTileSet.options;\n        const tile = this.m_tile;\n        let extrusionStartTime;\n        if (zoomDirection !== undefined) {\n            let tileHandler;\n            // if zoom out, go down and look for a child tile\n            if (zoomDirection < 0) {\n                let nextLevelDiff = 0;\n                let tileKeys = [tile.tileKey];\n                while (quadTreeSearchDistanceDown > nextLevelDiff &&\n                    extrusionStartTime === undefined) {\n                    const childTileKeys = this.getChildTiles(tileKeys);\n                    if (childTileKeys !== undefined) {\n                        tileHandler = this.m_animatedExtrusionHandler.find(childTileKeys);\n                        if (tileHandler !== undefined) {\n                            extrusionStartTime = tileHandler.m_animatedExtrusionStartTime;\n                            break;\n                        }\n                        tileKeys = childTileKeys;\n                    }\n                    nextLevelDiff++;\n                }\n            }\n            // if zoom in, go up and get the parent tile\n            if (zoomDirection > 0) {\n                let nextLevelDiff = 0;\n                let tileKey = tile.tileKey;\n                while (quadTreeSearchDistanceUp > nextLevelDiff &&\n                    extrusionStartTime === undefined &&\n                    tileKey.level !== 0) {\n                    const parentTileKey = tileKey.parent();\n                    tileHandler = this.m_animatedExtrusionHandler.find([parentTileKey]);\n                    if (tileHandler !== undefined) {\n                        extrusionStartTime = tileHandler.m_animatedExtrusionStartTime;\n                        break;\n                    }\n                    tileKey = parentTileKey;\n                    nextLevelDiff++;\n                }\n            }\n        }\n        this.startExtrusionAnimation(extrusionStartTime);\n    }\n    startExtrusionAnimation(startTime) {\n        this.m_animatedExtrusionState = AnimatedExtrusionState.Started;\n        this.m_animatedExtrusionStartTime = startTime;\n        this.animateExtrusion();\n        this.m_mapView.addEventListener(MapView_1.MapViewEventNames.AfterRender, this.animateExtrusion);\n    }\n    stopExtrusionAnimation() {\n        this.m_mapView.removeEventListener(MapView_1.MapViewEventNames.AfterRender, this.animateExtrusion);\n    }\n}\n/**\n * Minimum ratio value for extrusion effect\n */\nAnimatedExtrusionTileHandler.DEFAULT_RATIO_MIN = 0.001;\n/**\n * Maximum ratio value for extrusion effect\n */\nAnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX = 1;\nexports.AnimatedExtrusionTileHandler = AnimatedExtrusionTileHandler;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoCoordinates_1 = require(\"./GeoCoordinates\");\nconst DEG2RAD = Math.PI / 180;\n/**\n * `GeoBox` is used to represent a bounding box in geo coordinates.\n */\nclass GeoBox {\n    /**\n     * Constructs a new `GeoBox` with the given geo coordinates.\n     *\n     * @param southWest The south west position in geo coordinates.\n     * @param northEast The north east position in geo coordinates.\n     */\n    constructor(southWest, northEast) {\n        this.southWest = southWest;\n        this.northEast = northEast;\n    }\n    /**\n     * Returns a `GeoBox` with the given geo coordinates.\n     *\n     * @param southWest The south west position in geo coordinates.\n     * @param northEast The north east position in geo coordinates.\n     */\n    static fromCoordinates(southWest, northEast) {\n        return new GeoBox(southWest, northEast);\n    }\n    /**\n     * Returns the minimum altitude or `undefined`.\n     */\n    get minAltitude() {\n        if (this.southWest.altitude === undefined || this.northEast.altitude === undefined) {\n            return undefined;\n        }\n        return Math.min(this.southWest.altitude, this.northEast.altitude);\n    }\n    /**\n     * Returns the maximum altitude or `undefined`.\n     */\n    get maxAltitude() {\n        if (this.southWest.altitude === undefined || this.northEast.altitude === undefined) {\n            return undefined;\n        }\n        return Math.max(this.southWest.altitude, this.northEast.altitude);\n    }\n    /**\n     * Returns the south latitude in degrees of this `GeoBox`.\n     */\n    get south() {\n        return this.southWest.latitude;\n    }\n    /**\n     * Returns the north altitude in degrees of this `GeoBox`.\n     */\n    get north() {\n        return this.northEast.latitude;\n    }\n    /**\n     * Returns the west longitude in degrees of this `GeoBox`.\n     */\n    get west() {\n        return this.southWest.longitude;\n    }\n    /**\n     * Returns the east longitude in degrees of this `GeoBox`.\n     */\n    get east() {\n        return this.northEast.longitude;\n    }\n    /**\n     * Returns the center of this `GeoBox`.\n     */\n    get center() {\n        const latitude = (this.south + this.north) * 0.5;\n        const { west, east } = this;\n        const { minAltitude, altitudeSpan } = this;\n        let altitude;\n        if (minAltitude !== undefined && altitudeSpan !== undefined) {\n            altitude = minAltitude + altitudeSpan * 0.5;\n        }\n        if (west < east) {\n            return new GeoCoordinates_1.GeoCoordinates(latitude, (west + east) * 0.5, altitude);\n        }\n        let longitude = (360 + east + west) * 0.5;\n        if (longitude > 360) {\n            longitude -= 360;\n        }\n        return new GeoCoordinates_1.GeoCoordinates(latitude, longitude, altitude);\n    }\n    /**\n     * Returns the latitude span in radians.\n     */\n    get latitudeSpanInRadians() {\n        return this.latitudeSpan * DEG2RAD;\n    }\n    /**\n     * Returns the longitude span in radians.\n     */\n    get longitudeSpanInRadians() {\n        return this.longitudeSpan * DEG2RAD;\n    }\n    /**\n     * Returns the latitude span in degrees.\n     */\n    get latitudeSpan() {\n        return this.north - this.south;\n    }\n    get altitudeSpan() {\n        if (this.maxAltitude === undefined || this.minAltitude === undefined) {\n            return undefined;\n        }\n        return this.maxAltitude - this.minAltitude;\n    }\n    /**\n     * Returns the longitude span in degrees.\n     */\n    get longitudeSpan() {\n        let width = this.northEast.longitude - this.southWest.longitude;\n        if (width < 0) {\n            width += 360;\n        }\n        return width;\n    }\n    /**\n     * Returns the latitude span in degrees.\n     * @deprecated Use [[latitudeSpan]] instead.\n     */\n    get latitudeSpanInDegrees() {\n        return this.latitudeSpan;\n    }\n    /**\n     * Returns the longitude span in degrees.\n     * @deprecated Use [[longitudeSpan]] instead.\n     */\n    get longitudeSpanInDegrees() {\n        return this.longitudeSpan;\n    }\n    /**\n     * Returns `true` if the given geo coordinates are contained in this `GeoBox`.\n     *\n     * @param point The geo coordinates.\n     */\n    contains(point) {\n        if (point.altitude === undefined ||\n            this.minAltitude === undefined ||\n            this.maxAltitude === undefined) {\n            return this.containsHelper(point);\n        }\n        const isFlat = this.minAltitude === this.maxAltitude;\n        const isSameAltitude = this.minAltitude === point.altitude;\n        const isWithinAltitudeRange = this.minAltitude <= point.altitude && this.maxAltitude > point.altitude;\n        // If box is flat, we should check the altitude and containment,\n        // otherwise we should check also altitude difference where we consider\n        // point to be inside if alt is from [m_minAltitude, m_maxAltitude) range!\n        if (isFlat ? isSameAltitude : isWithinAltitudeRange) {\n            return this.containsHelper(point);\n        }\n        return false;\n    }\n    /**\n     * Clones this `GeoBox` instance.\n     */\n    clone() {\n        return new GeoBox(this.southWest, this.northEast);\n    }\n    /**\n     * Update the bounding box by considering a given point.\n     *\n     * @param point The point that may expand the bounding box.\n     */\n    growToContain(point) {\n        this.southWest.latitude = Math.min(this.southWest.latitude, point.latitude);\n        this.southWest.longitude = Math.min(this.southWest.longitude, point.longitude);\n        this.southWest.altitude =\n            this.southWest.altitude !== undefined && point.altitude !== undefined\n                ? Math.min(this.southWest.altitude, point.altitude)\n                : this.southWest.altitude !== undefined\n                    ? this.southWest.altitude\n                    : point.altitude !== undefined\n                        ? point.altitude\n                        : undefined;\n        this.northEast.latitude = Math.max(this.northEast.latitude, point.latitude);\n        this.northEast.longitude = Math.max(this.northEast.longitude, point.longitude);\n        this.northEast.altitude =\n            this.northEast.altitude !== undefined && point.altitude !== undefined\n                ? Math.max(this.northEast.altitude, point.altitude)\n                : this.northEast.altitude !== undefined\n                    ? this.northEast.altitude\n                    : point.altitude !== undefined\n                        ? point.altitude\n                        : undefined;\n    }\n    containsHelper(point) {\n        if (point.latitude < this.southWest.latitude || point.latitude >= this.northEast.latitude) {\n            return false;\n        }\n        const { west, east } = this;\n        if (east > west) {\n            return point.longitude >= west && point.longitude < east;\n        }\n        return point.longitude > east || point.longitude <= west;\n    }\n}\nexports.GeoBox = GeoBox;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass EarthConstants {\n}\n/** The equatorial circumference in meters. */\nEarthConstants.EQUATORIAL_CIRCUMFERENCE = 40075016.6855784861531768177614;\n/** The equatorial radius in meters. */\nEarthConstants.EQUATORIAL_RADIUS = 6378137.0;\n/** The lowest point on earth (Dead Sea) in meters. */\nEarthConstants.MIN_ELEVATION = -433.0;\n/** The highest point on earth (Mt. Everest) in meters. */\nEarthConstants.MAX_ELEVATION = 8848.0;\nexports.EarthConstants = EarthConstants;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Returns true if the given object implements the [[Box3Like]] interface.\n *\n * @param object A valid object.\n */\nfunction isBox3Like(object) {\n    const box3 = object;\n    return box3.min !== undefined && box3.max !== undefined;\n}\nexports.isBox3Like = isBox3Like;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The type of projection.\n */\nvar ProjectionType;\n(function (ProjectionType) {\n    /**\n     * A type of [Projection] with zero curvature.\n     */\n    ProjectionType[ProjectionType[\"Planar\"] = 0] = \"Planar\";\n    /**\n     * A spherical [Projection].\n     */\n    ProjectionType[ProjectionType[\"Spherical\"] = 1] = \"Spherical\";\n})(ProjectionType = exports.ProjectionType || (exports.ProjectionType = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst geoUtils = require(\"@here/harp-geoutils\");\nconst EarthConstants_1 = require(\"@here/harp-geoutils/lib/projection/EarthConstants\");\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst Tile_1 = require(\"./Tile\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"MapViewUtils\");\n// Estimation of the size of an Object3D with all the simple properties, like matrices and flags.\n// There may be cases where it is possible to construct Object3Ds with considerable less memory\n// consumption, but this value is used to simplify the estimation.\nconst MINIMUM_OBJECT3D_SIZE_ESTIMATION = 1000;\nconst MINIMUM_ATTRIBUTE_SIZE_ESTIMATION = 56;\nvar MapViewUtils;\n(function (MapViewUtils) {\n    //Caching those for performance reasons.\n    const groundPlane = new THREE.Plane(new THREE.Vector3(0, 0, 1));\n    const cameraZPosition = new THREE.Vector3(0, 0, 0);\n    const rotationMatrix = new THREE.Matrix4();\n    const unprojectionMatrix = new THREE.Matrix4();\n    const rayCaster = new THREE.Raycaster();\n    /**\n     * Yaw rotation as quaternion. Declared as a const to avoid object re-creation in certain\n     * functions.\n     */\n    const yawQuaternion = new THREE.Quaternion();\n    /**\n     * Pitch rotation as quaternion. Declared as a const to avoid object re-creation in certain\n     *  functions.\n     */\n    const pitchQuaternion = new THREE.Quaternion();\n    /**\n     * The yaw axis around we rotate when we change the yaw.\n     * This axis is fix and is the -Z axis `(0,0,1)`.\n     */\n    const yawAxis = new THREE.Vector3(0, 0, 1);\n    /**\n     * The pitch axis which we use to rotate around when we change the pitch.\n     * The axis is fix and is the +X axis `(1,0,0)`.\n     */\n    const pitchAxis = new THREE.Vector3(1, 0, 0);\n    /**\n     * Zooms and moves the map in such a way that the given target position remains at the same\n     * position after the zoom.\n     *\n     * @param mapView Instance of MapView\n     * @param targetPositionOnScreenXinNDC Target x position in NDC space.\n     * @param targetPositionOnScreenYinNDC Target y position in NDC space.\n     */\n    function zoomOnTargetPosition(mapView, targetPositionOnScreenXinNDC, targetPositionOnScreenYinNDC, zoomLevel) {\n        //Get current target position in world space before we zoom.\n        const targetPosition = rayCastWorldCoordinates(mapView, targetPositionOnScreenXinNDC, targetPositionOnScreenYinNDC);\n        //Set the cameras height according to the given zoom level.\n        mapView.camera.position.setZ(calculateDistanceToGroundFromZoomLevel(mapView, zoomLevel));\n        mapView.camera.matrixWorldNeedsUpdate = true;\n        //Get new target position after the zoom\n        const newTargetPosition = rayCastWorldCoordinates(mapView, targetPositionOnScreenXinNDC, targetPositionOnScreenYinNDC);\n        if (!targetPosition || !newTargetPosition) {\n            return;\n        }\n        //Calculate the difference and pan the map to maintain\n        //the map relative to the target position.\n        const diff = targetPosition.sub(newTargetPosition);\n        pan(mapView, diff.x, diff.y);\n    }\n    MapViewUtils.zoomOnTargetPosition = zoomOnTargetPosition;\n    /**\n     * Returns the [[GeoCoordinates]] of the camera, given its target coordinates on the map and its\n     * zoom, yaw and pitch.\n     *\n     * @param targetCoordinates Coordinates of the center of the view.\n     * @param zoom Zoom level.\n     * @param yaw Camera yaw.\n     * @param pitch Camera pitch.\n     * @param mapView Active MapView, needed to get the camera fov and map projection.\n     */\n    function getCameraCoordinatesFromTargetCoordinates(targetCoordinates, zoom, yawDeg, pitchDeg, mapView) {\n        // Get the world distance between the target and the camera.\n        const worldCameraHeight = calculateDistanceToGroundFromZoomLevel(mapView, zoom);\n        const pitchRad = THREE.Math.degToRad(pitchDeg);\n        const worldTargetCameraDistance = worldCameraHeight * Math.tan(pitchRad);\n        // Get the camera coordinates.\n        const yawRad = THREE.Math.degToRad(yawDeg);\n        const worldTargetCoordinates = mapView.projection.projectPoint(targetCoordinates);\n        const cameraWorldCoordinates = {\n            x: worldTargetCoordinates.x + Math.sin(yawRad) * worldTargetCameraDistance,\n            y: worldTargetCoordinates.y - Math.cos(yawRad) * worldTargetCameraDistance,\n            z: 0\n        };\n        // Convert back to GeoCoordinates and return result.\n        return mapView.projection.unprojectPoint(cameraWorldCoordinates);\n    }\n    MapViewUtils.getCameraCoordinatesFromTargetCoordinates = getCameraCoordinatesFromTargetCoordinates;\n    /**\n     * Casts a ray in NDC space from the current map view and returns the intersection point of that\n     * ray wih the map in world space, or `null` in case the raycast failed.\n     *\n     * @param mapView Instance of MapView.\n     * @param pointOnScreenXinNDC X coordinate in NDC space.\n     * @param pointOnScreenYinNDC Y coordinate in NDC space.\n     * @returns Intersection coordinates, or `null` if raycast failed.\n     */\n    function rayCastWorldCoordinates(mapView, pointOnScreenXinNDC, pointOnScreenYinNDC) {\n        const pointInNDCPosition = new THREE.Vector3(pointOnScreenXinNDC, pointOnScreenYinNDC, 0.5);\n        const worldPosition = mapView.worldCenter;\n        cameraZPosition.copy(mapView.camera.position);\n        rotationMatrix.extractRotation(mapView.camera.matrixWorld);\n        //Prepare the unprojection matrix which projects from NDC space to camera space\n        //and takes the current rotation of the camera into account.\n        unprojectionMatrix.multiplyMatrices(rotationMatrix, unprojectionMatrix.getInverse(mapView.camera.projectionMatrix));\n        //Unproject the point via the the unprojection matrix.\n        const pointInCameraSpace = pointInNDCPosition.applyMatrix4(unprojectionMatrix);\n        //Use the point in camera space as the vector towards this point.\n        rayCaster.set(cameraZPosition, pointInCameraSpace.normalize());\n        const vec3 = new THREE.Vector3();\n        const rayGroundPlaneIntersectionPosition = rayCaster.ray.intersectPlane(groundPlane, vec3);\n        if (!rayGroundPlaneIntersectionPosition) {\n            return null;\n        }\n        //Because our camera does not really move, besides going up and down,\n        //the intersection point is relative to the camera.\n        //To get them in into world space, we add the cameras world space position.\n        rayGroundPlaneIntersectionPosition.setX(rayGroundPlaneIntersectionPosition.x + worldPosition.x);\n        rayGroundPlaneIntersectionPosition.setY(rayGroundPlaneIntersectionPosition.y + worldPosition.y);\n        return rayGroundPlaneIntersectionPosition;\n    }\n    MapViewUtils.rayCastWorldCoordinates = rayCastWorldCoordinates;\n    /**\n     * Calculates and returns the distance from the ground,\n     * which is needed to put the camera to this\n     * height, to see the size of the area, which would be covered\n     * by one tile for the given zoom level.\n     *\n     * @param mapView Instance of MapView.\n     * @param zoomLevel\n     */\n    function calculateDistanceToGroundFromZoomLevel(mapView, zoomLevel) {\n        const cameraPitch = extractYawPitchRoll(mapView.camera.quaternion).pitch;\n        const tileSize = EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE / Math.pow(2, zoomLevel);\n        return ((mapView.focalLength * tileSize) / 256) * Math.cos(cameraPitch);\n    }\n    MapViewUtils.calculateDistanceToGroundFromZoomLevel = calculateDistanceToGroundFromZoomLevel;\n    /**\n     * Pans the map underneath camera according to the given offset in world space coordinates.\n     *\n     * @param mapView Instance of MapView.\n     * @param xOffset In world space. Value > 0 will pan the map to the right, value < 0 will pan\n     * the map to the left in default camera orientation.\n     * @param yOffset In world space. Value > 0 will pan the map upwards, value < 0 will pan the map\n     * downwards in default camera orientation.\n     */\n    function pan(mapView, offsetX, offsetY) {\n        const currentWorldPosition = mapView.worldCenter;\n        currentWorldPosition.setX(currentWorldPosition.x + offsetX);\n        currentWorldPosition.setY(currentWorldPosition.y + offsetY);\n        mapView.update();\n    }\n    MapViewUtils.pan = pan;\n    /**\n     * Sets the rotation of the camera according to yaw and pitch in degrees.\n     *\n     * **Note:** `yaw == 0 && pitch == 0` will north up the map and you will look downwards onto the\n     * map.\n     *\n     * @param mapView Instance of MapView.\n     * @param yaw Yaw in degrees.\n     * @param pitch Pitch in degrees.\n     */\n    function setRotation(mapView, yaw, pitch) {\n        yawQuaternion.setFromAxisAngle(yawAxis, geoUtils.MathUtils.degToRad(yaw));\n        pitchQuaternion.setFromAxisAngle(pitchAxis, geoUtils.MathUtils.degToRad(pitch));\n        yawQuaternion.multiply(pitchQuaternion);\n        mapView.camera.quaternion.copy(yawQuaternion);\n        mapView.camera.matrixWorldNeedsUpdate = true;\n    }\n    MapViewUtils.setRotation = setRotation;\n    /**\n     * Extracts yaw, pitch, and roll rotation in radians.\n     * - Yaw : Rotation around the Z axis `(0,0,1)`.\n     * - Pitch :Rotation around the X axis `(1,0,0)`.\n     * - Roll : Rotation around the Y axis `(0,1,0)`.\n     *\n     * @see https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles\n     *\n     * @param q : Quaternion that represents the given rotation\n     * from which to extract the yaw, roll, and pitch.\n     */\n    function extractYawPitchRoll(q) {\n        const ysqr = q.y * q.y;\n        // pitch (x-axis rotation)\n        const t0 = +2.0 * (q.w * q.x + q.y * q.z);\n        const t1 = +1.0 - 2.0 * (q.x * q.x + ysqr);\n        const pitch = Math.atan2(t0, t1);\n        // roll (y-axis rotation)\n        let t2 = +2.0 * (q.w * q.y - q.z * q.x);\n        t2 = t2 > 1.0 ? 1.0 : t2;\n        t2 = t2 < -1.0 ? -1.0 : t2;\n        const roll = Math.asin(t2);\n        // yaw (z-axis rotation)\n        const t3 = +2.0 * (q.w * q.z + q.x * q.y);\n        const t4 = +1.0 - 2.0 * (ysqr + q.z * q.z);\n        const yaw = Math.atan2(t3, t4);\n        return { yaw, pitch, roll };\n    }\n    MapViewUtils.extractYawPitchRoll = extractYawPitchRoll;\n    /**\n     * Casts a ray in NDC space from the current view of the camera and returns the intersection\n     * point of that ray against the map in geo coordinates. The return value can be `null` when\n     * the raycast is above the horizon.\n     *\n     * @param mapView Instance of MapView.\n     * @param pointOnScreenNDC  Point in NDC space.\n     * @returns Intersection geo coordinates, or `null` if raycast is above the horizon.\n     */\n    function rayCastGeoCoordinates(mapView, pointOnScreenXinNDC, pointOnScreenYinNDC) {\n        const worldCoordinates = rayCastWorldCoordinates(mapView, pointOnScreenXinNDC, pointOnScreenYinNDC);\n        if (!worldCoordinates) {\n            return null;\n        }\n        return mapView.projection.unprojectPoint(worldCoordinates);\n    }\n    MapViewUtils.rayCastGeoCoordinates = rayCastGeoCoordinates;\n    /**\n     * Calculates the zoom level, which corresponds to the current distance from\n     * camera to lookAt point.\n     * Therefore the zoom level is a `float` and not an `int`. The height of the camera can be in\n     * between zoom levels. By setting the zoom level, you change the height position of the camera\n     * in away that the field of view of the camera should be able to cover one tile for the given\n     * zoom level.\n     *\n     * As an example for this, when you have a tile of zoom level 14 in front of the camera and you\n     * set the zoom level of the camera to 14, then you are able to see the whole tile in front of\n     * you.\n     */\n    function calculateZoomLevelFromDistance(distance, mapView) {\n        const tileSize = (256 * distance) / mapView.focalLength;\n        return geoUtils.MathUtils.clamp(Math.log2(EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE / tileSize), mapView.minZoomLevel, mapView.maxZoomLevel);\n    }\n    MapViewUtils.calculateZoomLevelFromDistance = calculateZoomLevelFromDistance;\n    /**\n     * Translates a linear clip-space distance value to the actual value stored in the depth buffer.\n     * This is useful as the depth values are not stored in the depth buffer linearly, and this can\n     * lead into confusing behavior when not taken into account.\n     *\n     * @param clipDistance Distance from the camera in clip space (range: [0, 1]).\n     * @param camera Camera applying the perspective projection.\n     */\n    function calculateDepthFromClipDistance(clipDistance, camera) {\n        const perspCam = camera;\n        const cameraRange = perspCam.far - perspCam.near;\n        const viewSpaceDistance = clipDistance * perspCam.far;\n        return (1.0 - perspCam.near / viewSpaceDistance) * (perspCam.far / cameraRange);\n    }\n    MapViewUtils.calculateDepthFromClipDistance = calculateDepthFromClipDistance;\n    /**\n     * Translates a linear distance value [0..1], where 1 is the distance to the far plane, into\n     * [0..cameraFar].\n     *\n     * @param distance Distance from the camera (range: [0, 1]).\n     * @param camera Camera applying the perspective projection.\n     */\n    function cameraToWorldDistance(distance, camera) {\n        const perspCam = camera;\n        return distance * perspCam.far;\n    }\n    MapViewUtils.cameraToWorldDistance = cameraToWorldDistance;\n    /**\n     * Calculates vertical field of view for given horizontal field of vision and aspect ratio.\n     *\n     * @param hFov Horizontal field of view in rad.\n     * @param aspect Aspect ratio.\n     */\n    function calculateVerticalFovByHorizontalFov(hFov, aspect) {\n        return 2 * Math.atan(Math.tan(hFov / 2) / aspect);\n    }\n    MapViewUtils.calculateVerticalFovByHorizontalFov = calculateVerticalFovByHorizontalFov;\n    /**\n     * Calculates horizontal field of view for given vertical field of vision and aspect ratio.\n     *\n     * @param hFov Vertical field of view in rad.\n     * @param aspect Aspect ratio.\n     */\n    function calculateHorizontalFovByVerticalFov(vFov, aspect) {\n        return 2 * Math.atan(Math.tan(vFov / 2) * aspect);\n    }\n    MapViewUtils.calculateHorizontalFovByVerticalFov = calculateHorizontalFovByVerticalFov;\n    /**\n     * Calculates the focal length based on the vertical FOV and height.\n     *\n     * @param vFov Vertical field of view in rad.\n     * @param height Height of canvas in pixels.\n     */\n    function calculateFocalLengthByVerticalFov(vFov, height) {\n        return height / 2 / Math.tan(vFov / 2);\n    }\n    MapViewUtils.calculateFocalLengthByVerticalFov = calculateFocalLengthByVerticalFov;\n    /**\n     * Calculates the vertical field of view based on the focal length and the height.\n     *\n     * @param focalLength Focal length in pixels (see [[calculateFocalLengthByVerticalFov]])\n     * @param height Height of canvas in pixels.\n     */\n    function calculateFovByFocalLength(focalLength, height) {\n        return geoUtils.MathUtils.radToDeg(2 * Math.atan(height / 2 / focalLength));\n    }\n    MapViewUtils.calculateFovByFocalLength = calculateFovByFocalLength;\n    /**\n     * Calculates object's screen size based on the focal length and it's camera distance.\n     *\n     * @param focalLength Focal length in pixels (see [[calculateFocalLengthByVerticalFov]])\n     * @param distance Object distance in world space.\n     * @param worldSize Object size in world space.\n     * @return object size in screen space.\n     */\n    function calculateScreenSizeByFocalLength(focalLength, distance, worldSize) {\n        return (focalLength * worldSize) / distance;\n    }\n    MapViewUtils.calculateScreenSizeByFocalLength = calculateScreenSizeByFocalLength;\n    /**\n     * Calculates object's world size based on the focal length and it's camera distance.\n     *\n     * @param focalLength Focal length in pixels (see [[calculateFocalLengthByVerticalFov]])\n     * @param distance Object distance in world space.\n     * @param screenSize Object size in screen space.\n     * @return object size in world space.\n     */\n    function calculateWorldSizeByFocalLength(focalLength, distance, screenSize) {\n        return (distance * screenSize) / focalLength;\n    }\n    MapViewUtils.calculateWorldSizeByFocalLength = calculateWorldSizeByFocalLength;\n    /**\n     * Computes estimate for size of a THREE.Object3D object and its children. Shared materials\n     * and/or attributes will be counted multiple times.\n     *\n     * @param object The mesh object to evaluate\n     * @param size The [[MemoryUsage]] to update.\n     * @param visitedObjects Optional map to store large objects that could be shared.\n     *\n     * @returns Estimate of object size in bytes for heap and GPU.\n     */\n    function estimateObject3dSize(object, parentSize, visitedObjects) {\n        const size = parentSize !== undefined\n            ? parentSize\n            : {\n                heapSize: 0,\n                gpuSize: 0\n            };\n        if (visitedObjects === undefined) {\n            visitedObjects = new Map();\n        }\n        estimateMeshSize(object, size, visitedObjects);\n        if (object.children.length > 0) {\n            for (const child of object.children) {\n                estimateObject3dSize(child, size, visitedObjects);\n            }\n        }\n        return size;\n    }\n    MapViewUtils.estimateObject3dSize = estimateObject3dSize;\n    function estimateTextureSize(texture, objectSize, visitedObjects) {\n        if (texture === null || texture.image === undefined) {\n            return;\n        }\n        if (texture.uuid !== undefined && visitedObjects.get(texture.uuid) === true) {\n            return;\n        }\n        visitedObjects.set(texture.uuid, true);\n        // May be HTMLImage or ImageData\n        const image = texture.image;\n        // Assuming RGBA\n        const imageBytes = 4 * image.width * image.height;\n        objectSize.heapSize += imageBytes;\n        objectSize.gpuSize += imageBytes;\n    }\n    function estimateMaterialSize(material, objectSize, visitedObjects) {\n        if (material.uuid !== undefined && visitedObjects.get(material.uuid) === true) {\n            return;\n        }\n        visitedObjects.set(material.uuid, true);\n        if (material instanceof THREE.RawShaderMaterial ||\n            material instanceof THREE.ShaderMaterial) {\n            const rawMaterial = material;\n            for (const name in rawMaterial.uniforms) {\n                if (rawMaterial.uniforms[name] !== undefined) {\n                    const uniform = rawMaterial.uniforms[name];\n                    if (uniform instanceof THREE.Texture) {\n                        estimateTextureSize(uniform, objectSize, visitedObjects);\n                    }\n                }\n            }\n        }\n        else if (material instanceof THREE.MeshBasicMaterial ||\n            material instanceof harp_materials_1.MapMeshBasicMaterial) {\n            const meshMaterial = material;\n            estimateTextureSize(meshMaterial.map, objectSize, visitedObjects);\n            estimateTextureSize(meshMaterial.aoMap, objectSize, visitedObjects);\n            estimateTextureSize(meshMaterial.specularMap, objectSize, visitedObjects);\n            estimateTextureSize(meshMaterial.alphaMap, objectSize, visitedObjects);\n            estimateTextureSize(meshMaterial.envMap, objectSize, visitedObjects);\n        }\n        else if (material instanceof harp_materials_1.MapMeshStandardMaterial) {\n            const standardMaterial = material;\n            estimateTextureSize(standardMaterial.map, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.lightMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.aoMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.emissiveMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.bumpMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.normalMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.displacementMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.roughnessMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.metalnessMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.alphaMap, objectSize, visitedObjects);\n            estimateTextureSize(standardMaterial.envMap, objectSize, visitedObjects);\n        }\n        else if (material instanceof THREE.LineBasicMaterial ||\n            material instanceof THREE.LineDashedMaterial) {\n            // Nothing to be done here\n        }\n        else {\n            logger.warn(\"estimateMeshSize: unidentified material: \", material);\n        }\n    }\n    function estimateAttributeSize(attribute, attrName, objectSize, visitedObjects) {\n        // Attributes (apparently) do not have their uuid set up.\n        if (attribute.uuid === undefined) {\n            attribute.uuid = THREE.Math.generateUUID();\n        }\n        if (visitedObjects.get(attribute.uuid) === true) {\n            return;\n        }\n        visitedObjects.set(attribute.uuid, true);\n        let attrBytes = 0;\n        let bytesPerElement = 4;\n        if (attribute.array.BYTES_PER_ELEMENT !== undefined) {\n            bytesPerElement = attribute.array.BYTES_PER_ELEMENT;\n        }\n        if (attribute instanceof THREE.InterleavedBufferAttribute ||\n            attribute instanceof THREE.BufferAttribute) {\n            attrBytes = bytesPerElement * attribute.count * attribute.itemSize;\n        }\n        else {\n            logger.warn(\"estimateMeshSize: unidentified attribute: \", attrName);\n        }\n        objectSize.heapSize += attrBytes + MINIMUM_ATTRIBUTE_SIZE_ESTIMATION;\n        objectSize.gpuSize += attrBytes;\n    }\n    function estimateGeometrySize(geometry, objectSize, visitedObjects) {\n        const isNewObject = geometry.uuid === undefined || visitedObjects.get(geometry.uuid) !== true;\n        if (!isNewObject) {\n            return;\n        }\n        visitedObjects.set(geometry.uuid, true);\n        let bufferGeometry;\n        if (geometry instanceof THREE.Geometry) {\n            // Each vertex is represented as 3 floats vector (24 bytes).\n            objectSize.heapSize += geometry.vertices.length * 24;\n            // Face: 3 indices (24 byte), 1 normal (3 floats = 24). Vertex normals and\n            // colors are not counted here.\n            objectSize.heapSize += geometry.faces.length * (24 + 24);\n            // Additionally, the internal _bufferGeometry is also counted:\n            bufferGeometry = geometry._bufferGeometry;\n        }\n        else if (geometry instanceof THREE.BufferGeometry) {\n            bufferGeometry = geometry;\n        }\n        if (bufferGeometry === undefined) {\n            // Nothing more to calculate.\n            return;\n        }\n        const attributes = bufferGeometry.attributes;\n        if (attributes === undefined) {\n            logger.warn(\"estimateGeometrySize: unidentified geometry: \", geometry);\n            return;\n        }\n        for (const property in attributes) {\n            if (attributes[property] !== undefined) {\n                estimateAttributeSize(attributes[property], property, objectSize, visitedObjects);\n            }\n        }\n        if (bufferGeometry.index !== null) {\n            estimateAttributeSize(bufferGeometry.index, \"index\", objectSize, visitedObjects);\n        }\n    }\n    function estimateMeshSize(object, objectSize, visitedObjects) {\n        if (!object.isObject3D || object instanceof THREE.Scene) {\n            return;\n        }\n        if (object.uuid !== undefined && visitedObjects.get(object.uuid) === true) {\n            return;\n        }\n        visitedObjects.set(object.uuid, true);\n        if (object.isMesh || object.isLine || object.isPoints) {\n            // Estimated minimum impact on heap.\n            let heapSize = MINIMUM_OBJECT3D_SIZE_ESTIMATION;\n            const gpuSize = 0;\n            // Cast to Points class which contains the minimal required properties sub-set.\n            const mesh = object;\n            // Calculate material(s) impact.\n            if (mesh.material !== undefined) {\n                if (Array.isArray(mesh.material)) {\n                    const materials = mesh.material;\n                    for (const material of materials) {\n                        estimateMaterialSize(material, objectSize, visitedObjects);\n                    }\n                }\n                else {\n                    const material = mesh.material;\n                    estimateMaterialSize(material, objectSize, visitedObjects);\n                }\n            }\n            // Calculate cost of geometry.\n            if (mesh.geometry !== undefined) {\n                estimateGeometrySize(mesh.geometry, objectSize, visitedObjects);\n            }\n            // Add info that is required for picking (parts of) objects and match them to\n            // the featureID in the map data.\n            const featureData = object.userData !== undefined\n                ? object.userData.feature\n                : undefined;\n            if (featureData !== undefined) {\n                heapSize += Tile_1.getFeatureDataSize(featureData);\n            }\n            objectSize.heapSize += heapSize;\n            objectSize.gpuSize += gpuSize;\n        }\n        else {\n            logger.warn(\"estimateMeshSize: unidentified object\", object);\n        }\n    }\n    /**\n     * Gets language list used by the browser\n     *\n     * @returns Array of iso language codes\n     */\n    function getBrowserLanguages() {\n        if (navigator.languages !== undefined && navigator.languages.length > 0) {\n            const languageList = [];\n            for (const lang of navigator.languages) {\n                languageList.push(getIsoLanguageCode(lang));\n            }\n            return languageList;\n        }\n        if (navigator.language !== undefined) {\n            return [getIsoLanguageCode(navigator.language)];\n        }\n        return undefined;\n    }\n    MapViewUtils.getBrowserLanguages = getBrowserLanguages;\n    /**\n     * Gets ISO-639-1 language code from browser's code (ex. en for en-US)\n     */\n    function getIsoLanguageCode(language) {\n        return language.substring(0, 2);\n    }\n})(MapViewUtils = exports.MapViewUtils || (exports.MapViewUtils = {}));\n/** @hidden */\nconst powerOfTwo = [\n    0x1,\n    0x2,\n    0x4,\n    0x8,\n    0x10,\n    0x20,\n    0x40,\n    0x80,\n    0x100,\n    0x200,\n    0x400,\n    0x800,\n    0x1000,\n    0x2000,\n    0x4000,\n    0x8000,\n    0x10000,\n    0x20000,\n    0x40000,\n    0x80000,\n    0x100000,\n    0x200000,\n    0x400000,\n    0x800000,\n    0x1000000,\n    0x2000000,\n    0x4000000,\n    0x8000000,\n    0x10000000,\n    0x20000000,\n    0x40000000,\n    0x80000000,\n    0x100000000,\n    0x200000000,\n    0x400000000,\n    0x800000000,\n    0x1000000000,\n    0x2000000000,\n    0x4000000000,\n    0x8000000000,\n    0x10000000000,\n    0x20000000000,\n    0x40000000000,\n    0x80000000000,\n    0x100000000000,\n    0x200000000000,\n    0x400000000000,\n    0x800000000000,\n    0x1000000000000,\n    0x2000000000000,\n    0x4000000000000,\n    0x8000000000000,\n    0x10000000000000\n];\nvar TileOffsetUtils;\n(function (TileOffsetUtils) {\n    /**\n     * Creates a unique key based on the supplied parameters. Note, the uniqueness is bounded by the\n     * bitshift. The [[TileKey.mortonCode()]] supports currently up to 26 levels (this is because\n     * 26*2 equals 52, and 2^52 is the highest bit that can be set in an integer in Javascript), the\n     * bitshift reduces this accordingly, so given the default bitshift of four, we support up to 24\n     * levels. Given the current support up to level 19 this should be fine.\n     *\n     * @param tileKey The unique [[TileKey]] from which to compute the unique key.\n     * @param offset How much the given [[TileKey]] is offset\n     * @param bitshift How much space we have to store the offset. The default of 4 means we have\n     *      enough space to store 16 unique tiles in a single view.\n     */\n    function getKeyForTileKeyAndOffset(tileKey, offset, bitshift = 4) {\n        const shiftedOffset = getShiftedOffset(offset, bitshift);\n        return tileKey.mortonCode() + shiftedOffset;\n    }\n    TileOffsetUtils.getKeyForTileKeyAndOffset = getKeyForTileKeyAndOffset;\n    /**\n     * Extracts the offset and morton key from the given key (must be created by:\n     * [[getKeyForTileKeyAndOffset]])\n     *\n     * Note, we can't use bitshift operators in Javascript because they work on 32-bit integers, and\n     * would truncate the numbers, hence using powers of two.\n     *\n     * @param key Key to extract offset and morton key.\n     * @param bitshift How many bits to shift by, must be the same as was used when creating the\n     * key.\n     */\n    function extractOffsetAndMortonKeyFromKey(key, bitshift = 4) {\n        let offset = 0;\n        let mortonCode = key;\n        let i = 0;\n        // Compute the offset\n        for (; i < bitshift; i++) {\n            // Note, we use 52, because 2^53-1 is the biggest value, the highest value\n            // that can be set is the bit in the 52th position.\n            const num = powerOfTwo[52 - i];\n            if (mortonCode >= num) {\n                mortonCode -= num;\n                offset += powerOfTwo[bitshift - 1 - i];\n            }\n        }\n        // We subtract half of the total amount, this undoes what is computed in getShiftedOffset\n        offset -= powerOfTwo[bitshift - 1];\n        return { offset, mortonCode };\n    }\n    TileOffsetUtils.extractOffsetAndMortonKeyFromKey = extractOffsetAndMortonKeyFromKey;\n    /**\n     * Returns the key of the parent. Key must have been computed using the function\n     * [[getKeyForTileKeyAndOffset]].\n     *\n     * @param calculatedKey Key to decompose\n     * @param bitshift Bit shift used to create the key\n     */\n    function getParentKeyFromKey(calculatedKey, bitshift = 4) {\n        const { offset, mortonCode } = extractOffsetAndMortonKeyFromKey(calculatedKey, bitshift);\n        const parentTileKey = geoUtils.TileKey.fromMortonCode(geoUtils.TileKey.parentMortonCode(mortonCode));\n        return getKeyForTileKeyAndOffset(parentTileKey, offset, bitshift);\n    }\n    TileOffsetUtils.getParentKeyFromKey = getParentKeyFromKey;\n    /**\n     * Packs the supplied offset into the high bits, where the highbits are between 2^52 and\n     * 2^(52-bitshift).\n     *\n     * Offsets are wrapped around, to fit in the offsetBits. In practice, this doesn't really\n     * matter, this is primarily used to find a unique id, if there is an offset 10, which is\n     * wrapped to 2, it doesn't matter, because the offset of 10 is still stored in the tile.\n     * What can be a problem though is that the cache gets filled up and isn't emptied.\n     *\n     * Note, because bit shifting in JavaScript works on 32 bit integers, we use powers of 2 to set\n     * the high bits instead.\n     *\n     * @param offset Offset to pack into the high bits.\n     * @param offsetBits How many bits to use to pack the offset.\n     */\n    function getShiftedOffset(offset, offsetBits = 4) {\n        let result = 0;\n        const totalOffsetsToStore = powerOfTwo[offsetBits];\n        //Offsets are stored by adding half 2 ^ (bitshift - 1), i.e.half of the max amount stored,\n        //and then wrapped based on this value.For example, given a bitshift of 3, and an offset -\n        //3, it would have 4 added(half of 2 ^ 3), and be stored as 1, 3 would have 4 added and be\n        //stored as 7, 4 would be added with 4 and be stored as 0 (it wraps around).\n        offset += totalOffsetsToStore / 2;\n        while (offset < 0) {\n            offset += totalOffsetsToStore;\n        }\n        while (offset >= totalOffsetsToStore) {\n            offset -= totalOffsetsToStore;\n        }\n        // Offset is now a number between >= 0 and < totalOffsetsToStore\n        for (let i = 0; i < offsetBits && offset > 0; i++) {\n            // tslint:disable: no-bitwise\n            // 53 is used because 2^53-1 is the biggest number that Javascript can represent as an\n            // integer safely.\n            if (offset & 0x1) {\n                result += powerOfTwo[53 - offsetBits + i];\n            }\n            offset >>>= 1;\n            // tslint:enable: no-bitwise\n        }\n        harp_utils_1.assert(offset === 0);\n        return result;\n    }\n})(TileOffsetUtils = exports.TileOffsetUtils || (exports.TileOffsetUtils = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/rendering/FontCatalog\"));\n__export(require(\"./lib/rendering/GlyphData\"));\n__export(require(\"./lib/rendering/TextStyle\"));\n__export(require(\"./lib/rendering/TextBufferObject\"));\n__export(require(\"./lib/TextCanvas\"));\n__export(require(\"./lib/utils/ContextualArabicConverter\"));\n__export(require(\"./lib/utils/MaterialUtils\"));\n__export(require(\"./lib/utils/TypesettingUtils\"));\n__export(require(\"./lib/utils/UnicodeUtils\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Namespace containing useful information when dealing with Unicode's code points.\n */\nvar UnicodeUtils;\n(function (UnicodeUtils) {\n    /**\n     * Range of Unicode code points considered as white space.\n     * https://en.wikipedia.org/wiki/Whitespace_character\n     */\n    UnicodeUtils.whiteSpaceRanges = [\n        [0x0009, 0x0009],\n        [0x0020, 0x0020],\n        [0x1680, 0x1680],\n        [0x2000, 0x2006],\n        [0x2008, 0x200a],\n        [0x205f, 0x3000],\n        [0x180e, 0x180e],\n        [0x200b, 0x200d]\n    ];\n    /**\n     * Checks if a character should be considered as a white space.\n     *\n     * @param codePoint Character's Unicode code point.\n     *\n     * @returns Result of the test.\n     */\n    function isWhiteSpace(codePoint) {\n        for (const range of UnicodeUtils.whiteSpaceRanges) {\n            if (codePoint >= range[0] && codePoint <= range[1]) {\n                return true;\n            }\n        }\n        return false;\n    }\n    UnicodeUtils.isWhiteSpace = isWhiteSpace;\n    /**\n     * Range of Unicode code points considered as `NewLine`.\n     * https://en.wikipedia.org/wiki/Newline#Unicode\n     */\n    UnicodeUtils.newLineRanges = [[0x000a, 0x000d], [0x0085, 0x0085], [0x2028, 0x2029]];\n    /**\n     * Checks if a character should be considered as a new line.\n     *\n     * @param codePoint Character's Unicode code point.\n     *\n     * @returns Result of the test.\n     */\n    function isNewLine(codePoint) {\n        for (const range of UnicodeUtils.newLineRanges) {\n            if (codePoint >= range[0] && codePoint <= range[1]) {\n                return true;\n            }\n        }\n        return false;\n    }\n    UnicodeUtils.isNewLine = isNewLine;\n    /**\n     * Range of Unicode code points considered as non-printable.\n     * https://en.wikipedia.org/wiki/Unicode_control_characters\n     */\n    UnicodeUtils.nonPrintableRanges = [[0x0000, 0x001f], [0x007f, 0x009f]];\n    /**\n     * Checks if a character's can be printed (rendered).\n     *\n     * @param codePoint Character's Unicode code point.\n     *\n     * @returns Result of the test.\n     */\n    function isPrintable(codePoint) {\n        for (const range of UnicodeUtils.nonPrintableRanges) {\n            if (codePoint >= range[0] && codePoint <= range[1]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    UnicodeUtils.isPrintable = isPrintable;\n    /**\n     * Unicode code point direction.\n     */\n    let Direction;\n    (function (Direction) {\n        Direction[Direction[\"Neutral\"] = 0] = \"Neutral\";\n        Direction[Direction[\"Weak\"] = 0.5] = \"Weak\";\n        Direction[Direction[\"LTR\"] = 1] = \"LTR\";\n        Direction[Direction[\"RTL\"] = -1] = \"RTL\";\n    })(Direction = UnicodeUtils.Direction || (UnicodeUtils.Direction = {}));\n    // TODO: Review/Remove/Add any additional needed blocks (HARP-3330).\n    /**\n     * Unicode Blocks which have inherent RTL direction.\n     * These blocks correspond to the scripts described here:\n     * https://en.wikipedia.org/wiki/Right-to-left#List_of_RTL_scripts\n     */\n    UnicodeUtils.rtlBlocks = [\n        \"Hebrew\",\n        \"Alphabetic Presentation Forms\",\n        \"Arabic\",\n        \"Arabic Supplement\",\n        \"Arabic Extended-A\",\n        \"Arabic Presentation Forms-A\",\n        \"Arabic Presentation Forms-B\",\n        \"Arabic Mathematical Alphabetic Symbols\",\n        \"Indic Siyaq Numbers\",\n        \"Rumi Numeral Symbols\",\n        \"Syriac\",\n        \"Syriac Supplement\",\n        \"Samaritan\",\n        \"Mandaic\",\n        \"Thaana\",\n        \"Mende Kikakui\",\n        \"NKo\",\n        \"Adlam\",\n        \"Hanifi Rohingya\"\n    ];\n    /**\n     * ASCII punctuation is considered to have neutral direction:\n     * https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)#Table_of_characters\n     */\n    UnicodeUtils.neutralBidirectionalRanges = [\n        [0x0020, 0x002f],\n        [0x003a, 0x0040],\n        [0x005b, 0x0060],\n        [0x007b, 0x007e]\n    ];\n    /**\n     * Latin and arabic numerals are considered to have weak directionality:\n     * https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)#Table_of_characters\n     * https://en.wikipedia.org/wiki/Arabic_(Unicode_block)#Block\n     */\n    UnicodeUtils.weakBidirectionalRanges = [[0x0030, 0x0039], [0x0660, 0x0669], [0x06f0, 0x06f9]];\n    /**\n     * Returns the Unicode's character direction.\n     *\n     * @param codePoint Character's Unicode code point.\n     * @param block Character's Unicode block.\n     *\n     * @returns Character's direction.\n     */\n    function getDirection(codePoint, block) {\n        // Test for neutral and weak code points first (they're inside LTR/RTL ranges).\n        for (const weakRange of UnicodeUtils.weakBidirectionalRanges) {\n            if (codePoint >= weakRange[0] && codePoint <= weakRange[1]) {\n                return Direction.Weak;\n            }\n        }\n        for (const neutralRange of UnicodeUtils.neutralBidirectionalRanges) {\n            if (codePoint >= neutralRange[0] && codePoint <= neutralRange[1]) {\n                return Direction.Neutral;\n            }\n        }\n        // Check for RTL/LTR.\n        const rtl = UnicodeUtils.rtlBlocks.find(element => {\n            return element === block;\n        });\n        if (rtl !== undefined) {\n            return Direction.RTL;\n        }\n        else {\n            return Direction.LTR;\n        }\n    }\n    UnicodeUtils.getDirection = getDirection;\n    /**\n     * Some punctuation characters (like: (, ), <, >, [,], {, }) need to be mirrored when rendering\n     * a RTL string to preserve their intrinsic meaning.\n     * https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)#Table_of_characters\n     */\n    UnicodeUtils.rtlMirroredCodePoints = [\n        0x0028,\n        0x0029,\n        0x003c,\n        0x003e,\n        0x005b,\n        0x005d,\n        0x007b,\n        0x007d\n    ];\n    /**\n     * Checks if a character should be mirrored on an RTL run.\n     *\n     * @param codePoint Character's Unicode code point.\n     *\n     * @returns Result of the test.\n     */\n    function isRtlMirrored(codePoint) {\n        return (UnicodeUtils.rtlMirroredCodePoints.find(element => {\n            return element === codePoint;\n        }) !== undefined);\n    }\n    UnicodeUtils.isRtlMirrored = isRtlMirrored;\n})(UnicodeUtils = exports.UnicodeUtils || (exports.UnicodeUtils = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_text_canvas_1 = require(\"@here/harp-text-canvas\");\nconst ColorCache_1 = require(\"../ColorCache\");\n/**\n * [[TextStyle]] id for the default value inside a [[TextRenderStyleCache]] or a\n * [[TextLayoutStyleCache]].\n */\nexports.DEFAULT_TEXT_STYLE_CACHE_ID = \"Default\";\n/**\n * Calculates the [[TextStyle]] id that identifies either a [[TextRenderStyle]] or a\n * [[TextLayoutStyle]] inside a [[TextRenderStyleCache]] or a [[TextLayoutStyleCache]],\n * respectively.\n *\n * @param technique Technique defining the [[TextStyle]].\n * @param zoomLevel Zoom level for which to interpret the technique.\n *\n * @returns [[TextStyle]] id.\n */\nfunction computeStyleCacheId(datasourceName, technique, zoomLevel) {\n    return `${datasourceName}_${technique.renderOrder}_${zoomLevel}`;\n}\nexports.computeStyleCacheId = computeStyleCacheId;\n/**\n * Cache storing [[MapView]]'s [[TextRenderStyle]]s.\n */\nclass TextRenderStyleCache {\n    constructor() {\n        this.m_map = new Map();\n        this.m_map.set(exports.DEFAULT_TEXT_STYLE_CACHE_ID, new harp_text_canvas_1.TextRenderStyle({\n            fontSize: {\n                unit: harp_text_canvas_1.FontUnit.Pixel,\n                size: 32,\n                backgroundSize: 8\n            },\n            color: ColorCache_1.ColorCache.instance.getColor(\"#6d7477\"),\n            backgroundColor: ColorCache_1.ColorCache.instance.getColor(\"#f7fbfd\"),\n            backgroundOpacity: 0.5\n        }));\n    }\n    get size() {\n        return this.m_map.size;\n    }\n    get(id) {\n        return this.m_map.get(id);\n    }\n    set(id, value) {\n        this.m_map.set(id, value);\n    }\n    clear() {\n        this.m_map.clear();\n        this.m_map.set(exports.DEFAULT_TEXT_STYLE_CACHE_ID, new harp_text_canvas_1.TextRenderStyle({\n            fontSize: {\n                unit: harp_text_canvas_1.FontUnit.Pixel,\n                size: 32,\n                backgroundSize: 8\n            },\n            color: ColorCache_1.ColorCache.instance.getColor(\"#6d7477\"),\n            backgroundColor: ColorCache_1.ColorCache.instance.getColor(\"#f7fbfd\"),\n            backgroundOpacity: 0.5\n        }));\n    }\n}\nexports.TextRenderStyleCache = TextRenderStyleCache;\n/**\n * Cache storing [[MapView]]'s [[TextLayoutStyle]]s.\n */\nclass TextLayoutStyleCache {\n    constructor() {\n        this.m_map = new Map();\n        this.m_map.set(exports.DEFAULT_TEXT_STYLE_CACHE_ID, new harp_text_canvas_1.TextLayoutStyle({\n            verticalAlignment: harp_text_canvas_1.VerticalAlignment.Center,\n            horizontalAlignment: harp_text_canvas_1.HorizontalAlignment.Center\n        }));\n    }\n    get size() {\n        return this.m_map.size;\n    }\n    get(id) {\n        return this.m_map.get(id);\n    }\n    set(id, value) {\n        this.m_map.set(id, value);\n    }\n    clear() {\n        this.m_map.clear();\n        this.m_map.set(exports.DEFAULT_TEXT_STYLE_CACHE_ID, new harp_text_canvas_1.TextLayoutStyle({\n            verticalAlignment: harp_text_canvas_1.VerticalAlignment.Center,\n            horizontalAlignment: harp_text_canvas_1.HorizontalAlignment.Center\n        }));\n    }\n}\nexports.TextLayoutStyleCache = TextLayoutStyleCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/** @hidden */\nconst powerOfTwo = [\n    0x1,\n    0x2,\n    0x4,\n    0x8,\n    0x10,\n    0x20,\n    0x40,\n    0x80,\n    0x100,\n    0x200,\n    0x400,\n    0x800,\n    0x1000,\n    0x2000,\n    0x4000,\n    0x8000,\n    0x10000,\n    0x20000,\n    0x40000,\n    0x80000,\n    0x100000,\n    0x200000,\n    0x400000,\n    0x800000,\n    0x1000000,\n    0x2000000,\n    0x4000000,\n    0x8000000,\n    0x10000000,\n    0x20000000,\n    0x40000000,\n    0x80000000,\n    0x100000000,\n    0x200000000,\n    0x400000000,\n    0x800000000,\n    0x1000000000,\n    0x2000000000,\n    0x4000000000,\n    0x8000000000,\n    0x10000000000,\n    0x20000000000,\n    0x40000000000,\n    0x80000000000,\n    0x100000000000,\n    0x200000000000,\n    0x400000000000,\n    0x800000000000,\n    0x1000000000000,\n    0x2000000000000,\n    0x4000000000000,\n    0x8000000000000,\n    0x10000000000000 // Math.pow(2, 52), highest bit that can be set correctly.\n];\n/**\n * The `TileKey` instances are used to address a tile in a quadtree.\n *\n * A tile key is defined by a row, a column, and a level. The tree has a root at level 0, with one\n * single tile. On every level, each tile is divided into four children (therefore the name\n * quadtree).\n *\n * Within each [[level]], any particular tile is addressed with [[row]] and [[column]]. The number\n * of rows and columns in each level is 2 to the power of the level. This means: On level 0, only\n * one tile exists, [[columnsAtLevel]]() and [[rowsAtLevel]]() are both 1. On level 1, 4 tiles\n * exist, in 2 rows and 2 columns. On level 2 we have 16 tiles, in 4 rows and 4 columns. And so on.\n *\n * A tile key is usually created using [[fromRowColumnLevel]]() method.\n *\n * `TileKey` instances are immutable, all members return new instances of `TileKey` and do not\n * modify the original object.\n *\n * Utility functions like [[parent]](), [[changedLevelBy]](), and [[changedLevelTo]]() allow for\n * easy vertical navigation of the tree. The number of available rows and columns in the tile's\n * level is given with [[rowCount]]() and [[columnCount]]().\n *\n * Tile keys can be created from and converted into various alternative formats:\n *\n *  - [[toQuadKey]]() / [[fromQuadKey]]() - string representation 4-based\n *  - [[toHereTile]]() / [[fromHereTile]]() - string representation 10-based\n *  - [[mortonCode]]() / [[fromMortonCode]]() - number representation\n *\n * Note - as JavaScript's number type can hold 53 bits in its mantissa, only levels up to 26 can be\n * represented in the number representation returned by [[mortonCode]]().\n */\nclass TileKey {\n    /**\n     * Constructs a new immutable instance of a `TileKey`.\n     *\n     * For the better readability, [[TileKey.fromRowColumnLevel]] should be preferred.\n     *\n     * Note - row and column must not be greater than the maximum rows/columns for the given level.\n     *\n     * @param row Represents the row in the quadtree.\n     * @param column Represents the column in the quadtree.\n     * @param level Represents the level in the quadtree.\n     */\n    constructor(row, column, level) {\n        this.row = row;\n        this.column = column;\n        this.level = level;\n    }\n    /**\n     * Creates a tile key.\n     *\n     * @param row The requested row. Must be less than 2 to the power of level.\n     * @param column The requested column. Must be less than 2 to the power of level.\n     * @param level The requested level.\n     */\n    static fromRowColumnLevel(row, column, level) {\n        return new TileKey(row, column, level);\n    }\n    /**\n     * Creates a tile key from a quad string.\n     *\n     * The quad string can be created with [[toQuadKey]].\n     *\n     * @param quadkey The quadkey to convert.\n     * @returns A new instance of `TileKey`.\n     */\n    static fromQuadKey(quadkey) {\n        const level = quadkey.length;\n        let row = 0;\n        let column = 0;\n        // tslint:disable:no-bitwise\n        for (let i = 0; i < quadkey.length; ++i) {\n            const mask = 1 << i;\n            const d = parseInt(quadkey.charAt(level - i - 1), 10);\n            if (d & 0x1) {\n                column |= mask;\n            }\n            if (d & 0x2) {\n                row |= mask;\n            }\n        }\n        // tslint:enable:no-bitwise\n        return TileKey.fromRowColumnLevel(row, column, level);\n    }\n    /**\n     * Creates a tile key from a numeric Morton code representation.\n     *\n     * You can convert a tile key into a numeric Morton code with [[mortonCode]].\n     *\n     * @param quadKey64 The Morton code to be converted.\n     * @returns A new instance of [[TileKey]].\n     */\n    static fromMortonCode(quadKey64) {\n        let level = 0;\n        let row = 0;\n        let column = 0;\n        let quadKey = quadKey64;\n        // tslint:disable:no-bitwise\n        while (quadKey > 1) {\n            const mask = 1 << level;\n            if (quadKey & 0x1) {\n                column |= mask;\n            }\n            if (quadKey & 0x2) {\n                row |= mask;\n            }\n            level++;\n            quadKey = (quadKey - (quadKey & 0x3)) / 4;\n        }\n        // tslint:enable:no-bitwise\n        const result = TileKey.fromRowColumnLevel(row, column, level);\n        result.m_mortonCode = quadKey64;\n        return result;\n    }\n    /**\n     * Creates a tile key from a heretile code string.\n     *\n     * The string can be created with [[toHereTile]].\n     *\n     * @param quadkey64 The string representation of the HERE tile key.\n     * @returns A new instance of `TileKey`.\n     */\n    static fromHereTile(quadkey64) {\n        const result = TileKey.fromMortonCode(parseInt(quadkey64, 10));\n        result.m_hereTile = quadkey64;\n        return result;\n    }\n    /**\n     * Returns the number of available columns at a given level.\n     *\n     * This is 2 to the power of the level.\n     *\n     * @param level The level for which to return the number of columns.\n     * @returns The available columns at the given level.\n     */\n    static columnsAtLevel(level) {\n        return Math.pow(2, level);\n    }\n    /**\n     * Returns the number of available rows at a given level.\n     *\n     * This is 2 to the power of the level.\n     *\n     * @param level The level for which to return the number of rows.\n     * @returns The available rows at the given level.\n     */\n    static rowsAtLevel(level) {\n        return Math.pow(2, level);\n    }\n    /**\n     * Returns the closest matching `TileKey` in a cartesian coordinate system.\n     *\n     * @param level The level for the tile key.\n     * @param coordX The X coordinate.\n     * @param coordY The Y coordinate.\n     * @param totalWidth The maximum X coordinate.\n     * @param totalHeight The maximum Y coordinate.\n     * @returns A new tile key at the given level that includes the given coordinates.\n     */\n    static atCoords(level, coordX, coordY, totalWidth, totalHeight) {\n        return TileKey.fromRowColumnLevel(Math.floor(coordY / (totalHeight / TileKey.rowsAtLevel(level))), Math.floor(coordX / (totalWidth / TileKey.columnsAtLevel(level))), level);\n    }\n    /**\n     * Computes the Morton code of the parent tile key of the given Morton code.\n     *\n     * Note: The parent key of the root key is the root key itself.\n     *\n     * @param mortonCode A Morton code, for example, obtained from [[mortonCode]].\n     * @returns The Morton code of the parent tile.\n     */\n    static parentMortonCode(mortonCode) {\n        return Math.floor(mortonCode / 4);\n    }\n    /**\n     * Returns a tile key representing the parent of the tile addressed by this tile key.\n     *\n     * Throws an exception is this tile is already the root.\n     */\n    parent() {\n        if (this.level === 0) {\n            throw new Error(\"Cannot get the parent of the root tile key\");\n        }\n        // tslint:disable-next-line:no-bitwise\n        return TileKey.fromRowColumnLevel(this.row >>> 1, this.column >>> 1, this.level - 1);\n    }\n    /**\n     * Returns a new tile key at a level that differs from this tile's level by delta.\n     *\n     * Equivalent to `changedLevelTo(level() + delta)`.\n     *\n     * Note - root key is returned if `delta` is smaller than the level of this tile key.\n     *\n     * @param delta The numeric difference between the current level and the requested level.\n     */\n    changedLevelBy(delta) {\n        const level = Math.max(0, this.level + delta);\n        let row = this.row;\n        let column = this.column;\n        // tslint:disable:no-bitwise\n        if (delta >= 0) {\n            row <<= delta;\n            column <<= delta;\n        }\n        else {\n            row >>>= -delta;\n            column >>>= -delta;\n        }\n        // tslint:enable:no-bitwise\n        return TileKey.fromRowColumnLevel(row, column, level);\n    }\n    /**\n     * Returns a new tile key at the requested level.\n     *\n     * If the requested level is smaller than the tile's level, then the key of an ancestor of this\n     * tile is returned. If the requested level is larger than the tile's level, then the key of\n     * first child or grandchild of this tile is returned, for example, the child with the lowest\n     * row and column number. If the requested level equals this tile's level, then the tile key\n     * itself is returned. If the requested level is negative, the root tile key is returned.\n     *\n     * @param level The requested level.\n     */\n    changedLevelTo(level) {\n        return this.changedLevelBy(level - this.level);\n    }\n    /**\n     * Converts the tile key to a numeric code representation.\n     *\n     * You can create a tile key from a numeric Morton code with [[fromMortonCode]].\n     *\n     * Note - only levels <= 26 are supported.\n     */\n    mortonCode() {\n        if (this.m_mortonCode === undefined) {\n            let column = this.column;\n            let row = this.row;\n            // tslint:disable:no-bitwise\n            let result = powerOfTwo[this.level << 1];\n            for (let i = 0; i < this.level; ++i) {\n                if (column & 0x1) {\n                    result += powerOfTwo[2 * i];\n                }\n                if (row & 0x1) {\n                    result += powerOfTwo[2 * i + 1];\n                }\n                column >>>= 1;\n                row >>>= 1;\n            }\n            // tslint:enable:no-bitwise\n            this.m_mortonCode = result;\n        }\n        return this.m_mortonCode;\n    }\n    /**\n     * Converts the tile key into a string for using in REST API calls.\n     *\n     * The string is a quadkey Morton code representation as a string.\n     *\n     * You can convert back from a quadkey string with [[fromHereTile]].\n     */\n    toHereTile() {\n        if (this.m_hereTile === undefined) {\n            this.m_hereTile = this.mortonCode().toString();\n        }\n        return this.m_hereTile;\n    }\n    /**\n     * Converts the tile key into a string for using in REST API calls.\n     *\n     * If the tile is the root tile, the quadkey is '-'. Otherwise the string is a number to the\n     * base of 4, but without the leading 1, with the following properties:\n     *  1. the number of digits equals the level.\n     *  2. removing the last digit gives the parent tile's quadkey string, i.e. appending 0,1,2,3\n     *     to a quadkey string gives the tiles's children.\n     *\n     * You can convert back from a quadkey string with [[fromQuadKey]].\n     */\n    toQuadKey() {\n        let result = \"\";\n        // tslint:disable:no-bitwise\n        for (let i = this.level; i > 0; --i) {\n            const mask = 1 << (i - 1);\n            const col = (this.column & mask) !== 0;\n            const row = (this.row & mask) !== 0;\n            if (col && row) {\n                result += \"3\";\n            }\n            else if (row) {\n                result += \"2\";\n            }\n            else if (col) {\n                result += \"1\";\n            }\n            else {\n                result += \"0\";\n            }\n        }\n        // tslint:enable:no-bitwise\n        return result;\n    }\n    /**\n     * Equality operator.\n     *\n     * @param qnr The tile key to compare to.\n     * @returns `true` if this tile key has identical row, column and level, `false` otherwise.\n     */\n    equals(qnr) {\n        return this.row === qnr.row && this.column === qnr.column && this.level === qnr.level;\n    }\n    /**\n     * Returns the absolute quadkey that is constructed from its sub quadkey.\n     *\n     * @param sub The sub key.\n     * @returns The absolute tile key in the quadtree.\n     */\n    addedSubKey(sub) {\n        const subQuad = TileKey.fromQuadKey(sub.length === 0 ? \"-\" : sub);\n        const child = this.changedLevelBy(subQuad.level);\n        return TileKey.fromRowColumnLevel(child.row + subQuad.row, child.column + subQuad.column, child.level);\n    }\n    /**\n     * Returns the absolute quadkey that is constructed from its sub HERE tile key.\n     *\n     * @param sub The sub HERE key.\n     * @returns The absolute tile key in the quadtree.\n     */\n    addedSubHereTile(sub) {\n        const subQuad = TileKey.fromHereTile(sub);\n        const child = this.changedLevelBy(subQuad.level);\n        return TileKey.fromRowColumnLevel(child.row + subQuad.row, child.column + subQuad.column, child.level);\n    }\n    /**\n     * Returns a sub quadkey that is relative to its parent.\n     *\n     * This function can be used to generate sub keys that are relative to a parent that is delta\n     * levels up in the quadtree.\n     *\n     * This function can be used to create shortened keys for quads on lower levels if the parent is\n     * known.\n     *\n     * Note - the sub quadkeys fit in a 16-bit unsigned integer if the `delta` is smaller than 8. If\n     * `delta` is smaller than 16, the sub quadkey fits into an unsigned 32-bit integer.\n     *\n     * Deltas larger than 16 are not supported.\n     *\n     * @param delta The number of levels relative to its parent quadkey. Must be greater or equal to\n     * 0 and smaller than 16.\n     * @returns The quadkey relative to its parent that is `delta` levels up the tree.\n     */\n    getSubHereTile(delta) {\n        const key = this.mortonCode();\n        // tslint:disable-next-line:no-bitwise\n        const msb = 1 << (delta * 2);\n        const mask = msb - 1;\n        // tslint:disable-next-line:no-bitwise\n        const result = (key & mask) | msb;\n        return result.toString();\n    }\n    /**\n     * Returns the number of available rows in the tile's [[level]].\n     *\n     * This is 2 to the power of the level.\n     */\n    rowCount() {\n        return TileKey.rowsAtLevel(this.level);\n    }\n    /**\n     * Returns the number of available columns in the tile's [[level]].\n     *\n     * This is 2 to the power of the level.\n     */\n    columnCount() {\n        return TileKey.columnsAtLevel(this.level);\n    }\n}\nexports.TileKey = TileKey;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst FlatTileBoundingBoxGenerator_1 = require(\"./FlatTileBoundingBoxGenerator\");\nconst TileKeyUtils_1 = require(\"./TileKeyUtils\");\nconst TileTreeTraverse_1 = require(\"./TileTreeTraverse\");\n/**\n * The `TilingScheme` represents how the data is tiled.\n */\nclass TilingScheme {\n    /**\n     * Constructs a new `TilingScheme` with the given subdivision scheme and projection.\n     *\n     * @param subdivisionScheme The subdivision scheme used by this `TilingScheme`.\n     * @param projection The projection used by this `TilingScheme`.\n     */\n    constructor(subdivisionScheme, projection) {\n        this.subdivisionScheme = subdivisionScheme;\n        this.projection = projection;\n        this.boundingBoxGenerator = new FlatTileBoundingBoxGenerator_1.FlatTileBoundingBoxGenerator(this);\n        this.tileTreeTraverse = new TileTreeTraverse_1.TileTreeTraverse(subdivisionScheme);\n    }\n    /**\n     * Returns the sub tile keys of the given tile.\n     *\n     * @param tileKey The [[TileKey]].\n     * @returns The list of the sub tile keys.\n     */\n    getSubTileKeys(tileKey) {\n        return this.tileTreeTraverse.subTiles(tileKey);\n    }\n    /**\n     * Gets the [[TileKey]] from the given geo position and level.\n     *\n     * @param geoPoint The position in geo coordinates.\n     * @param level The level of the resulting `TileKey`.\n     */\n    getTileKey(geoPoint, level) {\n        return TileKeyUtils_1.TileKeyUtils.geoCoordinatesToTileKey(this, geoPoint, level);\n    }\n    /**\n     * Gets the list of [[TileKey]]s contained in the given [[GeoBox]].\n     *\n     * @param geoBox The bounding box in geo coordinates.\n     * @param level The level of the resulting `TileKey`.\n     */\n    getTileKeys(geoBox, level) {\n        return TileKeyUtils_1.TileKeyUtils.geoRectangleToTileKeys(this, geoBox, level);\n    }\n    /**\n     * Returns the bounding box in geo coordinates for the given [[TileKey]].\n     *\n     * @param tileKey The `TileKey`.\n     */\n    getGeoBox(tileKey) {\n        return this.boundingBoxGenerator.getGeoBox(tileKey);\n    }\n    /**\n     * Returns the bounding box in world coordinates.\n     *\n     * @param tileKey The `TileKey`.\n     * @param result The optional object that will contain the resulting bounding box.\n     */\n    getWorldBox(tileKey, result) {\n        return this.boundingBoxGenerator.getWorldBox(tileKey, result);\n    }\n}\nexports.TilingScheme = TilingScheme;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_text_canvas_1 = require(\"@here/harp-text-canvas\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\n/**\n * State of fading.\n */\nvar FadingState;\n(function (FadingState) {\n    FadingState[FadingState[\"Undefined\"] = 0] = \"Undefined\";\n    FadingState[FadingState[\"FadingIn\"] = 1] = \"FadingIn\";\n    FadingState[FadingState[\"FadedIn\"] = 2] = \"FadedIn\";\n    FadingState[FadingState[\"FadingOut\"] = -1] = \"FadingOut\";\n    FadingState[FadingState[\"FadedOut\"] = -2] = \"FadedOut\";\n})(FadingState = exports.FadingState || (exports.FadingState = {}));\n/**\n * State of loading.\n */\nvar LoadingState;\n(function (LoadingState) {\n    LoadingState[LoadingState[\"Requested\"] = 0] = \"Requested\";\n    LoadingState[LoadingState[\"Loaded\"] = 1] = \"Loaded\";\n    LoadingState[LoadingState[\"Initialized\"] = 2] = \"Initialized\";\n})(LoadingState = exports.LoadingState || (exports.LoadingState = {}));\n/**\n * Time to fade in/fade out the labels in milliseconds.\n */\nexports.DEFAULT_FADE_TIME = 800;\n/**\n * State of rendering of the icon and text part of the `TextElement`. Mainly for fading the elements\n * in and out, to compute the opacity.\n *\n * @hidden\n */\nclass RenderState {\n    /**\n     * Create a `RenderState`.\n     *\n     * @param state Fading state.\n     * @param value Current fading value [0..1].\n     * @param startTime Time stamp the fading started.\n     * @param opacity Computed opacity depending on value.\n     * @param lastFrameNumber Latest frame the elements was rendered, allows to detect some less\n     *                        obvious states, like popping up after being hidden.\n     * @param fadingTime Time used to fade in or out.\n     */\n    constructor(state = FadingState.Undefined, value = 0.0, startTime = 0, opacity = 1.0, lastFrameNumber = Number.MIN_SAFE_INTEGER, fadingTime = exports.DEFAULT_FADE_TIME) {\n        this.state = state;\n        this.value = value;\n        this.startTime = startTime;\n        this.opacity = opacity;\n        this.lastFrameNumber = lastFrameNumber;\n        this.fadingTime = fadingTime;\n    }\n    /**\n     * Reset existing `RenderState` to appear like a fresh state.\n     */\n    reset() {\n        this.state = FadingState.Undefined;\n        this.value = 0.0;\n        this.startTime = 0.0;\n        this.opacity = 1.0;\n        this.lastFrameNumber = Number.MIN_SAFE_INTEGER;\n    }\n    /**\n     * @returns `true` if element is either fading in or fading out.\n     */\n    isFading() {\n        const fading = this.state === FadingState.FadingIn || this.state === FadingState.FadingOut;\n        return fading;\n    }\n    /**\n     * @returns `true` if element is fading in.\n     */\n    isFadingIn() {\n        const fadingIn = this.state === FadingState.FadingIn;\n        return fadingIn;\n    }\n    /**\n     * @returns `true` if element is fading out.\n     */\n    isFadingOut() {\n        const fadingOut = this.state === FadingState.FadingOut;\n        return fadingOut;\n    }\n    /**\n     * @returns `true` if element is done with fading in.\n     */\n    isFadedIn() {\n        const fadedIn = this.state === FadingState.FadedIn;\n        return fadedIn;\n    }\n    /**\n     * @returns `true` if element is done with fading out.\n     */\n    isFadedOut() {\n        const fadedOut = this.state === FadingState.FadedOut;\n        return fadedOut;\n    }\n    /**\n     * @returns `true` if element is either faded in, is fading in or is fading out.\n     */\n    isVisible() {\n        const visible = this.state === FadingState.FadingIn ||\n            this.state === FadingState.FadedIn ||\n            this.state === FadingState.FadingOut;\n        return visible;\n    }\n}\nexports.RenderState = RenderState;\n/**\n * `TextElement` is used to create 2D text elements (for example, labels).\n */\nclass TextElement {\n    /**\n     * Creates a new `TextElement`.\n     *\n     * @param text The text to display.\n     * @param points The position in world coordinates or a list of points in world coordinates for\n     *              a curved text.\n     * @param renderParams `TextElement` text rendering parameters.\n     * @param layoutParams `TextElement` text layout parameters.\n     * @param priority The priority of the `TextElement. Elements with the highest priority get\n     *              placed first, elements with priority of `0` are placed last, elements with a\n     *              negative value are always rendered, ignoring priorities and allowing\n     *              overrides.\n     * @param xOffset Optional X offset of this `TextElement` in screen coordinates.\n     * @param yOffset Optional Y offset of this `TextElement` in screen coordinates.\n     * @param featureId Optional number to identify feature (originated from `OmvDataSource`).\n     * @param fadeNear Distance to the camera (0.0 = camera position, 1.0 = farPlane) at which the\n     *              label starts fading out (opacity decreases).\n     * @param fadeFar Distance to the camera (0.0 = camera position, 1.0 = farPlane) at which the\n     *              label becomes transparent. A value of <= 0.0 disables fading.\n     */\n    constructor(text, points, renderParams, layoutParams, priority = 0, xOffset, yOffset, featureId, style, fadeNear, fadeFar) {\n        this.text = text;\n        this.points = points;\n        this.renderParams = renderParams;\n        this.layoutParams = layoutParams;\n        this.priority = priority;\n        this.xOffset = xOffset;\n        this.yOffset = yOffset;\n        this.featureId = featureId;\n        this.style = style;\n        this.fadeNear = fadeNear;\n        this.fadeFar = fadeFar;\n        /**\n         * Determines visibility. If set to `false`, it will not be rendered.\n         */\n        this.visible = true;\n        /**\n         * Scaling factor of text. Defaults to 0.5, reducing the size ot 50% in the distance.\n         */\n        this.distanceScale = 0.5;\n        /**\n         * If specified, determines the render order between `TextElement`s. The number different\n         * renderOrders should be as small as possible, because every specific `renderOrder` may result\n         * in one or more draw calls.\n         *\n         * TextElements with the same integer `renderOrder` will be rendered in the same batch.\n         *\n         * The `renderOrder` of `TextElement`s are only relative to other `TextElement`s, and not other\n         * map elements.\n         *\n         * A `TextElement` with a higher `renderOrder` will be rendered after a `TextElement` with a\n         * lower `renderOrder`.\n         */\n        this.renderOrder = 0;\n        /**\n         * @hidden\n         * Used during sorting.\n         */\n        this.sortPriority = 0;\n        if (renderParams instanceof harp_text_canvas_1.TextRenderStyle) {\n            this.renderStyle = renderParams;\n        }\n        if (layoutParams instanceof harp_text_canvas_1.TextLayoutStyle) {\n            this.layoutStyle = layoutParams;\n        }\n    }\n    /**\n     * The position of this text element in world coordinates or the first point of the path used to\n     * render a curved text.\n     */\n    get position() {\n        if (this.points instanceof Array) {\n            return this.points[0];\n        }\n        if (this.points instanceof THREE.Vector3) {\n            return new THREE.Vector2(this.points.x, this.points.y);\n        }\n        return this.points;\n    }\n    /**\n     * The position of this text element in world coordinates or the first point of the path used to\n     * render a curved text.\n     */\n    get position3() {\n        if (this.points instanceof THREE.Vector3) {\n            return this.points;\n        }\n        if (this.points instanceof Array) {\n            return new THREE.Vector3(this.points[0].x, this.points[0].y, 0);\n        }\n        return new THREE.Vector3(this.points.x, this.points.y, 0);\n    }\n    /**\n     * The list of points in world coordinates used to render the text along a path or `undefined`.\n     */\n    get path() {\n        if (this.points instanceof Array) {\n            return this.points;\n        }\n        return undefined;\n    }\n    /**\n     * If `true`, `TextElement` is allowed to overlap other labels or icons of lower priority.\n     *\n     * @default `false`\n     */\n    get textMayOverlap() {\n        return this.mayOverlap === true;\n    }\n    set textMayOverlap(mayOverlap) {\n        this.mayOverlap = mayOverlap;\n    }\n    /**\n     * If `true`, `TextElement` will reserve screen space, other markers of lower priority will not\n     * be able to overlap.\n     *\n     * @default `true`\n     */\n    get textReservesSpace() {\n        return this.reserveSpace !== false;\n    }\n    set textReservesSpace(reserveSpace) {\n        this.reserveSpace = reserveSpace;\n    }\n    /**\n     * Determine if the `TextElement` is a line marker.\n     *\n     * @returns `true` if this `TextElement` is a line marker.\n     */\n    get isLineMarker() {\n        return (this.points !== undefined &&\n            (this.m_poiInfo !== undefined && harp_datasource_protocol_1.isLineMarkerTechnique(this.m_poiInfo.technique)));\n    }\n    /**\n     * Return the last distance that has been computed for sorting during placement. This may not be\n     * the actual distance if the camera is moving, as the distance is computed only during\n     * placement. If the property `alwaysOnTop` is true, the value returned is always `0`.\n     *\n     * @returns 0 or negative distance to camera.\n     */\n    get renderDistance() {\n        return this.alwaysOnTop === true\n            ? 0\n            : this.currentViewDistance !== undefined\n                ? -this.currentViewDistance\n                : 0;\n    }\n    /**\n     * Contains additional information about icon to be rendered along with text.\n     */\n    get poiInfo() {\n        return this.m_poiInfo;\n    }\n    set poiInfo(poiInfo) {\n        this.m_poiInfo = poiInfo;\n        if (poiInfo !== undefined) {\n            const poiRenderOrder = this.renderOrder !== undefined ? this.renderOrder : 0;\n            poiInfo.renderOrder = poiRenderOrder;\n        }\n    }\n    /**\n     * Update the minZoomLevel and maxZoomLevel from the values set in [[PoiInfo]].\n     * Selects the smaller/larger one of the two min/max values for icon and text, because the\n     * TextElement is a container for both.\n     */\n    updateMinMaxZoomLevelsFromPoiInfo() {\n        if (this.poiInfo !== undefined) {\n            if (this.minZoomLevel === undefined) {\n                this.minZoomLevel = harp_utils_1.MathUtils.min2(this.poiInfo.iconMinZoomLevel, this.poiInfo.textMinZoomLevel);\n            }\n            if (this.maxZoomLevel === undefined) {\n                this.maxZoomLevel = harp_utils_1.MathUtils.max2(this.poiInfo.iconMaxZoomLevel, this.poiInfo.textMaxZoomLevel);\n            }\n        }\n    }\n}\nexports.TextElement = TextElement;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_text_canvas_1 = require(\"@here/harp-text-canvas\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst ColorCache_1 = require(\"../ColorCache\");\nconst DebugContext_1 = require(\"../DebugContext\");\nconst PickHandler_1 = require(\"../PickHandler\");\nconst PoiRenderer_1 = require(\"../poi/PoiRenderer\");\nconst SimplePath_1 = require(\"./SimplePath\");\nconst TextElement_1 = require(\"./TextElement\");\nconst TextStyleCache_1 = require(\"./TextStyleCache\");\nconst DEFAULT_STYLE_NAME = \"default\";\nconst DEFAULT_FONT_CATALOG_NAME = \"default\";\nconst MAX_INITIALIZED_TEXT_ELEMENTS_PER_FRAME = Infinity;\nconst MIN_GLYPH_COUNT = 1024;\nconst MAX_GLYPH_COUNT = 32768;\n/**\n * Default number of labels/POIs rendered in the scene\n */\nconst DEFAULT_MAX_NUM_RENDERED_TEXT_ELEMENTS = 500;\n/**\n * Default distance scale. Will be applied if distanceScale is not defined in the technique.\n * Defines the scale that will be applied to labeled icons (icon and text) in the distance.\n */\nexports.DEFAULT_TEXT_DISTANCE_SCALE = 0.5;\n/**\n * Number of elements that are put into second queue. This second chance queue is used to render\n * TextElements that have not been on screen before. This is a quick source for elements that can\n * appear when the camera moves a bit, before new elements are placed.\n */\nconst DEFAULT_MAX_NUM_SECOND_CHANCE_ELEMENTS = 300;\n/**\n * Maximum distance for text labels expressed as a ratio of distance to from the camera (0) to the\n * far plane (1.0). May be synchronized with fog value ?\n */\nconst DEFAULT_MAX_DISTANCE_RATIO_FOR_TEXT_LABELS = 0.99;\n/**\n * Distance to the camera (range: `[0.0, 1.0]`) from which label start to scale.\n */\nconst DEFAULT_LABEL_SCALE_START_DISTANCE = 0.4;\n/**\n * Maximum number of recommended labels. If more labels are encountered, the \"overloaded\" mode is\n * set, which modifies the behavior of label placement and rendering, trying to keep delivering an\n * interactive performance. The overloaded mode should not be activated if the [[MapView]] is\n * rendering a static image (camera not moving and no animation running).\n */\nconst OVERLOAD_LABEL_LIMIT = 20000;\n/**\n * If \"overloaded\" is `true`:\n *\n * Default number of labels/POIs placed in the scene. They are rendered only if they fit. If the\n * camera is not moving, it is ignored. See [[TextElementsRenderer.isDynamicFrame]].\n */\nconst OVERLOAD_PLACED_LABEL_LIMIT = 100;\n/**\n * If \"overloaded\" is `true`:\n *\n * Maximum time in milliseconds available for placement. If value is <= 0, or if the camera is not\n * moving, it is ignored. See [[TextElementsRenderer.isDynamicFrame]].\n */\nconst OVERLOAD_PLACEMENT_TIME_LIMIT = 5;\n/**\n * If \"overloaded\" is `true`:\n *\n * Maximum time in milliseconds available for rendering. If value is <= 0, or if the camera is not\n * moving, it is ignored. See [[TextElementsRenderer.isDynamicFrame]].\n */\nconst OVERLOAD_RENDER_TIME_LIMIT = 10;\n/**\n * Minimum number of pixels per character. Used during estimation if there is enough screen space\n * available to render a text.\n */\nconst MIN_AVERAGE_CHAR_WIDTH = 5;\n// Development flag: Enable debug print.\nconst PRINT_LABEL_DEBUG_INFO = false;\nconst logger = harp_utils_1.LoggerManager.instance.create(\"TextElementsRenderer\");\nconst tempBox = new THREE.Box2();\nconst tempBoxes = [];\nconst tempBox2D = new harp_utils_1.Math2D.Box();\nconst tempPosition = new THREE.Vector3();\nconst tempPoiPosition = new THREE.Vector3(0, 0, 0);\nconst tempScreenPosition = new THREE.Vector2();\nconst tempPoiScreenPosition = new THREE.Vector2();\nclass TileTextElements {\n    constructor(tile, textElements) {\n        this.tile = tile;\n        this.textElements = textElements;\n    }\n}\nclass TextElementLists {\n    constructor(priority, textElementLists) {\n        this.priority = priority;\n        this.textElementLists = textElementLists;\n    }\n    /**\n     * Sum up the number of elements in all lists.\n     */\n    count() {\n        let n = 0;\n        for (const list of this.textElementLists) {\n            n += list.textElements.length;\n        }\n        return n;\n    }\n}\n/**\n * @hidden\n *\n * Internal class to manage all text rendering.\n */\nclass TextElementsRenderer {\n    /**\n     * Create the `TextElementsRenderer` which selects which labels should be placed on screen as\n     * a preprocessing step, which is not done every frame, and also renders the placed\n     * [[TextElement]]s every frame.\n     *\n     * @param m_mapView MapView to render into\n     * @param m_screenCollisions General 2D screen occlusion management, may be shared between\n     *     instances.\n     * @param m_screenProjector Projects 3D coordinates into screen space.\n     * @param m_minNumGlyphs Minimum number of glyphs (per-layer). Controls the size of internal\n     * buffers.\n     * @param m_maxNumGlyphs Maximum number of glyphs (per-layer). Controls the size of internal\n     * buffers.\n     * @param m_theme Theme defining  text styles.\n     * @param m_maxNumVisibleLabels Maximum number of visible [[TextElement]]s.\n     * @param m_numSecondChanceLabels Number of [[TextElement]] that will be rendered again.\n     * @param m_maxDistanceRatioForLabels Maximum distance for [[TextElement]] and icons, expressed\n     *          as a fraction of the distance between the near and far plane [0, 1.0].\n     *          Defaults to `0.99`.\n     * @param m_labelStartScaleDistance Distance at which the [[TextElement]]s start to apply their\n     *          `distanceScale` value, expressed as a fraction of the distance between the near and\n     *          far plane [0, 1.0]. Defaults to `0.4`.\n     */\n    constructor(m_mapView, m_screenCollisions, m_screenProjector, m_minNumGlyphs, m_maxNumGlyphs, m_theme, m_maxNumVisibleLabels, m_numSecondChanceLabels, m_maxDistanceRatioForLabels, m_labelStartScaleDistance) {\n        this.m_mapView = m_mapView;\n        this.m_screenCollisions = m_screenCollisions;\n        this.m_screenProjector = m_screenProjector;\n        this.m_minNumGlyphs = m_minNumGlyphs;\n        this.m_maxNumGlyphs = m_maxNumGlyphs;\n        this.m_theme = m_theme;\n        this.m_maxNumVisibleLabels = m_maxNumVisibleLabels;\n        this.m_numSecondChanceLabels = m_numSecondChanceLabels;\n        this.m_maxDistanceRatioForLabels = m_maxDistanceRatioForLabels;\n        this.m_labelStartScaleDistance = m_labelStartScaleDistance;\n        this.m_initializedTextElementCount = 0;\n        this.m_textRenderers = [];\n        this.m_textStyles = new Map();\n        this.m_defaultStyle = {\n            name: DEFAULT_STYLE_NAME,\n            fontCatalog: DEFAULT_FONT_CATALOG_NAME,\n            renderParams: this.m_mapView.textRenderStyleCache.get(TextStyleCache_1.DEFAULT_TEXT_STYLE_CACHE_ID).params,\n            layoutParams: this.m_mapView.textLayoutStyleCache.get(TextStyleCache_1.DEFAULT_TEXT_STYLE_CACHE_ID).params\n        };\n        this.m_lastRenderedTextElements = [];\n        this.m_secondChanceTextElements = [];\n        this.m_tmpVector = new THREE.Vector2();\n        this.m_overloaded = false;\n        this.m_catalogsLoading = 0;\n        if (this.m_minNumGlyphs === undefined) {\n            this.m_minNumGlyphs = MIN_GLYPH_COUNT;\n        }\n        if (this.m_maxNumGlyphs === undefined) {\n            this.m_maxNumGlyphs = MAX_GLYPH_COUNT;\n        }\n        if (this.m_maxNumVisibleLabels === undefined) {\n            this.m_maxNumVisibleLabels = DEFAULT_MAX_NUM_RENDERED_TEXT_ELEMENTS;\n        }\n        if (this.m_numSecondChanceLabels === undefined) {\n            this.m_numSecondChanceLabels = DEFAULT_MAX_NUM_SECOND_CHANCE_ELEMENTS;\n        }\n        if (this.m_maxDistanceRatioForLabels === undefined) {\n            this.m_maxDistanceRatioForLabels = DEFAULT_MAX_DISTANCE_RATIO_FOR_TEXT_LABELS;\n        }\n        if (this.m_labelStartScaleDistance === undefined) {\n            this.m_labelStartScaleDistance = DEFAULT_LABEL_SCALE_START_DISTANCE;\n        }\n        this.initializeDefaultAssets();\n        this.initializeTextCanvases();\n    }\n    /**\n     * Render the text using the specified camera into the current canvas.\n     *\n     * @param camera Orthographic camera to use.\n     */\n    renderText(camera) {\n        const debugGlyphs = DebugContext_1.debugContext.getValue(\"DEBUG_GLYPHS\");\n        if (debugGlyphs !== undefined &&\n            this.m_debugGlyphTextureCacheMesh !== undefined &&\n            this.m_debugGlyphTextureCacheWireMesh !== undefined) {\n            this.m_debugGlyphTextureCacheMesh.visible = debugGlyphs;\n            this.m_debugGlyphTextureCacheWireMesh.visible = debugGlyphs;\n        }\n        for (const textRenderer of this.m_textRenderers) {\n            textRenderer.textCanvas.render(camera);\n        }\n    }\n    /**\n     * Reset internal state at the beginning of a frame.\n     */\n    reset() {\n        this.m_screenCollisions.reset();\n        for (const textRenderer of this.m_textRenderers) {\n            textRenderer.textCanvas.clear();\n            textRenderer.poiRenderer.reset();\n        }\n        this.m_initializedTextElementCount = 0;\n    }\n    /**\n     * Update the geometries at the end of a frame before rendering them.\n     */\n    update() {\n        for (const textRenderer of this.m_textRenderers) {\n            textRenderer.poiRenderer.update();\n        }\n    }\n    /**\n     * Visit all visible tiles and place their text labels and POI icons. The placement of\n     * [[TextElement]]s is a time consuming process, and cannot be done every frame, but should only\n     * be done when the camera moved (a lot) of whenever the set of visible tiles change.\n     *\n     * The actually rendered [[TextElement]]s are stored internally until the next placement is done\n     * to speed up rendering when no camera movement was detected.\n     */\n    placeAllTileLabels() {\n        this.placeAllLabels();\n    }\n    /**\n     * Notify `TextElementsRenderer` that the camera has started a movement.\n     */\n    movementStarted() {\n        // Nothing to do (yet)\n    }\n    /**\n     * Notify `TextElementsRenderer` that the camera has finished its movement.\n     */\n    movementFinished() {\n        this.placeAllLabels();\n    }\n    /**\n     * Default [[TextElementStyle]] used to render [[TextElement]]s.\n     */\n    get defaultStyle() {\n        return this.m_defaultStyle;\n    }\n    /**\n     * Is `true` if number of [[TextElement]]s in visible tiles is larger than the recommended\n     * number `OVERLOAD_LABEL_LIMIT`.\n     */\n    get overloaded() {\n        return this.m_overloaded;\n    }\n    /**\n     * Is `true` if [[MapView]] is currently animating or the camera is moving or an update is\n     * pending.\n     */\n    get isDynamicFrame() {\n        const mapView = this.m_mapView;\n        return mapView.cameraIsMoving || mapView.animating || mapView.updatePending;\n    }\n    /**\n     * Render the user [[TextElement]]s.\n     *\n     * @param time Current time for animations.\n     * @param frameNumber Integer number incremented every frame.\n     */\n    renderUserTextElements(time, frameNumber) {\n        const renderList = this.m_mapView.visibleTileSet.dataSourceTileList;\n        // Take the world position of the camera as the origin to compute the distance to the\n        // text elements.\n        const worldCenter = this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position);\n        const zoomLevel = this.m_mapView.zoomLevel;\n        // Render the user POIs first\n        renderList.forEach(renderListEntry => {\n            for (const tile of renderListEntry.visibleTiles) {\n                for (const textElement of tile.userTextElements) {\n                    // update distance\n                    textElement.tileCenterX = tile.center.x;\n                    textElement.tileCenterY = tile.center.y;\n                    this.updateViewDistance(worldCenter, textElement);\n                }\n                this.renderTextElements(tile.userTextElements, time, frameNumber, zoomLevel);\n            }\n        });\n    }\n    /**\n     * Re-render the previously placed [[TextElement]]s.\n     *\n     * @param time Current time for animations.\n     * @param frameNumber Integer number incremented every frame.\n     */\n    renderAllTileText(time, frameNumber) {\n        const renderList = this.m_mapView.visibleTileSet.dataSourceTileList;\n        const zoomLevel = this.m_mapView.zoomLevel;\n        this.checkIfOverloaded();\n        if (this.m_lastRenderedTextElements.length === 0) {\n            const renderStartTime = this.overloaded && this.isDynamicFrame ? harp_utils_1.PerformanceTimer.now() : undefined;\n            // Nothing has been rendered before, process the list of placed labels in all tiles.\n            renderList.forEach(renderListEntry => {\n                this.renderTileList(renderListEntry.renderedTiles, time, frameNumber, zoomLevel, renderStartTime, this.m_lastRenderedTextElements, this.m_secondChanceTextElements);\n            });\n        }\n        else {\n            //TODO: Avoid list allocation\n            const allRenderableTextElements = this.m_lastRenderedTextElements.concat(this.m_secondChanceTextElements);\n            this.renderTextElements(allRenderableTextElements, time, frameNumber, zoomLevel);\n        }\n    }\n    /**\n     * Render the [[TextElement]]s that are not part of the scene, but the overlay. Useful if a UI\n     * with text or just plain information in the canvas itself should be presented to the user,\n     * instead of using an HTML layer.\n     *\n     * @param textElements List of [[TextElement]]s in the overlay.\n     */\n    renderOverlay(textElements) {\n        if (textElements === undefined || textElements.length === 0) {\n            return;\n        }\n        this.renderOverlayTextElements(textElements);\n    }\n    /**\n     * Fill the picking results for the pixel with the given screen coordinate. If multiple\n     * [[TextElement]]s are found, the order of the results is unspecified.\n     *\n     * Note: [[TextElement]]s with identical `featureId` or identical `userData` will only appear\n     * once in the list `pickResults`.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickResults Array filled with pick results.\n     */\n    pickTextElements(screenPosition, pickResults) {\n        const pickHandler = (pickData, pickObjectType) => {\n            const textElement = pickData;\n            if (textElement === undefined) {\n                return;\n            }\n            let isDuplicate = false;\n            if (textElement.featureId !== undefined) {\n                isDuplicate = pickResults.some(pickResult => {\n                    return (pickResult !== undefined &&\n                        pickObjectType === pickResult.type &&\n                        ((pickResult.featureId !== undefined &&\n                            pickResult.featureId === textElement.featureId) ||\n                            (pickResult.userData !== undefined &&\n                                pickResult.userData === textElement.userData)));\n                });\n                if (!isDuplicate) {\n                    const pickResult = {\n                        type: pickObjectType,\n                        point: screenPosition,\n                        distance: 0,\n                        featureId: textElement.featureId,\n                        userData: textElement.userData,\n                        text: textElement.text\n                    };\n                    pickResults.push(pickResult);\n                }\n            }\n        };\n        for (const textRenderer of this.m_textRenderers) {\n            textRenderer.textCanvas.pickText(screenPosition, (pickData) => {\n                pickHandler(pickData, PickHandler_1.PickObjectType.Text);\n            });\n            textRenderer.poiRenderer.pickTextElements(screenPosition, (pickData) => {\n                pickHandler(pickData, PickHandler_1.PickObjectType.Icon);\n            });\n        }\n    }\n    /**\n     * Retrieves a [[TextElementStyle]] for [[Theme]]'s [[TextStyle]] id.\n     */\n    getTextElementStyle(styleId) {\n        let result;\n        if (styleId === undefined) {\n            result = this.m_defaultStyle;\n        }\n        else {\n            result = this.m_textStyles.get(styleId);\n            if (result === undefined) {\n                result = this.m_defaultStyle;\n            }\n        }\n        return result;\n    }\n    /**\n     * `true` if font catalogs are ready, that means all font catalogs are initialized.\n     */\n    get ready() {\n        return this.m_catalogsLoading === 0 && this.m_textRenderers.length > 0;\n    }\n    /**\n     * `true` if any resource used by any `FontCatalog` is still loading.\n     */\n    get loading() {\n        let isLoading = this.m_catalogsLoading > 0;\n        for (const textRenderer of this.m_textRenderers) {\n            isLoading = isLoading || textRenderer.textCanvas.fontCatalog.isLoading;\n        }\n        return isLoading;\n    }\n    /**\n     * Reset the current text render states of all visible tiles. All [[TextElement]]s will fade in\n     * after that as if they have just been added.\n     */\n    clearRenderStates() {\n        const renderList = this.m_mapView.visibleTileSet.dataSourceTileList;\n        renderList.forEach(renderListEntry => {\n            for (const tile of renderListEntry.visibleTiles) {\n                // Reset the render states, handle them as if they were just added to the tile.\n                tile.userTextElements.forEach(textElement => {\n                    textElement.iconRenderState = undefined;\n                    textElement.textRenderState = undefined;\n                });\n                tile.textElementGroups.forEach(textElement => {\n                    textElement.iconRenderState = undefined;\n                    textElement.textRenderState = undefined;\n                });\n            }\n        });\n    }\n    /**\n     * Return memory used by all objects managed by `TextElementsRenderer`.\n     *\n     * @returns `MemoryUsage` Heap and GPU memory used by this `TextElementsRenderer`.\n     */\n    getMemoryUsage() {\n        const memoryUsage = {\n            heapSize: 0,\n            gpuSize: 0\n        };\n        for (const renderer of this.m_textRenderers) {\n            renderer.textCanvas.getMemoryUsage(memoryUsage);\n            renderer.poiRenderer.getMemoryUsage(memoryUsage);\n        }\n        return memoryUsage;\n    }\n    initializeDefaultAssets() {\n        // Initialize default font catalog.\n        if (this.m_theme.fontCatalogs === undefined ||\n            (Array.isArray(this.m_theme.fontCatalogs) && this.m_theme.fontCatalogs.length === 0)) {\n            this.m_theme.fontCatalogs = [\n                {\n                    name: DEFAULT_FONT_CATALOG_NAME,\n                    url: this.m_mapView.defaultFontCatalog\n                }\n            ];\n        }\n        const fontCatalogs = this.m_theme.fontCatalogs;\n        let defaultFontCatalogName;\n        if (fontCatalogs.length > 0) {\n            for (const fontCatalog of fontCatalogs) {\n                if (fontCatalog.name !== undefined) {\n                    defaultFontCatalogName = fontCatalog.name;\n                    break;\n                }\n            }\n            if (defaultFontCatalogName === undefined) {\n                defaultFontCatalogName = DEFAULT_FONT_CATALOG_NAME;\n                fontCatalogs[0].name = defaultFontCatalogName;\n            }\n        }\n        // Initialize default text style.\n        if (this.m_theme.textStyles === undefined) {\n            this.m_theme.textStyles = [];\n        }\n        const styles = this.m_theme.textStyles;\n        const themedDefaultStyle = styles.find(style => style.name === DEFAULT_STYLE_NAME);\n        if (themedDefaultStyle !== undefined) {\n            this.m_defaultStyle = this.createTextElementStyle(themedDefaultStyle, DEFAULT_STYLE_NAME);\n        }\n        else if (this.m_theme.defaultTextStyle !== undefined) {\n            this.m_defaultStyle = this.createTextElementStyle(this.m_theme.defaultTextStyle, DEFAULT_STYLE_NAME);\n        }\n        else if (styles.length > 0) {\n            this.m_defaultStyle = this.createTextElementStyle(styles[0], DEFAULT_STYLE_NAME);\n        }\n        this.m_defaultStyle.fontCatalog = defaultFontCatalogName;\n    }\n    createTextElementStyle(style, styleName) {\n        return {\n            name: styleName,\n            fontCatalog: harp_utils_1.getOptionValue(style.fontCatalogName, DEFAULT_FONT_CATALOG_NAME),\n            renderParams: {\n                fontSize: {\n                    unit: harp_text_canvas_1.FontUnit.Pixel,\n                    size: 32,\n                    backgroundSize: style.backgroundSize || 8\n                },\n                fontVariant: style.smallCaps === true\n                    ? harp_text_canvas_1.FontVariant.SmallCaps\n                    : style.allCaps === true\n                        ? harp_text_canvas_1.FontVariant.AllCaps\n                        : undefined,\n                fontStyle: style.bold === true\n                    ? style.oblique === true\n                        ? harp_text_canvas_1.FontStyle.BoldItalic\n                        : harp_text_canvas_1.FontStyle.Bold\n                    : style.oblique === true\n                        ? harp_text_canvas_1.FontStyle.Italic\n                        : undefined,\n                color: style.color !== undefined\n                    ? ColorCache_1.ColorCache.instance.getColor(style.color)\n                    : undefined,\n                backgroundColor: style.backgroundColor !== undefined\n                    ? ColorCache_1.ColorCache.instance.getColor(style.backgroundColor)\n                    : undefined,\n                backgroundOpacity: style.backgroundAlpha\n            },\n            layoutParams: {\n                tracking: style.tracking,\n                verticalAlignment: harp_text_canvas_1.VerticalAlignment.Center,\n                horizontalAlignment: harp_text_canvas_1.HorizontalAlignment.Center\n            }\n        };\n    }\n    initializeTextCanvases() {\n        const promises = [];\n        this.m_theme.fontCatalogs.forEach(fontCatalogConfig => {\n            this.m_catalogsLoading += 1;\n            const fontCatalogPromise = harp_text_canvas_1.FontCatalog.load(fontCatalogConfig.url, 1024)\n                .then((loadedFontCatalog) => {\n                this.m_catalogsLoading -= 1;\n                const loadedTextCanvas = new harp_text_canvas_1.TextCanvas({\n                    renderer: this.m_mapView.renderer,\n                    fontCatalog: loadedFontCatalog,\n                    minGlyphCount: this.m_minNumGlyphs,\n                    maxGlyphCount: this.m_maxNumGlyphs\n                });\n                this.m_textRenderers.push({\n                    fontCatalog: fontCatalogConfig.name,\n                    textCanvas: loadedTextCanvas,\n                    poiRenderer: new PoiRenderer_1.PoiRenderer(this.m_mapView, loadedTextCanvas)\n                });\n            })\n                .catch((error) => {\n                this.m_catalogsLoading -= 1;\n                logger.error(\"Failed to load FontCatalog: \", error);\n            });\n            promises.push(fontCatalogPromise);\n        });\n        Promise.all(promises).then(() => {\n            this.initializeTextElementStyles();\n            const defaultFontCatalog = this.m_textRenderers[0].textCanvas.fontCatalog;\n            // Initialize glyph-debugging mesh.\n            const planeGeometry = new THREE.PlaneGeometry(defaultFontCatalog.textureSize.width / 2.5, defaultFontCatalog.textureSize.height / 2.5, defaultFontCatalog.textureSize.width / defaultFontCatalog.maxWidth, defaultFontCatalog.textureSize.height / defaultFontCatalog.maxHeight);\n            const material = new THREE.MeshBasicMaterial({\n                transparent: true,\n                depthWrite: false,\n                depthTest: false,\n                map: defaultFontCatalog.texture\n            });\n            this.m_debugGlyphTextureCacheMesh = new THREE.Mesh(planeGeometry, material);\n            this.m_debugGlyphTextureCacheMesh.renderOrder = 10000;\n            this.m_debugGlyphTextureCacheMesh.visible = false;\n            this.m_debugGlyphTextureCacheMesh.name = \"glyphDebug\";\n            const wireframe = new THREE.WireframeGeometry(planeGeometry);\n            const wireframeMaterial = new THREE.LineBasicMaterial({\n                transparent: true,\n                color: 0x999999,\n                depthWrite: false,\n                depthTest: false\n            });\n            this.m_debugGlyphTextureCacheWireMesh = new THREE.LineSegments(wireframe, wireframeMaterial);\n            this.m_debugGlyphTextureCacheWireMesh.renderOrder = 9999;\n            this.m_debugGlyphTextureCacheWireMesh.visible = false;\n            this.m_debugGlyphTextureCacheWireMesh.name = \"glyphDebug\";\n            this.m_textRenderers[0].textCanvas\n                .getLayer(harp_text_canvas_1.DEFAULT_TEXT_CANVAS_LAYER)\n                .storage.scene.add(this.m_debugGlyphTextureCacheMesh, this.m_debugGlyphTextureCacheWireMesh);\n            this.m_mapView.update();\n        });\n    }\n    initializeTextElementStyles() {\n        // Find the default TextCanvas and PoiRenderer.\n        let defaultTextCanvas;\n        this.m_textRenderers.forEach(textRenderer => {\n            if (defaultTextCanvas === undefined) {\n                defaultTextCanvas = textRenderer.textCanvas;\n            }\n        });\n        const defaultPoiRenderer = new PoiRenderer_1.PoiRenderer(this.m_mapView, defaultTextCanvas);\n        // Initialize default text style.\n        if (this.m_defaultStyle.fontCatalog !== undefined) {\n            const styledTextRenderer = this.m_textRenderers.find(textRenderer => textRenderer.fontCatalog === this.m_defaultStyle.fontCatalog);\n            this.m_defaultStyle.textCanvas =\n                styledTextRenderer !== undefined ? styledTextRenderer.textCanvas : undefined;\n            this.m_defaultStyle.poiRenderer =\n                styledTextRenderer !== undefined ? styledTextRenderer.poiRenderer : undefined;\n        }\n        if (this.m_defaultStyle.textCanvas === undefined) {\n            if (this.m_defaultStyle.fontCatalog !== undefined) {\n                logger.warn(`FontCatalog '${this.m_defaultStyle.fontCatalog}' set in TextStyle '${this.m_defaultStyle.name}' not found, using default fontCatalog(${defaultTextCanvas.fontCatalog.name}).`);\n            }\n            this.m_defaultStyle.textCanvas = defaultTextCanvas;\n            this.m_defaultStyle.poiRenderer = defaultPoiRenderer;\n        }\n        // Initialize theme text styles.\n        this.m_theme.textStyles.forEach(element => {\n            this.m_textStyles.set(element.name, this.createTextElementStyle(element, element.name));\n        });\n        // tslint:disable-next-line:no-unused-variable\n        for (const [name, style] of this.m_textStyles) {\n            if (style.textCanvas === undefined) {\n                if (style.fontCatalog !== undefined) {\n                    const styledTextRenderer = this.m_textRenderers.find(textRenderer => textRenderer.fontCatalog === style.fontCatalog);\n                    style.textCanvas =\n                        styledTextRenderer !== undefined\n                            ? styledTextRenderer.textCanvas\n                            : undefined;\n                    style.poiRenderer =\n                        styledTextRenderer !== undefined\n                            ? styledTextRenderer.poiRenderer\n                            : undefined;\n                }\n                if (style.textCanvas === undefined) {\n                    if (style.fontCatalog !== undefined) {\n                        logger.warn(`FontCatalog '${style.fontCatalog}' set in TextStyle '${style.name}' not found, using default fontCatalog(${defaultTextCanvas.fontCatalog.name}).`);\n                    }\n                    style.textCanvas = defaultTextCanvas;\n                    style.poiRenderer = defaultPoiRenderer;\n                }\n            }\n        }\n    }\n    updateViewDistance(worldCenter, textElement) {\n        let viewDistance;\n        if (textElement.points instanceof THREE.Vector2 ||\n            textElement.points instanceof THREE.Vector3) {\n            // For POIs:\n            const pos = textElement.position3;\n            tempPoiPosition.x = pos.x + textElement.tileCenterX;\n            tempPoiPosition.y = pos.y + textElement.tileCenterY;\n            viewDistance = worldCenter.distanceTo(tempPoiPosition);\n        }\n        else if (Array.isArray(textElement.points)) {\n            if (textElement.points.length === 1) {\n                const posPoint = textElement.points[0];\n                tempPoiPosition.x = posPoint.x + textElement.tileCenterX;\n                tempPoiPosition.y = posPoint.y + textElement.tileCenterY;\n                viewDistance = worldCenter.distanceTo(tempPoiPosition);\n            }\n            else if (textElement.points.length > 1) {\n                const pathPoints = textElement.points;\n                let posPoint = pathPoints[0];\n                tempPoiPosition.x = posPoint.x + textElement.tileCenterX;\n                tempPoiPosition.y = posPoint.y + textElement.tileCenterY;\n                const viewDistance0 = worldCenter.distanceTo(tempPoiPosition);\n                posPoint = pathPoints[pathPoints.length - 1];\n                tempPoiPosition.x = posPoint.x + textElement.tileCenterX;\n                tempPoiPosition.y = posPoint.y + textElement.tileCenterY;\n                const viewDistance1 = worldCenter.distanceTo(tempPoiPosition);\n                viewDistance = Math.min(viewDistance0, viewDistance1);\n            }\n        }\n        textElement.currentViewDistance = viewDistance;\n        return viewDistance;\n    }\n    sortTextElements(textElements, maxViewDistance) {\n        const distancePriorityFactor = 0.1;\n        const indexPriorityFactor = 0.01 * (1 / textElements.length);\n        // Compute the sortPriority once for all elements, because the computation is done more\n        // than once per element. Also, make sorting stable by taking the index into the array into\n        // account, this is required to get repeatable results for testing.\n        for (let i = 0; i < textElements.length; i++) {\n            const textElement = textElements[i];\n            textElement.sortPriority =\n                textElement.priority +\n                    i * indexPriorityFactor +\n                    distancePriorityFactor -\n                    distancePriorityFactor * (textElement.currentViewDistance / maxViewDistance);\n        }\n        // Do the actual sort based on sortPriority\n        textElements.sort((a, b) => {\n            return b.sortPriority - a.sortPriority;\n        });\n    }\n    placeAllLabels() {\n        const renderList = this.m_mapView.visibleTileSet.dataSourceTileList;\n        const zoomLevel = this.m_mapView.zoomLevel;\n        this.checkIfOverloaded();\n        const placementStartTime = this.overloaded && this.isDynamicFrame ? harp_utils_1.PerformanceTimer.now() : undefined;\n        renderList.forEach(tileList => {\n            this.placeTextElements(tileList.dataSource, tileList.storageLevel, zoomLevel, tileList.visibleTiles, placementStartTime);\n        });\n        this.m_lastRenderedTextElements.length = 0;\n        this.m_secondChanceTextElements.length = 0;\n    }\n    placeTextElements(tileDataSource, storageLevel, zoomLevel, visibleTiles, placementStartTime) {\n        const sortedTiles = visibleTiles;\n        sortedTiles.sort((a, b) => {\n            return a.tileKey.mortonCode() - b.tileKey.mortonCode();\n        });\n        for (const tile of sortedTiles) {\n            this.prepareUserTextElements(tile);\n        }\n        const sortedGroups = [];\n        this.createSortedGroupsForSorting(tileDataSource, storageLevel, sortedTiles, sortedGroups);\n        const textElementGroups = [];\n        let numTextElementsPlaced = 0;\n        for (const textElementLists of sortedGroups) {\n            this.selectTextElementsToPlaceByDistance(zoomLevel, textElementLists, textElementGroups);\n            // The value of placementStartTime is set if this.overloaded is true.\n            if (placementStartTime !== undefined) {\n                // If overloaded and all time is used up, exit early.\n                if (OVERLOAD_PLACEMENT_TIME_LIMIT > 0) {\n                    const endTime = harp_utils_1.PerformanceTimer.now();\n                    const elapsedTime = endTime - placementStartTime;\n                    if (elapsedTime > OVERLOAD_PLACEMENT_TIME_LIMIT) {\n                        break;\n                    }\n                }\n                // Try not to place too many elements. They will be checked for visibility each\n                // frame.\n                numTextElementsPlaced += textElementLists.count();\n                if (numTextElementsPlaced >= OVERLOAD_PLACED_LABEL_LIMIT) {\n                    break;\n                }\n            }\n        }\n    }\n    /**\n     * Process any (new) user [[TextElement]], which has not been placed by the PoiManager, to set\n     * it up for rendering.\n     *\n     * @param tile The Tile to process all user [[TextElements]] of.\n     */\n    prepareUserTextElements(tile) {\n        for (const textElement of tile.userTextElements) {\n            textElement.tileCenterX = tile.center.x;\n            textElement.tileCenterY = tile.center.y;\n        }\n    }\n    createSortedGroupsForSorting(tileDataSource, storageLevel, sortedTiles, sortedGroups) {\n        if (this.m_textRenderers.length === 0 || sortedTiles.length === 0) {\n            return;\n        }\n        const tilesToRender = [];\n        for (const tile of sortedTiles) {\n            tile.placedTextElements.clear();\n            if (tileDataSource.shouldRenderText(storageLevel, tile.tileKey)) {\n                tilesToRender.push(tile);\n            }\n        }\n        const groupedPriorityLists = new Map();\n        for (const tile of tilesToRender) {\n            for (const group of tile.textElementGroups.groups.values()) {\n                if (group.elements.length === 0) {\n                    continue;\n                }\n                const foundGroup = groupedPriorityLists.get(group.priority);\n                if (foundGroup === undefined) {\n                    groupedPriorityLists.set(group.priority, new TextElementLists(group.priority, [\n                        new TileTextElements(tile, group.elements)\n                    ]));\n                }\n                else {\n                    foundGroup.textElementLists.push(new TileTextElements(tile, group.elements));\n                }\n            }\n        }\n        if (groupedPriorityLists.size === 0) {\n            return;\n        }\n        for (const g of groupedPriorityLists) {\n            const lists = g[1];\n            sortedGroups.push(lists);\n        }\n        sortedGroups.sort((a, b) => {\n            return b.priority - a.priority;\n        });\n        const printTextInfo = false;\n        if (PRINT_LABEL_DEBUG_INFO && printTextInfo) {\n            let outString = \"\";\n            for (const textElementLists of sortedGroups) {\n                let size = 0;\n                for (const tileTextElements of textElementLists.textElementLists) {\n                    size += tileTextElements.textElements.length;\n                }\n                outString += `priority ${textElementLists.priority} size: ${size}\\n`;\n            }\n            logger.log(outString);\n        }\n    }\n    getMaxDistance(farDistanceLimitRatio) {\n        const farDistance = this.m_mapView.camera.far;\n        const maxDistance = farDistance * farDistanceLimitRatio;\n        return maxDistance;\n    }\n    selectTextElementsToPlaceByDistance(zoomLevel, textElementLists, textElementGroups) {\n        // Take the world position of the camera as the origin to compute the distance to the\n        // text elements.\n        const worldCenter = this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position);\n        const farDistanceLimitRatio = this.m_maxDistanceRatioForLabels;\n        const maxDistance = this.getMaxDistance(farDistanceLimitRatio);\n        const textElementGroup = [];\n        for (const tileTextElements of textElementLists.textElementLists) {\n            const tile = tileTextElements.tile;\n            const worldOffsetX = this.m_mapView.projection.worldExtent(0, 0).max.x * tile.offset;\n            for (const textElement of tileTextElements.textElements) {\n                if (!textElement.visible) {\n                    continue;\n                }\n                // If a PoiTable is specified in the technique, the table is required to be\n                // loaded before the POI can be rendered.\n                if (textElement.poiInfo !== undefined &&\n                    textElement.poiInfo.poiTableName !== undefined) {\n                    if (this.m_mapView.poiManager.updatePoiFromPoiTable(textElement)) {\n                        // Remove poiTableName to mark this POI as processed.\n                        textElement.poiInfo.poiTableName = undefined;\n                    }\n                    else {\n                        // PoiTable has not been loaded, but is required to determine\n                        // visibility.\n                        continue;\n                    }\n                }\n                if (!textElement.visible ||\n                    !harp_utils_1.MathUtils.isClamped(zoomLevel, textElement.minZoomLevel, textElement.maxZoomLevel)) {\n                    continue;\n                }\n                textElement.tileCenterX = tile.center.x + worldOffsetX;\n                textElement.tileCenterY = tile.center.y;\n                const textDistance = this.updateViewDistance(worldCenter, textElement);\n                // If the distance is greater than allowed, skip it.\n                if (textDistance !== undefined && textDistance > maxDistance) {\n                    continue;\n                }\n                tile.placedTextElements.add(textElement);\n            }\n        }\n        textElementGroups.push(textElementGroup);\n    }\n    renderOverlayTextElements(textElements) {\n        if (this.m_textRenderers.length === 0) {\n            return;\n        }\n        const screenSize = this.m_mapView.renderer.getSize(this.m_tmpVector);\n        const screenXOrigin = -screenSize.width / 2.0;\n        const screenYOrigin = screenSize.height / 2.0;\n        const tempAdditionParams = {};\n        const tempBufferAdditionParams = {};\n        // Place text elements one by one.\n        for (const textElement of textElements) {\n            // Get the TextElementStyle.\n            const textElementStyle = this.getTextElementStyle(textElement.style);\n            const textCanvas = textElementStyle.textCanvas;\n            if (textCanvas === undefined) {\n                continue;\n            }\n            const layer = textCanvas.getLayer(textElement.renderOrder || harp_text_canvas_1.DEFAULT_TEXT_CANVAS_LAYER);\n            const isPathLabel = textElement.path !== undefined && !textElement.isLineMarker;\n            // Trigger the glyph load if needed.\n            if (textElement.loadingState === undefined) {\n                textElement.loadingState = TextElement_1.LoadingState.Requested;\n                if (textElement.renderStyle === undefined) {\n                    textElement.renderStyle = new harp_text_canvas_1.TextRenderStyle(Object.assign({}, textElementStyle.renderParams, textElement.renderParams));\n                }\n                if (textElement.layoutStyle === undefined) {\n                    textElement.layoutStyle = new harp_text_canvas_1.TextLayoutStyle(Object.assign({}, textElementStyle.layoutParams, textElement.layoutParams));\n                }\n                if (textElement.text === \"\") {\n                    textElement.loadingState = TextElement_1.LoadingState.Loaded;\n                }\n                else {\n                    textCanvas.fontCatalog\n                        .loadCharset(textElement.text, textElement.renderStyle)\n                        .then(() => {\n                        textElement.loadingState = TextElement_1.LoadingState.Loaded;\n                        this.m_mapView.update();\n                    });\n                }\n            }\n            if (textElement.loadingState === TextElement_1.LoadingState.Loaded) {\n                if (this.m_initializedTextElementCount < MAX_INITIALIZED_TEXT_ELEMENTS_PER_FRAME) {\n                    textCanvas.textRenderStyle = textElement.renderStyle;\n                    textCanvas.textLayoutStyle = textElement.layoutStyle;\n                    textElement.glyphCaseArray = [];\n                    textElement.glyphs = textCanvas.fontCatalog.getGlyphs(textElement.text, textCanvas.textRenderStyle, textElement.glyphCaseArray);\n                    textElement.loadingState = TextElement_1.LoadingState.Initialized;\n                    ++this.m_initializedTextElementCount;\n                }\n            }\n            if (textElement.loadingState !== TextElement_1.LoadingState.Initialized) {\n                continue;\n            }\n            // Move onto the next TextElement if we cannot continue adding glyphs to this layer.\n            if (layer !== undefined) {\n                if (layer.storage.drawCount + textElement.glyphs.length > layer.storage.capacity) {\n                    continue;\n                }\n            }\n            // Set the current style for the canvas.\n            textCanvas.textRenderStyle = textElement.renderStyle;\n            textCanvas.textLayoutStyle = textElement.layoutStyle;\n            // Place text.\n            let textPath;\n            if (!isPathLabel) {\n                // Adjust the label positioning.\n                tempScreenPosition.x = screenXOrigin + textElement.position.x * screenSize.width;\n                tempScreenPosition.y = screenYOrigin - textElement.position.y * screenSize.height;\n                if (textElement.xOffset !== undefined) {\n                    tempScreenPosition.x += textElement.xOffset;\n                }\n                if (textElement.yOffset !== undefined) {\n                    tempScreenPosition.y -= textElement.yOffset;\n                }\n                tempPosition.x = tempScreenPosition.x;\n                tempPosition.y = tempScreenPosition.y;\n                tempPosition.z = 0.0;\n                tempBufferAdditionParams.position = tempPosition;\n                tempAdditionParams.layer = textElement.renderOrder;\n                tempAdditionParams.letterCaseArray = textElement.glyphCaseArray;\n                textCanvas.addText(textElement.glyphs, tempPosition, tempAdditionParams);\n            }\n            else {\n                // Adjust the label positioning.\n                tempScreenPosition.x = screenXOrigin;\n                tempScreenPosition.y = screenYOrigin;\n                if (textElement.xOffset !== undefined) {\n                    tempScreenPosition.x += textElement.xOffset;\n                }\n                if (textElement.yOffset !== undefined) {\n                    tempScreenPosition.y -= textElement.yOffset;\n                }\n                // Get the screen points that define the label's segments and create a path with\n                // them.\n                // TODO: Optimize array allocations.\n                const screenPoints = [];\n                for (const pt of textElement.path) {\n                    const pX = tempScreenPosition.x + pt.x * screenSize.width;\n                    const pY = tempScreenPosition.y - pt.y * screenSize.height;\n                    screenPoints.push(new THREE.Vector2(pX, pY));\n                }\n                textPath = new SimplePath_1.SimplePath();\n                for (let i = 0; i < screenPoints.length - 1; ++i) {\n                    textPath.add(new THREE.LineCurve(screenPoints[i], screenPoints[i + 1]));\n                }\n                tempAdditionParams.path = textPath;\n                tempAdditionParams.pathOverflow = true;\n                tempAdditionParams.layer = textElement.renderOrder;\n                tempAdditionParams.letterCaseArray = textElement.glyphCaseArray;\n                textCanvas.addText(textElement.glyphs, tempPosition, tempAdditionParams);\n            }\n        }\n    }\n    getDistanceFadingFactor(label, cameraFar) {\n        let distanceFadeValue = 1.0;\n        const textDistance = label.currentViewDistance;\n        if (textDistance !== undefined && label.fadeFar !== undefined && label.fadeFar > 0.0) {\n            const fadeNear = label.fadeNear === undefined ? 0.0 : label.fadeNear;\n            const fadeFar = label.fadeFar;\n            if (fadeFar > fadeNear) {\n                distanceFadeValue =\n                    1.0 -\n                        harp_utils_1.MathUtils.clamp((textDistance / cameraFar - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n            }\n        }\n        return distanceFadeValue;\n    }\n    renderTextElements(textElements, time, frameNumber, zoomLevel, renderedTextElements, secondChanceTextElements) {\n        if (this.m_textRenderers.length === 0) {\n            return 0;\n        }\n        const currentlyRenderingPlacedElements = renderedTextElements === undefined;\n        const printInfo = textElements.length > 5000;\n        let numNotVisible = 0;\n        let numPathTooSmall = 0;\n        let numCannotAdd = 0;\n        let numRenderedPoiIcons = 0;\n        let numRenderedPoiTexts = 0;\n        let numPoiTextsInvisible = 0;\n        const maxNumRenderedLabels = this.m_maxNumVisibleLabels;\n        const numSecondChanceLabels = this.m_numSecondChanceLabels;\n        const labelStartScaleDistance = this.m_labelStartScaleDistance;\n        let numRenderedTextElements = 0;\n        const shieldGroups = [];\n        const textFarDistanceLimitRatio = 0.9;\n        const textMaxDistance = this.getMaxDistance(textFarDistanceLimitRatio);\n        const poiTextFarDistanceLimitRatio = 0.6;\n        const poiTextMaxDistance = this.getMaxDistance(poiTextFarDistanceLimitRatio);\n        const cameraIsMoving = this.m_mapView.cameraIsMoving;\n        const cameraFar = this.m_mapView.camera.far;\n        // Take the world position of the camera as the origin to compute the distance to the\n        // tex elements.\n        const worldCenter = this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position);\n        // Keep track if we need to call another update() on MapView.\n        let fadeAnimationRunning = false;\n        const tempAdditionParams = {};\n        const tempPoiMeasurementParams = {};\n        const tempMeasurementParams = {};\n        const tempBufferAdditionParams = {};\n        // Place text elements one by one.\n        for (const textElement of textElements) {\n            if (!currentlyRenderingPlacedElements &&\n                maxNumRenderedLabels >= 0 &&\n                numRenderedTextElements >= maxNumRenderedLabels) {\n                break;\n            }\n            // Get the TextElementStyle.\n            const textElementStyle = this.getTextElementStyle(textElement.style);\n            const textCanvas = textElementStyle.textCanvas;\n            const poiRenderer = textElementStyle.poiRenderer;\n            if (textCanvas === undefined || poiRenderer === undefined) {\n                continue;\n            }\n            const isPathLabel = textElement.path !== undefined && !textElement.isLineMarker;\n            let screenPoints;\n            // For paths, check if the label may fit.\n            if (isPathLabel) {\n                const screenPointsResult = this.checkForSmallLabels(textElement);\n                if (screenPointsResult === undefined) {\n                    numNotVisible++;\n                    if (textElement.dbgPathTooSmall === true) {\n                        numPathTooSmall++;\n                    }\n                    continue;\n                }\n                screenPoints = screenPointsResult;\n            }\n            // Trigger the glyph load if needed.\n            if (textElement.loadingState === undefined) {\n                textElement.loadingState = TextElement_1.LoadingState.Requested;\n                if (textElement.renderStyle === undefined) {\n                    textElement.renderStyle = new harp_text_canvas_1.TextRenderStyle(Object.assign({}, textElementStyle.renderParams, textElement.renderParams));\n                }\n                if (textElement.layoutStyle === undefined) {\n                    textElement.layoutStyle = new harp_text_canvas_1.TextLayoutStyle(Object.assign({}, textElementStyle.layoutParams, textElement.layoutParams));\n                }\n                if (textElement.text === \"\") {\n                    textElement.loadingState = TextElement_1.LoadingState.Loaded;\n                }\n                else {\n                    textCanvas.fontCatalog\n                        .loadCharset(textElement.text, textElement.renderStyle)\n                        .then(() => {\n                        textElement.loadingState = TextElement_1.LoadingState.Loaded;\n                        this.m_mapView.update();\n                    });\n                }\n            }\n            if (textElement.loadingState === TextElement_1.LoadingState.Loaded) {\n                if (this.m_initializedTextElementCount < MAX_INITIALIZED_TEXT_ELEMENTS_PER_FRAME) {\n                    textCanvas.textRenderStyle = textElement.renderStyle;\n                    textCanvas.textLayoutStyle = textElement.layoutStyle;\n                    textElement.glyphCaseArray = [];\n                    textElement.glyphs = textCanvas.fontCatalog.getGlyphs(textElement.text, textCanvas.textRenderStyle, textElement.glyphCaseArray);\n                    if (!isPathLabel) {\n                        textElement.bounds = new THREE.Box2();\n                        tempPoiMeasurementParams.letterCaseArray = textElement.glyphCaseArray;\n                        textCanvas.measureText(textElement.glyphs, textElement.bounds, tempPoiMeasurementParams);\n                    }\n                    textElement.loadingState = TextElement_1.LoadingState.Initialized;\n                    ++this.m_initializedTextElementCount;\n                }\n            }\n            if (textElement.loadingState !== TextElement_1.LoadingState.Initialized) {\n                if (secondChanceTextElements !== undefined &&\n                    secondChanceTextElements.length < numSecondChanceLabels) {\n                    secondChanceTextElements.push(textElement);\n                }\n                continue;\n            }\n            const layer = textCanvas.getLayer(textElement.renderOrder || harp_text_canvas_1.DEFAULT_TEXT_CANVAS_LAYER);\n            // Move onto the next TextElement if we cannot continue adding glyphs to this layer.\n            if (layer !== undefined) {\n                if (layer.storage.drawCount + textElement.glyphs.length > layer.storage.capacity) {\n                    ++numCannotAdd;\n                    continue;\n                }\n            }\n            // Set the current style for the canvas.\n            textCanvas.textRenderStyle = textElement.renderStyle;\n            textCanvas.textLayoutStyle = textElement.layoutStyle;\n            // Define the point, poi, lineMarker and path label placement functions.\n            const addPointLabel = (pointLabel, iconRenderState, textRenderState, position, screenPosition) => {\n                // Find the label's original position.\n                tempScreenPosition.x = tempPoiScreenPosition.x = screenPosition.x;\n                tempScreenPosition.y = tempPoiScreenPosition.y = screenPosition.y;\n                if (pointLabel.xOffset !== undefined) {\n                    tempScreenPosition.x += pointLabel.xOffset;\n                }\n                if (pointLabel.yOffset !== undefined) {\n                    tempScreenPosition.y += pointLabel.yOffset;\n                }\n                // Scale the text depending on the label's distance to the camera.\n                let textScale = 1.0;\n                let distanceScale = 1.0;\n                const textDistance = worldCenter.distanceTo(position);\n                if (textDistance !== undefined) {\n                    if (pointLabel.fadeFar !== undefined &&\n                        (pointLabel.fadeFar <= 0.0 || pointLabel.fadeFar * cameraFar < textDistance)) {\n                        // The label is farther away than fadeFar value, which means it is totally\n                        // transparent\n                        return false;\n                    }\n                    const startScaleDistance = cameraFar * labelStartScaleDistance;\n                    if (textDistance > startScaleDistance) {\n                        distanceScale =\n                            1.0 -\n                                ((textDistance - startScaleDistance) /\n                                    (cameraFar - startScaleDistance)) *\n                                    (1.0 - pointLabel.distanceScale);\n                        textScale *= distanceScale;\n                    }\n                    textElement.currentViewDistance = textDistance;\n                }\n                const distanceFadeFactor = this.getDistanceFadingFactor(pointLabel, cameraFar);\n                // Check if there is need to check for screen space for the label's icon.\n                const poiInfo = pointLabel.poiInfo;\n                let iconSpaceAvailable = true;\n                // Check if icon should be rendered at this zoomLevel\n                const renderIcon = poiInfo === undefined ||\n                    harp_utils_1.MathUtils.isClamped(zoomLevel, poiInfo.iconMinZoomLevel, poiInfo.iconMaxZoomLevel);\n                if (renderIcon && poiInfo !== undefined && poiRenderer.prepareRender(pointLabel)) {\n                    if (poiInfo.isValid === false) {\n                        return false;\n                    }\n                    const iconIsVisible = poiRenderer.computeScreenBox(poiInfo, tempPoiScreenPosition, distanceScale, this.m_screenCollisions, tempBox2D);\n                    if (iconIsVisible) {\n                        iconSpaceAvailable = poiRenderer.isSpaceAvailable(this.m_screenCollisions, tempBox2D);\n                        // Reserve screen space if necessary, return false if failed:\n                        if (\n                        // Check if free screen space is available:\n                        !iconSpaceAvailable) {\n                            if (!iconRenderState.isVisible()) {\n                                return false;\n                            }\n                            else if (!(poiInfo.mayOverlap === true) &&\n                                !iconRenderState.isFadingOut()) {\n                                this.startFadeOut(iconRenderState, frameNumber, time);\n                                if (textRenderState !== undefined && textRenderState.isVisible()) {\n                                    this.startFadeOut(textRenderState, frameNumber, time);\n                                }\n                            }\n                        }\n                        else {\n                            if (iconRenderState.lastFrameNumber < frameNumber - 1 ||\n                                iconRenderState.isFadingOut() ||\n                                iconRenderState.isFadedOut()) {\n                                this.startFadeIn(iconRenderState, frameNumber, time);\n                            }\n                        }\n                    }\n                    // If the icon is prepared and valid, but just not visible, try again next time.\n                    else {\n                        if (secondChanceTextElements !== undefined &&\n                            secondChanceTextElements.length < numSecondChanceLabels) {\n                            secondChanceTextElements.push(pointLabel);\n                        }\n                        // Forced making it un-current.\n                        iconRenderState.lastFrameNumber = -1;\n                        return false;\n                    }\n                    if (iconRenderState.isFading()) {\n                        this.updateFading(iconRenderState, time);\n                    }\n                }\n                // Check if label should be rendered at this zoomLevel\n                const renderText = poiInfo === undefined ||\n                    zoomLevel === undefined ||\n                    harp_utils_1.MathUtils.isClamped(zoomLevel, poiInfo.iconMinZoomLevel, poiInfo.iconMaxZoomLevel);\n                // Check if we should render the label's text.\n                const doRenderText = \n                // Render if between min/max zoom level\n                renderText &&\n                    // Do not render if the distance is too great and distance shouldn't be ignored.\n                    (pointLabel.ignoreDistance === true ||\n                        (pointLabel.currentViewDistance === undefined ||\n                            pointLabel.currentViewDistance < poiTextMaxDistance)) &&\n                    // Do not render text if POI cannot be rendered and is not optional.\n                    (poiInfo === undefined ||\n                        poiInfo.isValid === true ||\n                        poiInfo.iconIsOptional !== false);\n                // Render the label's text...\n                if (doRenderText && textElement.text !== \"\") {\n                    // Adjust the label positioning to match its bounding box.\n                    tempPosition.x = tempScreenPosition.x;\n                    tempPosition.y = tempScreenPosition.y;\n                    tempPosition.z = textElement.renderDistance;\n                    tempBox2D.x = tempScreenPosition.x + pointLabel.bounds.min.x * textScale;\n                    tempBox2D.y = tempScreenPosition.y + pointLabel.bounds.min.y * textScale;\n                    tempBox2D.w = (pointLabel.bounds.max.x - pointLabel.bounds.min.x) * textScale;\n                    tempBox2D.h = (pointLabel.bounds.max.y - pointLabel.bounds.min.y) * textScale;\n                    // TODO: Make the margin configurable\n                    tempBox2D.x -= 4 * textScale;\n                    tempBox2D.y -= 2 * textScale;\n                    tempBox2D.w += 8 * textScale;\n                    tempBox2D.h += 4 * textScale;\n                    // Check the text visibility.\n                    if (!this.m_screenCollisions.isVisible(tempBox2D)) {\n                        if (secondChanceTextElements !== undefined &&\n                            secondChanceTextElements.length < numSecondChanceLabels) {\n                            secondChanceTextElements.push(pointLabel);\n                        }\n                        numPoiTextsInvisible++;\n                        return false;\n                    }\n                    const textIsOptional = pointLabel.poiInfo !== undefined &&\n                        pointLabel.poiInfo.textIsOptional === true;\n                    const textIsFadingIn = textRenderState !== undefined && textRenderState.isFadingIn();\n                    const textIsFadingOut = textRenderState !== undefined && textRenderState.isFadingOut();\n                    const textSpaceAvailable = !this.m_screenCollisions.isAllocated(tempBox2D);\n                    const textVisible = pointLabel.textMayOverlap ||\n                        textSpaceAvailable ||\n                        textIsFadingIn ||\n                        textIsFadingOut;\n                    if (textVisible) {\n                        // Compute the TextBufferObject when we know we're gonna render this label.\n                        if (pointLabel.textBufferObject === undefined) {\n                            pointLabel.textBufferObject = textCanvas.createTextBufferObject(pointLabel.glyphs);\n                        }\n                        // Allocate collision info if needed.\n                        if (!textIsFadingOut && pointLabel.textReservesSpace) {\n                            this.m_screenCollisions.allocate(tempBox2D);\n                        }\n                        // Do not actually render (just allocate space) if camera is moving and\n                        // renderTextDuringMovements is not true.\n                        if ((textIsFadingIn ||\n                            textIsFadingOut ||\n                            !cameraIsMoving ||\n                            (poiInfo === undefined ||\n                                poiInfo.renderTextDuringMovements === true)) &&\n                            !iconRenderState.isFadedOut()) {\n                            let textFading = false;\n                            if (!iconRenderState.isFadingOut() &&\n                                textSpaceAvailable &&\n                                iconSpaceAvailable) {\n                                textFading = this.checkStartFadeIn(textRenderState, frameNumber, time, true);\n                            }\n                            else if (textRenderState !== undefined) {\n                                if (textRenderState.isFading()) {\n                                    this.updateFading(textRenderState, time);\n                                    textFading = true;\n                                }\n                            }\n                            fadeAnimationRunning =\n                                fadeAnimationRunning || textIsFadingOut || textFading;\n                            const opacity = textRenderState !== undefined\n                                ? textRenderState.opacity\n                                : iconRenderState.opacity;\n                            tempBufferAdditionParams.layer = pointLabel.renderOrder;\n                            tempBufferAdditionParams.position = tempPosition;\n                            tempBufferAdditionParams.scale = textScale;\n                            tempBufferAdditionParams.opacity = opacity * distanceFadeFactor;\n                            tempBufferAdditionParams.backgroundOpacity =\n                                tempBufferAdditionParams.opacity *\n                                    textElement.renderStyle.backgroundOpacity;\n                            textCanvas.addTextBufferObject(pointLabel.textBufferObject, tempBufferAdditionParams);\n                        }\n                        numRenderedPoiTexts++;\n                    }\n                    // If the text is not visible nor optional, we won't render the icon neither.\n                    else if (!renderIcon || !textIsOptional) {\n                        if (pointLabel.poiInfo === undefined || iconRenderState.isVisible()) {\n                            if (pointLabel.poiInfo !== undefined) {\n                                this.startFadeOut(iconRenderState, frameNumber, time);\n                            }\n                            if (textRenderState !== undefined && textRenderState.isVisible()) {\n                                const iconStartedFadeOut = this.checkStartFadeOut(textRenderState, frameNumber, time);\n                                fadeAnimationRunning = fadeAnimationRunning || iconStartedFadeOut;\n                            }\n                            this.startFadeOut(iconRenderState, frameNumber, time);\n                        }\n                        else {\n                            if (secondChanceTextElements !== undefined &&\n                                secondChanceTextElements.length < numSecondChanceLabels) {\n                                secondChanceTextElements.push(pointLabel);\n                            }\n                            numPoiTextsInvisible++;\n                            return false;\n                        }\n                    }\n                    // If the label is currently visible, fade it out.\n                    else if (textRenderState !== undefined && textRenderState.isVisible()) {\n                        const iconStartedFadeOut = this.checkStartFadeOut(textRenderState, frameNumber, time);\n                        fadeAnimationRunning = fadeAnimationRunning || iconStartedFadeOut;\n                    }\n                }\n                // ... and render the icon (if any).\n                if (renderIcon && poiInfo !== undefined && poiRenderer.poiIsRenderable(poiInfo)) {\n                    const iconStartedFadeIn = this.checkStartFadeIn(iconRenderState, frameNumber, time);\n                    fadeAnimationRunning = fadeAnimationRunning || iconStartedFadeIn;\n                    poiRenderer.renderPoi(poiInfo, tempPoiScreenPosition, this.m_screenCollisions, distanceScale, poiInfo.reserveSpace !== false, iconRenderState.opacity * distanceFadeFactor);\n                    iconRenderState.lastFrameNumber = frameNumber;\n                    numRenderedPoiIcons++;\n                }\n                // Add this label to the list of rendered elements.\n                if (renderedTextElements !== undefined) {\n                    renderedTextElements.push(pointLabel);\n                }\n                numRenderedTextElements++;\n                return true;\n            };\n            const addPoiLabel = (poiLabel) => {\n                // Calculate the world position of this label.\n                tempPosition.x = poiLabel.position.x + poiLabel.tileCenterX;\n                tempPosition.y = poiLabel.position.y + poiLabel.tileCenterY;\n                tempPosition.z = 0;\n                // Only process labels frustum-clipped labels\n                if (this.m_screenProjector.project(tempPosition, tempScreenPosition) !== undefined) {\n                    // Initialize the POI's icon and text render states (fading).\n                    if (poiLabel.iconRenderState === undefined) {\n                        poiLabel.iconRenderState = new TextElement_1.RenderState();\n                        poiLabel.textRenderState = new TextElement_1.RenderState();\n                        if (this.m_mapView.fadingDisabled) {\n                            // Force fadingTime to zero to keep it from fading in and out.\n                            poiLabel.iconRenderState.fadingTime = 0;\n                            poiLabel.textRenderState.fadingTime = 0;\n                        }\n                    }\n                    // Add this POI as a point label.\n                    addPointLabel(poiLabel, poiLabel.iconRenderState, poiLabel.textRenderState, tempPosition, tempScreenPosition);\n                }\n            };\n            const addLineMarkerLabel = (lineMarkerLabel) => {\n                // Early exit if the line marker doesn't have the necessary data.\n                const poiInfo = lineMarkerLabel.poiInfo;\n                if (lineMarkerLabel.path === undefined ||\n                    lineMarkerLabel.path.length === 0 ||\n                    !poiRenderer.prepareRender(lineMarkerLabel)) {\n                    return;\n                }\n                // Initialize the shield group for this lineMarker.\n                let shieldGroup;\n                if (poiInfo.shieldGroupIndex !== undefined) {\n                    shieldGroup = shieldGroups[poiInfo.shieldGroupIndex];\n                    if (shieldGroup === undefined) {\n                        shieldGroup = [];\n                        shieldGroups[poiInfo.shieldGroupIndex] = shieldGroup;\n                    }\n                }\n                // Create an individual render state for every individual point of the lineMarker.\n                if (lineMarkerLabel.iconRenderStates === undefined) {\n                    const renderStates = new Array();\n                    lineMarkerLabel.path.forEach(() => {\n                        const renderState = new TextElement_1.RenderState();\n                        renderState.state = TextElement_1.FadingState.FadingIn;\n                        renderState.fadingTime = this.m_mapView.fadingDisabled\n                            ? 0\n                            : renderState.fadingTime;\n                        renderStates.push(renderState);\n                    });\n                    lineMarkerLabel.iconRenderStates = renderStates;\n                }\n                const lineTechnique = poiInfo.technique;\n                const minDistanceSqr = lineTechnique.minDistance !== undefined\n                    ? lineTechnique.minDistance * lineTechnique.minDistance\n                    : 0;\n                // Process markers (with shield groups).\n                if (minDistanceSqr > 0 && shieldGroup !== undefined) {\n                    for (let i = 0; i < lineMarkerLabel.path.length; i++) {\n                        const point = lineMarkerLabel.path[i];\n                        // Calculate the world position of this label.\n                        tempPosition.x = point.x + lineMarkerLabel.tileCenterX;\n                        tempPosition.y = point.y + lineMarkerLabel.tileCenterY;\n                        tempPosition.z = 0;\n                        // Only process labels frustum-clipped labels\n                        if (this.m_screenProjector.project(tempPosition, tempScreenPosition) !==\n                            undefined) {\n                            // Find a suitable location for the lineMarker to be placed at.\n                            let tooClose = false;\n                            for (let j = 0; j < shieldGroup.length; j += 2) {\n                                const distanceSqr = harp_utils_1.Math2D.distSquared(shieldGroup[j], shieldGroup[j + 1], tempScreenPosition.x, tempScreenPosition.y);\n                                tooClose = distanceSqr < minDistanceSqr;\n                                if (tooClose) {\n                                    break;\n                                }\n                            }\n                            // Place it as a point label if it's not to close to other marker in the\n                            // same shield group.\n                            if (!tooClose) {\n                                if (addPointLabel(lineMarkerLabel, lineMarkerLabel.iconRenderStates[i], undefined, tempPosition, tempScreenPosition)) {\n                                    shieldGroup.push(tempScreenPosition.x, tempScreenPosition.y);\n                                }\n                            }\n                        }\n                    }\n                }\n                // Process markers (without shield groups).\n                else {\n                    for (let i = 0; i < lineMarkerLabel.path.length; i++) {\n                        const point = lineMarkerLabel.path[i];\n                        // Calculate the world position of this label.\n                        tempPosition.x = point.x + lineMarkerLabel.tileCenterX;\n                        tempPosition.y = point.y + lineMarkerLabel.tileCenterY;\n                        tempPosition.z = 0;\n                        // Only process labels frustum-clipped labels\n                        if (this.m_screenProjector.project(tempPosition, tempScreenPosition) !==\n                            undefined) {\n                            addPointLabel(lineMarkerLabel, lineMarkerLabel.iconRenderStates[i], undefined, tempPosition, tempScreenPosition);\n                        }\n                    }\n                }\n            };\n            const addPathLabel = (pathLabel) => {\n                // Limit the text rendering of path labels in the far distance.\n                if (!(pathLabel.ignoreDistance === true ||\n                    pathLabel.currentViewDistance === undefined ||\n                    pathLabel.currentViewDistance < textMaxDistance)) {\n                    return false;\n                }\n                // Scale the text depending on the label's distance to the camera.\n                let distanceScale = 1.0;\n                if (pathLabel.fadeFar !== undefined &&\n                    (pathLabel.fadeFar <= 0.0 ||\n                        pathLabel.fadeFar * cameraFar < pathLabel.renderDistance)) {\n                    // The label is farther away than fadeFar value, which means it is totally\n                    // transparent\n                    return false;\n                }\n                // Compute values common for all glyphs in the label.\n                let textScale = textCanvas.textRenderStyle.fontSize.size / 100.0;\n                let opacity = 1.0;\n                // Get the screen points that define the label's segments and create a path with\n                // them.\n                let textPath = new THREE.Path();\n                tempScreenPosition.copy(screenPoints[0]);\n                for (let i = 0; i < screenPoints.length - 1; ++i) {\n                    textPath.add(new SimplePath_1.SimpleLineCurve(screenPoints[i], screenPoints[i + 1]));\n                }\n                // Flip the path if the label is gonna be rendered downwards.\n                if (textPath.getPoint(0.5).x - textPath.getPoint(0.51).x > 0) {\n                    tempScreenPosition.copy(screenPoints[screenPoints.length - 1]);\n                    textPath = new THREE.Path();\n                    for (let i = screenPoints.length - 1; i > 0; --i) {\n                        textPath.add(new SimplePath_1.SimpleLineCurve(screenPoints[i], screenPoints[i - 1]));\n                    }\n                }\n                // Update the real rendering distance to have smooth fading and scaling\n                this.updateViewDistance(worldCenter, pathLabel);\n                const textRenderDistance = pathLabel.renderDistance;\n                const startScaleDistance = cameraFar * labelStartScaleDistance;\n                const renderDistance = -textRenderDistance;\n                if (renderDistance > startScaleDistance) {\n                    distanceScale =\n                        1.0 -\n                            ((renderDistance - startScaleDistance) / (cameraFar - startScaleDistance)) *\n                                (1.0 - pathLabel.distanceScale);\n                    textScale *= distanceScale;\n                }\n                // Scale the path label correctly.\n                const prevSize = textCanvas.textRenderStyle.fontSize.size;\n                textCanvas.textRenderStyle.fontSize.size = textScale * 100;\n                // Recalculate the text bounds for this path label. If measurement fails, the whole\n                // label doesn't fit the path and should be discarded.\n                tempMeasurementParams.path = textPath;\n                tempMeasurementParams.outputCharacterBounds = tempBoxes;\n                tempMeasurementParams.letterCaseArray = pathLabel.glyphCaseArray;\n                if (!textCanvas.measureText(pathLabel.glyphs, tempBox, tempMeasurementParams)) {\n                    textCanvas.textRenderStyle.fontSize.size = prevSize;\n                    return false;\n                }\n                // Perform per-character collision checks.\n                for (const charBounds of tempBoxes) {\n                    tempBox2D.x = tempScreenPosition.x + charBounds.min.x;\n                    tempBox2D.y = tempScreenPosition.y + charBounds.min.y;\n                    tempBox2D.w = charBounds.max.x - charBounds.min.x;\n                    tempBox2D.h = charBounds.max.y - charBounds.min.y;\n                    if (!this.m_screenCollisions.isVisible(tempBox2D) ||\n                        (!textElement.textMayOverlap &&\n                            this.m_screenCollisions.isAllocated(tempBox2D))) {\n                        textCanvas.textRenderStyle.fontSize.size = prevSize;\n                        return false;\n                    }\n                }\n                // Fade-in after skipping rendering during movement.\n                // NOTE: Shouldn't this only happen once we know the label is gonna be visible?\n                if (pathLabel.textRenderState === undefined) {\n                    pathLabel.textRenderState = new TextElement_1.RenderState();\n                    pathLabel.textRenderState.fadingTime = this.m_mapView.fadingDisabled\n                        ? 0\n                        : pathLabel.textRenderState.fadingTime;\n                }\n                if (pathLabel.textRenderState.state === TextElement_1.FadingState.Undefined ||\n                    pathLabel.textRenderState.lastFrameNumber < frameNumber - 1) {\n                    this.startFadeIn(pathLabel.textRenderState, frameNumber, time);\n                }\n                const startedFadeIn = this.checkStartFadeIn(pathLabel.textRenderState, frameNumber, time);\n                fadeAnimationRunning = fadeAnimationRunning || startedFadeIn;\n                if (pathLabel.textRenderState.isFading()) {\n                    opacity = pathLabel.textRenderState.opacity;\n                }\n                const prevOpacity = textCanvas.textRenderStyle.opacity;\n                const prevBgOpacity = textCanvas.textRenderStyle.backgroundOpacity;\n                const distanceFadeFactor = this.getDistanceFadingFactor(pathLabel, cameraFar);\n                textCanvas.textRenderStyle.opacity = opacity * distanceFadeFactor;\n                textCanvas.textRenderStyle.backgroundOpacity =\n                    textCanvas.textRenderStyle.opacity * textElement.renderStyle.backgroundOpacity;\n                tempPosition.z = textElement.renderDistance;\n                tempAdditionParams.path = textPath;\n                tempAdditionParams.layer = pathLabel.renderOrder;\n                tempAdditionParams.letterCaseArray = pathLabel.glyphCaseArray;\n                textCanvas.addText(pathLabel.glyphs, tempPosition, tempAdditionParams);\n                // Allocate collision info if needed.\n                if (pathLabel.textReservesSpace) {\n                    tempBox2D.x = tempScreenPosition.x + tempBox.min.x;\n                    tempBox2D.y = tempScreenPosition.y + tempBox.min.y;\n                    tempBox2D.w = tempBox.max.x - tempBox.min.x;\n                    tempBox2D.h = tempBox.max.y - tempBox.min.y;\n                    this.m_screenCollisions.allocate(tempBox2D);\n                }\n                // Add this label to the list of rendered elements.\n                if (renderedTextElements !== undefined) {\n                    renderedTextElements.push(pathLabel);\n                }\n                numRenderedTextElements++;\n                // Restore previous style values for text elements using the same style.\n                textCanvas.textRenderStyle.fontSize.size = prevSize;\n                textCanvas.textRenderStyle.opacity = prevOpacity;\n                textCanvas.textRenderStyle.backgroundOpacity = prevBgOpacity;\n                return true;\n            };\n            // Render a POI...\n            if (textElement.path === undefined) {\n                addPoiLabel(textElement);\n            }\n            // ... a line marker...\n            else if (textElement.isLineMarker) {\n                addLineMarkerLabel(textElement);\n            }\n            // ... or a path label.\n            else {\n                addPathLabel(textElement);\n            }\n        }\n        if (PRINT_LABEL_DEBUG_INFO && printInfo) {\n            logger.log(\"textElements.length\", textElements.length);\n            logger.log(\"numRenderedTextElements\", numRenderedTextElements);\n            logger.log(\"numRenderedPoiIcons\", numRenderedPoiIcons);\n            logger.log(\"numRenderedPoiTexts\", numRenderedPoiTexts);\n            logger.log(\"numPoiTextsInvisible\", numPoiTextsInvisible);\n            logger.log(\"numNotVisible\", numNotVisible);\n            logger.log(\"numPathTooSmall\", numPathTooSmall);\n            logger.log(\"numCannotAdd\", numCannotAdd);\n        }\n        if (!this.m_mapView.fadingDisabled && fadeAnimationRunning) {\n            this.m_mapView.update();\n        }\n        return numRenderedTextElements;\n    }\n    checkForSmallLabels(textElement) {\n        let indexOfFirstVisibleScreenPoint = -1;\n        // Get the screen points that define the label's segments and create a path with\n        // them.\n        const screenPoints = [];\n        let minX = Number.MAX_SAFE_INTEGER;\n        let maxX = Number.MIN_SAFE_INTEGER;\n        let minY = Number.MAX_SAFE_INTEGER;\n        let maxY = Number.MIN_SAFE_INTEGER;\n        const tileCenterX = textElement.tileCenterX;\n        const tileCenterY = textElement.tileCenterY;\n        for (const pt of textElement.path) {\n            tempPosition.set(pt.x + tileCenterX, pt.y + tileCenterY, 0);\n            const screenPoint = this.m_screenProjector.projectInPlace(tempPosition, tempScreenPosition);\n            if (screenPoint === undefined) {\n                continue;\n            }\n            screenPoints.push(tempScreenPosition.clone());\n            if (screenPoint.x < minX) {\n                minX = screenPoint.x;\n            }\n            if (screenPoint.x > maxX) {\n                maxX = screenPoint.x;\n            }\n            if (screenPoint.y < minY) {\n                minY = screenPoint.y;\n            }\n            if (screenPoint.y > maxY) {\n                maxY = screenPoint.y;\n            }\n            if (indexOfFirstVisibleScreenPoint < 0) {\n                const firstIndex = screenPoints.findIndex(p2 => {\n                    return this.m_screenCollisions.screenBounds.contains(p2.x, p2.y);\n                });\n                if (firstIndex >= 0) {\n                    indexOfFirstVisibleScreenPoint = firstIndex;\n                }\n            }\n        }\n        // TODO: (HARP-3515)\n        //      The rendering of a path label that contains just a single point that is not\n        //      visible is impossible, which is problematic with long paths.\n        //      Fix: Skip/clip the invisible points at beginning and end of the path to get\n        //      the visible part of the path.\n        // If not a single point is visible, skip the path\n        if (indexOfFirstVisibleScreenPoint === -1) {\n            return undefined;\n        }\n        // Check/guess if the screen box can hold a string of that length. It is important\n        // to guess that value without measuring the font first to save time.\n        const minScreenSpace = textElement.text.length * MIN_AVERAGE_CHAR_WIDTH;\n        if ((maxX - minX) * (maxX - minX) + (maxY - minY) * (maxY - minY) <\n            minScreenSpace * minScreenSpace) {\n            textElement.dbgPathTooSmall = true;\n            return undefined;\n        }\n        return screenPoints;\n    }\n    renderTileList(visibleTiles, time, frameNumber, zoomLevel, renderStartTime, renderedTextElements, secondChanceTextElements) {\n        if (this.m_textRenderers.length === 0 || visibleTiles.length === 0) {\n            return;\n        }\n        const consideredTextElements = new harp_utils_1.GroupedPriorityList();\n        for (const tile of visibleTiles) {\n            consideredTextElements.merge(tile.placedTextElements);\n        }\n        const maxNumRenderedTextElements = this.m_maxNumVisibleLabels;\n        let numRenderedTextElements = 0;\n        for (const elementGroup of consideredTextElements.sortedGroups) {\n            const textElementsInGroup = elementGroup.elements;\n            this.sortTextElements(textElementsInGroup, this.m_mapView.camera.far);\n            numRenderedTextElements += this.renderTextElements(textElementsInGroup, time, frameNumber, zoomLevel, renderedTextElements, secondChanceTextElements);\n            if (numRenderedTextElements > maxNumRenderedTextElements) {\n                break;\n            }\n            // renderStartTime is set if this.overloaded is true\n            if (renderStartTime !== undefined && OVERLOAD_RENDER_TIME_LIMIT > 0) {\n                const endTime = harp_utils_1.PerformanceTimer.now();\n                const elapsedTime = endTime - renderStartTime;\n                if (elapsedTime > OVERLOAD_RENDER_TIME_LIMIT) {\n                    return;\n                }\n            }\n        }\n    }\n    checkIfOverloaded() {\n        const renderList = this.m_mapView.visibleTileSet.dataSourceTileList;\n        // Count the number of TextElements in the scene to see if we have to switch to\n        // \"overloadMode\".\n        let numTextElementsInScene = 0;\n        renderList.forEach(renderListEntry => {\n            for (const tile of renderListEntry.renderedTiles) {\n                numTextElementsInScene += tile.textElementGroups.count();\n                numTextElementsInScene += tile.userTextElements.length;\n            }\n        });\n        this.m_overloaded = numTextElementsInScene > OVERLOAD_LABEL_LIMIT;\n        return this.m_overloaded;\n    }\n    checkStartFadeIn(renderState, frameNumber, time, forceFadeIn = false) {\n        let fadeAnimationStarted = false;\n        if (renderState !== undefined) {\n            // Fade-in after skipping rendering during movement\n            if (forceFadeIn ||\n                renderState.state === TextElement_1.FadingState.Undefined ||\n                renderState.lastFrameNumber < frameNumber - 1) {\n                this.startFadeIn(renderState, frameNumber, time);\n            }\n            if (renderState.isFading()) {\n                this.updateFading(renderState, time);\n                fadeAnimationStarted = true;\n            }\n            renderState.lastFrameNumber = frameNumber;\n        }\n        return fadeAnimationStarted;\n    }\n    checkStartFadeOut(renderState, frameNumber, time, forceFadeOut = true) {\n        let fadeAnimationStarted = false;\n        if (renderState !== undefined) {\n            // Fade-in after skipping rendering during movement\n            if (forceFadeOut ||\n                renderState.state === TextElement_1.FadingState.Undefined ||\n                renderState.lastFrameNumber < frameNumber - 1) {\n                this.startFadeOut(renderState, frameNumber, time);\n            }\n            if (renderState.isFading()) {\n                this.updateFading(renderState, time);\n                fadeAnimationStarted = true;\n            }\n            renderState.lastFrameNumber = frameNumber;\n        }\n        return fadeAnimationStarted;\n    }\n    startFadeIn(renderState, frameNumber, time) {\n        if (renderState.lastFrameNumber < frameNumber - 1) {\n            renderState.reset();\n        }\n        if (renderState.state === TextElement_1.FadingState.FadingIn ||\n            renderState.state === TextElement_1.FadingState.FadedIn) {\n            return;\n        }\n        if (renderState.state === TextElement_1.FadingState.FadingOut) {\n            // The fadeout is not complete: compute the virtual fadingStartTime in the past, to get\n            // a correct end time:\n            renderState.value = 1.0 - renderState.value;\n            renderState.startTime = time - renderState.value * renderState.fadingTime;\n        }\n        else {\n            renderState.startTime = time;\n            renderState.value = 0.0;\n            renderState.opacity = 0;\n        }\n        renderState.state = TextElement_1.FadingState.FadingIn;\n    }\n    startFadeOut(renderState, frameNumber, time) {\n        if (renderState.lastFrameNumber < frameNumber - 1) {\n            renderState.reset();\n        }\n        if (renderState.state === TextElement_1.FadingState.FadingOut ||\n            renderState.state === TextElement_1.FadingState.FadedOut) {\n            return;\n        }\n        if (renderState.state === TextElement_1.FadingState.FadingIn) {\n            // The fade-in is not complete: compute the virtual fadingStartTime in the past, to get\n            // a correct end time:\n            renderState.startTime = time - renderState.value * renderState.fadingTime;\n            renderState.value = 1.0 - renderState.value;\n        }\n        else {\n            renderState.startTime = time;\n            renderState.value = 0.0;\n            renderState.opacity = 1;\n        }\n        renderState.state = TextElement_1.FadingState.FadingOut;\n    }\n    updateFading(renderState, time) {\n        if (renderState.state !== TextElement_1.FadingState.FadingIn &&\n            renderState.state !== TextElement_1.FadingState.FadingOut) {\n            return;\n        }\n        if (renderState.startTime === 0) {\n            renderState.startTime = time;\n        }\n        const fadingTime = time - renderState.startTime;\n        const startValue = renderState.state === TextElement_1.FadingState.FadingIn ? 0 : 1;\n        const endValue = renderState.state === TextElement_1.FadingState.FadingIn ? 1 : 0;\n        if (fadingTime >= renderState.fadingTime) {\n            renderState.value = 1.0;\n            renderState.opacity = endValue;\n            renderState.state =\n                renderState.state === TextElement_1.FadingState.FadingIn\n                    ? TextElement_1.FadingState.FadedIn\n                    : TextElement_1.FadingState.FadedOut;\n        }\n        else {\n            renderState.value = fadingTime / renderState.fadingTime;\n            renderState.opacity = harp_utils_1.MathUtils.clamp(harp_utils_1.MathUtils.smootherStep(startValue, endValue, renderState.value), 0, 1);\n        }\n    }\n}\nexports.TextElementsRenderer = TextElementsRenderer;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst THREE = require(\"three\");\nconst MapViewPoints_1 = require(\"./MapViewPoints\");\nconst PickingRaycaster_1 = require(\"./PickingRaycaster\");\nconst RoadPicker_1 = require(\"./RoadPicker\");\n/**\n * Describes the general type of a picked object.\n */\nvar PickObjectType;\n(function (PickObjectType) {\n    /**\n     * Unspecified.\n     */\n    PickObjectType[PickObjectType[\"Unspecified\"] = 0] = \"Unspecified\";\n    /**\n     * A point object.\n     */\n    PickObjectType[PickObjectType[\"Point\"] = 1] = \"Point\";\n    /**\n     * A line object.\n     */\n    PickObjectType[PickObjectType[\"Line\"] = 2] = \"Line\";\n    /**\n     * An area object.\n     */\n    PickObjectType[PickObjectType[\"Area\"] = 3] = \"Area\";\n    /**\n     * The text part of a [[TextElement]]\n     */\n    PickObjectType[PickObjectType[\"Text\"] = 4] = \"Text\";\n    /**\n     * The Icon of a [[TextElement]].\n     */\n    PickObjectType[PickObjectType[\"Icon\"] = 5] = \"Icon\";\n    /**\n     * Any general 3D object, for example, a landmark.\n     */\n    PickObjectType[PickObjectType[\"Object3D\"] = 6] = \"Object3D\";\n})(PickObjectType = exports.PickObjectType || (exports.PickObjectType = {}));\n/**\n * Handles the picking of scene geometry and roads.\n */\nclass PickHandler {\n    constructor(mapView, enableRoadPicking = true) {\n        this.mapView = mapView;\n        this.enableRoadPicking = enableRoadPicking;\n        this.m_plane = new THREE.Plane(new THREE.Vector3(0, 0, 1));\n        this.m_rayCaster = new PickingRaycaster_1.PickingRaycaster(mapView);\n        if (enableRoadPicking) {\n            this.m_roadPicker = new RoadPicker_1.RoadPicker(mapView);\n        }\n    }\n    /**\n     * The `RoadPicker` class manages picking of roads, which may not be pickable in THREE.js,\n     * since their geometry is generated in the vertex shader. The `RoadPicker` requires that\n     * all [[Tile]]s are registered before they can be picked successfully.\n     */\n    registerTile(tile) {\n        return this.m_roadPicker !== undefined ? this.m_roadPicker.registerTile(tile) : undefined;\n    }\n    /**\n     * Does a raycast on all objects in the scene; useful for picking. This function is Limited to\n     * objects that THREE.js can raycast. However, any solid lines that have their geometry in the\n     * shader cannot be tested for intersection.\n     *\n     * @param x The X position in CSS/client coordinates, without the applied display ratio.\n     * @param y The Y position in CSS/client coordinates, without the applied display ratio.\n     * @returns the list of intersection results.\n     */\n    intersectMapObjects(x, y) {\n        const worldPos = this.mapView.getNormalizedScreenCoordinates(x, y);\n        const rayCaster = this.m_rayCaster;\n        const pickResults = [];\n        if (this.mapView.textElementsRenderer !== undefined) {\n            const { clientWidth, clientHeight } = this.mapView.canvas;\n            const screenX = worldPos.x * clientWidth * 0.5 * this.mapView.pixelRatio;\n            const screenY = worldPos.y * clientHeight * 0.5 * this.mapView.pixelRatio;\n            const scenePosition = new THREE.Vector2(screenX, screenY);\n            this.mapView.textElementsRenderer.pickTextElements(scenePosition, pickResults);\n        }\n        rayCaster.setFromCamera(worldPos, this.mapView.camera);\n        // calculate objects intersecting the picking ray\n        const intersects = rayCaster.intersectObjects(this.mapView.worldRootObject.children, true);\n        for (const intersect of intersects) {\n            const pickResult = {\n                type: PickObjectType.Unspecified,\n                point: intersect.point,\n                distance: intersect.distance,\n                intersection: intersect\n            };\n            if (intersect.object.userData !== undefined) {\n                const featureData = intersect.object.userData !== undefined\n                    ? intersect.object.userData.feature\n                    : undefined;\n                if (featureData === undefined) {\n                    pickResults.push(pickResult);\n                    continue;\n                }\n                this.addObjInfo(featureData, intersect, pickResult);\n                if (featureData.ids !== undefined) {\n                    const featureId = featureData.ids.length === 1 ? featureData.ids[0] : undefined;\n                    pickResult.featureId = featureId;\n                }\n                let pickObjectType;\n                switch (featureData.geometryType) {\n                    case harp_datasource_protocol_1.GeometryType.Point:\n                    case harp_datasource_protocol_1.GeometryType.Text:\n                        pickObjectType = PickObjectType.Point;\n                        break;\n                    case harp_datasource_protocol_1.GeometryType.Line:\n                    case harp_datasource_protocol_1.GeometryType.ExtrudedLine:\n                    case harp_datasource_protocol_1.GeometryType.SolidLine:\n                    case harp_datasource_protocol_1.GeometryType.TextPath:\n                        pickObjectType = PickObjectType.Line;\n                        break;\n                    case harp_datasource_protocol_1.GeometryType.Polygon:\n                    case harp_datasource_protocol_1.GeometryType.ExtrudedPolygon:\n                        pickObjectType = PickObjectType.Area;\n                        break;\n                    case harp_datasource_protocol_1.GeometryType.Object3D:\n                        pickObjectType = PickObjectType.Object3D;\n                        break;\n                    default:\n                        pickObjectType = PickObjectType.Unspecified;\n                }\n                pickResult.type = pickObjectType;\n                pickResults.push(pickResult);\n            }\n        }\n        if (this.enableRoadPicking) {\n            const planeIntersectPosition = new THREE.Vector3();\n            rayCaster.ray.intersectPlane(this.m_plane, planeIntersectPosition);\n            planeIntersectPosition.add(this.mapView.worldCenter);\n            const cameraPos = this.mapView.worldCenter.clone().add(this.mapView.camera.position);\n            this.mapView.forEachVisibleTile(tile => {\n                this.m_roadPicker.intersectRoads(tile, cameraPos, planeIntersectPosition, pickResults);\n            });\n        }\n        pickResults.sort((a, b) => {\n            return a.distance - b.distance;\n        });\n        return pickResults;\n    }\n    addObjInfo(featureData, intersect, pickResult) {\n        if (pickResult.intersection.object instanceof MapViewPoints_1.MapViewPoints) {\n            pickResult.userData = featureData.objInfos[intersect.index];\n            return;\n        }\n        else if (featureData.objInfos === undefined ||\n            featureData.starts === undefined ||\n            intersect.faceIndex === undefined) {\n            return;\n        }\n        if (featureData.starts.length > 1) {\n            let objInfosIndex = 0;\n            for (const polygonStartFace of featureData.starts) {\n                if (polygonStartFace > intersect.faceIndex) {\n                    break;\n                }\n                objInfosIndex++;\n            }\n            pickResult.userData = featureData.objInfos[objInfosIndex - 1];\n        }\n        else {\n            pickResult.userData = featureData.objInfos[0];\n        }\n    }\n}\nexports.PickHandler = PickHandler;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/TileDataSource\"));\n__export(require(\"./lib/TileLoader\"));\n__export(require(\"./lib/ThemedTileDecoder\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst AnimatedExtrusionHandler_1 = require(\"../../harp-mapview/lib/AnimatedExtrusionHandler\");\nconst Utils_1 = require(\"./Utils\");\nconst THREE = require(\"three\");\nconst ExtrusionChunks_1 = require(\"./ShaderChunks/ExtrusionChunks\");\nconst FadingChunks_1 = require(\"./ShaderChunks/FadingChunks\");\n/**\n * Translates a linear distance value [0..1], where 1 is the distance to the far plane, into\n * [0..cameraFar].\n *\n * Copy from MapViewUtils, since it cannot be accessed here because of circular dependencies.\n *\n * @param distance Distance from the camera (range: [0, 1]).\n * @param camera Camera applying the perspective projection.\n */\nfunction cameraToWorldDistance(distance, camera) {\n    const perspCam = camera;\n    return distance * perspCam.far;\n}\n/**\n * Namespace with support functions for implementors of `FadingFeature`.\n */\nvar FadingFeature;\n(function (FadingFeature) {\n    FadingFeature.DEFAULT_FADE_NEAR = -1.0;\n    FadingFeature.DEFAULT_FADE_FAR = -1.0;\n    /**\n     * Patch the THREE.ShaderChunk on first call with some extra shader chunks.\n     */\n    function patchGlobalShaderChunks() {\n        if (THREE.ShaderChunk.fading_pars_vertex === undefined) {\n            Object.assign(THREE.ShaderChunk, FadingChunks_1.default);\n        }\n    }\n    FadingFeature.patchGlobalShaderChunks = patchGlobalShaderChunks;\n    /**\n     * Update the internals of the `FadingFeature` depending on the value of [[fadeNear]]. The\n     * fading feature will be disabled if fadeFar <= 0.0.\n     *\n     * @param fadingMaterial FadingFeature\n     */\n    function updateDistanceFadeFeature(fadingMaterial) {\n        fadingMaterial.needsUpdate = true;\n        if (fadingMaterial.defines === undefined) {\n            fadingMaterial.defines = {};\n        }\n        if (fadingMaterial.fadeFar !== undefined && fadingMaterial.fadeFar > 0.0) {\n            // Add this define to differentiate it internally from other MeshBasicMaterial\n            fadingMaterial.defines.FADING_MATERIAL = \"\";\n        }\n    }\n    FadingFeature.updateDistanceFadeFeature = updateDistanceFadeFeature;\n    /**\n     * This function should be called on implementors of FadingFeature in the `onBeforeCompile`\n     * callback of that material. It adds the required code to the shaders and declares the new\n     * uniforms that control fading based on view distance.\n     *\n     * @param fadingMaterial Material to add uniforms to.\n     * @param shader [[THREE.WebGLShader]] containing the vertex and fragment shaders to add the\n     *                  special includes to.\n     */\n    function onBeforeCompile(fadingMaterial, shader) {\n        if (fadingMaterial.fadeFar === undefined || fadingMaterial.fadeFar <= 0.0) {\n            return;\n        }\n        // The vertex and fragment shaders have been constructed dynamically. The uniforms and\n        // the shader includes are now appended to them.\n        //\n        // The object \"defines\" are not available for this material, so the fading shader chunks\n        // have the #ifdefs commented out.\n        // Create the uniforms for the shader (if not already existing), and add the new uniforms\n        // to it:\n        const uniforms = shader.uniforms;\n        uniforms.fadeNear = { value: fadingMaterial.fadeNear };\n        uniforms.fadeFar = { value: fadingMaterial.fadeFar };\n        // Append the new fading shader cod directly after the fog code. This is done by adding an\n        // include directive for the fading code.\n        shader.vertexShader = Utils_1.insertShaderInclude(shader.vertexShader, \"fog_pars_vertex\", \"fading_pars_vertex\");\n        shader.vertexShader = Utils_1.insertShaderInclude(shader.vertexShader, \"fog_vertex\", \"fading_vertex\", true);\n        shader.fragmentShader = Utils_1.insertShaderInclude(shader.fragmentShader, \"fog_pars_fragment\", \"fading_pars_fragment\");\n        shader.fragmentShader = Utils_1.insertShaderInclude(shader.fragmentShader, \"fog_fragment\", \"fading_fragment\", true);\n    }\n    FadingFeature.onBeforeCompile = onBeforeCompile;\n    /**\n     * As threejs is rendering the transparent objects last (internally), regardless of their\n     * renderOrder value, we set the transparent value to false in the [[onAfterRenderCall]]. In\n     * [[onBeforeRender]], the function [[calculateDepthFromCameraDistance]] sets it to true if the\n     * fade distance value is less than 1.\n     *\n     * @param object [[THREE.Object3D]] to prepare for rendering.\n     * @param fadeNear The fadeNear value to set in the material.\n     * @param fadeFar The fadeFar value to set in the material.\n     * @param forceMaterialToTransparent If `true`, the material will be forced to render with\n     *          blending set to `true`. May be `false` if the material is known to be transparent\n     *          anyway.\n     * @param updateUniforms If `true`, the fading uniforms are set. Not rquired if material is\n     *          handling the uniforms already, like in a [[THREE.ShaderMaterial]].\n     * @param additionalCallback If defined, this function will be called before the function will\n     *          return.\n     */\n    function addRenderHelper(object, fadeNear, fadeFar, forceMaterialToTransparent, updateUniforms, additionalCallback) {\n        // tslint:disable-next-line:no-unused-variable\n        object.onBeforeRender = harp_utils_1.chainCallbacks(object.onBeforeRender, (renderer, scene, camera, geometry, material, group) => {\n            if (forceMaterialToTransparent) {\n                //\n                material.transparent = true;\n            }\n            const fadingMaterial = material;\n            fadingMaterial.fadeNear =\n                fadeNear === undefined\n                    ? FadingFeature.DEFAULT_FADE_NEAR\n                    : cameraToWorldDistance(fadeNear, camera);\n            fadingMaterial.fadeFar =\n                fadeFar === undefined\n                    ? FadingFeature.DEFAULT_FADE_FAR\n                    : cameraToWorldDistance(fadeFar, camera);\n            if (updateUniforms) {\n                const properties = renderer.properties.get(material);\n                if (properties.shader !== undefined &&\n                    properties.shader.uniforms.fadeNear !== undefined) {\n                    properties.shader.uniforms.fadeNear.value = fadingMaterial.fadeNear;\n                    properties.shader.uniforms.fadeFar.value = fadingMaterial.fadeFar;\n                    fadingMaterial.uniformsNeedUpdate = true;\n                }\n            }\n            if (additionalCallback !== undefined) {\n                additionalCallback(renderer, material);\n            }\n        });\n        if (forceMaterialToTransparent) {\n            object.onAfterRender = (renderer, scene, camera, geom, material) => {\n                material.transparent = false;\n            };\n        }\n    }\n    FadingFeature.addRenderHelper = addRenderHelper;\n})(FadingFeature = exports.FadingFeature || (exports.FadingFeature = {}));\n/**\n * Mixin class for extended THREE materials. Adds new properties required for `fadeNear` and\n * `fadeFar`. Thre is some special handling for the fadeNear/fadeFar properties, which get some\n * setters and getters in a way that works well with the mixin.\n *\n * @see [[Tile#addRenderHelper]]\n */\nclass FadingFeatureMixin {\n    constructor() {\n        this.m_fadeNear = FadingFeature.DEFAULT_FADE_NEAR;\n        this.m_fadeFar = FadingFeature.DEFAULT_FADE_FAR;\n    }\n    /**\n     * @see [[FadingFeature#fadeNear]]\n     */\n    getFadeNear() {\n        return this.m_fadeNear;\n    }\n    /**\n     * @see [[FadingFeature#fadeNear]]\n     */\n    setFadeNear(value) {\n        this.needsUpdate = this.needsUpdate || value !== this.m_fadeNear;\n        this.m_fadeNear = value;\n        if (this.needsUpdate) {\n            FadingFeature.updateDistanceFadeFeature(this);\n        }\n    }\n    /**\n     * @see [[FadingFeature#fadeFar]]\n     */\n    getFadeFar() {\n        return this.m_fadeFar;\n    }\n    /**\n     * @see [[FadingFeature#fadeFar]]\n     */\n    setFadeFar(value) {\n        this.needsUpdate = this.needsUpdate || value !== this.m_fadeFar;\n        this.m_fadeFar = value;\n        if (this.needsUpdate) {\n            FadingFeature.updateDistanceFadeFeature(this);\n        }\n    }\n    /**\n     * The mixin classes should call this method to register the properties [[fadeNear]] and\n     * [[fadeFar]].\n     */\n    addFadingProperties() {\n        Object.defineProperty(this, \"fadeNear\", {\n            get: () => {\n                return this.getFadeNear();\n            },\n            set: val => {\n                this.setFadeNear(val);\n            }\n        });\n        Object.defineProperty(this, \"fadeFar\", {\n            get: () => {\n                return this.getFadeFar();\n            },\n            set: val => {\n                this.setFadeFar(val);\n            }\n        });\n    }\n    /**\n     * Apply the fadeNear/fadeFar values from the parameters to the respective properties.\n     *\n     * @param params `FadingMeshBasicMaterial` parameters.\n     */\n    applyFadingParameters(params) {\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.fadeNear !== undefined) {\n                this.setFadeNear(params.fadeNear);\n            }\n            if (params.fadeFar !== undefined) {\n                this.setFadeFar(params.fadeFar);\n            }\n        }\n        this.onBeforeCompile = (shader) => {\n            FadingFeature.onBeforeCompile(this, shader);\n        };\n    }\n    /**\n     * Copy fadeNear/fadeFar values from other FadingFeature.\n     *\n     * @param source The material to copy property values from.\n     */\n    copyFadingParameters(source) {\n        this.setFadeNear(source.fadeNear === undefined ? FadingFeature.DEFAULT_FADE_NEAR : source.fadeNear);\n        this.setFadeFar(source.fadeFar === undefined ? FadingFeature.DEFAULT_FADE_FAR : source.fadeFar);\n        return this;\n    }\n}\nexports.FadingFeatureMixin = FadingFeatureMixin;\nvar ExtrusionFeature;\n(function (ExtrusionFeature) {\n    /**\n     * Patch the THREE.ShaderChunk on first call with some extra shader chunks.\n     */\n    function patchGlobalShaderChunks() {\n        if (THREE.ShaderChunk.extrusion_pars_vertex === undefined) {\n            Object.assign(THREE.ShaderChunk, ExtrusionChunks_1.default);\n        }\n    }\n    ExtrusionFeature.patchGlobalShaderChunks = patchGlobalShaderChunks;\n    /**\n     * Update the internals of the `ExtrusionFeature` depending on the value of [[extrusionRatio]].\n     *\n     * @param ExtrusionMaterial ExtrusionFeature\n     */\n    function updateExtrusionFeature(extrusionMaterial) {\n        extrusionMaterial.needsUpdate = true;\n        if (extrusionMaterial.defines === undefined) {\n            extrusionMaterial.defines = {};\n        }\n        if (extrusionMaterial.extrusionRatio !== undefined &&\n            extrusionMaterial.extrusionRatio >= AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX) {\n            // Add this define to differentiate it internally from other MeshBasicMaterial\n            extrusionMaterial.defines.EXTRUSION_MATERIAL = \"\";\n        }\n    }\n    ExtrusionFeature.updateExtrusionFeature = updateExtrusionFeature;\n    /**\n     * This function should be called on implementors of ExtrusionFeature in the `onBeforeCompile`\n     * callback of that material. It adds the required code to the shaders and declares the new\n     * uniforms that control extrusion.\n     *\n     * @param extrusionMaterial Material to add uniforms to.\n     * @param shader [[THREE.WebGLShader]] containing the vertex and fragment shaders to add the\n     *                  special includes to.\n     */\n    function onBeforeCompile(extrusionMaterial, shader) {\n        if (extrusionMaterial.extrusionRatio === undefined) {\n            return;\n        }\n        // The vertex and fragment shaders have been constructed dynamically. The uniforms and\n        // the shader includes are now appended to them.\n        // Create the uniforms for the shader (if not already existing), and add the new uniforms\n        // to it:\n        const uniforms = shader.uniforms;\n        uniforms.extrusionRatio = { value: extrusionMaterial.extrusionRatio };\n        shader.vertexShader = Utils_1.insertShaderInclude(shader.vertexShader, \"common\", \"extrusion_pars_vertex\");\n        shader.vertexShader = Utils_1.insertShaderInclude(shader.vertexShader, \"begin_vertex\", \"extrusion_vertex\", true);\n        shader.fragmentShader = Utils_1.insertShaderInclude(shader.fragmentShader, \"fog_pars_fragment\", \"extrusion_pars_fragment\");\n        shader.fragmentShader = Utils_1.insertShaderInclude(shader.fragmentShader, \"fog_fragment\", \"extrusion_fragment\", true);\n    }\n    ExtrusionFeature.onBeforeCompile = onBeforeCompile;\n    /**\n     * Handles animated extrusion on each frame. Should be installed as respective\n     * Object3D.onBeforeRender of meshes which use animated extusion feature.\n     */\n    function addRenderHelper(object) {\n        object.onBeforeRender = harp_utils_1.chainCallbacks(object.onBeforeRender, ExtrusionFeature.onBeforeRender);\n    }\n    ExtrusionFeature.addRenderHelper = addRenderHelper;\n    function onBeforeRender(renderer, scene, camera, geometry, material, group) {\n        const extrusionMaterial = material;\n        const properties = renderer.properties.get(material);\n        if (properties.shader !== undefined &&\n            properties.shader.uniforms.extrusionRatio !== undefined) {\n            properties.shader.uniforms.extrusionRatio.value =\n                extrusionMaterial.extrusionRatio || AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX;\n            extrusionMaterial.uniformsNeedUpdate = true;\n        }\n    }\n    ExtrusionFeature.onBeforeRender = onBeforeRender;\n})(ExtrusionFeature = exports.ExtrusionFeature || (exports.ExtrusionFeature = {}));\n/**\n * Mixin class for extended THREE materials. Adds new properties required for `extrusionRatio`.\n * Thre is some special handling for the extrusionRatio property, which get some setters and\n * getters in a way that works well with the mixin.\n *\n * @see [[Tile#addRenderHelper]]\n */\nclass ExtrusionFeatureMixin {\n    constructor() {\n        this.m_extrusion = AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX;\n    }\n    /**\n     * @see [[ExtrusionFeature#extrusion]]\n     */\n    getExtrusionRatio() {\n        return this.m_extrusion;\n    }\n    /**\n     * @see [[ExtrusionFeature#extrusion]]\n     */\n    setExtrusionRatio(value) {\n        this.needsUpdate = this.needsUpdate || value !== this.m_extrusion;\n        this.m_extrusion = value;\n        if (this.needsUpdate) {\n            ExtrusionFeature.updateExtrusionFeature(this);\n        }\n    }\n    /**\n     * The mixin class should call this method to register the property [[extrusionRatio]]\n     */\n    addExtrusionProperties() {\n        Object.defineProperty(this, \"extrusionRatio\", {\n            get: () => {\n                return this.getExtrusionRatio();\n            },\n            set: val => {\n                this.setExtrusionRatio(val);\n            }\n        });\n    }\n    /**\n     * Apply the extrusionRatio value from the parameters to the respective properties.\n     */\n    applyExtrusionParameters(params) {\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.extrusionRatio !== undefined) {\n                this.setExtrusionRatio(params.extrusionRatio);\n            }\n        }\n        this.onBeforeCompile = (shader) => {\n            ExtrusionFeature.onBeforeCompile(this, shader);\n        };\n    }\n    /**\n     * Copy extrusionRatio values from other ExtrusionFeature.\n     *\n     * @param source The material to copy property values from.\n     */\n    copyExtrusionParameters(source) {\n        this.setExtrusionRatio(source.extrusionRatio === undefined\n            ? AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX\n            : source.extrusionRatio);\n        return this;\n    }\n}\nexports.ExtrusionFeatureMixin = ExtrusionFeatureMixin;\n/**\n * Subclass of [[THREE.MeshBasicMaterial]]. Adds new properties required for [[fadeNear]] and\n * [[fadeFar]]. In addition to the new properties (which update their respective uniforms), it is\n * also required to update the material in their objects [[onBeforeRender]] and [[OnAfterRender]]\n * calls, where their flag [[transparent]] is set and the internal fadeNear/fadeFar values are\n * updated to world space distances.\n *\n * @see [[Tile#addRenderHelper]]\n */\nclass MapMeshBasicMaterial extends THREE.MeshBasicMaterial {\n    /**\n     * Constructs a new `FadingMeshBasicMaterial`.\n     *\n     * @param params `FadingMeshBasicMaterial` parameters.\n     */\n    constructor(params) {\n        super(params);\n        FadingFeature.patchGlobalShaderChunks();\n        this.addFadingProperties();\n        this.applyFadingParameters(params);\n        ExtrusionFeature.patchGlobalShaderChunks();\n        this.addExtrusionProperties();\n        this.applyExtrusionParameters(params);\n    }\n    clone() {\n        return new MapMeshBasicMaterial().copy(this);\n    }\n    copy(source) {\n        super.copy(source);\n        this.copyFadingParameters(source);\n        this.copyExtrusionParameters(source);\n        return this;\n    }\n    // Only here to make the compiler happy, these methods will be overriden: The actual\n    // implementations are those in [[FadingFeatureMixin]] and [[ExtrusionFeatureMixin]], see below:\n    //\n    // applyMixinsWithoutProperties(FadingMeshBasicMaterial, [FadingFeatureMixin]);\n    // applyMixinsWithoutProperties(ExtrudionMeshBasicMaterial, [ExtrusionFeatureMixin]);\n    //\n    // Mixin declarations start ---------------------------------------------------------\n    get fadeNear() {\n        return FadingFeature.DEFAULT_FADE_NEAR;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set fadeNear(value) {\n        // to be overridden\n    }\n    get fadeFar() {\n        return FadingFeature.DEFAULT_FADE_FAR;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set fadeFar(value) {\n        // to be overridden\n    }\n    get extrusionRatio() {\n        return AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set extrusionRatio(value) {\n        // to be overridden\n    }\n    addFadingProperties() {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    applyFadingParameters(params) {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    copyFadingParameters(source) {\n        // to be overridden\n    }\n    addExtrusionProperties() {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    applyExtrusionParameters(params) {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    copyExtrusionParameters(source) {\n        // to be overridden\n    }\n}\nexports.MapMeshBasicMaterial = MapMeshBasicMaterial;\n/**\n * Subclass of THREE.MeshStandardMaterial. Adds new properties required for `fadeNear` and\n * `fadeFar`. In addition to the new properties (which fill respective uniforms), it is also\n * required to update the material in their objects `onBeforeRender` and `OnAfterRender` calls,\n * where their flag `transparent` is set and the internal fadeNear/fadeFar values are updated to\n * world space distances.\n *\n * @see [[Tile#addRenderHelper]]\n */\nclass MapMeshStandardMaterial extends THREE.MeshStandardMaterial {\n    /**\n     * Constructs a new `FadingMeshStandardMaterial`.\n     *\n     * @param params `FadingMeshStandardMaterial` parameters.\n     */\n    constructor(params) {\n        super(params);\n        FadingFeature.patchGlobalShaderChunks();\n        this.addFadingProperties();\n        this.applyFadingParameters(params);\n        ExtrusionFeature.patchGlobalShaderChunks();\n        this.addExtrusionProperties();\n        this.applyExtrusionParameters(params);\n    }\n    clone() {\n        return new MapMeshStandardMaterial().copy(this);\n    }\n    copy(source) {\n        super.copy(source);\n        this.copyFadingParameters(source);\n        this.copyExtrusionParameters(source);\n        return this;\n    }\n    // Only here to make the compiler happy, these methods will be overriden: The actual\n    // implementations are those in [[FadingFeatureMixin]] and [[ExtrusionFeatureMixin]], see below:\n    //\n    // applyMixinsWithoutProperties(FadingMeshBasicMaterial, [FadingFeatureMixin]);\n    // applyMixinsWithoutProperties(ExtrudionMeshBasicMaterial, [ExtrusionFeatureMixin]);\n    //\n    // Mixin declarations start ---------------------------------------------------------\n    get fadeNear() {\n        return FadingFeature.DEFAULT_FADE_NEAR;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set fadeNear(value) {\n        // to be overridden\n    }\n    get fadeFar() {\n        return FadingFeature.DEFAULT_FADE_FAR;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set fadeFar(value) {\n        // to be overridden\n    }\n    get extrusionRatio() {\n        return AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MAX;\n    }\n    // tslint:disable-next-line:no-unused-variable\n    set extrusionRatio(value) {\n        // to be overridden\n    }\n    addFadingProperties() {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    applyFadingParameters(params) {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    copyFadingParameters(source) {\n        // to be overridden\n    }\n    addExtrusionProperties() {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    applyExtrusionParameters(params) {\n        // to be overridden\n    }\n    // tslint:disable-next-line:no-unused-variable\n    copyExtrusionParameters(source) {\n        // to be overridden\n    }\n}\nexports.MapMeshStandardMaterial = MapMeshStandardMaterial;\n/**\n * Finish the classes MapMeshBasicMaterial and MapMeshStandardMaterial by assigning them the actual\n * implementations of the mixed in functions.\n */\nharp_utils_1.applyMixinsWithoutProperties(MapMeshBasicMaterial, [FadingFeatureMixin]);\nharp_utils_1.applyMixinsWithoutProperties(MapMeshStandardMaterial, [FadingFeatureMixin]);\nharp_utils_1.applyMixinsWithoutProperties(MapMeshBasicMaterial, [ExtrusionFeatureMixin]);\nharp_utils_1.applyMixinsWithoutProperties(MapMeshStandardMaterial, [ExtrusionFeatureMixin]);\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Enum log levels\n */\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\n    LogLevel[LogLevel[\"Log\"] = 2] = \"Log\";\n    LogLevel[LogLevel[\"Info\"] = 3] = \"Info\";\n    LogLevel[LogLevel[\"Warn\"] = 4] = \"Warn\";\n    LogLevel[LogLevel[\"Error\"] = 5] = \"Error\";\n})(LogLevel = exports.LogLevel || (exports.LogLevel = {}));\n/**\n * Logger options to configure logger\n */\nclass LoggerOptions {\n}\nexports.LoggerOptions = LoggerOptions;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = {\n    extrude_line_vert_func: `\nvoid extrudeLine(vec2 segment, vec4 bt, vec3 t, float lineWidth, inout vec3 pos, inout vec2 uv) {\n    float uu = uv.x / 2.0 + 0.5;\n    float ss = mix(segment.x, segment.y, uu);\n\n    float angle = bt.w;\n    vec3 dir = bt.xyz;\n    if (angle != 0.0) {\n        pos += uv.y * lineWidth * dir / cos(angle / 2.0);\n        uv.x = ss + uv.x * lineWidth * uv.y * tan(angle / 2.0);\n    }\n    else {\n        pos += uv.y * lineWidth * dir + uv.x * lineWidth * t;\n        uv.x = ss + uv.x * lineWidth;\n    }\n}\n`,\n    join_dist_func: `\nfloat joinDist(vec2 segment, vec2 texcoord) {\n    float d = abs(texcoord.y);\n    float dx = texcoord.x;\n    if (dx < segment.x) {\n        d = max(d, length(texcoord - vec2(segment.x, 0.0)));\n    } else if (dx > segment.y) {\n        d = max(d, length(texcoord - vec2(segment.y, 0.0)));\n    }\n    return d;\n}\n`,\n    tile_clip_func: `\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n`,\n    high_precision_vert_func: `\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n`\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst AnimatedExtrusionHandler_1 = require(\"./AnimatedExtrusionHandler\");\nconst CameraMovementDetector_1 = require(\"./CameraMovementDetector\");\nconst composing_1 = require(\"./composing\");\nconst ConcurrentDecoderFacade_1 = require(\"./ConcurrentDecoderFacade\");\nconst CopyrightInfo_1 = require(\"./CopyrightInfo\");\nconst MapViewImageCache_1 = require(\"./image/MapViewImageCache\");\nconst MapViewFog_1 = require(\"./MapViewFog\");\nconst PickHandler_1 = require(\"./PickHandler\");\nconst PoiManager_1 = require(\"./poi/PoiManager\");\nconst PoiTableManager_1 = require(\"./poi/PoiTableManager\");\nconst ScreenCollisions_1 = require(\"./ScreenCollisions\");\nconst ScreenProjector_1 = require(\"./ScreenProjector\");\nconst SkyBackground_1 = require(\"./SkyBackground\");\nconst Statistics_1 = require(\"./Statistics\");\nconst TextElementsRenderer_1 = require(\"./text/TextElementsRenderer\");\nconst TextStyleCache_1 = require(\"./text/TextStyleCache\");\nconst ThemeHelpers_1 = require(\"./ThemeHelpers\");\nconst ThemeLoader_1 = require(\"./ThemeLoader\");\nconst Utils_1 = require(\"./Utils\");\nconst VisibleTileSet_1 = require(\"./VisibleTileSet\");\n// cache value, because access to process.env.NODE_ENV is SLOW!\nconst isProduction = process.env.NODE_ENV === \"production\";\nvar MapViewEventNames;\n(function (MapViewEventNames) {\n    /** Called before this `MapView` starts to render a new frame. */\n    MapViewEventNames[\"Update\"] = \"update\";\n    /** Called when the frame is about to be rendered. */\n    MapViewEventNames[\"Render\"] = \"render\";\n    /** Called after a frame has been rendered. */\n    MapViewEventNames[\"AfterRender\"] = \"didrender\";\n    /** Called after the first frame has been rendered. */\n    MapViewEventNames[\"FirstFrame\"] = \"first-render\";\n    /** Called when the first view has all the necessary tiles loaded and rendered. */\n    MapViewEventNames[\"FrameComplete\"] = \"frame-complete\";\n    /** Called when the theme has been loaded with the internal [[ThemeLoader]]. */\n    MapViewEventNames[\"ThemeLoaded\"] = \"theme-loaded\";\n    /** Called when the animation mode has started. */\n    MapViewEventNames[\"AnimationStarted\"] = \"animation-started\";\n    /** Called when the animation mode has stopped. */\n    MapViewEventNames[\"AnimationFinished\"] = \"animation-finished\";\n    /** Called when a camera interaction has been detected. */\n    MapViewEventNames[\"MovementStarted\"] = \"movement-started\";\n    /** Called when a camera interaction has been stopped. */\n    MapViewEventNames[\"MovementFinished\"] = \"movement-finished\";\n    /** Called when a data source has been connected or failed to connect. */\n    MapViewEventNames[\"DataSourceConnect\"] = \"datasource-connect\";\n    /** Emitted when copyright info of rendered map has been changed. */\n    MapViewEventNames[\"CopyrightChanged\"] = \"copyright-changed\";\n    /** Called when the WebGL context is lost. */\n    MapViewEventNames[\"ContextLost\"] = \"webglcontext-lost\";\n    /** Called when the WebGL context is restored. */\n    MapViewEventNames[\"ContextRestored\"] = \"webglcontext-restored\";\n})(MapViewEventNames = exports.MapViewEventNames || (exports.MapViewEventNames = {}));\nconst logger = harp_utils_1.LoggerManager.instance.create(\"MapView\");\nconst DEFAULT_FONT_CATALOG = \"./resources/fonts/Default_FontCatalog.json\";\nconst DEFAULT_CLEAR_COLOR = 0xefe9e1;\nconst EYE_INVERSE = new THREE.Vector3(0, 0, -1);\nconst DEFAULT_FOV_CALCULATION = { type: \"dynamic\", fov: 40 };\nconst MAX_FIELD_OF_VIEW = 140;\nconst MIN_FIELD_OF_VIEW = 10;\nconst DEFAULT_MIN_ZOOM_LEVEL = 1;\n/**\n * Default maximum zoom level.\n */\nconst DEFAULT_MAX_ZOOM_LEVEL = 20;\n/**\n * Default minimum camera height.\n */\nconst DEFAULT_MIN_CAMERA_HEIGHT = 20;\n/**\n * Amount of framerate values to pick average from\n */\nconst FRAME_RATE_RING_SIZE = 12;\n/**\n * Default starting value for FPS computation.\n */\nconst FALLBACK_FRAME_RATE = 30;\n// Event type: cast needed to workaround wrong THREE.js typings.\nconst RENDER_EVENT = { type: MapViewEventNames.Render };\nconst DID_RENDER_EVENT = { type: MapViewEventNames.AfterRender };\nconst FIRST_FRAME_EVENT = { type: MapViewEventNames.FirstFrame };\nconst FRAME_COMPLETE_EVENT = { type: MapViewEventNames.FrameComplete };\nconst THEME_LOADED_EVENT = { type: MapViewEventNames.ThemeLoaded };\nconst ANIMATION_STARTED_EVENT = { type: MapViewEventNames.AnimationStarted };\nconst ANIMATION_FINISHED_EVENT = { type: MapViewEventNames.AnimationFinished };\nconst MOVEMENT_STARTED_EVENT = { type: MapViewEventNames.MovementStarted };\nconst MOVEMENT_FINISHED_EVENT = { type: MapViewEventNames.MovementFinished };\nconst CONTEXT_LOST_EVENT = { type: MapViewEventNames.ContextLost };\nconst CONTEXT_RESTORED_EVENT = { type: MapViewEventNames.ContextRestored };\nconst COPYRIGHT_CHANGED_EVENT = { type: MapViewEventNames.CopyrightChanged };\nconst tmpVector = new THREE.Vector2();\n/**\n * Default settings used by [[MapView]] collected in one place.\n */\nexports.MapViewDefaults = {\n    projection: harp_geoutils_1.mercatorProjection,\n    maxVisibleDataSourceTiles: 20,\n    extendedFrustumCulling: true,\n    tileCacheSize: 40,\n    resourceComputationType: VisibleTileSet_1.ResourceComputationType.EstimationInMb,\n    quadTreeSearchDistanceUp: 3,\n    quadTreeSearchDistanceDown: 2,\n    pixelRatio: typeof window !== \"undefined\" && window.devicePixelRatio !== undefined\n        ? window.devicePixelRatio\n        : 1.0\n};\n/**\n * The core class of the library to call in order to create a map visualization. It needs to be\n * linked to datasources.\n */\nclass MapView extends THREE.EventDispatcher {\n    /**\n     * Constructs a new `MapView` with the given options or canvas element.\n     *\n     * @param options The `MapView` options or the HTML canvas element used to display the map.\n     */\n    constructor(options) {\n        super();\n        /**\n         * The string of the default font catalog to use for labelling.\n         */\n        this.defaultFontCatalog = DEFAULT_FONT_CATALOG;\n        this.m_screenProjector = new ScreenProjector_1.ScreenProjector();\n        this.m_screenCollisions = new ScreenCollisions_1.ScreenCollisions();\n        this.m_visibleTileSetLock = false;\n        this.m_zoomLevel = DEFAULT_MIN_ZOOM_LEVEL;\n        this.m_minZoomLevel = DEFAULT_MIN_ZOOM_LEVEL;\n        this.m_maxZoomLevel = DEFAULT_MAX_ZOOM_LEVEL;\n        this.m_minCameraHeight = DEFAULT_MIN_CAMERA_HEIGHT;\n        this.m_screenCamera = new THREE.OrthographicCamera(-1, 1, 1, -1);\n        this.m_tempVector3 = new THREE.Vector3();\n        this.m_scene = new THREE.Scene();\n        this.m_fog = new MapViewFog_1.MapViewFog(this.m_scene);\n        this.m_worldCenter = new THREE.Vector3();\n        this.m_mapTilesRoot = new THREE.Object3D();\n        this.m_animationCount = 0;\n        this.m_drawing = false;\n        this.m_updatePending = false;\n        this.m_frameNumber = 0;\n        this.m_maxFps = 0;\n        this.m_detectedFps = FALLBACK_FRAME_RATE;\n        this.m_textRenderStyleCache = new TextStyleCache_1.TextRenderStyleCache();\n        this.m_textLayoutStyleCache = new TextStyleCache_1.TextLayoutStyleCache();\n        this.m_overlayTextElements = [];\n        this.m_forceCameraAspect = undefined;\n        //\n        // sources\n        //\n        this.m_tileDataSources = [];\n        this.m_connectedDataSources = new Set();\n        // gestures\n        this.m_raycaster = new THREE.Raycaster();\n        this.m_plane = new THREE.Plane(new THREE.Vector3(0, 0, 1));\n        this.m_theme = { styles: {} };\n        this.m_firstFrameRendered = false;\n        this.m_firstFrameComplete = false;\n        this.m_frameTimeIndex = 0;\n        this.m_frameTimeRing = [];\n        this.m_imageCache = new MapViewImageCache_1.MapViewImageCache(this);\n        this.m_poiManager = new PoiManager_1.PoiManager(this);\n        this.m_poiTableManager = new PoiTableManager_1.PoiTableManager(this);\n        this.m_lastTileIds = \"\";\n        this.m_copyrightInfo = [];\n        /**\n         * Default handler for webglcontextlost event\n         */\n        this.onWebGLContextLost = (event) => {\n            this.dispatchEvent(CONTEXT_LOST_EVENT);\n            logger.log(\"WebGL context lost\", event);\n        };\n        /**\n         * Default handler for webglcontextrestored event\n         */\n        this.onWebGLContextRestored = (event) => {\n            this.dispatchEvent(CONTEXT_RESTORED_EVENT);\n            if (this.m_theme !== undefined && this.m_theme.clearColor !== undefined) {\n                this.m_renderer.setClearColor(new THREE.Color(this.m_theme.clearColor));\n            }\n            else {\n                this.m_renderer.setClearColor(DEFAULT_CLEAR_COLOR);\n            }\n            this.update();\n            logger.log(\"WebGL context restored\", event);\n        };\n        // make a copy to avoid unwanted changes to the original options.\n        this.m_options = Object.assign({}, options);\n        if (this.m_options.minZoomLevel !== undefined) {\n            this.m_minZoomLevel = this.m_options.minZoomLevel;\n        }\n        if (this.m_options.maxZoomLevel !== undefined) {\n            this.m_maxZoomLevel = this.m_options.maxZoomLevel;\n        }\n        if (this.m_options.minCameraHeight !== undefined) {\n            this.m_minCameraHeight = this.m_options.minCameraHeight;\n        }\n        if (this.m_options.fontCatalog !== undefined) {\n            this.defaultFontCatalog = this.m_options.fontCatalog;\n        }\n        if (this.m_options.decoderUrl !== undefined) {\n            ConcurrentDecoderFacade_1.ConcurrentDecoderFacade.defaultScriptUrl = this.m_options.decoderUrl;\n        }\n        if (this.m_options.decoderCount !== undefined) {\n            ConcurrentDecoderFacade_1.ConcurrentDecoderFacade.defaultWorkerCount = this.m_options.decoderCount;\n        }\n        this.m_visibleTileSetOptions = Object.assign({}, exports.MapViewDefaults);\n        if (options.projection !== undefined) {\n            this.m_visibleTileSetOptions.projection = options.projection;\n        }\n        if (options.extendedFrustumCulling !== undefined) {\n            this.m_visibleTileSetOptions.extendedFrustumCulling = options.extendedFrustumCulling;\n        }\n        if (options.maxVisibleDataSourceTiles !== undefined) {\n            this.m_visibleTileSetOptions.maxVisibleDataSourceTiles =\n                options.maxVisibleDataSourceTiles;\n        }\n        if (options.tileCacheSize !== undefined) {\n            this.m_visibleTileSetOptions.tileCacheSize = options.tileCacheSize;\n        }\n        if (options.resourceComputationType !== undefined) {\n            this.m_visibleTileSetOptions.resourceComputationType = options.resourceComputationType;\n        }\n        if (options.quadTreeSearchDistanceUp !== undefined) {\n            this.m_visibleTileSetOptions.quadTreeSearchDistanceUp =\n                options.quadTreeSearchDistanceUp;\n        }\n        if (options.quadTreeSearchDistanceDown !== undefined) {\n            this.m_visibleTileSetOptions.quadTreeSearchDistanceDown =\n                options.quadTreeSearchDistanceDown;\n        }\n        this.m_pixelRatio = options.pixelRatio;\n        if (options.maxFps !== undefined) {\n            this.m_maxFps = Math.max(0, options.maxFps);\n        }\n        this.m_options.enableStatistics = this.m_options.enableStatistics === true;\n        this.m_languages = this.m_options.languages || Utils_1.MapViewUtils.getBrowserLanguages();\n        if (!isProduction &&\n            this.m_options.collisionDebugCanvas !== undefined &&\n            this.m_options.collisionDebugCanvas !== null) {\n            this.m_collisionDebugCanvas = this.m_options.collisionDebugCanvas;\n            this.m_screenCollisions = new ScreenCollisions_1.ScreenCollisionsDebug(this.m_collisionDebugCanvas);\n        }\n        this.handleRequestAnimationFrame = this.renderFunc.bind(this);\n        this.handlePostponedAnimationFrame = this.postponedAnimationFrame.bind(this);\n        this.m_pickHandler = new PickHandler_1.PickHandler(this, this.m_options.enableRoadPicking === true);\n        // Initialization of the stats\n        this.setupStats(this.m_options.enableStatistics);\n        // Initialization of the renderer\n        this.m_renderer = new THREE.WebGLRenderer({\n            canvas: this.canvas,\n            antialias: this.m_options.enableNativeWebglAntialias !== false,\n            alpha: this.m_options.alpha,\n            preserveDrawingBuffer: this.m_options.preserveDrawingBuffer === true\n        });\n        this.m_renderer.autoClear = false;\n        // This is detailed at https://threejs.org/docs/#api/renderers/WebGLRenderer.info\n        // When using several WebGLRenderer#render calls per frame, it is the only way to get\n        // correct rendering data from ThreeJS.\n        this.m_renderer.info.autoReset = false;\n        this.setupRenderer();\n        this.m_options.fovCalculation =\n            this.m_options.fovCalculation === undefined\n                ? DEFAULT_FOV_CALCULATION\n                : this.m_options.fovCalculation;\n        this.m_options.fovCalculation.fov = harp_geoutils_1.MathUtils.clamp(this.m_options.fovCalculation.fov, MIN_FIELD_OF_VIEW, MAX_FIELD_OF_VIEW);\n        // Initialization of mCamera and mVisibleTiles\n        const { width, height } = this.getCanvasClientSize();\n        const aspect = width / height;\n        this.m_camera = new THREE.PerspectiveCamera(this.m_options.fovCalculation.fov, aspect, 0.1, 4000000);\n        this.m_lookAtDistance = 0;\n        this.m_focalLength = 0;\n        this.setupCamera();\n        this.m_movementDetector = new CameraMovementDetector_1.CameraMovementDetector(this.m_options.movementThrottleTimeout, () => this.movementStarted(), () => this.movementFinished());\n        const mapPassAntialiasSettings = this.m_options.customAntialiasSettings;\n        this.mapRenderingManager = new composing_1.MapRenderingManager(width, height, this.m_options.dynamicPixelRatio, mapPassAntialiasSettings);\n        this.m_visibleTiles = new VisibleTileSet_1.VisibleTileSet(this.m_camera, this.m_visibleTileSetOptions);\n        this.m_animatedExtrusionHandler = new AnimatedExtrusionHandler_1.AnimatedExtrusionHandler(this);\n        this.initTheme();\n        this.drawFrame();\n        this.canvas.addEventListener(\"webglcontextlost\", this.onWebGLContextLost);\n        this.canvas.addEventListener(\"webglcontextrestored\", this.onWebGLContextRestored);\n    }\n    /**\n     * @hidden\n     * The [[TextElementsRenderer]] select the visible [[TextElement]]s and renders them.\n     */\n    get textElementsRenderer() {\n        return this.m_textElementsRenderer;\n    }\n    /**\n     * @hidden\n     * The [[TextRenderStyleCache]] used for this instance of `MapView`.\n     */\n    get textRenderStyleCache() {\n        return this.m_textRenderStyleCache;\n    }\n    /**\n     * @hidden\n     * The [[TextLayoutStyleCache]] used for this instance of `MapView`.\n     */\n    get textLayoutStyleCache() {\n        return this.m_textLayoutStyleCache;\n    }\n    /**\n     * @hidden\n     * The [[CameraMovementDetector]] detects camera movements. Made available for performance\n     * measurements.\n     */\n    get cameraMovementDetector() {\n        return this.m_movementDetector;\n    }\n    /**\n     * The [[AnimatedExtrusionHandler]] controlls animated extrussion effect\n     * of the extruded objects in the [[Tile]]\n     */\n    get animatedExtrusionHandler() {\n        return this.m_animatedExtrusionHandler;\n    }\n    /**\n     * Disposes this `MapView`.\n     *\n     * This function cleans the resources that are managed manually including those that exist in\n     * shared caches.\n     *\n     * Note: This function does not try to clean objects that can be disposed off easily by\n     * TypeScript's garbage collecting mechanism. Consequently, if you need to perform a full\n     * cleanup, you must ensure that all references to this `MapView` are removed.\n     */\n    dispose() {\n        if (this.m_animationFrameHandle !== undefined) {\n            cancelAnimationFrame(this.m_animationFrameHandle);\n            this.m_animationFrameHandle = undefined;\n        }\n        this.canvas.removeEventListener(\"webglcontextlost\", this.onWebGLContextLost);\n        this.canvas.removeEventListener(\"webglcontextrestored\", this.onWebGLContextRestored);\n        for (const dataSource of this.m_tileDataSources) {\n            dataSource.dispose();\n        }\n        this.m_visibleTiles.clearTileCache();\n        this.m_renderer.dispose();\n        this.m_imageCache.clear();\n        this.m_movementDetector.dispose();\n    }\n    /**\n     * The way the cache usage is computed, either based on size in MB (mega bytes) or in number of\n     * tiles.\n     */\n    get resourceComputationType() {\n        return this.m_visibleTiles.resourceComputationType;\n    }\n    set resourceComputationType(value) {\n        this.m_visibleTiles.resourceComputationType = value;\n    }\n    /**\n     * Returns the cache size.\n     */\n    getCacheSize() {\n        return this.m_visibleTiles.getDataSourceCacheSize();\n    }\n    /**\n     * Sets the cache size in number of tiles.\n     *\n     * @param size The cache size in tiles.\n     * @param numVisibleTiles The number of tiles visible, which is size/2 by default.\n     */\n    setCacheSize(size, numVisibleTiles) {\n        this.m_visibleTiles.setDataSourceCacheSize(size);\n        numVisibleTiles = numVisibleTiles !== undefined ? numVisibleTiles : size / 2;\n        this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(numVisibleTiles));\n        this.updateImages();\n        this.updateLighting();\n        this.updateTextRenderer();\n        this.updateSkyBackground();\n        this.update();\n    }\n    /**\n     * Specfies whether extended frustum culling is enabled or disabled.\n     */\n    get extendedFrustumCulling() {\n        return this.m_options.extendedFrustumCulling !== undefined\n            ? this.m_visibleTileSetOptions.extendedFrustumCulling\n            : true;\n    }\n    /**\n     * Enable of disable extended frustum culling.\n     */\n    set extendedFrustumCulling(value) {\n        this.m_visibleTileSetOptions.extendedFrustumCulling = value;\n    }\n    /**\n     * Returns the status of frustum culling after each update.\n     */\n    get lockVisibleTileSet() {\n        return this.m_visibleTileSetLock;\n    }\n    /**\n     * Enable of disable frustum culling after each update.\n     */\n    set lockVisibleTileSet(value) {\n        this.m_visibleTileSetLock = value;\n    }\n    /**\n     * Gets the optional camera used to render the scene.\n     */\n    get pointOfView() {\n        return this.m_pointOfView;\n    }\n    /**\n     * Sets the optional camera used to render the scene.\n     */\n    set pointOfView(pointOfView) {\n        this.m_pointOfView = pointOfView;\n        this.update();\n    }\n    /**\n     * Gets the current `Theme` used by this `MapView` to style map elements.\n     */\n    get theme() {\n        return this.m_theme;\n    }\n    /**\n     * Changes the `Theme` used by this `MapView` to style map elements.\n     */\n    set theme(theme) {\n        // Fog and sky.\n        this.m_theme.fog = theme.fog;\n        this.m_theme.sky = theme.sky;\n        this.updateSkyBackground();\n        this.m_fog.reset(this.m_theme);\n        this.m_theme.lights = theme.lights;\n        this.updateLighting();\n        // Clear color.\n        this.m_theme.clearColor = theme.clearColor;\n        this.renderer.setClearColor(new THREE.Color(theme.clearColor));\n        // Images.\n        this.m_theme.images = theme.images;\n        this.m_theme.imageTextures = theme.imageTextures;\n        this.updateImages();\n        // POI tables.\n        this.m_theme.poiTables = theme.poiTables;\n        this.loadPoiTables();\n        // Text.\n        this.m_theme.textStyles = theme.textStyles;\n        this.m_theme.defaultTextStyle = theme.defaultTextStyle;\n        this.m_theme.fontCatalogs = theme.fontCatalogs;\n        this.m_textRenderStyleCache.clear();\n        this.m_textLayoutStyleCache.clear();\n        this.updateTextRenderer();\n        if (this.m_theme.styles === undefined) {\n            this.m_theme.styles = {};\n        }\n        if (theme.styles !== undefined) {\n            for (const styleSetName in theme.styles) {\n                if (theme.styles[styleSetName] !== undefined) {\n                    const styleSet = theme.styles[styleSetName];\n                    this.getDataSourcesByStyleSetName(styleSetName).forEach(ds => ds.setStyleSet(styleSet));\n                    this.m_theme.styles[styleSetName] = styleSet;\n                }\n            }\n        }\n        this.update();\n    }\n    /**\n     * Gets the value of the forced custom camera aspect.\n     * Every time a frame is rendered, `MapView` resets the camera aspect.\n     *\n     * You can disable this behavior by setting the value to `undefined`.\n     */\n    get forceCameraAspect() {\n        return this.m_forceCameraAspect;\n    }\n    /**\n     * Sets the custom forced camera aspect ratio to use while rendering.\n     */\n    set forceCameraAspect(aspect) {\n        this.m_forceCameraAspect = aspect;\n    }\n    /**\n     * Maximum FPS. If defined (and > 0) it is the maximum FPS that is used.\n     */\n    set maxFps(fps) {\n        this.m_maxFps = Math.max(0, fps);\n    }\n    get maxFps() {\n        return Math.max(0, this.m_maxFps);\n    }\n    /**\n     * Lists the ISO 639-1 language codes for DataSources to use.\n     */\n    get languages() {\n        return this.m_languages;\n    }\n    /**\n     * Sets the list of ISO 639-1 language codes for DataSources to use.\n     */\n    set languages(languages) {\n        this.m_languages = languages;\n        this.m_tileDataSources.forEach((dataSource) => {\n            dataSource.setLanguages(this.m_languages);\n        });\n        this.update();\n    }\n    get copyrightInfo() {\n        return this.m_copyrightInfo;\n    }\n    /**\n     * @hidden\n     * Return if all fading animations (for debugging and performance measurement) should be\n     * disabled.\n     */\n    get fadingDisabled() {\n        return this.m_options.disableFading === true;\n    }\n    /**\n     * @hidden\n     * Return current frame number.\n     */\n    get frameNumber() {\n        return this.m_frameNumber;\n    }\n    addEventListener(type, listener) {\n        super.addEventListener(type, listener);\n    }\n    removeEventListener(type, listener) {\n        super.removeEventListener(type, listener);\n    }\n    /**\n     * The HTML canvas element used by this `MapView`.\n     */\n    get canvas() {\n        return this.m_options.canvas;\n    }\n    /**\n     * The HTML canvas element used by this `MapView`.\n     */\n    get collisionDebugCanvas() {\n        return this.m_collisionDebugCanvas;\n    }\n    /**\n     * The THREE.js scene used by this `MapView`.\n     */\n    get scene() {\n        return this.m_scene;\n    }\n    /**\n     * The THREE.js camera used by this `MapView` to render the main scene.\n     */\n    get camera() {\n        return this.m_camera;\n    }\n    /**\n     * The THREE.js `WebGLRenderer` used by this scene.\n     */\n    get renderer() {\n        return this.m_renderer;\n    }\n    /**\n     * The color used to clear the view.\n     */\n    get clearColor() {\n        const rendererClearColor = this.m_renderer.getClearColor();\n        return rendererClearColor !== undefined ? rendererClearColor.getHex() : 0;\n    }\n    /**\n     * The color used to clear the view.\n     */\n    set clearColor(color) {\n        this.m_renderer.setClearColor(color);\n    }\n    /**\n     * The projection used to project geo coordinates to world coordinates.\n     */\n    get projection() {\n        return this.m_visibleTileSetOptions.projection;\n    }\n    /**\n     * The distance (in pixels) between the screen and the camera.\n     */\n    get focalLength() {\n        return this.m_focalLength;\n    }\n    /**\n     * The position in geo coordinates of the center of the scene.\n     */\n    get geoCenter() {\n        return this.projection.unprojectPoint(this.m_worldCenter);\n    }\n    /**\n     * The position in geo coordinates of the center of the scene.\n     * Longitude values outside of -180 and +180 are acceptable.\n     */\n    set geoCenter(geoCenter) {\n        this.projection.projectPoint(geoCenter, this.m_worldCenter);\n        this.update();\n    }\n    /**\n     * The position in world coordinates of the center of the scene.\n     */\n    get worldCenter() {\n        return this.m_worldCenter;\n    }\n    /**\n     * The position in world coordinates of the center of the scene.\n     */\n    set worldCenter(center) {\n        this.m_worldCenter.copy(center);\n        this.update();\n    }\n    /**\n     * The root object of the scene. Contains all `rootObjects` of the [[Tile]]s.\n     */\n    get worldRootObject() {\n        return this.m_mapTilesRoot;\n    }\n    /**\n     * Get the [[PickHandler]] for this `mapView`.\n     */\n    get pickHandler() {\n        return this.m_pickHandler;\n    }\n    /**\n     * Get the [[ImageCache]] that belongs to this `MapView`.\n     */\n    get imageCache() {\n        return this.m_imageCache;\n    }\n    /**\n     * @hidden\n     * Get the [[PoiManager]] that belongs to this `MapView`.\n     */\n    get poiManager() {\n        return this.m_poiManager;\n    }\n    /**\n     * @hidden\n     * Get the array of [[PoiTableManager]] that belongs to this `MapView`.\n     */\n    get poiTableManager() {\n        return this.m_poiTableManager;\n    }\n    /**\n     * The minimum camera height in meters.\n     */\n    get minCameraHeight() {\n        return this.m_minCameraHeight;\n    }\n    /**\n     * The minimum zoom level.\n     */\n    get minZoomLevel() {\n        return this.m_minZoomLevel;\n    }\n    /**\n     * The minimum zoom level.\n     */\n    set minZoomLevel(zoomLevel) {\n        this.m_minZoomLevel = zoomLevel;\n        this.update();\n    }\n    /**\n     * The maximum zoom level. Default is 14.\n     */\n    get maxZoomLevel() {\n        return this.m_maxZoomLevel;\n    }\n    /**\n     * The maximum zoom level.\n     */\n    set maxZoomLevel(zoomLevel) {\n        this.m_maxZoomLevel = zoomLevel;\n        this.update();\n    }\n    /**\n     * Returns the zoom level for the given camera setup.\n     */\n    get zoomLevel() {\n        return this.m_zoomLevel;\n    }\n    /**\n     * Returns the storage level for the given camera setup.\n     * Actual storage level of the rendered data also depends on [[DataSource.storageLevelOffset]].\n     */\n    get storageLevel() {\n        return THREE.Math.clamp(Math.floor(this.m_zoomLevel), this.m_minZoomLevel, this.m_maxZoomLevel);\n    }\n    /**\n     * Returns height of the viewport in pixels.\n     */\n    get viewportHeight() {\n        return this.canvas.height;\n    }\n    /**\n     * Returns `true` if the native WebGL antialiasing is enabled.\n     */\n    get nativeWebglAntialiasEnabled() {\n        return this.m_options.enableNativeWebglAntialias !== false;\n    }\n    /**\n     * Returns [[DataSource]]s displayed by this `MapView`.\n     */\n    get dataSources() {\n        return this.m_tileDataSources;\n    }\n    /**\n     * Set's the way in which the fov is calculated on the map view. Note, for\n     * this to take visual effect, the map should be rendered after calling this\n     * function.\n     * @param fovCalculation How the FOV is calculated.\n     */\n    setFovCalculation(fovCalculation) {\n        this.m_options.fovCalculation = fovCalculation;\n        this.calculateFocalLength(this.m_renderer.getSize(tmpVector).height);\n        this.updateCameras();\n    }\n    /**\n     * Returns the unique [[DataSource]] matching the given name.\n     */\n    getDataSourceByName(dataSourceName) {\n        return this.m_tileDataSources.find(ds => ds.name === dataSourceName);\n    }\n    /**\n     * Returns the array of [[DataSource]]s referring to the same [[StyleSet]].\n     */\n    getDataSourcesByStyleSetName(styleSetName) {\n        return this.m_tileDataSources.filter(ds => ds.styleSetName === styleSetName);\n    }\n    /**\n     * Adds a new [[DataSource]] to this `MapView`. `MapView` needs at least one [[DataSource]] to\n     * display something.\n     *\n     * @param dataSource The data source.\n     */\n    addDataSource(dataSource) {\n        const twinDataSource = this.getDataSourceByName(dataSource.name);\n        if (twinDataSource !== undefined) {\n            throw new Error(`A DataSource with the name \"${dataSource.name}\" already exists in this MapView.`);\n        }\n        dataSource.attach(this);\n        this.m_tileDataSources.push(dataSource);\n        return dataSource\n            .connect()\n            .then(() => {\n            return new Promise(resolve => {\n                if (this.theme !== undefined) {\n                    resolve();\n                    return;\n                }\n                const resolveOnce = () => {\n                    this.removeEventListener(MapViewEventNames.ThemeLoaded, resolveOnce);\n                    resolve();\n                };\n                this.addEventListener(MapViewEventNames.ThemeLoaded, resolveOnce);\n            });\n        })\n            .then(() => {\n            const alreadyRemoved = this.m_tileDataSources.indexOf(dataSource) === -1;\n            if (alreadyRemoved) {\n                return;\n            }\n            dataSource.addEventListener(MapViewEventNames.Update, () => {\n                this.update();\n            });\n            if (this.m_theme.styles !== undefined && dataSource.styleSetName !== undefined) {\n                const styleSet = this.m_theme.styles[dataSource.styleSetName];\n                dataSource.setStyleSet(styleSet, this.m_languages);\n            }\n            this.m_connectedDataSources.add(dataSource.name);\n            this.dispatchEvent({\n                type: MapViewEventNames.DataSourceConnect,\n                dataSourceName: dataSource.name\n            });\n            this.update();\n        })\n            .catch(error => {\n            this.dispatchEvent({\n                type: MapViewEventNames.DataSourceConnect,\n                dataSourceName: dataSource.name,\n                error\n            });\n        });\n    }\n    /**\n     * Removes [[DataSource]] from this `MapView`.\n     *\n     * @param dataSource The data source to be removed\n     */\n    removeDataSource(dataSource) {\n        const dsIndex = this.m_tileDataSources.indexOf(dataSource);\n        if (dsIndex === -1) {\n            return;\n        }\n        dataSource.detach(this);\n        this.m_visibleTiles.removeDataSource(dataSource.name);\n        this.m_tileDataSources.splice(dsIndex, 1);\n        this.m_connectedDataSources.delete(dataSource.name);\n        this.update();\n    }\n    /**\n     * Access the `VisibleTileSet` to get access to all current datasources and their visible tiles.\n     */\n    get visibleTileSet() {\n        return this.m_visibleTiles;\n    }\n    /**\n     * Adds new overlay text elements to this `MapView`.\n     *\n     * @param textElements Array of [[TextElement]] to be added.\n     */\n    addOverlayText(textElements) {\n        if (this.m_overlayTextElements !== undefined) {\n            this.m_overlayTextElements = this.m_overlayTextElements.concat(textElements);\n        }\n        this.updateTextRenderer();\n        this.update();\n    }\n    /**\n     * Adds new overlay text elements to this `MapView`.\n     *\n     * @param textElements Array of [[TextElement]] to be added.\n     */\n    clearOverlayText() {\n        this.m_overlayTextElements = [];\n    }\n    /**\n     * Moves the camera to specified geocoordinates, sets desired zoom level and adjusts yaw and\n     * pitch.\n     *\n     * @param geoPos Geolocation to move the camera to.\n     * @param zoom Desired zoom level.\n     * @param yaw Camera yaw.\n     * @param pitch Camera pitch.\n     */\n    setCameraGeolocationAndZoom(geoPos, zoom, yaw, pitch) {\n        if (yaw !== undefined && pitch !== undefined) {\n            Utils_1.MapViewUtils.setRotation(this, yaw, pitch);\n        }\n        this.geoCenter = geoPos;\n        this.camera.position.set(0, 0, 0);\n        Utils_1.MapViewUtils.zoomOnTargetPosition(this, 0, 0, zoom);\n        this.update();\n    }\n    /**\n     * Returns `true` if this `MapView` is constantly redrawing the scene.\n     */\n    get animating() {\n        return this.m_animationCount > 0;\n    }\n    /**\n     * Begin animating the scene.\n     */\n    beginAnimation() {\n        if (this.m_animationCount++ === 0) {\n            if (!this.m_updatePending) {\n                this.m_updatePending = true;\n                this.drawFrame();\n            }\n            ANIMATION_STARTED_EVENT.time = Date.now();\n            this.dispatchEvent(ANIMATION_STARTED_EVENT);\n        }\n    }\n    /**\n     * Stop animating the scene.\n     */\n    endAnimation() {\n        if (this.m_animationCount > 0) {\n            --this.m_animationCount;\n        }\n        if (this.m_animationCount === 0) {\n            ANIMATION_FINISHED_EVENT.time = Date.now();\n            this.dispatchEvent(ANIMATION_FINISHED_EVENT);\n        }\n    }\n    /**\n     * Returns `true` if the camera moved in the last frame.\n     */\n    get cameraIsMoving() {\n        return this.m_movementDetector.cameraIsMoving;\n    }\n    /**\n     * Returns the ratio between a pixel and a world unit for the current camera (in the center of\n     * the camera projection).\n     */\n    get pixelToWorld() {\n        if (this.m_pixelToWorld === undefined) {\n            // At this point fov calculation should be always defined.\n            harp_utils_1.assert(this.m_options.fovCalculation !== undefined);\n            // NOTE: Look at distance is the distance to camera focus (and pivot) point.\n            // In screen space this point is located in the center of canvas.\n            // Given that zoom level is not modified (clamped by camera pitch), the following\n            // formulas are all equivalent:\n            // lookAtDistance = (EQUATORIAL_CIRCUMFERENCE * focalLength) / (256 * zoomLevel^2);\n            // lookAtDistance = abs(cameraPos.z) / cos(cameraPitch);\n            // Here we may use precalulated distance (once pre frame):\n            const lookAtDistance = this.m_lookAtDistance;\n            // Find world space object size that corresponds to one pixel on screen.\n            this.m_pixelToWorld = Utils_1.MapViewUtils.calculateWorldSizeByFocalLength(this.m_focalLength, lookAtDistance, 1);\n        }\n        return this.m_pixelToWorld;\n    }\n    /**\n     * Returns the ratio between a world and a pixel unit for the current camera (in the center of\n     * the camera projection).\n     */\n    get worldToPixel() {\n        return 1.0 / this.pixelToWorld;\n    }\n    get pixelRatio() {\n        if (this.m_pixelRatio !== undefined) {\n            return this.m_pixelRatio;\n        }\n        return typeof window !== \"undefined\" && window.devicePixelRatio !== undefined\n            ? window.devicePixelRatio\n            : 1.0;\n    }\n    /**\n     * PixelRatio in the WebGlRenderer. May contain values > 1.0 for high resolution screens\n     * (HiDPI).\n     *\n     * A value of `undefined` will make the getter return `window.devicePixelRatio`, setting a value\n     * of `1.0` will disable the use of HiDPI on all devices.\n     *\n     * @note Since the current pixelRatio may have been used in some calculations (e.g. the icons)\n     * they may appear in the wrong size now. To ensure proper display of data, a call to\n     * `clearTileCache()` is required if the pixelRatio is changed after tiles have been loaded.\n     *\n     * @memberof MapView\n     */\n    set pixelRatio(pixelRatio) {\n        this.m_pixelRatio = pixelRatio;\n        if (this.renderer.getPixelRatio() !== this.pixelRatio) {\n            this.renderer.setPixelRatio(this.pixelRatio);\n        }\n    }\n    /**\n     * PixelRatio ratio for rendering when the camera is moving or an animation is running. Useful\n     * when rendering on high resolution displays with low performance GPUs that may be\n     * fill-rate-limited.\n     *\n     * If a value is specified, a low resolution render pass is used to render the scene into a\n     * low resolution render target, before it is copied to the screen.\n     *\n     * A value of `undefined` disables the low res render pass. Values between 0.5 and\n     * `window.devicePixelRatio` can be tried to give  good results. The value should not be larger\n     * than `window.devicePixelRatio`.\n     *\n     * @note Since no anti-aliasing is applied during dynamic rendering with `dynamicPixelRatio`\n     * defined, visual artifacts may occur, especially with thin lines..\n     *\n     * @note The resolution of icons and text labels is not affected.\n     *\n     * @default `undefined`\n     */\n    set dynamicPixelRatio(ratio) {\n        this.mapRenderingManager.lowResPixelRatio = ratio;\n    }\n    get dynamicPixelRatio() {\n        return this.mapRenderingManager.lowResPixelRatio;\n    }\n    /**\n     * Returns the screen position of the given geo coordinates.\n     *\n     * @param geoPos The geo coordinates.\n     * @returns The screen position in CSS/client coordinates (no pixel ratio applied) or\n     * `undefined`.\n     */\n    getScreenPosition(geoPos) {\n        const worldPos = new THREE.Vector3();\n        this.projection.projectPoint(geoPos, worldPos);\n        const p = this.m_screenProjector.project(worldPos);\n        if (p !== undefined) {\n            const { width, height } = this.canvas;\n            p.x = (p.x + width / 2) / this.pixelRatio;\n            p.y = (height - (p.y + height / 2)) / this.pixelRatio;\n        }\n        return p;\n    }\n    /**\n     * Returns the world space position from the given screen position. The return value can be\n     * `null`, in case the camera is facing the horizon and the given `(x, y)` value is not\n     * intersecting the ground plane.\n     *\n     * @param x The X position in css/client coordinates (without applied display ratio).\n     * @param y The Y position in css/client coordinates (without applied display ratio).\n     */\n    getWorldPositionAt(x, y) {\n        this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(x, y), this.m_camera);\n        const vec3 = new THREE.Vector3();\n        const worldPosition = this.m_raycaster.ray.intersectPlane(this.m_plane, vec3);\n        if (!worldPosition) {\n            return null;\n        }\n        worldPosition.add(this.m_worldCenter);\n        return worldPosition;\n    }\n    /**\n     * Returns the [[GeoCoordinates]] from the given screen position. The return value can be\n     * `null`, in case the camera is facing the horizon and the given `(x, y)` value is not\n     * intersecting the ground plane.\n     *\n     * @param x The X position in css/client coordinates (without applied display ratio).\n     * @param y The Y position in css/client coordinates (without applied display ratio).\n     */\n    getGeoCoordinatesAt(x, y) {\n        const worldPosition = this.getWorldPositionAt(x, y);\n        if (!worldPosition) {\n            return null;\n        }\n        return this.projection.unprojectPoint(worldPosition);\n    }\n    /**\n     * Returns the normalized screen coordinates from the given pixel position.\n     *\n     * @param x The X position in css/client coordinates (without applied display ratio).\n     * @param y The Y position in css/client coordinates (without applied display ratio).\n     */\n    getNormalizedScreenCoordinates(x, y) {\n        // use clientWidth and clientHeight as it does not apply the pixelRatio and\n        // therefore supports also HiDPI devices\n        const { width, height } = this.getCanvasClientSize();\n        return new THREE.Vector3((x / width) * 2 - 1, -((y / height) * 2) + 1, 0);\n    }\n    /**\n     * Do a raycast on all objects in the scene. Useful for picking. Limited to objects that\n     * THREE.js can raycast, the solid lines that get their geometry in the shader cannot be tested\n     * for intersection.\n     *\n     * @param x The X position in css/client coordinates (without applied display ratio).\n     * @param y The Y position in css/client coordinates (without applied display ratio).\n     * @returns The list of intersection results.\n     */\n    intersectMapObjects(x, y) {\n        return this.m_pickHandler.intersectMapObjects(x, y);\n    }\n    /**\n     * Resize the HTML canvas element and the THREE.js `WebGLRenderer`.\n     *\n     * @param width The new width.\n     * @param height The new height.\n     */\n    resize(width, height) {\n        this.m_renderer.setSize(width, height, false);\n        if (this.m_renderer.getPixelRatio() !== this.pixelRatio) {\n            this.m_renderer.setPixelRatio(this.pixelRatio);\n        }\n        if (this.mapRenderingManager !== undefined) {\n            this.mapRenderingManager.setSize(width, height);\n        }\n        if (this.collisionDebugCanvas !== undefined) {\n            this.collisionDebugCanvas.width = width;\n            this.collisionDebugCanvas.height = height;\n        }\n        this.updateCameras();\n        this.update();\n    }\n    /**\n     * Requests a redraw of the scene.\n     */\n    update() {\n        if (this.m_updatePending) {\n            return;\n        } // compress the update request\n        this.m_updatePending = true;\n        if (this.animating) {\n            return;\n        } // nothing to do\n        this.drawFrame();\n    }\n    /**\n     * Returns `true` if an update has already been requested, such that after a currently rendering\n     * frame, the next frame will be rendered immediately.\n     */\n    get updatePending() {\n        return this.m_updatePending;\n    }\n    /**\n     * Requests a redraw of the scene.\n     * @deprecated Use the [[update]] method instead.\n     */\n    requestUpdateIfNeeded() {\n        this.update();\n    }\n    /**\n     * Clear the tile cache.\n     *\n     * Remove the [[Tile]] objects created by cacheable [[DataSource]]s. If a [[DataSource]] name is\n     * provided, this method restricts the eviction the [[DataSource]] with the given name.\n     *\n     * @param dataSourceName The name of the [[DataSource]].\n     */\n    clearTileCache(dataSourceName) {\n        this.m_visibleTiles.clearTileCache(dataSourceName);\n    }\n    /**\n     * Apply visitor to all visible tiles.\n     *\n     * @param fun Visitor function\n     */\n    forEachVisibleTile(fun) {\n        this.m_visibleTiles.forEachVisibleTile(fun);\n    }\n    /**\n     * Apply a visitor function to all tiles in the cache.\n     *\n     * @param visitor Visitor function\n     */\n    forEachCachedTile(visitor) {\n        this.m_visibleTiles.forEachCachedTile(visitor);\n    }\n    /**\n     * Visit each tile in visible, rendered, and cached sets.\n     *\n     *  * Visible and temporarily rendered tiles will be marked for update and retained.\n     *  * Cached but not rendered/visible will be evicted.\n     *\n     * @param dataSource If passed, only the tiles from this [[DataSource]] instance are processed.\n     * If `undefined`, tiles from all [[DataSource]]s are processed.\n     */\n    markTilesDirty(dataSource) {\n        this.m_visibleTiles.markTilesDirty(dataSource);\n    }\n    /**\n     * Public access to [[MapViewFog]] allowing to toggle it by setting its `enabled` property.\n     */\n    get fog() {\n        return this.m_fog;\n    }\n    /**\n     * Updates the camera and the projections and resets the screen collisions,\n     * note, setupCamera must be called before this is called.\n     */\n    updateCameras() {\n        const { width, height } = this.m_renderer.getSize(tmpVector);\n        this.m_camera.aspect =\n            this.m_forceCameraAspect !== undefined ? this.m_forceCameraAspect : width / height;\n        this.setFovOnCamera(this.m_options.fovCalculation, height);\n        const kMinNear = 0.1;\n        const kMultiplier = 50.0;\n        const kFarOffset = 200.0;\n        let nearPlane = Math.max(kMinNear, this.m_camera.position.z * 0.1);\n        let farPlane = nearPlane * kMultiplier + kFarOffset;\n        if (this.m_options.farPlaneEvaluator !== undefined) {\n            this.camera.getWorldDirection(this.m_tempVector3);\n            const angle = THREE.Math.radToDeg(this.m_tempVector3.angleTo(EYE_INVERSE));\n            const nearFarPlane = this.m_options.farPlaneEvaluator(this, angle, nearPlane, farPlane);\n            nearPlane = Math.max(kMinNear, nearFarPlane.near);\n            farPlane = Math.max(nearPlane + kFarOffset, nearFarPlane.far);\n        }\n        this.m_camera.near = nearPlane;\n        this.m_camera.far = farPlane;\n        this.m_camera.updateProjectionMatrix();\n        this.m_camera.updateMatrixWorld(false);\n        this.m_screenCamera.left = width / -2;\n        this.m_screenCamera.right = width / 2;\n        this.m_screenCamera.bottom = height / -2;\n        this.m_screenCamera.top = height / 2;\n        this.m_screenCamera.updateProjectionMatrix();\n        this.m_screenCamera.updateMatrixWorld(false);\n        this.m_screenProjector.update(this.m_camera, this.m_worldCenter, width, height);\n        this.m_screenCollisions.update(width, height);\n        this.m_pixelToWorld = undefined;\n        const cameraPitch = Utils_1.MapViewUtils.extractYawPitchRoll(this.camera.quaternion).pitch;\n        const cameraPosZ = Math.abs(this.camera.position.z);\n        this.m_lookAtDistance = cameraPosZ / Math.cos(cameraPitch);\n        const zoomLevelDistance = cameraPosZ / Math.cos(Math.min(cameraPitch, Math.PI / 3));\n        this.m_zoomLevel = Utils_1.MapViewUtils.calculateZoomLevelFromDistance(zoomLevelDistance, this);\n    }\n    detectCurrentFps(now) {\n        // Skip the first frames, they are from not originated from requestAnimationFrame()\n        if (this.m_previousRequestAnimationTime !== undefined && this.m_frameNumber > 5) {\n            const currentFps = 1000 / (now - this.m_previousRequestAnimationTime);\n            this.m_frameTimeRing[this.m_frameTimeIndex % FRAME_RATE_RING_SIZE] = currentFps;\n            this.m_frameTimeIndex++;\n            const capturedFrames = Math.min(this.m_frameTimeIndex, FRAME_RATE_RING_SIZE);\n            let sum = 0;\n            for (let i = 0; i < capturedFrames; i++) {\n                sum += this.m_frameTimeRing[i];\n            }\n            this.m_detectedFps = sum / capturedFrames;\n        }\n        this.m_previousRequestAnimationTime = now;\n    }\n    /**\n     * Draw a new frame.\n     */\n    drawFrame() {\n        if (this.m_drawing) {\n            return;\n        }\n        // Cancel an active requestAnimationFrame() cycle. Failure to do this may end up in\n        // rendering multiple times during a single frame.\n        if (this.m_animationFrameHandle !== undefined) {\n            cancelAnimationFrame(this.m_animationFrameHandle);\n            this.m_animationFrameHandle = undefined;\n        }\n        if (this.m_maxFps <= 0) {\n            // Render at maximum FPS.\n            this.m_animationFrameHandle = requestAnimationFrame(this.handleRequestAnimationFrame);\n            return;\n        }\n        // Magic ingredient to compensate time flux.\n        const fudgeTimeInMs = 3;\n        const vSyncFrameTime = 1000 / this.m_detectedFps;\n        const frameInterval = 1000 / this.m_maxFps;\n        const previousFrameTime = this.m_previousFrameTimeStamp === undefined ? 0 : this.m_previousFrameTimeStamp;\n        // Compute a practical value to compare against.\n        const targetTime = previousFrameTime + frameInterval - vSyncFrameTime - fudgeTimeInMs;\n        this.m_targetRequestAnimationTime = targetTime;\n        this.postponedAnimationFrame(previousFrameTime);\n    }\n    postponedAnimationFrame(now) {\n        if (this.m_targetRequestAnimationTime === undefined) {\n            return;\n        }\n        if (this.m_animationFrameHandle !== undefined) {\n            cancelAnimationFrame(this.m_animationFrameHandle);\n            this.m_animationFrameHandle = undefined;\n        }\n        this.detectCurrentFps(now);\n        this.m_animationFrameHandle = requestAnimationFrame(now > this.m_targetRequestAnimationTime\n            ? this.handleRequestAnimationFrame\n            : this.handlePostponedAnimationFrame);\n    }\n    /**\n     * Draw a new frame.\n     */\n    renderFunc(time) {\n        this.render(time);\n    }\n    /**\n     * Returns the list of the enabled data sources.\n     */\n    getEnabledTileDataSources() {\n        // ### build this list once decoders && datasources are ready\n        const enabledDataSources = [];\n        for (const dataSource of this.m_tileDataSources) {\n            if (!dataSource.enabled) {\n                continue;\n            }\n            if (!dataSource.ready()) {\n                continue;\n            }\n            if (!this.m_connectedDataSources.has(dataSource.name)) {\n                continue;\n            }\n            enabledDataSources.push(dataSource);\n        }\n        return enabledDataSources;\n    }\n    /**\n     * Renders the current frame.\n     */\n    render(time) {\n        if (this.m_drawing) {\n            return;\n        }\n        ++this.m_frameNumber;\n        const stats = Statistics_1.PerformanceStatistics.instance;\n        const gatherStatistics = stats.enabled;\n        const frameStartTime = time;\n        RENDER_EVENT.time = time;\n        this.dispatchEvent(RENDER_EVENT);\n        let currentFrameEvent;\n        if (gatherStatistics) {\n            currentFrameEvent = stats.currentFrame;\n            currentFrameEvent.setValue(\"renderCount.frameNumber\", this.m_frameNumber);\n            if (this.m_previousFrameTimeStamp !== undefined) {\n                const timeSincePreviousFrame = frameStartTime - this.m_previousFrameTimeStamp;\n                if (gatherStatistics) {\n                    currentFrameEvent.setValue(\"render.fullFrameTime\", timeSincePreviousFrame);\n                    // For convenience and easy readability\n                    currentFrameEvent.setValue(\"render.fps\", 1000 / timeSincePreviousFrame);\n                }\n            }\n        }\n        this.m_previousFrameTimeStamp = frameStartTime;\n        let setupTime;\n        let cullTime;\n        let textPlacementTime;\n        let drawTime;\n        let textDrawTime;\n        let endTime;\n        this.m_renderer.info.reset();\n        this.m_updatePending = false;\n        this.m_thisFrameTilesChanged = undefined;\n        this.m_drawing = true;\n        if (this.m_renderer.getPixelRatio() !== this.pixelRatio) {\n            this.m_renderer.setPixelRatio(this.pixelRatio);\n        }\n        this.updateCameras();\n        this.m_fog.update(this.m_camera);\n        this.m_renderer.clear();\n        // clear the scene\n        while (this.m_mapTilesRoot.children.length > 0) {\n            this.m_mapTilesRoot.remove(this.m_mapTilesRoot.children[0]);\n        }\n        if (gatherStatistics) {\n            setupTime = harp_utils_1.PerformanceTimer.now();\n        }\n        // TBD: Update renderList only any of its params (camera, etc...) has changed.\n        if (!this.lockVisibleTileSet) {\n            this.m_visibleTiles.updateRenderList(this.m_worldCenter, this.storageLevel, Math.floor(this.zoomLevel), this.getEnabledTileDataSources());\n        }\n        if (gatherStatistics) {\n            cullTime = harp_utils_1.PerformanceTimer.now();\n        }\n        const renderList = this.m_visibleTiles.dataSourceTileList;\n        renderList.forEach(({ zoomLevel, renderedTiles }) => {\n            renderedTiles.forEach(tile => {\n                this.renderTileObjects(tile, zoomLevel);\n                //We know that rendered tiles are visible (in the view frustum), so we update the\n                //frame number, note we don't do this for the visibleTiles because some may still be\n                //loading (and therefore aren't visible in the sense of being seen on the screen).\n                //Note also, this number isn't currently used anywhere so should be considered to be\n                //removed in the future (though could be good for debugging purposes).\n                tile.frameNumLastVisible = this.m_frameNumber;\n            });\n        });\n        this.m_animatedExtrusionHandler.zoom = this.m_zoomLevel;\n        if (currentFrameEvent !== undefined) {\n            // Make sure the counters all have a value.\n            currentFrameEvent.addValue(\"renderCount.numTilesRendered\", 0);\n            currentFrameEvent.addValue(\"renderCount.numTilesVisible\", 0);\n            currentFrameEvent.addValue(\"renderCount.numTilesLoading\", 0);\n            // Increment the counters for all data sources.\n            renderList.forEach(({ zoomLevel, renderedTiles, visibleTiles, numTilesLoading }) => {\n                currentFrameEvent.addValue(\"renderCount.numTilesRendered\", renderedTiles.length);\n                currentFrameEvent.addValue(\"renderCount.numTilesVisible\", visibleTiles.length);\n                currentFrameEvent.addValue(\"renderCount.numTilesLoading\", numTilesLoading);\n            });\n        }\n        this.m_movementDetector.checkCameraMoved(this, time);\n        // The camera used to render the scene.\n        const camera = this.m_pointOfView !== undefined ? this.m_pointOfView : this.m_camera;\n        this.prepareRenderTextElements(time);\n        if (gatherStatistics) {\n            textPlacementTime = harp_utils_1.PerformanceTimer.now();\n        }\n        if (this.m_skyBackground !== undefined) {\n            this.m_skyBackground.update(this.m_camera);\n        }\n        const isDynamicFrame = this.cameraIsMoving || this.animating || this.m_updatePending;\n        this.mapRenderingManager.render(this.m_renderer, this.m_scene, camera, !isDynamicFrame);\n        if (gatherStatistics) {\n            drawTime = harp_utils_1.PerformanceTimer.now();\n        }\n        this.finishRenderTextElements();\n        if (gatherStatistics) {\n            textDrawTime = harp_utils_1.PerformanceTimer.now();\n        }\n        if (!this.m_firstFrameRendered) {\n            this.m_firstFrameRendered = true;\n            if (gatherStatistics) {\n                stats.appResults.set(\"firstFrame\", time);\n            }\n            FIRST_FRAME_EVENT.time = time;\n            this.dispatchEvent(FIRST_FRAME_EVENT);\n        }\n        if (!this.m_firstFrameComplete &&\n            this.m_visibleTiles.allVisibleTilesLoaded &&\n            this.m_connectedDataSources.size === this.m_tileDataSources.length &&\n            !this.m_updatePending &&\n            !this.animating &&\n            this.m_textElementsRenderer !== undefined &&\n            !this.m_textElementsRenderer.loading) {\n            this.m_firstFrameComplete = true;\n            if (gatherStatistics) {\n                stats.appResults.set(\"firstFrameComplete\", time);\n            }\n            FRAME_COMPLETE_EVENT.time = time;\n            this.dispatchEvent(FRAME_COMPLETE_EVENT);\n        }\n        this.m_visibleTiles.disposePendingTiles();\n        this.m_drawing = false;\n        if (this.animating || this.m_updatePending) {\n            this.drawFrame();\n        }\n        this.checkCopyrightUpdates();\n        if (currentFrameEvent !== undefined) {\n            endTime = harp_utils_1.PerformanceTimer.now();\n            currentFrameEvent.setValue(\"render.setupTime\", setupTime - frameStartTime);\n            currentFrameEvent.setValue(\"render.cullTime\", cullTime - setupTime);\n            currentFrameEvent.setValue(\"render.textPlacementTime\", textPlacementTime - cullTime);\n            currentFrameEvent.setValue(\"render.drawTime\", drawTime - textPlacementTime);\n            currentFrameEvent.setValue(\"render.textDrawTime\", textDrawTime - drawTime);\n            currentFrameEvent.setValue(\"render.cleanupTime\", endTime - textDrawTime);\n            currentFrameEvent.setValue(\"render.frameRenderTime\", endTime - frameStartTime);\n            Statistics_1.PerformanceStatistics.instance.storeFrameInfo(this.m_renderer.info);\n        }\n        DID_RENDER_EVENT.time = time;\n        this.dispatchEvent(DID_RENDER_EVENT);\n    }\n    renderTileObjects(tile, zoomLevel) {\n        const worldOffsetX = this.projection.worldExtent(0, 0).max.x * tile.offset;\n        if (tile.willRender(zoomLevel)) {\n            for (const object of tile.objects) {\n                object.position.copy(tile.center);\n                if (object.displacement !== undefined) {\n                    object.position.add(object.displacement);\n                }\n                object.position.x += worldOffsetX;\n                object.position.sub(this.m_worldCenter);\n                this.m_mapTilesRoot.add(object);\n            }\n        }\n        tile.didRender();\n    }\n    prepareRenderTextElements(time) {\n        // Disable rendering of text elements for debug camera. TextElements are rendered using an\n        // orthographic camera that covers the entire available screen space. Unfortunately, this\n        // particular camera set up is not compatible with the debug camera.\n        const debugCameraActive = this.m_pointOfView !== undefined;\n        if (this.m_textElementsRenderer === undefined ||\n            !this.m_textElementsRenderer.ready ||\n            debugCameraActive) {\n            return;\n        }\n        if (this.checkIfTextElementsChanged() || this.checkIfTilesChanged()) {\n            this.m_textElementsRenderer.placeAllTileLabels();\n        }\n        let shouldDrawText;\n        this.camera.getWorldDirection(this.m_tempVector3);\n        const angle = THREE.Math.radToDeg(this.m_tempVector3.angleTo(EYE_INVERSE));\n        if (this.m_options.labelVisibilityEvaluator !== undefined) {\n            shouldDrawText = this.m_options.labelVisibilityEvaluator(this, angle);\n        }\n        else {\n            const maxLabelAngle = this.m_options.maxLabelAngle === undefined ? 90 : this.m_options.maxLabelAngle;\n            shouldDrawText = angle < maxLabelAngle;\n        }\n        this.m_textElementsRenderer.reset();\n        if (shouldDrawText) {\n            // User TextElements have the priority when it comes to reserving screen space, so\n            // they are handled first. They will be rendered after the normal map objects and\n            // TextElements\n            this.m_textElementsRenderer.renderUserTextElements(time, this.m_frameNumber);\n            this.m_textElementsRenderer.renderAllTileText(time, this.m_frameNumber);\n        }\n        this.m_textElementsRenderer.renderOverlay(this.m_overlayTextElements);\n        this.m_textElementsRenderer.update();\n    }\n    finishRenderTextElements() {\n        const canRenderTextElements = this.m_pointOfView === undefined;\n        if (canRenderTextElements && this.m_textElementsRenderer) {\n            // copy far value from scene camera, as the distance to the POIs matter now.\n            this.m_screenCamera.far = this.camera.far;\n            this.m_textElementsRenderer.renderText(this.m_screenCamera);\n        }\n    }\n    initTheme() {\n        if (this.m_options.theme === undefined) {\n            return;\n        }\n        const themePromise = typeof this.m_options.theme === \"string\"\n            ? ThemeLoader_1.ThemeLoader.loadAsync(this.m_options.theme)\n            : Promise.resolve(this.m_options.theme);\n        themePromise.then((theme) => {\n            THEME_LOADED_EVENT.time = Date.now();\n            this.dispatchEvent(THEME_LOADED_EVENT);\n            this.theme = theme;\n        });\n    }\n    setupCamera() {\n        const { width, height } = this.getCanvasClientSize();\n        this.m_scene.add(this.m_camera); // ensure the camera is added to the scene.\n        this.m_camera.position.set(0, 0, 3000);\n        this.m_camera.lookAt(new THREE.Vector3(0, 0, 0));\n        this.m_lookAtDistance = 3000;\n        this.calculateFocalLength(height);\n        this.m_visibleTiles = new VisibleTileSet_1.VisibleTileSet(this.m_camera, this.m_visibleTileSetOptions);\n        // ### move & customize\n        this.resize(width, height);\n        this.geoCenter = new harp_geoutils_1.GeoCoordinates(52.518611, 13.376111, 0);\n        this.m_screenCamera.position.z = 1;\n        this.m_screenCamera.near = 0;\n    }\n    updateSkyBackground() {\n        if (this.m_theme === undefined) {\n            return;\n        }\n        const theme = this.m_theme;\n        if (this.m_skyBackground instanceof SkyBackground_1.SkyBackground && theme.sky !== undefined) {\n            // there is a sky in the view and there is a sky option in the theme. Update the colors\n            this.updateSkyBackgroundColors(theme.sky, theme.clearColor);\n        }\n        else if (this.m_skyBackground === undefined && theme.sky !== undefined) {\n            // there is no sky in the view but there is a sky option in the theme\n            this.addNewSkyBackground(theme.sky, theme.clearColor);\n            return;\n        }\n        else if (this.m_skyBackground instanceof SkyBackground_1.SkyBackground && theme.sky === undefined) {\n            // there is a sky in the view, but not in the theme\n            this.removeSkyBackGround();\n        }\n    }\n    addNewSkyBackground(skyBackground, clearColor) {\n        const groundColor = skyBackground.groundColor === undefined ? clearColor : skyBackground.groundColor;\n        this.m_skyBackground = new SkyBackground_1.SkyBackground(new THREE.Color(skyBackground.colorTop), new THREE.Color(skyBackground.colorBottom), new THREE.Color(groundColor), this.camera, skyBackground.monomialPower);\n        this.m_scene.background = this.m_skyBackground.texture;\n    }\n    removeSkyBackGround() {\n        this.m_scene.background = null;\n        if (this.m_skyBackground !== undefined) {\n            this.m_skyBackground.texture.dispose();\n            this.m_skyBackground = undefined;\n        }\n    }\n    updateSkyBackgroundColors(skyBackground, clearColor) {\n        const groundColor = skyBackground.groundColor === undefined ? clearColor : skyBackground.groundColor;\n        if (this.m_skyBackground !== undefined) {\n            this.m_skyBackground.updateColors(new THREE.Color(skyBackground.colorTop), new THREE.Color(skyBackground.colorBottom), new THREE.Color(groundColor));\n        }\n    }\n    updateLighting() {\n        if (!this.m_theme) {\n            return;\n        }\n        const theme = this.m_theme;\n        if (theme.clearColor !== undefined) {\n            this.m_renderer.setClearColor(new THREE.Color(theme.clearColor));\n        }\n        if (this.m_createdLights) {\n            this.m_createdLights.forEach((light) => {\n                this.m_scene.remove(light);\n            });\n        }\n        if (theme.lights !== undefined) {\n            this.m_createdLights = [];\n            theme.lights.forEach((lightDescription) => {\n                const light = ThemeHelpers_1.createLight(lightDescription);\n                if (!light) {\n                    logger.log(`MapView: failed to create light ${lightDescription.name} of type ${lightDescription.type}`);\n                    return;\n                }\n                this.m_scene.add(light);\n                this.m_createdLights.push(light);\n            });\n        }\n    }\n    movementStarted() {\n        if (this.m_textElementsRenderer !== undefined) {\n            this.m_textElementsRenderer.movementStarted();\n        }\n        MOVEMENT_STARTED_EVENT.time = Date.now();\n        this.dispatchEvent(MOVEMENT_STARTED_EVENT);\n    }\n    movementFinished() {\n        if (this.m_textElementsRenderer !== undefined) {\n            this.m_textElementsRenderer.movementFinished();\n        }\n        MOVEMENT_FINISHED_EVENT.time = Date.now();\n        this.dispatchEvent(MOVEMENT_FINISHED_EVENT);\n        // render at the next possible time.\n        if (!this.animating) {\n            setTimeout(() => this.update(), 0);\n        }\n    }\n    /**\n     * Check if the `textElementsChanged` flag in any tile has been set to `true`. If any flag was\n     * `true`, this function returns `true`, and resets the flag in all tiles to `false`.\n     */\n    checkIfTextElementsChanged() {\n        const renderList = this.m_visibleTiles.dataSourceTileList;\n        let textElementsChanged = false;\n        renderList.forEach(({ renderedTiles }) => {\n            renderedTiles.forEach(tile => {\n                if (tile.textElementsChanged) {\n                    tile.textElementsChanged = false;\n                    textElementsChanged = true;\n                }\n            });\n        });\n        return textElementsChanged;\n    }\n    /**\n     * Check if the set of visible tiles changed since the last frame.\n     *\n     * May be called multiple times per frame.\n     *\n     * Equality is computed by creating a string containing the IDs of the tiles.\n     */\n    checkIfTilesChanged() {\n        if (this.m_thisFrameTilesChanged !== undefined) {\n            return this.m_thisFrameTilesChanged;\n        }\n        const renderList = this.m_visibleTiles.dataSourceTileList;\n        const tileIdList = [];\n        tileIdList.length = 0;\n        renderList.forEach(({ dataSource, renderedTiles }) => {\n            renderedTiles.forEach(tile => {\n                tileIdList.push(dataSource.name + \"-\" + tile.tileKey.mortonCode());\n            });\n        });\n        tileIdList.sort();\n        const newTileIds = tileIdList.join(\"#\");\n        if (newTileIds !== this.m_lastTileIds) {\n            this.m_lastTileIds = newTileIds;\n            this.m_thisFrameTilesChanged = true;\n        }\n        else {\n            this.m_thisFrameTilesChanged = false;\n        }\n        return this.m_thisFrameTilesChanged;\n    }\n    checkCopyrightUpdates() {\n        if (!this.checkIfTilesChanged()) {\n            return;\n        }\n        const newCopyrightInfo = this.getRenderedTilesCopyrightInfo();\n        if (newCopyrightInfo === this.m_copyrightInfo) {\n            return;\n        }\n        if (newCopyrightInfo.length === this.m_copyrightInfo.length) {\n            let allEqual = true;\n            for (let i = 0; i < newCopyrightInfo.length; i++) {\n                const a = newCopyrightInfo[i];\n                const b = this.m_copyrightInfo[i];\n                if (a.label !== b.label) {\n                    allEqual = false;\n                    break;\n                }\n            }\n            if (allEqual) {\n                return;\n            }\n        }\n        this.m_copyrightInfo = newCopyrightInfo;\n        this.dispatchEvent(COPYRIGHT_CHANGED_EVENT);\n    }\n    getRenderedTilesCopyrightInfo() {\n        let result = [];\n        for (const tileList of this.m_visibleTiles.dataSourceTileList) {\n            for (const tile of tileList.renderedTiles) {\n                const tileCopyrightInfo = tile.copyrightInfo;\n                if (tileCopyrightInfo === undefined || tileCopyrightInfo.length === 0) {\n                    continue;\n                }\n                result = CopyrightInfo_1.CopyrightInfo.mergeArrays(result, tileCopyrightInfo);\n            }\n        }\n        return result;\n    }\n    updateImages() {\n        if (!this.m_theme) {\n            return;\n        }\n        const theme = this.m_theme;\n        this.m_imageCache.clear();\n        this.poiManager.clear();\n        if (theme.images !== undefined) {\n            for (const name of Object.keys(theme.images)) {\n                const image = theme.images[name];\n                this.m_imageCache.addImage(name, image.url, image.preload === true);\n                if (typeof image.atlas === \"string\") {\n                    this.poiManager.addTextureAtlas(name, image.atlas);\n                }\n            }\n        }\n        if (theme.imageTextures !== undefined) {\n            theme.imageTextures.forEach((imageTexture) => {\n                this.poiManager.addImageTexture(imageTexture);\n            });\n        }\n    }\n    loadPoiTables() {\n        if (this.m_theme === undefined) {\n            return;\n        }\n        this.poiTableManager.clear();\n        // Add the POI tables defined in the theme.\n        this.poiTableManager.loadPoiTables(this.m_theme);\n    }\n    setupStats(enable) {\n        // tslint:disable-next-line:no-unused-expression\n        new Statistics_1.PerformanceStatistics(enable, 1000);\n    }\n    setupRenderer() {\n        this.m_renderer.setClearColor(DEFAULT_CLEAR_COLOR);\n        this.m_scene.add(this.m_mapTilesRoot);\n    }\n    /**\n     * Gradually initialize & update TextRenderer as assets arrive.\n     */\n    updateTextRenderer() {\n        if (this.m_theme.textStyles === undefined) {\n            return;\n        }\n        if (this.m_textElementsRenderer === undefined) {\n            this.m_textElementsRenderer = new TextElementsRenderer_1.TextElementsRenderer(this, this.m_screenCollisions, this.m_screenProjector, this.m_options.minNumGlyphs, this.m_options.maxNumGlyphs, this.m_theme, this.m_options.maxNumVisibleLabels, this.m_options.numSecondChanceLabels, this.m_options.maxDistanceRatioForLabels, this.m_options.labelStartScaleDistance);\n        }\n        this.m_textElementsRenderer.placeAllTileLabels();\n    }\n    limitFov(fov, aspect) {\n        fov = harp_geoutils_1.MathUtils.clamp(fov, MIN_FIELD_OF_VIEW, MAX_FIELD_OF_VIEW);\n        let hFov = harp_geoutils_1.MathUtils.radToDeg(Utils_1.MapViewUtils.calculateHorizontalFovByVerticalFov(harp_geoutils_1.MathUtils.degToRad(fov), aspect));\n        if (hFov > MAX_FIELD_OF_VIEW || hFov < MIN_FIELD_OF_VIEW) {\n            hFov = harp_geoutils_1.MathUtils.clamp(hFov, MIN_FIELD_OF_VIEW, MAX_FIELD_OF_VIEW);\n            fov = harp_geoutils_1.MathUtils.radToDeg(Utils_1.MapViewUtils.calculateVerticalFovByHorizontalFov(harp_geoutils_1.MathUtils.degToRad(hFov), aspect));\n        }\n        return fov;\n    }\n    /**\n     * Sets the field of view calculation, and applies it immediately to the camera.\n     *\n     * @param type How to calculate the FOV\n     */\n    setFovOnCamera(fovCalculation, height) {\n        let fov = 0;\n        if (fovCalculation.type === \"fixed\") {\n            this.calculateFocalLength(height);\n            fov = fovCalculation.fov;\n        }\n        else {\n            harp_utils_1.assert(this.m_focalLength !== 0);\n            fov = Utils_1.MapViewUtils.calculateFovByFocalLength(this.m_focalLength, height);\n        }\n        this.m_camera.fov = this.limitFov(fov, this.m_camera.aspect);\n    }\n    /**\n     * Sets the focal length based on the supplied fov and the height of the canvas. This must be\n     * called at least once. This is necessary to be recalled when the [[FovCalculation]]'s type is\n     * fixed. In such cases, when the height changes, the focal length must be readjusted whereas\n     * the FOV stays the same. The opposite is true for the dynamic case, where the focal length is\n     * fixed but the FOV changes.\n     * @param height Height of the canvas in css / client pixels.\n     */\n    calculateFocalLength(height) {\n        harp_utils_1.assert(this.m_options.fovCalculation !== undefined);\n        this.m_focalLength = Utils_1.MapViewUtils.calculateFocalLengthByVerticalFov(harp_geoutils_1.MathUtils.degToRad(this.m_options.fovCalculation.fov), height);\n    }\n    /**\n     * Get canvas client size in css/client pixels.\n     *\n     * Supports canvases not attached to DOM, which have 0 as `clientWidth` and `clientHeight` by\n     * calculating it from actual canvas size and current pixel ratio.\n     */\n    getCanvasClientSize() {\n        const { clientWidth, clientHeight } = this.canvas;\n        if (clientWidth === 0 ||\n            clientHeight === 0 ||\n            typeof clientWidth !== \"number\" ||\n            typeof clientHeight !== \"number\") {\n            const pixelRatio = this.m_renderer.getPixelRatio();\n            return {\n                width: Math.round(this.canvas.width / pixelRatio),\n                height: Math.round(this.canvas.height / pixelRatio)\n            };\n        }\n        else {\n            return { width: clientWidth, height: clientHeight };\n        }\n    }\n}\nexports.MapView = MapView;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoBox_1 = require(\"../coordinates/GeoBox\");\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst Box3Like_1 = require(\"../math/Box3Like\");\nconst MathUtils_1 = require(\"../math/MathUtils\");\nconst OrientedBox3Like_1 = require(\"../math/OrientedBox3Like\");\nconst EarthConstants_1 = require(\"./EarthConstants\");\nconst Projection_1 = require(\"./Projection\");\nclass MercatorProjection {\n    constructor() {\n        this.type = Projection_1.ProjectionType.Planar;\n    }\n    static clamp(val, min, max) {\n        return Math.min(Math.max(min, val), max);\n    }\n    static latitudeClamp(latitude) {\n        return MercatorProjection.clamp(latitude, -MercatorProjection.MAXIMUM_LATITUDE, MercatorProjection.MAXIMUM_LATITUDE);\n    }\n    static latitudeProject(latitude) {\n        return Math.log(Math.tan(Math.PI * 0.25 + latitude * 0.5)) / Math.PI;\n    }\n    static latitudeClampProject(latitude) {\n        return MercatorProjection.latitudeProject(MercatorProjection.latitudeClamp(latitude));\n    }\n    static unprojectLatitude(y) {\n        return 2.0 * Math.atan(Math.exp(Math.PI * y)) - Math.PI * 0.5;\n    }\n    getScaleFactor(worldPoint) {\n        return Math.cosh(2 * Math.PI * (worldPoint.y / EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE - 0.5));\n    }\n    worldExtent(minAltitude, maxAltitude, result) {\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        result.min.x = 0;\n        result.min.y = 0;\n        result.min.z = minAltitude;\n        result.max.x = EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        result.max.y = EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        result.max.z = maxAltitude;\n        return result;\n    }\n    projectPoint(geoPointLike, result) {\n        let geoPoint;\n        if (geoPointLike instanceof GeoCoordinates_1.GeoCoordinates) {\n            geoPoint = geoPointLike;\n        }\n        else {\n            geoPoint = new GeoCoordinates_1.GeoCoordinates(geoPointLike.latitude, geoPointLike.longitude, geoPointLike.altitude);\n        }\n        if (!result) {\n            // tslint:disable-next-line:no-object-literal-type-assertion\n            result = { x: 0, y: 0, z: 0 };\n        }\n        result.x = ((geoPoint.longitude + 180) / 360) * EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        result.y =\n            (MercatorProjection.latitudeClampProject(geoPoint.latitudeInRadians) * 0.5 + 0.5) *\n                EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        result.z = geoPoint.altitude || 0;\n        return result;\n    }\n    unprojectPoint(worldPoint) {\n        const geoPoint = GeoCoordinates_1.GeoCoordinates.fromRadians(MercatorProjection.unprojectLatitude((worldPoint.y / EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE - 0.5) * 2.0), (worldPoint.x / EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE) * 2 * Math.PI - Math.PI, worldPoint.z);\n        return geoPoint;\n    }\n    projectBox(geoBox, result) {\n        const worldCenter = this.projectPoint(geoBox.center);\n        const worldNorth = (MercatorProjection.latitudeClampProject(geoBox.northEast.latitudeInRadians) * 0.5 +\n            0.5) *\n            EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        const worldSouth = (MercatorProjection.latitudeClampProject(geoBox.southWest.latitudeInRadians) * 0.5 +\n            0.5) *\n            EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        const worldYCenter = (worldNorth + worldSouth) * 0.5;\n        worldCenter.y = worldYCenter;\n        const latitudeSpan = worldNorth - worldSouth;\n        const longitudeSpan = (geoBox.longitudeSpan / 360) * EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        if (Box3Like_1.isBox3Like(result)) {\n            result.min.x = worldCenter.x - longitudeSpan * 0.5;\n            result.min.y = worldCenter.y - latitudeSpan * 0.5;\n            result.max.x = worldCenter.x + longitudeSpan * 0.5;\n            result.max.y = worldCenter.y + latitudeSpan * 0.5;\n            const altitudeSpan = geoBox.altitudeSpan;\n            if (altitudeSpan !== undefined) {\n                result.min.z = worldCenter.z - altitudeSpan * 0.5;\n                result.max.z = worldCenter.z + altitudeSpan * 0.5;\n            }\n            else {\n                result.min.z = 0;\n                result.max.z = 0;\n            }\n        }\n        else if (OrientedBox3Like_1.isOrientedBox3Like(result)) {\n            MathUtils_1.MathUtils.newVector3(1, 0, 0, result.xAxis);\n            MathUtils_1.MathUtils.newVector3(0, 1, 0, result.yAxis);\n            MathUtils_1.MathUtils.newVector3(0, 0, 1, result.zAxis);\n            result.position.x = worldCenter.x;\n            result.position.y = worldCenter.y;\n            result.position.z = worldCenter.z;\n            result.extents.x = longitudeSpan * 0.5;\n            result.extents.y = latitudeSpan * 0.5;\n            result.extents.z = Math.max(Number.EPSILON, (geoBox.altitudeSpan || 0) * 0.5);\n        }\n        else {\n            throw new Error(\"invalid bounding box\");\n        }\n        return result;\n    }\n    unprojectBox(worldBox) {\n        const minGeo = this.unprojectPoint(worldBox.min);\n        const maxGeo = this.unprojectPoint(worldBox.max);\n        const geoBox = GeoBox_1.GeoBox.fromCoordinates(minGeo, maxGeo);\n        return geoBox;\n    }\n    groundDistance(worldPoint) {\n        return worldPoint.z;\n    }\n    scalePointToSurface(worldPoint) {\n        worldPoint.z = 0;\n        return worldPoint;\n    }\n}\nMercatorProjection.MAXIMUM_LATITUDE = 1.4844222297453323;\nexports.MercatorProjection = MercatorProjection;\n/**\n * Mercator [[Projection]] used to convert geo coordinates to world coordinates and vice versa.\n */\nexports.mercatorProjection = new MercatorProjection();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass QuadTreeSubdivisionScheme {\n    getSubdivisionX() {\n        return 2;\n    }\n    getSubdivisionY() {\n        return 2;\n    }\n    getLevelDimensionX(level) {\n        // tslint:disable-next-line:no-bitwise\n        return 1 << level;\n    }\n    getLevelDimensionY(level) {\n        // tslint:disable-next-line:no-bitwise\n        return 1 << level;\n    }\n}\n/**\n * [[SubdivisionScheme]] representing a quadtree.\n */\nexports.quadTreeSubdivisionScheme = new QuadTreeSubdivisionScheme();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst UnicodeUtils_1 = require(\"../utils/UnicodeUtils\");\n/**\n * Structure containing all the required information necessary to render a BMFont glyph using\n * [[TextCanvas]].\n */\nclass GlyphData {\n    /**\n     * Creates a new `GlyphData` object.\n     *\n     * @param codePoint Unicode code point.\n     * @param block Unicode block.\n     * @param width Glyph' width.\n     * @param height Glyph' height.\n     * @param advanceX Amount of pixel to move after placing this glyph.\n     * @param offsetX Horizontal offset from the glyph' origin.\n     * @param offsetY Vertical offset from the glyph' origin.\n     * @param u0 Glyph' left texture coordinate.\n     * @param v0 Glyph' bottom texture coordinate.\n     * @param u1 Glyph' right texture coordinate.\n     * @param v1 Glyph' top texture coordinate.\n     * @param texture Glyph' source texture atlas page.\n     * @param font Glyph' font.\n     *\n     * @returns New `GlyphData`.\n     */\n    constructor(codePoint, block, width, height, advanceX, offsetX, offsetY, u0, v0, u1, v1, texture, font) {\n        this.codePoint = codePoint;\n        this.block = block;\n        this.width = width;\n        this.height = height;\n        this.advanceX = advanceX;\n        this.offsetX = offsetX;\n        this.offsetY = offsetY;\n        this.texture = texture;\n        this.font = font;\n        /**\n         * Array containing the positions for all corners of this glyph.\n         */\n        this.positions = [];\n        /**\n         * Array containing the source texture coordinates for all corners of this glyph.\n         * Used to sample the original texture atlas pages.\n         */\n        this.sourceTextureCoordinates = [];\n        /**\n         * Array containing the dynamic texture coordinates for all corners of this glyph.\n         * Used to sample the dynamic texture atlas page.\n         */\n        this.dynamicTextureCoordinates = [];\n        /**\n         * Source texture atlas' page copy index.\n         */\n        this.copyIndex = 0;\n        /**\n         * Flag indicating if glyph can be currently rendered.\n         */\n        this.isInCache = false;\n        this.character = String.fromCodePoint(codePoint);\n        this.direction = UnicodeUtils_1.UnicodeUtils.getDirection(codePoint, block);\n        const left = this.offsetX;\n        const right = left + this.width;\n        const top = font.metrics.lineHeight - this.offsetY;\n        const bottom = top - this.height;\n        this.positions.push(new THREE.Vector3(left, bottom, 1.0), new THREE.Vector3(right, bottom, 1.0), new THREE.Vector3(left, top, 1.0), new THREE.Vector3(right, top, 1.0));\n        this.sourceTextureCoordinates.push(new THREE.Vector2(u0, v0), new THREE.Vector2(u1, v0), new THREE.Vector2(u0, v1), new THREE.Vector2(u1, v1));\n        this.dynamicTextureCoordinates.push(new THREE.Vector2(0.0, 0.0), new THREE.Vector2(1.0, 0.0), new THREE.Vector2(0.0, 1.0), new THREE.Vector2(1.0, 1.0));\n    }\n    /**\n     * Clone this `GlyphData`.\n     *\n     * @returns Cloned `GlyphData`.\n     */\n    clone() {\n        return new GlyphData(this.codePoint, this.block, this.width, this.height, this.advanceX, this.offsetX, this.offsetY, this.sourceTextureCoordinates[0].x, this.sourceTextureCoordinates[0].y, this.sourceTextureCoordinates[3].x, this.sourceTextureCoordinates[3].y, this.texture, this.font);\n    }\n}\nexports.GlyphData = GlyphData;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/LRUCache\"));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst THREE = require(\"three\");\nexports.MAX_CAPACITY = 65536;\nexports.VERTEX_BUFFER_STRIDE = 16;\nexports.INDEX_BUFFER_STRIDE = 1;\nexports.VERTICES_PER_QUAD = 4;\nexports.INDICES_PER_QUAD = 6;\nexports.QUAD_VERTEX_MEMORY_FOOTPRINT = exports.VERTICES_PER_QUAD * exports.VERTEX_BUFFER_STRIDE;\nexports.QUAD_INDEX_MEMORY_FOOTPRINT = exports.INDICES_PER_QUAD * exports.INDEX_BUFFER_STRIDE;\n/**\n * Number of bytes for float in an Float32Array.\n */\nconst NUM_BYTES_PER_FLOAT = 4;\n/**\n * Number of bytes for integer number in an UInt32Array.\n */\nconst NUM_BYTES_PER_INT32 = 4;\n/**\n * Procedural geometry that holds vertex attribute data for all glyphs in a [[TextCanvas]].\n */\nclass TextGeometry {\n    /**\n     * Creates a new `TextGeometry`.\n     *\n     * @param material Material used to render foreground glyphs.\n     * @param backgroundMaterial Material used to render background glyphs.\n     * @param initialSize Initial amount of glyphs that can be stored.\n     * @param capacity Maximum glyph capacity.\n     *\n     * @returns New `TextGeometry`.\n     */\n    constructor(scene, material, backgroundMaterial, initialSize, capacity) {\n        this.scene = scene;\n        this.capacity = Math.min(capacity, exports.MAX_CAPACITY);\n        this.m_currentCapacity = Math.min(initialSize, capacity);\n        this.m_drawCount = 0;\n        this.m_updateOffset = 0;\n        this.m_pickingCount = 0;\n        this.m_vertexBuffer = new THREE.InterleavedBuffer(new Float32Array(this.m_currentCapacity * exports.QUAD_VERTEX_MEMORY_FOOTPRINT), exports.VERTEX_BUFFER_STRIDE);\n        this.m_vertexBuffer.setDynamic(true);\n        this.m_positionAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 0);\n        this.m_uvAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 4);\n        this.m_colorAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 8);\n        this.m_bgColorAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 12);\n        this.m_indexBuffer = new THREE.BufferAttribute(new Uint32Array(this.m_currentCapacity * exports.QUAD_INDEX_MEMORY_FOOTPRINT), exports.INDEX_BUFFER_STRIDE);\n        this.m_indexBuffer.setDynamic(true);\n        this.m_geometry = new THREE.BufferGeometry();\n        this.m_geometry.addAttribute(\"position\", this.m_positionAttribute);\n        this.m_geometry.addAttribute(\"uv\", this.m_uvAttribute);\n        this.m_geometry.addAttribute(\"color\", this.m_colorAttribute);\n        this.m_geometry.addAttribute(\"bgColor\", this.m_bgColorAttribute);\n        this.m_geometry.setIndex(this.m_indexBuffer);\n        this.m_pickingDataArray = new Array(this.m_currentCapacity);\n        this.m_mesh = new THREE.Mesh(this.m_geometry, material);\n        this.m_bgMesh = new THREE.Mesh(this.m_geometry, backgroundMaterial);\n        this.m_mesh.renderOrder = Number.MAX_SAFE_INTEGER;\n        this.m_bgMesh.renderOrder = Number.MAX_SAFE_INTEGER - 1;\n        this.scene.add(this.m_bgMesh, this.m_mesh);\n    }\n    /**\n     * Count of currently drawn glyphs.\n     */\n    get drawCount() {\n        return this.m_drawCount;\n    }\n    /**\n     * Mesh used to render foreground glyphs.\n     */\n    get mesh() {\n        return this.m_mesh;\n    }\n    /**\n     * Mesh used to render background glyphs.\n     */\n    get backgroundMesh() {\n        return this.m_bgMesh;\n    }\n    /**\n     * Release all allocated resources.\n     */\n    dispose() {\n        this.scene.remove(this.m_bgMesh, this.m_mesh);\n        this.m_geometry.dispose();\n    }\n    /**\n     * Clear the geometry.\n     */\n    clear() {\n        this.m_drawCount = 0;\n        this.m_updateOffset = 0;\n        this.m_pickingCount = 0;\n    }\n    /**\n     * Update the GPU resources to reflect the latest additions to the geometry.\n     */\n    update() {\n        if (this.drawCount > this.m_updateOffset) {\n            this.m_vertexBuffer.needsUpdate = true;\n            this.m_vertexBuffer.updateRange.offset =\n                this.m_updateOffset * exports.QUAD_VERTEX_MEMORY_FOOTPRINT;\n            this.m_vertexBuffer.updateRange.count =\n                (this.m_drawCount - this.m_updateOffset) * exports.QUAD_VERTEX_MEMORY_FOOTPRINT;\n            this.m_indexBuffer.needsUpdate = true;\n            this.m_indexBuffer.updateRange.offset =\n                this.m_updateOffset * exports.QUAD_INDEX_MEMORY_FOOTPRINT;\n            this.m_indexBuffer.updateRange.count =\n                (this.m_drawCount - this.m_updateOffset) * exports.QUAD_INDEX_MEMORY_FOOTPRINT;\n        }\n        this.m_updateOffset = this.m_drawCount;\n        this.m_geometry.setDrawRange(0, this.m_drawCount * exports.INDICES_PER_QUAD);\n    }\n    /**\n     * Add a new glyph to the `TextGeometry`.\n     *\n     * @param glyphData [[GlyphData]] holding the glyph description.\n     * @param corners Transformed glyph corners.\n     * @param weight Foreground glyph sampling weight.\n     * @param bgWeight Foreground glyph sampling weight.\n     * @param mirrored If `true`, UVs will be horizontally mirrored (needed for RTL punctuation).\n     * @param style Currently set [[TextRenderStyle]].\n     *\n     * @returns Result of the addition.\n     */\n    add(glyphData, corners, weight, bgWeight, mirrored, style) {\n        if (this.m_drawCount >= this.capacity) {\n            return false;\n        }\n        else if (this.m_drawCount >= this.m_currentCapacity) {\n            const newSize = Math.min(this.m_currentCapacity * 2, this.capacity);\n            this.resizeBuffers(newSize);\n        }\n        const baseVertex = this.m_drawCount * exports.VERTICES_PER_QUAD;\n        const baseIndex = this.m_drawCount * exports.INDICES_PER_QUAD;\n        for (let i = 0; i < exports.VERTICES_PER_QUAD; ++i) {\n            this.m_positionAttribute.setXYZW(baseVertex + i, corners[i].x, corners[i].y, corners[i].z, (mirrored ? -1.0 : 1.0) * style.rotation);\n            const mirroredUVIdx = mirrored ? ((i + 1) % 2) + Math.floor(i / 2) * 2 : i;\n            this.m_uvAttribute.setXYZW(baseVertex + i, glyphData.dynamicTextureCoordinates[mirroredUVIdx].x, glyphData.dynamicTextureCoordinates[mirroredUVIdx].y, weight, bgWeight);\n            this.m_colorAttribute.setXYZW(baseVertex + i, style.color.r, style.color.g, style.color.b, style.opacity);\n            this.m_bgColorAttribute.setXYZW(baseVertex + i, style.backgroundColor.r, style.backgroundColor.g, style.backgroundColor.b, style.backgroundOpacity);\n        }\n        this.m_indexBuffer.setX(baseIndex, baseVertex);\n        this.m_indexBuffer.setX(baseIndex + 1, baseVertex + 1);\n        this.m_indexBuffer.setX(baseIndex + 2, baseVertex + 2);\n        this.m_indexBuffer.setX(baseIndex + 3, baseVertex + 2);\n        this.m_indexBuffer.setX(baseIndex + 4, baseVertex + 1);\n        this.m_indexBuffer.setX(baseIndex + 5, baseVertex + 3);\n        ++this.m_drawCount;\n        return true;\n    }\n    /**\n     * Add a new glyph to a text buffer.\n     *\n     * @param buffer Target buffer where glyph attributes will be stored.\n     * @param offset Offset of the target buffer.\n     * @param glyphData [[GlyphData]] holding the glyph description.\n     * @param corners Transformed glyph corners.\n     * @param weight Foreground glyph sampling weight.\n     * @param bgWeight Foreground glyph sampling weight.\n     * @param mirrored If `true`, UVs will be mirrored (needed for RTL punctuation).\n     * @param style Currently set [[TextRenderStyle]].\n     */\n    addToBuffer(buffer, offset, glyphData, corners, weight, bgWeight, mirrored, style) {\n        for (let i = 0; i < exports.VERTICES_PER_QUAD; ++i) {\n            const vertexOffset = offset + exports.VERTEX_BUFFER_STRIDE * i;\n            buffer[vertexOffset] = corners[i].x;\n            buffer[vertexOffset + 1] = corners[i].y;\n            buffer[vertexOffset + 2] = corners[i].z;\n            buffer[vertexOffset + 3] = (mirrored ? -1.0 : 1.0) * style.rotation;\n            const mirroredUVIdx = mirrored ? ((i + 1) % 2) + Math.floor(i / 2) * 2 : i;\n            buffer[vertexOffset + 4] = glyphData.dynamicTextureCoordinates[mirroredUVIdx].x;\n            buffer[vertexOffset + 5] = glyphData.dynamicTextureCoordinates[mirroredUVIdx].y;\n            buffer[vertexOffset + 6] = weight;\n            buffer[vertexOffset + 7] = bgWeight;\n            buffer[vertexOffset + 8] = style.color.r;\n            buffer[vertexOffset + 9] = style.color.g;\n            buffer[vertexOffset + 10] = style.color.b;\n            buffer[vertexOffset + 11] = style.opacity;\n            buffer[vertexOffset + 12] = style.backgroundColor.r;\n            buffer[vertexOffset + 13] = style.backgroundColor.g;\n            buffer[vertexOffset + 14] = style.backgroundColor.b;\n            buffer[vertexOffset + 15] = style.backgroundOpacity;\n        }\n    }\n    /**\n     * Add a previously computed [[TextBufferObject]] to the `TextGeometry`. Extra parameters can\n     * be passed to override the passed attribute data.\n     *\n     * @param textBufferObject [[TextBufferObject]] containing computed glyphs.\n     * @param position Override position value.\n     * @param scale Override scale value.\n     * @param rotation Override rotation value.\n     * @param color Override color value.\n     * @param opacity Override opacity value.\n     * @param bgColor Override background color value.\n     * @param bgOpacity Override background opacity value.\n     *\n     * @returns Result of the addition.\n     */\n    addTextBufferObject(textBufferObject, position, scale, rotation, color, opacity, bgColor, bgOpacity) {\n        if (this.m_drawCount + textBufferObject.glyphs.length >= this.capacity) {\n            return false;\n        }\n        else if (this.m_drawCount + textBufferObject.glyphs.length >= this.m_currentCapacity) {\n            const newSize = Math.min(this.m_currentCapacity * 2, this.capacity);\n            this.resizeBuffers(newSize);\n        }\n        const s = scale || 1.0;\n        const r = rotation || 0.0;\n        const cosR = Math.cos(r);\n        const sinR = Math.sin(r);\n        const offsetX = position !== undefined ? position.x : 0.0;\n        const offsetY = position !== undefined ? position.y : 0.0;\n        const offsetZ = position !== undefined ? position.z : 0.0;\n        const buffer = textBufferObject.buffer;\n        const rot = buffer[3];\n        const rotSign = rot < 0 ? -1.0 : 1.0;\n        const red = color !== undefined ? color.r : buffer[8];\n        const green = color !== undefined ? color.g : buffer[9];\n        const blue = color !== undefined ? color.b : buffer[10];\n        const alpha = opacity !== undefined ? opacity : buffer[11];\n        const bgRed = bgColor !== undefined ? bgColor.r : buffer[12];\n        const bgGreen = bgColor !== undefined ? bgColor.g : buffer[13];\n        const bgBlue = bgColor !== undefined ? bgColor.b : buffer[14];\n        const bgAlpha = bgOpacity !== undefined ? bgOpacity : buffer[15];\n        const targetOffset = this.m_drawCount * exports.VERTICES_PER_QUAD;\n        for (let i = 0; i < textBufferObject.glyphs.length; ++i) {\n            const srcOffset = i * exports.QUAD_VERTEX_MEMORY_FOOTPRINT;\n            const glyph = textBufferObject.glyphs[i];\n            if (!glyph.isInCache) {\n                return false;\n            }\n            const mirrored = buffer[srcOffset + 4] > buffer[srcOffset + exports.VERTEX_BUFFER_STRIDE + 4];\n            const w = buffer[srcOffset + 6];\n            const bw = buffer[srcOffset + 7];\n            for (let j = 0; j < exports.VERTICES_PER_QUAD; ++j) {\n                const x = buffer[srcOffset + j * exports.VERTEX_BUFFER_STRIDE];\n                const y = buffer[srcOffset + j * exports.VERTEX_BUFFER_STRIDE + 1];\n                this.m_positionAttribute.setXYZW(targetOffset + i * exports.VERTICES_PER_QUAD + j, x * s * cosR + y * s * -sinR + offsetX, x * s * sinR + y * s * cosR + offsetY, buffer[srcOffset + j * exports.VERTEX_BUFFER_STRIDE + 2] + offsetZ, buffer[srcOffset + j * exports.VERTEX_BUFFER_STRIDE + 3] + rotSign * r);\n                const mirroredUVIdx = mirrored ? ((j + 1) % 2) + Math.floor(j / 2) * 2 : j;\n                this.m_uvAttribute.setXYZW(targetOffset + i * exports.VERTICES_PER_QUAD + j, glyph.dynamicTextureCoordinates[mirroredUVIdx].x, glyph.dynamicTextureCoordinates[mirroredUVIdx].y, w, (bw - w) / s + w);\n                this.m_colorAttribute.setXYZW(targetOffset + i * exports.VERTICES_PER_QUAD + j, red, green, blue, alpha);\n                this.m_bgColorAttribute.setXYZW(targetOffset + i * exports.VERTICES_PER_QUAD + j, bgRed, bgGreen, bgBlue, bgAlpha);\n            }\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD);\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD + 1, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD + 1);\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD + 2, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD + 2);\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD + 3, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD + 2);\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD + 4, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD + 1);\n            this.m_indexBuffer.setX((this.m_drawCount + i) * exports.INDICES_PER_QUAD + 5, (this.m_drawCount + i) * exports.VERTICES_PER_QUAD + 3);\n        }\n        this.m_drawCount += textBufferObject.glyphs.length;\n        return true;\n    }\n    /**\n     * Adds picking data for glyphs from the specified start until the last glyph added.\n     *\n     * @param startIdx First glyph index that this picking data is associated to.\n     * @param endIdx Last glyph index that this picking data is associated to.\n     * @param pickingData Picking data to be added.\n     */\n    addPickingData(startIdx, endIdx, pickingData) {\n        if (this.m_pickingCount >= this.m_currentCapacity) {\n            return false;\n        }\n        this.m_pickingDataArray[this.m_pickingCount] = {\n            start: Math.min(startIdx, this.capacity),\n            end: Math.min(endIdx, this.capacity),\n            data: pickingData\n        };\n        ++this.m_pickingCount;\n        return true;\n    }\n    /**\n     * Fill the picking results for the pixel with the given screen coordinate. If multiple glyphs\n     * are found, the order of the results is unspecified.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickCallback Callback to be called for every picked element.\n     */\n    pick(screenPosition, pickCallback) {\n        for (const pickingData of this.m_pickingDataArray) {\n            if (pickingData === undefined) {\n                return;\n            }\n            for (let i = pickingData.start; i < pickingData.end; ++i) {\n                const positionIndex = i * exports.VERTICES_PER_QUAD;\n                const minX = Math.min(this.m_positionAttribute.getX(positionIndex + 2), this.m_positionAttribute.getX(positionIndex + 1));\n                if (screenPosition.x < minX) {\n                    continue;\n                }\n                const maxX = Math.max(this.m_positionAttribute.getX(positionIndex + 2), this.m_positionAttribute.getX(positionIndex + 1));\n                if (screenPosition.x > maxX) {\n                    continue;\n                }\n                const minY = Math.min(this.m_positionAttribute.getY(positionIndex + 2), this.m_positionAttribute.getY(positionIndex + 1));\n                if (screenPosition.y < minY) {\n                    continue;\n                }\n                const maxY = Math.max(this.m_positionAttribute.getY(positionIndex + 2), this.m_positionAttribute.getY(positionIndex + 1));\n                if (screenPosition.y > maxY) {\n                    continue;\n                }\n                pickCallback(pickingData.data);\n                break;\n            }\n        }\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `TextGeometry`.\n     *\n     * @param info The info object to increment with the values from this `TextGeometry`.\n     */\n    updateMemoryUsage(info) {\n        const numBytes = this.m_vertexBuffer.count * NUM_BYTES_PER_FLOAT +\n            this.m_indexBuffer.count * NUM_BYTES_PER_INT32;\n        info.heapSize += numBytes;\n        info.gpuSize += numBytes;\n    }\n    resizeBuffers(size) {\n        this.m_currentCapacity = size;\n        const newVertexBuffer = new Float32Array(size * exports.QUAD_VERTEX_MEMORY_FOOTPRINT);\n        newVertexBuffer.set(this.m_vertexBuffer.array);\n        this.m_vertexBuffer = new THREE.InterleavedBuffer(newVertexBuffer, exports.VERTEX_BUFFER_STRIDE);\n        this.m_vertexBuffer.setDynamic(true);\n        this.m_positionAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 0);\n        this.m_uvAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 4);\n        this.m_colorAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 8);\n        this.m_bgColorAttribute = new THREE.InterleavedBufferAttribute(this.m_vertexBuffer, 4, 12);\n        const newIndexBuffer = new Uint32Array(size * exports.QUAD_INDEX_MEMORY_FOOTPRINT);\n        newIndexBuffer.set(this.m_indexBuffer.array);\n        this.m_indexBuffer = new THREE.BufferAttribute(newIndexBuffer, exports.INDEX_BUFFER_STRIDE);\n        this.m_indexBuffer.setDynamic(true);\n        this.m_geometry.dispose();\n        this.m_geometry = new THREE.BufferGeometry();\n        this.m_geometry.addAttribute(\"position\", this.m_positionAttribute);\n        this.m_geometry.addAttribute(\"uv\", this.m_uvAttribute);\n        this.m_geometry.addAttribute(\"color\", this.m_colorAttribute);\n        this.m_geometry.addAttribute(\"bgColor\", this.m_bgColorAttribute);\n        this.m_geometry.setIndex(this.m_indexBuffer);\n        this.m_pickingDataArray.length = this.m_currentCapacity;\n        this.scene.remove(this.m_bgMesh, this.m_mesh);\n        this.m_mesh = new THREE.Mesh(this.m_geometry, this.m_mesh.material);\n        this.m_bgMesh = new THREE.Mesh(this.m_geometry, this.m_bgMesh.material);\n        this.m_mesh.renderOrder = Number.MAX_SAFE_INTEGER;\n        this.m_bgMesh.renderOrder = Number.MAX_SAFE_INTEGER - 1;\n        this.scene.add(this.m_bgMesh, this.m_mesh);\n    }\n}\nexports.TextGeometry = TextGeometry;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst TextStyle_1 = require(\"../rendering/TextStyle\");\nconst UnicodeUtils_1 = require(\"../utils/UnicodeUtils\");\n/**\n * Collection of different constants and utility functions used by [[Typesetter]]s.\n */\nvar TypesettingUtils;\n(function (TypesettingUtils) {\n    /**\n     * Ratio between EMs and Pixels.\n     */\n    TypesettingUtils.EM_TO_PX = 16.0;\n    /**\n     * Ratio between Points and Pixels.\n     */\n    TypesettingUtils.PT_TO_PX = 1.25;\n    /**\n     * Angle used when emulating italic fonts (oblique).\n     */\n    TypesettingUtils.OBLIQUE_ANGLE = 0.174533;\n    /**\n     * Horizontal offset used when emulating italic fonts (oblique).\n     */\n    TypesettingUtils.OBLIQUE_OFFSET = Math.tan(TypesettingUtils.OBLIQUE_ANGLE);\n    /**\n     * Convert between any size specified in any [[FontUnit]] to pixels.\n     *\n     * @param size Font size (specified in `unit`).\n     * @param unit Size unit.\n     * @param originalSize Original size (pixels)\n     *\n     * @returns Pixel size.\n     */\n    function getPixelSize(size, unit, originalSize) {\n        let result = size;\n        switch (unit) {\n            case TextStyle_1.FontUnit.Em:\n                result *= TypesettingUtils.EM_TO_PX;\n                break;\n            case TextStyle_1.FontUnit.Point:\n                result *= TypesettingUtils.PT_TO_PX;\n                break;\n            case TextStyle_1.FontUnit.Percent:\n                result *= (1.0 / 100) * originalSize;\n                break;\n        }\n        return result;\n    }\n    TypesettingUtils.getPixelSize = getPixelSize;\n    /**\n     * Gets the scale applied to a certain character when using the [[FontVariant]].`SmallCaps`.\n     *\n     * @param glyphs Array containing [[TransformedGlyphData]].\n     * @param index Index to `glyphDataArray`.\n     * @param fontVariant Currently active [[FontVariant]].\n     *\n     * @returns Glyph `SmallCaps` scale.\n     */\n    function getSmallCapsScale(glyphs, smallCapsTransformations, index, fontVariant) {\n        const isSmallCaps = smallCapsTransformations[index] && fontVariant === TextStyle_1.FontVariant.SmallCaps;\n        return isSmallCaps\n            ? glyphs[index].font.metrics.xHeight / glyphs[index].font.metrics.capHeight\n            : 1.0;\n    }\n    TypesettingUtils.getSmallCapsScale = getSmallCapsScale;\n    /**\n     * Returns the first strong direction (LTR or RTL) found for a given array of [[GlyphData]].\n     *\n     * @param glyphs Array containing [[GlyphData]].\n     * @param offset `glyphDataArray` offset.\n     *\n     * @returns Strong direction.\n     */\n    function getDirection(glyphs, offset) {\n        let result = UnicodeUtils_1.UnicodeUtils.Direction.LTR;\n        let index = offset;\n        while (glyphs[index].direction !== UnicodeUtils_1.UnicodeUtils.Direction.LTR &&\n            glyphs[index].direction !== UnicodeUtils_1.UnicodeUtils.Direction.RTL &&\n            index < glyphs.length - 1) {\n            ++index;\n        }\n        if (Math.abs(glyphs[index].direction) === 1.0) {\n            result = glyphs[index].direction;\n        }\n        return result;\n    }\n    TypesettingUtils.getDirection = getDirection;\n    /**\n     * Computes the transformation matrix for a glyph.\n     *\n     * @param transform Matrix used to store the results.\n     * @param position Glyph' position.\n     * @param scale Glyph' scale.\n     * @param rotation [[TextCanvas]] rotation.\n     * @param localRotation Glyph' local rotation.\n     */\n    function computeGlyphTransform(transform, position, scale, rotation, localRotation) {\n        const cosAngle = Math.cos(rotation);\n        const sinAngle = Math.sin(rotation);\n        const localCosAngle = Math.cos(localRotation);\n        const localSinAngle = Math.sin(localRotation);\n        transform.set(scale * localCosAngle, scale * -localSinAngle, cosAngle * position.x - sinAngle * position.y, scale * localSinAngle, scale * localCosAngle, sinAngle * position.x + cosAngle * position.y, 0, 0, 1.0);\n    }\n    TypesettingUtils.computeGlyphTransform = computeGlyphTransform;\n    /**\n     * Updates the supplied bounds with the computed screen-space corners for a given glyph.\n     *\n     * @param corners Glyph' corners.\n     * @param globalBounds Global text bounds.\n     * @param individualBounds Individual per-character bounds.\n     */\n    function updateBounds(corners, globalBounds, individualBounds) {\n        const minX = Math.min(corners[0].x, corners[1].x, corners[2].x, corners[3].x);\n        const maxX = Math.max(corners[0].x, corners[1].x, corners[2].x, corners[3].x);\n        const minY = Math.min(corners[0].y, corners[1].y, corners[2].y, corners[3].y);\n        const maxY = Math.max(corners[0].y, corners[1].y, corners[2].y, corners[3].y);\n        if (individualBounds !== undefined) {\n            if (individualBounds.array[individualBounds.offset] !== undefined) {\n                individualBounds.array[individualBounds.offset].min.set(minX, minY);\n                individualBounds.array[individualBounds.offset].max.set(maxX, maxY);\n            }\n            else {\n                individualBounds.array.push(new THREE.Box2(new THREE.Vector2(minX, minY), new THREE.Vector2(maxX, maxY)));\n            }\n            ++individualBounds.offset;\n        }\n        globalBounds.min.set(Math.min(globalBounds.min.x, minX), Math.min(globalBounds.min.y, minY));\n        globalBounds.max.set(Math.max(globalBounds.max.x, maxX), Math.max(globalBounds.max.y, maxY));\n    }\n    TypesettingUtils.updateBounds = updateBounds;\n})(TypesettingUtils = exports.TypesettingUtils || (exports.TypesettingUtils = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * `MapViewPoints` is a class to extend for the `\"circles\"` and `\"squares\"` [[Technique]]s to\n * implement raycasting of [[THREE.Points]] as expected in [[MapView]], that is in screen space. It\n * copies the behaviour of the `raycast` method in [[THREE.Points]] and dispatches it to its\n * children classes, [[Circles]] and [[Squares]], who hold the intersection testing in the\n * `testPoint` method. This class also has the ability to dismiss the testing via the\n * `enableRayTesting` flag.\n *\n * Its main motivation is to handle the point styles of XYZ projects.\n *\n * @see https://github.com/mrdoob/three.js/blob/master/src/objects/Points.js\n */\nclass MapViewPoints extends THREE.Points {\n    constructor() {\n        super(...arguments);\n        /**\n         * This allows to discard the ray testing.\n         */\n        this.enableRayTesting = true;\n    }\n    /**\n     * This method is similar to the original method `raycast` in [[THREE.Points]] except that it\n     * then calls the tailored `testPoint` method in the children classes to test intersections\n     * depending on whether the points are circles or squares, which [[THREE.Points]] cannot do.\n     *\n     * @param raycaster The raycaster.\n     * @param intersects The array to fill with the results.\n     */\n    raycast(raycaster, intersects) {\n        if (!this.enableRayTesting) {\n            return;\n        }\n        const geometry = this.geometry;\n        const matrixWorld = this.matrixWorld;\n        const screenCoords = raycaster.ray.origin\n            .clone()\n            .add(raycaster.ray.direction)\n            .project(raycaster.mapView.camera);\n        const { clientWidth, clientHeight } = raycaster.mapView.canvas;\n        const mouseCoords = new THREE.Vector2(Math.ceil(((screenCoords.x + 1) / 2) * clientWidth), Math.ceil(((1 - screenCoords.y) / 2) * clientHeight));\n        if (geometry instanceof THREE.BufferGeometry) {\n            const point = new THREE.Vector3();\n            const index = geometry.index;\n            const attributes = geometry.attributes;\n            const positions = attributes.position.array;\n            if (index !== null) {\n                const indices = index.array;\n                for (let i = 0, il = indices.length; i < il; i++) {\n                    const a = indices[i];\n                    point.fromArray(positions, a * 3);\n                    const pointInfo = getPointInfo(point, matrixWorld, raycaster, clientWidth, clientHeight);\n                    if (pointInfo.pointIsOnScreen) {\n                        this.testPoint(point, pointInfo.absoluteScreenPosition, mouseCoords, i, pointInfo.distance, intersects);\n                    }\n                }\n            }\n            else {\n                for (let i = 0, l = positions.length / 3; i < l; i++) {\n                    point.fromArray(positions, i * 3);\n                    const pointInfo = getPointInfo(point, matrixWorld, raycaster, clientWidth, clientHeight);\n                    if (pointInfo.pointIsOnScreen) {\n                        this.testPoint(point, pointInfo.absoluteScreenPosition, mouseCoords, i, pointInfo.distance, intersects);\n                    }\n                }\n            }\n        }\n        else {\n            const vertices = geometry.vertices;\n            for (let index = 0; index < vertices.length; index++) {\n                const point = vertices[index];\n                const pointInfo = getPointInfo(point, matrixWorld, raycaster, clientWidth, clientHeight);\n                if (pointInfo.pointIsOnScreen) {\n                    this.testPoint(point, pointInfo.absoluteScreenPosition, mouseCoords, index, pointInfo.distance, intersects);\n                }\n            }\n        }\n    }\n}\nexports.MapViewPoints = MapViewPoints;\nfunction getPointInfo(point, matrixWorld, raycaster, width, height) {\n    const worldPosition = point.clone();\n    worldPosition.applyMatrix4(matrixWorld);\n    const distance = worldPosition.distanceTo(raycaster.ray.origin);\n    worldPosition.project(raycaster.mapView.camera);\n    const relativeScreenPosition = new THREE.Vector2(worldPosition.x, worldPosition.y);\n    const pointIsOnScreen = relativeScreenPosition.x < 1 &&\n        relativeScreenPosition.x > -1 &&\n        relativeScreenPosition.y < 1 &&\n        relativeScreenPosition.y > -1;\n    if (pointIsOnScreen) {\n        worldPosition.x = ((worldPosition.x + 1) / 2) * width;\n        worldPosition.y = ((1 - worldPosition.y) / 2) * height;\n        const absoluteScreenPosition = new THREE.Vector2(worldPosition.x, worldPosition.y);\n        return {\n            absoluteScreenPosition,\n            pointIsOnScreen,\n            distance\n        };\n    }\n    return {\n        pointIsOnScreen\n    };\n}\n/**\n * Point object that implements the raycasting of circles in screen space.\n */\nclass Circles extends MapViewPoints {\n    testPoint(point, screenPosition, pickCoordinates, index, distance, intersects) {\n        const dx = screenPosition.x - pickCoordinates.x;\n        const dy = screenPosition.y - pickCoordinates.y;\n        const dist = Math.sqrt(dx * dx + dy * dy);\n        const radius = this.material.size / 2;\n        if (dist <= radius) {\n            intersects.push({\n                point,\n                distance,\n                index,\n                object: this\n            });\n        }\n    }\n}\nexports.Circles = Circles;\n/**\n * Point object that implements the raycasting of squares in screen space.\n */\nclass Squares extends MapViewPoints {\n    testPoint(point, screenPosition, pickCoordinates, index, distance, intersects) {\n        const dx = screenPosition.x - pickCoordinates.x;\n        const dy = screenPosition.y - pickCoordinates.y;\n        const halfSize = this.material.size / 2;\n        if (Math.abs(dx) <= halfSize && Math.abs(dy) <= halfSize) {\n            intersects.push({\n                point,\n                distance,\n                index,\n                object: this\n            });\n        }\n    }\n}\nexports.Squares = Squares;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"Statistics\");\n/**\n * A simple ring buffer to store the last `n` values of the timer. The buffer works on\n * a First-In-First-Out (FIFO) basis.\n */\nclass RingBuffer {\n    /**\n     * Sets up the ring buffer.\n     *\n     * @param capacity The buffer's capacity.\n     */\n    constructor(capacity) {\n        this.capacity = capacity;\n        this.buffer = new Array(capacity);\n        this.capacity = capacity;\n        this.head = this.tail = this.size = 0;\n    }\n    /**\n     * Clears the contents, removes all elements.\n     */\n    clear() {\n        this.head = this.tail = this.size = 0;\n    }\n    /**\n     * Adds a single element to the ring buffer.\n     *\n     * @param data Data element.\n     */\n    enqOne(data) {\n        let next = this.head + 1;\n        if (next >= this.capacity) {\n            next = 0;\n        }\n        if (this.size < this.capacity) {\n            this.size++;\n        }\n        this.buffer[this.head] = data;\n        this.head = next;\n        if (this.size === this.capacity) {\n            this.tail = this.head;\n        }\n    }\n    /**\n     * Adds one or more elements.\n     *\n     * @param data The elements to add.\n     */\n    enq(...data) {\n        for (const v of data) {\n            this.enqOne(v);\n        }\n    }\n    /**\n     * Obtains the oldest element (FIFO). May throw an exception if a buffer underrun occurs.\n     * Before calling this method, make sure that `size > 0`.\n     */\n    deq() {\n        if (this.size === 0) {\n            throw new Error(\"Ringbuffer underrun\");\n        }\n        const data = this.buffer[this.tail];\n        let next = this.tail + 1;\n        if (next >= this.capacity) {\n            next = 0;\n        }\n        if (this.size > 0) {\n            this.size--;\n        }\n        this.tail = next;\n        return data;\n    }\n    /**\n     * Obtains the oldest element (FIFO) without removing it. Throws an exception if a buffer is\n     * empty. Before calling this method, make sure that `size > 0`.\n     */\n    get top() {\n        if (this.size === 0) {\n            throw new Error(\"Ringbuffer underrun\");\n        }\n        return this.buffer[this.tail];\n    }\n    /**\n     * Obtains the latest element (LIFO) without removing it. Throws an exception if a buffer is\n     * empty. Before calling this method, make sure that `size > 0`.\n     */\n    get bottom() {\n        if (this.size === 0) {\n            throw new Error(\"Ringbuffer underrun\");\n        }\n        let previous = this.head - 1;\n        if (previous < 0) {\n            previous = this.capacity - 1;\n        }\n        return this.buffer[previous];\n    }\n    /**\n     * Creates an iterator for the buffer.\n     */\n    iterator() {\n        return new RingBuffer.Iterator(this);\n    }\n    /**\n     * Returns a copy of the buffer, where the elements are properly sorted from oldest to newest.\n     */\n    asArray() {\n        const array = new Array();\n        for (let i = 0; i < this.size; i++) {\n            array.push(this.buffer[(this.tail + i) % this.capacity]);\n        }\n        return array;\n    }\n}\nexports.RingBuffer = RingBuffer;\n(function (RingBuffer) {\n    /**\n     * A local class for RingBuffer<T>\n     */\n    class Iterator {\n        /**\n         * Creates an iterator for the ring buffer.\n         *\n         * @param m_buffer `Ringbuffer` to iterate over.\n         * @param m_index Start index.\n         */\n        constructor(m_buffer, m_index = 0) {\n            this.m_buffer = m_buffer;\n            this.m_index = m_index;\n        }\n        /**\n         * Gets the iterator's current value. This function does not fail even if an overrun occurs.\n         * To detect an overrun, watch the result for [[next]].\n         */\n        get value() {\n            return this.m_buffer.buffer[(this.m_buffer.tail + this.m_index) % this.m_buffer.capacity];\n        }\n        /**\n         * Advances the iterator to the next element.\n         *\n         * @returns `true` if the iterator is still valid; `false` if an overrun occurs.\n         */\n        next() {\n            this.m_index++;\n            return this.m_index < this.m_buffer.size;\n        }\n    }\n    RingBuffer.Iterator = Iterator;\n})(RingBuffer = exports.RingBuffer || (exports.RingBuffer = {}));\n/**\n * A simple timer that stores only the latest measurement.\n */\nclass SimpleTimer {\n    constructor(statistics, name) {\n        this.statistics = statistics;\n        this.name = name;\n        /** `true` if timer has been started. */\n        this.running = false;\n    }\n    /**\n     * Gets the latest measurement. This function may return `undefined` if no measurement\n     * was done.\n     */\n    get value() {\n        return this.m_currentValue;\n    }\n    /**\n     * Sets the measurement value for the amount of time that has elapsed from start() to stop().\n     * Use this function to override the timer's duration.\n     *\n     * @param val The timer's duration.\n     */\n    setValue(val) {\n        this.m_currentValue = val;\n    }\n    /**\n     * Resets the value to be able to start again.\n     */\n    reset() {\n        this.m_currentValue = undefined;\n    }\n    /**\n     * Starts the timer. Returns the current time, based on `Performance.now()`.\n     */\n    start() {\n        if (!this.statistics.enabled) {\n            return -1;\n        }\n        if (this.running) {\n            throw new Error(\"Timer '\" + this.name + \"' is already running\");\n        }\n        this.running = true;\n        return (this.m_currentValue = harp_utils_1.PerformanceTimer.now());\n    }\n    /**\n     * Stops the timer. Requires that the timer has started.\n     */\n    stop() {\n        if (!this.statistics.enabled) {\n            return -1;\n        }\n        if (!this.running) {\n            throw new Error(\"Timer '\" + this.name + \"' has not been started\");\n        }\n        else {\n            // this.currentValue is a number now!\n            const t = harp_utils_1.PerformanceTimer.now() - (this.m_currentValue || 0);\n            this.m_currentValue = t;\n            this.setValue(t);\n            this.running = false;\n            return t;\n        }\n    }\n    /**\n     * Samples the timer. Requires that the timer has started.\n     *\n     * @returns the current timer value; `-1` if statistics are disabled.\n     */\n    now() {\n        if (!this.statistics.enabled) {\n            return -1;\n        }\n        if (!this.running) {\n            throw new Error(\"Timer '\" + this.name + \"' has not been started\");\n        }\n        else {\n            const t = harp_utils_1.PerformanceTimer.now() - (this.m_currentValue || 0);\n            return t;\n        }\n    }\n}\nexports.SimpleTimer = SimpleTimer;\n/**\n * A timer that stores the last `n` samples in a ring buffer.\n */\nclass SampledTimer extends SimpleTimer {\n    /**\n     * Creates a `SampledTimer` instance. Must still be added to statistics if it should be logged!\n     *\n     * @param statistics Statistics to use for management.\n     * @param name Name of the timer. Use colons to build a hierarchy.\n     */\n    constructor(statistics, name) {\n        super(statistics, name);\n        this.statistics = statistics;\n        this.name = name;\n        /**\n         * The number of times the timer has reset.\n         */\n        this.numResets = 0;\n        /**\n         * Maximum samples until the statistics are reset and updated, which may destroy a median\n         * computation.\n         */\n        this.maxNumSamples = 1000;\n        /**\n         * The array of sampled values, its length cannot exceed `maxNumSamples`.\n         */\n        this.samples = new RingBuffer(this.maxNumSamples);\n    }\n    /**\n     * Resets the timer and clears all of its historical values.\n     */\n    reset() {\n        super.reset();\n        this.getStats();\n        this.samples.clear();\n        this.numResets++;\n    }\n    /**\n     * Add a single measurement to the sample.\n     *\n     * @param val A measurement to add.\n     */\n    setValue(val) {\n        super.setValue(val);\n        if (val !== undefined) {\n            this.samples.enqOne(val);\n        }\n    }\n    /**\n     * Updates the `min`, `max`, `avg`, and `median` values. Currently, this function is expensive,\n     * as it requires a copy of the sampled values.\n     */\n    getStats() {\n        return computeArrayStats(this.samples.asArray());\n    }\n}\nexports.SampledTimer = SampledTimer;\n/**\n * Only exported for testing\n * @ignore\n *\n * Compute the [[ArrayStats]] for the passed in array of numbers.\n *\n * @param {number[]} samples Array containing sampled values. Will be modified (!) by sorting the\n *      entries.\n * @returns {(Stats | undefined)}\n */\nfunction computeArrayStats(samples) {\n    if (samples.length === 0) {\n        return undefined;\n    }\n    samples.sort((a, b) => {\n        return a - b;\n    });\n    const min = samples[0];\n    const max = samples[samples.length - 1];\n    let median;\n    let median90;\n    let median95;\n    let median97;\n    let median99;\n    let median999;\n    if (samples.length === 1) {\n        median90 = median95 = median97 = median99 = median999 = median = samples[0];\n    }\n    else if (samples.length === 2) {\n        median = samples[0] * 0.5 + samples[1] * 0.5;\n        median90 = median95 = median97 = median99 = median999 = samples[1];\n    }\n    else {\n        const mid = Math.floor(samples.length / 2);\n        median =\n            samples.length % 2 === 0 ? samples[mid - 1] * 0.5 + samples[mid] * 0.5 : samples[mid];\n        const mid90 = Math.round(samples.length * 0.9) - 1;\n        median90 = samples[mid90];\n        const mid95 = Math.round(samples.length * 0.95) - 1;\n        median95 = samples[mid95];\n        const mid97 = Math.round(samples.length * 0.97) - 1;\n        median97 = samples[mid97];\n        const mid99 = Math.round(samples.length * 0.99) - 1;\n        median99 = samples[mid99];\n        const mid999 = Math.round(samples.length * 0.999) - 1;\n        median999 = samples[mid999];\n    }\n    let sum = 0;\n    for (let i = 0, l = samples.length; i < l; i++) {\n        sum += samples[i];\n    }\n    const avg = sum / samples.length;\n    return {\n        min,\n        max,\n        avg,\n        median,\n        median90,\n        median95,\n        median97,\n        median99,\n        median999,\n        numSamples: samples.length\n    };\n}\nexports.computeArrayStats = computeArrayStats;\n/**\n * Measures a sequence of connected events, such as multiple processing stages in a function.\n * Each stage is identified with a timer name, that must be a valid timer in the statistics\n * object. Additionally, all timers within a `MultiStageTimer` must be unique.\n *\n * Internally, the `MultiStageTimer` manages a list of timers where at the end of each stage,\n * one timer stops and the next timer starts.\n */\nclass MultiStageTimer {\n    /**\n     * Defines the `MultiStageTimer` with a list of timer names that represent its stages.\n     *\n     * @param statistics The statistics object that manages the timers.\n     * @param name Name of this `MultiStageTimer`.\n     * @param stages List of timer names.\n     */\n    constructor(statistics, name, stages) {\n        this.statistics = statistics;\n        this.name = name;\n        this.stages = stages;\n        if (stages.length < 1) {\n            throw new Error(\"MultiStageTimer needs stages\");\n        }\n        stages.forEach(stage => {\n            if (!statistics.hasTimer(stage)) {\n                throw new Error(\"Unknown timer: \" + stage);\n            }\n        });\n    }\n    /**\n     * Gets the timer value for the last stage. If the `MultiStageTimer` did not finish its\n     * last stage, the value is `undefined`.\n     */\n    get value() {\n        return this.statistics.getTimer(this.stages[this.stages.length - 1]).value;\n    }\n    /**\n     * Resets the timers across all stages.\n     */\n    reset() {\n        if (!this.statistics.enabled) {\n            return;\n        }\n        this.stages.forEach(stage => {\n            this.statistics.getTimer(stage).reset();\n        });\n    }\n    /**\n     * Starts the `MultiStageTimer` at its first stage.\n     */\n    start() {\n        this.stage = this.stages[0];\n        return this.statistics.getTimer(this.stages[0]).value || -1;\n    }\n    /**\n     * Stops the `MultiStageTimer`. Returns the measurement of the last stage, which may be\n     * `undefined` if not all stages started.\n     */\n    stop() {\n        this.stage = undefined;\n        return this.value !== undefined ? this.value : -1;\n    }\n    /**\n     * Gets the current stage.\n     */\n    get stage() {\n        return this.currentStage;\n    }\n    /**\n     * Sets the current stage. If a new stage is provided, the current timer (if available) is\n     * stopped, and the next timer is started. If the timer in the next stage is `undefined`,\n     * this is equivalent to calling `stop` on the `MultiStageTimer`.\n     *\n     * @param stage The next stage to start.\n     */\n    set stage(stage) {\n        if (this.currentStage === stage) {\n            return;\n        }\n        if (this.statistics.enabled && this.currentStage !== undefined) {\n            this.statistics.getTimer(this.currentStage).stop();\n        }\n        this.currentStage = stage;\n        if (this.statistics.enabled && this.currentStage !== undefined) {\n            this.statistics.getTimer(this.currentStage).start();\n        }\n    }\n}\nexports.MultiStageTimer = MultiStageTimer;\n/**\n * Manages a set of timers. The main objective of `Statistics` is to log these timers. You can\n * disable statistics to minimize their impact on performance.\n */\nclass Statistics {\n    /**\n     * Sets up a group of timers.\n     *\n     * @param name The statistics name, for logging purposes.\n     * @param enabled If `false`, the timers do not measure the performance.\n     */\n    constructor(name, enabled = false) {\n        this.name = name;\n        this.enabled = enabled;\n        this.timers = new Map();\n        this.nullTimer = new SimpleTimer(this, \"<null>\");\n    }\n    /**\n     * Adds a timer, based on the name specified.\n     *\n     * @param name The timer's name; must be unique.\n     */\n    createTimer(name, keepSamples = true) {\n        const timer = keepSamples ? new SampledTimer(this, name) : new SimpleTimer(this, name);\n        return this.addTimer(timer);\n    }\n    /**\n     * Adds the timer specified.\n     *\n     * @param timer The timer's name, which must be unique within this statistics object.\n     */\n    addTimer(timer) {\n        if (this.timers.get(timer.name) !== undefined) {\n            throw new Error(\"Duplicate timer name: '\" + timer.name + \"'\");\n        }\n        this.timers.set(timer.name, timer);\n        return timer;\n    }\n    /**\n     * Gets a timer by name.\n     *\n     * @param name The timer's name.\n     */\n    getTimer(name) {\n        if (!this.enabled) {\n            return this.nullTimer;\n        }\n        const t = this.timers.get(name);\n        return t === undefined ? this.nullTimer : t;\n    }\n    /**\n     * Checks if a timer with the specified name already exists.\n     *\n     * @param name The timer's name.\n     * @returns `true` if a timer with `name` already exists; `false` otherwise.\n     */\n    hasTimer(name) {\n        const t = this.timers.get(name);\n        return t !== undefined;\n    }\n    /**\n     * Resets all timers.\n     */\n    reset() {\n        this.timers.forEach((timer) => {\n            timer.reset();\n        });\n    }\n    /**\n     * Prints all values to the console.\n     *\n     * @param header Optional header line.\n     * @param footer Optional footer line.\n     */\n    log(header, footer) {\n        if (header !== undefined || this.name !== undefined) {\n            logger.log(header !== undefined ? header : this.name);\n        }\n        let maxNameLength = 0;\n        this.timers.forEach((timer) => {\n            maxNameLength = Math.max(maxNameLength, timer.name.length);\n        });\n        // simple printing function for number limits the number of decimal points.\n        const print = (v) => {\n            return v !== undefined ? v.toFixed(5) : \"?\";\n        };\n        this.timers.forEach((timer) => {\n            let s = timer.name + \": \" + \" \".repeat(maxNameLength - timer.name.length);\n            s += print(timer.value);\n            // sampled timers also update their stats and log them\n            if (timer instanceof SampledTimer) {\n                const simpleStats = timer.getStats();\n                if (simpleStats !== undefined) {\n                    s +=\n                        `  [ min=${print(simpleStats.min)}, max=${print(simpleStats.max)}, ` +\n                            `avg=${print(simpleStats.avg)}, med=${print(simpleStats.median)}, ` +\n                            `med95=${print(simpleStats.median95)}, med99=${print(simpleStats.median99)}, ` +\n                            `N=${print(simpleStats.numSamples)} ]`;\n                }\n            }\n            logger.log(s);\n        });\n        if (footer !== undefined) {\n            logger.log(footer);\n        }\n    }\n}\nexports.Statistics = Statistics;\n/**\n * Class containing all counters, timers and events of the current frame.\n */\nclass FrameStats {\n    constructor() {\n        this.entries = new Map();\n        this.messages = undefined;\n    }\n    /**\n     * Retrieve the value of the performance number.\n     *\n     * @param name Name of the performance number.\n     * @returns The value of the performance number or `undefined` if it has not been declared by\n     *      `setValue` before.\n     */\n    getValue(name) {\n        return this.entries.get(name);\n    }\n    /**\n     * Set the value of the performance number.\n     *\n     * @param name Name of the performance number.\n     * @param name New value of the performance number.\n     */\n    setValue(name, value) {\n        this.entries.set(name, value);\n    }\n    /**\n     * Add a value to the current value of the performance number. If the performance is not known,\n     * it will be initialized with `value`.\n     *\n     * @param name Name of the performance number.\n     * @param name Value to be added to the performance number.\n     */\n    addValue(name, value) {\n        const oldValue = this.entries.get(name);\n        this.entries.set(name, value + (oldValue === undefined ? 0 : oldValue));\n    }\n    /**\n     * Add a text message to the frame, like \"Font XYZ has been loaded\"\n     *\n     * @param message The message to add.\n     */\n    addMessage(message) {\n        if (this.messages === undefined) {\n            this.messages = [];\n        }\n        this.messages.push(message);\n    }\n    /**\n     * Reset all known performance values to `0` and the messages to `undefined`.\n     */\n    reset() {\n        this.entries.forEach((value, name) => {\n            this.entries.set(name, 0);\n        });\n        this.messages = undefined;\n    }\n}\nexports.FrameStats = FrameStats;\n/**\n * @ignore\n * Only exported for testing.\n *\n * Instead of passing around an array of objects, we store the frame statistics as an object of\n * arrays. This allows convenient computations from [[RingBuffer]],\n */\nclass FrameStatsArray {\n    constructor(capacity = 0) {\n        this.capacity = capacity;\n        this.frameEntries = new Map();\n        this.messages = new RingBuffer(capacity);\n    }\n    get length() {\n        return this.messages.size;\n    }\n    reset() {\n        this.frameEntries.forEach((buffer, name) => {\n            buffer.clear();\n        });\n        this.messages.clear();\n    }\n    addFrame(frameStats) {\n        const currentSize = this.length;\n        const frameEntries = this.frameEntries;\n        frameStats.entries.forEach((value, name) => {\n            let buffer = frameEntries.get(name);\n            if (buffer === undefined) {\n                // If there is a buffer that has not been known before, add it to the known buffers,\n                // fill it up with with 0 to the size of all the other buffers to make them of equal\n                // size to make PerfViz happy.\n                buffer = new RingBuffer(this.capacity);\n                for (let i = 0; i < currentSize; i++) {\n                    buffer.enqOne(0);\n                }\n                this.frameEntries.set(name, buffer);\n            }\n            buffer.enqOne(value);\n        });\n        this.messages.enq(frameStats.messages);\n    }\n    /**\n     * Prints all values to the console.\n     */\n    log() {\n        let maxNameLength = 0;\n        this.frameEntries.forEach((buffer, name) => {\n            maxNameLength = Math.max(maxNameLength, name.length);\n        });\n        // simple printing function for number limits the number of decimal points.\n        const print = (v) => {\n            return v !== undefined ? v.toFixed(5) : \"?\";\n        };\n        this.frameEntries.forEach((buffer, name) => {\n            let s = name + \": \" + \" \".repeat(maxNameLength - name.length);\n            const simpleStats = computeArrayStats(buffer.asArray());\n            if (simpleStats !== undefined) {\n                s +=\n                    `  [ min=${print(simpleStats.min)}, max=${print(simpleStats.max)}, ` +\n                        `avg=${print(simpleStats.avg)}, med=${print(simpleStats.median)}, ` +\n                        `med95=${print(simpleStats.median95)}, med99=${print(simpleStats.median99)}, ` +\n                        `N=${print(simpleStats.numSamples)} ]`;\n            }\n            logger.log(s);\n        });\n    }\n}\nexports.FrameStatsArray = FrameStatsArray;\n/**\n * Performance measurement central. Maintains the current [[FrameStats]], which holds all individual\n * performance numbers.\n *\n * Implemented as an instance for easy access.\n */\nclass PerformanceStatistics {\n    /**\n     * Creates an instance of PerformanceStatistics. Overrides the current `instance`.\n     *\n     * @param {boolean} [enabled=true] If `false` the performance values will not be stored.\n     * @param {number} [maxNumFrames=1000] The maximum number of frames that are to be stored.\n     * @memberof PerformanceStatistics\n     */\n    constructor(enabled = true, maxNumFrames = 1000) {\n        this.enabled = enabled;\n        this.maxNumFrames = maxNumFrames;\n        /**\n         * Current frame statistics. Contains all values for the current frame. Will be cleared when\n         * [[PerformanceStatistics#storeFrameInfo]] is called.\n         *\n         * @type {FrameStats}\n         * @memberof PerformanceStatistics\n         */\n        this.currentFrame = new FrameStats();\n        /**\n         * Additional results stored for the current application run, not per frame. Only the last value\n         * is stored.\n         *\n         * @type {(Map<string, number>)}\n         */\n        this.appResults = new Map();\n        /**\n         * Additional configuration values stored for the current application run, not per frame. Only\n         * the last value is stored.\n         *\n         * @type {(Map<string, string>)}\n         * @memberof PerformanceStatistics\n         */\n        this.configs = new Map();\n        PerformanceStatistics.m_instance = this;\n        this.m_frameEvents = new FrameStatsArray(maxNumFrames);\n    }\n    /**\n     * Returns `true` when the maximum number of storable frames is reached.\n     *\n     * @readonly\n     * @type {boolean}\n     * @memberof PerformanceStatistics\n     */\n    get isFull() {\n        return this.m_frameEvents.length >= this.maxNumFrames;\n    }\n    /**\n     * Global instance to the instance. The current instance can be overridden by creating a new\n     * `PerformanceStatistics`.\n     */\n    static get instance() {\n        if (PerformanceStatistics.m_instance === undefined) {\n            PerformanceStatistics.m_instance = new PerformanceStatistics(false, 0);\n        }\n        return PerformanceStatistics.m_instance;\n    }\n    /**\n     * @ignore\n     * Only exported for testing.\n     *\n     * Return the array of frame events.\n     */\n    get frameEvents() {\n        return this.m_frameEvents;\n    }\n    /**\n     * Clears all settings, all stored frame events as well as the current frame values.\n     *\n     * @memberof PerformanceStatistics\n     */\n    clear() {\n        this.clearFrames();\n        this.configs.clear();\n        this.appResults.clear();\n    }\n    /**\n     * Clears only all stored frame events as well as the current frame values.\n     *\n     * @memberof PerformanceStatistics\n     */\n    clearFrames() {\n        this.m_frameEvents.reset();\n        this.currentFrame.reset();\n    }\n    /**\n     * Stores the current frame events into the array of events. Uses [[THREE.WebGLInfo]] to add the\n     * render state information to the current frame.\n     *\n     * @param {THREE.WebGLInfo} webGlInfo\n     * @returns {boolean} Returns `false` if the maximum number of storable frames has been reached.\n     * @memberof PerformanceStatistics\n     */\n    storeFrameInfo(webGlInfo) {\n        if (this.m_frameEvents.length >= this.maxNumFrames) {\n            return false;\n        }\n        if (webGlInfo !== undefined) {\n            this.currentFrame.setValue(\"gl.numCalls\", webGlInfo.render.calls);\n            this.currentFrame.setValue(\"gl.numGeometries\", webGlInfo.memory.geometries);\n            this.currentFrame.setValue(\"gl.numLines\", webGlInfo.render.lines);\n            this.currentFrame.setValue(\"gl.numPoints\", webGlInfo.render.points);\n            this.currentFrame.setValue(\"gl.numPrograms\", webGlInfo.programs === null ? 0 : webGlInfo.programs.length);\n            this.currentFrame.setValue(\"gl.numTextures\", webGlInfo.memory.textures);\n            this.currentFrame.setValue(\"gl.numTriangles\", webGlInfo.render.triangles);\n        }\n        if (window !== undefined && window.performance !== undefined) {\n            const memory = window.performance.memory;\n            if (memory !== undefined) {\n                this.currentFrame.setValue(\"memory.totalJSHeapSize\", memory.totalJSHeapSize);\n                this.currentFrame.setValue(\"memory.usedJSHeapSize\", memory.usedJSHeapSize);\n                this.currentFrame.setValue(\"memory.jsHeapSizeLimit\", memory.jsHeapSizeLimit);\n            }\n        }\n        this.m_frameEvents.addFrame(this.currentFrame);\n        this.currentFrame.reset();\n        return true;\n    }\n    /**\n     * Logs all values to the logger.\n     *\n     * @param header Optional header line.\n     * @param footer Optional footer line.\n     */\n    log(header, footer) {\n        logger.log(header !== undefined ? header : \"PerformanceStatistics\");\n        const appResults = this.appResults;\n        appResults.forEach((value, name) => {\n            logger.log(name, value);\n        });\n        const configs = this.configs;\n        configs.forEach((value, name) => {\n            logger.log(name, value);\n        });\n        this.m_frameEvents.log();\n        if (footer !== undefined) {\n            logger.log(footer);\n        }\n    }\n    /**\n     * Convert to a plain object that can be serialized. Required to copy the test results over to\n     * nightwatch.\n     */\n    getAsPlainObject() {\n        const appResults = {};\n        const configs = {};\n        const frames = {};\n        const plainObject = {\n            configs,\n            appResults,\n            frames\n        };\n        const appResultValues = this.appResults;\n        appResultValues.forEach((value, name) => {\n            appResults[name] = value;\n        });\n        const configValues = this.configs;\n        configValues.forEach((value, name) => {\n            configs[name] = value;\n        });\n        for (const [name, buffer] of this.m_frameEvents.frameEntries) {\n            frames[name] = buffer.asArray();\n        }\n        plainObject.messages = this.m_frameEvents.messages.asArray();\n        return plainObject;\n    }\n    /**\n     * Convert the last frame values to a plain object that can be serialized. Required to copy the\n     * test results over to nightwatch.\n     */\n    getLastFrameStatistics() {\n        const appResults = {};\n        const configs = {};\n        const frames = {};\n        const plainObject = {\n            configs,\n            appResults,\n            frames\n        };\n        const appResultValues = this.appResults;\n        appResultValues.forEach((value, name) => {\n            appResults[name] = value;\n        });\n        const configValues = this.configs;\n        configValues.forEach((value, name) => {\n            configs[name] = value;\n        });\n        for (const [name, buffer] of this.m_frameEvents.frameEntries) {\n            frames[name] = buffer.bottom;\n        }\n        plainObject.messages = this.m_frameEvents.messages.asArray();\n        return plainObject;\n    }\n}\nPerformanceStatistics.m_instance = undefined;\nexports.PerformanceStatistics = PerformanceStatistics;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The base class to extend for further passes in [[MapView]], like the [[MSAARenderPass]], possibly\n * a text pass, an AO effect etc. `Pass` provides the core logic for both :\n * - render passes (proper scene renders),\n * - and shader passes (quad renders, i.e. effects added on top of the render output as a\n * postprocess).\n *\n * Even some shader passes still actually fall within the render pass category as they need to\n * re-render the scene to then deduce an effect, such as masking, AO, DoF etc. Others just need the\n * previous input image to apply a shader on top of it, as for bloom or NVIDIA's FXAA for example.\n * These only are proper shader passes.\n */\nclass Pass {\n    constructor() {\n        this.enabled = false;\n        this.renderToScreen = false;\n        // tslint:enable:no-unused-variable\n    }\n    // tslint:disable-next-line:no-unused-variable\n    setSize(width, height) {\n        // Implemented in sub-classes.\n    }\n    // tslint:disable:no-unused-variable\n    render(renderer, scene, camera, writeBuffer, readBuffer, delta) {\n        // Implemented in sub-classes.\n    }\n}\nexports.Pass = Pass;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nvar CopyrightInfo;\n(function (CopyrightInfo) {\n    /**\n     * Merge [[CopyrightInfo]] arrays, removing duplicates.\n     *\n     * `id` and `label` are considered keys in deduplication algorithm.\n     *\n     * @param sources non-duplicate elements from this array are added to `target`\n     * @returns merge of all copyright infos in `sources`\n     */\n    function mergeArrays(a, b) {\n        const result = [];\n        for (const source of [a, b]) {\n            if (source === undefined) {\n                continue;\n            }\n            for (const sourceInfo of source) {\n                const existingInfo = result.find(findItem => findItem.id === sourceInfo.id ||\n                    (findItem.label !== undefined && findItem.label === sourceInfo.label));\n                if (existingInfo === undefined) {\n                    result.push(Object.assign({}, sourceInfo));\n                }\n                else {\n                    existingInfo.year = harp_utils_1.MathUtils.max2(sourceInfo.year, existingInfo.year);\n                    existingInfo.label = harp_utils_1.getOptionValue(sourceInfo.label, existingInfo.label);\n                    existingInfo.link = harp_utils_1.getOptionValue(sourceInfo.link, existingInfo.link);\n                }\n            }\n        }\n        return result;\n    }\n    CopyrightInfo.mergeArrays = mergeArrays;\n    /**\n     * Format copyright information to a HTML string that can be displayed in the UI.\n     *\n     * * Empty list returns empty string.\n     * * Entries with empty (but defined) labels are skipped.\n     */\n    function formatAsHtml(copyrightInfo) {\n        if (copyrightInfo.length === 0) {\n            return \"\";\n        }\n        const filtered = copyrightInfo.filter(entry => entry.label !== \"\");\n        if (filtered.length === 0) {\n            return \"\";\n        }\n        return (\" \" +\n            filtered\n                .map(entry => {\n                const label = entry.label !== undefined ? entry.label : entry.id;\n                const text = entry.year !== undefined ? `${entry.year} ${label}` : label;\n                return entry.link ? `<a href=\"${entry.link}\">${text}</a>` : `${text}`;\n            })\n                .join(\", \"));\n    }\n    CopyrightInfo.formatAsHtml = formatAsHtml;\n})(CopyrightInfo = exports.CopyrightInfo || (exports.CopyrightInfo = {}));\n","'use strict';\nfunction Rectangle(x, y, w, h) { // new Rectangle(bounds) or new Rectangle(x, y, w, h)\n  if (!(this instanceof Rectangle)) {\n    return new Rectangle(x, y, w, h);\n  }\n  var x2, y2, p;\n\n  if (x.x) {\n    w = x.w;\n    h = x.h;\n    y = x.y;\n    if (x.w !== 0 && !x.w && x.x2) {\n      w = x.x2 - x.x;\n      h = x.y2 - x.y;\n    }\n    else {\n      w = x.w;\n      h = x.h;\n    }\n    x = x.x;\n    // For extra fastitude\n    x2 = x + w;\n    y2 = y + h;\n    p = (h + w) ? false : true;\n  }\n  else {\n    // For extra fastitude\n    x2 = x + w;\n    y2 = y + h;\n    p = (h + w) ? false : true;\n  }\n\n  this.x1 = this.x = function () {\n    return x;\n  };\n  this.y1 = this.y = function () {\n    return y;\n  };\n  this.x2 = function () {\n    return x2;\n  };\n  this.y2 = function () {\n    return y2;\n  };\n  this.w = function () {\n    return w;\n  };\n  this.h = function () {\n    return h;\n  };\n  this.p = function () {\n    return p;\n  };\n\n  this.overlap = function (a) {\n    if (p || a.p()) {\n      return x <= a.x2() && x2 >= a.x() && y <= a.y2() && y2 >= a.y();\n    }\n    return x < a.x2() && x2 > a.x() && y < a.y2() && y2 > a.y();\n  };\n\n  this.expand = function (a) {\n    var nx, ny;\n    var ax = a.x();\n    var ay = a.y();\n    var ax2 = a.x2();\n    var ay2 = a.y2();\n    if (x > ax) {\n      nx = ax;\n    }\n    else {\n      nx = x;\n    }\n    if (y > ay) {\n      ny = ay;\n    }\n    else {\n      ny = y;\n    }\n    if (x2 > ax2) {\n      w = x2 - nx;\n    }\n    else {\n      w = ax2 - nx;\n    }\n    if (y2 > ay2) {\n      h = y2 - ny;\n    }\n    else {\n      h = ay2 - ny;\n    }\n    x = nx;\n    y = ny;\n    return this;\n  };\n\n  //End of RTree.Rectangle\n}\n\n\n/* returns true if rectangle 1 overlaps rectangle 2\n * [ boolean ] = overlapRectangle(rectangle a, rectangle b)\n * @static function\n */\nRectangle.overlapRectangle = function (a, b) {\n  //if(!((a.h||a.w)&&(b.h||b.w))){ not faster resist the urge!\n  if ((a.h === 0 && a.w === 0) || (b.h === 0 && b.w === 0)) {\n    return a.x <= (b.x + b.w) && (a.x + a.w) >= b.x && a.y <= (b.y + b.h) && (a.y + a.h) >= b.y;\n  }\n  else {\n    return a.x < (b.x + b.w) && (a.x + a.w) > b.x && a.y < (b.y + b.h) && (a.y + a.h) > b.y;\n  }\n};\n\n/* returns true if rectangle a is contained in rectangle b\n * [ boolean ] = containsRectangle(rectangle a, rectangle b)\n * @static function\n */\nRectangle.containsRectangle = function (a, b) {\n  return (a.x + a.w) <= (b.x + b.w) && a.x >= b.x && (a.y + a.h) <= (b.y + b.h) && a.y >= b.y;\n};\n\n/* expands rectangle A to include rectangle B, rectangle B is untouched\n * [ rectangle a ] = expandRectangle(rectangle a, rectangle b)\n * @static function\n */\nRectangle.expandRectangle = function (a, b) {\n  var nx, ny;\n  var axw = a.x + a.w;\n  var bxw = b.x + b.w;\n  var ayh = a.y + a.h;\n  var byh = b.y + b.h;\n  if (a.x > b.x) {\n    nx = b.x;\n  }\n  else {\n    nx = a.x;\n  }\n  if (a.y > b.y) {\n    ny = b.y;\n  }\n  else {\n    ny = a.y;\n  }\n  if (axw > bxw) {\n    a.w = axw - nx;\n  }\n  else {\n    a.w = bxw - nx;\n  }\n  if (ayh > byh) {\n    a.h = ayh - ny;\n  }\n  else {\n    a.h = byh - ny;\n  }\n  a.x = nx;\n  a.y = ny;\n  return a;\n};\n\n/* generates a minimally bounding rectangle for all rectangles in\n * array 'nodes'. If rect is set, it is modified into the MBR. Otherwise,\n * a new rectangle is generated and returned.\n * [ rectangle a ] = makeMBR(rectangle array nodes, rectangle rect)\n * @static function\n */\nRectangle.makeMBR = function (nodes, rect) {\n  if (!nodes.length) {\n    return {\n      x: 0,\n      y: 0,\n      w: 0,\n      h: 0\n    };\n  }\n  rect = rect || {};\n  rect.x = nodes[0].x;\n  rect.y = nodes[0].y;\n  rect.w = nodes[0].w;\n  rect.h = nodes[0].h;\n\n  for (var i = 1, len = nodes.length; i < len; i++) {\n    Rectangle.expandRectangle(rect, nodes[i]);\n  }\n\n  return rect;\n};\nRectangle.squarifiedRatio = function (l, w, fill) {\n  // Area of new enlarged rectangle\n  var lperi = (l + w) / 2.0; // Average size of a side of the new rectangle\n  var larea = l * w; // Area of new rectangle\n  // return the ratio of the perimeter to the area - the closer to 1 we are,\n  // the more 'square' a rectangle is. conversly, when approaching zero the\n  // more elongated a rectangle is\n  var lgeo = larea / (lperi * lperi);\n  return larea * fill / lgeo;\n};\nmodule.exports = Rectangle;","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst three_1 = require(\"three\");\nconst HPL = require(\"./HighPrecisionLines\");\nconst HPP = require(\"./HighPrecisionPoints\");\nconst TriangulateLines_1 = require(\"./TriangulateLines\");\nvar HighPrecisionUtils;\n(function (HighPrecisionUtils) {\n    /**\n     * Extract the `float` parts of all vector members, Making this a `Vector3` of `float`.\n     * precision.\n     *\n     * @param v\n     */\n    function doubleToFloatVec(v) {\n        return new three_1.Vector3(Math.fround(v.x), Math.fround(v.y), Math.fround(v.z));\n    }\n    HighPrecisionUtils.doubleToFloatVec = doubleToFloatVec;\n    /**\n     * Convert a `Vector3` to `float` (in place!) Returns the minor float vector, which is the\n     * difference of the double elements and their float counterparts.\n     *\n     * @param v Vector3 to convert to float IN-PLACE!\n     */\n    function makeFloatVec(v) {\n        const majorX = Math.fround(v.x);\n        const majorY = Math.fround(v.y);\n        const majorZ = Math.fround(v.z);\n        const minorVec = new three_1.Vector3(v.x - majorX, v.y - majorY, v.z - majorZ);\n        v.x = Math.fround(majorX);\n        v.y = Math.fround(majorY);\n        v.z = Math.fround(majorZ);\n        return minorVec;\n    }\n    HighPrecisionUtils.makeFloatVec = makeFloatVec;\n    /**\n     * Calculate high-precision camera position used in vertex shader of high-precision materials.\n     *\n     * @param camera Camera used to get the high-precision position.\n     * @param objectInverseWorldMatrix Inverse World Matrix of the rendered [[HighPrecisionObject]].\n     */\n    function createHighPrecisionCameraPos(camera, objectInverseWorldMatrix) {\n        const _projScreenMatrix = new three_1.Matrix4().copy(camera.projectionMatrix);\n        const mvp = _projScreenMatrix.multiply(camera.matrixWorldInverse);\n        const eyePos = new three_1.Vector3(0, 0, 0).applyMatrix4(objectInverseWorldMatrix);\n        // split the double float vector into hi and lo parts\n        const eyePosFloat = doubleToFloatVec(eyePos);\n        const eyePosLo = doubleToFloatVec(eyePos.sub(eyePosFloat));\n        return {\n            viewProjection: mvp,\n            eyePosHi: eyePosFloat,\n            eyePosLo\n        };\n    }\n    HighPrecisionUtils.createHighPrecisionCameraPos = createHighPrecisionCameraPos;\n    /**\n     * Updates the high-precision uniform data of a material used to render a\n     * [[HighPrecisionObject]].\n     *\n     * @param object [[HighPrecisionObject]] used for rendering.\n     * @param camera Camera used to get the high-precision position.\n     * @param shaderMaterial Material which uniforms will be updated.\n     */\n    function updateHpUniforms(object, camera, shaderMaterial) {\n        const highPrecisionCameraInfo = createHighPrecisionCameraPos(camera, object.matrixWorldInverse);\n        const mvp = highPrecisionCameraInfo.viewProjection;\n        if (shaderMaterial !== undefined && shaderMaterial.isMaterial) {\n            if (shaderMaterial.uniforms &&\n                shaderMaterial.uniforms.u_mvp &&\n                shaderMaterial.uniforms.u_eyepos &&\n                shaderMaterial.uniforms.u_eyepos_lowpart) {\n                shaderMaterial.uniforms.u_mvp.value = new Float32Array(mvp.elements);\n                shaderMaterial.uniforms.u_eyepos.value = new Float32Array(highPrecisionCameraInfo.eyePosHi.toArray());\n                shaderMaterial.uniforms.u_eyepos_lowpart.value = new Float32Array(highPrecisionCameraInfo.eyePosLo.toArray());\n            }\n            else {\n                throw Error(\"High pecision material has missing uniforms\");\n            }\n        }\n        else {\n            throw Error(\"High pecision line has no high precision material\");\n        }\n    }\n    HighPrecisionUtils.updateHpUniforms = updateHpUniforms;\n    /**\n     * Assembles the necessary attribute buffers needed to render [[HighPrecisionObject]].\n     *\n     * @param positions Array of positions.\n     */\n    function createAttributes(positions) {\n        if (positions.length > 0) {\n            const v = positions[0];\n            if (v === undefined || v === null) {\n                throw Error(\"Empty element in positions\");\n            }\n            const positionVec = new Array();\n            const positionVecLow = new Array();\n            const addHPValue = (...values) => {\n                for (const value of values) {\n                    const major = Math.fround(value);\n                    positionVecLow.push(value - major);\n                    positionVec.push(major);\n                }\n            };\n            const addHPVector = (vec) => {\n                addHPValue(vec.x, vec.y, vec.z);\n            };\n            const vAny = v;\n            if (vAny.z !== undefined) {\n                positions.forEach(vec => {\n                    addHPVector(vec);\n                });\n            }\n            else {\n                if (positionVec.length % 3 !== 0) {\n                    throw Error(\"Positions must be 3D, not 2D\");\n                }\n                positions.forEach((n) => {\n                    addHPValue(n);\n                });\n            }\n            return {\n                positionHigh: new three_1.Float32BufferAttribute(positionVec, 3),\n                positionLow: new three_1.Float32BufferAttribute(positionVecLow, 3)\n            };\n        }\n        else {\n            return {\n                positionHigh: new three_1.Float32BufferAttribute([], 3),\n                positionLow: new three_1.Float32BufferAttribute([], 3)\n            };\n        }\n    }\n    HighPrecisionUtils.createAttributes = createAttributes;\n    /**\n     * Assembles an interleaved buffer containing the position attribute data for a\n     * [[HighPrecisionObject]].\n     *\n     * @param positions Array of positions.\n     * @param stride Stride of the elements in the `positions` array.\n     * @param positionOffset Offset into the `positions` array.\n     */\n    function addInterleavedAttributes3(positions, stride, positionOffset = 0) {\n        const newPositions = new Array();\n        const end = positions.length;\n        for (let i = 0; i < end; i += stride) {\n            for (let j = 0; j < positionOffset; j++) {\n                newPositions.push(positions[i + j]);\n            }\n            const x = positions[i + positionOffset];\n            const y = positions[i + positionOffset + 1];\n            const z = positions[i + positionOffset + 2];\n            const majorX = Math.fround(x);\n            const minorX = x - majorX;\n            const majorY = Math.fround(y);\n            const minorY = y - majorY;\n            const majorZ = Math.fround(z);\n            const minorZ = z - majorZ;\n            // insert values in interleaved buffer\n            newPositions.push(majorX, majorY, majorZ, minorX, minorY, minorZ);\n            for (let j = positionOffset + 3; j < stride; j++) {\n                newPositions.push(positions[i + j]);\n            }\n        }\n        return newPositions;\n    }\n    HighPrecisionUtils.addInterleavedAttributes3 = addInterleavedAttributes3;\n    /**\n     * Adds the high-precision position attribute data to a [[HighPrecisionObject]].\n     *\n     * @param object [[HighPrecisionObject]] which position attribute will be set.\n     * @param positions Array of positions.\n     */\n    function setPositions(object, positions) {\n        const attributes = createAttributes(positions);\n        object.bufferGeometry.addAttribute(\"position\", attributes.positionHigh);\n        object.bufferGeometry.addAttribute(\"positionLow\", attributes.positionLow);\n        return attributes.positionHigh.itemSize;\n    }\n    HighPrecisionUtils.setPositions = setPositions;\n    /**\n     * Convert positions from `Array<Vector3>` to `Array<number>`.\n     *\n     * @param positions Array of positions.\n     */\n    function convertPositions(positions) {\n        if (positions.length <= 0) {\n            return { positions: [] };\n        }\n        const v = positions[0];\n        if (v === undefined || v === null) {\n            throw Error(\"Empty element in positions\");\n        }\n        const vAny = v;\n        if (vAny.y === undefined && vAny.z === undefined) {\n            return { positions: positions };\n        }\n        const returnPositions = new Array();\n        positions.forEach(vec => {\n            returnPositions.push(vec.x, vec.y, vec.z);\n        });\n        return { positions: returnPositions };\n    }\n    HighPrecisionUtils.convertPositions = convertPositions;\n    /**\n     * Creates a [[HighPrecisionLine]] or [[HighPrecisionWireFrameLine]] object.\n     *\n     * @param linePositions Array of 2D/3D positions.\n     * @param params Parameters used to configure the created [[HighPrecisionObject]].\n     */\n    function createLine(linePositions, params) {\n        const lineWidth = params.lineWidth !== undefined ? params.lineWidth : 5;\n        const addCircles = params.addCircles !== undefined ? params.addCircles : false;\n        const wireFrame = params.wireFrame !== undefined ? params.wireFrame : false;\n        const positions = [];\n        const indices = [];\n        TriangulateLines_1.triangulateLine(linePositions, lineWidth, positions, indices, addCircles);\n        const hpLineGeometry = new three_1.BufferGeometry();\n        const hpPositions = addInterleavedAttributes3(positions, 3);\n        const buffer = new three_1.InterleavedBuffer(new Float32Array(hpPositions), 6);\n        const positionAttribute = new three_1.InterleavedBufferAttribute(buffer, 3, 0, false);\n        const positionLowAttribute = new three_1.InterleavedBufferAttribute(buffer, 3, 3, false);\n        hpLineGeometry.addAttribute(\"position\", positionAttribute);\n        hpLineGeometry.addAttribute(\"positionLow\", positionLowAttribute);\n        hpLineGeometry.setIndex(new three_1.BufferAttribute(new Uint32Array(indices), 1));\n        const hpSolidMaterial = new harp_materials_1.HighPrecisionLineMaterial(params);\n        const lineObject = wireFrame\n            ? new HPL.HighPrecisionWireFrameLine(hpLineGeometry, hpSolidMaterial)\n            : new HPL.HighPrecisionLine(hpLineGeometry, hpSolidMaterial);\n        lineObject.setupForRendering();\n        return lineObject;\n    }\n    HighPrecisionUtils.createLine = createLine;\n    /**\n     * Creates a group of [[HighPrecisionPoints]].\n     *\n     * @param pointPositions Array of 2D/3D positions.\n     * @param materialParameters Parameters used to configure the material used to render the\n     * created [[HighPrecisionPoints]].\n     */\n    function createPoints(pointPositions, materialParameters) {\n        const indices = [];\n        // tslint:disable-next-line:prefer-for-of - pointPositions doesn't have iterable interface\n        for (let i = 0; i < pointPositions.length; i++) {\n            indices.push(indices.length / 3);\n        }\n        const hpPointsGeometry = new three_1.BufferGeometry();\n        const hpPointsMaterial = harp_materials_1.isHighPrecisionPointMaterial(materialParameters)\n            ? materialParameters\n            : new harp_materials_1.HighPrecisionPointMaterial(materialParameters);\n        const pointsObject = new HPP.HighPrecisionPoints(hpPointsGeometry, hpPointsMaterial);\n        setPositions(pointsObject, pointPositions);\n        pointsObject.setupForRendering();\n        return pointsObject;\n    }\n    HighPrecisionUtils.createPoints = createPoints;\n})(HighPrecisionUtils = exports.HighPrecisionUtils || (exports.HighPrecisionUtils = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst THREE = require(\"three\");\n/**\n * The base shader to use for [[MapView]]'s composing passes, like [[MSAAMaterial]].\n */\nexports.CopyShader = {\n    uniforms: {\n        tDiffuse: { value: null },\n        opacity: { value: 1.0 }\n    },\n    vertexShader: `\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }`,\n    fragmentShader: `\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }`\n};\n/**\n * The material is used for composing.\n */\nclass CopyMaterial extends THREE.ShaderMaterial {\n    /**\n     * The constructor of `CopyMaterial`.\n     *\n     * @param uniforms The [[CopyShader]]'s uniforms.\n     */\n    constructor(uniforms) {\n        super({\n            name: \"CopyMaterial\",\n            uniforms,\n            vertexShader: exports.CopyShader.vertexShader,\n            fragmentShader: exports.CopyShader.fragmentShader,\n            premultipliedAlpha: true,\n            transparent: false,\n            blending: THREE.NoBlending,\n            depthTest: false,\n            depthWrite: false\n        });\n    }\n}\nexports.CopyMaterial = CopyMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst MapMeshMaterials_1 = require(\"./MapMeshMaterials\");\nconst LinesChunks_1 = require(\"./ShaderChunks/LinesChunks\");\nconst vertexSource = `\n#define SEGMENT_OFFSET 0.1\n\nattribute vec2 texcoord;\nattribute vec3 position;\nattribute vec4 bitangent;\nattribute vec3 tangent;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float lineWidth;\n\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\nvarying vec3 vPosition;\n\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\n#include <extrude_line_vert_func>\n\nvoid main() {\n    vLinewidth = lineWidth;\n    vSegment = abs(texcoord) - SEGMENT_OFFSET;\n\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = position;\n    vec2 uvs = sign(texcoord);\n\n    extrudeLine(vSegment, bitangent, tangent, lineWidth, pos, uvs);\n\n    vPosition = pos;\n    vTexcoord = vec2(uvs.x, uvs.y * lineWidth);\n\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}`;\nconst fragmentSource = `\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 tileSize;\n#if DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\n#endif\n\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\nvarying vec3 vPosition;\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\n#include <join_dist_func>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n\n    float alpha = opacity;\n\n    #if TILE_CLIP\n    tileClip(vPosition.xy, tileSize);\n    #endif\n\n    #if DASHED_LINE\n    float halfSegment = (dashSize + gapSize) / dashSize * 0.5;\n    float segmentDist = mod(vTexcoord.x, dashSize + gapSize) / dashSize;\n    float dist = 0.5 - distance(segmentDist, halfSegment);\n    float width = fwidth(dist);\n    alpha *= smoothstep(-width, width, dist);\n    #else\n    float dist = joinDist(vSegment, vTexcoord) - vLinewidth;\n    float width = fwidth(dist);\n    alpha *= (1.0 - smoothstep(-width, width, dist));\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( diffuse, alpha );\n    #endif\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}`;\n/**\n * Material designed to render solid variable-width lines.\n */\nclass SolidLineMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Constructs a new `SolidLineMaterial`.\n     *\n     * @param params `SolidLineMaterial` parameters.\n     */\n    constructor(params) {\n        Object.assign(THREE.ShaderChunk, LinesChunks_1.default);\n        MapMeshMaterials_1.FadingFeature.patchGlobalShaderChunks();\n        const defines = {\n            DASHED_LINE: 0,\n            TILE_CLIP: 0\n        };\n        const hasFog = params !== undefined && params.fog === true;\n        if (hasFog) {\n            defines.USE_FOG = \"\";\n        }\n        const shaderParams = {\n            name: \"SolidLineMaterial\",\n            vertexShader: vertexSource,\n            fragmentShader: fragmentSource,\n            uniforms: THREE.UniformsUtils.merge([\n                {\n                    diffuse: new THREE.Uniform(new THREE.Color(SolidLineMaterial.DEFAULT_COLOR)),\n                    lineWidth: new THREE.Uniform(SolidLineMaterial.DEFAULT_WIDTH),\n                    opacity: new THREE.Uniform(SolidLineMaterial.DEFAULT_OPACITY),\n                    tileSize: new THREE.Uniform(new THREE.Vector2()),\n                    fadeNear: new THREE.Uniform(MapMeshMaterials_1.FadingFeature.DEFAULT_FADE_NEAR),\n                    fadeFar: new THREE.Uniform(MapMeshMaterials_1.FadingFeature.DEFAULT_FADE_FAR)\n                },\n                // We need the fog uniforms available when we use `updateFog` as the internal\n                // recompilation cannot add or remove uniforms.\n                THREE.UniformsLib.fog\n            ]),\n            defines,\n            transparent: true,\n            fog: true\n        };\n        super(shaderParams);\n        this.extensions.derivatives = true;\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.color !== undefined) {\n                this.color.set(params.color);\n            }\n            if (params.lineWidth !== undefined) {\n                this.lineWidth = params.lineWidth;\n            }\n            if (params.opacity !== undefined) {\n                this.opacity = params.opacity;\n            }\n            if (params.depthTest !== undefined) {\n                this.depthTest = params.depthTest;\n            }\n            if (params.depthWrite !== undefined) {\n                this.depthWrite = params.depthWrite;\n            }\n            if (params.fadeNear !== undefined) {\n                this.fadeNear = params.fadeNear;\n            }\n            if (params.fadeFar !== undefined) {\n                this.fadeFar = params.fadeFar;\n            }\n            this.fog = hasFog;\n        }\n    }\n    /**\n     * The method to call to recompile a material to get a new fog define.\n     *\n     * @param enableFog Whether we want to enable the fog.\n     */\n    updateFog(enableFog) {\n        if (!enableFog) {\n            delete this.defines.USE_FOG;\n        }\n        else {\n            this.defines.USE_FOG = \"\";\n        }\n    }\n    /**\n     * Line opacity.\n     */\n    get opacity() {\n        return this.uniforms.opacity.value;\n    }\n    set opacity(value) {\n        if (this.uniforms !== undefined) {\n            this.uniforms.opacity.value = value;\n        }\n    }\n    /**\n     * Line color.\n     */\n    get color() {\n        return this.uniforms.diffuse.value;\n    }\n    set color(value) {\n        this.uniforms.diffuse.value = value;\n    }\n    /**\n     * Line width.\n     */\n    get lineWidth() {\n        return this.uniforms.lineWidth.value;\n    }\n    set lineWidth(value) {\n        this.uniforms.lineWidth.value = value;\n    }\n    get fadeNear() {\n        return this.uniforms.fadeNear.value;\n    }\n    set fadeNear(value) {\n        this.uniforms.fadeNear.value = value;\n    }\n    get fadeFar() {\n        return this.uniforms.fadeFar.value;\n    }\n    set fadeFar(value) {\n        const fadeFar = this.uniforms.fadeFar.value;\n        this.uniforms.fadeFar.value = value;\n        const doFade = fadeFar !== undefined && fadeFar > 0.0;\n        if (doFade) {\n            this.defines.USE_FADING = \"\";\n        }\n        else {\n            delete this.defines.USE_FADING;\n        }\n    }\n}\nSolidLineMaterial.DEFAULT_COLOR = 0xff0000;\nSolidLineMaterial.DEFAULT_WIDTH = 1.0;\nSolidLineMaterial.DEFAULT_OPACITY = 1.0;\nexports.SolidLineMaterial = SolidLineMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Class for the default console channel.\n */\nclass ConsoleChannel {\n    error(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.error(message, ...optionalParams);\n    }\n    debug(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.debug(message, ...optionalParams);\n    }\n    info(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.info(message, ...optionalParams);\n    }\n    log(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.log(message, ...optionalParams);\n    }\n    trace(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.trace(message, ...optionalParams);\n    }\n    warn(message, ...optionalParams) {\n        // tslint:disable-next-line:no-console\n        console.warn(message, ...optionalParams);\n    }\n}\nexports.ConsoleChannel = ConsoleChannel;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ILogger_1 = require(\"./ILogger\");\n/**\n * Logger class.\n */\nclass Logger {\n    constructor(name, m_channel, options) {\n        this.name = name;\n        this.m_channel = m_channel;\n        this.enabled = true;\n        this.level = ILogger_1.LogLevel.Trace;\n        if (options !== undefined) {\n            this.update(options);\n        }\n    }\n    error(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Error) {\n            this.m_channel.error(this.prefix, message, ...optionalParams);\n        }\n    }\n    debug(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Debug) {\n            this.m_channel.debug(this.prefix, message, ...optionalParams);\n        }\n    }\n    info(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Info) {\n            this.m_channel.info(this.prefix, message, ...optionalParams);\n        }\n    }\n    log(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Log) {\n            this.m_channel.log(this.prefix, message, ...optionalParams);\n        }\n    }\n    trace(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Trace) {\n            this.m_channel.trace(this.prefix, message, ...optionalParams);\n        }\n    }\n    warn(message, ...optionalParams) {\n        if (this.enabled && this.level <= ILogger_1.LogLevel.Warn) {\n            this.m_channel.warn(this.prefix, message, ...optionalParams);\n        }\n    }\n    update(options) {\n        this.enabled = options.enabled === undefined ? this.enabled : options.enabled;\n        this.level = options.level === undefined ? this.level : options.level;\n    }\n    get prefix() {\n        return this.name + \":\";\n    }\n}\nexports.Logger = Logger;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ILogger_1 = require(\"./ILogger\");\nexports.WORKERCHANNEL_MSG_TYPE = \"worker-channel-message\";\n/**\n * The class for the worker channel.\n */\nclass WorkerChannel {\n    error(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Error\n        };\n        self.postMessage(workerMessage);\n    }\n    debug(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Debug\n        };\n        self.postMessage(workerMessage);\n    }\n    info(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Info\n        };\n        self.postMessage(workerMessage);\n    }\n    log(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Log\n        };\n        self.postMessage(workerMessage);\n    }\n    trace(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Trace\n        };\n        self.postMessage(workerMessage);\n    }\n    warn(message, ...optionalParams) {\n        const workerMessage = {\n            message: [message, ...optionalParams],\n            type: exports.WORKERCHANNEL_MSG_TYPE,\n            level: ILogger_1.LogLevel.Warn\n        };\n        self.postMessage(workerMessage);\n    }\n}\nexports.WorkerChannel = WorkerChannel;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoBox_1 = require(\"../coordinates/GeoBox\");\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst Box3Like_1 = require(\"../math/Box3Like\");\nconst MathUtils_1 = require(\"../math/MathUtils\");\nconst OrientedBox3Like_1 = require(\"../math/OrientedBox3Like\");\nconst Projection_1 = require(\"./Projection\");\nconst DEG2RAD = Math.PI / 180;\nclass EquirectangularProjection {\n    constructor() {\n        this.type = Projection_1.ProjectionType.Planar;\n    }\n    getScaleFactor(_worldPoint) {\n        return 1;\n    }\n    worldExtent(minAltitude, maxAltitude, result) {\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        result.min.x = 0.0;\n        result.min.y = 0.0;\n        result.min.z = minAltitude;\n        result.max.x = 1.0;\n        result.max.y = 0.5;\n        result.max.z = maxAltitude;\n        return result;\n    }\n    projectPoint(geoPoint, result) {\n        if (result === undefined) {\n            /*\n             * The following tslint:disable is due to the fact that the [[WorldCoordinates]]\n             * might be a concrete class which is not available at runtime.\n             * Consider the following example:\n             *\n             *  const x: THREE.Vector3 = new THREE.Vector3(0,0,0);\n             *  const result = EquirectangularProjection.projectPoint<THREE.Vector3>(x);\n             *\n             * Note: type of `result` is Vector3Like and not as expected: THREE.Vector3!\n             */\n            // tslint:disable-next-line:no-object-literal-type-assertion\n            result = { x: 0, y: 0, z: 0 };\n        }\n        result.x =\n            (geoPoint.longitude * DEG2RAD + Math.PI) * EquirectangularProjection.geoToWorldScale;\n        result.y =\n            (geoPoint.latitude * DEG2RAD + Math.PI * 0.5) *\n                EquirectangularProjection.geoToWorldScale;\n        result.z = geoPoint.altitude || 0;\n        return result;\n    }\n    unprojectPoint(worldPoint) {\n        const geoPoint = GeoCoordinates_1.GeoCoordinates.fromRadians(worldPoint.y * EquirectangularProjection.worldToGeoScale - Math.PI * 0.5, worldPoint.x * EquirectangularProjection.worldToGeoScale - Math.PI, worldPoint.z);\n        return geoPoint;\n    }\n    projectBox(geoBox, result) {\n        const worldCenter = this.projectPoint(new GeoCoordinates_1.GeoCoordinates(geoBox.center.latitude, geoBox.center.longitude, 0));\n        const { latitudeSpanInRadians, longitudeSpanInRadians, altitudeSpan } = geoBox;\n        const sizeX = longitudeSpanInRadians * EquirectangularProjection.geoToWorldScale;\n        const sizeY = latitudeSpanInRadians * EquirectangularProjection.geoToWorldScale;\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        if (Box3Like_1.isBox3Like(result)) {\n            result.min.x = worldCenter.x - sizeX * 0.5;\n            result.min.y = worldCenter.y - sizeY * 0.5;\n            result.max.x = worldCenter.x + sizeX * 0.5;\n            result.max.y = worldCenter.y + sizeY * 0.5;\n            if (altitudeSpan !== undefined) {\n                result.min.z = worldCenter.z - altitudeSpan * 0.5;\n                result.max.z = worldCenter.z + altitudeSpan * 0.5;\n            }\n            else {\n                result.min.z = 0;\n                result.max.z = 0;\n            }\n        }\n        else if (OrientedBox3Like_1.isOrientedBox3Like(result)) {\n            MathUtils_1.MathUtils.newVector3(1, 0, 0, result.xAxis);\n            MathUtils_1.MathUtils.newVector3(0, 1, 0, result.yAxis);\n            MathUtils_1.MathUtils.newVector3(0, 0, 1, result.zAxis);\n            result.position.x = worldCenter.x;\n            result.position.y = worldCenter.y;\n            result.position.z = worldCenter.z;\n            result.extents.x = sizeX * 0.5;\n            result.extents.y = sizeY * 0.5;\n            result.extents.z = Math.max(Number.EPSILON, (altitudeSpan || 0) * 0.5);\n        }\n        return result;\n    }\n    unprojectBox(worldBox) {\n        const minGeo = this.unprojectPoint(worldBox.min);\n        const maxGeo = this.unprojectPoint(worldBox.max);\n        return GeoBox_1.GeoBox.fromCoordinates(minGeo, maxGeo);\n    }\n    groundDistance(worldPoint) {\n        return worldPoint.z;\n    }\n    scalePointToSurface(worldPoint) {\n        worldPoint.z = 0;\n        return worldPoint;\n    }\n}\nEquirectangularProjection.geoToWorldScale = 1.0 / (2.0 * Math.PI);\nEquirectangularProjection.worldToGeoScale = (2.0 * Math.PI) / 1.0;\n/**\n * Equirectangular [[Projection]] used to convert geo coordinates to world coordinates and vice\n * versa.\n */\nexports.equirectangularProjection = new EquirectangularProjection();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoBox_1 = require(\"../coordinates/GeoBox\");\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst MathUtils_1 = require(\"../math/MathUtils\");\nconst OrientedBox3Like_1 = require(\"../math/OrientedBox3Like\");\nconst EarthConstants_1 = require(\"./EarthConstants\");\nconst MercatorProjection_1 = require(\"./MercatorProjection\");\nclass WebMercatorProjection extends MercatorProjection_1.MercatorProjection {\n    projectPoint(geoPointLike, result) {\n        let geoPoint;\n        if (geoPointLike instanceof GeoCoordinates_1.GeoCoordinates) {\n            geoPoint = geoPointLike;\n        }\n        else {\n            geoPoint = new GeoCoordinates_1.GeoCoordinates(geoPointLike.latitude, geoPointLike.longitude, geoPointLike.altitude);\n        }\n        /*\n         * The following tslint:disable is due to the fact that the [[WorldCoordinates]]\n         * might be a concrete class which is not available at runtime.\n         * Consider the following example:\n         *\n         *  const x: THREE.Vector3 = new THREE.Vector3(0,0,0);\n         *  const result = EquirectangularProjection.projectPoint<THREE.Vector3>(x);\n         *\n         * Note: type of `result` is Vector3Like and not as expected: THREE.Vector3!\n         */\n        if (!result) {\n            // tslint:disable-next-line:no-object-literal-type-assertion\n            result = { x: 0, y: 0, z: 0 };\n        }\n        result.x = ((geoPoint.longitude + 180) / 360) * EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        const sy = Math.sin(MercatorProjection_1.MercatorProjection.latitudeClamp(geoPoint.latitudeInRadians));\n        result.y =\n            (0.5 - Math.log((1 + sy) / (1 - sy)) / (4 * Math.PI)) *\n                EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        result.z = geoPoint.altitude || 0;\n        return result;\n    }\n    unprojectPoint(worldPoint) {\n        const x = worldPoint.x / EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE - 0.5;\n        const y = 0.5 - worldPoint.y / EarthConstants_1.EarthConstants.EQUATORIAL_CIRCUMFERENCE;\n        const longitude = 360 * x;\n        const latitude = 90 - (360 * Math.atan(Math.exp(-y * 2 * Math.PI))) / Math.PI;\n        return new GeoCoordinates_1.GeoCoordinates(latitude, longitude, worldPoint.z);\n    }\n    projectBox(geoBox, result) {\n        const r = super.projectBox(geoBox, result);\n        if (OrientedBox3Like_1.isOrientedBox3Like(r)) {\n            MathUtils_1.MathUtils.newVector3(1, 0, 0, r.xAxis);\n            MathUtils_1.MathUtils.newVector3(0, -1, 0, r.yAxis);\n            MathUtils_1.MathUtils.newVector3(0, 0, -1, r.zAxis);\n        }\n        return r;\n    }\n    unprojectBox(worldBox) {\n        const minGeo = this.unprojectPoint(worldBox.min);\n        const maxGeo = this.unprojectPoint(worldBox.max);\n        const geoBox = new GeoBox_1.GeoBox(new GeoCoordinates_1.GeoCoordinates(maxGeo.latitude, minGeo.longitude, minGeo.altitude), new GeoCoordinates_1.GeoCoordinates(minGeo.latitude, maxGeo.longitude, maxGeo.altitude));\n        return geoBox;\n    }\n}\nWebMercatorProjection.MAXIMUM_LATITUDE = 1.4844222297453323;\n/**\n * Web Mercator [[Projection]] used to convert geo coordinates to world coordinates and vice versa.\n */\nexports.webMercatorProjection = new WebMercatorProjection();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst MathUtils_1 = require(\"../math/MathUtils\");\n/**\n * `FlatTileBoundingBoxGenerator` generates bounding boxes in world and geo coordinates for a given\n * TilingScheme.\n */\nclass FlatTileBoundingBoxGenerator {\n    /**\n     * Creates a new `FlatTileBoundingBoxGenerator` that can generate bounding boxes for the given\n     * TilingScheme.\n     *\n     * @param tilingScheme The [[TilingScheme]] used to compute bounding boxes.\n     * @param minElevation The minimum elevation in meters.\n     * @param maxElevation The maximum elevation in meters.\n     */\n    constructor(tilingScheme, minElevation = 0, maxElevation = 0) {\n        this.tilingScheme = tilingScheme;\n        this.minElevation = minElevation;\n        this.maxElevation = maxElevation;\n        this.m_tilingScheme = tilingScheme;\n        this.m_worldBox = tilingScheme.projection.worldExtent(minElevation, maxElevation);\n        const { min, max } = this.m_worldBox;\n        this.m_worldDimensions = { x: max.x - min.x, y: max.y - min.y, z: max.z - min.z };\n    }\n    /**\n     * Returns the [[Projection]] of the [[TilingScheme]].\n     */\n    get projection() {\n        return this.m_tilingScheme.projection;\n    }\n    /**\n     * Returns the [[SubdivisionScheme]] of the [[TilingScheme]].\n     */\n    get subdivisionScheme() {\n        return this.m_tilingScheme.subdivisionScheme;\n    }\n    /**\n     * Returns the bounding box in world coordinates of the given [[TileKey]].\n     *\n     * Example:\n     * ```typescript\n     * const worldBounds = new THREE.Box3();\n     * generator.getWorldBox(geoBox, worldBounds);\n     * console.log(worldBounds.getCenter());\n     * ```\n     *\n     * @param tileKey The TileKey.\n     * @param result The optional object used to store the resulting bounding box in world\n     * coordinates.\n     */\n    getWorldBox(tileKey, result) {\n        const level = tileKey.level;\n        const levelDimensionX = this.subdivisionScheme.getLevelDimensionX(level);\n        const levelDimensionY = this.subdivisionScheme.getLevelDimensionY(level);\n        const sizeX = this.m_worldDimensions.x / levelDimensionX;\n        const sizeY = this.m_worldDimensions.y / levelDimensionY;\n        const originX = this.m_worldBox.min.x + sizeX * tileKey.column;\n        const originY = this.m_worldBox.min.y + sizeY * tileKey.row;\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        result.min.x = originX;\n        result.min.y = originY;\n        result.min.z = this.m_worldBox.min.z;\n        result.max.x = originX + sizeX;\n        result.max.y = originY + sizeY;\n        result.max.z = this.m_worldBox.max.z;\n        return result;\n    }\n    /**\n     * Returns the bounding box in geo coordinates for the given [[TileKey]].\n     *\n     * Example:\n     * ```typescript\n     * const geoBox = generator.getGeoBox(worldBounds);\n     * console.log(geoBox.center);\n     * ```\n     *\n     * @param tileKey The [[TileKey]].\n     */\n    getGeoBox(tileKey) {\n        const worldBox = this.getWorldBox(tileKey);\n        return this.projection.unprojectBox(worldBox);\n    }\n}\nexports.FlatTileBoundingBoxGenerator = FlatTileBoundingBoxGenerator;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass HalfQuadTreeSubdivisionScheme {\n    getSubdivisionX() {\n        return 2;\n    }\n    getSubdivisionY(level) {\n        return level === 0 ? 1 : 2;\n    }\n    getLevelDimensionX(level) {\n        // tslint:disable-next-line:no-bitwise\n        return 1 << level;\n    }\n    getLevelDimensionY(level) {\n        // tslint:disable-next-line:no-bitwise\n        return level !== 0 ? 1 << (level - 1) : 1;\n    }\n}\n/**\n * A [[SubdivisionScheme]] used to represent half quadtrees. This particular subdivision scheme is\n * used by the HERE tiling scheme.\n */\nexports.halfQuadTreeSubdivisionScheme = new HalfQuadTreeSubdivisionScheme();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst TileKey_1 = require(\"./TileKey\");\nclass SubTiles {\n    constructor(tileKey, level, mask) {\n        this.m_tileKey = tileKey;\n        this.m_level = level;\n        // tslint:disable:no-bitwise\n        this.m_count = 1 << (level << 1);\n        this.m_mask = mask;\n        this.m_shift = level > 2 ? (level - 2) << 1 : 0;\n        // tslint:enable:no-bitwise\n    }\n    get length() {\n        return this.m_count;\n    }\n    get level() {\n        return this.m_level;\n    }\n    get tileKey() {\n        return this.m_tileKey;\n    }\n    iterator() {\n        return new SubTiles.Iterator(this);\n    }\n    skip(index) {\n        // tslint:disable:no-bitwise\n        if (this.m_mask !== ~0) {\n            while (index < this.m_count && (this.m_mask & (1 << (index >> this.m_shift))) === 0) {\n                ++index;\n            }\n        }\n        // tslint:enable:no-bitwise\n        return index;\n    }\n}\nexports.SubTiles = SubTiles;\n(function (SubTiles) {\n    class Iterator {\n        constructor(parent, index = 0) {\n            this.m_parent = parent;\n            this.m_index = parent.skip(index);\n        }\n        get value() {\n            const parentKey = this.m_parent.tileKey;\n            const subLevel = this.m_parent.level;\n            return TileKey_1.TileKey.fromRowColumnLevel(\n            // tslint:disable:no-bitwise\n            (parentKey.row << subLevel) | (this.m_index >> subLevel), (parentKey.column << subLevel) | (this.m_index & ((1 << subLevel) - 1)), parentKey.level + subLevel\n            // tslint:enableno-bitwise\n            );\n        }\n        next() {\n            this.m_index = this.m_parent.skip(++this.m_index);\n        }\n    }\n    SubTiles.Iterator = Iterator;\n})(SubTiles = exports.SubTiles || (exports.SubTiles = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst TileKey_1 = require(\"./TileKey\");\nclass TileKeyUtils {\n    static geoCoordinatesToTileKey(tilingScheme, geoPoint, level) {\n        const projection = tilingScheme.projection;\n        const subdivisionScheme = tilingScheme.subdivisionScheme;\n        const worldPoint = projection.projectPoint(geoPoint);\n        const cx = subdivisionScheme.getLevelDimensionX(level);\n        const cy = subdivisionScheme.getLevelDimensionY(level);\n        const { min, max } = projection.worldExtent(0, 0);\n        const worldSizeX = max.x - min.x;\n        const worldSizeY = max.y - min.y;\n        if (worldPoint.x < min.x || worldPoint.x > max.x) {\n            return null;\n        }\n        if (worldPoint.y < min.y || worldPoint.y > max.y) {\n            return null;\n        }\n        const column = Math.min(cx - 1, Math.floor((cx * (worldPoint.x - min.x)) / worldSizeX));\n        const row = Math.min(cy - 1, Math.floor((cy * (worldPoint.y - min.y)) / worldSizeY));\n        return TileKey_1.TileKey.fromRowColumnLevel(row, column, level);\n    }\n    static geoRectangleToTileKeys(tilingScheme, geoBox, level) {\n        const wrap = (value, lower, upper) => {\n            if (value < lower) {\n                return upper - ((lower - value) % (upper - lower));\n            }\n            return lower + ((value - lower) % (upper - lower));\n        };\n        const clamp = (x, minVal, maxVal) => {\n            return Math.min(Math.max(x, minVal), maxVal);\n        };\n        // Clamp at the poles and wrap around the international date line.\n        const southWestLongitude = wrap(geoBox.southWest.longitudeInRadians, -Math.PI, Math.PI);\n        const southWestLatitude = clamp(geoBox.southWest.latitudeInRadians, -(Math.PI * 0.5), Math.PI * 0.5);\n        const northEastLongitude = wrap(geoBox.northEast.longitudeInRadians, -Math.PI, Math.PI);\n        const northEastLatitude = clamp(geoBox.northEast.latitudeInRadians, -(Math.PI * 0.5), Math.PI * 0.5);\n        const minTileKey = TileKeyUtils.geoCoordinatesToTileKey(tilingScheme, GeoCoordinates_1.GeoCoordinates.fromRadians(southWestLatitude, southWestLongitude), level);\n        const maxTileKey = TileKeyUtils.geoCoordinatesToTileKey(tilingScheme, GeoCoordinates_1.GeoCoordinates.fromRadians(northEastLatitude, northEastLongitude), level);\n        const columnCount = tilingScheme.subdivisionScheme.getLevelDimensionX(level);\n        if (!minTileKey || !maxTileKey) {\n            throw new Error(\"Invalid coordinates\");\n        }\n        const minColumn = minTileKey.column;\n        let maxColumn = maxTileKey.column;\n        // wrap around case\n        if (southWestLongitude > northEastLongitude) {\n            if (maxColumn !== minColumn) {\n                maxColumn += columnCount;\n            }\n            else {\n                // do not duplicate\n                maxColumn += columnCount - 1;\n            }\n        }\n        const minRow = Math.min(minTileKey.row, maxTileKey.row);\n        const maxRow = Math.max(minTileKey.row, maxTileKey.row);\n        const keys = new Array();\n        for (let row = minRow; row <= maxRow; ++row) {\n            for (let column = minColumn; column <= maxColumn; ++column) {\n                keys.push(TileKey_1.TileKey.fromRowColumnLevel(row, column % columnCount, level));\n            }\n        }\n        return keys;\n    }\n}\nexports.TileKeyUtils = TileKeyUtils;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst SubTiles_1 = require(\"./SubTiles\");\nclass TileTreeTraverse {\n    constructor(subdivisionScheme) {\n        this.m_subdivisionScheme = subdivisionScheme;\n    }\n    subTiles(tileKey) {\n        const subTileCount = this.m_subdivisionScheme.getSubdivisionX(tileKey.level) *\n            this.m_subdivisionScheme.getSubdivisionY(tileKey.level);\n        // tslint:disable-next-line:no-bitwise\n        const subTileMask = ~(~0 << subTileCount);\n        const subTiles = new SubTiles_1.SubTiles(tileKey, 1, subTileMask);\n        const it = subTiles.iterator();\n        const result = new Array();\n        // tslint:disable-next-line:prefer-for-of\n        for (let i = 0; i < subTiles.length; ++i) {\n            result.push(it.value);\n            it.next();\n        }\n        return result;\n    }\n}\nexports.TileTreeTraverse = TileTreeTraverse;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst three_1 = require(\"three\");\nconst Utils_1 = require(\"./Utils\");\n/**\n * The default value for camera movement throttling, in milliseconds.\n */\nconst DEFAULT_THROTTLING_TIMEOUT = 300;\n/**\n * The `CameraMovementDetector` class checks for changes in camera position and orientation, to\n * detect continuous movements without the animation mode activated in [[MapView]]. If the\n * interaction is not continuous enough, you can use a throttling timer to reduce the number of\n * callbacks.\n */\nclass CameraMovementDetector {\n    /**\n     * Initializes the detector with timeout value and callbacks. [[MapView]] also provides\n     * events for client code to be notified when these cues occur.\n     *\n     * @param m_throttlingTimeout The delay, in milliseconds, between the last user interaction\n     * detected and the call to `m_movementFinishedFunc`; the default is `300`.\n     * @param m_movementStartedFunc Callback function, called when the user starts interacting.\n     * @param m_movementFinishedFunc Callback function, called when the user stops interacting.\n     */\n    constructor(m_throttlingTimeout, m_movementStartedFunc, m_movementFinishedFunc) {\n        this.m_throttlingTimeout = m_throttlingTimeout;\n        this.m_movementStartedFunc = m_movementStartedFunc;\n        this.m_movementFinishedFunc = m_movementFinishedFunc;\n        this.m_lastCameraPos = new three_1.Vector3();\n        this.m_newCameraPos = new three_1.Vector3();\n        this.m_lastWorldCenter = new three_1.Vector3();\n        this.m_throttlingTimerId = undefined;\n        this.m_movementDetectorDeadline = 0;\n        this.onDeadlineTimer = () => {\n            this.m_throttlingTimerId = undefined;\n            const now = performance.now();\n            if (now >= this.m_movementDetectorDeadline) {\n                this.movementFinished();\n            }\n            else {\n                this.startMovementFinishedTimer(now);\n            }\n        };\n        if (this.m_throttlingTimeout === undefined) {\n            this.m_throttlingTimeout = DEFAULT_THROTTLING_TIMEOUT;\n        }\n    }\n    /**\n     * Checks if the camera has moved since the last time it was checked. The\n     * `m_movementStartedFunc` is called when a movement starts. If no movement\n     * is detected, a timer for `m_movementFinishedFunc` starts.\n     *\n     * @param mapView [[Mapview]]'s position and camera are checked for modifications.\n     */\n    checkCameraMoved(mapView, now) {\n        const newYawPitchRoll = Utils_1.MapViewUtils.extractYawPitchRoll(mapView.camera.quaternion);\n        const newCameraPos = mapView.camera.getWorldPosition(this.m_newCameraPos);\n        const cameraMoved = this.m_lastYawPitchRoll === undefined ||\n            !this.m_lastCameraPos.equals(newCameraPos) ||\n            !this.m_lastWorldCenter.equals(mapView.worldCenter) ||\n            newYawPitchRoll.yaw !== this.m_lastYawPitchRoll.yaw ||\n            newYawPitchRoll.pitch !== this.m_lastYawPitchRoll.pitch ||\n            newYawPitchRoll.roll !== this.m_lastYawPitchRoll.roll;\n        if (cameraMoved) {\n            this.m_lastCameraPos.copy(newCameraPos);\n            this.m_lastWorldCenter.copy(mapView.worldCenter);\n            this.m_lastYawPitchRoll = newYawPitchRoll;\n        }\n        if (cameraMoved !== this.m_cameraMovedLastFrame) {\n            if (cameraMoved) {\n                this.movementStarted();\n            }\n            this.m_cameraMovedLastFrame = cameraMoved;\n        }\n        if (cameraMoved) {\n            // Start timer\n            this.m_movementDetectorDeadline = now + this.m_throttlingTimeout;\n            this.startMovementFinishedTimer(now);\n        }\n        return this.m_cameraMovedLastFrame;\n    }\n    /**\n     * Reset the saved camera position. Next time checkCameraMoved is called, it will return\n     * `false`.\n     */\n    clear(mapView) {\n        const newCameraPos = mapView.camera.getWorldPosition(this.m_newCameraPos);\n        this.m_lastCameraPos.set(newCameraPos.x, newCameraPos.y, newCameraPos.z);\n    }\n    /**\n     * Force change of camera position. Next time checkCameraMoved is called, it will return `true`.\n     */\n    forceMoved() {\n        this.m_lastCameraPos.set(Number.NaN, Number.NaN, Number.NaN);\n    }\n    /**\n     * Returns `true` if the camera of this [[MapView]] is currently moving. In this case the\n     * `m_movementFinishedFunc` is waiting to be called after the throttling timer runs out.\n     */\n    get cameraIsMoving() {\n        return this.m_throttlingTimerId !== undefined;\n    }\n    /**\n     * Disposes resources and kills the throttling timer.\n     */\n    dispose() {\n        this.removeMovementFinishedTimer();\n        this.m_movementStartedFunc = undefined;\n        this.m_movementFinishedFunc = undefined;\n    }\n    /**\n     * Returns `true` if the camera has moved in the last frame.\n     */\n    get cameraMovedLastFrame() {\n        return this.m_cameraMovedLastFrame === true;\n    }\n    movementStarted() {\n        if (this.m_movementStartedFunc !== undefined) {\n            this.m_movementStartedFunc();\n        }\n    }\n    movementFinished() {\n        this.removeMovementFinishedTimer();\n        if (this.m_movementFinishedFunc !== undefined) {\n            this.m_movementFinishedFunc();\n        }\n    }\n    startMovementFinishedTimer(now) {\n        if (this.m_throttlingTimerId === undefined) {\n            const remainingTime = Math.max(0, this.m_movementDetectorDeadline - now);\n            this.m_throttlingTimerId = setTimeout(this.onDeadlineTimer, remainingTime);\n        }\n    }\n    removeMovementFinishedTimer() {\n        if (this.m_throttlingTimerId !== undefined) {\n            clearTimeout(this.m_throttlingTimerId);\n            this.m_throttlingTimerId = undefined;\n        }\n    }\n}\nexports.CameraMovementDetector = CameraMovementDetector;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_text_canvas_1 = require(\"@here/harp-text-canvas\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst AnimatedExtrusionHandler_1 = require(\"./AnimatedExtrusionHandler\");\nconst ColorCache_1 = require(\"./ColorCache\");\nconst DecodedTileHelpers_1 = require(\"./DecodedTileHelpers\");\nconst DepthPrePass_1 = require(\"./DepthPrePass\");\nconst Statistics_1 = require(\"./Statistics\");\nconst TextElement_1 = require(\"./text/TextElement\");\nconst TextElementsRenderer_1 = require(\"./text/TextElementsRenderer\");\nconst TextStyleCache_1 = require(\"./text/TextStyleCache\");\nconst Utils_1 = require(\"./Utils\");\n/**\n * Minimum estimated size of a JS object.\n */\nconst MINIMUM_SMALL_OBJECT_SIZE_ESTIMATION = 16;\nconst MINIMUM_OBJECT_SIZE_ESTIMATION = 100;\n/**\n * A default empty [[DecodedTile]], for tiles that must be rendered but do not have any objects.\n */\nconst defaultEmptyDecodedTile = {\n    techniques: [],\n    geometries: []\n};\n/**\n * Compute the memory footprint of `TileFeatureData`.\n */\nfunction getFeatureDataSize(featureData) {\n    let numBytes = MINIMUM_OBJECT_SIZE_ESTIMATION;\n    if (featureData.ids !== undefined) {\n        numBytes += featureData.ids.length * 8;\n    }\n    if (featureData.starts !== undefined) {\n        numBytes += featureData.starts.length * 8;\n    }\n    if (featureData.objInfos !== undefined) {\n        // 16 (estimated) bytes per objInfos\n        numBytes += featureData.objInfos.length * MINIMUM_SMALL_OBJECT_SIZE_ESTIMATION;\n    }\n    return numBytes;\n}\nexports.getFeatureDataSize = getFeatureDataSize;\n/**\n * Compute the memory footprint of `RoadIntersectionData`.\n */\nfunction getRoadIntersectionDataSize(intersectionData) {\n    let numBytes = MINIMUM_OBJECT_SIZE_ESTIMATION;\n    // 8 bytes per techniqueIndex\n    // 8 bytes per start\n    // 8 bytes per width\n    // 8 bytes per position\n    // 100 (estimated) bytes per technique\n    const bytesPerEntry = 8 + 8 + 8 + 8 + MINIMUM_OBJECT_SIZE_ESTIMATION;\n    const numEntries = intersectionData.techniqueIndex.length;\n    numBytes += intersectionData.techniqueIndex.length * bytesPerEntry;\n    if (intersectionData.ids !== undefined) {\n        numBytes += numEntries * 8;\n    }\n    if (intersectionData.objInfos !== undefined) {\n        // 16 (estimated) bytes per objInfos\n        numBytes += numEntries * MINIMUM_SMALL_OBJECT_SIZE_ESTIMATION;\n    }\n    return numBytes;\n}\n/**\n * Missing Typedoc\n */\nvar TileLoaderState;\n(function (TileLoaderState) {\n    TileLoaderState[TileLoaderState[\"Initialized\"] = 0] = \"Initialized\";\n    TileLoaderState[TileLoaderState[\"Loading\"] = 1] = \"Loading\";\n    TileLoaderState[TileLoaderState[\"Loaded\"] = 2] = \"Loaded\";\n    TileLoaderState[TileLoaderState[\"Decoding\"] = 3] = \"Decoding\";\n    TileLoaderState[TileLoaderState[\"Ready\"] = 4] = \"Ready\";\n    TileLoaderState[TileLoaderState[\"Canceled\"] = 5] = \"Canceled\";\n    TileLoaderState[TileLoaderState[\"Failed\"] = 6] = \"Failed\";\n})(TileLoaderState = exports.TileLoaderState || (exports.TileLoaderState = {}));\n/**\n * The SORT_WEIGHT_PATH_LENGTH constants control how the priority of the labels are computed based\n * on the length of the label strings.\n *\n * Consequently, the [[Technique]]s priority is slightly modified while generating\n * [[TextElement]]s from the [[DecodedTile]], to get a more meaningful priority and stable results.\n */\n/**\n * Gives [[TextElement]]s with longer paths a higher priority.\n */\nconst SORT_WEIGHT_PATH_LENGTH = 0.1;\n/**\n * The class that holds the tiled data for a [[DataSource]].\n */\nclass Tile {\n    /**\n     * Creates a new [[Tile]].\n     *\n     * @param dataSource The [[DataSource]] that created this [[Tile]].\n     * @param tileKey The unique identifier for this [[Tile]]. Currently only up to level 24 is\n     * supported, because of the use of the upper bits for the offset.\n     * @param offset The optional offset, this is an integer which represents what multiple of 360\n     * degrees to shift, only useful for flat projections, hence optional.\n     */\n    constructor(dataSource, tileKey, offset = 0) {\n        this.dataSource = dataSource;\n        this.tileKey = tileKey;\n        this.offset = offset;\n        /**\n         * A list of the THREE.js objects stored in this `Tile`.\n         */\n        this.objects = [];\n        /**\n         * The optional list of HERE TileKeys of tiles with geometries that cross\n         * the boundaries of this `Tile`.\n         */\n        this.dependencies = new Array();\n        /**\n         * The bounding box of this `Tile` in world coordinates.\n         */\n        this.boundingBox = new THREE.Box3();\n        /**\n         * The center of this `Tile` in world coordinates.\n         */\n        this.center = new THREE.Vector3();\n        /**\n         * Keeping some stats for the individual [[Tile]]s to analyze caching behavior.\n         *\n         * The frame the [[Tile]] was last requested. This is required to know when the given [[Tile]]\n         * can be removed from the cache.\n         */\n        this.frameNumLastRequested = -1;\n        /**\n         * The frame the `Tile` was first visible.\n         */\n        this.frameNumVisible = -1;\n        /**\n         * The last frame this `Tile` has been rendered (or was in the visible set). Used to determine\n         * visibility of `Tile` at the end of a frame, if the number is the current frame number, it is\n         * visible.\n         */\n        this.frameNumLastVisible = -1;\n        /**\n         * After removing from cache, this is the number of frames the `Tile` was visible.\n         */\n        this.numFramesVisible = 0;\n        this.m_disposed = false;\n        this.m_forceHasGeometry = undefined;\n        /**\n         * Prepared text geometries optimized for display.\n         */\n        this.m_preparedTextPaths = new Array();\n        // Used for [[TextElement]]s which the developer defines.\n        this.m_userTextElements = [];\n        // Used for [[TextElement]]s that are stored in the data, and that are placed explicitly,\n        // fading in and out.\n        this.m_textElementGroups = new harp_utils_1.GroupedPriorityList();\n        // All visible [[TextElement]]s.\n        this.m_placedTextElements = new harp_utils_1.GroupedPriorityList();\n        // If `true`, the text content of the [[Tile]] changed.\n        this.m_textElementsChanged = false;\n        this.m_colorMap = new Map();\n        this.m_visibleArea = 0;\n        // List of owned textures for disposal\n        this.m_ownedTextures = new WeakSet();\n        this.geoBox = this.dataSource.getTilingScheme().getGeoBox(this.tileKey);\n        this.projection.projectBox(this.geoBox, this.boundingBox);\n        this.boundingBox.getCenter(this.center);\n    }\n    /**\n     * The visibility status of the [[Tile]]. It is actually visible or planned to become visible.\n     */\n    get isVisible() {\n        return this.frameNumLastRequested === this.dataSource.mapView.frameNumber;\n    }\n    /**\n     * The [[Projection]] currently used by the [[MapView]].\n     */\n    get projection() {\n        return this.dataSource.projection;\n    }\n    /**\n     * The [[MapView]] this `Tile` belongs to.\n     */\n    get mapView() {\n        return this.dataSource.mapView;\n    }\n    /**\n     * Get the currently visible [[TextElement]]s of this `Tile`. This list is continuously\n     * modified, and is not designed to be used to store developer-defined [[TextElements]].\n     */\n    get placedTextElements() {\n        return this.m_placedTextElements;\n    }\n    /*\n     * The size of this Tile in system memory.\n     */\n    get memoryUsage() {\n        if (this.m_resourceInfo === undefined) {\n            this.computeResourceInfo();\n        }\n        return this.m_resourceInfo.heapSize;\n    }\n    /**\n     * Compute [[TileResourceInfo]] of this `Tile`. May be using a cached value. The method\n     * `invalidateResourceInfo` can be called beforehand to force a recalculation.\n     *\n     * @returns `TileResourceInfo` for this `Tile`.\n     */\n    getResourceInfo() {\n        if (this.m_resourceInfo === undefined) {\n            this.computeResourceInfo();\n        }\n        return this.m_resourceInfo;\n    }\n    /**\n     * Force invalidation of the cached [[TileResourceInfo]]. Useful after the `Tile` has been\n     * modified.\n     */\n    invalidateResourceInfo() {\n        this.m_resourceInfo = undefined;\n    }\n    /**\n     * Add ownership of a texture to this tile. The texture will be disposed if the `Tile` is\n     * disposed.\n     * @param texture Texture to be owned by the `Tile`\n     */\n    addOwnedTexture(texture) {\n        this.m_ownedTextures.add(texture);\n    }\n    /**\n     * Gets the list of developer-defined [[TextElement]] in this `Tile`. This list is always\n     * rendered first.\n     */\n    get userTextElements() {\n        return this.m_userTextElements;\n    }\n    /**\n     * Adds a developer-defined [[TextElement]] to this `Tile`. The [[TextElement]] is always\n     * visible, if it's in the map's currently visible area.\n     *\n     * @param textElement The Text element to add.\n     */\n    addUserTextElement(textElement) {\n        this.m_userTextElements.push(textElement);\n        this.textElementsChanged = true;\n    }\n    /**\n     * Removes a developer-defined [[TextElement]] from this `Tile`.\n     *\n     * @param textElement A developer-defined TextElement to remove.\n     * @returns `true` if the element has been removed successfully; `false` otherwise.\n     */\n    removeUserTextElement(textElement) {\n        const foundIndex = this.m_userTextElements.indexOf(textElement);\n        if (foundIndex >= 0) {\n            this.m_userTextElements.splice(foundIndex, 1);\n            this.textElementsChanged = true;\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Adds a [[TextElement]] to this `Tile`, which is added to the visible set of\n     * [[TextElement]]s based on the capacity and visibility. The [[TextElement]]'s priority\n     * controls if or when it becomes visible.\n     *\n     * To ensure that a TextElement is visible, use a high value for its priority, such as\n     * `Number.MAX_SAFE_INTEGER`. Since the number of visible TextElements is limited by the\n     * screen space, not all TextElements are visible at all times.\n     *\n     * @param textElement The TextElement to add.\n     */\n    addTextElement(textElement) {\n        this.textElementGroups.add(textElement);\n        this.textElementsChanged = true;\n    }\n    /**\n     * Removes a [[TextElement]] from this `Tile`. For the element to be removed successfully, the\n     * priority of the [[TextElement]] has to be equal to its priority when it was added.\n     *\n     * @param textElement The TextElement to remove.\n     * @returns `true` if the TextElement has been removed successfully; `false` otherwise.\n     */\n    removeTextElement(textElement) {\n        if (this.textElementGroups.remove(textElement)) {\n            this.textElementsChanged = true;\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Gets the current [[GroupedPriorityList]] which contains a list of all [[TextElement]]s to be\n     * selected and placed for rendering.\n     */\n    get textElementGroups() {\n        return this.m_textElementGroups;\n    }\n    /**\n     * Gets the current modification state for the list of [[TextElement]]s in the `Tile`. If the\n     * value is `true` the TextElement is placed for rendering during the next frame.\n     */\n    get textElementsChanged() {\n        return this.m_textElementsChanged;\n    }\n    set textElementsChanged(changed) {\n        this.m_textElementsChanged = changed;\n    }\n    /**\n     * Called by [[VisibleTileSet]] to mark that [[Tile]] is visible and it should prepare geometry.\n     */\n    prepareForRender() {\n        harp_utils_1.assert(this.isVisible);\n        // Prevents of unnecessary re creation of objects\n        if (this.m_disposed || this.m_decodedTile === undefined) {\n            return;\n        }\n        const decodedTile = this.m_decodedTile;\n        if (decodedTile.tileInfo !== undefined) {\n            this.roadIntersectionData = this.dataSource.mapView.pickHandler.registerTile(this);\n        }\n        this.m_decodedTile = undefined;\n        // creates an empty plane if there are no objects on it, but it must be rendered\n        if (this.m_forceHasGeometry && this.dataSource.addTileBackground) {\n            this.clear();\n            this.addGroundPlane();\n            return;\n        }\n        setTimeout(() => {\n            const stats = Statistics_1.PerformanceStatistics.instance;\n            // If the tile has become invisible while being loaded, for example by moving the\n            // camera, the tile is not finished and its geometry is not created. This is an\n            // optimization for fast camera movements and zooms.\n            if (!this.isVisible) {\n                // Dispose the tile from the visible set, so it can be reloaded properly next time\n                // it is needed.\n                this.mapView.visibleTileSet.disposeTile(this);\n                if (stats.enabled) {\n                    stats.currentFrame.addMessage(`Decoded tile: ${this.dataSource.name} # lvl=${this.tileKey.level} col=${this.tileKey.column} row=${this.tileKey.row} DISCARDED - invisible`);\n                }\n                return;\n            }\n            let now = 0;\n            if (stats.enabled) {\n                now = harp_utils_1.PerformanceTimer.now();\n            }\n            this.createGeometries(decodedTile);\n            if (stats.enabled) {\n                const geometryCreationTime = harp_utils_1.PerformanceTimer.now() - now;\n                const currentFrame = stats.currentFrame;\n                currentFrame.addValue(\"geometry.geometryCreationTime\", geometryCreationTime);\n                currentFrame.addValue(\"geometryCount.numGeometries\", decodedTile.geometries.length);\n                currentFrame.addValue(\"geometryCount.numTechniques\", decodedTile.techniques.length);\n                currentFrame.addValue(\"geometryCount.numPoiGeometries\", decodedTile.poiGeometries !== undefined ? decodedTile.poiGeometries.length : 0);\n                currentFrame.addValue(\"geometryCount.numTextGeometries\", decodedTile.textGeometries !== undefined ? decodedTile.textGeometries.length : 0);\n                currentFrame.addValue(\"geometryCount.numTextPathGeometries\", decodedTile.textPathGeometries !== undefined\n                    ? decodedTile.textPathGeometries.length\n                    : 0);\n                currentFrame.addMessage(`Decoded tile: ${this.dataSource.name} # lvl=${this.tileKey.level} col=${this.tileKey.column} row=${this.tileKey.row}`);\n            }\n            this.dataSource.requestUpdate();\n        }, 0);\n    }\n    /**\n     * Called before [[MapView]] starts rendering this `Tile`.\n     *\n     * @param zoomLevel The current zoom level.\n     * @returns Returns `true` if this `Tile` should be rendered.\n     */\n    willRender(_zoomLevel) {\n        return true;\n    }\n    /**\n     * Called after [[MapView]] has rendered this `Tile`.\n     */\n    didRender() {\n        // to be overridden by subclasses\n    }\n    /**\n     * Estimated visible area of tile used for sorting the priorities during loading.\n     */\n    get visibleArea() {\n        return this.m_visibleArea;\n    }\n    set visibleArea(area) {\n        this.m_visibleArea = area;\n        if (this.tileLoader !== undefined) {\n            this.tileLoader.updatePriority(area);\n        }\n    }\n    /**\n     * Called after the `Tile` has been decoded.\n     *\n     * @param decodedTile The [[DecodedTile]].\n     */\n    createGeometries(decodedTile) {\n        this.clear();\n        this.preparePois(decodedTile);\n        this.createTextElements(decodedTile);\n        this.createObjects(decodedTile, this.objects);\n        this.countVertices();\n    }\n    /**\n     * Gets the decoded tile; it is removed after geometry handling.\n     */\n    get decodedTile() {\n        return this.m_decodedTile;\n    }\n    /**\n     * Called by [[TileLoader]] when data for geometry is available.\n     *\n     * @param decodedTile\n     */\n    setDecodedTile(decodedTile) {\n        this.m_decodedTile = decodedTile;\n        this.invalidateResourceInfo();\n        const stats = Statistics_1.PerformanceStatistics.instance;\n        if (stats.enabled && decodedTile.decodeTime !== undefined) {\n            stats.currentFrame.addValue(\"decode.decodingTime\", decodedTile.decodeTime);\n        }\n    }\n    /**\n     * Called when the default implementation of `dispose()` needs\n     * to free the geometry of a `Tile` object.\n     *\n     * @param object The object that references the geometry.\n     * @returns `true` if the geometry can be disposed.\n     */\n    // tslint:disable-next-line:no-unused-variable\n    shouldDisposeObjectGeometry(object) {\n        return true;\n    }\n    /**\n     * Called when the default implementation of `dispose()` needs\n     * to free a `Tile` object's material.\n     *\n     * @param object The object referencing the geometry.\n     * @returns `true` if the material can be disposed.\n     */\n    // tslint:disable-next-line:no-unused-variable\n    shouldDisposeObjectMaterial(object) {\n        return true;\n    }\n    /**\n     * Called when the default implementation of `dispose()` needs\n     * to free a Texture that is part of a `Tile` object's material.\n     *\n     * @param texture The texture about to be disposed.\n     * @returns `true` if the texture can be disposed.\n     */\n    shouldDisposeTexture(texture) {\n        return this.m_ownedTextures.has(texture);\n    }\n    /**\n     * Returns `true` if this `Tile` has been disposed.\n     */\n    get disposed() {\n        return this.m_disposed;\n    }\n    /**\n     * MapView checks if this `Tile` is ready to be rendered while culling.\n     *\n     * By default, MapView checks if the [[objects]] list is not empty. However, you can override\n     * this check by manually setting this property.\n     */\n    get hasGeometry() {\n        if (this.m_forceHasGeometry === undefined) {\n            return this.objects.length !== 0;\n        }\n        else {\n            return this.m_forceHasGeometry;\n        }\n    }\n    /**\n     * Overrides the default value for [[hasGeometry]].\n     *\n     * @param value A new value for the [[hasGeometry]] flag.\n     */\n    forceHasGeometry(value) {\n        if (value) {\n            this.setDecodedTile(defaultEmptyDecodedTile);\n        }\n        this.m_forceHasGeometry = value;\n    }\n    /**\n     * Gets the [[ITileLoader]] that manages this tile.\n     */\n    get tileLoader() {\n        return this.m_tileLoader;\n    }\n    /**\n     * Sets the [[ITileLoader]] to manage this tile.\n     *\n     * @param tileLoader A [[ITileLoader]] instance to manage the loading process for this tile.\n     */\n    set tileLoader(tileLoader) {\n        this.m_tileLoader = tileLoader;\n    }\n    /**\n     * Forces the update of this `Tile` geometry.\n     */\n    reload() {\n        this.dataSource.updateTile(this);\n    }\n    /**\n     * Frees the rendering resources allocated by this `Tile`.\n     *\n     * The default implementation of this method frees the geometries and the materials for all the\n     * reachable objects.\n     * Textures are freed if they are owned by this `Tile` (i.e. if they where created by this\n     * `Tile`or if the ownership was explicitely set to this `Tile` by [[addOwnedTexture]]).\n     */\n    clear() {\n        const disposeMaterial = (material) => {\n            Object.getOwnPropertyNames(material).forEach((property) => {\n                const materialProperty = material[property];\n                if (materialProperty !== undefined && materialProperty instanceof THREE.Texture) {\n                    const texture = materialProperty;\n                    if (this.shouldDisposeTexture(texture)) {\n                        texture.dispose();\n                    }\n                }\n            });\n            material.dispose();\n        };\n        const disposeObject = (object) => {\n            if (object.geometry !== undefined && this.shouldDisposeObjectGeometry(object)) {\n                object.geometry.dispose();\n            }\n            if (object.material !== undefined && this.shouldDisposeObjectMaterial(object)) {\n                if (object.material instanceof Array) {\n                    object.material.forEach((material) => {\n                        if (material !== undefined) {\n                            disposeMaterial(material);\n                        }\n                    });\n                }\n                else {\n                    disposeMaterial(object.material);\n                }\n            }\n        };\n        this.objects.forEach((rootObject) => {\n            rootObject.traverse((object) => {\n                disposeObject(object);\n            });\n            disposeObject(rootObject);\n        });\n        this.objects.length = 0;\n        if (this.m_preparedTextPaths) {\n            this.m_preparedTextPaths = [];\n        }\n        if (this.m_animatedExtrusionTileHandler !== undefined) {\n            this.m_animatedExtrusionTileHandler.dispose();\n        }\n        this.placedTextElements.clear();\n        this.textElementGroups.clear();\n        this.userTextElements.length = 0;\n        this.invalidateResourceInfo();\n    }\n    /**\n     * Disposes this `Tile`, freeing all geometries and materials for the reachable objects.\n     */\n    dispose() {\n        if (this.m_disposed) {\n            return;\n        }\n        if (this.m_tileLoader) {\n            this.m_tileLoader.cancel();\n            this.m_tileLoader = undefined;\n        }\n        this.clear();\n        this.userTextElements.length = 0;\n        this.m_disposed = true;\n        // Ensure that tile is removable from tile cache.\n        this.frameNumLastRequested = 0;\n    }\n    /**\n     * Gets the prepared text geometries that are optimized for display.\n     */\n    get preparedTextPaths() {\n        return this.m_preparedTextPaths;\n    }\n    /**\n     * Splits the text paths that contain sharp corners.\n     *\n     * @param textPathGeometries The original path geometries that may have defects.\n     */\n    prepareTextPaths(textPathGeometries) {\n        const processedPaths = new Array();\n        const MAX_CORNER_ANGLE = Math.PI / 8;\n        const newPaths = textPathGeometries.slice();\n        // maximum reuse of variables to reduce allocations\n        const p0 = new THREE.Vector2();\n        const p1 = new THREE.Vector2();\n        const previousTangent = new THREE.Vector2();\n        while (newPaths.length > 0) {\n            const textPath = newPaths.pop();\n            if (textPath === undefined) {\n                break;\n            }\n            let splitIndex = -1;\n            for (let i = 0; i < textPath.path.length - 3; i += 3) {\n                p0.set(textPath.path[i], textPath.path[i + 1]);\n                p1.set(textPath.path[i + 3], textPath.path[i + 4]);\n                const tangent = p1.sub(p0).normalize();\n                if (i > 0) {\n                    const theta = Math.atan2(previousTangent.x * tangent.y - tangent.x * previousTangent.y, tangent.dot(previousTangent));\n                    if (Math.abs(theta) > MAX_CORNER_ANGLE) {\n                        splitIndex = i;\n                        break;\n                    }\n                }\n                previousTangent.set(tangent.x, tangent.y);\n            }\n            if (splitIndex > 0) {\n                // split off the valid first path points with a clone of the path\n                const firstTextPath = {\n                    path: textPath.path.slice(0, splitIndex + 3),\n                    text: textPath.text,\n                    // Used for placement priorities only, can be kept although it could also be\n                    // recomputed\n                    pathLengthSqr: textPath.pathLengthSqr,\n                    technique: textPath.technique,\n                    featureId: textPath.featureId\n                };\n                processedPaths.push(firstTextPath);\n                // setup a second part with the rest of the path points and process again\n                const secondTextPath = {\n                    path: textPath.path.slice(splitIndex),\n                    text: textPath.text,\n                    // Used for placement priorities only, can be kept although it could also be\n                    // recomputed\n                    pathLengthSqr: textPath.pathLengthSqr,\n                    technique: textPath.technique,\n                    featureId: textPath.featureId\n                };\n                newPaths.push(secondTextPath);\n            }\n            else {\n                processedPaths.push(textPath);\n            }\n        }\n        return processedPaths;\n    }\n    /**\n     * Creates [[TextElement]] objects from the decoded tile and list of materials specified. The\n     * priorities of the [[TextElement]]s are updated to simplify label placement.\n     *\n     * @param decodedTile The [[DecodedTile]].\n     */\n    createTextElements(decodedTile) {\n        const displayZoomLevel = Math.floor(this.mapView.zoomLevel);\n        if (decodedTile.textPathGeometries !== undefined) {\n            this.m_preparedTextPaths = this.prepareTextPaths(decodedTile.textPathGeometries);\n            // Compute maximum street length (squared). Longer streets should be labelled first,\n            // they have a higher chance of being placed in case the number of text elements is\n            // limited.\n            let maxPathLengthSqr = 0;\n            for (const textPath of this.preparedTextPaths) {\n                const technique = decodedTile.techniques[textPath.technique];\n                if (!harp_datasource_protocol_1.isTextTechnique(technique)) {\n                    continue;\n                }\n                if (textPath.pathLengthSqr > maxPathLengthSqr) {\n                    maxPathLengthSqr = textPath.pathLengthSqr;\n                }\n            }\n            for (const textPath of this.preparedTextPaths) {\n                const technique = decodedTile.techniques[textPath.technique];\n                if (!harp_datasource_protocol_1.isTextTechnique(technique)) {\n                    continue;\n                }\n                const path = [];\n                for (let i = 0; i < textPath.path.length; i += 3) {\n                    path.push(new THREE.Vector2(textPath.path[i], textPath.path[i + 1]));\n                }\n                // Make sorting stable and make pathLengthSqr a differentiator for placement.\n                const priority = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.priority, displayZoomLevel), 0) +\n                    (maxPathLengthSqr > 0\n                        ? (SORT_WEIGHT_PATH_LENGTH * textPath.pathLengthSqr) / maxPathLengthSqr\n                        : 0);\n                const textElement = new TextElement_1.TextElement(harp_text_canvas_1.ContextualArabicConverter.instance.convert(textPath.text), path, this.getRenderStyle(technique), this.getLayoutStyle(technique), priority, technique.xOffset !== undefined ? technique.xOffset : 0.0, technique.yOffset !== undefined ? technique.yOffset : 0.0, textPath.featureId, technique.style, harp_datasource_protocol_1.getPropertyValue(technique.fadeNear, displayZoomLevel), harp_datasource_protocol_1.getPropertyValue(technique.fadeFar, displayZoomLevel));\n                textElement.minZoomLevel =\n                    technique.minZoomLevel !== undefined\n                        ? technique.minZoomLevel\n                        : this.mapView.minZoomLevel;\n                textElement.maxZoomLevel =\n                    technique.maxZoomLevel !== undefined\n                        ? technique.maxZoomLevel\n                        : this.mapView.maxZoomLevel;\n                textElement.distanceScale =\n                    technique.distanceScale !== undefined\n                        ? technique.distanceScale\n                        : TextElementsRenderer_1.DEFAULT_TEXT_DISTANCE_SCALE;\n                textElement.mayOverlap = technique.mayOverlap === true;\n                textElement.reserveSpace = technique.reserveSpace !== false;\n                this.addTextElement(textElement);\n            }\n        }\n        if (decodedTile.textGeometries !== undefined) {\n            for (const text of decodedTile.textGeometries) {\n                if (text.technique === undefined || text.stringCatalog === undefined) {\n                    continue;\n                }\n                const technique = decodedTile.techniques[text.technique];\n                if (!harp_datasource_protocol_1.isTextTechnique(technique)) {\n                    continue;\n                }\n                const positions = new THREE.BufferAttribute(new Float32Array(text.positions.buffer), text.positions.itemCount);\n                const numPositions = positions.count;\n                if (numPositions < 1) {\n                    continue;\n                }\n                const priority = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.priority, displayZoomLevel), 0);\n                for (let i = 0; i < numPositions; ++i) {\n                    const x = positions.getX(i);\n                    const y = positions.getY(i);\n                    const label = text.stringCatalog[text.texts[i]];\n                    if (label === undefined) {\n                        // skip missing labels\n                        continue;\n                    }\n                    const textElement = new TextElement_1.TextElement(harp_text_canvas_1.ContextualArabicConverter.instance.convert(label), new THREE.Vector2(x, y), this.getRenderStyle(technique), this.getLayoutStyle(technique), priority, technique.xOffset || 0.0, technique.yOffset || 0.0, text.featureId, technique.style);\n                    textElement.minZoomLevel =\n                        technique.minZoomLevel !== undefined\n                            ? technique.minZoomLevel\n                            : this.mapView.minZoomLevel;\n                    textElement.maxZoomLevel =\n                        technique.maxZoomLevel !== undefined\n                            ? technique.maxZoomLevel\n                            : this.mapView.maxZoomLevel;\n                    textElement.mayOverlap = technique.mayOverlap === true;\n                    textElement.reserveSpace = technique.reserveSpace !== false;\n                    textElement.fadeNear = harp_datasource_protocol_1.getPropertyValue(technique.fadeNear, displayZoomLevel);\n                    textElement.fadeFar = harp_datasource_protocol_1.getPropertyValue(technique.fadeFar, displayZoomLevel);\n                    this.addTextElement(textElement);\n                }\n            }\n        }\n    }\n    /**\n     * Adds a THREE object to the root of the tile. Sets the owning tiles datasource.name and the\n     * tileKey in the `userData` property of the object, such that the tile it belongs to can be\n     * identified during picking.\n     *\n     * @param object The object to add to the root of the tile.\n     */\n    registerTileObject(object) {\n        const userData = object.userData || {};\n        userData.tileKey = this.tileKey;\n        userData.dataSource = this.dataSource.name;\n    }\n    createPlane(width, height, planeCenter, colorHex, isVisible) {\n        const geometry = new THREE.PlaneGeometry(width, height, 1);\n        // TODO cache the material HARP-4207\n        const material = new harp_materials_1.MapMeshBasicMaterial({\n            color: colorHex,\n            visible: isVisible\n        });\n        const plane = new THREE.Mesh(geometry, material);\n        plane.position.copy(planeCenter);\n        // Render before everything else\n        plane.renderOrder = Number.MIN_SAFE_INTEGER;\n        return plane;\n    }\n    /**\n     * Creates `Tile` objects from the decoded tile and list of materials specified.\n     *\n     * @param decodedTile The [[DecodedTile]].\n     * @param objects The current list of tile objects.\n     */\n    createObjects(decodedTile, objects) {\n        const materials = [];\n        const displayZoomLevel = this.mapView.zoomLevel;\n        if (this.dataSource.addTileBackground) {\n            this.addGroundPlane();\n        }\n        for (const srcGeometry of decodedTile.geometries) {\n            const groups = srcGeometry.groups;\n            const groupCount = groups.length;\n            for (let groupIndex = 0; groupIndex < groupCount;) {\n                const group = groups[groupIndex++];\n                const start = group.start;\n                const techniqueIndex = group.technique;\n                const technique = decodedTile.techniques[techniqueIndex];\n                let count = group.count;\n                // compress consecutive groups\n                for (; groupIndex < groupCount && groups[groupIndex].technique === techniqueIndex; ++groupIndex) {\n                    if (start + count !== groups[groupIndex].start) {\n                        break;\n                    }\n                    count += groups[groupIndex].count;\n                }\n                const ObjectCtor = DecodedTileHelpers_1.getObjectConstructor(technique);\n                if (ObjectCtor === undefined) {\n                    continue;\n                }\n                let material = materials[techniqueIndex];\n                if (material === undefined) {\n                    const onMaterialUpdated = (texture) => {\n                        this.dataSource.requestUpdate();\n                        if (texture !== undefined) {\n                            this.addOwnedTexture(texture);\n                        }\n                    };\n                    material = DecodedTileHelpers_1.createMaterial({\n                        technique,\n                        level: Math.floor(displayZoomLevel),\n                        fog: this.mapView.scene.fog !== null\n                    }, onMaterialUpdated);\n                    if (material === undefined) {\n                        continue;\n                    }\n                    materials[techniqueIndex] = material;\n                }\n                // Modify the standard textured shader to support height-based coloring.\n                if (harp_datasource_protocol_1.isTerrainTechnique(technique) &&\n                    technique.heightBasedColors !== undefined &&\n                    technique.displacementMap !== undefined) {\n                    material.onBeforeCompile = (shader) => {\n                        shader.fragmentShader = shader.fragmentShader.replace(\"#include <map_pars_fragment>\", `#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;`);\n                        shader.fragmentShader = shader.fragmentShader.replace(\"#include <map_fragment>\", `#ifdef USE_MAP\n    float minElevation = ${harp_geoutils_1.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${harp_geoutils_1.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`);\n                    };\n                }\n                const bufferGeometry = new THREE.BufferGeometry();\n                srcGeometry.vertexAttributes.forEach((vertexAttribute) => {\n                    const buffer = DecodedTileHelpers_1.getBufferAttribute(vertexAttribute);\n                    bufferGeometry.addAttribute(vertexAttribute.name, buffer);\n                });\n                if (srcGeometry.interleavedVertexAttributes !== undefined) {\n                    srcGeometry.interleavedVertexAttributes.forEach((attr) => {\n                        const ArrayCtor = harp_datasource_protocol_1.getArrayConstructor(attr.type);\n                        const buffer = new THREE.InterleavedBuffer(new ArrayCtor(attr.buffer), attr.stride);\n                        attr.attributes.forEach((interleavedAttr) => {\n                            const attribute = new THREE.InterleavedBufferAttribute(buffer, interleavedAttr.itemSize, interleavedAttr.offset, false);\n                            bufferGeometry.addAttribute(interleavedAttr.name, attribute);\n                        });\n                    });\n                }\n                if (srcGeometry.index) {\n                    bufferGeometry.setIndex(DecodedTileHelpers_1.getBufferAttribute(srcGeometry.index));\n                }\n                if (!bufferGeometry.getAttribute(\"normal\") && harp_datasource_protocol_1.needsVertexNormals(technique)) {\n                    bufferGeometry.computeVertexNormals();\n                }\n                bufferGeometry.addGroup(start, count);\n                if (harp_datasource_protocol_1.isSolidLineTechnique(technique) || harp_datasource_protocol_1.isDashedLineTechnique(technique)) {\n                    const lineMaterial = material;\n                    lineMaterial.uniforms.opacity.value = material.opacity;\n                    if (technique.clipping !== false) {\n                        const tileSize = lineMaterial.uniforms.tileSize;\n                        const size = new THREE.Vector3();\n                        this.boundingBox.getSize(size);\n                        tileSize.value.x = size.x;\n                        tileSize.value.y = size.y;\n                        lineMaterial.defines.TILE_CLIP = 1;\n                    }\n                }\n                // Add polygon offset to the extruded buildings and to the fill area to avoid depth\n                // problems when rendering edges.\n                const hasExtrudedOutlines = harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) && srcGeometry.edgeIndex !== undefined;\n                const hasFillOutlines = harp_datasource_protocol_1.isFillTechnique(technique) && srcGeometry.edgeIndex !== undefined;\n                if (hasExtrudedOutlines || hasFillOutlines) {\n                    material.polygonOffset = true;\n                    material.polygonOffsetFactor = 0.75;\n                    material.polygonOffsetUnits = 4.0;\n                }\n                // Add the solid line outlines as a separate object.\n                const hasSolidLinesOutlines = harp_datasource_protocol_1.isSolidLineTechnique(technique) && technique.secondaryWidth !== undefined;\n                const object = new ObjectCtor(bufferGeometry, material);\n                object.frustumCulled = false;\n                object.renderOrder = technique.renderOrder;\n                if (group.renderOrderOffset !== undefined) {\n                    object.renderOrder += group.renderOrderOffset;\n                }\n                if (srcGeometry.uuid !== undefined) {\n                    object.userData.geometryId = srcGeometry.uuid;\n                }\n                if ((harp_datasource_protocol_1.isCirclesTechnique(technique) || harp_datasource_protocol_1.isSquaresTechnique(technique)) &&\n                    technique.enablePicking !== undefined) {\n                    // tslint:disable-next-line:max-line-length\n                    object.enableRayTesting = technique.enablePicking;\n                }\n                // Lines renderOrder fix: Render them as transparent objects, but make sure they end\n                // up in the opaque rendering queue (by disabling transparency onAfterRender, and\n                // enabling it onBeforeRender).\n                if (harp_datasource_protocol_1.isSolidLineTechnique(technique) || harp_datasource_protocol_1.isDashedLineTechnique(technique)) {\n                    const fadingParams = this.getFadingParams(technique);\n                    harp_materials_1.FadingFeature.addRenderHelper(object, fadingParams.fadeNear, fadingParams.fadeFar, true, false, (renderer, mat) => {\n                        const lineMaterial = mat;\n                        const metricUnits = harp_datasource_protocol_1.getPropertyValue(technique.metricUnit, this.tileKey.level);\n                        const unitFactor = metricUnits === \"Pixel\" ? this.mapView.pixelToWorld * 0.5 : 1.0;\n                        lineMaterial.lineWidth =\n                            harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.lineWidth, this.mapView.zoomLevel), harp_materials_1.SolidLineMaterial.DEFAULT_WIDTH) * unitFactor;\n                        // Do the same for dashSize and gapSize for dashed lines.\n                        if (harp_datasource_protocol_1.isDashedLineTechnique(technique)) {\n                            const dashedLineMaterial = lineMaterial;\n                            dashedLineMaterial.dashSize =\n                                harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.dashSize, this.mapView.zoomLevel), harp_materials_1.DashedLineMaterial.DEFAULT_DASH_SIZE) * unitFactor;\n                            dashedLineMaterial.gapSize =\n                                harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.gapSize, this.mapView.zoomLevel), harp_materials_1.DashedLineMaterial.DEFAULT_GAP_SIZE) * unitFactor;\n                        }\n                    });\n                }\n                if (harp_datasource_protocol_1.isExtrudedLineTechnique(technique)) {\n                    // extruded lines are normal meshes, and need transparency only when fading\n                    // is defined.\n                    if (technique.fadeFar !== undefined) {\n                        const fadingParams = this.getFadingParams(technique);\n                        harp_materials_1.FadingFeature.addRenderHelper(object, fadingParams.fadeNear, fadingParams.fadeFar, true, true);\n                    }\n                }\n                this.addFeatureData(srcGeometry, technique, object);\n                if (harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) || harp_datasource_protocol_1.isFillTechnique(technique)) {\n                    // filled polygons are normal meshes, and need transparency only when fading is\n                    // defined.\n                    if (technique.fadeFar !== undefined) {\n                        const fadingParams = this.getFadingParams(technique);\n                        harp_materials_1.FadingFeature.addRenderHelper(object, fadingParams.fadeNear, fadingParams.fadeFar, true, true);\n                    }\n                }\n                const extrudedObjects = [];\n                const animatedExtrusionHandler = this.mapView.animatedExtrusionHandler;\n                let extrusionAnimatonEnabled = false;\n                if (harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) &&\n                    animatedExtrusionHandler !== undefined) {\n                    extrusionAnimatonEnabled =\n                        technique.animateExtrusion !== undefined &&\n                            animatedExtrusionHandler.forceEnabled === false\n                            ? technique.animateExtrusion\n                            : animatedExtrusionHandler.enabled;\n                }\n                const renderDepthPrePass = harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) && DepthPrePass_1.isRenderDepthPrePassEnabled(technique);\n                if (renderDepthPrePass) {\n                    const depthPassMesh = DepthPrePass_1.createDepthPrePassMesh(object);\n                    objects.push(depthPassMesh);\n                    if (extrusionAnimatonEnabled) {\n                        extrudedObjects.push({\n                            object: depthPassMesh,\n                            materialFeature: true\n                        });\n                    }\n                    DepthPrePass_1.setDepthPrePassStencil(depthPassMesh, object);\n                }\n                this.registerTileObject(object);\n                objects.push(object);\n                // Add the extruded building edges as a separate geometry.\n                if (hasExtrudedOutlines) {\n                    const edgeGeometry = new THREE.BufferGeometry();\n                    edgeGeometry.addAttribute(\"position\", bufferGeometry.getAttribute(\"position\"));\n                    const colorAttribute = bufferGeometry.getAttribute(\"color\");\n                    if (colorAttribute !== undefined) {\n                        edgeGeometry.addAttribute(\"color\", colorAttribute);\n                    }\n                    edgeGeometry.setIndex(DecodedTileHelpers_1.getBufferAttribute(srcGeometry.edgeIndex));\n                    // Read the uniforms from the technique values (and apply the default values).\n                    const extrudedPolygonTechnique = technique;\n                    const fadingParams = this.getPolygonFadingParams(extrudedPolygonTechnique);\n                    // Configure the edge material based on the theme values.\n                    const materialParams = {\n                        color: fadingParams.color,\n                        colorMix: fadingParams.colorMix,\n                        fadeNear: fadingParams.lineFadeNear,\n                        fadeFar: fadingParams.lineFadeFar\n                    };\n                    const edgeMaterial = new harp_materials_1.EdgeMaterial(materialParams);\n                    const edgeObj = new THREE.LineSegments(edgeGeometry, edgeMaterial);\n                    // Set the correct render order.\n                    edgeObj.renderOrder = object.renderOrder + 0.1;\n                    harp_materials_1.FadingFeature.addRenderHelper(edgeObj, fadingParams.lineFadeNear, fadingParams.lineFadeFar, false, false);\n                    if (extrusionAnimatonEnabled) {\n                        extrudedObjects.push({\n                            object: edgeObj,\n                            materialFeature: false\n                        });\n                    }\n                    this.registerTileObject(edgeObj);\n                    objects.push(edgeObj);\n                }\n                // animate the extrusion of buildings\n                if (harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) && extrusionAnimatonEnabled) {\n                    extrudedObjects.push({\n                        object,\n                        materialFeature: true\n                    });\n                    const extrusionAnimatonDuration = technique.animateExtrusionDuration !== undefined &&\n                        animatedExtrusionHandler.forceEnabled === false\n                        ? technique.animateExtrusionDuration\n                        : animatedExtrusionHandler.duration;\n                    this.m_animatedExtrusionTileHandler = new AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler(this, extrudedObjects, extrusionAnimatonDuration);\n                    this.mapView.animatedExtrusionHandler.add(this.m_animatedExtrusionTileHandler);\n                }\n                // Add the fill area edges as a separate geometry.\n                if (hasFillOutlines) {\n                    const edgeIndexBuffers = srcGeometry.edgeIndex;\n                    for (const edgeIndexBufferAttribute of edgeIndexBuffers) {\n                        const outlineGeometry = new THREE.BufferGeometry();\n                        outlineGeometry.addAttribute(\"position\", bufferGeometry.getAttribute(\"position\"));\n                        outlineGeometry.setIndex(DecodedTileHelpers_1.getBufferAttribute(edgeIndexBufferAttribute));\n                        const fillTechnique = technique;\n                        const fadingParams = this.getPolygonFadingParams(fillTechnique);\n                        // Configure the edge material based on the theme values.\n                        const materialParams = {\n                            color: fadingParams.color,\n                            colorMix: fadingParams.colorMix,\n                            fadeNear: fadingParams.lineFadeNear,\n                            fadeFar: fadingParams.lineFadeFar\n                        };\n                        const outlineMaterial = new harp_materials_1.EdgeMaterial(materialParams);\n                        const outlineObj = new THREE.LineSegments(outlineGeometry, outlineMaterial);\n                        outlineObj.renderOrder = object.renderOrder + 0.1;\n                        harp_materials_1.FadingFeature.addRenderHelper(outlineObj, fadingParams.lineFadeNear, fadingParams.lineFadeFar, true, false);\n                        this.registerTileObject(outlineObj);\n                        objects.push(outlineObj);\n                    }\n                }\n                // Add the fill area edges as a separate geometry.\n                if (hasSolidLinesOutlines) {\n                    const outlineTechnique = technique;\n                    const outlineMaterial = material.clone();\n                    const outlineColor = ColorCache_1.ColorCache.instance.getColor(harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(outlineTechnique.secondaryColor, Math.floor(this.mapView.zoomLevel)), \"#000000\"));\n                    outlineMaterial.uniforms.diffuse.value = outlineColor;\n                    const outlineObj = new ObjectCtor(bufferGeometry, outlineMaterial);\n                    outlineObj.renderOrder =\n                        outlineTechnique.secondaryRenderOrder !== undefined\n                            ? outlineTechnique.secondaryRenderOrder\n                            : technique.renderOrder - 0.0000001;\n                    if (group.renderOrderOffset !== undefined) {\n                        outlineObj.renderOrder += group.renderOrderOffset;\n                    }\n                    const fadingParams = this.getFadingParams(technique);\n                    harp_materials_1.FadingFeature.addRenderHelper(outlineObj, fadingParams.fadeNear, fadingParams.fadeFar, true, false, (renderer, mat) => {\n                        const lineMaterial = mat;\n                        const metricUnits = harp_datasource_protocol_1.getPropertyValue(outlineTechnique.metricUnit, this.tileKey.level);\n                        const unitFactor = metricUnits === \"Pixel\" ? this.mapView.pixelToWorld * 0.5 : 1.0;\n                        lineMaterial.lineWidth =\n                            harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(outlineTechnique.secondaryWidth, this.mapView.zoomLevel), harp_materials_1.SolidLineMaterial.DEFAULT_WIDTH) * unitFactor;\n                    });\n                    this.registerTileObject(outlineObj);\n                    objects.push(outlineObj);\n                }\n            }\n        }\n    }\n    /**\n     * Counts the number of vertices in a tile.\n     */\n    countVertices() {\n        let numVertices = 0;\n        this.objects\n            .filter(object => object instanceof THREE.Mesh)\n            .forEach(object => {\n            const mesh = object;\n            if (mesh.geometry instanceof THREE.BufferGeometry) {\n                if (mesh.geometry.index !== undefined && mesh.geometry.index !== null) {\n                    numVertices += mesh.geometry.index.count;\n                }\n                else {\n                    numVertices += mesh.geometry.getAttribute(\"position\").count / 3;\n                }\n            }\n            if (mesh.geometry instanceof THREE.Geometry) {\n                numVertices = mesh.geometry.vertices.length;\n            }\n        });\n        return numVertices;\n    }\n    /**\n     * Missing Typedoc\n     */\n    preparePois(decodedTile) {\n        if (decodedTile.poiGeometries !== undefined) {\n            this.mapView.poiManager.addPois(this, decodedTile);\n        }\n    }\n    /**\n     * Gets the appropriate [[TextRenderStyle]] to use for a label. Depends heavily on the label's\n     * [[Technique]] and the current zoomLevel.\n     *\n     * @param technique Label's technique.\n     * @param techniqueIdx Label's technique index.\n     */\n    getRenderStyle(technique) {\n        const cacheId = TextStyleCache_1.computeStyleCacheId(this.dataSource.name, technique, this.mapView.zoomLevel);\n        let renderStyle = this.mapView.textRenderStyleCache.get(cacheId);\n        if (renderStyle === undefined) {\n            const defaultRenderParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.defaultStyle.renderParams\n                : {\n                    fontSize: {\n                        unit: harp_text_canvas_1.FontUnit.Pixel,\n                        size: 32,\n                        backgroundSize: 8\n                    }\n                };\n            const textSize = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.size, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.fontSize.size);\n            const bgSize = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.backgroundSize, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.fontSize.backgroundSize);\n            const hexColor = harp_datasource_protocol_1.getPropertyValue(technique.color, Math.floor(this.mapView.zoomLevel));\n            if (hexColor !== undefined) {\n                this.m_colorMap.set(cacheId, ColorCache_1.ColorCache.instance.getColor(hexColor));\n            }\n            const styleColor = harp_utils_1.getOptionValue(this.m_colorMap.get(cacheId), defaultRenderParams.color);\n            const hexBgColor = harp_datasource_protocol_1.getPropertyValue(technique.backgroundColor, Math.floor(this.mapView.zoomLevel));\n            if (hexBgColor !== undefined) {\n                this.m_colorMap.set(cacheId + \"_bg\", ColorCache_1.ColorCache.instance.getColor(hexBgColor));\n            }\n            const styleBgColor = harp_utils_1.getOptionValue(this.m_colorMap.get(cacheId + \"_bg\"), defaultRenderParams.backgroundColor);\n            const bgAlpha = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.backgroundAlpha, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.backgroundOpacity);\n            const isSmallCaps = technique.smallCaps === true ||\n                defaultRenderParams.fontVariant === harp_text_canvas_1.FontVariant.SmallCaps;\n            const isAllCaps = technique.allCaps === true ||\n                defaultRenderParams.fontVariant === harp_text_canvas_1.FontVariant.AllCaps;\n            const styleFontVariant = isSmallCaps\n                ? harp_text_canvas_1.FontVariant.SmallCaps\n                : isAllCaps\n                    ? harp_text_canvas_1.FontVariant.AllCaps\n                    : undefined;\n            const styleFontStyle = technique.bold === true\n                ? technique.oblique\n                    ? harp_text_canvas_1.FontStyle.BoldItalic\n                    : harp_text_canvas_1.FontStyle.Bold\n                : technique.oblique === true\n                    ? harp_text_canvas_1.FontStyle.Italic\n                    : defaultRenderParams.fontStyle;\n            const renderParams = {\n                fontSize: {\n                    unit: harp_text_canvas_1.FontUnit.Pixel,\n                    size: textSize,\n                    backgroundSize: bgSize\n                },\n                color: styleColor,\n                backgroundColor: styleBgColor,\n                backgroundOpacity: bgAlpha,\n                fontVariant: styleFontVariant,\n                fontStyle: styleFontStyle\n            };\n            const themeRenderParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.getTextElementStyle(technique.style)\n                    .renderParams\n                : {};\n            renderStyle = new harp_text_canvas_1.TextRenderStyle(Object.assign({}, themeRenderParams, renderParams));\n            this.mapView.textRenderStyleCache.set(cacheId, renderStyle);\n        }\n        return renderStyle;\n    }\n    /**\n     * Gets the appropriate [[TextRenderStyle]] to use for a label. Depends heavily on the label's\n     * [[Technique]] and the current zoomLevel.\n     *\n     * @param technique Label's technique.\n     */\n    getLayoutStyle(technique) {\n        const cacheId = TextStyleCache_1.computeStyleCacheId(this.dataSource.name, technique, this.mapView.zoomLevel);\n        let layoutStyle = this.mapView.textLayoutStyleCache.get(cacheId);\n        if (layoutStyle === undefined) {\n            const defaultLayoutParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.defaultStyle.layoutParams\n                : {};\n            const trackingFactor = harp_utils_1.getOptionValue(technique.tracking, defaultLayoutParams.tracking);\n            let hAlignment = defaultLayoutParams.horizontalAlignment;\n            if (technique.hAlignment === \"Left\" ||\n                technique.hAlignment === \"Center\" ||\n                technique.hAlignment === \"Right\") {\n                hAlignment = harp_text_canvas_1.HorizontalAlignment[technique.hAlignment];\n            }\n            let vAlignment = defaultLayoutParams.verticalAlignment;\n            if (technique.vAlignment === \"Above\" ||\n                technique.vAlignment === \"Center\" ||\n                technique.vAlignment === \"Below\") {\n                vAlignment = harp_text_canvas_1.VerticalAlignment[technique.vAlignment];\n            }\n            const layoutParams = {\n                tracking: trackingFactor,\n                horizontalAlignment: hAlignment,\n                verticalAlignment: vAlignment\n            };\n            const themeLayoutParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.getTextElementStyle(technique.style)\n                    .layoutParams\n                : {};\n            layoutStyle = new harp_text_canvas_1.TextLayoutStyle(Object.assign({}, themeLayoutParams, layoutParams));\n            this.mapView.textLayoutStyleCache.set(cacheId, layoutStyle);\n        }\n        return layoutStyle;\n    }\n    computeResourceInfo() {\n        let heapSize = 0;\n        let num3dObjects = 0;\n        let numTextElements = 0;\n        let numUserTextElements = 0;\n        const aggregatedObjSize = {\n            heapSize: 0,\n            gpuSize: 0\n        };\n        // Keep a map of the uuids of the larger objects, like Geometries, Materials and Attributes.\n        // They should be counted only once even if they are shared.\n        const visitedObjects = new Map();\n        for (const object of this.objects) {\n            if (object.visible) {\n                num3dObjects++;\n            }\n            Utils_1.MapViewUtils.estimateObject3dSize(object, aggregatedObjSize, visitedObjects);\n        }\n        for (const group of this.textElementGroups.groups) {\n            numTextElements += group[1].elements.length;\n        }\n        numUserTextElements = this.userTextElements.length;\n        // 216 was the shallow size of a single TextElement last time it has been checked, 312 bytes\n        // was the minimum retained size of a TextElement that was not being rendered. If a\n        // TextElement is actually rendered, the size may be _much_ bigger.\n        heapSize += (numTextElements + numUserTextElements) * 312;\n        if (this.m_decodedTile !== undefined && this.m_decodedTile.tileInfo !== undefined) {\n            aggregatedObjSize.heapSize += this.m_decodedTile.tileInfo.numBytes;\n        }\n        if (this.roadIntersectionData !== undefined) {\n            heapSize += getRoadIntersectionDataSize(this.roadIntersectionData);\n        }\n        this.m_resourceInfo = {\n            heapSize: aggregatedObjSize.heapSize + heapSize,\n            gpuSize: aggregatedObjSize.gpuSize,\n            num3dObjects,\n            numTextElements,\n            numUserTextElements\n        };\n    }\n    /**\n     * Pass the feature data on to the object, so it can be used in picking\n     * `MapView.intersectMapObjects()`. Do not pass the feature data if the technique is a\n     * dashed-line or a solid-line, because the line picking functionality for the lines is not\n     * object based, but tile based.\n     *\n     * @param srcGeometry The original [[Geometry]].\n     * @param technique The corresponding [[Technique]].\n     * @param object The object to pass info to.\n     */\n    addFeatureData(srcGeometry, technique, object) {\n        if (((srcGeometry.featureIds !== undefined && srcGeometry.featureIds.length > 0) ||\n            harp_datasource_protocol_1.isCirclesTechnique(technique) ||\n            harp_datasource_protocol_1.isSquaresTechnique(technique)) &&\n            !harp_datasource_protocol_1.isSolidLineTechnique(technique) &&\n            !harp_datasource_protocol_1.isDashedLineTechnique(technique)) {\n            const featureData = {\n                geometryType: srcGeometry.type,\n                ids: srcGeometry.featureIds,\n                starts: srcGeometry.featureStarts\n            };\n            object.userData.feature = featureData;\n            if (srcGeometry.objInfos !== undefined) {\n                object.userData.feature.objInfos = srcGeometry.objInfos;\n            }\n        }\n    }\n    /**\n     * Gets the fading parameters for several kinds of objects.\n     */\n    getFadingParams(technique) {\n        const displayZoomLevel = this.mapView.zoomLevel;\n        const fadeNear = technique.fadeNear !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.fadeNear, displayZoomLevel)\n            : harp_materials_1.FadingFeature.DEFAULT_FADE_NEAR;\n        const fadeFar = technique.fadeFar !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.fadeFar, displayZoomLevel)\n            : harp_materials_1.FadingFeature.DEFAULT_FADE_FAR;\n        return {\n            fadeNear,\n            fadeFar\n        };\n    }\n    /**\n     * Gets the fading parameters for several kinds of objects.\n     */\n    getPolygonFadingParams(technique) {\n        let color = harp_materials_1.EdgeMaterial.DEFAULT_COLOR;\n        let colorMix = harp_materials_1.EdgeMaterial.DEFAULT_COLOR_MIX;\n        if (technique.lineColor !== undefined) {\n            color = technique.lineColor;\n            if (harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique)) {\n                const extrudedPolygonTechnique = technique;\n                colorMix =\n                    extrudedPolygonTechnique.lineColorMix !== undefined\n                        ? extrudedPolygonTechnique.lineColorMix\n                        : harp_materials_1.EdgeMaterial.DEFAULT_COLOR_MIX;\n            }\n        }\n        const displayZoomLevel = this.mapView.zoomLevel;\n        const fadeNear = technique.fadeNear !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.fadeNear, displayZoomLevel)\n            : harp_materials_1.FadingFeature.DEFAULT_FADE_NEAR;\n        const fadeFar = technique.fadeFar !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.fadeFar, displayZoomLevel)\n            : harp_materials_1.FadingFeature.DEFAULT_FADE_FAR;\n        const lineFadeNear = technique.lineFadeNear !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.lineFadeNear, displayZoomLevel)\n            : fadeNear;\n        const lineFadeFar = technique.lineFadeFar !== undefined\n            ? harp_datasource_protocol_1.getPropertyValue(technique.lineFadeFar, displayZoomLevel)\n            : fadeFar;\n        return {\n            color,\n            colorMix,\n            fadeNear,\n            fadeFar,\n            lineFadeNear,\n            lineFadeFar\n        };\n    }\n    /**\n     * Creates and add a background plane for the tile.\n     */\n    addGroundPlane() {\n        // Add a ground plane to the tile.\n        const planeSize = new THREE.Vector3();\n        this.boundingBox.getSize(planeSize);\n        const groundPlane = this.createPlane(planeSize.x, planeSize.y, this.center, this.dataSource.tileBackgroundColor === undefined\n            ? this.mapView.clearColor\n            : this.dataSource.tileBackgroundColor, this.dataSource.tileBackgroundIsVisible);\n        this.registerTileObject(groundPlane);\n        this.objects.push(groundPlane);\n    }\n}\nexports.Tile = Tile;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TextureCoordinateType;\n(function (TextureCoordinateType) {\n    /**\n     * Texture coordinates are in tile space.\n     * SW of the tile will have (0,0) and NE will have (1,1).\n     */\n    TextureCoordinateType[\"TileSpace\"] = \"tile-space\";\n    /**\n     * Texture coordinates are in equirectangular space.\n     * (u, v) = ( (longitude+180) / 360, (latitude+90) / 180).\n     */\n    TextureCoordinateType[\"EquirectangularSpace\"] = \"equirectangular-space\";\n})(TextureCoordinateType = exports.TextureCoordinateType || (exports.TextureCoordinateType = {}));\n/**\n * Define the stacking option. Enum values for theme file are in \"kebab-case\".\n */\nvar PoiStackMode;\n(function (PoiStackMode) {\n    /**\n     * Show in a stack.\n     */\n    PoiStackMode[\"Show\"] = \"show-in-stack\";\n    /**\n     * Do not show in a stack.\n     */\n    PoiStackMode[\"Hide\"] = \"hide-in-stack\";\n    /**\n     * Show category parent in the stack.\n     */\n    PoiStackMode[\"ShowParent\"] = \"show-parent\";\n})(PoiStackMode = exports.PoiStackMode || (exports.PoiStackMode = {}));\n/**\n * Type guard to check if an object is an instance of `TextureBuffer`.\n */\nfunction isTextureBuffer(object) {\n    return object && object.buffer && typeof object.type === \"string\";\n}\nexports.isTextureBuffer = isTextureBuffer;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\nconst three_1 = require(\"three\");\nconst interpolants = [three_1.DiscreteInterpolant, three_1.LinearInterpolant, three_1.CubicInterpolant];\n/**\n * Get the value of the specified property at the given zoom level. Handles [[InterpolatedProperty]]\n * instances as well as future interpolated values.\n *\n * @param property Property of a technique.\n * @param level Display level the property should be rendered at.\n */\nfunction getPropertyValue(property, level) {\n    if (!isInterpolatedProperty(property)) {\n        if (isInterpolatedPropertyDefinition(property)) {\n            throw new Error(\"Invalid property definition\");\n        }\n        return property;\n    }\n    else {\n        const nChannels = property.values.length / property.zoomLevels.length;\n        const isMultiChannel = nChannels > 1;\n        const interpolant = new interpolants[property.interpolationMode](property.zoomLevels, property.values, nChannels);\n        interpolant.evaluate(level);\n        let result = isMultiChannel ? \"#\" : 0;\n        for (const value of interpolant.resultBuffer) {\n            // tslint:disable:no-bitwise\n            const val = isMultiChannel\n                ? (\"0\" + ((harp_geoutils_1.MathUtils.clamp(value, 0, 1) * 255) | 0).toString(16)).slice(-2)\n                : value;\n            result += val;\n        }\n        return result;\n    }\n}\nexports.getPropertyValue = getPropertyValue;\n/**\n * Checks if a property is interpolated.\n * @param p property to be checked\n */\nfunction isInterpolatedPropertyDefinition(p) {\n    if (p !== undefined &&\n        p.values instanceof Array &&\n        p.values.length > 0 &&\n        p.values[0] !== undefined &&\n        p.zoomLevels instanceof Array &&\n        p.zoomLevels.length > 0 &&\n        p.zoomLevels[0] !== undefined &&\n        p.values.length === p.zoomLevels.length) {\n        return true;\n    }\n    return false;\n}\nexports.isInterpolatedPropertyDefinition = isInterpolatedPropertyDefinition;\n/**\n * Type guard to check if an object is an instance of `InterpolatedProperty`.\n */\nfunction isInterpolatedProperty(p) {\n    if (p !== undefined &&\n        p.interpolationMode !== undefined &&\n        p.zoomLevels !== undefined &&\n        p.values !== undefined &&\n        p.values.length > 0 &&\n        (p.zoomLevels.length === p.values.length / 3 || p.zoomLevels.length === p.values.length)) {\n        return true;\n    }\n    return false;\n}\nexports.isInterpolatedProperty = isInterpolatedProperty;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Interpolation mode used when computing a [[InterpolatedProperty]] value for a given zoom level.\n */\nvar InterpolationMode;\n(function (InterpolationMode) {\n    InterpolationMode[InterpolationMode[\"Discrete\"] = 0] = \"Discrete\";\n    InterpolationMode[InterpolationMode[\"Linear\"] = 1] = \"Linear\";\n    InterpolationMode[InterpolationMode[\"Cubic\"] = 2] = \"Cubic\";\n})(InterpolationMode = exports.InterpolationMode || (exports.InterpolationMode = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst SdfShaderChunks = {\n    sdf_attributes: `\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        `,\n    sdf_varying: `\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        `,\n    sdf_varying_computation: `\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        `,\n    sdf_frag_uniforms: `\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        `,\n    sdf_sampling_functions: `\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 sample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(sample.r, sample.g, sample.b);\n            #else\n            return sample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        `\n};\nObject.assign(THREE.ShaderChunk, SdfShaderChunks);\nconst clearVertexSource = `\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }`;\nconst clearFragmentSource = `\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }`;\nconst copyVertexSource = `\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }`;\nconst copyFragmentSource = `\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 sample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy);\n        else sample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = sample;\n    }`;\nconst sdfTextVertexSource = `\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }`;\nconst sdfTextFragmentSource = `\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }`;\n/**\n * @hidden\n * Material used for clearing glyphs from a [[GlyphTextureCache]].\n */\nclass GlyphClearMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Creates a new `GlyphClearMaterial`.\n     *\n     * @returns New `GlyphClearMaterial`.\n     */\n    constructor() {\n        const shaderParams = {\n            name: \"GlyphClearMaterial\",\n            vertexShader: clearVertexSource,\n            fragmentShader: clearFragmentSource,\n            uniforms: {},\n            depthTest: false,\n            depthWrite: false\n        };\n        super(shaderParams);\n    }\n}\nexports.GlyphClearMaterial = GlyphClearMaterial;\n/**\n * @hidden\n * Material used for copying glyphs into a [[GlyphTextureCache]].\n */\nclass GlyphCopyMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Creates a new `GlyphCopyMaterial`.\n     *\n     * @returns New `GlyphCopyMaterial`.\n     */\n    constructor() {\n        const shaderParams = {\n            name: \"GlyphCopyMaterial\",\n            vertexShader: copyVertexSource,\n            fragmentShader: copyFragmentSource,\n            uniforms: {\n                pageOffset: new THREE.Uniform(0.0),\n                page0: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page1: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page2: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page3: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page4: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page5: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page6: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE),\n                page7: new THREE.Uniform(THREE.Texture.DEFAULT_IMAGE)\n            },\n            depthTest: false,\n            depthWrite: false\n        };\n        super(shaderParams);\n    }\n}\nexports.GlyphCopyMaterial = GlyphCopyMaterial;\n/**\n * @hidden\n * Material designed to render transformable, high quality SDF text.\n */\nclass SdfTextMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Creates a new `SdfTextMaterial`.\n     *\n     * @param params Material parameters.\n     *\n     * @returns New `SdfTextMaterial`.\n     */\n    constructor(params) {\n        const shaderParams = {\n            name: \"SdfTextMaterial\",\n            vertexShader: params.vertexSource !== undefined ? params.vertexSource : sdfTextVertexSource,\n            fragmentShader: params.fragmentSource !== undefined ? params.fragmentSource : sdfTextFragmentSource,\n            uniforms: {\n                sdfTexture: new THREE.Uniform(params.texture),\n                sdfParams: new THREE.Uniform(new THREE.Vector4(params.textureSize.x, params.textureSize.y, params.size, params.distanceRange))\n            },\n            defines: {\n                MSDF: params.isMsdf ? 1.0 : 0.0,\n                BG_TEXT: params.isBackground ? 1.0 : 0.0\n            },\n            depthTest: true,\n            depthWrite: true,\n            side: THREE.DoubleSide,\n            transparent: true\n        };\n        super(shaderParams);\n        this.extensions.derivatives = true;\n    }\n}\nexports.SdfTextMaterial = SdfTextMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Object containing vertex buffer data generated by [[TextCanvas]].\n */\nclass TextBufferObject {\n    /**\n     * Constructs a new `TextBufferObject`.\n     *\n     * @param glyphs Input glyphs.\n     * @param buffer Buffer containing the data generated by [[TextCanvas]].\n     * @param bounds Optional text bounds.\n     * @param characterBounds Optional character bounds.\n     * @param textRenderStyle [[TextRenderStyle]] applied by [[TextCanvas]].\n     * @param textLayoutStyle [[TextLayoutStyle]] applied by [[TextCanvas]].\n     *\n     * @returns New `TextBufferObject`.\n     */\n    constructor(glyphs, buffer, bounds, characterBounds, textRenderStyle, textLayoutStyle) {\n        this.glyphs = glyphs;\n        this.buffer = buffer;\n        this.bounds = bounds;\n        this.characterBounds = characterBounds;\n        this.textRenderStyle = textRenderStyle;\n        this.textLayoutStyle = textLayoutStyle;\n    }\n}\nexports.TextBufferObject = TextBufferObject;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst TextMaterials_1 = require(\"../rendering/TextMaterials\");\n/**\n * Helper function designed to create [[SdfTextMaterials]] that can be rendered using\n * [[TextCanvas]].\n *\n * @param params Material parameters.\n *\n * @returns New `SdfTextMaterial`.\n */\nfunction createSdfTextMaterial(params) {\n    return new TextMaterials_1.SdfTextMaterial({\n        texture: params.fontCatalog.texture,\n        textureSize: params.fontCatalog.textureSize,\n        size: params.fontCatalog.size,\n        distanceRange: params.fontCatalog.distanceRange,\n        isMsdf: params.fontCatalog.type === \"msdf\",\n        isBackground: params.isBackground === true,\n        vertexSource: params.vertexSource,\n        fragmentSource: params.fragmentSource\n    });\n}\nexports.createSdfTextMaterial = createSdfTextMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst MapViewPoints_1 = require(\"./MapViewPoints\");\nconst ThemeHelpers_1 = require(\"./ThemeHelpers\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"DecodedTileHelpers\");\nconst DEFAULT_SKIP_PROPERTIES = [\n    ...harp_datasource_protocol_1.TEXTURE_PROPERTY_KEYS,\n    \"mapProperties\",\n    \"normalMapProperties\",\n    \"displacementMapProperties\",\n    \"roughnessMapProperties\",\n    \"emissiveMapProperties\",\n    \"alphaMapProperties\",\n    \"metalnessMapProperties\",\n    \"bumpMapProperties\"\n];\n/**\n * Create a material, depending on the rendering technique provided in the options.\n *\n * @param options The material options the subsequent functions need.\n * @param materialUpdateCallback Optional callback when the material gets updated,\n *                               e.g. after texture loading.\n *\n * @returns new material instance that matches `technique.name`\n */\nfunction createMaterial(options, textureReadyCallback) {\n    const technique = options.technique;\n    const Constructor = getMaterialConstructor(technique);\n    const settings = {};\n    if (Constructor === undefined) {\n        return undefined;\n    }\n    if (Constructor.prototype instanceof THREE.RawShaderMaterial &&\n        Constructor !== harp_materials_1.HighPrecisionLineMaterial) {\n        settings.fog = options.fog;\n    }\n    const material = new Constructor(settings);\n    if (technique.id !== undefined) {\n        material.name = technique.id;\n    }\n    if (harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique)) {\n        material.flatShading = true;\n    }\n    material.depthTest = harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique) && technique.depthTest !== false;\n    if (harp_datasource_protocol_1.isStandardTechnique(technique) ||\n        harp_datasource_protocol_1.isTerrainTechnique(technique) ||\n        harp_datasource_protocol_1.isExtrudedPolygonTechnique(technique)) {\n        harp_datasource_protocol_1.TEXTURE_PROPERTY_KEYS.forEach((texturePropertyName) => {\n            const textureProperty = technique[texturePropertyName];\n            if (textureProperty === undefined) {\n                return;\n            }\n            const onLoad = (texture) => {\n                const properties = technique[texturePropertyName + \"Properties\"];\n                if (properties !== undefined) {\n                    if (properties.wrapS !== undefined) {\n                        texture.wrapS = ThemeHelpers_1.toWrappingMode(properties.wrapS);\n                    }\n                    if (properties.wrapT !== undefined) {\n                        texture.wrapT = ThemeHelpers_1.toWrappingMode(properties.wrapT);\n                    }\n                    if (properties.magFilter !== undefined) {\n                        texture.magFilter = ThemeHelpers_1.toTextureFilter(properties.magFilter);\n                    }\n                    if (properties.minFilter !== undefined) {\n                        texture.minFilter = ThemeHelpers_1.toTextureFilter(properties.minFilter);\n                    }\n                    if (properties.flipY !== undefined) {\n                        texture.flipY = properties.flipY;\n                    }\n                    if (properties.repeatU !== undefined) {\n                        texture.repeat.x = properties.repeatU;\n                    }\n                    if (properties.repeatV !== undefined) {\n                        texture.repeat.y = properties.repeatV;\n                    }\n                }\n                material[texturePropertyName] = texture;\n                texture.needsUpdate = true;\n                material.needsUpdate = true;\n                if (textureReadyCallback) {\n                    textureReadyCallback(texture);\n                }\n            };\n            const onError = (error) => {\n                logger.error(\"#createMaterial: Failed to load texture: \", error);\n            };\n            let textureUrl;\n            if (typeof textureProperty === \"string\") {\n                textureUrl = textureProperty;\n            }\n            else if (harp_datasource_protocol_1.isTextureBuffer(textureProperty)) {\n                if (textureProperty.type === \"image/raw\") {\n                    const properties = textureProperty.dataTextureProperties;\n                    if (properties !== undefined) {\n                        const texture = new THREE.DataTexture(textureProperty.buffer, properties.width, properties.height, properties.format ? ThemeHelpers_1.toPixelFormat(properties.format) : undefined, properties.type ? ThemeHelpers_1.toTextureDataType(properties.type) : undefined);\n                        onLoad(texture);\n                    }\n                    else {\n                        onError(\"no data texture properties provided.\");\n                    }\n                }\n                else {\n                    const textureBlob = new Blob([textureProperty.buffer], {\n                        type: textureProperty.type\n                    });\n                    textureUrl = URL.createObjectURL(textureBlob);\n                }\n            }\n            if (textureUrl) {\n                new THREE.TextureLoader().load(textureUrl, onLoad, undefined, // onProgress\n                onError);\n            }\n        });\n    }\n    if (harp_datasource_protocol_1.isShaderTechnique(technique)) {\n        // special case for ShaderTechnique.\n        // The shader technique takes the argument from its `params' member.\n        const params = technique.params;\n        Object.getOwnPropertyNames(params).forEach(property => {\n            const prop = property;\n            if (prop === \"name\") {\n                // skip reserved property names\n                return;\n            }\n            const m = material;\n            if (m[prop] instanceof THREE.Color) {\n                m[prop].set(params[prop]);\n            }\n            else {\n                m[prop] = params[prop];\n            }\n        });\n    }\n    else {\n        applyTechniqueToMaterial(technique, material, options.level, options.skipExtraProps);\n    }\n    return material;\n}\nexports.createMaterial = createMaterial;\n/**\n * Returns a [[THREE.BufferAttribute]] created from a provided [[BufferAttribute]] object.\n *\n * @param attribute BufferAttribute a WebGL compliant buffer\n */\nfunction getBufferAttribute(attribute) {\n    switch (attribute.type) {\n        case \"float\":\n            return new THREE.BufferAttribute(new Float32Array(attribute.buffer), attribute.itemCount);\n        case \"uint16\":\n            return new THREE.BufferAttribute(new Uint16Array(attribute.buffer), attribute.itemCount);\n        case \"uint32\":\n            return new THREE.BufferAttribute(new Uint32Array(attribute.buffer), attribute.itemCount);\n        default:\n            throw new Error(`unsupported buffer of type ${attribute.type}`);\n    } // switch\n}\nexports.getBufferAttribute = getBufferAttribute;\n/**\n * Gets the default `three.js` object constructor associated with the given technique.\n *\n * @param technique The technique.\n */\nfunction getObjectConstructor(technique) {\n    if (technique.name === undefined) {\n        return undefined;\n    }\n    switch (technique.name) {\n        case \"extruded-line\":\n        case \"standard\":\n        case \"terrain\":\n        case \"extruded-polygon\":\n        case \"fill\":\n        case \"solid-line\":\n        case \"dashed-line\":\n            return THREE.Mesh;\n        case \"circles\":\n            return MapViewPoints_1.Circles;\n        case \"squares\":\n            return MapViewPoints_1.Squares;\n        case \"line\":\n            return THREE.LineSegments;\n        case \"segments\":\n            return THREE.LineSegments;\n        case \"shader\": {\n            if (!harp_datasource_protocol_1.isShaderTechnique(technique)) {\n                throw new Error(\"Invalid technique\");\n            }\n            switch (technique.primitive) {\n                case \"line\":\n                    return THREE.Line;\n                case \"segments\":\n                    return THREE.LineSegments;\n                case \"point\":\n                    return THREE.Points;\n                case \"mesh\":\n                    return THREE.Mesh;\n                default:\n                    return undefined;\n            }\n        }\n        case \"text\":\n        case \"labeled-icon\":\n        case \"line-marker\":\n            return undefined;\n    }\n}\nexports.getObjectConstructor = getObjectConstructor;\n/**\n * Non material properties of [[BaseTechnique]]\n */\nexports.BASE_TECHNIQUE_NON_MATERIAL_PROPS = [\n    \"name\",\n    \"id\",\n    \"renderOrder\",\n    \"renderOrderBiasProperty\",\n    \"renderOrderBiasGroup\",\n    \"renderOrderBiasRange\",\n    \"transient\"\n];\n/**\n * Returns a [[MaterialConstructor]] basing on provided technique object.\n *\n * @param technique [[Technique]] object which the material will be based on.\n */\nfunction getMaterialConstructor(technique) {\n    if (technique.name === undefined) {\n        return undefined;\n    }\n    switch (technique.name) {\n        case \"extruded-line\":\n            if (!harp_datasource_protocol_1.isExtrudedLineTechnique(technique)) {\n                throw new Error(\"Invalid extruded-line technique\");\n            }\n            return technique.shading === \"standard\"\n                ? harp_materials_1.MapMeshStandardMaterial\n                : harp_materials_1.MapMeshBasicMaterial;\n        case \"standard\":\n        case \"terrain\":\n        case \"extruded-polygon\":\n            return harp_materials_1.MapMeshStandardMaterial;\n        case \"solid-line\":\n            return harp_materials_1.SolidLineMaterial;\n        case \"dashed-line\":\n            return harp_materials_1.DashedLineMaterial;\n        case \"fill\":\n            return harp_materials_1.MapMeshBasicMaterial;\n        case \"squares\":\n            return THREE.PointsMaterial;\n        case \"circles\":\n            return harp_materials_1.CirclePointsMaterial;\n        case \"line\":\n        case \"segments\":\n            return THREE.LineBasicMaterial;\n        case \"shader\":\n            return THREE.ShaderMaterial;\n        case \"text\":\n        case \"labeled-icon\":\n        case \"line-marker\":\n            return undefined;\n    }\n}\nexports.getMaterialConstructor = getMaterialConstructor;\n/**\n * Apply generic technique parameters to material.\n *\n * Skips non-material [[Technique]] props:\n *  * [[BaseTechnique]] props,\n *  * `name` which is used as discriminator for technique types,\n *  * props starting with `_`\n *  * props found `skipExtraProps`\n *\n * `THREE.Color` properties are supported.\n *\n * @param technique technique from where params are copied\n * @param material target material\n * @param level optional, tile zoom level for zoom-level dependent props\n * @param skipExtraProps optional, skipped props\n */\nfunction applyTechniqueToMaterial(technique, material, level, skipExtraProps) {\n    Object.getOwnPropertyNames(technique).forEach(propertyName => {\n        if (propertyName.startsWith(\"_\") ||\n            exports.BASE_TECHNIQUE_NON_MATERIAL_PROPS.indexOf(propertyName) !== -1 ||\n            DEFAULT_SKIP_PROPERTIES.indexOf(propertyName) !== -1 ||\n            (skipExtraProps !== undefined && skipExtraProps.indexOf(propertyName) !== -1)) {\n            return;\n        }\n        const prop = propertyName;\n        const m = material;\n        let value = technique[prop];\n        if (typeof m[prop] === \"undefined\") {\n            return;\n        }\n        if (level !== undefined && harp_datasource_protocol_1.isInterpolatedProperty(value)) {\n            value = harp_datasource_protocol_1.getPropertyValue(value, level);\n        }\n        if (m[prop] instanceof THREE.Color) {\n            m[prop].set(value);\n        }\n        else {\n            m[prop] = value;\n        }\n    });\n}\nexports.applyTechniqueToMaterial = applyTechniqueToMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * Returns `three.js` pixel format object basing on a [[PixelFormat]] specified.\n */\nfunction toPixelFormat(format) {\n    switch (format) {\n        case \"Alpha\":\n            return THREE.AlphaFormat;\n        case \"RGB\":\n            return THREE.RGBFormat;\n        case \"RGBA\":\n            return THREE.RGBAFormat;\n        case \"Luminance\":\n            return THREE.LuminanceFormat;\n        case \"LuminanceAlpha\":\n            return THREE.LuminanceAlphaFormat;\n        case \"RGBE\":\n            return THREE.RGBEFormat;\n        case \"Depth\":\n            return THREE.DepthFormat;\n        case \"DepthStencil\":\n            return THREE.DepthStencilFormat;\n        case \"Red\":\n            return THREE.RedFormat;\n        default:\n            throw new Error(`invalid pixel format: ${format}`);\n    }\n}\nexports.toPixelFormat = toPixelFormat;\n/**\n * Returns `three.js` texture data types based on a [[TextureDataType]] specified.\n */\nfunction toTextureDataType(dataType) {\n    switch (dataType) {\n        case \"UnsignedByte\":\n            return THREE.UnsignedByteType;\n        case \"Byte\":\n            return THREE.ByteType;\n        case \"Short\":\n            return THREE.ShortType;\n        case \"UnsignedShort\":\n            return THREE.UnsignedShortType;\n        case \"Int\":\n            return THREE.IntType;\n        case \"UnsignedInt\":\n            return THREE.UnsignedIntType;\n        case \"Float\":\n            return THREE.FloatType;\n        case \"HalfFloat\":\n            return THREE.HalfFloatType;\n        default:\n            throw new Error(`invalid texture data type: ${dataType}`);\n    }\n}\nexports.toTextureDataType = toTextureDataType;\n/**\n * Returns `three.js` wrapping mode object based on a [[WrappingMode]] specified.\n */\nfunction toWrappingMode(mode) {\n    switch (mode) {\n        case \"clamp\":\n            return THREE.ClampToEdgeWrapping;\n        case \"repeat\":\n            return THREE.RepeatWrapping;\n        case \"mirror\":\n            return THREE.MirroredRepeatWrapping;\n        default:\n            throw new Error(`invalid wrapping mode: ${mode}`);\n    }\n}\nexports.toWrappingMode = toWrappingMode;\n/**\n * Returns `three.js` texture filter object based on a [[MagFilter]] or [[MinFilter]] specified.\n */\nfunction toTextureFilter(filter) {\n    switch (filter) {\n        case \"nearest\":\n            return THREE.NearestFilter;\n        case \"nearestMipMapNearest\":\n            return THREE.NearestMipMapNearestFilter;\n        case \"nearestMipMapLinear\":\n            return THREE.NearestMipMapLinearFilter;\n        case \"linear\":\n            return THREE.LinearFilter;\n        case \"linearMipMapNearest\":\n            return THREE.LinearMipMapNearestFilter;\n        case \"linearMipMapLinear\":\n            return THREE.LinearMipMapLinearFilter;\n        default:\n            throw new Error(`invalid texture filter: ${filter}`);\n    }\n}\nexports.toTextureFilter = toTextureFilter;\n/**\n * Create a specific light for lightening the map.\n */\nfunction createLight(lightDescription) {\n    switch (lightDescription.type) {\n        case \"ambient\": {\n            const light = new THREE.AmbientLight(lightDescription.color, lightDescription.intensity);\n            light.name = lightDescription.name;\n            return light;\n        }\n        case \"directional\": {\n            const light = new THREE.DirectionalLight(lightDescription.color, lightDescription.intensity);\n            light.name = lightDescription.name;\n            if (lightDescription.castShadow !== undefined) {\n                light.castShadow = lightDescription.castShadow;\n            }\n            light.position.set(lightDescription.direction.x, lightDescription.direction.y, lightDescription.direction.z);\n            light.position.normalize();\n            return light;\n        }\n    }\n}\nexports.createLight = createLight;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\n/**\n * Bitmask used for the depth pre-pass to prevent multiple fragments in the same screen position\n * from rendering color.\n */\nexports.DEPTH_PRE_PASS_STENCIL_MASK = 0x01;\n/**\n * Check if technique requires (and not disables) use of depth prepass.\n *\n * Depth prepass is enabled if correct opacity is specified (in range `(0,1)`) _and_ not explicitly\n * disabled by `enableDepthPrePass` option.\n *\n * @param technique [[BaseStandardTechnique]] instance to be checked\n */\nfunction isRenderDepthPrePassEnabled(technique) {\n    return (technique.enableDepthPrePass !== false &&\n        technique.opacity !== undefined &&\n        technique.opacity > 0 &&\n        technique.opacity < 1.0);\n}\nexports.isRenderDepthPrePassEnabled = isRenderDepthPrePassEnabled;\n/**\n * Creates material for depth prepass.\n *\n * Creates material that writes only to the z-buffer. Updates the original material instance, to\n * support depth prepass.\n *\n * @param baseMaterial The base material of mesh that is updated to work with depth prepass\n *     and then used. This parameter is a template for depth prepass material that is returned.\n * @returns depth prepass material, which is a clone of `baseMaterial` with the adapted settings.\n */\nfunction createDepthPrePassMaterial(baseMaterial) {\n    baseMaterial.depthWrite = false;\n    baseMaterial.depthFunc = THREE.EqualDepth;\n    baseMaterial.colorWrite = true;\n    baseMaterial.transparent = true;\n    const depthPassMaterial = baseMaterial.clone();\n    depthPassMaterial.depthWrite = true;\n    depthPassMaterial.depthTest = true;\n    depthPassMaterial.depthFunc = THREE.LessDepth;\n    depthPassMaterial.colorWrite = false;\n    depthPassMaterial.transparent = false;\n    depthPassMaterial.opacity = 1.0;\n    return depthPassMaterial;\n}\nexports.createDepthPrePassMaterial = createDepthPrePassMaterial;\n// tslint:disable:max-line-length\n/**\n * Clones a given mesh to render it in the depth prepass with another material. Both the original\n * and depth prepass meshes, when rendered in the correct order, create the proper depth prepass\n * effect. The original mesh material is slightly modified by [[createDepthPrePassMaterial]] to\n * support the depth prepass. This method is usable only if the material of this mesh has an\n * opacity value in the range `(0,1)`.\n *\n * About render order: the DepthPrePass object that is created has the same `renderOrder` as\n * the original mesh. The proper sort orders of both the depth and the color pass objects are\n * guaranteed by ThreeJS's handling of transparent objects, which renders them after opaque\n * objects:\n *   - since the depth prepass object is never transparent, it is rendered first\n *   - since the color pass object is transparent, it is rendered second\n *\n * @see [Material.transparent in ThreeJS's doc](https://threejs.org/docs/#api/harp-materials/Material.transparent).\n *\n * @param mesh original mesh\n * @returns `Mesh` depth pre pass\n */\n// tslint:enable:max-line-length\nfunction createDepthPrePassMesh(mesh) {\n    const originalGeometry = mesh.geometry;\n    if (!(originalGeometry instanceof THREE.BufferGeometry)) {\n        throw new Error(\"#createDepthPassMesh only BufferGeometry is supported\");\n    }\n    const positionAttribute = originalGeometry.getAttribute(\"position\");\n    if (!positionAttribute) {\n        throw new Error(\"#createDepthPassMesh position attribute not found\");\n    }\n    const depthPassGeometry = new THREE.BufferGeometry();\n    depthPassGeometry.addAttribute(\"position\", positionAttribute);\n    const uvAttribute = originalGeometry.getAttribute(\"uv\");\n    if (uvAttribute) {\n        depthPassGeometry.addAttribute(\"uv\", uvAttribute);\n    }\n    if (originalGeometry.index) {\n        depthPassGeometry.setIndex(originalGeometry.index);\n    }\n    for (const group of originalGeometry.groups) {\n        const { start, count, materialIndex } = group;\n        depthPassGeometry.addGroup(start, count, materialIndex);\n    }\n    const depthPassMaterial = mesh.material instanceof Array\n        ? mesh.material.map(createDepthPrePassMaterial)\n        : createDepthPrePassMaterial(mesh.material);\n    const depthPassMesh = new THREE.Mesh(depthPassGeometry, depthPassMaterial);\n    depthPassMesh.renderOrder = mesh.renderOrder;\n    return depthPassMesh;\n}\nexports.createDepthPrePassMesh = createDepthPrePassMesh;\n/**\n * Sets up all the needed stencil logic needed for the depth pre-pass.\n *\n * This logic is in place to avoid z-fighting artifacts that can appear in geometries that have\n * coplanar triangles inside the same mesh.\n *\n * @param depthMesh Mesh created by `createDepthPrePassMesh`.\n * @param colorMesh Original mesh.\n */\nfunction setDepthPrePassStencil(depthMesh, colorMesh) {\n    // Set up depth mesh stencil logic.\n    // Set the depth pre-pass stencil bit for all processed fragments. We use `gl.ALWAYS` and not\n    // `gl.NOTEQUAL` to force all fragments to pass the stencil test and write the correct depth\n    // value.\n    depthMesh.onBeforeRender = harp_utils_1.chainCallbacks(depthMesh.onBeforeRender, (renderer, scene, camera, geometry, material, group) => {\n        const gl = renderer.context;\n        renderer.state.buffers.stencil.setTest(true);\n        renderer.state.buffers.stencil.setMask(exports.DEPTH_PRE_PASS_STENCIL_MASK);\n        renderer.state.buffers.stencil.setOp(gl.KEEP, gl.KEEP, gl.REPLACE);\n        renderer.state.buffers.stencil.setFunc(gl.ALWAYS, 0xff, exports.DEPTH_PRE_PASS_STENCIL_MASK);\n    });\n    // Set up color mesh stencil logic.\n    // Only write color for pixels with the depth pre-pass stencil bit set. Also, once a pixel is\n    // rendered, set the stencil bit to 0 to prevent subsequent pixels in the same clip position\n    // from rendering color again.\n    colorMesh.onBeforeRender = harp_utils_1.chainCallbacks(colorMesh.onBeforeRender, (renderer, scene, camera, geometry, material, group) => {\n        const gl = renderer.context;\n        renderer.state.buffers.stencil.setTest(true);\n        renderer.state.buffers.stencil.setMask(exports.DEPTH_PRE_PASS_STENCIL_MASK);\n        renderer.state.buffers.stencil.setOp(gl.KEEP, gl.KEEP, gl.ZERO);\n        renderer.state.buffers.stencil.setFunc(gl.EQUAL, 0xff, exports.DEPTH_PRE_PASS_STENCIL_MASK);\n    });\n    // Disable stencil test after rendering each mesh.\n    depthMesh.onAfterRender = renderer => {\n        renderer.state.buffers.stencil.setTest(false);\n        renderer.state.buffers.stencil.setMask(0xff);\n    };\n    colorMesh.onAfterRender = renderer => {\n        renderer.state.buffers.stencil.setTest(false);\n        renderer.state.buffers.stencil.setMask(0xff);\n    };\n}\nexports.setDepthPrePassStencil = setDepthPrePassStencil;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst isNode = typeof window === \"undefined\";\n/**\n * A `DebugOption` is a pair that consists of an option value and an array of change listeners.\n * Listeners are called up when setting the option's value.\n */\nclass DebugOption extends THREE.EventDispatcher {\n    /**\n     * Constructs the `DebugOption`.\n     *\n     * @param value The value of the option.\n     */\n    constructor(value) {\n        super();\n        this.value = value;\n    }\n    /**\n     * Updates the value of a given option.\n     *\n     * @param value The new value for the option.\n     * @param name The name of the option to set.\n     */\n    set(value, name) {\n        this.value = value;\n        this.dispatchEvent({ type: DebugOption.SET_EVENT_TYPE, name, value });\n    }\n}\nDebugOption.SET_EVENT_TYPE = \"set\";\n/**\n * Maintains a map of [[DebugOption]]s. You can add listeners to debug options by passing their\n * names.\n */\nclass DebugContext {\n    /**\n     * Builds a `DebugContext`.\n     */\n    constructor() {\n        this.m_optionsMap = new Map();\n        // If we have a `window` object, we store the context in it to make it available in the\n        // console.\n        if (!isNode && typeof window !== \"undefined\" && window) {\n            const debugInfo = window;\n            debugInfo.__debugContext = this;\n        }\n    }\n    /**\n     * Sets the value of an option. Calls change listeners of that option, even if the value has\n     * not been changed. The change listeners provided here are not called during this set\n     * operation.\n     *\n     * @param name Name of the option.\n     * @param value Value of the option.\n     */\n    setValue(name, value) {\n        let opt = this.m_optionsMap.get(name);\n        if (!opt) {\n            opt = new DebugOption(value);\n            this.m_optionsMap.set(name, opt);\n        }\n        else {\n            opt.set(value, name);\n        }\n    }\n    /**\n     * Gets the option value.\n     *\n     * @param name Name of option.\n     */\n    getValue(name) {\n        const opt = this.m_optionsMap.get(name);\n        return opt ? opt.value : undefined;\n    }\n    /**\n     * Determines if the option is registered.\n     *\n     * @param name Name of option.\n     */\n    hasOption(name) {\n        return this.m_optionsMap.get(name) !== undefined;\n    }\n    /**\n     * Adds a listener to a debug option.\n     *\n     * @param name Name of the option that requires a listener.\n     * @param listener The listener function to add.\n     */\n    addEventListener(name, listener) {\n        const opt = this.m_optionsMap.get(name);\n        if (opt) {\n            opt.addEventListener(DebugOption.SET_EVENT_TYPE, listener);\n        }\n        else {\n            throw Error(\"Unknown option: \" + name);\n        }\n    }\n    /**\n     * Checks for a listener in a debug option.\n     *\n     * @param name Name of the option to check for.\n     * @param listener The listener function to check for.\n     */\n    hasEventListener(name, listener) {\n        const opt = this.m_optionsMap.get(name);\n        if (opt) {\n            return opt.hasEventListener(DebugOption.SET_EVENT_TYPE, listener);\n        }\n        else {\n            throw Error(\"Unknown option: \" + name);\n        }\n    }\n    /**\n     * Removes a listener from a debug option.\n     *\n     * @param name Name of the option from which to remove a listener.\n     * @param listener The listener function to remove.\n     */\n    removeEventListener(name, listener) {\n        const opt = this.m_optionsMap.get(name);\n        if (opt) {\n            opt.removeEventListener(DebugOption.SET_EVENT_TYPE, listener);\n        }\n        else {\n            throw Error(\"Unknown option: \" + name);\n        }\n    }\n    /**\n     * Provides access to the options map. This method is useful for creating an automatic\n     * browser GUI.\n     */\n    get options() {\n        return this.m_optionsMap;\n    }\n    /**\n     * Clears away all debug options. Currently, `THREE.EventDispatcher` does not provide an API\n     * to remove all event listeners.\n     */\n    clear() {\n        this.m_optionsMap.forEach(option => {\n            option.set(undefined, \"\");\n        });\n    }\n}\nexports.DebugContext = DebugContext;\nexports.debugContext = new DebugContext();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst PickHandler_1 = require(\"./PickHandler\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"RoadPicker\");\nconst MAX_DISTANCE_ERROR = 0.01;\n/**\n * The `RoadPicker` class manages picking of roads, which may not be pickable in THREE.js, since\n * their geometry is generated in the vertex shader.\n */\nclass RoadPicker {\n    constructor(m_mapView) {\n        this.m_mapView = m_mapView;\n    }\n    /**\n     * Registers a tile with the `RoadPicker`. This function extracts line data from the [[Tile]],\n     * but only if the tile has the necessary [[ExtendedTileInfo]] that allows for road features to\n     * be reconstructed.\n     *\n     * @param tile The tile to register.\n     */\n    registerTile(tile) {\n        harp_utils_1.assert(tile.decodedTile !== undefined);\n        if (tile.decodedTile === undefined || tile.decodedTile.tileInfo === undefined) {\n            return undefined;\n        }\n        const extendedTileInfo = tile.decodedTile.tileInfo;\n        const lineFeatures = extendedTileInfo.lineGroup;\n        if (lineFeatures === undefined || lineFeatures.numFeatures === 0) {\n            // tileInfo not of expected type [[ExtendedTileInfo]]\n            return undefined;\n        }\n        const widths = [];\n        widths.length = lineFeatures.numFeatures;\n        const level = tile.tileKey.level;\n        for (let i = 0; i < lineFeatures.numFeatures; i++) {\n            const technique = extendedTileInfo.techniqueCatalog[lineFeatures.techniqueIndex[i]];\n            const width = this.getLineWidthInWorldUnit(technique, level);\n            widths[i] = width !== undefined ? Math.max(1, width) : 1;\n        }\n        const objInfos = extendedTileInfo.lineGroup.userData;\n        const roadIntersectionData = {\n            ids: lineFeatures.featureIds,\n            techniqueIndex: lineFeatures.techniqueIndex,\n            starts: lineFeatures.positionIndex,\n            widths,\n            positions: lineFeatures.positions,\n            techniques: extendedTileInfo.techniqueCatalog,\n            objInfos\n        };\n        return roadIntersectionData;\n    }\n    /**\n     * Tests the `pickPos` point for intersection with all roads on a tile.\n     *\n     * @param tile The tile to pick.\n     * @param eyePos The WorldPosition of eye or camera to compute distances.\n     * @param pickPos The WorldPosition of the picked point, on the plane.\n     * @param results The existing array of [[PickResult]]; new results should be appended.\n     */\n    intersectRoads(tile, eyePos, pickPos, results) {\n        if (tile.boundingBox.distanceToPoint(pickPos) > MAX_DISTANCE_ERROR) {\n            // outside of bounding box of tile\n            return false;\n        }\n        const roadIntersectionData = tile.roadIntersectionData;\n        if (roadIntersectionData === undefined) {\n            return false;\n        }\n        const ids = roadIntersectionData.ids;\n        const techniques = roadIntersectionData.techniques;\n        const techniqueIndices = roadIntersectionData.techniqueIndex;\n        const numFeatures = ids.length;\n        const positions = roadIntersectionData.positions;\n        const widths = roadIntersectionData.widths;\n        const px = pickPos.x - tile.center.x;\n        const py = pickPos.y - tile.center.y;\n        const pickDistance = pickPos.distanceTo(eyePos);\n        if (widths.length !== ids.length ||\n            ids.length !== techniqueIndices.length ||\n            techniqueIndices.length !== roadIntersectionData.starts.length) {\n            logger.error(\"The amount of widths, ids, techniqueIndices and starts has to be the same\");\n            return false;\n        }\n        for (let i = 0; i < numFeatures; i++) {\n            const technique = techniques[techniqueIndices[i]];\n            // if the technique is marked as background or as transient, we ignore it for picking\n            if ( /*technique.isBackground === true ||*/technique.transient === true) {\n                continue;\n            }\n            const featureStart = roadIntersectionData.starts[i];\n            const featureEnd = i < numFeatures - 1\n                ? roadIntersectionData.starts[i + 1]\n                : roadIntersectionData.positions.length;\n            let startX = positions[featureStart];\n            let startY = positions[featureStart + 1];\n            const lineWidthSqr = widths[i] * widths[i];\n            let closestDistSqr = Number.MAX_VALUE;\n            for (let j = featureStart + 2; j < featureEnd; j += 2) {\n                const endX = positions[j];\n                const endY = positions[j + 1];\n                const distSqr = harp_utils_1.Math2D.distToSegmentSquared(px, py, startX, startY, endX, endY);\n                if (distSqr < lineWidthSqr) {\n                    if (distSqr < closestDistSqr) {\n                        closestDistSqr = distSqr;\n                    }\n                }\n                startX = endX;\n                startY = endY;\n            }\n            if (closestDistSqr < Number.MAX_VALUE) {\n                const roadPickResult = {\n                    type: PickHandler_1.PickObjectType.Line,\n                    point: pickPos,\n                    distance: pickDistance,\n                    distFromCenter: Math.sqrt(closestDistSqr),\n                    featureId: ids[i],\n                    positions: positions.slice(featureStart, featureEnd),\n                    technique\n                };\n                this.addUserData(roadPickResult, i, roadIntersectionData.objInfos);\n                results.push(roadPickResult);\n            }\n        }\n        return false;\n    }\n    addUserData(roadPickResult, index, objInfos) {\n        if (objInfos !== undefined && objInfos.length > 0) {\n            roadPickResult.userData = Object.assign({}, objInfos[index]);\n        }\n    }\n    getLineWidthInWorldUnit(technique, level) {\n        const solidLineTech = technique;\n        const metricUnit = harp_datasource_protocol_1.getPropertyValue(solidLineTech.metricUnit, level);\n        if (metricUnit === \"Pixel\") {\n            const pixelToWorld = this.m_mapView.renderer.getPixelRatio() * this.m_mapView.pixelToWorld * 0.5;\n            const lineWidth = harp_datasource_protocol_1.getPropertyValue(solidLineTech.lineWidth, level);\n            return ((lineWidth !== undefined\n                ? lineWidth\n                : harp_materials_1.SolidLineMaterial.DEFAULT_WIDTH) * pixelToWorld);\n        }\n        else {\n            const lineTechnique = technique;\n            return harp_datasource_protocol_1.getPropertyValue(lineTechnique.lineWidth, level);\n        }\n    }\n}\nexports.RoadPicker = RoadPicker;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * This enum defines the possible origin points for an image.\n */\nvar ImageOrigin;\n(function (ImageOrigin) {\n    ImageOrigin[ImageOrigin[\"TopLeft\"] = 0] = \"TopLeft\";\n    ImageOrigin[ImageOrigin[\"BottomLeft\"] = 1] = \"BottomLeft\";\n})(ImageOrigin = exports.ImageOrigin || (exports.ImageOrigin = {}));\n/**\n * Defines a part (or all) of an image as a texture.\n */\nclass IconTexture {\n    /**\n     * The constructor of an `IconTexture`.\n     *\n     * @param image An [[ImageItem]] instance.\n     * @param options The rendering parameters.\n     */\n    constructor(image) {\n        this.image = image;\n    }\n}\nexports.IconTexture = IconTexture;\n// export enum TextAlign {\n//     Center,\n//     Left,\n//     Right,\n//     // ??? expands lines to have same length.\n//     Justify\n// }\n// export interface LayoutOptions {\n//     paddingH?: number;\n//     paddingV: number;\n//     transFormCenterX?: number;\n//     transFormCenterY?: number;\n//     rotation?: number;\n//     /** Set to `true` to enlarge the box after rotation to include all rotated corners. */\n//     rotationEnlargesBox: boolean;\n// }\n// export interface TextOptions {\n//     bgColor?: THREE.Color;\n//     wrapWords?: boolean;\n//     maxNumLines?: number;\n//     maxWidth?: number;\n//     /** Replace with ellipsis if wider than maxWidth. */\n//     addEllipsis?: boolean;\n//     /** Handle right-to-left texts */\n//     isRightToLeft?: boolean;\n//     textAlignH?: AlignH; // = AlignH.Center;\n//     textAlignV?: AlignV; // = AlignV.Center;\n// }\n// export class IconLabel {\n//     constructor(text: string, options: LayoutOptions | TextOptions) {}\n//     /**\n//      * Setup a box with size and padding.\n//      *\n//      * @param box Target box to set up.\n//      */\n//     getBox(box: THREE.Box2) {}\n//     /**\n//      * Compute width and height from text and font.\n//      */\n//     computeBox() {}\n//     /**\n//      * Generate the glyphs and keep them in a buffer. Generates a fixed layout.\n//      */\n//     prepareRendering() {}\n// }\n// export enum AlignH {\n//     Center,\n//     Left,\n//     Right\n// }\n// export enum AlignV {\n//     Center,\n//     Top,\n//     Bottom\n// }\n// export enum AnchorTarget {\n//     /** Anchor point relative to Icon */\n//     Icon,\n//     /** Anchor point is transform center of icon */\n//     IconCenter,\n//     /** Anchor point relative to Icon including padding */\n//     IconBox,\n//     /** Anchor point relative to Label */\n//     Label,\n//     /** Anchor point relative to combination of Icon and Label */\n//     Box\n// }\n// export class AnchorPosition {\n//     targetH: AnchorTarget = AnchorTarget.Icon;\n//     targetV: AnchorTarget = AnchorTarget.Icon;\n//     alignH: AlignH = AlignH.Center;\n//     alignV: AlignV = AlignV.Center;\n// }\n// export enum IconPinMode {\n//     /** Pinned down, anchor point is the same at all angles. */\n//     PinDown,\n//     /**\n//      * Icon stands up. \"StreetLevel\"-style. The anchor point moves to the bottom of the icon when\n//      * the view direction gets parallel to the ground.\n//      */\n//     StandUp\n// }\n// export interface IconScaleOptions {\n//     depthScale?: boolean;\n//     minimumScale?: number;\n// }\n// export interface IconOptions {\n//     useScreenSpace?: boolean; // = true\n//     priority?: number;\n//     scaleOptions?: IconScaleOptions;\n//     /** Optional offset in screen space */\n//     screenOffsetX?: number;\n//     screenOffsetY?: number;\n//     /** Optional 3D height above terrain. */\n//     heightAboveGround?: number;\n// }\n// export class SimplePoiIcon {\n//     constructor(\n//         readonly pos: THREE.Vector3,\n//         readonly image ?: IconTexture,\n//         options ?: IconOptions\n//     ) { }\n// }\n// export class PoiIcon {\n//     constructor(\n//         readonly pos: THREE.Vector3,\n//         readonly image?: IconTexture,\n//         readonly label?: IconLabel,\n//         options?: IconOptions\n//     ) {}\n// }\n// export interface PoiOptions {\n//     featureId?: number;\n//     minZoomLevel?: number;\n// }\n// export class SimplePoi {\n//     private m_featureId?: number;\n//     private m_minZoomLevel: number = 0;\n//     constructor(readonly icon: SimplePoiIcon, options?: PoiOptions) {\n//         if (options !== undefined) {\n//             this.m_featureId = options.featureId;\n//             this.m_minZoomLevel = options.minZoomLevel !== undefined ? options.minZoomLevel : 0;\n//         }\n//     }\n// }\n// export class Poi {\n//     /** store multiple icons, one for every LOD */\n//     private m_icons: PoiIcon[] = [];\n//     private m_lod = 0;\n//     private m_featureId?: number;\n//     private m_minZoomLevel: number = 0;\n//     constructor(icon: PoiIcon, options?: PoiOptions) {\n//         this.m_icons.push(icon);\n//         if (options !== undefined) {\n//             this.m_featureId = options.featureId;\n//             this.m_minZoomLevel = options.minZoomLevel !== undefined ? options.minZoomLevel : 0;\n//         }\n//     }\n//     icon(): PoiIcon | undefined {\n//         return this.m_icons[this.m_lod];\n//     }\n//     /**\n//      * Select the level of detail that should be used.\n//      *\n//      * @param levelOfDetail Level of detail to render.\n//      */\n//     selectIcon(levelOfDetail: number) {}\n// }\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar MapRenderingManager_1 = require(\"./MapRenderingManager\");\nexports.MapRenderingManager = MapRenderingManager_1.MapRenderingManager;\nvar Pass_1 = require(\"./Pass\");\nexports.Pass = Pass_1.Pass;\nvar MSAARenderPass_1 = require(\"./MSAARenderPass\");\nexports.MSAARenderPass = MSAARenderPass_1.MSAARenderPass;\nexports.MSAASampling = MSAARenderPass_1.MSAASampling;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst THREE = require(\"three\");\nconst Pass_1 = require(\"./Pass\");\n/**\n * This enum represents the sampling level to apply to a [[MSAARenderPass]] instance. At level 0,\n * only one sample is performed, which is like disabling the MSAA pass.\n */\nvar MSAASampling;\n(function (MSAASampling) {\n    MSAASampling[MSAASampling[\"Level_0\"] = 0] = \"Level_0\";\n    MSAASampling[MSAASampling[\"Level_1\"] = 1] = \"Level_1\";\n    MSAASampling[MSAASampling[\"Level_2\"] = 2] = \"Level_2\";\n    MSAASampling[MSAASampling[\"Level_3\"] = 3] = \"Level_3\";\n    MSAASampling[MSAASampling[\"Level_4\"] = 4] = \"Level_4\";\n    MSAASampling[MSAASampling[\"Level_5\"] = 5] = \"Level_5\";\n})(MSAASampling = exports.MSAASampling || (exports.MSAASampling = {}));\n/**\n * [[MapView]]'s MSAA implementation. MSAA stands for Multi Sampling Anti-Aliasing, and its concept\n * is to provide a rendering engine with additional color values for each pixel, so they can include\n * the missing bits between them on a screen. WebGL already comes with a native MSAA implementation\n * with four samples. Because of its native nature, it is more efficient and one may not want to use\n * MapView's MSAA implementation when these four samples are satisfying. However in some situations\n * they are not: on low devices, MSAA can impact the framerate and we may desire to reduce the\n * number of samples at runtime. On the other hand, when the interaction stops, the engine also\n * stops rendering the map, and because a map relies on many line-like patterns, aliasing can then\n * turn very noticeable. In such static renders, the number of samples could be dramatically\n * increased on a last frame to render.\n */\nclass MSAARenderPass extends Pass_1.Pass {\n    /**\n     * The constructor for `MSAARenderPass`. It builds an internal scene with a camera looking at a\n     * quad.\n     *\n     * @param m_scene The scene to render.\n     * @param m_camera The camera to render the scene through.\n     */\n    constructor() {\n        super();\n        /**\n         * The sampling level determines the number of samples that will be performed per frame.\n         * Renders will happen `2 ^ samplingLevel` time(s). `samplingLevel` stands between `0` and `5`.\n         * Therefore there can be between 1 and 32 samples.\n         *\n         * @default `SamplingLevel.Level_1`\n         */\n        this.samplingLevel = MSAASampling.Level_1;\n        this.m_renderTarget = null;\n        this.m_localCamera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\n        this.m_quadScene = new THREE.Scene();\n        this.m_quadUniforms = harp_materials_1.CopyShader.uniforms;\n        this.m_quadMaterial = new harp_materials_1.MSAAMaterial(this.m_quadUniforms);\n        this.m_quad = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), this.m_quadMaterial);\n        this.m_quad.frustumCulled = false;\n        this.m_quadScene.add(this.m_quad);\n    }\n    /**\n     * Releases all used resources.\n     */\n    dispose() {\n        if (this.m_renderTarget !== null) {\n            this.m_renderTarget.dispose();\n            this.m_renderTarget = null;\n        }\n    }\n    /**\n     * The render function of `MSAARenderPass`. At each call of this method, and for each sample,\n     * the [[MapView]] camera provided in the `render` method is offset within the dimension of a\n     * pixel on screen. It then renders the whole scene with this offset to a local\n     * `WebGLRenderTarget` instance, via a `WebGLRenderer` instance. Finally the local camera\n     * created in the constructor shoots the quad and renders to the write buffer or to the frame\n     * buffer. The quad material's opacity is modified so the renders can accumulate in the\n     * targetted buffer.\n     *\n     * The number of samples can be modified at runtime through the enum [[SamplingLevel]].\n     *\n     * If there is no further pass, the [[Pass.renderToScreen]] flag can be set to `true` to\n     * output directly to the framebuffer.\n     *\n     * @param renderer The ThreeJS WebGLRenderer instance to render the scene with.\n     * @param scene The ThreeJS Scene instance to render the scene with.\n     * @param camera The ThreeJS Camera instance to render the scene with.\n     * @param writeBuffer A ThreeJS WebGLRenderTarget instance to render the scene to.\n     * @param readBuffer A ThreeJS WebGLRenderTarget instance to render the scene.\n     */\n    render(renderer, scene, camera, writeBuffer, readBuffer) {\n        if (!this.enabled) {\n            return;\n        }\n        // Initiates the local render target with the read buffer's dimensions, if not available.\n        if (this.m_renderTarget === null) {\n            this.m_renderTarget = new THREE.WebGLRenderTarget(readBuffer.width, readBuffer.height, {\n                minFilter: THREE.LinearFilter,\n                magFilter: THREE.LinearFilter,\n                format: THREE.RGBAFormat\n            });\n            this.m_renderTarget.texture.name = \"MSAARenderPass.sample\";\n        }\n        this.m_quadUniforms.tDiffuse.value = this.m_renderTarget.texture;\n        const offsets = MSAARenderPass.OffsetVectors[this.samplingLevel];\n        const rendererClearColor = renderer.getClearColor();\n        const oldClearColor = rendererClearColor !== undefined ? rendererClearColor.getHex() : 0;\n        // The method `camera.setViewOffset` will be called in the next loop. In order to maintain\n        // its usability externally (like for the triple view in mosaic demo) we must cache the\n        // previous values stored in `camera.view` and re-assign them at the end of the pass.\n        // 1. Create a default cache object, with default dimensions the size of our read buffer.\n        const oldView = {\n            enabled: camera.view !== null && camera.view.enabled,\n            fullWidth: readBuffer.width,\n            fullHeight: readBuffer.height,\n            x: 0,\n            y: 0,\n            width: readBuffer.width,\n            height: readBuffer.height\n        };\n        // 2. If `camera.view` has been enabled previously, then `setViewOffset` has been called\n        // externally: copy the existing `camera.view` values in the cache. Override the cache\n        // object with the values provided externally.\n        if (oldView.enabled && camera.view !== null) {\n            oldView.fullWidth = camera.view.fullWidth;\n            oldView.fullHeight = camera.view.fullHeight;\n            oldView.x = camera.view.offsetX;\n            oldView.y = camera.view.offsetY;\n            oldView.width = camera.view.width;\n            oldView.height = camera.view.height;\n        }\n        const oldRenderTarget = renderer.getRenderTarget();\n        for (let i = 0; i < offsets.length; i++) {\n            // 4. Then for each sample, call `setViewOffset` with our object. This also updates the\n            // `camera.view` object in Three.js.\n            const offset = offsets[i];\n            camera.setViewOffset(oldView.fullWidth, oldView.fullHeight, oldView.x + offset[0] / 16, oldView.y + offset[1] / 16, oldView.width, oldView.height);\n            // 5. Divide the opacity of the quad by the number of samples to accumulate on the\n            // target buffer, and reduce the impact of the offset on color to reduce banding. Then\n            // render.\n            const uniformCenteredDistribution = -0.5 + (i + 0.5) / offsets.length;\n            const sampleWeight = 1.0 / offsets.length + uniformCenteredDistribution / 32;\n            this.m_quadUniforms.opacity.value = sampleWeight;\n            renderer.setRenderTarget(this.m_renderTarget);\n            renderer.clear();\n            renderer.render(scene, camera);\n            // 6. Render the quad on top of the previous renders.\n            // NOTE: three.js doesn't like undefined as renderTarget, but works with `null`\n            renderer.setRenderTarget(this.renderToScreen ? null : writeBuffer);\n            if (i === 0) {\n                renderer.setClearColor(0x000000);\n                renderer.clear();\n            }\n            renderer.render(this.m_quadScene, this.m_localCamera);\n            if (i === 0 && rendererClearColor !== undefined) {\n                renderer.setClearColor(oldClearColor);\n            }\n        }\n        renderer.setRenderTarget(oldRenderTarget);\n        // 7. Restore `camera.view` as set externally (or not).\n        if (camera.view !== null) {\n            camera.view.enabled = oldView.enabled;\n            camera.view.offsetX = oldView.x;\n            camera.view.offsetY = oldView.y;\n        }\n    }\n    /**\n     * Resize the internal render target to match the new size specified.\n     *\n     * @param width New width to apply to the render target.\n     * @param height New height to apply to the render target.\n     */\n    setSize(width, height) {\n        if (this.m_renderTarget) {\n            this.m_renderTarget.setSize(width, height);\n        }\n    }\n}\n// tslint:disable:max-line-length\n/**\n * The list of offsets to apply to the camera, per sampling level, adapted from :\n *\n * @see https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396\n */\n// tslint:enable:max-line-length\n// tslint:disable-next-line:member-ordering\nMSAARenderPass.OffsetVectors = [\n    [[0, 0]],\n    [[4, 4], [-4, -4]],\n    [[-2, -6], [6, -2], [-6, 2], [2, 6]],\n    [[1, -3], [-1, 3], [5, 1], [-3, -5], [-5, 5], [-7, -1], [3, 7], [7, -7]],\n    [\n        [1, 1],\n        [-1, -3],\n        [-3, 2],\n        [4, -1],\n        [-5, -2],\n        [2, 5],\n        [5, 3],\n        [3, -5],\n        [-2, 6],\n        [0, -7],\n        [-4, -6],\n        [-6, 4],\n        [-8, 0],\n        [7, -4],\n        [6, 7],\n        [-7, -8]\n    ],\n    [\n        [-4, -7],\n        [-7, -5],\n        [-3, -5],\n        [-5, -4],\n        [-1, -4],\n        [-2, -2],\n        [-6, -1],\n        [-4, 0],\n        [-7, 1],\n        [-1, 2],\n        [-6, 3],\n        [-3, 3],\n        [-7, 6],\n        [-3, 6],\n        [-5, 7],\n        [-1, 7],\n        [5, -7],\n        [1, -6],\n        [6, -5],\n        [4, -4],\n        [2, -3],\n        [7, -2],\n        [1, -1],\n        [4, -1],\n        [2, 1],\n        [6, 2],\n        [0, 4],\n        [4, 4],\n        [2, 5],\n        [7, 5],\n        [5, 6],\n        [3, 7]\n    ]\n];\nexports.MSAARenderPass = MSAARenderPass;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ConcurrentWorkerSet_1 = require(\"./ConcurrentWorkerSet\");\nconst WorkerBasedDecoder_1 = require(\"./WorkerBasedDecoder\");\n/**\n * Default concurrent decoder helper.\n *\n * A convenient singleton that maintains a separate [[ConcurrentWorkerSet]] for each bundle\n * requested. Provides easy access to [[WorkerBasedDecoder]]s for data sources.\n */\nclass ConcurrentDecoderFacade {\n    /**\n     * Returns a [[WorkerBasedDecoder]] instance.\n     *\n     * @param decoderServiceType The name of the decoder service type.\n     * @param scriptUrl The optional URL with the workers' script.\n     */\n    static getTileDecoder(decoderServiceType, scriptUrl) {\n        const workerSet = this.getWorkerSet(scriptUrl);\n        return new WorkerBasedDecoder_1.WorkerBasedDecoder(workerSet, decoderServiceType);\n    }\n    /**\n     * Returns a [[ConcurrentWorkerSet]] instance based on the script URL specified.\n     *\n     * @param scriptUrl The optional URL with the workers' script. If not specified,\n     * the function uses [[defaultScriptUrl]] instead.\n     */\n    static getWorkerSet(scriptUrl) {\n        if (scriptUrl === undefined) {\n            scriptUrl = this.defaultScriptUrl;\n        }\n        let workerSet = this.workerSets[scriptUrl];\n        if (workerSet === undefined) {\n            workerSet = new ConcurrentWorkerSet_1.ConcurrentWorkerSet({\n                scriptUrl,\n                workerCount: this.defaultWorkerCount\n            });\n            this.workerSets[scriptUrl] = workerSet;\n        }\n        return workerSet;\n    }\n    /**\n     * Destroys a [[ConcurrentWorkerSet]] instance.\n     *\n     * @param scriptUrl The worker script URL that was used to create the [[ConcurrentWorkerSet]].\n     */\n    static destroyWorkerSet(scriptUrl) {\n        const workerSet = this.workerSets[scriptUrl];\n        if (workerSet !== undefined) {\n            workerSet.destroy();\n            delete this.workerSets[scriptUrl];\n        }\n    }\n    /**\n     * Destroys all managed [[ConcurrentWorkerSet]]s.\n     */\n    static destroy() {\n        Object.keys(this.workerSets).forEach(name => {\n            this.workerSets[name].destroy();\n        });\n        this.workerSets = {};\n    }\n}\n/**\n * The URL containing a script to fall back (default) to when looking for worker sets\n * and decoders.\n */\nConcurrentDecoderFacade.defaultScriptUrl = \"./decoder.bundle.js\";\n/**\n * The default number of workers.\n */\nConcurrentDecoderFacade.defaultWorkerCount = undefined;\n/**\n * The [[ConcurrentWorkerSet]] instances which are stored by the script URL.\n */\nConcurrentDecoderFacade.workerSets = {};\nexports.ConcurrentDecoderFacade = ConcurrentDecoderFacade;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst WorkerLoader_1 = require(\"./workers/WorkerLoader\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"ConcurrentWorkerSet\");\nfunction isLoggingMessage(message) {\n    return message && typeof message.level === \"number\" && message.type === harp_utils_1.WORKERCHANNEL_MSG_TYPE;\n}\nexports.isLoggingMessage = isLoggingMessage;\n/**\n * The default number of Web Workers to use if `navigator.hardwareConcurrency` is unavailable.\n */\nconst DEFAULT_WORKER_COUNT = 4;\n/**\n * A set of concurrent Web Workers. Acts as a Communication Peer for [[WorkerService]] instances\n * running in Web Workers.\n *\n * Starts and manages a certain number of web workers and provides a means to communicate\n * with them using various communication schemes, such as:\n *  - [[addEventListener]] : receive a unidirectional messages\n *  - [[broadcastMessage]] : send unidirectional broadcast message\n *  - [[invokeRequest]] : send a request that waits for a response, with load balancing\n *  - [[postMessage]] : send a unidirectional message, with load balancing\n *\n * The request queue holds all requests before they are stuffed into the event queue, allows for\n * easy (and early) cancelling of requests. The workers now only get a single new RequestMessage\n * when they return their previous result, or if they are idle. When they are idle, they are stored\n * in m_availableWorkers.\n */\nclass ConcurrentWorkerSet {\n    /**\n     * Creates a new `ConcurrentWorkerSet`.\n     *\n     * Creates as many Web Workers as specified in `options.workerCount`, from the script provided\n     * in `options.scriptUrl`. If `options.workerCount` is not specified, the value specified in\n     * `navigator.hardwareConcurrency` is used instead.\n     *\n     * The worker set is implicitly started when constructed.\n     */\n    constructor(m_options) {\n        this.m_options = m_options;\n        this.m_workerChannelLogger = harp_utils_1.LoggerManager.instance.create(\"WorkerChannel\");\n        this.m_eventListeners = new Map();\n        this.m_workers = new Array();\n        this.m_workerListeners = new Array();\n        // List of idle workers that can be given the next job. It is using a LIFO scheme to reduce\n        // memory consumption in idle workers.\n        this.m_availableWorkers = new Array();\n        this.m_workerPromises = new Array();\n        this.m_readyPromises = new Map();\n        this.m_requests = new Map();\n        this.m_workerRequestQueue = [];\n        this.m_nextMessageId = 0;\n        this.m_stopped = true;\n        this.m_referenceCount = 0;\n        /**\n         * Handles messages received from workers. This method is protected so that the message\n         * reception can be simulated through an extended class, to avoid relying on real workers.\n         *\n         * @param workerId The workerId of the web worker.\n         * @param event The event to dispatch.\n         */\n        this.onWorkerMessage = (workerId, event) => {\n            if (harp_datasource_protocol_1.WorkerServiceProtocol.isResponseMessage(event.data)) {\n                const response = event.data;\n                if (response.messageId === null) {\n                    logger.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);\n                    return;\n                }\n                const entry = this.m_requests.get(response.messageId);\n                if (entry === undefined) {\n                    logger.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);\n                    return;\n                }\n                if (workerId >= 0 && workerId < this.m_workers.length) {\n                    const worker = this.m_workers[workerId];\n                    this.m_availableWorkers.push(worker);\n                    // Check if any new work has been put into the queue.\n                    this.checkWorkerRequestQueue();\n                }\n                else {\n                    logger.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);\n                }\n                entry.resolver(response.error, response.response);\n            }\n            else if (harp_datasource_protocol_1.WorkerServiceProtocol.isInitializedMessage(event.data)) {\n                const readyPromise = this.getReadyPromise(event.data.service);\n                if (++readyPromise.count === this.m_workerPromises.length) {\n                    readyPromise.resolve();\n                }\n            }\n            else if (isLoggingMessage(event.data)) {\n                switch (event.data.level) {\n                    case harp_utils_1.LogLevel.Trace:\n                        this.m_workerChannelLogger.trace(...event.data.message);\n                        break;\n                    case harp_utils_1.LogLevel.Debug:\n                        this.m_workerChannelLogger.debug(...event.data.message);\n                        break;\n                    case harp_utils_1.LogLevel.Log:\n                        this.m_workerChannelLogger.log(...event.data.message);\n                        break;\n                    case harp_utils_1.LogLevel.Info:\n                        this.m_workerChannelLogger.info(...event.data.message);\n                        break;\n                    case harp_utils_1.LogLevel.Warn:\n                        this.m_workerChannelLogger.warn(...event.data.message);\n                        break;\n                    case harp_utils_1.LogLevel.Error:\n                        this.m_workerChannelLogger.error(...event.data.message);\n                        break;\n                }\n            }\n            else {\n                this.eventHandler(event);\n            }\n        };\n        this.start();\n    }\n    /**\n     * Adds an external reference and increments the internal reference counter by one.\n     *\n     * To implement a reference-count based automatic resource cleanup, use this function with\n     * [[removeReference]].\n     */\n    addReference() {\n        this.m_referenceCount += 1;\n    }\n    /**\n     * Decrements the internal reference counter by 1.\n     *\n     * When the internal reference counter reaches 0, this function calls [[dispose]] to clear the\n     * resources.\n     *\n     * Use with [[addReference]] to implement reference-count based automatic resource cleanup.\n     */\n    removeReference() {\n        this.m_referenceCount -= 1;\n        if (this.m_referenceCount === 0) {\n            this.destroy();\n        }\n    }\n    /**\n     * Starts workers.\n     *\n     * Use to start workers already stopped by [[stop]] or [[destroy]] calls.\n     *\n     * Note: The worker set is implicitly started on construction - no need to call [[start]] on\n     * fresh instance.\n     *\n     * @param options optional, new worker set options\n     */\n    start(options) {\n        if (options !== undefined) {\n            this.m_options = options;\n        }\n        if (!this.m_stopped) {\n            throw new Error(\"ConcurrentWorker set already started\");\n        }\n        const workerCount = harp_utils_1.getOptionValue(this.m_options.workerCount, typeof navigator !== \"undefined\" && navigator.hardwareConcurrency !== undefined\n            ? // We need to have at least one worker\n                harp_utils_1.MathUtils.clamp(navigator.hardwareConcurrency - 1, 1, 4)\n            : undefined, DEFAULT_WORKER_COUNT);\n        // Initialize the workers. The workers now have an ID to identify specific workers and\n        // handle their busy state.\n        for (let workerId = 0; workerId < workerCount; ++workerId) {\n            const workerPromise = WorkerLoader_1.WorkerLoader.startWorker(this.m_options.scriptUrl);\n            workerPromise\n                .then(worker => {\n                const listener = (evt) => {\n                    this.onWorkerMessage(workerId, evt);\n                };\n                this.m_workerListeners.push(listener);\n                worker.addEventListener(\"message\", listener);\n                this.m_workers.push(worker);\n                this.m_availableWorkers.push(worker);\n            })\n                .catch(error => {\n                logger.error(`failed to load worker ${workerId}: ${error}`);\n            });\n            this.m_workerPromises.push(workerPromise);\n        }\n        this.m_stopped = false;\n    }\n    /**\n     * Stops workers.\n     *\n     * Waits for all pending requests to be finished and stops all workers.\n     *\n     * Use [[start]] to start this worker again.\n     *\n     * @returns `Promise` that resolves when all workers are destroyed.\n     */\n    stop() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.m_stopped = true;\n            yield this.waitForAllResponses().then(() => {\n                this.terminateWorkers();\n            });\n        });\n    }\n    /**\n     * Destroys all workers immediately.\n     *\n     * Resolves all pending request promises with a `worker destroyed` error.\n     *\n     * Use [[start]] to start this worker again.\n     */\n    destroy() {\n        this.m_stopped = true;\n        // respond with all pending request\n        this.m_requests.forEach(entry => {\n            entry.resolver(new Error(\"worker destroyed\"));\n        });\n        this.m_requests.clear();\n        this.terminateWorkers();\n        // clean other stuff\n        this.m_eventListeners.clear();\n    }\n    /**\n     * Waits for `service` to be initialized in all workers.\n     *\n     * Each service that starts in a worker sends an [[isInitializedMessage]] to confirm that\n     * it has started successfully. This method resolves when all workers in a set have\n     * `service` initialized.\n     *\n     * @param serviceId The service identifier.\n     */\n    connect(serviceId) {\n        this.ensureStarted();\n        return this.getReadyPromise(serviceId).promise;\n    }\n    /**\n     * Registers an event listener for events that originated in a web worker, for a given\n     * `serviceId`. You can only set one event listener per `serviceId`.\n     *\n     * @param serviceId The service to listen to.\n     * @param callback The callback to invoke for matching events.\n     */\n    addEventListener(serviceId, callback) {\n        this.m_eventListeners.set(serviceId, callback);\n    }\n    /**\n     * Removes a previously set event listener for the given `serviceId`.\n     *\n     * @param serviceId The service from which to remove the event listeners.\n     */\n    removeEventListener(serviceId) {\n        this.m_eventListeners.delete(serviceId);\n    }\n    /**\n     * Invokes a request that expects a response from a random worker.\n     *\n     * Sends [[RequestMessage]] and resolves when a matching [[ResponseMessage]] is received from\n     * workers. Use this function when interfacing with \"RPC-like\" calls to services.\n     *\n     * @param serviceId The name of service, as registered with the [[WorkerClient]] instance.\n     * @param request The request to process.\n     * @param transferList An optional array of `ArrayBuffer`s to transfer to the worker context.\n     * @param requestController An optional [[RequestController]] to store state of cancelling.\n     *\n     * @returns A `Promise` that resolves with a response from the service.\n     */\n    invokeRequest(serviceId, request, transferList, requestController) {\n        this.ensureStarted();\n        const messageId = this.m_nextMessageId++;\n        let resolver;\n        const promise = new Promise((resolve, reject) => {\n            resolver = (error, response) => {\n                this.m_requests.delete(messageId);\n                if (error !== undefined) {\n                    reject(new Error(error.toString()));\n                }\n                else {\n                    resolve(response);\n                }\n            };\n        });\n        this.m_requests.set(messageId, {\n            promise,\n            resolver: resolver\n        });\n        const message = {\n            service: serviceId,\n            type: harp_datasource_protocol_1.WorkerServiceProtocol.ServiceMessageName.Request,\n            messageId,\n            request\n        };\n        this.postRequestMessage(message, transferList, requestController);\n        return promise;\n    }\n    /**\n     * Invokes a request that expects responses from all workers.\n     *\n     * Send [[RequestMessage]]  to all workers and resolves when all workers have sent a matching\n     * [[ResponseMessage]]. Use this function to wait on request that need to happen on all workers\n     * before proceeding (like synchronous worker service creation).\n     *\n     * @param serviceId The name of service, as registered with the [[WorkerClient]] instance.\n     * @param request The request to process.\n     * @param transferList An optional array of `ArrayBuffer`s to transfer to the worker context.\n     *\n     * @returns Array of `Promise`s that resolves with a response from each worker (unspecified\n     * order).\n     */\n    broadcastRequest(serviceId, request, transferList) {\n        this.ensureStarted();\n        const promises = [];\n        for (const worker of this.m_workers) {\n            const messageId = this.m_nextMessageId++;\n            let resolver;\n            const promise = new Promise((resolve, reject) => {\n                resolver = (error, response) => {\n                    this.m_requests.delete(messageId);\n                    if (error !== undefined) {\n                        reject(new Error(error.toString()));\n                    }\n                    else {\n                        resolve(response);\n                    }\n                };\n            });\n            promises.push(promise);\n            this.m_requests.set(messageId, {\n                promise,\n                resolver: resolver\n            });\n            const message = {\n                service: serviceId,\n                type: harp_datasource_protocol_1.WorkerServiceProtocol.ServiceMessageName.Request,\n                messageId,\n                request\n            };\n            worker.postMessage(message, transferList);\n        }\n        return Promise.all(promises);\n    }\n    /**\n     * Posts a message to all workers.\n     *\n     * @param message The message to send.\n     * @param buffers Optional buffers to transfer to the workers.\n     */\n    broadcastMessage(message, buffers) {\n        this.ensureStarted();\n        this.m_workers.forEach(worker => worker.postMessage(message, buffers));\n    }\n    /**\n     * The size of the request queue for debugging and profiling.\n     */\n    get requestQueueSize() {\n        return this.m_workerRequestQueue.length;\n    }\n    /**\n     * The number of workers for debugging and profiling.\n     */\n    get numWorkers() {\n        return this.m_workers.length;\n    }\n    /**\n     * The number of workers for debugging and profiling.\n     */\n    get numIdleWorkers() {\n        return this.m_availableWorkers.length;\n    }\n    /**\n     * Subclasses must call this function when a worker emits an event.\n     *\n     * @param event The event to dispatch.\n     */\n    eventHandler(event) {\n        if (typeof event.data.type !== \"string\") {\n            return; // not an event generated by us, ignore.\n        }\n        this.dispatchEvent(event.data.type, event);\n    }\n    /**\n     * Posts a [[WorkerServiceProtocol.RequestMessage]] to an available worker. If no worker is\n     * available, the request is put into a queue.\n     *\n     * @param message The message to send.\n     * @param buffers Optional buffers to transfer to the worker.\n     * @param requestController An optional [[RequestController]] to store state of cancelling.\n     */\n    postRequestMessage(message, buffers, requestController) {\n        this.ensureStarted();\n        if (this.m_workers.length === 0) {\n            throw new Error(\"ConcurrentWorkerSet#postMessage: no workers started\");\n        }\n        // Check if the requestController has received the abort signal, in which case the request\n        // is ignored.\n        if (requestController !== undefined && requestController.signal.aborted) {\n            const entry = this.m_requests.get(message.messageId);\n            if (entry === undefined) {\n                logger.error(`[${this.m_options.scriptUrl}]: Bad RequesMessage: invalid messageId`);\n                return;\n            }\n            const err = new Error(\"Aborted\");\n            err.name = \"AbortError\";\n            entry.resolver(err, undefined);\n            return;\n        }\n        if (this.m_availableWorkers.length > 0) {\n            const worker = this.m_availableWorkers.pop();\n            worker.postMessage(message, buffers);\n        }\n        else {\n            // We need a priority to keep sorting stable, so we have to add a RequestController.\n            if (requestController === undefined) {\n                requestController = new harp_datasource_protocol_1.RequestController(0);\n            }\n            if (requestController.priority === 0) {\n                // If the requests do not get a priority, they should keep their sorting order.\n                requestController.priority = -this.m_nextMessageId;\n            }\n            this.m_workerRequestQueue.unshift({\n                message,\n                buffers,\n                requestController\n            });\n        }\n    }\n    ensureStarted() {\n        if (this.m_stopped) {\n            throw new Error(\"ConcurrentWorkerSet stopped\");\n        }\n    }\n    waitForAllResponses() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const promises = new Array();\n            this.m_requests.forEach(entry => {\n                promises.push(entry.promise);\n            });\n            yield Promise.all(promises);\n        });\n    }\n    dispatchEvent(id, message) {\n        const callback = this.m_eventListeners.get(id);\n        if (callback === undefined) {\n            return;\n        } // unknown event, ignore.\n        callback(message);\n    }\n    terminateWorkers() {\n        // terminate all workers\n        this.m_workerPromises.forEach(workerPromise => {\n            workerPromise\n                .then(worker => {\n                const workerId = this.m_workers.indexOf(worker);\n                if (workerId >= 0) {\n                    const listener = this.m_workerListeners[workerId];\n                    worker.removeEventListener(\"message\", listener);\n                }\n                else {\n                    logger.error(`[${this.m_options.scriptUrl}]: ConcurrentWorkerSet#terminateWorkers: invalid workerId`);\n                }\n                worker.terminate();\n            })\n                .catch(() => {\n                // we ignore exception here, as it's already logged in #start and terminate is\n                // noop if worker didn't start at all\n            });\n        });\n        this.m_workers = [];\n        this.m_workerListeners = [];\n        this.m_workerPromises = [];\n        this.m_availableWorkers = [];\n        this.m_readyPromises.clear();\n    }\n    getReadyPromise(id) {\n        const readyPromise = this.m_readyPromises.get(id);\n        if (readyPromise !== undefined) {\n            return readyPromise;\n        }\n        const newPromise = {\n            count: 0,\n            promise: undefined,\n            resolve: () => {\n                /* placeholder */\n            },\n            reject: (error) => {\n                newPromise.error = error;\n            },\n            error: undefined\n        };\n        newPromise.promise = new Promise((resolve, reject) => {\n            const that = newPromise;\n            if (that.error !== undefined) {\n                reject(that.error);\n            }\n            else if (that.count === this.m_workerPromises.length) {\n                resolve();\n            }\n            that.resolve = resolve;\n            that.reject = reject;\n        });\n        this.m_readyPromises.set(id, newPromise);\n        return newPromise;\n    }\n    /**\n     * Check the worker request queue, if there are any queued up decoding jobs and idle workers,\n     * they will be executed with postRequestMessage. The requests in the queue are sorted before\n     * the request with the highest priority is selected for processing.\n     */\n    checkWorkerRequestQueue() {\n        if (this.m_workerRequestQueue.length === 0 || this.m_availableWorkers.length === 0) {\n            return;\n        }\n        this.m_workerRequestQueue.sort((a, b) => {\n            return a.requestController.priority - b.requestController.priority;\n        });\n        // Get the request with the highest priority and send it (again).\n        while (this.m_availableWorkers.length > 0 && this.m_workerRequestQueue.length > 0) {\n            const request = this.m_workerRequestQueue.pop();\n            this.postRequestMessage(request.message, request.buffers, request.requestController);\n        }\n    }\n}\nexports.ConcurrentWorkerSet = ConcurrentWorkerSet;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\n/**\n * Identifier of next decoder worker-service. Used to ensure uniqueness of service ids of decoders\n * dedicated to different datasources.\n */\nlet nextUniqueServiceId = 0;\n/**\n * Decoder based on [[ConcurrentWorkerSet]].\n *\n * Decodes tiles using workers running in separate contexts (also known as `WebWorkers`):\n * - connection establishment,\n * - sends decode requests,\n * - configuration.\n */\nclass WorkerBasedDecoder {\n    /**\n     * Creates a new `WorkerBasedDecoder`.\n     *\n     * @param workerSet [[ConcurrentWorkerSet]] this tiler will live in.\n     * @param decoderServiceType Service type identifier.\n     */\n    constructor(workerSet, decoderServiceType) {\n        this.workerSet = workerSet;\n        this.decoderServiceType = decoderServiceType;\n        this.m_serviceCreated = false;\n        this.workerSet.addReference();\n        this.serviceId = `${this.decoderServiceType}-${nextUniqueServiceId++}`;\n    }\n    /**\n     * Dispose of dedicated tile decoder services in workers and remove reference to underlying\n     * [[ConcurrentWorkerSet]].\n     */\n    dispose() {\n        if (this.m_serviceCreated) {\n            this.workerSet.broadcastRequest(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID, {\n                type: harp_datasource_protocol_1.WorkerServiceProtocol.Requests.DestroyService,\n                targetServiceId: this.serviceId\n            });\n        }\n        this.workerSet.removeReference();\n    }\n    /**\n     * Connects to [[WorkerServiceManager]]s in underlying [[ConcurrentWorkerSet]] and creates\n     * dedicated [[TileDecoderService]]s in all workers to serve decode requests.\n     */\n    connect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.workerSet.connect(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID);\n            if (!this.m_serviceCreated) {\n                yield this.workerSet.broadcastRequest(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID, {\n                    type: harp_datasource_protocol_1.WorkerServiceProtocol.Requests.CreateService,\n                    targetServiceType: this.decoderServiceType,\n                    targetServiceId: this.serviceId\n                });\n                this.m_serviceCreated = true;\n            }\n        });\n    }\n    /**\n     * Get [[Tile]] from tile decoder service in worker.\n     *\n     * Invokes [[DecodeTileRequest]] on [[TileDecoderService]] running in worker pool.\n     */\n    decodeTile(data, tileKey, projection, requestController) {\n        const tileKeyCode = tileKey.mortonCode();\n        const message = {\n            type: harp_datasource_protocol_1.WorkerDecoderProtocol.Requests.DecodeTileRequest,\n            tileKey: tileKeyCode,\n            data,\n            projection: harp_datasource_protocol_1.getProjectionName(projection)\n        };\n        const transferList = data instanceof ArrayBuffer ? [data] : undefined;\n        return this.workerSet.invokeRequest(this.serviceId, message, transferList, requestController);\n    }\n    /**\n     * Get [[TileInfo]] from tile decoder service in worker.\n     *\n     * Invokes [[TileInfoRequest]] on [[TileDecoderService]] running in worker pool.\n     */\n    getTileInfo(data, tileKey, projection, requestController) {\n        const tileKeyCode = tileKey.mortonCode();\n        const message = {\n            type: harp_datasource_protocol_1.WorkerDecoderProtocol.Requests.TileInfoRequest,\n            tileKey: tileKeyCode,\n            data,\n            projection: harp_datasource_protocol_1.getProjectionName(projection)\n        };\n        const transferList = data instanceof ArrayBuffer ? [data] : undefined;\n        return this.workerSet.invokeRequest(this.serviceId, message, transferList, requestController);\n    }\n    /**\n     * Configure tile decoder service in workers.\n     *\n     * Broadcasts [[ConfigurationMessage]] to all [[TileDecoderService]]s running in worker pool.\n     *\n     * @param styleSet  new [[StyleSet]], undefined means no change\n     * @param languages new list of languages\n     * @param options   new options, undefined options are not changed\n     */\n    configure(styleSet, languages, options) {\n        const message = {\n            service: this.serviceId,\n            type: harp_datasource_protocol_1.WorkerDecoderProtocol.DecoderMessageName.Configuration,\n            styleSet,\n            options,\n            languages\n        };\n        this.workerSet.broadcastMessage(message);\n    }\n}\nexports.WorkerBasedDecoder = WorkerBasedDecoder;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ImageCache_1 = require(\"./ImageCache\");\n/**\n * Cache images wrapped into [[ImageItem]]s for a [[MapView]]. An image may have multiple names in\n * a theme, the `MapViewImageCache` will take care of that. Registering multiple images with the\n * same name is invalid.\n *\n * The `MapViewImageCache` uses a global [[ImageCache]] to actually store (and generate) the\n * image data.\n */\nclass MapViewImageCache {\n    /**\n     * The constructor for `MapViewImageCache`.\n     *\n     * @param mapView a [[MapView]] instance.\n     */\n    constructor(mapView) {\n        this.mapView = mapView;\n        this.m_name2Url = new Map();\n        this.m_url2Name = new Map();\n    }\n    /**\n     * Register an existing image by name.\n     *\n     * @param name Name of the image from [[Theme]].\n     * @param url URL of image.\n     * @param image Optional [[ImageData]] of image.\n     */\n    registerImage(name, url, image) {\n        if (name !== undefined) {\n            if (this.hasName(name)) {\n                throw new Error(\"duplicate name in cache\");\n            }\n            const oldNames = this.m_url2Name.get(url);\n            if (oldNames !== undefined) {\n                if (oldNames.indexOf(name) < 0) {\n                    oldNames.push(name);\n                }\n            }\n            else {\n                this.m_url2Name.set(url, [name]);\n            }\n            this.m_name2Url.set(name, url);\n        }\n        const imageItem = ImageCache_1.ImageCache.instance.findImage(url);\n        if (imageItem === undefined) {\n            return ImageCache_1.ImageCache.instance.registerImage(this.mapView, url, image);\n        }\n        return imageItem;\n    }\n    /**\n     * Add an image and optionally start loading it. Once done, the [[ImageData]] or [[ImageBitmap]]\n     * will be stored in the [[ImageItem]].\n     *\n     * @param name Name of image from [[Theme]].\n     * @param url URL of image.\n     * @param startLoading Optional. Pass `true` to start loading the image in the background.\n     */\n    addImage(name, url, startLoading = true) {\n        const imageItem = this.registerImage(name, url, undefined);\n        if (startLoading === true) {\n            return ImageCache_1.ImageCache.instance.loadImage(imageItem);\n        }\n        return imageItem;\n    }\n    /**\n     * Find [[ImageItem]] by its name.\n     *\n     * @param name Name of image.\n     */\n    findImageByName(name) {\n        const url = this.m_name2Url.get(name);\n        if (url === undefined) {\n            return undefined;\n        }\n        return ImageCache_1.ImageCache.instance.findImage(url);\n    }\n    /**\n     * Find [[ImageItem]] by URL.\n     *\n     * @param url Url of image.\n     */\n    findImageByUrl(url) {\n        return ImageCache_1.ImageCache.instance.findImage(url);\n    }\n    /**\n     * Load an [[ImageItem]]. Returns a promise or a loaded [[ImageItem]].\n     *\n     * @param imageItem ImageItem to load.\n     */\n    loadImage(imageItem) {\n        return ImageCache_1.ImageCache.instance.loadImage(imageItem);\n    }\n    /**\n     * Remove all [[ImageItem]]s from the cache. Also removes all [[ImageItem]]s that belong to this\n     * [[MapView]] from the global [[ImageCache]].\n     */\n    clear() {\n        ImageCache_1.ImageCache.instance.clear(this.mapView);\n        this.m_name2Url = new Map();\n        this.m_url2Name = new Map();\n    }\n    /**\n     * Returns number of image names stored in the cache.\n     */\n    get numberOfNames() {\n        return this.m_name2Url.size;\n    }\n    /**\n     * Returns number of image URLs in the cache.\n     */\n    get numberOfUrls() {\n        return this.m_url2Name.size;\n    }\n    /**\n     * Return `true` if an image with the given name is known.\n     *\n     * @param name Name of the image.\n     */\n    hasName(name) {\n        return this.m_name2Url.get(name) !== undefined;\n    }\n    /**\n     * Return `true` if an image with the given URL is known.\n     * @param url URL of image.\n     */\n    hasUrl(url) {\n        return this.m_url2Name.get(url) !== undefined;\n    }\n    /**\n     * Return the names under which an image with the given URL is saved.\n     */\n    findNames(url) {\n        return this.m_url2Name.get(url);\n    }\n}\nexports.MapViewImageCache = MapViewImageCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"ImageCache\");\n/**\n * Combines an [[ImageItem]] with a list of [[MapViews]] that reference it.\n */\nclass ImageCacheItem {\n    /**\n     * Instantiates `ImageCacheItem`.\n     *\n     * @param imageItem The [[ImageItem]] referenced by the associated [[MapView]]s instances.\n     * @param mapView An optional first [[MapView]] referencing the [[ImageItem]].\n     */\n    constructor(imageItem, mapView) {\n        this.imageItem = imageItem;\n        /**\n         * The list of [[MapView]]s referencing the [[ImageItem]].\n         */\n        this.mapViews = [];\n        if (mapView !== undefined) {\n            this.mapViews.push(mapView);\n        }\n    }\n}\n/**\n * `ImageCache` is a singleton, so it can be used with multiple MapViews on a single page. This\n * allows to have an image loaded only once for multiple views. THREE is doing something similar,\n * but does not allow to share images that have been loaded from a canvas (which we may need to do\n * if we use SVG images for textures).\n *\n * One application that makes our own cache necessary is the generation of our own textures from\n * data that is not an URL.\n *\n * The `ImageCache` can be improved by adding satistics for memory footprint as well.\n */\nclass ImageCache {\n    constructor() {\n        this.m_images = new Map();\n    }\n    /**\n     * Returns the singleton `instance` of the `ImageCache`.\n     */\n    static get instance() {\n        if (ImageCache.m_instance === undefined) {\n            ImageCache.m_instance = new ImageCache();\n        }\n        return ImageCache.m_instance;\n    }\n    /**\n     * Dispose the singleton object. Not normally implemented for singletons, but good for\n     * debugging.\n     */\n    static dispose() {\n        ImageCache.m_instance = undefined;\n    }\n    /**\n     * Add an image definition to the global cache. Useful when the image data is already loaded.\n     *\n     * @param mapView Specifiy which [[MapView]] requests the image.\n     * @param url URL of image.\n     * @param imageData Optional [ImageData]] containing the image content.\n     */\n    registerImage(mapView, url, imageData) {\n        let imageCacheItem = this.findImageCacheItem(url);\n        if (imageCacheItem !== undefined) {\n            if (mapView !== undefined && imageCacheItem.mapViews.indexOf(mapView) < 0) {\n                imageCacheItem.mapViews.push(mapView);\n            }\n            return imageCacheItem.imageItem;\n        }\n        imageCacheItem = this.findImageCacheItem(url);\n        if (imageCacheItem !== undefined) {\n            if (mapView !== undefined && imageCacheItem.mapViews.indexOf(mapView) < 0) {\n                imageCacheItem.mapViews.push(mapView);\n            }\n            return imageCacheItem.imageItem;\n        }\n        const mapViews = [];\n        if (mapView !== undefined) {\n            mapViews.push(mapView);\n        }\n        imageCacheItem = {\n            imageItem: {\n                url,\n                imageData,\n                loaded: false\n            },\n            mapViews\n        };\n        this.m_images.set(url, imageCacheItem);\n        return imageCacheItem.imageItem;\n    }\n    /**\n     * Add an image definition, and optionally start loading the content.\n     *\n     * @param mapView [[MapView]] requesting the image.\n     * @param url URL of image.\n     * @param startLoading Optional flag. If `true` the image will be loaded in the background.\n     */\n    addImage(mapView, url, startLoading = true) {\n        const imageItem = this.registerImage(mapView, url, undefined);\n        if (imageItem !== undefined && startLoading === true) {\n            return this.loadImage(imageItem);\n        }\n        return imageItem;\n    }\n    /**\n     * Find [[ImageItem]] for the specified URL.\n     *\n     * @param url URL of image.\n     * @returns `ImageItem` for the URL if the URL is registered, `undefined` otherwise.\n     */\n    findImage(url) {\n        const imageItem = this.m_images.get(url);\n        if (imageItem !== undefined) {\n            return imageItem.imageItem;\n        }\n        return undefined;\n    }\n    /**\n     * Clear all [[ImageItem]]s belonging to a [[MapView]]. May remove cached items if no\n     * [[MapView]] are registered anymore.\n     *\n     * @param mapView MapView to remove all [[ImageItem]]s from.\n     */\n    clear(mapView) {\n        const itemsToRemove = [];\n        this.m_images.forEach(imageItem => {\n            const mapViewIndex = imageItem.mapViews.indexOf(mapView);\n            if (mapViewIndex >= 0) {\n                imageItem.mapViews.splice(mapViewIndex, 1);\n            }\n            if (imageItem.mapViews.length === 0) {\n                itemsToRemove.push(imageItem.imageItem.url);\n            }\n        });\n        for (const keyToDelete of itemsToRemove) {\n            this.m_images.delete(keyToDelete);\n        }\n    }\n    /**\n     * Clear all [[ImageItem]]s from all [[MapView]]s.\n     */\n    clearAll() {\n        this.m_images = new Map();\n    }\n    /**\n     * Returns the number of all cached [[ImageItem]]s.\n     */\n    get size() {\n        return this.m_images.size;\n    }\n    /**\n     * Load an [[ImageItem]]. If the loading process is already running, it returns the current\n     * promise.\n     *\n     * @param imageItem `ImageItem` containing the URL to load image from.\n     * @returns An [[ImageItem]] if the image has already been loaded, a promise otherwise.\n     */\n    loadImage(imageItem) {\n        if (imageItem.imageData !== undefined) {\n            return imageItem;\n        }\n        if (imageItem.loadingPromise !== undefined) {\n            return imageItem.loadingPromise;\n        }\n        const imageLoader = new THREE.ImageLoader();\n        imageItem.loadingPromise = new Promise(resolve => {\n            logger.log(`Loading image: ${imageItem.url}`);\n            imageLoader.load(imageItem.url, image => {\n                logger.log(`... finished loading image: ${imageItem.url}`);\n                this.renderImage(imageItem, image)\n                    .then(() => {\n                    imageItem.loadingPromise = undefined;\n                    resolve(imageItem);\n                })\n                    .catch(ex => {\n                    logger.error(`... loading image failed: ${imageItem.url} : ${ex}`);\n                    resolve(undefined);\n                });\n            }, \n            // Loading events no longer supported\n            undefined, errorEvent => {\n                logger.error(`... loading image failed: ${imageItem.url} : ${errorEvent}`);\n                imageItem.loadingPromise = undefined;\n                resolve(undefined);\n            });\n        });\n        return imageItem.loadingPromise;\n    }\n    /**\n     * Find the cached [[ImageItem]] by URL.\n     *\n     * @param url URL of image.\n     */\n    findImageCacheItem(url) {\n        return this.m_images.get(url);\n    }\n    /**\n     * Render the `ImageItem` by using `createImageBitmap()` or by rendering the image into a\n     * [[HTMLCanvasElement]].\n     *\n     * @param imageItem [[ImageItem]] to assign image data to.\n     * @param image [[HTMLImageElement]] to\n     */\n    renderImage(imageItem, image) {\n        return new Promise((resolve, reject) => {\n            // use createImageBitmap if it is available. It should be available in webworkers as\n            // well\n            if (typeof createImageBitmap === \"function\") {\n                const options = {\n                    premultiplyAlpha: \"default\",\n                    imageOrientation: \"flipY\"\n                };\n                logger.log(`Creating bitmap image: ${imageItem.url}`);\n                createImageBitmap(image, 0, 0, image.width, image.height, options)\n                    .then(imageBitmap => {\n                    logger.log(`... finished creating bitmap image: ${imageItem.url}`);\n                    imageItem.loadingPromise = undefined;\n                    imageItem.imageData = imageBitmap;\n                    imageItem.loaded = true;\n                    resolve(imageBitmap);\n                })\n                    .catch(ex => {\n                    logger.error(`... loading image failed: ${imageItem.url} : ${ex}`);\n                    resolve(undefined);\n                });\n            }\n            else {\n                try {\n                    if (typeof document === \"undefined\") {\n                        logger.error(\"Error: document is not available, cannot generate image\");\n                        reject(new Error(\"ImageCache#renderImage: document is not available, cannot \" +\n                            \"render image to create texture\"));\n                    }\n                    // TODO: Extract the rendering to the canvas part and make it configurable for\n                    // the client, so it does not rely on the `document`.\n                    // use the image, e.g. draw part of it on a canvas\n                    const canvas = document.createElement(\"canvas\");\n                    canvas.width = image.width;\n                    canvas.height = image.height;\n                    const context = canvas.getContext(\"2d\");\n                    if (context !== null) {\n                        logger.log(`... finished creating bitmap image in canvas: ${imageItem.url} ${image}`);\n                        context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\n                        const imageData = context.getImageData(0, 0, image.width, image.height);\n                        imageItem.imageData = imageData;\n                        imageItem.loaded = true;\n                        resolve(imageData);\n                    }\n                    else {\n                        logger.error(`renderImage: no context found`);\n                        reject(new Error(`ImageCache#renderImage: no context found`));\n                    }\n                }\n                catch (ex) {\n                    logger.error(`renderImage failed: ${ex}`);\n                    imageItem.imageData = undefined;\n                    imageItem.loaded = true;\n                    reject(new Error(`ImageCache#renderImage failed: ${ex}`));\n                }\n            }\n        });\n    }\n}\nexports.ImageCache = ImageCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst THREE = require(\"three\");\n/**\n * Manages the fog display in [[MapView]].\n */\nclass MapViewFog {\n    /**\n     * Constructs a `MapViewFog` instance.\n     *\n     * @param m_scene The scene used in [[MapView]] that contains the map objects.\n     */\n    constructor(m_scene) {\n        this.m_scene = m_scene;\n        this.m_enabled = true;\n        this.m_fog = new THREE.Fog(0x000000); // Default color asked by DefinitelyTyped.\n        this.m_fogIsDefined = false;\n        this.m_cachedTheme = { styles: {} };\n    }\n    /**\n     * Allows for disabling the fog, even if it is defined in the theme. Use this property for\n     * custom views like the demo app's debug camera. However, if the theme does not define a\n     * fog, enabling this property here has no effect.\n     *\n     * @param value A boolean that specifies whether the fog should be enabled or disabled.\n     */\n    set enabled(enableFog) {\n        this.m_enabled = enableFog;\n        if (enableFog && this.m_fogIsDefined && this.m_scene.fog === null) {\n            this.add();\n        }\n        else if (!enableFog && this.m_scene.fog !== null) {\n            this.remove();\n        }\n    }\n    /**\n     * Returns the current fog status, enabled or disabled.\n     */\n    get enabled() {\n        return this.m_enabled;\n    }\n    /**\n     * Sets the fog depending on the [[Theme]] instance provided. This function is called when a\n     * theme is loaded. Fog is added only if the theme contains:\n     * - a sky definition with a `colorBottom` property, used to set the fog color\n     * - a fog definition with a `startRatio` property, used to set the start distance of the fog\n     *   as a ratio of the far culling plane distance.\n     *\n     * @param theme A [[Theme]] instance.\n     */\n    reset(theme) {\n        this.m_cachedTheme = theme;\n        if (theme !== undefined &&\n            theme.sky !== undefined &&\n            theme.sky.colorBottom !== undefined &&\n            theme.fog !== undefined &&\n            theme.fog.startRatio !== undefined // This will be necessary in the `update` method.\n        ) {\n            this.m_fogIsDefined = true;\n            this.m_fog.color.set(theme.sky.colorBottom);\n            if (this.m_enabled && this.m_scene.fog === null) {\n                this.add();\n            }\n        }\n        else {\n            this.m_fogIsDefined = false;\n            if (this.m_scene.fog !== null) {\n                this.remove();\n            }\n        }\n    }\n    /**\n     * Updates the fog at runtime, depending on the camera.\n     *\n     * @param camera An instance of a `THREE.Camera` with a `far` property.\n     */\n    update(camera) {\n        if (this.m_scene.fog !== null &&\n            camera.far !== undefined &&\n            this.m_cachedTheme !== undefined &&\n            this.m_cachedTheme.fog &&\n            this.m_cachedTheme.fog.startRatio !== undefined) {\n            this.m_fog.far = camera.far;\n            this.m_fog.near = camera.far * this.m_cachedTheme.fog.startRatio;\n        }\n    }\n    /**\n     * Handles fog addition.\n     */\n    add() {\n        // When the fog is changed, ThreeJS takes care of recompiling its built-in materials...\n        this.m_scene.fog = this.m_fog;\n        // ...except the `RawShaderMaterial`, on purpose, so it needs to be updated from the app.\n        this.setFogInRawShaderMaterials(true);\n    }\n    /**\n     * Handles fog removal.\n     */\n    remove() {\n        // When the fog is changed, ThreeJS takes care of recompiling its built-in materials...\n        this.m_scene.fog = null;\n        // ...except the `RawShaderMaterial`, on purpose, so it needs to be updated from the app.\n        this.setFogInRawShaderMaterials(false);\n    }\n    /**\n     * ThreeJS lets users manage the `RawShaderMaterial` themselves, so they need to be modified\n     * explicitly.\n     *\n     * @see https://github.com/mrdoob/three.js/blob/dev/src/renderers/webgl/WebGLProgram.js#L298\n     */\n    setFogInRawShaderMaterials(enableFog) {\n        this.m_scene.traverse(object => {\n            if (object instanceof THREE.Mesh) {\n                if (object.material instanceof THREE.Material) {\n                    if (object.material instanceof THREE.Material &&\n                        // HighPrecisionLineMaterial does not support fog\n                        !(object.material instanceof harp_materials_1.HighPrecisionLineMaterial)) {\n                        if (object.material instanceof harp_materials_1.SolidLineMaterial) {\n                            const material = object.material;\n                            material.updateFog(enableFog);\n                        }\n                        object.material.fog = enableFog;\n                        object.material.needsUpdate = true;\n                    }\n                }\n            }\n        });\n    }\n}\nexports.MapViewFog = MapViewFog;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_text_canvas_1 = require(\"@here/harp-text-canvas\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst ColorCache_1 = require(\"../ColorCache\");\nconst TextElement_1 = require(\"../text/TextElement\");\nconst TextElementsRenderer_1 = require(\"../text/TextElementsRenderer\");\nconst TextStyleCache_1 = require(\"../text/TextStyleCache\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"PoiManager\");\n/**\n * POI manager class, responsible for loading the [[PoiGeometry]] objects from the [[DecodedTile]],\n * and preparing them for rendering. Also loads and manages the texture atlases for the icons.\n */\nclass PoiManager {\n    /**\n     * The constructor of the `PoiManager`.\n     *\n     * @param mapView The [[MapView]] instance that should display the POIs.\n     */\n    constructor(mapView) {\n        this.mapView = mapView;\n        this.m_imageTextures = new Map();\n        this.m_poiShieldGroups = new Map();\n        this.m_colorMap = new Map();\n    }\n    /**\n     * Add all POIs from a decoded tile and store them as [[TextElement]]s in the [[Tile]].\n     *\n     * Also handles LineMarkers, which is a recurring marker along a line (road).\n     *\n     * @param tile Tile to add POIs to.\n     * @param decodedTile DecodedTile containing the raw [[PoiGeometry]] objects describing the\n     *  POIs.\n     */\n    addPois(tile, decodedTile) {\n        const poiGeometries = harp_utils_1.assertExists(decodedTile.poiGeometries);\n        for (const poiGeometry of poiGeometries) {\n            harp_utils_1.assert(poiGeometry.technique !== undefined);\n            const techniqueIndex = harp_utils_1.assertExists(poiGeometry.technique);\n            const technique = decodedTile.techniques[techniqueIndex];\n            if (!harp_datasource_protocol_1.isLineMarkerTechnique(technique) && !harp_datasource_protocol_1.isPoiTechnique(technique)) {\n                continue;\n            }\n            // The POI may be in the data, and there may be a Technique, but the technique may\n            // specify to not show it.\n            if (technique.showOnMap === false) {\n                continue;\n            }\n            const positions = new THREE.BufferAttribute(new Float32Array(poiGeometry.positions.buffer), poiGeometry.positions.itemCount);\n            if (harp_datasource_protocol_1.isLineMarkerTechnique(technique) && positions.count > 0) {\n                this.addLineMarker(tile, poiGeometry, technique, techniqueIndex, positions);\n            }\n            else {\n                const poiTechnique = technique;\n                let imageTextureName = poiTechnique.imageTexture;\n                if (poiGeometry.stringCatalog === undefined) {\n                    continue;\n                }\n                const poiTableName = poiTechnique.poiTable;\n                let poiName = poiTechnique.poiName;\n                for (let i = 0; i < positions.count; ++i) {\n                    const x = positions.getX(i);\n                    const y = positions.getY(i);\n                    harp_utils_1.assert(poiGeometry.texts.length > i);\n                    let text = poiGeometry.stringCatalog[poiGeometry.texts[i]];\n                    if (text === undefined) {\n                        text = \"\";\n                    }\n                    if (poiGeometry.stringCatalog !== undefined) {\n                        if (poiGeometry.imageTextures !== undefined &&\n                            poiGeometry.imageTextures[i] >= 0) {\n                            harp_utils_1.assert(poiGeometry.imageTextures.length > i);\n                            imageTextureName =\n                                poiGeometry.stringCatalog[poiGeometry.imageTextures[i]];\n                        }\n                        else {\n                            imageTextureName = poiTechnique.imageTexture;\n                        }\n                        if (poiTableName !== undefined) {\n                            // The POI name to be used is taken from the data, since it will\n                            // specify the name of the texture to use.\n                            // The POI name in the technique may override the POI name from the\n                            // data.\n                            poiName =\n                                poiTechnique.poiName === undefined\n                                    ? imageTextureName\n                                    : poiTechnique.poiName;\n                            imageTextureName = undefined;\n                        }\n                    }\n                    const textElement = this.checkCreateTextElement(tile, text, technique, techniqueIndex, imageTextureName, poiTableName, poiName, 0, poiGeometry.featureId, x, y, tile.tileKey.level);\n                    if (textElement !== undefined) {\n                        tile.addTextElement(textElement);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Load the texture atlas that defines the segments of the texture that should be used for\n     * specific icons. Creates an [[ImageTexture]] for every element in the atlas, such that it can\n     * be addressed in the theme file.\n     *\n     * @param imageName Name of the image from the theme (NOT the url!).\n     * @param atlas URL of the JSON file defining the texture atlas.\n     */\n    addTextureAtlas(imageName, atlas) {\n        fetch(atlas)\n            .then(response => {\n            if (!response.ok) {\n                throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${response.statusText}`);\n            }\n            return response.json();\n        })\n            .then((jsonAtlas) => {\n            if (jsonAtlas === undefined) {\n                logger.info(`addTextureAtlas: TextureAtlas empty: ${atlas}`);\n                return;\n            }\n            try {\n                logger.log(`addTextureAtlas: Loading textureAtlas '${atlas}' for image '${imageName}'`);\n                for (const textureName of Object.getOwnPropertyNames(jsonAtlas)) {\n                    const imageTextureDef = jsonAtlas[textureName];\n                    const imageTexture = {\n                        name: textureName,\n                        image: imageName,\n                        xOffset: imageTextureDef.x,\n                        yOffset: imageTextureDef.y,\n                        width: imageTextureDef.width,\n                        height: imageTextureDef.height\n                    };\n                    this.addImageTexture(imageTexture);\n                }\n            }\n            catch (ex) {\n                logger.error(`addTextureAtlas: Failed to load textureAtlas ` + `'${atlas}' : ${ex}`);\n            }\n            this.mapView.update();\n        })\n            .catch((reason) => {\n            logger.error(`addTextureAtlas: Failed to load textureAtlas '${atlas}' : ${reason}`);\n        });\n    }\n    /**\n     * Add an [[ImageTexture]] such that it is available as a named entity for techniques in theme\n     * files.\n     *\n     * @param imageTexture [[ImageTexture]] that should be available for POIs.\n     */\n    addImageTexture(imageTexture) {\n        if (imageTexture.name === undefined) {\n            logger.error(\"addImageTexture: Name required\", imageTexture);\n            return;\n        }\n        if (this.m_imageTextures.get(imageTexture.name) !== undefined) {\n            logger.warn(`addImageTexture: Name already used: ${imageTexture.name}` + ` (overriding it)`);\n        }\n        this.m_imageTextures.set(imageTexture.name, imageTexture);\n    }\n    /**\n     * Return the [[ImageTexture]] registered under the specified name.\n     *\n     * @param name Name of the [[ImageTexture]].\n     */\n    getImageTexture(name) {\n        return this.m_imageTextures.get(name);\n    }\n    /**\n     * Update the [[TextElement]] with the information taken from the [[PoiTable]] which is\n     * referenced in the [[PoiInfo]] of the pointLabel.\n     *\n     * If the requested [[PoiTable]] is not available yet, the function returns `false`.\n     * If the [[PoiTable]] is not defined, or if the references POI has no entry in\n     * the [[PoiTable]], no action is taken, and the function returns `false`.\n     *\n     * If the [[PoiTable]] has been processed, it returns `true`, indicating that this function\n     * doesn't have to be called again.\n     *\n     * @param pointLabel The [[TextElement]] to update.\n     *\n     * @returns `true` if the [[PoiTable]] has been processed, and the function does not have to be\n     *          called again.\n     */\n    updatePoiFromPoiTable(pointLabel) {\n        const poiInfo = pointLabel.poiInfo;\n        if (poiInfo === undefined ||\n            poiInfo.poiTableName === undefined ||\n            poiInfo.poiName === undefined) {\n            return true;\n        }\n        let poiTableName = poiInfo.poiTableName;\n        const poiTable = this.mapView.poiTableManager.getPoiTable(poiTableName);\n        if (poiTable !== undefined && poiTable.isLoading) {\n            // The PoiTable is still loading, we have to try again.\n            return false;\n        }\n        if (poiTable === undefined || !poiTable.loadedOk) {\n            // Warn about a missing POI table name, but only once.\n            if (poiTableName === undefined) {\n                poiTableName = \"undefined\";\n            }\n            if (PoiManager.m_missingPoiTableName.get(poiTableName) === undefined) {\n                PoiManager.m_missingPoiTableName.set(poiTableName, true);\n                if (poiTable !== undefined && !poiTable.loadedOk) {\n                    logger.error(`Error loading POI table name ${poiTableName}`);\n                }\n                else {\n                    logger.error(`updatePoiFromPoiTable: No POI table with name '${poiTableName}' found.`);\n                }\n            }\n            return true;\n        }\n        let poiName = poiInfo.poiName;\n        const poiTableEntry = poiTable.poiDict.get(poiName);\n        if (poiTableEntry === undefined) {\n            // Warn about a missing POI name, but only once.\n            if (poiName === undefined) {\n                poiName = \"undefined\";\n            }\n            if (PoiManager.m_missingPoiName.get(poiName) === undefined) {\n                PoiManager.m_missingPoiName.set(poiName, true);\n                logger.warn(`Cannot find POI info '${poiName}' found in table ${poiTableName}.`);\n            }\n            return true;\n        }\n        if (poiTableEntry.iconName !== undefined) {\n            poiInfo.imageTextureName = poiTableEntry.iconName;\n        }\n        pointLabel.visible =\n            poiTableEntry.visible !== undefined ? poiTableEntry.visible : pointLabel.visible;\n        pointLabel.priority =\n            poiTableEntry.priority !== undefined ? poiTableEntry.priority : pointLabel.priority;\n        poiInfo.iconMinZoomLevel =\n            poiTableEntry.iconMinLevel !== undefined\n                ? poiTableEntry.iconMinLevel\n                : poiInfo.iconMinZoomLevel;\n        poiInfo.iconMaxZoomLevel =\n            poiTableEntry.iconMaxLevel !== undefined\n                ? poiTableEntry.iconMaxLevel\n                : poiInfo.iconMaxZoomLevel;\n        poiInfo.textMinZoomLevel =\n            poiTableEntry.textMinLevel !== undefined\n                ? poiTableEntry.textMinLevel\n                : poiInfo.textMinZoomLevel;\n        poiInfo.textMaxZoomLevel =\n            poiTableEntry.textMaxLevel !== undefined\n                ? poiTableEntry.textMaxLevel\n                : poiInfo.textMaxZoomLevel;\n        pointLabel.updateMinMaxZoomLevelsFromPoiInfo();\n        return true;\n    }\n    /**\n     * Clear internal state. Applicable when switching themes.\n     */\n    clear() {\n        this.m_imageTextures.clear();\n        this.m_poiShieldGroups.clear();\n    }\n    /**\n     * Add the LineMarker as a POI with a series of positions. Make sure that the LineMarkers\n     * having the same visual all get their `shieldGroupIndex` set appropriately, so it can be taken\n     * care of later that not too many of them are rendered (obey `minDistance` attribute).\n     */\n    addLineMarker(tile, poiGeometry, technique, techniqueIdx, positions) {\n        let imageTexture = technique.imageTexture;\n        let text;\n        if (poiGeometry.stringCatalog !== undefined && poiGeometry.imageTextures !== undefined) {\n            imageTexture = poiGeometry.stringCatalog[poiGeometry.imageTextures[0]];\n            text = poiGeometry.stringCatalog[poiGeometry.texts[0]];\n        }\n        if (text === undefined) {\n            text = \"\";\n        }\n        // let the combined image texture name (name of image in atlas, not the URL) and\n        // text of the shield be the group key\n        const groupKey = String(imageTexture) + \"-\" + text;\n        let shieldGroupIndex = this.m_poiShieldGroups.get(groupKey);\n        if (shieldGroupIndex === undefined) {\n            shieldGroupIndex = this.m_poiShieldGroups.size;\n            this.m_poiShieldGroups.set(groupKey, shieldGroupIndex);\n        }\n        // Debugging help to identify the group of a shield :\n        // text = groupKey + \": \" + text;\n        const positionArray = [];\n        for (let i = 0; i < positions.count; i += 2) {\n            positionArray.push(new THREE.Vector2(positions.getX(i), positions.getY(i)));\n        }\n        const textElement = this.checkCreateTextElement(tile, text, technique, techniqueIdx, imageTexture, undefined, // TBD for road shields\n        undefined, shieldGroupIndex, poiGeometry.featureId, positionArray, undefined, tile.tileKey.level);\n        if (textElement !== undefined) {\n            // If the poi icon is rendered, the label that shows its text should also be rendered.\n            // The distance rule of the icon should apply, not the one for text (only) labels.\n            textElement.ignoreDistance = true;\n            tile.addTextElement(textElement);\n        }\n    }\n    /**\n     * Create the [[TextElement]] for a POI. Even if the POI has no text, it is required that there\n     * is a [[TextElement]], since POIs are hooked onto [[TextElement]]s for sorting.(Sorted by\n     * priority attribute).\n     */\n    checkCreateTextElement(tile, text, technique, techniqueIdx, imageTextureName, poiTableName, poiName, shieldGroupIndex, featureId, x, y, storageLevel) {\n        let textElement;\n        // need some text for now\n        if (text === undefined) {\n            text = \"\";\n        }\n        if (text !== undefined) {\n            const priority = technique.priority !== undefined ? technique.priority : 0;\n            const positions = Array.isArray(x) ? x : new THREE.Vector2(x, y);\n            const displayZoomLevel = this.mapView.zoomLevel;\n            textElement = new TextElement_1.TextElement(harp_text_canvas_1.ContextualArabicConverter.instance.convert(text), positions, this.getRenderStyle(tile.dataSource.name, technique, techniqueIdx), this.getLayoutStyle(tile.dataSource.name, technique), priority, technique.xOffset !== undefined ? technique.xOffset : 0.0, technique.yOffset !== undefined ? technique.yOffset : 0.0, featureId, technique.style, harp_datasource_protocol_1.getPropertyValue(technique.fadeNear, displayZoomLevel), harp_datasource_protocol_1.getPropertyValue(technique.fadeFar, displayZoomLevel));\n            textElement.mayOverlap = technique.textMayOverlap === true;\n            textElement.reserveSpace = technique.textReserveSpace !== false;\n            textElement.alwaysOnTop = technique.alwaysOnTop === true;\n            const textIsOptional = technique.textIsOptional === true;\n            const iconIsOptional = technique.iconIsOptional !== false;\n            const renderTextDuringMovements = !(technique.renderTextDuringMovements === false);\n            const iconMayOverlap = technique.iconMayOverlap === undefined\n                ? textElement.textMayOverlap\n                : technique.iconMayOverlap === true;\n            const iconReserveSpace = technique.iconReserveSpace === undefined\n                ? textElement.textReservesSpace\n                : technique.iconReserveSpace !== false;\n            const distanceScale = technique.distanceScale !== undefined\n                ? technique.distanceScale\n                : TextElementsRenderer_1.DEFAULT_TEXT_DISTANCE_SCALE;\n            // imageTextureName may be undefined if a poiTable is used.\n            if (imageTextureName === undefined && poiTableName !== undefined) {\n                imageTextureName = \"\";\n            }\n            if (imageTextureName !== undefined) {\n                textElement.poiInfo = {\n                    technique,\n                    imageTextureName,\n                    poiTableName,\n                    poiName,\n                    shieldGroupIndex,\n                    textElement,\n                    textIsOptional,\n                    iconIsOptional,\n                    renderTextDuringMovements,\n                    mayOverlap: iconMayOverlap,\n                    reserveSpace: iconReserveSpace,\n                    featureId,\n                    iconMinZoomLevel: technique.iconMinZoomLevel,\n                    iconMaxZoomLevel: technique.iconMaxZoomLevel,\n                    textMinZoomLevel: technique.textMinZoomLevel,\n                    textMaxZoomLevel: technique.textMaxZoomLevel\n                };\n                textElement.updateMinMaxZoomLevelsFromPoiInfo();\n            }\n            else {\n                // Select the smaller/larger one of the two min/max values, because the TextElement\n                // is a container for both.\n                if (textElement.minZoomLevel === undefined) {\n                    textElement.minZoomLevel = technique.textMinZoomLevel;\n                }\n                if (textElement.maxZoomLevel === undefined) {\n                    textElement.maxZoomLevel = technique.textMaxZoomLevel;\n                }\n            }\n            textElement.distanceScale = distanceScale;\n        }\n        return textElement;\n    }\n    getRenderStyle(dataSourceName, technique, techniqueIdx) {\n        const cacheId = TextStyleCache_1.computeStyleCacheId(dataSourceName, technique, this.mapView.zoomLevel);\n        let renderStyle = this.mapView.textRenderStyleCache.get(cacheId);\n        if (renderStyle === undefined) {\n            const defaultRenderParams = this.mapView.textElementsRenderer.defaultStyle\n                .renderParams;\n            const textSize = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.size, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.fontSize.size);\n            const bgSize = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.backgroundSize, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.fontSize.backgroundSize);\n            const hexColor = harp_datasource_protocol_1.getPropertyValue(technique.color, Math.floor(this.mapView.zoomLevel));\n            if (hexColor !== undefined) {\n                this.m_colorMap.set(cacheId, ColorCache_1.ColorCache.instance.getColor(hexColor));\n            }\n            const styleColor = harp_utils_1.getOptionValue(this.m_colorMap.get(cacheId), defaultRenderParams.color);\n            const hexBgColor = harp_datasource_protocol_1.getPropertyValue(technique.backgroundColor, Math.floor(this.mapView.zoomLevel));\n            if (hexBgColor !== undefined) {\n                this.m_colorMap.set(cacheId + \"_bg\", ColorCache_1.ColorCache.instance.getColor(hexBgColor));\n            }\n            const styleBgColor = harp_utils_1.getOptionValue(this.m_colorMap.get(cacheId + \"_bg\"), defaultRenderParams.backgroundColor);\n            const bgAlpha = harp_utils_1.getOptionValue(harp_datasource_protocol_1.getPropertyValue(technique.backgroundAlpha, Math.floor(this.mapView.zoomLevel)), defaultRenderParams.backgroundOpacity);\n            const isSmallCaps = technique.smallCaps === true ||\n                defaultRenderParams.fontVariant === harp_text_canvas_1.FontVariant.SmallCaps;\n            const isAllCaps = technique.allCaps === true ||\n                defaultRenderParams.fontVariant === harp_text_canvas_1.FontVariant.AllCaps;\n            const styleFontVariant = isSmallCaps\n                ? harp_text_canvas_1.FontVariant.SmallCaps\n                : isAllCaps\n                    ? harp_text_canvas_1.FontVariant.AllCaps\n                    : undefined;\n            const styleFontStyle = technique.bold === true\n                ? technique.oblique\n                    ? harp_text_canvas_1.FontStyle.BoldItalic\n                    : harp_text_canvas_1.FontStyle.Bold\n                : technique.oblique === true\n                    ? harp_text_canvas_1.FontStyle.Italic\n                    : defaultRenderParams.fontStyle;\n            const renderParams = {\n                fontSize: {\n                    unit: harp_text_canvas_1.FontUnit.Pixel,\n                    size: textSize,\n                    backgroundSize: bgSize\n                },\n                color: styleColor,\n                backgroundColor: styleBgColor,\n                backgroundOpacity: bgAlpha,\n                fontVariant: styleFontVariant,\n                fontStyle: styleFontStyle\n            };\n            const themeRenderParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.getTextElementStyle(technique.style)\n                    .renderParams\n                : {};\n            renderStyle = new harp_text_canvas_1.TextRenderStyle(Object.assign({}, themeRenderParams, renderParams));\n            this.mapView.textRenderStyleCache.set(cacheId, renderStyle);\n        }\n        return renderStyle;\n    }\n    getLayoutStyle(dataSourceName, technique) {\n        const cacheId = TextStyleCache_1.computeStyleCacheId(dataSourceName, technique, this.mapView.zoomLevel);\n        let layoutStyle = this.mapView.textLayoutStyleCache.get(cacheId);\n        if (layoutStyle === undefined) {\n            const defaultLayoutParams = this.mapView.textElementsRenderer.defaultStyle\n                .layoutParams;\n            const trackingFactor = harp_utils_1.getOptionValue(technique.tracking, defaultLayoutParams.tracking);\n            let hAlignment = defaultLayoutParams.horizontalAlignment;\n            if (technique.hAlignment === \"Left\" ||\n                technique.hAlignment === \"Center\" ||\n                technique.hAlignment === \"Right\") {\n                hAlignment = harp_text_canvas_1.HorizontalAlignment[technique.hAlignment];\n            }\n            let vAlignment = defaultLayoutParams.verticalAlignment;\n            if (technique.vAlignment === \"Above\" ||\n                technique.vAlignment === \"Center\" ||\n                technique.vAlignment === \"Below\") {\n                vAlignment = harp_text_canvas_1.VerticalAlignment[technique.vAlignment];\n            }\n            const layoutParams = {\n                tracking: trackingFactor,\n                horizontalAlignment: hAlignment,\n                verticalAlignment: vAlignment\n            };\n            const themeLayoutParams = this.mapView.textElementsRenderer !== undefined\n                ? this.mapView.textElementsRenderer.getTextElementStyle(technique.style)\n                    .layoutParams\n                : {};\n            layoutStyle = new harp_text_canvas_1.TextLayoutStyle(Object.assign({}, themeLayoutParams, layoutParams));\n            this.mapView.textLayoutStyleCache.set(cacheId, layoutStyle);\n        }\n        return layoutStyle;\n    }\n}\n// Keep track of the missing POI table names, but only warn once.\nPoiManager.m_missingPoiTableName = new Map();\nPoiManager.m_missingPoiName = new Map();\nexports.PoiManager = PoiManager;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"PoiTable\");\n/**\n * Class to store and maintain individual POI information for the [[PoiTable]].\n */\nclass PoiTableEntry {\n    /**\n     * Verify that the JSON description of the POI table entry is valid.\n     *\n     * @param jsonEntry JSON description of the POI table entry.\n     *\n     * @returns `true` if the `jsonEntry` is valid.\n     */\n    static verifyJSON(jsonEntry) {\n        let isOK = typeof jsonEntry.name === \"string\" &&\n            jsonEntry.name.length > 0 &&\n            (jsonEntry.altNames === undefined || Array.isArray(jsonEntry.altNames)) &&\n            (jsonEntry.stackMode === undefined ||\n                jsonEntry.stackMode === \"yes\" ||\n                jsonEntry.stackMode === \"no\" ||\n                jsonEntry.stackMode === \"parent\") &&\n            (jsonEntry.visible === undefined || typeof jsonEntry.visible === \"boolean\") &&\n            (jsonEntry.priority === undefined || typeof jsonEntry.priority === \"number\") &&\n            (jsonEntry.iconMinLevel === undefined || typeof jsonEntry.iconMinLevel === \"number\") &&\n            (jsonEntry.iconMaxLevel === undefined || typeof jsonEntry.iconMaxLevel === \"number\") &&\n            (jsonEntry.textMinLevel === undefined || typeof jsonEntry.textMinLevel === \"number\") &&\n            (jsonEntry.textMaxLevel === undefined || typeof jsonEntry.textMaxLevel === \"number\");\n        if (isOK && jsonEntry.altNames !== undefined) {\n            const altNames = jsonEntry.altNames;\n            for (const str in altNames) {\n                if (typeof str !== \"string\") {\n                    isOK = false;\n                    break;\n                }\n            }\n        }\n        return isOK;\n    }\n    /**\n     * Setup the [[PoiTableEntry]] from the JSON description. It is assumed that the jsonEntry has\n     * been verified with [[PoiTableEntry#verifyJSON]].\n     *\n     * @param jsonEntry JSON description of the POI table entry. Expected to have been verified with\n     *          [[PoiTableEntry#verifyJSON]].\n     */\n    setup(jsonEntry) {\n        this.name = jsonEntry.name;\n        this.altNames = jsonEntry.altNames;\n        this.iconName = jsonEntry.iconName !== undefined ? jsonEntry.iconName : \"<undefined>\";\n        this.visible = jsonEntry.visible;\n        this.priority = jsonEntry.priority;\n        this.iconMinLevel = jsonEntry.iconMinLevel;\n        this.iconMaxLevel = jsonEntry.iconMaxLevel;\n        this.textMinLevel = jsonEntry.textMinLevel;\n        this.textMaxLevel = jsonEntry.textMaxLevel;\n        switch (jsonEntry.stackMode) {\n            case \"yes\":\n                this.stackMode = harp_datasource_protocol_1.PoiStackMode.Show;\n                break;\n            case \"no\":\n                this.stackMode = harp_datasource_protocol_1.PoiStackMode.Hide;\n                break;\n            case \"parent\":\n                this.stackMode = harp_datasource_protocol_1.PoiStackMode.ShowParent;\n                break;\n            default:\n        }\n    }\n}\n/**\n * The `PoiTable` stores individual information for each POI type. If a [[TextElement]] has a\n * reference to a PoiTable (if TextElement.poiInfo.poiTableName is set), information for the\n * TextElement and its icon are read from the PoiTable.\n *\n * The key to look up the POI is taken from the data, in case of OSM data with TileZen data, the\n * \"poiNameField\" is set to \"kind\", which makes the content of the field \"kind\" in the data the key\n * to look up the POIs in the [[PoiTable]].\n *\n * On the side of the [[PoiTable]], the key to look up the PoiTableEntry is either the property\n * \"name\" of the [[PoiTableEntry]]s (which should be unique), or the alternative list of names\n * \"altNames\", where each value should also be unique. If the property `useAltNamesForKey` is set to\n * `true`, the \"altNames\" will be used.\n */\nclass PoiTable {\n    /**\n     * Creates an instance of PoiTable.\n     *\n     * @param {string} name Name of the `PoiTable`. Must be unique.\n     * @param {boolean} useAltNamesForKey Pass `true` to use the contents of the property `altNames`\n     *          to find a [[PoiTableEntry]] in the table.\n     */\n    constructor(name, useAltNamesForKey) {\n        this.name = name;\n        this.useAltNamesForKey = useAltNamesForKey;\n        /**\n         * Stores the list of [[PoiTableEntry]]s.\n         */\n        this.poiList = new Array();\n        /**\n         * Dictionary to look up a [[PoiTableEntry]] quickly. The dictionary is either created from the\n         * property `name` of the [[PoiTableEntry]]s, or all of the names in each property `altNames`.\n         */\n        this.poiDict = new Map();\n        this.m_isLoading = false;\n        this.m_loadedOk = undefined;\n    }\n    /**\n     * Returns `true` if the table is currently being loaded, `false` otherwise.\n     *\n     * @readonly\n     */\n    get isLoading() {\n        return this.m_isLoading;\n    }\n    /**\n     * Returns `true` if the table has been loaded correctly, `false` otherwise.\n     *\n     * @readonly\n     */\n    get loadedOk() {\n        return this.m_loadedOk === true;\n    }\n    /**\n     * Start to load the PoiTable from the specified URL. Can only be called once per table.\n     *\n     * @param {string} poiTableUrl URL that points to the JSON file.\n     *\n     * @returns {Promise<boolean>} Promise is being resolved once the JSON file has been fetched and\n     *          the `PoiTable` has been set up.\n     */\n    load(poiTableUrl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.m_loadedOk !== undefined) {\n                // Only load once.\n                return true;\n            }\n            this.m_loadedOk = false;\n            const response = yield fetch(poiTableUrl);\n            if (!response.ok) {\n                throw new Error(`load: Cannot load POI table at ${poiTableUrl}:` + ` ${response.statusText}`);\n            }\n            const jsonPoiTable = (yield response.json());\n            if (jsonPoiTable === undefined) {\n                logger.info(`load: TextureAtlas empty: ${poiTableUrl}`);\n                return true;\n            }\n            this.startLoading();\n            try {\n                logger.log(`load: Loading POI table '${poiTableUrl}' for table '${this.name}'`);\n                if (jsonPoiTable.poiList !== undefined && Array.isArray(jsonPoiTable.poiList)) {\n                    for (const tableEntry of jsonPoiTable.poiList) {\n                        if (PoiTableEntry.verifyJSON(tableEntry)) {\n                            const newPoiEntry = new PoiTableEntry();\n                            newPoiEntry.setup(tableEntry);\n                            this.poiList.push(newPoiEntry);\n                            if (!this.useAltNamesForKey) {\n                                // Use actual name of entry as the key\n                                if (newPoiEntry.name === undefined) {\n                                    logger.warn(`load: Invalid entry in POI table '${poiTableUrl}' : ` +\n                                        `. No name set in entry: ${tableEntry.iconName}.`);\n                                }\n                                else {\n                                    this.poiDict.set(newPoiEntry.name, newPoiEntry);\n                                }\n                            }\n                            else {\n                                if (newPoiEntry.altNames !== undefined &&\n                                    newPoiEntry.altNames.length > 0) {\n                                    // Use the list of alternative names as keys.\n                                    for (const altName of newPoiEntry.altNames) {\n                                        this.poiDict.set(altName, newPoiEntry);\n                                    }\n                                }\n                                else {\n                                    logger.warn(`load: Invalid entry in POI table '${poiTableUrl}' : ` +\n                                        `No alternative names set in entry: ${tableEntry.iconName}.`);\n                                }\n                            }\n                        }\n                        else {\n                            logger.warn(`load: Invalid entry in POI table '${poiTableUrl}' : ${tableEntry.iconName}`);\n                        }\n                    }\n                }\n                this.m_loadedOk = true;\n                this.finishedLoading();\n            }\n            catch (ex) {\n                logger.error(`load: Failed to load POI table ` + `'${poiTableUrl}' : ${ex}`);\n                this.m_loadedOk = false;\n                this.finishedLoading();\n                return false;\n            }\n            return true;\n        });\n    }\n    startLoading() {\n        this.m_isLoading = true;\n    }\n    finishedLoading() {\n        this.m_isLoading = false;\n    }\n}\nexports.PoiTable = PoiTable;\n/**\n * The `PoiTableManager` manages the list of [[PoiTables]] that can be defined in the [[Theme]]\n * file.\n */\nclass PoiTableManager {\n    /**\n     * Creates an instance of PoiTableManager.\n     * @param {MapView} mapView Owning [[MapView]].\n     */\n    constructor(mapView) {\n        this.mapView = mapView;\n        this.m_isLoading = false;\n        this.m_poiTables = new Map();\n    }\n    /**\n     * Load the [[PoiTable]]s that are stored in the [[MapView]]s [[Theme]]. Note that duplicate\n     * names of [[PoiTable]]s in the [[Theme]] will lead to inaccessible [[PoiTable]]s.\n     *\n     * @param {Theme} theme [[Theme]] containing all [[PoiTable]]s to load.\n     *\n     * @returns {Promise<void>} Resolved once all the [[PoiTable]]s in the [[Theme]] have been\n     *          loaded.\n     */\n    loadPoiTables(theme) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const finished = new Promise(resolve => {\n                this.clear();\n                // Add the POI tables defined in the theme.\n                if (theme.poiTables !== undefined) {\n                    this.startLoading();\n                    // Gather promises to signal the success of having loaded them all\n                    const loadPromises = new Array();\n                    // Ensure that all resources referenced in theme by relative URLs are in fact\n                    // relative to theme.\n                    const themeUrl = theme.url;\n                    const childUrlResolver = themeUrl === undefined\n                        ? undefined\n                        : harp_utils_1.composeUrlResolvers((childUrl) => harp_utils_1.resolveReferenceUrl(themeUrl, childUrl), harp_utils_1.defaultUrlResolver);\n                    theme.poiTables.forEach((poiTableRef) => {\n                        if (poiTableRef !== undefined &&\n                            poiTableRef.name !== undefined &&\n                            typeof poiTableRef.name === \"string\") {\n                            const poiTable = new PoiTable(poiTableRef.name, poiTableRef.useAltNamesForKey !== false);\n                            if (poiTableRef.url !== undefined && typeof poiTableRef.url === \"string\") {\n                                this.addTable(poiTable);\n                                const tableUrl = childUrlResolver === undefined\n                                    ? poiTableRef.url\n                                    : childUrlResolver(poiTableRef.url);\n                                loadPromises.push(poiTable.load(tableUrl));\n                            }\n                            else {\n                                logger.error(`POI table definition has no valid url: ${poiTableRef}`);\n                            }\n                        }\n                        else {\n                            logger.error(`POI table definition has no valid name: ${poiTableRef}`);\n                        }\n                    });\n                    if (loadPromises.length > 0) {\n                        Promise.all(loadPromises).then(() => {\n                            this.finishLoading();\n                            resolve();\n                        });\n                    }\n                    else {\n                        this.finishLoading();\n                        resolve();\n                    }\n                }\n                else {\n                    this.finishLoading();\n                    resolve();\n                }\n            });\n            return finished;\n        });\n    }\n    /**\n     * Clear the list of [[PoiTable]]s.\n     */\n    clear() {\n        this.m_poiTables = new Map();\n    }\n    /**\n     * Return the map of [[PoiTable]]s.\n     */\n    get poiTables() {\n        return this.m_poiTables;\n    }\n    /**\n     * Manually add a [[PoiTable]]. Normally, the [[PoiTables]]s are specified in the [[Theme]].\n     * Ensure that the name is unique.\n     */\n    addTable(poiTable) {\n        this.m_poiTables.set(poiTable.name, poiTable);\n    }\n    /**\n     * Retrieve a [[PoiTable]] by name.\n     *\n     * @param {(string | undefined)} poiTableName Name of the [[PoiTable]].\n     *\n     * @returns {(PoiTable | undefined)} The found [[poiTable]] if it could be found, `undefined`\n     *          otherwise.\n     */\n    getPoiTable(poiTableName) {\n        return poiTableName === undefined ? undefined : this.m_poiTables.get(poiTableName);\n    }\n    /**\n     * Return `true` if the [[PoiTable]]s have finished loading.\n     *\n     * @readonly\n     */\n    get finishedLoading() {\n        return !this.m_isLoading;\n    }\n    startLoading() {\n        this.m_isLoading = true;\n    }\n    finishLoading() {\n        this.m_isLoading = false;\n    }\n}\nexports.PoiTableManager = PoiTableManager;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"@here/harp-fetch\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\n/**\n * Loads and validates a theme from URL objects.\n */\nclass ThemeLoader {\n    /**\n     * Loads a [[Theme]] from a remote resource, provided as a URL that points to a\n     * JSON-encoded theme.\n     *\n     * Relative URLs are resolved to full URL using the document's base URL\n     * (see: https://www.w3.org/TR/WD-html40-970917/htmlweb.html#h-5.1.2).\n     *\n     * @param themeUrl The URL to the theme.\n     */\n    static loadAsync(themeUrl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            themeUrl = harp_utils_1.defaultUrlResolver(themeUrl);\n            const response = yield fetch(themeUrl);\n            if (!response.ok) {\n                throw new Error(`ThemeLoader#loadAsync: cannot load theme: ${response.statusText}`);\n            }\n            const theme = (yield response.json());\n            if (theme === null) {\n                throw new Error(\"ThemeLoader#loadAsync: loaded resource is not valid JSON\");\n            }\n            // Remember the URL where the theme has been loaded from.\n            theme.url = themeUrl;\n            return this.resolveUrls(theme);\n        });\n    }\n    /**\n     * Resolves all [[Theme]]'s relatives URLs to full URL using the [[Theme]]'s URL\n     * (see: https://www.w3.org/TR/WD-html40-970917/htmlweb.html#h-5.1.2).\n     *\n     * @param theme The [[Theme]] to resolve.\n     */\n    static resolveUrls(theme) {\n        // Ensure that all resources referenced in theme by relative URLs are in fact relative to\n        // theme.\n        const childUrlResolver = harp_utils_1.composeUrlResolvers((childUrl) => harp_utils_1.resolveReferenceUrl(theme.url, childUrl), harp_utils_1.defaultUrlResolver);\n        if (theme.images) {\n            for (const name of Object.keys(theme.images)) {\n                const image = theme.images[name];\n                image.url = childUrlResolver(image.url);\n                if (image.atlas !== undefined) {\n                    image.atlas = childUrlResolver(image.atlas);\n                }\n            }\n        }\n        if (theme.fontCatalogs) {\n            for (const font of theme.fontCatalogs) {\n                font.url = childUrlResolver(font.url);\n            }\n        }\n        if (theme.poiTables) {\n            for (const poiTable of theme.poiTables) {\n                poiTable.url = childUrlResolver(poiTable.url);\n            }\n        }\n        if (theme.styles) {\n            for (const styleSetName in theme.styles) {\n                if (!theme.styles.hasOwnProperty(styleSetName)) {\n                    continue;\n                }\n                const styleSet = theme.styles[styleSetName];\n                for (const style of styleSet) {\n                    if (!style.attr) {\n                        continue;\n                    }\n                    [\"map\", \"normalMap\", \"displacementMap\", \"roughnessMap\"].forEach(texturePropertyName => {\n                        const textureProperty = style.attr[texturePropertyName];\n                        if (textureProperty && typeof textureProperty === \"string\") {\n                            style.attr[texturePropertyName] = childUrlResolver(textureProperty);\n                        }\n                    });\n                }\n            }\n        }\n        return theme;\n    }\n}\nexports.ThemeLoader = ThemeLoader;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\nconst harp_lrucache_1 = require(\"@here/harp-lrucache\");\nconst THREE = require(\"three\");\nconst ElevationRangeSource_1 = require(\"./ElevationRangeSource\");\nconst MapTileCuller_1 = require(\"./MapTileCuller\");\nconst Utils_1 = require(\"./Utils\");\n/**\n * Way the memory consumption of a tile is computed. Either in number of tiles, or in MegaBytes. If\n * it is in MB, an estimation is used.\n */\nvar ResourceComputationType;\n(function (ResourceComputationType) {\n    ResourceComputationType[ResourceComputationType[\"EstimationInMb\"] = 0] = \"EstimationInMb\";\n    ResourceComputationType[ResourceComputationType[\"NumberOfTiles\"] = 1] = \"NumberOfTiles\";\n})(ResourceComputationType = exports.ResourceComputationType || (exports.ResourceComputationType = {}));\n/**\n * Represents a unique TileKey and the area it takes up on screen.\n *\n * Note, in certain tiling projections, it is possible to have an offset, which represents a tile\n * which has fully wrapped around, hence this defaults to 0 to simplify usage for projections which\n * don't require it.\n */\nclass TileKeyEntry {\n    constructor(tileKey, area, offset = 0) {\n        this.tileKey = tileKey;\n        this.area = area;\n        this.offset = offset;\n    }\n}\nconst MB_FACTOR = 1.0 / (1024.0 * 1024.0);\n/**\n * Missing Typedoc\n */\nclass DataSourceCache {\n    constructor(options) {\n        this.disposedTiles = [];\n        this.resourceComputationType = ResourceComputationType.EstimationInMb;\n        this.resourceComputationType =\n            options.resourceComputationType === undefined\n                ? ResourceComputationType.EstimationInMb\n                : options.resourceComputationType;\n        this.tileCache = new harp_lrucache_1.LRUCache(options.tileCacheSize, (tile) => {\n            if (this.resourceComputationType === ResourceComputationType.EstimationInMb) {\n                // Default is size in MB.\n                return tile.memoryUsage * MB_FACTOR;\n            }\n            else {\n                return 1;\n            }\n        });\n        this.tileCache.evictionCallback = (_, tile) => {\n            if (tile.tileLoader !== undefined) {\n                // Cancel downloads as early as possible.\n                tile.tileLoader.cancel();\n            }\n            this.disposedTiles.push(tile);\n        };\n        this.tileCache.canEvict = (_, tile) => {\n            // Tiles can be evicted that weren't requested in the last frame.\n            return tile.frameNumLastRequested !== tile.dataSource.mapView.frameNumber;\n        };\n    }\n    disposeTiles() {\n        this.disposedTiles.forEach(tile => {\n            tile.dispose();\n        });\n        this.disposedTiles.length = 0;\n    }\n    get(tileCode) {\n        return this.tileCache.get(tileCode);\n    }\n}\n/**\n * Manages visible [[Tile]]s for [[MapView]].\n *\n * Responsible for election of rendered tiles:\n *  - quad-tree traversal\n *  - frustum culling\n *  - sorting tiles by relevance (visible area) to prioritize load\n *  - limiting number of visible tiles\n *  - caching tiles\n *  - searching cache to replace visible but yet empty tiles with already loaded siblings in nearby\n *    zoom levels\n */\nclass VisibleTileSet {\n    constructor(camera, options) {\n        this.camera = camera;\n        this.dataSourceTileList = [];\n        this.allVisibleTilesLoaded = false;\n        this.m_dataSourceCache = new Map();\n        // used to project global coordinates into camera local coordinates\n        this.m_viewProjectionMatrix = new THREE.Matrix4();\n        this.m_frustum = new THREE.Frustum();\n        this.m_ResourceComputationType = ResourceComputationType.EstimationInMb;\n        this.m_mapTileCuller = new MapTileCuller_1.MapTileCuller(camera);\n        this.options = options;\n    }\n    /**\n     * Returns cache size.\n     */\n    getDataSourceCacheSize() {\n        return this.options.tileCacheSize;\n    }\n    /**\n     * Sets cache size.\n     *\n     * @param size cache size\n     * @param computationType Optional value specifying the way a [[Tile]]s cache usage is computed,\n     *      either based on size in MB (mega bytes) or in number of tiles. Defaults to\n     *      `ResourceComputationType.EstimationInMb`.\n     */\n    setDataSourceCacheSize(size, computationType = ResourceComputationType.EstimationInMb) {\n        this.options.tileCacheSize = size;\n        this.resourceComputationType = computationType;\n    }\n    /**\n     * Retrieves maximum number of visible tiles.\n     */\n    getNumberOfVisibleTiles() {\n        return this.options.maxVisibleDataSourceTiles;\n    }\n    /**\n     * Sets maximum number of visible tiles.\n     *\n     * @param size size of visible tiles array\n     */\n    setNumberOfVisibleTiles(size) {\n        this.options.maxVisibleDataSourceTiles = size;\n    }\n    /**\n     * The way the cache usage is computed, either based on size in MB (mega bytes) or in number of\n     * tiles.\n     */\n    get resourceComputationType() {\n        return this.m_ResourceComputationType;\n    }\n    set resourceComputationType(computationType) {\n        this.m_ResourceComputationType = computationType;\n        this.m_dataSourceCache.forEach(dataStore => {\n            dataStore.tileCache.setCapacity(this.options.tileCacheSize);\n            dataStore.resourceComputationType = computationType;\n            dataStore.tileCache.shrinkToCapacity();\n        });\n    }\n    updateRenderList(worldCenter, storageLevel, zoomLevel, dataSources) {\n        this.m_viewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse);\n        this.m_frustum.setFromMatrix(this.m_viewProjectionMatrix);\n        const newRenderList = [];\n        let allVisibleTilesLoaded = true;\n        if (this.options.extendedFrustumCulling) {\n            this.m_mapTileCuller.setup();\n        }\n        let elevationRangeSource;\n        for (const dataSource of dataSources) {\n            elevationRangeSource = dataSource.getElevationRangeSource();\n            if (elevationRangeSource !== undefined) {\n                // We don't support multiple elevation range sources, but just take the first one\n                // that we find in the enabled data sources.\n                break;\n            }\n        }\n        const visibleTileResult = this.getVisibleTilesForDataSources(worldCenter, zoomLevel, dataSources, elevationRangeSource);\n        for (const { dataSource, visibleTiles } of visibleTileResult.tiles) {\n            // Sort by projected (visible) area, now the tiles that are further away are at the end\n            // of the list.\n            //\n            // Sort is unstable if distance is equal, which happens a lot when looking top-down.\n            // Unstable sorting makes label placement unstable at tile borders, leading to\n            // flickering.\n            visibleTiles.sort((a, b) => {\n                const areaDiff = b.area - a.area;\n                // Take care or numerical precision issues\n                const minDiff = (a.area + b.area) * 0.001;\n                return Math.abs(areaDiff) < minDiff\n                    ? b.tileKey.mortonCode() - a.tileKey.mortonCode()\n                    : areaDiff;\n            });\n            const actuallyVisibleTiles = [];\n            let allDataSourceTilesLoaded = true;\n            let numTilesLoading = 0;\n            // Create actual tiles only for the allowed number of visible tiles\n            const displayZoomLevel = dataSource.getDisplayZoomLevel(zoomLevel);\n            for (let i = 0; i < visibleTiles.length &&\n                actuallyVisibleTiles.length < this.options.maxVisibleDataSourceTiles; i++) {\n                const tileEntry = visibleTiles[i];\n                if (!dataSource.shouldRender(displayZoomLevel, tileEntry.tileKey)) {\n                    continue;\n                }\n                const tile = this.getTile(dataSource, tileEntry.tileKey, tileEntry.offset);\n                if (tile === undefined) {\n                    continue;\n                }\n                tile.prepareForRender();\n                allDataSourceTilesLoaded = allDataSourceTilesLoaded && tile.hasGeometry;\n                if (!tile.hasGeometry) {\n                    numTilesLoading++;\n                }\n                else {\n                    tile.numFramesVisible++;\n                    if (tile.frameNumVisible < 0) {\n                        // Store the fist frame the tile became visible.\n                        tile.frameNumVisible = dataSource.mapView.frameNumber;\n                    }\n                }\n                actuallyVisibleTiles.push(tile);\n                // Update the visible area of the tile. This is used for those tiles that are\n                // currently loaded and are waiting to be decoded to sort the jobs by area.\n                tile.visibleArea = tileEntry.area;\n            }\n            newRenderList.push({\n                dataSource,\n                storageLevel,\n                zoomLevel: displayZoomLevel,\n                allVisibleTileLoaded: allDataSourceTilesLoaded,\n                numTilesLoading,\n                visibleTiles: actuallyVisibleTiles,\n                renderedTiles: actuallyVisibleTiles\n            });\n            allVisibleTilesLoaded = allVisibleTilesLoaded && allDataSourceTilesLoaded;\n        }\n        this.dataSourceTileList = newRenderList;\n        this.allVisibleTilesLoaded =\n            allVisibleTilesLoaded && visibleTileResult.allBoundingBoxesFinal;\n        this.fillMissingTilesFromCache();\n        this.forEachCachedTile(tile => {\n            // Remove all tiles that are still being loaded, but are no longer visible. They have to\n            // be reloaded when they become visible again. Hopefully, they are still in the browser\n            // cache by then.\n            if (!tile.isVisible && tile.tileLoader !== undefined && !tile.tileLoader.isFinished) {\n                // The internal TileLoader is cancelled automatically when the Tile is disposed.\n                this.disposeTile(tile);\n            }\n        });\n        this.dataSourceTileList.forEach(renderListEntry => {\n            const dataSource = renderListEntry.dataSource;\n            const cache = this.m_dataSourceCache.get(dataSource.name);\n            if (cache !== undefined) {\n                cache.tileCache.shrinkToCapacity();\n            }\n        });\n        return newRenderList;\n    }\n    getTile(dataSource, tileKey, offset = 0) {\n        function updateTile(tileToUpdate) {\n            if (tileToUpdate === undefined) {\n                return;\n            }\n            // Keep the tile from being removed from the cache.\n            tileToUpdate.frameNumLastRequested = dataSource.mapView.frameNumber;\n        }\n        if (!dataSource.cacheable) {\n            const resultTile = dataSource.getTile(tileKey);\n            updateTile(resultTile);\n            return resultTile;\n        }\n        const { tileCache } = this.getOrCreateCache(dataSource);\n        const tileKeyMortonCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tileKey, offset);\n        let tile = tileCache.get(tileKeyMortonCode);\n        if (tile !== undefined && tile.offset === offset) {\n            updateTile(tile);\n            return tile;\n        }\n        tile = dataSource.getTile(tileKey);\n        if (tile !== undefined) {\n            tile.offset = offset;\n            updateTile(tile);\n            tileCache.set(tileKeyMortonCode, tile);\n        }\n        return tile;\n    }\n    /**\n     * Removes all internal bookkeeping entries and cache related to specified datasource.\n     *\n     * Called by [[MapView]] when [[DataSource]] has been removed from [[MapView]].\n     */\n    removeDataSource(dataSourceName) {\n        this.clearTileCache(dataSourceName);\n        this.dataSourceTileList = this.dataSourceTileList.filter(tileList => tileList.dataSource.name !== dataSourceName);\n        this.m_dataSourceCache.delete(dataSourceName);\n    }\n    /**\n     * Clear the tile cache.\n     *\n     * Remove the [[Tile]] objects created by cacheable [[DataSource]]. If a [[DataSource]] name is\n     * provided, this method restricts the eviction the [[DataSource]] with the given name.\n     *\n     * @param dataSourceName The name of the [[DataSource]].\n     */\n    clearTileCache(dataSourceName) {\n        if (dataSourceName !== undefined) {\n            const cache = this.m_dataSourceCache.get(dataSourceName);\n            if (cache) {\n                cache.tileCache.evictAll();\n            }\n        }\n        else {\n            this.m_dataSourceCache.forEach(dataSourceCache => {\n                dataSourceCache.tileCache.evictAll();\n            });\n        }\n    }\n    /**\n     * Visit each tile in visible, rendered, and cached sets.\n     *\n     *  * Visible and temporarily rendered tiles will be marked for update and retained.\n     *  * Cached but not rendered/visible will be evicted.\n     *\n     * @param dataSource If passed, only the tiles from this [[DataSource]] instance are processed.\n     *     If `undefined`, tiles from all [[DataSource]]s are processed.\n     */\n    markTilesDirty(dataSource) {\n        if (dataSource === undefined) {\n            this.dataSourceTileList.forEach(renderListEntry => {\n                this.markDataSourceTilesDirty(renderListEntry);\n            });\n        }\n        else {\n            const renderListEntry = this.dataSourceTileList.find(e => e.dataSource === dataSource);\n            if (renderListEntry === undefined) {\n                return;\n            }\n            this.markDataSourceTilesDirty(renderListEntry);\n        }\n    }\n    /**\n     * Dispose tiles that are marked for removal by [[LRUCache]] algorithm.\n     */\n    disposePendingTiles() {\n        this.m_dataSourceCache.forEach(cache => {\n            cache.disposeTiles();\n        });\n    }\n    forEachVisibleTile(fun) {\n        for (const listEntry of this.dataSourceTileList) {\n            listEntry.renderedTiles.forEach(fun);\n        }\n    }\n    forEachCachedTile(fun) {\n        this.m_dataSourceCache.forEach(dataSourceCache => {\n            dataSourceCache.tileCache.forEach(tile => {\n                fun(tile);\n            });\n        });\n    }\n    /**\n     * Dispose a `Tile` from cache, 'dispose()' is also called on the tile to free its resources.\n     */\n    disposeTile(tile) {\n        const cache = this.m_dataSourceCache.get(tile.dataSource.name);\n        if (cache) {\n            const tileCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tile.tileKey, tile.offset);\n            cache.tileCache.delete(tileCode);\n            tile.dispose();\n        }\n    }\n    /**\n     * Returns the target [[Projection]].\n     */\n    get projection() {\n        return this.options.projection;\n    }\n    /**\n     * Returns the type of the target [[Projection]].\n     */\n    get projectionType() {\n        return this.projection.type;\n    }\n    /**\n     * Returns true if the tile wrapping is enabled.\n     *\n     * The default implementation returns true for planar projections.\n     */\n    get tileWrappingEnabled() {\n        return this.projectionType === harp_geoutils_1.ProjectionType.Planar;\n    }\n    getGeoBox(tilingScheme, childTileKey, offset) {\n        const geoBox = tilingScheme.getGeoBox(childTileKey);\n        const longitudeOffset = 360.0 * offset;\n        geoBox.northEast.longitude += longitudeOffset;\n        geoBox.southWest.longitude += longitudeOffset;\n        return geoBox;\n    }\n    /**\n     * Creates the intersection cache and initializes values for the root nodes.\n     *\n     * @param workList The list of work items with which to initialize the cache.\n     */\n    createIntersectionCache(workList) {\n        const map = new Map();\n        for (const item of workList) {\n            map.set(Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(item.tileKey, item.offset), Infinity);\n        }\n        return map;\n    }\n    /**\n     * Create a list of root nodes to test against the frustum. The root nodes each start at level 0\n     * and have an offset (see [[Tile]]) based on:\n     * - the current position [[worldCenter]].\n     * - the height of the camera above the world.\n     * - the field of view of the camera (the maximum value between the horizontal / vertical\n     *   values)\n     * - the tilt of the camera (because we see more tiles when tilted).\n     *\n     * @param worldCenter The center of the camera in world space.\n     */\n    getRequiredInitialRootTileKeys(worldCenter) {\n        const rootTileKey = harp_geoutils_1.TileKey.fromRowColumnLevel(0, 0, 0);\n        if (!this.tileWrappingEnabled) {\n            return [new TileKeyEntry(rootTileKey, 0)];\n        }\n        const worldGeoPoint = this.options.projection.unprojectPoint(worldCenter);\n        const result = [];\n        const startOffset = Math.round(worldGeoPoint.longitude / 360.0);\n        // This algorithm computes the number of offsets we need to test. The following diagram may\n        // help explain the algorithm below.\n        //\n        //   |\n        //   |.\\ .\n        //   | . \\  .\n        // z |  .  \\   .c2\n        //   |  c1.  \\b    .\n        //   |     .   \\      .\n        //___|a___d1.____\\e______.d2______f\n        //\n        // Where:\n        // -  is the camera\n        // - z is the height of the camera above the ground.\n        // - a is a right angle.\n        // - b is the look at vector of the camera.\n        // - c1 and c2 are the frustum planes of the camera.\n        // - c1 to c2 is the fov.\n        // - d1 and d2 are the intersection points of the frustum with the world plane.\n        // - e is the tilt/pitch of the camera.\n        // - f is the world\n        //\n        // The goal is to find the distance from e->d2. This is a longitude value, and we convert it\n        // to some offset range. Note e->d2 >= e->d1 (because we can't have a negative tilt).\n        // To find e->d2, we use the right triangle , a, d2 and subtract the distance a->d2 with\n        // a->e.\n        // a->d2 is found using the angle between a and d2 from the , this is simply e (because of\n        // similar triangles, angle between a,  and e equals the tilt) + half of the fov (because\n        // we need the angle between e,  and d2) and using trigonometry, result is therefore:\n        // (tan(a->d2) * z).\n        // a->e needs just the tilt and trigonometry to compute, result is: (tan(a->e) * z).\n        const cameraPitch = Utils_1.MapViewUtils.extractYawPitchRoll(this.camera.quaternion).pitch;\n        // Ensure that the aspect is >= 1.\n        const aspect = this.camera.aspect > 1 ? this.camera.aspect : 1 / this.camera.aspect;\n        // Angle between a->d2, note, the fov is vertical, hence we translate to horizontal.\n        const totalAngleRad = harp_geoutils_1.MathUtils.degToRad((this.camera.fov * aspect) / 2) + cameraPitch;\n        // Length a->d2\n        const worldLengthHorizontalFull = Math.tan(totalAngleRad) * this.camera.position.z;\n        // Length a->e\n        const worldLengthHorizontalSmallerHalf = Math.tan(cameraPitch) * this.camera.position.z;\n        // Length e -> d2\n        const worldLengthHorizontal = worldLengthHorizontalFull - worldLengthHorizontalSmallerHalf;\n        const worldLeftPoint = new THREE.Vector3(worldCenter.x - worldLengthHorizontal, worldCenter.y, worldCenter.z);\n        const worldLeftGeoPoint = this.options.projection.unprojectPoint(worldLeftPoint);\n        // We multiply by SQRT2 because we need to account for a rotated view (in which case there\n        // are more tiles that can be seen).\n        const offsetRange = harp_geoutils_1.MathUtils.clamp(Math.ceil(Math.abs((worldGeoPoint.longitude - worldLeftGeoPoint.longitude) / 360) * Math.SQRT2), 0, \n        // We can store currently up to 16 unique keys(2^4, where 4 is the default bitshift\n        // value which is used currently in the [[VisibleTileSet]] methods) hence we can have a\n        // maximum range of 7 (because 2*7+1 = 15).\n        7);\n        for (let offset = -offsetRange + startOffset; offset <= offsetRange + startOffset; offset++) {\n            result.push(new TileKeyEntry(rootTileKey, 0, offset));\n        }\n        return result;\n    }\n    /**\n     * Search cache to replace visible but yet empty tiles with already loaded siblings in nearby\n     * zoom levels.\n     *\n     * Useful, when zooming in/out and when \"newly elected\" tiles are not yet loaded. Prevents\n     * flickering by rendering already loaded tiles from upper/higher zoom levels.\n     */\n    fillMissingTilesFromCache() {\n        this.dataSourceTileList.forEach(renderListEntry => {\n            const dataSource = renderListEntry.dataSource;\n            const tilingScheme = dataSource.getTilingScheme();\n            const displayZoomLevel = renderListEntry.zoomLevel;\n            const renderedTiles = new Map();\n            const checkedTiles = new Set();\n            // Direction in quad tree to search: up -> shallower levels, down -> deeper levels.\n            let SearchDirection;\n            (function (SearchDirection) {\n                SearchDirection[SearchDirection[\"UP\"] = 0] = \"UP\";\n                SearchDirection[SearchDirection[\"DOWN\"] = 1] = \"DOWN\";\n                SearchDirection[SearchDirection[\"BOTH\"] = 2] = \"BOTH\";\n            })(SearchDirection || (SearchDirection = {}));\n            const tileCache = this.m_dataSourceCache.get(dataSource.name);\n            if (tileCache === undefined) {\n                return;\n            }\n            const cacheSearchUp = this.options.quadTreeSearchDistanceUp > 0 &&\n                displayZoomLevel > dataSource.minZoomLevel;\n            const cacheSearchDown = this.options.quadTreeSearchDistanceDown > 0 &&\n                displayZoomLevel < dataSource.maxZoomLevel;\n            if (!cacheSearchDown && !cacheSearchUp) {\n                return;\n            }\n            const defaultSearchDirection = cacheSearchDown && cacheSearchUp\n                ? SearchDirection.BOTH\n                : cacheSearchDown\n                    ? SearchDirection.DOWN\n                    : SearchDirection.UP;\n            let incompleteTiles = new Map();\n            renderListEntry.visibleTiles.forEach(tile => {\n                const tileCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tile.tileKey, tile.offset);\n                if (tile.hasGeometry) {\n                    renderedTiles.set(tileCode, tile);\n                }\n                else {\n                    // if dataSource supports cache and it was existing before this render\n                    // then enable searching for loaded tiles in cache\n                    incompleteTiles.set(tileCode, defaultSearchDirection);\n                }\n            });\n            if (incompleteTiles.size === 0) {\n                // short circuit, nothing to be done\n                return;\n            }\n            // iterate over incomplete (not loaded tiles)\n            // and find their parents or children that are in cache that can be rendered temporarily\n            // until tile is loaded\n            while (incompleteTiles.size !== 0) {\n                const nextLevelCandidates = new Map();\n                incompleteTiles.forEach((searchDirection, tileKeyCode) => {\n                    if (searchDirection === SearchDirection.BOTH ||\n                        searchDirection === SearchDirection.UP) {\n                        const parentCode = Utils_1.TileOffsetUtils.getParentKeyFromKey(tileKeyCode);\n                        if (!checkedTiles.has(parentCode) && !renderedTiles.get(parentCode)) {\n                            checkedTiles.add(parentCode);\n                            const parentTile = tileCache.get(parentCode);\n                            if (parentTile !== undefined && parentTile.hasGeometry) {\n                                // parentTile has geometry, so can be reused as fallback\n                                renderedTiles.set(parentCode, parentTile);\n                                return;\n                            }\n                            const { mortonCode } = Utils_1.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(parentCode);\n                            const parentTileKey = parentTile\n                                ? parentTile.tileKey\n                                : harp_geoutils_1.TileKey.fromMortonCode(mortonCode);\n                            // if parentTile is missing or incomplete, try at max 3 levels up from\n                            // current display level\n                            const nextLevelDiff = Math.abs(displayZoomLevel - parentTileKey.level);\n                            if (nextLevelDiff < this.options.quadTreeSearchDistanceUp) {\n                                nextLevelCandidates.set(parentCode, SearchDirection.UP);\n                            }\n                        }\n                    }\n                    if (searchDirection === SearchDirection.BOTH ||\n                        searchDirection === SearchDirection.DOWN) {\n                        const { offset, mortonCode } = Utils_1.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(tileKeyCode);\n                        const tileKey = harp_geoutils_1.TileKey.fromMortonCode(mortonCode);\n                        tilingScheme.getSubTileKeys(tileKey).forEach(childTileKey => {\n                            const childTileCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(childTileKey, offset);\n                            checkedTiles.add(childTileCode);\n                            const childTile = tileCache.get(childTileCode);\n                            if (childTile !== undefined && childTile.hasGeometry) {\n                                // childTile has geometry, so can be reused as fallback\n                                renderedTiles.set(childTileCode, childTile);\n                                return;\n                            }\n                            const nextLevelDiff = Math.abs(childTileKey.level - displayZoomLevel);\n                            if (nextLevelDiff < this.options.quadTreeSearchDistanceDown) {\n                                nextLevelCandidates.set(childTileCode, SearchDirection.DOWN);\n                            }\n                        });\n                    }\n                });\n                incompleteTiles = nextLevelCandidates;\n            }\n            renderListEntry.renderedTiles = Array.from(renderedTiles.values());\n        });\n    }\n    getOrCreateCache(dataSource) {\n        const dataSourceName = dataSource.name;\n        let dataSourceCache = this.m_dataSourceCache.get(dataSourceName);\n        if (dataSourceCache === undefined) {\n            dataSourceCache = new DataSourceCache(this.options);\n            this.m_dataSourceCache.set(dataSourceName, dataSourceCache);\n        }\n        return dataSourceCache;\n    }\n    markDataSourceTilesDirty(renderListEntry) {\n        const dataSourceCache = this.m_dataSourceCache.get(renderListEntry.dataSource.name);\n        const retainedTiles = new Set();\n        renderListEntry.visibleTiles.forEach(tile => {\n            const tileCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tile.tileKey, tile.offset);\n            retainedTiles.add(tileCode);\n            tile.reload();\n        });\n        renderListEntry.renderedTiles.forEach(tile => {\n            const tileCode = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tile.tileKey, tile.offset);\n            if (!retainedTiles.has(tileCode)) {\n                retainedTiles.add(tileCode);\n                tile.reload();\n            }\n        });\n        if (dataSourceCache !== undefined) {\n            dataSourceCache.tileCache.forEach((tile, tileCode) => {\n                if (!retainedTiles.has(tileCode)) {\n                    tile.dispose();\n                    dataSourceCache.tileCache.delete(tileCode);\n                }\n            });\n        }\n    }\n    // Computes the visible tiles for each supplied datasource.\n    getVisibleTilesForDataSources(worldCenter, zoomLevel, dataSources, elevationRangeSource) {\n        const tiles = [];\n        let allBoundingBoxesFinal = true;\n        for (const dataSource of dataSources) {\n            const displayZoomLevel = dataSource.getDisplayZoomLevel(zoomLevel);\n            const tilingScheme = dataSource.getTilingScheme();\n            const useElevationRangeSource = elevationRangeSource !== undefined &&\n                elevationRangeSource.getTilingScheme() === tilingScheme;\n            const tileBounds = new THREE.Box3();\n            const workList = this.getRequiredInitialRootTileKeys(worldCenter);\n            const visibleTiles = [];\n            const tileFrustumIntersectionCache = this.createIntersectionCache(workList);\n            while (workList.length > 0) {\n                const tileEntry = workList.pop();\n                if (tileEntry === undefined) {\n                    continue;\n                }\n                const tileKey = tileEntry.tileKey;\n                const uniqueKey = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(tileKey, tileEntry.offset);\n                const area = tileFrustumIntersectionCache.get(uniqueKey);\n                if (area === undefined) {\n                    throw new Error(\"Unexpected tile key\");\n                }\n                if (area <= 0 || tileKey.level > displayZoomLevel) {\n                    continue;\n                }\n                if (dataSource.shouldRender(displayZoomLevel, tileKey)) {\n                    visibleTiles.push(tileEntry);\n                }\n                tilingScheme.getSubTileKeys(tileKey).forEach(childTileKey => {\n                    const offset = tileEntry.offset;\n                    const tileKeyAndOffset = Utils_1.TileOffsetUtils.getKeyForTileKeyAndOffset(childTileKey, offset);\n                    const intersectsFrustum = tileFrustumIntersectionCache.get(tileKeyAndOffset);\n                    if (intersectsFrustum === undefined) {\n                        const geoBox = this.getGeoBox(tilingScheme, childTileKey, offset);\n                        if (useElevationRangeSource) {\n                            const range = elevationRangeSource.getElevationRange(childTileKey);\n                            geoBox.southWest.altitude = range.minElevation;\n                            geoBox.northEast.altitude = range.maxElevation;\n                            allBoundingBoxesFinal =\n                                allBoundingBoxesFinal &&\n                                    range.calculationStatus === ElevationRangeSource_1.CalculationStatus.FinalPrecise;\n                        }\n                        this.options.projection.projectBox(geoBox, tileBounds);\n                        tileBounds.min.sub(worldCenter);\n                        tileBounds.max.sub(worldCenter);\n                        const subTileArea = this.computeSubTileArea(tileBounds);\n                        tileFrustumIntersectionCache.set(tileKeyAndOffset, subTileArea);\n                        if (subTileArea > 0) {\n                            workList.push(new TileKeyEntry(childTileKey, subTileArea, offset));\n                        }\n                    }\n                });\n            }\n            tiles.push({ dataSource, visibleTiles });\n        }\n        return { tiles, allBoundingBoxesFinal };\n    }\n    // Computes the rough screen area of the supplied box.\n    // TileBounds must be in world space.\n    computeSubTileArea(tileBounds) {\n        if ((!this.options.extendedFrustumCulling ||\n            this.m_mapTileCuller.frustumIntersectsTileBox(tileBounds)) &&\n            this.m_frustum.intersectsBox(tileBounds)) {\n            const contour = [\n                new THREE.Vector3(tileBounds.min.x, tileBounds.min.y, 0).applyMatrix4(this.m_viewProjectionMatrix),\n                new THREE.Vector3(tileBounds.max.x, tileBounds.min.y, 0).applyMatrix4(this.m_viewProjectionMatrix),\n                new THREE.Vector3(tileBounds.max.x, tileBounds.max.y, 0).applyMatrix4(this.m_viewProjectionMatrix),\n                new THREE.Vector3(tileBounds.min.x, tileBounds.max.y, 0).applyMatrix4(this.m_viewProjectionMatrix)\n            ];\n            contour.push(contour[0]);\n            const n = contour.length;\n            let subTileArea = 0;\n            for (let p = n - 1, q = 0; q < n; p = q++) {\n                subTileArea += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\n            }\n            return Math.abs(subTileArea * 0.5);\n        }\n        return 0;\n    }\n}\nexports.VisibleTileSet = VisibleTileSet;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Status of the elevation range calculation.\n */\nvar CalculationStatus;\n(function (CalculationStatus) {\n    // Calculated approximately. A more precise result may be available later.\n    CalculationStatus[CalculationStatus[\"PendingApproximate\"] = 0] = \"PendingApproximate\";\n    // Calculation completed. The result is final, won't improve upon retrying.\n    CalculationStatus[CalculationStatus[\"FinalPrecise\"] = 1] = \"FinalPrecise\";\n})(CalculationStatus = exports.CalculationStatus || (exports.CalculationStatus = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\n/**\n * Identifier of next tiler worker-service. Used to ensure uniqueness of service ids of tilers\n * dedicated to different datasources.\n */\nlet nextUniqueServiceId = 0;\n/**\n * Tiler based on [[ConcurrentWorkerSet]].\n *\n * Tiles payloads using workers running in separate contexts (also known as `WebWorkers`):\n * - connection establishment,\n * - sends tile requests,\n * - configuration.\n */\nclass WorkerBasedTiler {\n    /**\n     * Creates a new `WorkerBasedTiler`.\n     *\n     * @param workerSet [[ConcurrentWorkerSet]] this tiler will live in.\n     * @param tilerServiceType Service type identifier.\n     */\n    constructor(workerSet, tilerServiceType) {\n        this.workerSet = workerSet;\n        this.tilerServiceType = tilerServiceType;\n        this.m_serviceCreated = false;\n        this.workerSet.addReference();\n        this.serviceId = `${this.tilerServiceType}-${nextUniqueServiceId++}`;\n    }\n    /**\n     * Dispose of dedicated tiler services in workers and remove reference to underlying\n     * [[ConcurrentWorkerSet]].\n     */\n    dispose() {\n        if (this.m_serviceCreated) {\n            this.workerSet.broadcastRequest(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID, {\n                type: harp_datasource_protocol_1.WorkerServiceProtocol.Requests.DestroyService,\n                targetServiceId: this.serviceId\n            });\n        }\n        this.workerSet.removeReference();\n    }\n    /**\n     * Connects to [[WorkerServiceManager]]s in underlying [[ConcurrentWorkerSet]] and creates\n     * dedicated [[TilerService]]s in all workers to serve tiling requests.\n     */\n    connect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.workerSet.connect(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID);\n            if (!this.m_serviceCreated) {\n                yield this.workerSet.broadcastRequest(harp_datasource_protocol_1.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID, {\n                    type: harp_datasource_protocol_1.WorkerServiceProtocol.Requests.CreateService,\n                    targetServiceType: this.tilerServiceType,\n                    targetServiceId: this.serviceId\n                });\n                this.m_serviceCreated = true;\n            }\n        });\n    }\n    /**\n     * Register index in the tiler. Indexes registered in the tiler can be later used to retrieved\n     * tiled payloads using `getTile`.\n     *\n     * @param indexId Index identifier.\n     * @param input Url to the index payload, or direct GeoJSON.\n     */\n    registerIndex(indexId, input) {\n        const message = {\n            type: harp_datasource_protocol_1.WorkerTilerProtocol.Requests.RegisterIndex,\n            id: indexId,\n            input: input instanceof URL ? input.href : input\n        };\n        return this.workerSet.invokeRequest(this.serviceId, message);\n    }\n    /**\n     * Retrieves a tile for a previously registered index.\n     *\n     * @param indexId Index identifier.\n     * @param tileKey The [[TileKey]] that identifies the tile.\n     */\n    getTile(indexId, tileKey) {\n        const tileKeyCode = tileKey.mortonCode();\n        const message = {\n            type: harp_datasource_protocol_1.WorkerTilerProtocol.Requests.TileRequest,\n            index: indexId,\n            tileKey: tileKeyCode\n        };\n        return this.workerSet.invokeRequest(this.serviceId, message);\n    }\n}\nexports.WorkerBasedTiler = WorkerBasedTiler;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_lines_1 = require(\"@here/harp-lines\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"TileGeometry\");\n/**\n * Helper function to check if an accessor is of type `ILineAccessor`.\n *\n * @param arg `true` if `arg` is `ILineAccessor`.\n */\nfunction isLineAccessor(arg) {\n    /**\n     * Get vertices from the object.\n     *\n     * @param mode Specifies which part of the vertices should be returned.\n     */\n    return typeof arg.isLineAccessor === \"function\" && arg.isLineAccessor() === true;\n}\nexports.isLineAccessor = isLineAccessor;\n/**\n * Helper function to check if an accessor is of type `IObject3dAccessor`.\n *\n * @param arg `true` if `arg` is `IObject3dAccessor`.\n */\nfunction isObject3dAccessor(arg) {\n    return typeof arg.isObject3dAccessor === \"function\" && arg.isObject3dAccessor() === true;\n}\nexports.isObject3dAccessor = isObject3dAccessor;\n/**\n * Geometry accessor for both indexed and nonindexed `BufferedGeometry`.\n */\nclass BufferedGeometryAccessorBase {\n    constructor(object, geometryType, bufferGeometry) {\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n        this.start = -1;\n        this.end = -1;\n        this.startCapSize = 0;\n        this.endCapSize = 0;\n        harp_utils_1.assert(!!object);\n        if (bufferGeometry.type !== \"BufferGeometry\") {\n            logger.error(\"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong \" + \"type\");\n        }\n        harp_utils_1.assert(bufferGeometry.type === \"BufferGeometry\", \"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type\");\n        // we know its a BufferAttribute because it is a BufferGeometry\n        this.position = this.bufferGeometry.getAttribute(\"position\");\n        this.itemSize = this.position.itemSize;\n        if (!this.position) {\n            logger.warn(\"BufferedGeometryAccessor#constructor: BufferGeometry has no position \" +\n                \"attribute\");\n        }\n        if (this.position.array.constructor !== Float32Array) {\n            logger.warn(\"BufferedGeometryAccessor#constructor: BufferGeometry.position: \" +\n                \"unsupported ArrayBuffer\");\n        }\n    }\n    /**\n     * Get the number of accessible geometries in this buffer.\n     *\n     * @returns Number of primitives in this geometry.\n     */\n    getCount() {\n        return this.position.count;\n    }\n    /**\n     * Get `renderOrder` of object.\n     *\n     * @returns `renderOrder` of the object.\n     */\n    get renderOrder() {\n        return this.object.renderOrder;\n    }\n    setRange(start, end, startCapSize = 0, endCapSize = 0) {\n        harp_utils_1.assert(start >= 0);\n        harp_utils_1.assert(end >= 0);\n        harp_utils_1.assert(start <= end);\n        this.start = start;\n        this.end = end;\n        this.startCapSize = startCapSize;\n        this.endCapSize = endCapSize;\n    }\n    /**\n     * Get one or more colors from materials.\n     */\n    get color() {\n        /**\n         * TODO: Get color(s) from vertex colors\n         */\n        const getColor = (material) => {\n            const meshMaterial = material;\n            if (meshMaterial.type === \"MeshBasicMaterial\" ||\n                meshMaterial.type === \"MeshStandardMaterial\") {\n                return meshMaterial.color;\n            }\n            else if (meshMaterial.type === \"RawShaderMaterial\") {\n                const rawShaderMaterial = material;\n                if (rawShaderMaterial.name === \"SolidLineMaterial\") {\n                    return rawShaderMaterial.uniforms.diffuse.value;\n                }\n                logger.warn(\"BufferedGeometryAccessor#color: unknown shader material name\", rawShaderMaterial.name);\n            }\n            else {\n                logger.warn(\"BufferedGeometryAccessor#color: unknown material type\", meshMaterial.type);\n            }\n            return undefined;\n        };\n        if (Array.isArray(this.object.material)) {\n            const results = new Array();\n            const materials = this.object.material;\n            for (const material of materials) {\n                results.push(getColor(material));\n            }\n            return results;\n        }\n        else {\n            return getColor(this.object.material);\n        }\n    }\n}\nexports.BufferedGeometryAccessorBase = BufferedGeometryAccessorBase;\n/**\n * Abstract base class of an accessor for nonindexed geometry.\n */\nclass BufferedGeometryAccessor extends BufferedGeometryAccessorBase {\n    /**\n     * Create an object of type `BufferedGeometryAccessor`\n     *\n     * @param object - mesh object\n     * @param geometryType - type of geometry to be used\n     * @param bufferGeometry - which buffer geometry to use\n     * @param stride - geometry stride length\n     */\n    constructor(object, geometryType, bufferGeometry, stride) {\n        super(object, geometryType, bufferGeometry);\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n        this.stride = stride;\n    }\n    clear() {\n        harp_utils_1.assert(this.checkSetUp(), \"BufferedGeometryAccessor not setup\");\n        const positionsArray = this.position.array;\n        const start = this.start * this.itemSize;\n        const end = this.end * this.itemSize;\n        for (let i = start; i < end; i++) {\n            positionsArray[i] = 0;\n        }\n        this.position.needsUpdate = true;\n    }\n    getVertices() {\n        harp_utils_1.assert(this.checkSetUp(), \"BufferedGeometryAccessor not setup\");\n        const start = this.start;\n        const end = this.end;\n        return this.position.array.subarray(start * this.itemSize, end * this.itemSize);\n    }\n    checkSetUp() {\n        return (this.position !== undefined &&\n            this.start !== undefined &&\n            this.end !== undefined &&\n            this.start >= 0 &&\n            this.end <= this.position.count &&\n            this.start <= this.end);\n    }\n}\nexports.BufferedGeometryAccessor = BufferedGeometryAccessor;\n/**\n * Accessor for nonindexed line geometry.\n */\nclass BufferedGeometryLineAccessor extends BufferedGeometryAccessor {\n    constructor(object, geometryType, bufferGeometry) {\n        super(object, geometryType, bufferGeometry, 3);\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n    }\n    isLineAccessor() {\n        return true;\n    }\n    get width() {\n        //TODO: There is no implementation of such a line, yet...\n        harp_utils_1.assert(this.checkSetUp(), \"RoBufferedGeometryLineAccessor not setup\");\n        return undefined;\n    }\n}\nexports.BufferedGeometryLineAccessor = BufferedGeometryLineAccessor;\n/**\n * Accessor for nonindexed unspecified (`Object3D`) geometry.\n */\nclass BufferedGeometryObject3dAccessor extends BufferedGeometryAccessor {\n    constructor(object, geometryType, bufferGeometry) {\n        super(object, geometryType, bufferGeometry, 1);\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n    }\n    isObject3dAccessor() {\n        return true;\n    }\n    getVertices() {\n        return super.getVertices();\n    }\n}\nexports.BufferedGeometryObject3dAccessor = BufferedGeometryObject3dAccessor;\n/**\n * Abstract base class of indexed geometry.\n */\nclass IndexedBufferedGeometryAccessor extends BufferedGeometryAccessorBase {\n    /**\n     * Creates an abstract class `IndexedBufferedGeometryAccessor`.\n     *\n     * @param object - mesh to be used\n     * @param geometryType - type of geometry\n     * @param bufferGeometry - geometry used\n     * @param start\n     * @param end\n     */\n    constructor(object, geometryType, bufferGeometry, \n    // tslint:disable-next-line:no-unused-variable\n    start, \n    // tslint:disable-next-line:no-unused-variable\n    end) {\n        super(object, geometryType, bufferGeometry);\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n        this.indices = this.bufferGeometry.index.array;\n        if (!this.indices) {\n            logger.warn(\"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no \" + \"index\");\n            harp_utils_1.assert(!!this.indices);\n        }\n        else {\n            if (!(this.indices instanceof Uint32Array)) {\n                logger.warn(\"IndexedBufferedGeometryAccessor#constructor: BufferGeometry index \" +\n                    \"has wrong type\");\n                harp_utils_1.assert(this.indices instanceof Uint32Array);\n            }\n        }\n    }\n    /**\n     * Returns number of primitives, which is not known in this base class, so we return the number\n     * of indices.\n     *\n     * @returns The number of indices in the geometry.\n     */\n    getCount() {\n        return this.indices.length;\n    }\n    checkSetUp() {\n        return (!!this.indices &&\n            this.start !== undefined &&\n            this.end !== undefined &&\n            this.start >= 0 &&\n            this.end <= this.indices.length &&\n            this.start <= this.end);\n    }\n}\nexports.IndexedBufferedGeometryAccessor = IndexedBufferedGeometryAccessor;\n/**\n * Accessor for lines in an indexed geometry.\n */\nclass IndexedBufferedGeometryLineAccessor extends IndexedBufferedGeometryAccessor {\n    constructor(object, geometryType, bufferGeometry) {\n        super(object, geometryType, bufferGeometry, 3);\n        this.object = object;\n        this.geometryType = geometryType;\n        this.bufferGeometry = bufferGeometry;\n    }\n    isLineAccessor() {\n        return true;\n    }\n    /**\n     * Reconstructs line width from triangulated geometry.\n     *\n     * @returns Line width.\n     */\n    get width() {\n        harp_utils_1.assert(this.checkSetUp(), \"RoIndexedBufferedGeometryLineAccessor not setup\");\n        if (this.geometryType === harp_datasource_protocol_1.GeometryType.ExtrudedLine) {\n            const start = this.start + this.startCapSize;\n            const positionArray = this.position.array;\n            return harp_lines_1.reconstructLineWidth(positionArray, start);\n        }\n        return undefined;\n    }\n    clear() {\n        harp_utils_1.assert(this.checkSetUp(), \"RoIndexedBufferedGeometryLineAccessor not setup\");\n        const start = this.start;\n        const end = this.end;\n        for (let i = start; i < end; i++) {\n            this.indices[i] = 0;\n        }\n        this.bufferGeometry.index.needsUpdate = true;\n    }\n    getVertices() {\n        harp_utils_1.assert(this.checkSetUp(), \"RoIndexedBufferedGeometryLineAccessor not setup\");\n        const itemSize = this.itemSize;\n        const start = this.start;\n        const end = this.end;\n        const result = new Float32Array((end - start) * itemSize);\n        const positionArray = this.position.array;\n        if (itemSize === 2) {\n            for (let i = start, j = 0; i < end; i++, j += itemSize) {\n                const index = this.indices[i];\n                result[j + 0] = positionArray[index * itemSize + 0];\n                result[j + 1] = positionArray[index * itemSize + 1];\n            }\n        }\n        if (itemSize === 3) {\n            for (let i = start, j = 0; i < end; i++, j += itemSize) {\n                const index = this.indices[i];\n                result[j + 0] = positionArray[index * itemSize + 0];\n                result[j + 1] = positionArray[index * itemSize + 1];\n                result[j + 2] = positionArray[index * itemSize + 2];\n            }\n        }\n        else {\n            for (let i = start, j = 0; i < end; i++, j++) {\n                const index = this.indices[i];\n                for (let k = 0; k < itemSize; k++) {\n                    result[j * itemSize + k] = positionArray[index * itemSize + k];\n                }\n            }\n        }\n        return result;\n    }\n}\nexports.IndexedBufferedGeometryLineAccessor = IndexedBufferedGeometryLineAccessor;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst UNIT_Z = new THREE.Vector3(0, 0, 1);\nconst POINTS = [0, 1, 2, 1, 3, 2];\nconst BEVEL_POINTS = [0, 1, 3, 3, 1, 2, 0, 3, 4, 5, 4, 3];\nconst SECTORS_IN_CIRCLE = 8;\nconst STEP = Math.PI / SECTORS_IN_CIRCLE;\n/**\n * Adds a half-circle geometry to original line\n *\n * @param x The line end X (used as circle center X)\n * @param y The line end Y (used as circle center Y)\n * @param lineAngle The cap incline angle\n * @param radius The cap (circle) radius\n * @param vertices The input vertex buffer (cap vertices are added there)\n * @param indices The input index buffer (cap indices are is added there)\n */\nfunction addCircle(x, y, lineAngle, radius, vertices, indices) {\n    const baseVertex = vertices.length / 3;\n    // Add cap center to vertices directly (it doesn't need rotation)\n    vertices.push(x, y, 0);\n    for (let i = 0; i < SECTORS_IN_CIRCLE + 1; ++i) {\n        const angle = STEP * i + Math.PI / 2 + lineAngle; // Start angle is -90deg\n        vertices.push(x + radius * Math.cos(angle), y + radius * Math.sin(angle), 0);\n        indices.push(baseVertex, baseVertex + i + 1, baseVertex + ((i + 1) % (SECTORS_IN_CIRCLE + 1)) + 1);\n    }\n}\n/**\n * Returns the number of points in circle used for caps.\n *\n * @param lineWidth Width of line.\n */\n// tslint:disable-next-line:no-unused-variable\nfunction numCirclePoints(lineWidth) {\n    return SECTORS_IN_CIRCLE + 1;\n}\nexports.numCirclePoints = numCirclePoints;\n/**\n * Create a triangle mesh from the given polyline.\n *\n * @param points Sequence of (x,y,z) coordinates.\n * @param width The width of the extruded line.\n * @param vertices The output vertex buffer.\n * @param indices The output index buffer.\n * @param startWithCircle `true` if the line should start will a circle.\n * @param endWithCircle `true` if the line should end with a circle.\n */\nfunction triangulateLine(points, width, vertices, indices, startWithCircle = true, endWithCircle = startWithCircle) {\n    if (points.length < 3) {\n        return;\n    }\n    // This vector is used for computing cap angle\n    const angleVec = new THREE.Vector2();\n    if (startWithCircle) {\n        // Define lineAngle as (direction - origin) vector angle to X axis\n        const lineAngle = points.length !== 3\n            ? angleVec.set(points[3] - points[0], points[4] - points[1]).angle()\n            : 0;\n        addCircle(points[0], points[1], lineAngle, width, vertices, indices);\n    }\n    const baseVertex = vertices.length / 3;\n    // bt = Bitangent (i.e. extrusion vector)\n    const prevBt = new THREE.Vector3();\n    const p = new THREE.Vector3(); // current point\n    const n = new THREE.Vector3(); // next point\n    const bt = new THREE.Vector3();\n    const averageBt = new THREE.Vector3();\n    const p0 = new THREE.Vector3();\n    const p1 = new THREE.Vector3();\n    const p2 = new THREE.Vector3();\n    const p3 = new THREE.Vector3();\n    const N = points.length / 3;\n    let vertexOffset = 0;\n    for (let i = 0; i < N; ++i) {\n        let useBevel = false;\n        p.set(points[i * 3], points[i * 3 + 1], points[i * 3 + 2]);\n        if (i + 1 < N) {\n            n.set(points[(i + 1) * 3], points[(i + 1) * 3 + 1], points[(i + 1) * 3 + 2]);\n            bt.copy(n)\n                .sub(p)\n                .normalize()\n                .cross(UNIT_Z);\n            averageBt.copy(bt);\n            if (i > 0) {\n                averageBt.add(prevBt).multiplyScalar(1.0 - 0.5 * bt.dot(prevBt));\n                useBevel = prevBt.angleTo(bt) > Math.PI / 2;\n                if (useBevel) {\n                    const inclineWidth = width / Math.cos(bt.angleTo(prevBt) / 2);\n                    p0.copy(bt)\n                        .add(prevBt)\n                        .normalize()\n                        .multiplyScalar(-inclineWidth)\n                        .add(p);\n                    p1.copy(prevBt)\n                        .multiplyScalar(width)\n                        .add(p);\n                    // p2 is used for \"miter\" connections\n                    p2.copy(bt)\n                        .add(prevBt)\n                        .normalize()\n                        .multiplyScalar(inclineWidth)\n                        .add(p);\n                    p3.copy(bt)\n                        .multiplyScalar(width)\n                        .add(p);\n                }\n            }\n            if (useBevel) {\n                vertices.push(p0.x, p0.y, p0.z, p1.x, p1.y, p1.z, p2.x, p2.y, p2.z, p3.x, p3.y, p3.z);\n            }\n            else {\n                p0.copy(averageBt)\n                    .multiplyScalar(-width)\n                    .add(p);\n                p1.copy(averageBt)\n                    .multiplyScalar(width)\n                    .add(p);\n                vertices.push(p0.x, p0.y, p0.z, p1.x, p1.y, p1.z);\n            }\n            prevBt.copy(bt);\n        }\n        else {\n            p0.copy(prevBt)\n                .multiplyScalar(-width)\n                .add(p);\n            p1.copy(prevBt)\n                .multiplyScalar(width)\n                .add(p);\n            vertices.push(p0.x, p0.y, p0.z, p1.x, p1.y, p1.z);\n        }\n        if (i !== N - 1) {\n            (useBevel ? BEVEL_POINTS : POINTS).forEach(o => indices.push(baseVertex + vertexOffset + o));\n            vertexOffset += useBevel ? 4 : 2;\n        }\n    }\n    if (endWithCircle) {\n        const lineAngle = points.length !== 2\n            ? angleVec\n                .set(points[(N - 3) * 3] - points[(N - 2) * 3], points[(N - 3) * 3 + 1] - points[(N - 2) * 3 + 1])\n                .angle()\n            : Math.PI;\n        addCircle(points[(N - 2) * 3], points[(N - 2) * 3 + 1], lineAngle, width, vertices, indices);\n    }\n}\nexports.triangulateLine = triangulateLine;\n/**\n * Reconstruct the original points of a line from the vertices of the triangulated line.\n *\n * @param inBuffer Buffer with vertices.\n * @param startOffset Start index, will differ from `0` if the line has caps.\n * @returns Buffer containing the original points of the triangulated line.\n */\nfunction reconstructLine(inBuffer, startOffset) {\n    const outBuffer = new Float32Array(inBuffer.length / 2);\n    for (let i = startOffset * 3, i2 = i * 2; i < outBuffer.length; i += 3, i2 += 6) {\n        outBuffer[i] = inBuffer[i2] + (inBuffer[i2 + 3] - inBuffer[i2]) * 0.5;\n        outBuffer[i + 1] = inBuffer[i2 + 1] + (inBuffer[i2 + 3 + 1] - inBuffer[i2 + 1]) * 0.5;\n        outBuffer[i + 2] = inBuffer[i2 + 2] + (inBuffer[i2 + 3 + 2] - inBuffer[i2 + 2]) * 0.5;\n    }\n    return outBuffer;\n}\nexports.reconstructLine = reconstructLine;\n/**\n * Extract the line width from a triangulated line.\n *\n * @param inBuffer Array of vertex elements of a triangulated line.\n * @param startIndex Start index, will differ from `0` if the line has caps.\n */\nfunction reconstructLineWidth(inBuffer, startIndex) {\n    const xd = inBuffer[startIndex * 2 + 3] - inBuffer[startIndex * 2];\n    const yd = inBuffer[startIndex * 2 + 3 + 1] - inBuffer[startIndex * 2 + 1];\n    const zd = inBuffer[startIndex * 2 + 3 + 2] - inBuffer[startIndex * 2 + 2];\n    return Math.sqrt(xd * xd + yd * yd + zd * zd) * 0.5;\n}\nexports.reconstructLineWidth = reconstructLineWidth;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst THREE = require(\"three\");\nconst HighPrecisionUtils_1 = require(\"./HighPrecisionUtils\");\n/**\n * Class used to render high-precision wireframe lines.\n */\nclass HighPrecisionWireFrameLine extends THREE.Line {\n    /**\n     * Creates a `HighPrecisionWireFrameLine` object.\n     *\n     * @param geometry [[BufferGeometry]] used to render this object.\n     * @param material [[HighPrecisionLineMaterial]] used to render this object.\n     *     instances.\n     * @param positions Array of 2D/3D positions.\n     * @param color Color of the rendered line.\n     * @param opacity Opacity of the rendered line.\n     */\n    constructor(geometry, material, positions, color, opacity) {\n        super(geometry === undefined ? new THREE.BufferGeometry() : geometry, material);\n        if (material === undefined) {\n            material = new harp_materials_1.HighPrecisionLineMaterial({\n                color: color ? color : harp_materials_1.HighPrecisionLineMaterial.DEFAULT_COLOR,\n                opacity: opacity !== undefined ? opacity : harp_materials_1.HighPrecisionLineMaterial.DEFAULT_OPACITY\n            });\n        }\n        this.matrixWorldInverse = new THREE.Matrix4();\n        if (positions) {\n            this.setPositions(positions);\n        }\n    }\n    get bufferGeometry() {\n        return this.geometry;\n    }\n    get shaderMaterial() {\n        return this.material;\n    }\n    setPositions(positions) {\n        HighPrecisionUtils_1.HighPrecisionUtils.setPositions(this, positions);\n    }\n    setupForRendering() {\n        this.onBeforeRender = (_renderer, _scene, camera, _geometry, _material, _group) => {\n            HighPrecisionUtils_1.HighPrecisionUtils.updateHpUniforms(this, camera, this.shaderMaterial);\n        };\n    }\n    updateMatrixWorld(force) {\n        const doUpdateMatrixWorldInverse = this.matrixWorldNeedsUpdate || force;\n        super.updateMatrixWorld(force);\n        if (doUpdateMatrixWorldInverse) {\n            this.matrixWorldInverse.getInverse(this.matrixWorld);\n        }\n    }\n}\nexports.HighPrecisionWireFrameLine = HighPrecisionWireFrameLine;\n/**\n * Class used to render high-precision lines.\n */\nclass HighPrecisionLine extends THREE.Mesh {\n    /**\n     * Creates a `HighPrecisionLine` object.\n     *\n     * @param geometry [[BufferGeometry]] used to render this object.\n     * @param material [[HighPrecisionLineMaterial]] used to render this object.\n     *     instances.\n     * @param positions Array of 2D/3D positions.\n     * @param color Color of the rendered line.\n     * @param opacity Opacity of the rendered line.\n     */\n    constructor(geometry, material, positions, color, opacity) {\n        super(geometry === undefined ? new THREE.BufferGeometry() : geometry, material);\n        if (material === undefined) {\n            material = new harp_materials_1.HighPrecisionLineMaterial({\n                color: color ? color : harp_materials_1.HighPrecisionLineMaterial.DEFAULT_COLOR,\n                opacity: opacity !== undefined ? opacity : harp_materials_1.HighPrecisionLineMaterial.DEFAULT_OPACITY\n            });\n        }\n        this.matrixWorldInverse = new THREE.Matrix4();\n        if (positions) {\n            this.setPositions(positions);\n        }\n    }\n    get bufferGeometry() {\n        return this.geometry;\n    }\n    get shaderMaterial() {\n        return this.material;\n    }\n    setPositions(positions) {\n        HighPrecisionUtils_1.HighPrecisionUtils.setPositions(this, positions);\n    }\n    setupForRendering() {\n        this.onBeforeRender = (_renderer, _scene, camera, _geometry, _material, _group) => {\n            HighPrecisionUtils_1.HighPrecisionUtils.updateHpUniforms(this, camera, this.shaderMaterial);\n        };\n    }\n    updateMatrixWorld(force) {\n        const doUpdateMatrixWorldInverse = this.matrixWorldNeedsUpdate || force;\n        super.updateMatrixWorld(force);\n        if (doUpdateMatrixWorldInverse) {\n            this.matrixWorldInverse.getInverse(this.matrixWorld);\n        }\n    }\n}\nexports.HighPrecisionLine = HighPrecisionLine;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst geoUtils = require(\"@here/harp-geoutils\");\nconst harp_mapview_1 = require(\"@here/harp-mapview\");\nconst THREE = require(\"three\");\nconst utils = require(\"./Utils\");\nvar State;\n(function (State) {\n    State[State[\"NONE\"] = 0] = \"NONE\";\n    State[State[\"PAN\"] = 1] = \"PAN\";\n    State[State[\"ROTATE\"] = 2] = \"ROTATE\";\n    State[State[\"ORBIT\"] = 3] = \"ORBIT\";\n    State[State[\"TOUCH\"] = 4] = \"TOUCH\";\n})(State || (State = {}));\nvar TiltState;\n(function (TiltState) {\n    TiltState[TiltState[\"Tilted\"] = 0] = \"Tilted\";\n    TiltState[TiltState[\"Down\"] = 1] = \"Down\";\n})(TiltState = exports.TiltState || (exports.TiltState = {}));\n/**\n * Map interaction events' names.\n */\nvar EventNames;\n(function (EventNames) {\n    EventNames[\"Update\"] = \"update\";\n    EventNames[\"BeginInteraction\"] = \"begin-interaction\";\n    EventNames[\"EndInteraction\"] = \"end-interaction\";\n})(EventNames = exports.EventNames || (exports.EventNames = {}));\n// cast needed to workaround wrong three.js typings.\nconst MAPCONTROL_EVENT = { type: EventNames.Update };\nconst MAPCONTROL_EVENT_BEGIN_INTERACTION = {\n    type: EventNames.BeginInteraction\n};\nconst MAPCONTROL_EVENT_END_INTERACTION = {\n    type: EventNames.EndInteraction\n};\n/**\n * Yaw rotation as quaternion. Declared as a const to avoid object re-creation in certain\n * functions.\n */\nconst yawQuaternion = new THREE.Quaternion();\n/**\n * Pitch rotation as quaternion. Declared as a const to avoid object re-creation in certain\n * functions.\n */\nconst pitchQuaternion = new THREE.Quaternion();\n/**\n * The yaw axis around which we rotate when we change the yaw.\n * This axis is fixed and is the -Z axis `(0,0,1)`.\n */\nconst yawAxis = new THREE.Vector3(0, 0, 1);\n/**\n * The pitch axis which we use to rotate around when we change the pitch.\n * The axis is fix and is the +X axis `(1,0,0)`.\n */\nconst pitchAxis = new THREE.Vector3(1, 0, 0);\n/**\n * The number of the steps for which, when pitching the camera, the delta altitude is scaled until\n * it reaches the minimum camera height.\n */\nconst MAX_DELTA_ALTITUDE_STEPS = 10;\n/**\n * The number of user's inputs to consider for panning inertia, to reduce erratic inputs.\n */\nconst USER_INPUTS_TO_CONSIDER = 5;\n/**\n * The default maximum for the camera pitch. This value avoids seeing the horizon.\n */\nconst DEFAULT_MAX_PITCH_ANGLE = Math.PI / 4;\n/**\n * Epsilon value to rule out when a number can be considered 0.\n */\nconst EPSILON = 0.01;\n/**\n * This map control provides basic map-related building blocks to interact with the map. It also\n * provides a default way of handling user input. Currently we support basic mouse interaction and\n * touch input interaction.\n *\n * Mouse interaction:\n *  - Left mouse button + move = Panning the map.\n *  - Right mouse button + move = Orbits the camera around the focus point.\n *  - Middle mouse button + move = Rotating the view. Up down movement changes the pitch. Left/right\n *    movement changes the yaw.\n *  - Mouse wheel = Zooms up and down by one zoom level, zooms on target.\n *\n * Touch interaction:\n *  - One finger = Panning the map.\n *  - Two fingers = Scale, rotate and panning the map.\n *  - Three fingers = Orbiting the map. Up down movements influences the current orbit altitude.\n *    Left/right changes the azimuth.\n */\nclass MapControls extends THREE.EventDispatcher {\n    /**\n     * Constructs a new `MapControls` object.\n     *\n     * @param mapView [[MapView]] this controller modifies.ZZ\n     */\n    constructor(mapView) {\n        super();\n        this.mapView = mapView;\n        /**\n         * This factor will be applied to the delta of the current mouse pointer position and the last\n         * mouse pointer position: The result then will be used as an offset for the rotation then.\n         * Default value is `0.1`.\n         */\n        this.rotationMouseDeltaFactor = 0.1;\n        /**\n         * This factor will be applied to the delta of the current mouse pointer position and the last\n         * mouse pointer position: The result then will be used as an offset to orbit the camera.\n         * Default value is `0.1`.\n         */\n        this.orbitingMouseDeltaFactor = 0.1;\n        /**\n         * This factor will be applied to the delta of the current touch pointer position and the last\n         * touch pointer position: The result then will be used as an offset to orbit the camera.\n         * Default value is `0.1`.\n         */\n        this.orbitingTouchDeltaFactor = 0.1;\n        /**\n         * Set to `true` to enable input handling through this map control, `false` to disable input\n         * handling. Even when disabling input handling, you can manually use the public functions to\n         * change the view to the current map.\n         */\n        this.enabled = true;\n        /**\n         * Set to `true` to enable orbiting and Pitch axis rotation through this map control, `false` to\n         * disable orbiting and Pitch axis rotation.\n         */\n        this.tiltEnabled = true;\n        /**\n         * Set to `true` to enable rotation through this map control, `false` to disable rotation.\n         */\n        this.rotateEnabled = true;\n        /**\n         * Set to `true` to enable an inertia dampening on zooming and panning. `false` cancels inertia.\n         */\n        this.inertiaEnabled = true;\n        /**\n         * Inertia damping duration for the zoom, in seconds.\n         */\n        this.zoomInertiaDampingDuration = 0.5;\n        /**\n         * Inertia damping duration for the panning, in seconds.\n         */\n        this.panInertiaDampingDuration = 1.0;\n        /**\n         * Duration in seconds of the camera animation when the tilt button is clicked. Independent of\n         * inertia.\n         */\n        this.tiltToggleDuration = 0.5;\n        /**\n         * Camera pitch target when tilting it from the UI button.\n         */\n        this.tiltAngle = Math.PI / 4;\n        /**\n         * Determines the zoom level delta for single mouse wheel movement. So after each mouse wheel\n         * movement the current zoom level will be added or subtracted by this value. The default value\n         * is `0.2` - this means that every 5th mouse wheel movement you will cross a zoom level.\n         *\n         * **Note**: To reverse the zoom direction, you can provide a negative value.\n         */\n        this.zoomLevelDeltaOnMouseWheel = 0.2;\n        /**\n         * Zoom level delta when using the UI controls.\n         */\n        this.zoomLevelDeltaOnControl = 1.0;\n        /**\n         * Determines the minimum zoom level we can zoom to.\n         */\n        this.minZoomLevel = 0;\n        /**\n         * Determines the maximum zoom level we can zoom to.\n         */\n        this.maxZoomLevel = 20;\n        /**\n         * Determines the minimum camera height in meter.\n         */\n        this.minCameraHeight = 3;\n        this.m_currentViewDirection = new THREE.Vector3();\n        this.m_lastMousePosition = new THREE.Vector2(0, 0);\n        this.m_mouseDelta = new THREE.Vector2(0, 0);\n        this.m_needsRenderLastFrame = true;\n        this.m_panIsAnimated = false;\n        this.m_panDistanceFrameDelta = new THREE.Vector3();\n        this.m_panAnimationTime = 0;\n        this.m_panAnimationStartTime = 0;\n        this.m_lastAveragedPanDistance = 0;\n        this.m_currentInertialPanningSpeed = 0;\n        this.m_lastPanVector = new THREE.Vector3();\n        this.m_recentPanDistances = [0, 0, 0, 0, 0];\n        this.m_currentPanDistanceIndex = 0;\n        this.m_zoomIsAnimated = false;\n        this.m_zoomDeltaRequested = 0;\n        this.m_zoomTargetNormalizedCoordinates = new THREE.Vector2();\n        this.m_zoomAnimationTime = 0;\n        this.m_zoomAnimationStartTime = 0;\n        this.m_startZoom = 0;\n        this.m_tiltIsAnimated = false;\n        this.m_pitchRequested = undefined;\n        this.m_tiltAnimationTime = 0;\n        this.m_tiltAnimationStartTime = 0;\n        this.m_startPitch = 0;\n        this.m_state = State.NONE;\n        this.m_tmpVector2 = new THREE.Vector2();\n        this.m_tmpVector3 = new THREE.Vector3();\n        /**\n         * Determines the minimum angle the camera can pitch to. It is defined in radians.\n         */\n        this.m_minPitchAngle = 0;\n        /**\n         * Determines the maximum angle the camera can pitch to. It is defined in radians.\n         */\n        this.m_maxPitchAngle = DEFAULT_MAX_PITCH_ANGLE;\n        this.m_touchState = {\n            touches: [],\n            currentRotation: 0,\n            initialRotation: 0\n        };\n        /**\n         * Destroy this `MapControls` instance.\n         *\n         * Unregisters all grobal event handlers used. This is method should be called when you stop\n         * using `MapControls`.\n         */\n        this.dispose = () => {\n            // replaced with real code in bindInputEvents\n        };\n        this.camera = mapView.camera;\n        this.domElement = mapView.renderer.domElement;\n        this.maxZoomLevel = mapView.maxZoomLevel;\n        this.minZoomLevel = mapView.minZoomLevel;\n        this.minCameraHeight = mapView.minCameraHeight;\n        this.bindInputEvents(this.domElement);\n        this.handleZoom = this.handleZoom.bind(this);\n        this.pan = this.pan.bind(this);\n        this.tilt = this.tilt.bind(this);\n    }\n    /**\n     * Creates MapControls object and attaches it specified [[MapView]].\n     *\n     * @param mapView - [[MapView]] object to which MapControls should be attached to.\n     */\n    static create(mapView) {\n        return new MapControls(mapView);\n    }\n    /**\n     * Rotates the camera by the given delta yaw and delta pitch.\n     *\n     * @param deltaYaw Delta yaw in degrees.\n     * @param deltaPitch Delta pitch in degrees.\n     */\n    rotate(deltaYaw, deltaPitch) {\n        if (this.inertiaEnabled && this.m_zoomIsAnimated) {\n            this.stopZoom();\n        }\n        const yawPitchRoll = harp_mapview_1.MapViewUtils.extractYawPitchRoll(this.camera.quaternion);\n        //yaw\n        let yawAngle = yawPitchRoll.yaw;\n        if (this.rotateEnabled) {\n            yawAngle -= geoUtils.MathUtils.degToRad(deltaYaw);\n        }\n        yawQuaternion.setFromAxisAngle(yawAxis, yawAngle);\n        //pitch\n        const deltaPitchRadians = geoUtils.MathUtils.degToRad(deltaPitch);\n        const pitchAngle = this.constrainPitchAngle(yawPitchRoll.pitch, deltaPitchRadians);\n        pitchQuaternion.setFromAxisAngle(pitchAxis, pitchAngle);\n        yawQuaternion.multiply(pitchQuaternion);\n        this.mapView.camera.quaternion.copy(yawQuaternion);\n        this.mapView.camera.matrixWorldNeedsUpdate = true;\n    }\n    /**\n     * Current viewing angles yaw/pitch/roll in degrees.\n     */\n    get yawPitchRoll() {\n        const ypr = harp_mapview_1.MapViewUtils.extractYawPitchRoll(this.camera.quaternion);\n        return {\n            yaw: geoUtils.MathUtils.radToDeg(ypr.yaw),\n            pitch: geoUtils.MathUtils.radToDeg(ypr.pitch),\n            roll: geoUtils.MathUtils.radToDeg(ypr.roll)\n        };\n    }\n    /*\n     * Orbits the camera around the focus point of the camera. The `deltaAzimuth` and\n     * `deltaAltitude` are offsets in degrees to the current azimuth and altitude of the current\n     * orbit.\n     *\n     * @param deltaAzimuth Delta azimuth in degrees.\n     * @param deltaAltitude Delta altitude in degrees.\n     */\n    orbitFocusPoint(deltaAzimuth, deltaAltitude) {\n        if (this.inertiaEnabled && this.m_zoomIsAnimated) {\n            this.stopZoom();\n        }\n        this.mapView.camera.getWorldDirection(this.m_currentViewDirection);\n        const currentAzimuthAltitude = utils.directionToAzimuthAltitude(this.m_currentViewDirection);\n        const topElevation = (1.0 / Math.sin(currentAzimuthAltitude.altitude)) * this.mapView.camera.position.z;\n        const focusPointInWorldPosition = harp_mapview_1.MapViewUtils.rayCastWorldCoordinates(this.mapView, 0, 0);\n        const deltaAltitudeConstrained = this.getMinDelta(deltaAltitude);\n        this.rotate(deltaAzimuth, deltaAltitudeConstrained);\n        this.mapView.camera.getWorldDirection(this.m_currentViewDirection);\n        const newAzimuthAltitude = utils.directionToAzimuthAltitude(this.m_currentViewDirection);\n        const newElevation = Math.sin(newAzimuthAltitude.altitude) * topElevation;\n        this.mapView.camera.position.z = newElevation;\n        const newFocusPointInWorldPosition = harp_mapview_1.MapViewUtils.rayCastWorldCoordinates(this.mapView, 0, 0);\n        if (!focusPointInWorldPosition || !newFocusPointInWorldPosition) {\n            // We do this to trigger an update in all cases.\n            this.updateMapView();\n            return;\n        }\n        const diff = focusPointInWorldPosition.sub(newFocusPointInWorldPosition);\n        harp_mapview_1.MapViewUtils.pan(this.mapView, diff.x, diff.y);\n    }\n    /**\n     * Moves the camera along the view direction in meters.\n     * A positive value will move the camera further away from the point where the camera looks at.\n     * A negative value will move the camera near to the point where the camera looks at.\n     *\n     * @param amount Amount to move along the view direction in meters.\n     */\n    moveAlongTheViewDirection(amount) {\n        this.mapView.camera.getWorldDirection(this.m_currentViewDirection);\n        this.m_currentViewDirection.multiplyScalar(amount);\n        this.mapView.camera.position.z += this.m_currentViewDirection.z;\n        this.mapView.worldCenter.x += this.m_currentViewDirection.x;\n        this.mapView.worldCenter.y += this.m_currentViewDirection.y;\n        this.updateMapView();\n    }\n    /**\n     * Sets the rotation of the camera according to yaw and pitch in degrees.\n     *\n     * **Note:** `yaw == 0 && pitch == 0` will north up the map and you will look downwards onto the\n     * map.\n     *\n     * @param yaw Yaw in degrees.\n     * @param pitch Pitch in degrees.\n     */\n    setRotation(yaw, pitch) {\n        harp_mapview_1.MapViewUtils.setRotation(this.mapView, yaw, pitch);\n    }\n    /**\n     * Zooms and moves the map in such a way that the given target position remains at the same\n     * position after the zoom.\n     *\n     * @param targetPositionOnScreenXinNDC Target x position in NDC space.\n     * @param targetPositionOnScreenYinNDC Target y position in NDC space.\n     */\n    zoomOnTargetPosition(targetPositionOnScreenXinNDC, targetPositionOnScreenYinNDC, zoomLevel) {\n        harp_mapview_1.MapViewUtils.zoomOnTargetPosition(this.mapView, targetPositionOnScreenXinNDC, targetPositionOnScreenYinNDC, zoomLevel);\n    }\n    /**\n     * Zooms to the desired location by the provided value.\n     *\n     * @param zoomLevel Zoom level.\n     * @param screenTarget Zoom target on screen.\n     */\n    setZoomLevel(zoomLevel, screenTarget = { x: 0, y: 0 }) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.dispatchEvent(MAPCONTROL_EVENT_BEGIN_INTERACTION);\n        // Register the zoom request\n        this.m_startZoom = this.currentZoom;\n        this.m_zoomDeltaRequested = zoomLevel - this.zoomLevelTargetted;\n        // Cancel panning so the point of origin of the zoom is maintained.\n        this.m_panDistanceFrameDelta.set(0, 0, 0);\n        this.m_lastAveragedPanDistance = 0;\n        this.m_zoomTargetNormalizedCoordinates.set(screenTarget.x, screenTarget.y);\n        // Assign the new animation start time.\n        this.m_zoomAnimationStartTime = performance.now();\n        this.handleZoom();\n        this.dispatchEvent(MAPCONTROL_EVENT_END_INTERACTION);\n    }\n    /**\n     * Toggles the camera pitch between 0 (looking down) and the value at `this.tiltAngle`.\n     */\n    toggleTilt() {\n        this.m_startPitch = this.currentPitch;\n        const aimTilt = this.m_startPitch < EPSILON || this.m_tiltState === TiltState.Down;\n        this.m_pitchRequested = aimTilt ? this.tiltAngle : 0;\n        this.m_tiltState = aimTilt ? TiltState.Tilted : TiltState.Down;\n        this.m_tiltAnimationStartTime = performance.now();\n        this.tilt();\n    }\n    /**\n     * Set the camera height.\n     */\n    set cameraHeight(height) {\n        //Set the cameras height according to the given zoom level.\n        this.camera.position.setZ(height);\n        this.camera.matrixWorldNeedsUpdate = true;\n    }\n    /**\n     * Get the current camera height.\n     */\n    get cameraHeight() {\n        // ### Sync with the way geoviz is computing the zoom level.\n        return this.mapView.camera.position.z;\n    }\n    /**\n     * Set camera max pitch angle.\n     *\n     * @param angle Angle in degrees.\n     */\n    set maxPitchAngle(angle) {\n        this.m_maxPitchAngle = geoUtils.MathUtils.degToRad(angle);\n    }\n    /**\n     * Get the camera max pitch angle in degrees.\n     */\n    get maxPitchAngle() {\n        return geoUtils.MathUtils.radToDeg(this.m_maxPitchAngle);\n    }\n    /**\n     * Set camera min pitch angle.\n     *\n     * @param angle Angle in degrees.\n     */\n    set minPitchAngle(angle) {\n        this.m_minPitchAngle = geoUtils.MathUtils.degToRad(angle);\n    }\n    /**\n     * Get the camera min pitch angle in degrees.\n     */\n    get minPitchAngle() {\n        return geoUtils.MathUtils.radToDeg(this.m_minPitchAngle);\n    }\n    /**\n     * Get the zoom level targetted by `MapControls`. Useful when inertia is on, to add incremented\n     * values to the target instead of getting the random zoomLevel value during the interpolation.\n     */\n    get zoomLevelTargetted() {\n        return this.m_targettedZoom === undefined ? this.currentZoom : this.m_targettedZoom;\n    }\n    /**\n     * Handy getter to know if the view is in the process of looking down or not.\n     */\n    get tiltState() {\n        if (this.m_tiltState === undefined) {\n            this.m_tiltState =\n                this.currentPitch < EPSILON || this.m_tiltState === TiltState.Down\n                    ? TiltState.Tilted\n                    : TiltState.Down;\n        }\n        return this.m_tiltState;\n    }\n    set currentZoom(zoom) {\n        this.m_currentZoom = zoom;\n    }\n    get currentZoom() {\n        return this.m_currentZoom !== undefined ? this.m_currentZoom : this.mapView.zoomLevel;\n    }\n    set currentPitch(pitch) {\n        this.m_currentPitch = pitch;\n    }\n    get currentPitch() {\n        return harp_mapview_1.MapViewUtils.extractYawPitchRoll(this.mapView.camera.quaternion).pitch;\n    }\n    get targettedPitch() {\n        return this.m_targettedPitch === undefined\n            ? this.m_currentPitch === undefined\n                ? this.currentPitch\n                : this.m_currentPitch\n            : this.m_targettedPitch;\n    }\n    tilt() {\n        if (this.m_pitchRequested !== undefined) {\n            this.m_targettedPitch = Math.max(Math.min(this.m_pitchRequested, this.maxPitchAngle), this.m_minPitchAngle);\n            this.m_pitchRequested = undefined;\n        }\n        if (this.inertiaEnabled) {\n            if (!this.m_tiltIsAnimated) {\n                this.m_tiltIsAnimated = true;\n                this.mapView.addEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.tilt);\n            }\n            const currentTime = performance.now();\n            this.m_tiltAnimationTime = (currentTime - this.m_tiltAnimationStartTime) / 1000;\n            const tiltFinished = this.m_tiltAnimationTime > this.tiltToggleDuration;\n            if (tiltFinished) {\n                if (this.m_needsRenderLastFrame) {\n                    this.m_needsRenderLastFrame = false;\n                    this.m_tiltAnimationTime = this.tiltToggleDuration;\n                    this.stopTilt();\n                }\n            }\n            else {\n                this.m_needsRenderLastFrame = true;\n            }\n        }\n        this.m_currentPitch = this.inertiaEnabled\n            ? this.easeOutCubic(this.m_startPitch, this.targettedPitch, Math.min(1, this.m_tiltAnimationTime / this.tiltToggleDuration))\n            : this.targettedPitch;\n        const initialPitch = this.currentPitch;\n        const deltaAngle = this.m_currentPitch - initialPitch;\n        const oldCameraDistance = this.mapView.camera.position.z / Math.cos(initialPitch);\n        const newHeight = Math.cos(this.currentPitch) * oldCameraDistance;\n        this.orbitFocusPoint(newHeight - this.camera.position.z, geoUtils.MathUtils.radToDeg(deltaAngle));\n        this.updateMapView();\n    }\n    stopTilt() {\n        this.mapView.removeEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.tilt);\n        this.m_tiltIsAnimated = false;\n        this.m_targettedPitch = this.m_currentPitch = undefined;\n    }\n    easeOutCubic(startValue, endValue, time) {\n        return startValue + (endValue - startValue) * (--time * time * time + 1);\n    }\n    handleZoom() {\n        if (this.m_zoomDeltaRequested !== 0) {\n            this.m_targettedZoom = Math.max(Math.min(this.zoomLevelTargetted + this.m_zoomDeltaRequested, this.maxZoomLevel), this.minZoomLevel);\n            this.m_zoomDeltaRequested = 0;\n        }\n        if (this.inertiaEnabled) {\n            if (!this.m_zoomIsAnimated) {\n                this.m_zoomIsAnimated = true;\n                this.mapView.addEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.handleZoom);\n            }\n            const currentTime = performance.now();\n            this.m_zoomAnimationTime = (currentTime - this.m_zoomAnimationStartTime) / 1000;\n            const zoomFinished = this.m_zoomAnimationTime > this.zoomInertiaDampingDuration;\n            if (zoomFinished) {\n                if (this.m_needsRenderLastFrame) {\n                    this.m_needsRenderLastFrame = false;\n                    this.m_zoomAnimationTime = this.zoomInertiaDampingDuration;\n                    this.stopZoom();\n                }\n            }\n            else {\n                this.m_needsRenderLastFrame = true;\n            }\n        }\n        this.currentZoom =\n            !this.inertiaEnabled || Math.abs(this.zoomLevelTargetted - this.m_startZoom) < EPSILON\n                ? this.zoomLevelTargetted\n                : this.easeOutCubic(this.m_startZoom, this.zoomLevelTargetted, Math.min(1, this.m_zoomAnimationTime / this.zoomInertiaDampingDuration));\n        harp_mapview_1.MapViewUtils.zoomOnTargetPosition(this.mapView, this.m_zoomTargetNormalizedCoordinates.x, this.m_zoomTargetNormalizedCoordinates.y, this.currentZoom);\n        this.updateMapView();\n    }\n    stopZoom() {\n        this.mapView.removeEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.handleZoom);\n        this.m_zoomIsAnimated = false;\n    }\n    pan() {\n        if (this.m_state === State.NONE && this.m_lastAveragedPanDistance === 0) {\n            return;\n        }\n        if (this.inertiaEnabled && !this.m_panIsAnimated) {\n            this.m_panIsAnimated = true;\n            this.mapView.addEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.pan);\n        }\n        const applyInertia = this.inertiaEnabled &&\n            this.m_state === State.NONE &&\n            this.m_lastAveragedPanDistance > 0;\n        if (applyInertia) {\n            const currentTime = performance.now();\n            this.m_panAnimationTime = (currentTime - this.m_panAnimationStartTime) / 1000;\n            const panFinished = this.m_panAnimationTime > this.panInertiaDampingDuration;\n            if (panFinished) {\n                if (this.m_needsRenderLastFrame) {\n                    this.m_needsRenderLastFrame = false;\n                    this.m_panAnimationTime = this.panInertiaDampingDuration;\n                    this.mapView.removeEventListener(harp_mapview_1.MapViewEventNames.AfterRender, this.pan);\n                    this.m_panIsAnimated = false;\n                }\n            }\n            else {\n                this.m_needsRenderLastFrame = true;\n            }\n            const animationTime = this.m_panAnimationTime / this.panInertiaDampingDuration;\n            this.m_currentInertialPanningSpeed = this.easeOutCubic(this.m_lastAveragedPanDistance, 0, Math.min(1, animationTime));\n            if (this.m_currentInertialPanningSpeed === 0) {\n                this.m_lastAveragedPanDistance = 0;\n            }\n            this.m_panDistanceFrameDelta\n                .copy(this.m_lastPanVector)\n                .setLength(this.m_currentInertialPanningSpeed);\n        }\n        else {\n            this.m_lastPanVector.copy(this.m_panDistanceFrameDelta);\n            const panDistance = this.m_lastPanVector.length();\n            this.m_currentPanDistanceIndex =\n                (this.m_currentPanDistanceIndex + 1) % USER_INPUTS_TO_CONSIDER;\n            this.m_recentPanDistances[this.m_currentPanDistanceIndex] = panDistance;\n            this.m_lastAveragedPanDistance =\n                this.m_recentPanDistances.reduce((a, b) => a + b) / USER_INPUTS_TO_CONSIDER;\n        }\n        harp_mapview_1.MapViewUtils.pan(this.mapView, this.m_panDistanceFrameDelta.x, this.m_panDistanceFrameDelta.y);\n        if (!applyInertia) {\n            this.m_panDistanceFrameDelta.set(0, 0, 0);\n        }\n        this.updateMapView();\n    }\n    bindInputEvents(domElement) {\n        const onContextMenu = this.contextMenu.bind(this);\n        const onMouseDown = this.mouseDown.bind(this);\n        const onMouseWheel = this.mouseWheel.bind(this);\n        const onTouchStart = this.touchStart.bind(this);\n        const onTouchEnd = this.touchEnd.bind(this);\n        const onTouchMove = this.touchMove.bind(this);\n        domElement.addEventListener(\"contextmenu\", onContextMenu, false);\n        domElement.addEventListener(\"mousedown\", onMouseDown, false);\n        domElement.addEventListener(\"wheel\", onMouseWheel, false);\n        domElement.addEventListener(\"touchstart\", onTouchStart, false);\n        domElement.addEventListener(\"touchend\", onTouchEnd, false);\n        domElement.addEventListener(\"touchmove\", onTouchMove, false);\n        this.dispose = () => {\n            domElement.removeEventListener(\"contextmenu\", onContextMenu, false);\n            domElement.removeEventListener(\"mousedown\", onMouseDown, false);\n            domElement.removeEventListener(\"wheel\", onMouseWheel, false);\n            domElement.removeEventListener(\"touchstart\", onTouchStart, false);\n            domElement.removeEventListener(\"touchend\", onTouchEnd, false);\n            domElement.removeEventListener(\"touchmove\", onTouchMove, false);\n        };\n    }\n    updateMapView() {\n        this.dispatchEvent(MAPCONTROL_EVENT);\n        this.mapView.update();\n    }\n    mouseDown(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        if (event.shiftKey || event.ctrlKey) {\n            return;\n        }\n        event.preventDefault();\n        event.stopPropagation();\n        if (this.m_state !== State.NONE) {\n            return;\n        }\n        if (event.button === 0) {\n            this.m_state = State.PAN;\n        }\n        else if (event.button === 1) {\n            this.m_state = State.ROTATE;\n        }\n        else if (event.button === 2 && this.tiltEnabled) {\n            this.m_state = State.ORBIT;\n        }\n        else {\n            return;\n        }\n        this.dispatchEvent(MAPCONTROL_EVENT_BEGIN_INTERACTION);\n        this.m_lastMousePosition.setX(event.clientX);\n        this.m_lastMousePosition.setY(event.clientY);\n        const onMouseMove = this.mouseMove.bind(this);\n        const onMouseUp = this.mouseUp.bind(this);\n        // iframe handling for the examples.\n        window.addEventListener(\"mousemove\", onMouseMove, false);\n        window.top.addEventListener(\"mousemove\", onMouseMove, false);\n        window.addEventListener(\"mouseup\", onMouseUp, false);\n        window.top.addEventListener(\"mouseup\", onMouseUp, false);\n        this.m_cleanupMouseEventListeners = () => {\n            window.removeEventListener(\"mousemove\", onMouseMove);\n            window.top.removeEventListener(\"mousemove\", onMouseMove);\n            window.removeEventListener(\"mouseup\", onMouseUp);\n            window.top.removeEventListener(\"mouseup\", onMouseUp);\n        };\n    }\n    mouseMove(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.m_mouseDelta.set(event.clientX - this.m_lastMousePosition.x, event.clientY - this.m_lastMousePosition.y);\n        if (this.m_state === State.PAN) {\n            this.panFromTo(this.m_lastMousePosition.x, this.m_lastMousePosition.y, event.clientX, event.clientY);\n        }\n        else if (this.m_state === State.ROTATE) {\n            this.rotate(-this.rotationMouseDeltaFactor * this.m_mouseDelta.x, this.rotationMouseDeltaFactor * this.m_mouseDelta.y);\n        }\n        else if (this.m_state === State.ORBIT) {\n            this.orbitFocusPoint(this.orbitingMouseDeltaFactor * this.m_mouseDelta.x, -this.orbitingMouseDeltaFactor * this.m_mouseDelta.y);\n        }\n        this.m_lastMousePosition.setX(event.clientX);\n        this.m_lastMousePosition.setY(event.clientY);\n        this.m_zoomAnimationStartTime = performance.now();\n        this.updateMapView();\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    mouseUp(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.updateMapView();\n        event.preventDefault();\n        event.stopPropagation();\n        this.m_state = State.NONE;\n        if (this.m_cleanupMouseEventListeners) {\n            this.m_cleanupMouseEventListeners();\n        }\n        this.dispatchEvent(MAPCONTROL_EVENT_END_INTERACTION);\n    }\n    mouseWheel(event) {\n        const { width, height } = utils.getWidthAndHeightFromCanvas(this.domElement);\n        const screenTarget = utils.calculateNormalizedDeviceCoordinates(event.offsetX, event.offsetY, width, height);\n        this.setZoomLevel(this.zoomLevelTargetted + this.zoomLevelDeltaOnMouseWheel * (event.deltaY > 0 ? -1 : 1), screenTarget);\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    /**\n     * Calculates the angle of the vector, which is formed by two touch points in world space\n     * against the X axis in world space on the map. The resulting angle is in radians and between\n     * `-PI` and `PI`.\n     */\n    calculateAngleFromTouchPointsInWorldspace() {\n        if (this.m_touchState.touches.length < 2) {\n            return 0;\n        }\n        const x = this.m_touchState.touches[1].currentWorldPosition.x -\n            this.m_touchState.touches[0].currentWorldPosition.x;\n        const y = this.m_touchState.touches[1].currentWorldPosition.y -\n            this.m_touchState.touches[0].currentWorldPosition.y;\n        return Math.atan2(y, x);\n    }\n    /**\n     * Calculates the difference of the current distance of two touch points against their initial\n     * distance in world space.\n     */\n    calculatePinchDistanceInWorldSpace() {\n        if (this.m_touchState.touches.length < 2) {\n            return 0;\n        }\n        const initialDistance = this.m_tmpVector3\n            .subVectors(this.m_touchState.touches[0].initialWorldPosition, this.m_touchState.touches[1].initialWorldPosition)\n            .length();\n        const currentDistance = this.m_tmpVector3\n            .subVectors(this.m_touchState.touches[0].currentWorldPosition, this.m_touchState.touches[1].currentWorldPosition)\n            .length();\n        return currentDistance - initialDistance;\n    }\n    convertTouchPoint(touch) {\n        const newTouchPoint = new THREE.Vector2(touch.pageX, touch.pageY);\n        const { width, height } = utils.getWidthAndHeightFromCanvas(this.domElement);\n        const touchPointInNDC = utils.calculateNormalizedDeviceCoordinates(newTouchPoint.x, newTouchPoint.y, width, height);\n        const newWorldPosition = harp_mapview_1.MapViewUtils.rayCastWorldCoordinates(this.mapView, touchPointInNDC.x, touchPointInNDC.y);\n        if (newWorldPosition === null) {\n            return null;\n        }\n        return {\n            currentTouchPoint: newTouchPoint,\n            lastTouchPoint: newTouchPoint,\n            currentWorldPosition: newWorldPosition,\n            initialWorldPosition: newWorldPosition\n        };\n    }\n    setTouchState(touches) {\n        this.m_touchState.touches = [];\n        // TouchList doesn't conform to iterator interface so we cannot use 'for of'\n        // tslint:disable-next-line:prefer-for-of\n        for (let i = 0; i < touches.length; ++i) {\n            const touchState = this.convertTouchPoint(touches[i]);\n            if (touchState) {\n                this.m_touchState.touches.push(touchState);\n            }\n        }\n        if (this.m_touchState.touches.length !== 0) {\n            this.updateTouchState();\n            this.m_touchState.initialRotation = this.m_touchState.currentRotation;\n        }\n    }\n    updateTouchState() {\n        this.m_touchState.currentRotation = this.calculateAngleFromTouchPointsInWorldspace();\n    }\n    updateTouches(touches) {\n        const length = Math.min(touches.length, this.m_touchState.touches.length);\n        for (let i = 0; i < length; ++i) {\n            const oldTouchState = this.m_touchState.touches[i];\n            const newTouchState = this.convertTouchPoint(touches[i]);\n            if (newTouchState !== null) {\n                newTouchState.initialWorldPosition = oldTouchState.initialWorldPosition;\n                newTouchState.lastTouchPoint = oldTouchState.currentTouchPoint;\n                this.m_touchState.touches[i] = newTouchState;\n            }\n        }\n    }\n    touchStart(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.m_state = State.TOUCH;\n        this.dispatchEvent(MAPCONTROL_EVENT_BEGIN_INTERACTION);\n        this.setTouchState(event.touches);\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    touchMove(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.updateTouches(event.touches);\n        this.updateTouchState();\n        if (this.m_touchState.touches.length <= 2) {\n            this.m_panDistanceFrameDelta.subVectors(this.m_touchState.touches[0].initialWorldPosition, this.m_touchState.touches[0].currentWorldPosition);\n            // Cancel zoom inertia if a panning is triggered, so that the mouse location is kept.\n            this.m_startZoom = this.m_targettedZoom = this.currentZoom;\n            // Assign the new animation start time.\n            this.m_panAnimationStartTime = performance.now();\n            this.pan();\n        }\n        if (this.m_touchState.touches.length === 2) {\n            const deltaRotation = this.m_touchState.currentRotation - this.m_touchState.initialRotation;\n            this.rotate(geoUtils.MathUtils.radToDeg(deltaRotation), 0);\n            this.moveAlongTheViewDirection(this.calculatePinchDistanceInWorldSpace());\n        }\n        if (this.m_touchState.touches.length === 3 && this.tiltEnabled) {\n            const firstTouch = this.m_touchState.touches[0];\n            const diff = this.m_tmpVector2.subVectors(firstTouch.currentTouchPoint, firstTouch.lastTouchPoint);\n            this.orbitFocusPoint(this.orbitingTouchDeltaFactor * diff.x, -this.orbitingTouchDeltaFactor * diff.y);\n        }\n        this.m_zoomAnimationStartTime = performance.now();\n        this.updateMapView();\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    touchEnd(event) {\n        if (this.enabled === false) {\n            return;\n        }\n        this.m_state = State.NONE;\n        this.setTouchState(event.touches);\n        this.dispatchEvent(MAPCONTROL_EVENT_END_INTERACTION);\n        this.updateMapView();\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    contextMenu(event) {\n        event.preventDefault();\n    }\n    panFromTo(fromX, fromY, toX, toY) {\n        const { width, height } = utils.getWidthAndHeightFromCanvas(this.domElement);\n        const from = utils.calculateNormalizedDeviceCoordinates(fromX, fromY, width, height);\n        const to = utils.calculateNormalizedDeviceCoordinates(toX, toY, width, height);\n        const toWorld = harp_mapview_1.MapViewUtils.rayCastWorldCoordinates(this.mapView, to.x, to.y);\n        const fromWorld = harp_mapview_1.MapViewUtils.rayCastWorldCoordinates(this.mapView, from.x, from.y);\n        if (!toWorld || !fromWorld) {\n            return;\n        }\n        this.m_panDistanceFrameDelta = fromWorld.sub(toWorld);\n        // Cancel zoom inertia if a panning is triggered, so that the mouse location is kept.\n        this.stopZoom();\n        // Assign the new animation start time.\n        this.m_panAnimationStartTime = performance.now();\n        this.pan();\n    }\n    constrainPitchAngle(pitchAngle, deltaPitch) {\n        const tmpPitchAngle = geoUtils.MathUtils.clamp(pitchAngle + deltaPitch, this.m_minPitchAngle, this.m_maxPitchAngle);\n        if (this.tiltEnabled &&\n            tmpPitchAngle <= this.m_maxPitchAngle &&\n            tmpPitchAngle >= this.m_minPitchAngle) {\n            pitchAngle = tmpPitchAngle;\n        }\n        return pitchAngle;\n    }\n    /**\n     * This method approximates the minimum delta altitude by attempts. It has been preferred over a\n     * solution where the minimum delta is calculated adding the new delta to the current delta,\n     * because that solution would not have worked with terrains.\n     */\n    getMinDelta(deltaAltitude) {\n        // Do not even start to calculate a delta if the camera is already under the minimum height.\n        if (this.mapView.camera.position.z < this.minCameraHeight && deltaAltitude > 0) {\n            return 0;\n        }\n        const checkMinCamHeight = (deltaAlt, camera) => {\n            const cameraPos = camera.position;\n            const cameraQuat = camera.quaternion;\n            const newPitchQuaternion = new THREE.Quaternion();\n            const viewDirection = new THREE.Vector3();\n            const mockCamera = new THREE.Object3D();\n            mockCamera.position.set(cameraPos.x, cameraPos.y, cameraPos.z);\n            mockCamera.quaternion.set(cameraQuat.x, cameraQuat.y, cameraQuat.z, cameraQuat.w);\n            // save the current direction of the camera in viewDirection\n            mockCamera.getWorldDirection(viewDirection);\n            //calculate the new azimuth and altitude\n            const currentAzimuthAltitude = utils.directionToAzimuthAltitude(viewDirection);\n            const topElevation = (1.0 / Math.sin(currentAzimuthAltitude.altitude)) * mockCamera.position.z;\n            // get the current quaternion from the camera\n            const yawPitchRoll = harp_mapview_1.MapViewUtils.extractYawPitchRoll(mockCamera.quaternion);\n            //calculate the pitch\n            const deltaPitchRadians = geoUtils.MathUtils.degToRad(deltaAlt);\n            const pitchAngle = this.constrainPitchAngle(yawPitchRoll.pitch, deltaPitchRadians);\n            newPitchQuaternion.setFromAxisAngle(pitchAxis, pitchAngle);\n            // update the camera and the viewDirection vector\n            mockCamera.quaternion.copy(newPitchQuaternion);\n            mockCamera.matrixWorldNeedsUpdate = true;\n            mockCamera.getWorldDirection(viewDirection);\n            // use the viewDirection to get the height\n            const newAzimuthAltitude = utils.directionToAzimuthAltitude(viewDirection);\n            const newElevation = Math.sin(newAzimuthAltitude.altitude) * topElevation;\n            return newElevation;\n        };\n        let constrainedDeltaAltitude = deltaAltitude;\n        for (let i = 0; i < MAX_DELTA_ALTITUDE_STEPS; i++) {\n            const cameraHeight = checkMinCamHeight(constrainedDeltaAltitude, this.mapView.camera);\n            if (cameraHeight < this.minCameraHeight) {\n                constrainedDeltaAltitude *= 0.5;\n            }\n            else {\n                return constrainedDeltaAltitude;\n            }\n        }\n        return constrainedDeltaAltitude;\n    }\n}\nexports.MapControls = MapControls;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst three_1 = require(\"three\");\n/**\n * Transforms the given point in screen space into NDC space by taking the given screen dimension\n * into account.\n *\n * @param screenCoordinateX X coordinate in screen space.\n * @param screenCoordinateY Y coordinate in screen space.\n * @param screenSizeX Width of the reference screen size.\n * @param screenSizeY Height of the reference screen size.\n */\nfunction calculateNormalizedDeviceCoordinates(screenCoordinateX, screenCoordinateY, screenSizeX, screenSizeY) {\n    return new three_1.Vector2((screenCoordinateX / screenSizeX) * 2 - 1, -((screenCoordinateY / screenSizeY) * 2) + 1);\n}\nexports.calculateNormalizedDeviceCoordinates = calculateNormalizedDeviceCoordinates;\n/**\n * Returns the azimuth and altitude in radians for the given direction vector.\n *\n * @param direction The direction vector. Does not have to be normalized.\n */\nfunction directionToAzimuthAltitude(direction) {\n    const normalizedDirection = direction.clone().normalize();\n    //Shamelessly copied from Jan ;)\n    const xy = new three_1.Vector2(normalizedDirection.x, normalizedDirection.y);\n    const nxz = new three_1.Vector2(xy.length(), normalizedDirection.z).normalize();\n    const azimuth = Math.atan2(xy.x, xy.y);\n    const altitude = -Math.asin(nxz.y);\n    return { azimuth, altitude };\n}\nexports.directionToAzimuthAltitude = directionToAzimuthAltitude;\n/**\n * Returns the direction vector that is described by the given azimuth and altitude.\n *\n * @param azimuth Azimuth in radians.\n * @param altitude Altitude in radians.\n */\nfunction azimuthAltitudeToDirection(azimuth, altitude) {\n    azimuth = azimuth;\n    altitude = altitude;\n    //Shamelessly copied from Jan ;)\n    const result = new three_1.Vector3();\n    const cosAltitude = Math.cos(altitude);\n    result.setX(Math.sin(azimuth) * cosAltitude);\n    result.setY(Math.cos(azimuth) * cosAltitude);\n    result.setZ(Math.sin(altitude));\n    return result;\n}\nexports.azimuthAltitudeToDirection = azimuthAltitudeToDirection;\n/**\n * Safely parses decimal value into `number`.\n *\n * Safely falls back to default value for `null`, `undefined`, `NaN`, empty strings, and strings\n * with characters other than digits.\n *\n * @param text Number as a text to be parsed.\n * @param fallback Default value, which is returned if `text` doesn't represent a valid number.\n */\nfunction safeParseDecimalInt(text, fallback) {\n    if (text === null || text === undefined || text === \"\") {\n        return fallback;\n    }\n    if (!text.match(integerRe)) {\n        return fallback;\n    }\n    const result = Number.parseInt(text, 10);\n    if (isNaN(result)) {\n        return fallback;\n    }\n    return result;\n}\nexports.safeParseDecimalInt = safeParseDecimalInt;\nconst integerRe = /^\\d+$/;\n/**\n * Extracts the CSS width and height of the given canvas if available, or width and height of the\n * canvas otherwise.\n *\n * @param canvas The canvas.\n */\nfunction getWidthAndHeightFromCanvas(canvas) {\n    return {\n        //use clientWidth and clientHeight to support HiDPI devices\n        width: safeParseDecimalInt(canvas.style.width, canvas.clientWidth),\n        height: safeParseDecimalInt(canvas.style.height, canvas.clientHeight)\n    };\n}\nexports.getWidthAndHeightFromCanvas = getWidthAndHeightFromCanvas;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nrequire(\"@here/harp-fetch\");\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_mapview_1 = require(\"@here/harp-mapview\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"TileLoader\");\n/**\n * The [[TileLoader]] manages the different states of loading and decoding for a [[Tile]]. Used by\n * the [[TileDataSource]].\n *\n * A TileLoader supports loading for multiple tiles, this is required for the wrap around, where\n * it is possible to see the same tile multiple times.\n */\nclass TileLoader {\n    /**\n     * Set up loading of a single [[Tile]].\n     *\n     * @param dataSource The [[DataSource]] the tile belongs to.\n     * @param tileKey The quadtree address of a [[Tile]].\n     * @param dataProvider The [[DataProvider]] that retrieves the binary tile data.\n     * @param tileDecoder The [[ITileDecoder]] that decodes the binary tile to a [[DecodeTile]].\n     * @param priority The priority given to the loading job. Highest number will be served first.\n     */\n    constructor(dataSource, tileKey, dataProvider, tileDecoder, priority) {\n        this.dataSource = dataSource;\n        this.tileKey = tileKey;\n        this.dataProvider = dataProvider;\n        this.tileDecoder = tileDecoder;\n        this.priority = priority;\n        /**\n         * Current state of `TileLoader`.\n         */\n        this.state = harp_mapview_1.TileLoaderState.Initialized;\n        /**\n         * The abort controller notifying the [[DataProvider]] to cancel loading.\n         */\n        this.loadAbortController = new AbortController();\n        /**\n         * This is a form of reference counting for the result. We keep a track of this because when\n         * cancelling, it is important to know if we can actually cancel, or if there is another Tile\n         * that needs the result.\n         */\n        this.countRequests = 0;\n    }\n    /**\n     * Start loading and/or proceed through the various states of loading of this tile.\n     *\n     * @returns A promise which resolves the [[TileLoaderState]].\n     */\n    loadAndDecode() {\n        switch (this.state) {\n            case harp_mapview_1.TileLoaderState.Loading:\n                this.countRequests++;\n                return this.donePromise;\n            case harp_mapview_1.TileLoaderState.Ready:\n            case harp_mapview_1.TileLoaderState.Failed:\n            case harp_mapview_1.TileLoaderState.Initialized:\n            case harp_mapview_1.TileLoaderState.Canceled:\n                this.countRequests++;\n                this.ensureLoadingStarted();\n                return this.donePromise;\n            case harp_mapview_1.TileLoaderState.Loaded:\n                this.countRequests++;\n                this.startDecodeTile();\n                return this.donePromise;\n            case harp_mapview_1.TileLoaderState.Decoding:\n                this.cancelDecoding();\n                this.ensureLoadingStarted();\n                return this.donePromise;\n        }\n    }\n    /**\n     * Return the current state in form of a promise. Caller can then wait for the promise to be\n     * resolved.\n     *\n     * @returns A promise which resolves the current [[TileLoaderState]].\n     */\n    waitSettled() {\n        if (!this.donePromise) {\n            return Promise.resolve(this.state);\n        }\n        return this.donePromise;\n    }\n    /**\n     * Cancel loading of the [[Tile]] if there is only a single request remaining. Cancellation\n     * token is notified, an internal state is cleaned up.\n     *\n     * Otherwise this just reduces the count of requests by one.\n     */\n    cancel() {\n        if (--this.countRequests !== 0) {\n            return;\n        }\n        switch (this.state) {\n            case harp_mapview_1.TileLoaderState.Loading:\n                this.loadAbortController.abort();\n                this.loadAbortController = new AbortController();\n                break;\n            case harp_mapview_1.TileLoaderState.Decoding:\n                if (this.requestController) {\n                    this.requestController.abort();\n                    this.requestController = undefined;\n                }\n                break;\n        }\n        this.onDone(harp_mapview_1.TileLoaderState.Canceled);\n    }\n    /**\n     * Return `true` if [[Tile]] is still loading, `false` otherwise.\n     */\n    get isFinished() {\n        return (this.state === harp_mapview_1.TileLoaderState.Ready ||\n            this.state === harp_mapview_1.TileLoaderState.Canceled ||\n            this.state === harp_mapview_1.TileLoaderState.Failed);\n    }\n    /**\n     * Update the priority of this [[Tile]]'s priority. Is effective to sort the decoding requests\n     * in the request queue (used during heavy load).\n     */\n    updatePriority(priority) {\n        this.priority = priority;\n        if (this.requestController !== undefined) {\n            this.requestController.priority = priority;\n        }\n    }\n    /**\n     * Depending on state: if not loaded yet, make sure it is loading.\n     */\n    ensureLoadingStarted() {\n        switch (this.state) {\n            case harp_mapview_1.TileLoaderState.Ready:\n            case harp_mapview_1.TileLoaderState.Initialized:\n            case harp_mapview_1.TileLoaderState.Canceled:\n                this.doStartLoad();\n                return;\n            case harp_mapview_1.TileLoaderState.Loading:\n            case harp_mapview_1.TileLoaderState.Loaded:\n                // we may reuse already started loading promise\n                logger.info(\"reusing already started load operation\");\n                return;\n            case harp_mapview_1.TileLoaderState.Decoding:\n                this.cancelDecoding();\n                this.doStartLoad();\n                return;\n        }\n    }\n    /**\n     * Start loading. Only call if loading did not start yet.\n     */\n    doStartLoad() {\n        const myLoadCancellationToken = this.loadAbortController.signal;\n        this.dataProvider\n            .getTile(this.tileKey, myLoadCancellationToken)\n            .then(payload => {\n            if (myLoadCancellationToken.aborted) {\n                // safety belt if getTile doesn't really support cancellation tokens\n                const err = new Error(\"Aborted\");\n                err.name = \"AbortError\";\n                throw err;\n            }\n            this.onLoaded(payload);\n        })\n            .catch(error => {\n            // Handle abort messages from fetch and also our own.\n            if (error.name === \"AbortError\" || error.message === \"AbortError: Aborted\") {\n                return;\n            }\n            this.onError(error);\n        });\n        if (this.donePromise === undefined) {\n            this.donePromise = new Promise((resolve, reject) => {\n                this.resolveDonePromise = resolve;\n                this.rejectedDonePromise = reject;\n            });\n        }\n        this.state = harp_mapview_1.TileLoaderState.Loading;\n    }\n    /**\n     * Called when binary data has been loaded. The loading state is now progressing to decoding.\n     *\n     * @param payload Binary data in form of [[ArrayBufferLike]], or any object.\n     */\n    onLoaded(payload) {\n        this.state = harp_mapview_1.TileLoaderState.Loaded;\n        this.payload = payload;\n        if (payload.byteLength !== undefined) {\n            if (payload.byteLength === 0) {\n                this.onDone(harp_mapview_1.TileLoaderState.Ready);\n                return;\n            }\n        }\n        // Object is empty\n        if (payload === {}) {\n            this.onDone(harp_mapview_1.TileLoaderState.Ready);\n            return;\n        }\n        // TBD: we might suspend decode if tile is not visible ... ?\n        this.startDecodeTile();\n    }\n    /**\n     * Start decoding the payload.\n     */\n    startDecodeTile() {\n        const payload = this.payload;\n        if (payload === undefined) {\n            logger.error(\"TileLoader#startDecodeTile: Cannot decode without payload\");\n            return;\n        }\n        this.state = harp_mapview_1.TileLoaderState.Decoding;\n        this.payload = undefined;\n        // Save our cancellation point, so we can be reliably cancelled by any subsequent decode\n        // attempts\n        const requestController = new harp_datasource_protocol_1.RequestController(this.priority);\n        this.requestController = requestController;\n        const dataSource = this.dataSource;\n        this.tileDecoder\n            .decodeTile(payload, this.tileKey, dataSource.projection, requestController)\n            .then(decodedTile => {\n            if (requestController.signal.aborted) {\n                // our flow is cancelled, silently return\n                return;\n            }\n            this.onDecoded(decodedTile);\n        })\n            .catch(error => {\n            // Handle abort messages from fetch and also our own.\n            if (error.name === \"AbortError\" || error.message === \"AbortError: Aborted\") {\n                // our flow is cancelled, silently return\n                return;\n            }\n            this.onError(error);\n        });\n    }\n    /**\n     * Called when the decoding is finished, and the [[DecodedTile]] has been created.\n     *\n     * @param decodedTile The [[DecodedTile]].\n     */\n    onDecoded(decodedTile) {\n        this.decodedTile = decodedTile;\n        this.onDone(harp_mapview_1.TileLoaderState.Ready);\n    }\n    /**\n     * Cancel the decoding process.\n     */\n    cancelDecoding() {\n        if (this.requestController !== undefined) {\n            // we should cancel any decodes already in progress!\n            this.requestController.abort();\n            this.requestController = undefined;\n        }\n    }\n    /**\n     * Called when loading and decoding has finished successfully. Resolves loading promise if the\n     * state is Ready, otherwise it rejects the promise with the supplied state.\n     *\n     * @param doneState The latest state of loading.\n     */\n    onDone(doneState) {\n        if (this.resolveDonePromise && doneState === harp_mapview_1.TileLoaderState.Ready) {\n            this.resolveDonePromise(doneState);\n        }\n        else if (this.rejectedDonePromise) {\n            this.rejectedDonePromise(doneState);\n        }\n        this.resolveDonePromise = undefined;\n        this.rejectedDonePromise = undefined;\n        this.donePromise = undefined;\n        this.state = doneState;\n    }\n    /**\n     * Called when loading or decoding has finished with an error.\n     *\n     * @param error Error object describing the failing.\n     */\n    onError(error) {\n        const dataSource = this.dataSource;\n        logger.error(`[${dataSource.name}]: failed to load tile ${this.tileKey.toHereTile()}`, error);\n        this.error = error;\n        this.onDone(harp_mapview_1.TileLoaderState.Failed);\n    }\n}\nexports.TileLoader = TileLoader;\n/**\n * Subclass of [[TileLoader]] which is used by [[TileDataSource]] to load the [[TileInfo]] meta\n * data, not the tile data itself.\n */\nclass TileInfoLoader extends TileLoader {\n    startDecodeTile() {\n        const payload = this.payload;\n        if (payload === undefined) {\n            logger.error(\"TileInfoLoader#startDecodeTile: Cannot decode without payload\");\n            return;\n        }\n        this.state = harp_mapview_1.TileLoaderState.Decoding;\n        this.payload = undefined;\n        // Save our cancellation point, so we can be reliably cancelled by any subsequent decode\n        // attempts\n        const requestController = new harp_datasource_protocol_1.RequestController(this.priority);\n        this.requestController = requestController;\n        const dataSource = this.dataSource;\n        this.tileDecoder\n            .getTileInfo(payload, this.tileKey, dataSource.projection, requestController)\n            .then(tileInfo => {\n            if (requestController.signal.aborted) {\n                // our flow is cancelled, silently return\n                return;\n            }\n            this.tileInfo = tileInfo;\n            this.onDone(harp_mapview_1.TileLoaderState.Ready);\n        })\n            .catch(error => {\n            // Handle abort messages from fetch and also our own.\n            if (error.name === \"AbortError\" || error.message === \"AbortError: Aborted\") {\n                // our flow is cancelled, silently return\n                return;\n            }\n            this.onError(error);\n        });\n    }\n}\nexports.TileInfoLoader = TileInfoLoader;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n/**\n * Abstract class defining a shape of a [[Theme]]'s expression\n */\nclass Expr {\n    constructor(kind) {\n        this.kind = kind;\n    }\n    /**\n     * Returns a parsed expression.\n     * @param code String which describes the type of expression to be parsed, for example \"var\".\n     */\n    static parse(code) {\n        const parser = new Parser(code);\n        const expr = parser.parse();\n        return expr;\n    }\n}\nexports.Expr = Expr;\n/**\n * @hidden\n */\nclass Env {\n    /**\n     * Returns property in [[Env]] by name.\n     *\n     * @param name Name of property.\n     */\n    lookup(_name) {\n        return undefined;\n    }\n    /**\n     * Return an object containing all properties of this environment. (Here: empty object).\n     */\n    unmap() {\n        return {};\n    }\n}\nexports.Env = Env;\n/**\n * Adds access to map specific environment properties.\n */\nclass MapEnv extends Env {\n    constructor(entries, parent) {\n        super();\n        this.entries = entries;\n        this.parent = parent;\n    }\n    /**\n     * Returns property in [[Env]] by name.\n     *\n     * @param name Name of property.\n     */\n    lookup(name) {\n        const value = this.entries[name];\n        if (value !== undefined) {\n            return value;\n        }\n        return this.parent ? this.parent.lookup(name) : undefined;\n    }\n    /**\n     * Return an object containing all properties of this environment, takes care of the parent\n     * object.\n     */\n    unmap() {\n        const obj = this.parent ? this.parent.unmap() : {};\n        for (const key in this.entries) {\n            if (this.entries.hasOwnProperty(key)) {\n                obj[key] = this.entries[key];\n            }\n        }\n        return obj;\n    }\n}\nexports.MapEnv = MapEnv;\n/**\n * Var expression.\n */\nclass VarExpr extends Expr {\n    constructor(name) {\n        super(\"var\");\n        this.name = name;\n    }\n    evaluate(env) {\n        const value = env.lookup(this.name);\n        return value;\n    }\n}\n/**\n * Number literal expression.\n */\nclass NumberLiteralExpr extends Expr {\n    constructor(value) {\n        super(\"number\");\n        this.value = value;\n    }\n    evaluate() {\n        return this.value;\n    }\n}\n/**\n * String literal expression.\n */\nclass StringLiteralExpr extends Expr {\n    constructor(value) {\n        super(\"string\");\n        this.value = value;\n    }\n    evaluate() {\n        return this.value;\n    }\n}\n/**\n * A has expression with an attribute, for example `has(ref)`.\n */\nclass HasAttributeExpr extends Expr {\n    constructor(attribute) {\n        super(\"has\");\n        this.attribute = attribute;\n    }\n    evaluate(env) {\n        return env.lookup(this.attribute) !== undefined;\n    }\n}\n/**\n * A contains expression.\n */\nclass ContainsExpr extends Expr {\n    constructor(value, elements) {\n        super(\"in\");\n        this.value = value;\n        this.elements = elements;\n    }\n    evaluate(env) {\n        const value = this.value.evaluate(env);\n        for (const e of this.elements) {\n            const element = e.evaluate(env);\n            if (value === element) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n/**\n * A `not` expression.\n */\nclass NotExpr extends Expr {\n    constructor(expr) {\n        super(\"!\");\n        this.expr = expr;\n    }\n    evaluate(env) {\n        return !this.expr.evaluate(env);\n    }\n}\n/**\n * A binary operator expression\n */\nclass BinaryExpr extends Expr {\n    constructor(op, left, right) {\n        super(op);\n        this.op = op;\n        this.left = left;\n        this.right = right;\n    }\n    evaluate(env) {\n        const left = this.left.evaluate(env);\n        const right = this.right.evaluate(env);\n        switch (this.op) {\n            case \"~=\": {\n                if (typeof left === \"string\" && typeof right === \"string\") {\n                    return left.indexOf(right) !== -1;\n                }\n                return false;\n            }\n            case \"^=\": {\n                if (typeof left === \"string\" && typeof right === \"string\") {\n                    return left.startsWith(right);\n                }\n                return false;\n            }\n            case \"$=\": {\n                if (typeof left === \"string\" && typeof right === \"string\") {\n                    return left.endsWith(right);\n                }\n                return false;\n            }\n            case \"==\":\n                return left === right;\n            case \"!=\":\n                return left !== right;\n            case \"<\":\n                return left !== undefined && right !== undefined ? left < right : undefined;\n            case \">\":\n                return left !== undefined && right !== undefined ? left > right : undefined;\n            case \"<=\":\n                return left !== undefined && right !== undefined ? left <= right : undefined;\n            case \">=\":\n                return left !== undefined && right !== undefined ? left >= right : undefined;\n        }\n        throw new Error(`invalid relational op ${this.op}`);\n    }\n}\n/**\n * Logical expression.\n */\nclass LogicalExpr extends Expr {\n    constructor(op, left, right) {\n        super(op);\n        this.op = op;\n        this.left = left;\n        this.right = right;\n    }\n    evaluate(env) {\n        const value = this.left.evaluate(env);\n        switch (this.op) {\n            case \"||\":\n                return value || this.right.evaluate(env);\n            case \"&&\":\n                return value && this.right.evaluate(env);\n        } // switch\n        throw new Error(`invalid logical op ${this.op}`);\n    }\n}\n/**\n * Character value\n */\nvar Character;\n(function (Character) {\n    Character[Character[\"Tab\"] = 9] = \"Tab\";\n    Character[Character[\"Lf\"] = 10] = \"Lf\";\n    Character[Character[\"Cr\"] = 13] = \"Cr\";\n    Character[Character[\"Space\"] = 32] = \"Space\";\n    Character[Character[\"LParen\"] = 40] = \"LParen\";\n    Character[Character[\"RParen\"] = 41] = \"RParen\";\n    Character[Character[\"Comma\"] = 44] = \"Comma\";\n    Character[Character[\"Dot\"] = 46] = \"Dot\";\n    Character[Character[\"LBracket\"] = 91] = \"LBracket\";\n    Character[Character[\"Backslash\"] = 92] = \"Backslash\";\n    Character[Character[\"RBracket\"] = 93] = \"RBracket\";\n    Character[Character[\"_0\"] = 48] = \"_0\";\n    Character[Character[\"_9\"] = 57] = \"_9\";\n    Character[Character[\"_\"] = 95] = \"_\";\n    Character[Character[\"A\"] = 64] = \"A\";\n    Character[Character[\"Z\"] = 90] = \"Z\";\n    Character[Character[\"a\"] = 97] = \"a\";\n    Character[Character[\"z\"] = 122] = \"z\";\n    Character[Character[\"DoubleQuote\"] = 34] = \"DoubleQuote\";\n    Character[Character[\"SingleQuote\"] = 39] = \"SingleQuote\";\n    Character[Character[\"Exclaim\"] = 33] = \"Exclaim\";\n    Character[Character[\"Equal\"] = 61] = \"Equal\";\n    Character[Character[\"Caret\"] = 94] = \"Caret\";\n    Character[Character[\"Tilde\"] = 126] = \"Tilde\";\n    Character[Character[\"Dollar\"] = 36] = \"Dollar\";\n    Character[Character[\"Less\"] = 60] = \"Less\";\n    Character[Character[\"Greater\"] = 62] = \"Greater\";\n    Character[Character[\"Bar\"] = 124] = \"Bar\";\n    Character[Character[\"Amp\"] = 38] = \"Amp\";\n})(Character || (Character = {}));\n/**\n * Check if a codepoint is a whitespace character.\n */\nfunction isSpace(codepoint) {\n    switch (codepoint) {\n        case Character.Tab:\n        case Character.Lf:\n        case Character.Cr:\n        case Character.Space:\n            return true;\n        default:\n            return false;\n    } // switch\n}\n/**\n * Check if codepoint is a digit character.\n */\nfunction isNumber(codepoint) {\n    return codepoint >= Character._0 && codepoint <= Character._9;\n}\n/**\n * Check if codepoint is a letter character.\n */\nfunction isLetter(codepoint) {\n    return ((codepoint >= Character.a && codepoint <= Character.z) ||\n        (codepoint >= Character.A && codepoint <= Character.Z));\n}\n/**\n * Check if codepoint is either a digit or a letter character.\n */\nfunction isLetterOrNumber(codepoint) {\n    return isLetter(codepoint) || isNumber(codepoint);\n}\n/**\n * Check if codepoint is an identification character: underscore, dollar sign, dot or bracket.\n */\nfunction isIdentChar(codepoint) {\n    return (isLetterOrNumber(codepoint) ||\n        codepoint === Character._ ||\n        codepoint === Character.Dollar ||\n        codepoint === Character.Dot ||\n        codepoint === Character.LBracket ||\n        codepoint === Character.RBracket);\n}\n/**\n * Tokens used in theme grammar.\n */\nvar Token;\n(function (Token) {\n    Token[Token[\"Eof\"] = 0] = \"Eof\";\n    Token[Token[\"Error\"] = 1] = \"Error\";\n    Token[Token[\"Identifier\"] = 2] = \"Identifier\";\n    Token[Token[\"Number\"] = 3] = \"Number\";\n    Token[Token[\"String\"] = 4] = \"String\";\n    Token[Token[\"Comma\"] = 5] = \"Comma\";\n    Token[Token[\"LParen\"] = 6] = \"LParen\";\n    Token[Token[\"RParen\"] = 7] = \"RParen\";\n    Token[Token[\"LBracket\"] = 8] = \"LBracket\";\n    Token[Token[\"RBracket\"] = 9] = \"RBracket\";\n    Token[Token[\"Exclaim\"] = 10] = \"Exclaim\";\n    Token[Token[\"TildeEqual\"] = 11] = \"TildeEqual\";\n    Token[Token[\"CaretEqual\"] = 12] = \"CaretEqual\";\n    Token[Token[\"DollarEqual\"] = 13] = \"DollarEqual\";\n    Token[Token[\"EqualEqual\"] = 14] = \"EqualEqual\";\n    Token[Token[\"ExclaimEqual\"] = 15] = \"ExclaimEqual\";\n    Token[Token[\"Less\"] = 16] = \"Less\";\n    Token[Token[\"Greater\"] = 17] = \"Greater\";\n    Token[Token[\"LessEqual\"] = 18] = \"LessEqual\";\n    Token[Token[\"GreaterEqual\"] = 19] = \"GreaterEqual\";\n    Token[Token[\"BarBar\"] = 20] = \"BarBar\";\n    Token[Token[\"AmpAmp\"] = 21] = \"AmpAmp\";\n})(Token || (Token = {}));\n/**\n * Maps a token to its string name.\n */\nfunction tokenSpell(token) {\n    switch (token) {\n        case Token.Eof:\n            return \"eof\";\n        case Token.Error:\n            return \"error\";\n        case Token.Identifier:\n            return \"identifier\";\n        case Token.Number:\n            return \"number\";\n        case Token.String:\n            return \"string\";\n        case Token.Comma:\n            return \",\";\n        case Token.LParen:\n            return \"(\";\n        case Token.RParen:\n            return \")\";\n        case Token.LBracket:\n            return \"[\";\n        case Token.RBracket:\n            return \"]\";\n        case Token.Exclaim:\n            return \"!\";\n        case Token.TildeEqual:\n            return \"~=\";\n        case Token.CaretEqual:\n            return \"^=\";\n        case Token.DollarEqual:\n            return \"$=\";\n        case Token.EqualEqual:\n            return \"==\";\n        case Token.ExclaimEqual:\n            return \"!=\";\n        case Token.Less:\n            return \"<\";\n        case Token.Greater:\n            return \">\";\n        case Token.LessEqual:\n            return \"<=\";\n        case Token.GreaterEqual:\n            return \">=\";\n        case Token.BarBar:\n            return \"||\";\n        case Token.AmpAmp:\n            return \"&&\";\n        default:\n            throw new Error(`invalid token ${token}`);\n    }\n}\n/**\n * Lexer class implementation.\n */\nclass Lexer {\n    constructor(code) {\n        this.code = code;\n        this.m_token = Token.Error;\n        this.m_index = 0;\n        this.m_char = Character.Lf;\n    }\n    /**\n     * Single lexer token.\n     */\n    token() {\n        return this.m_token;\n    }\n    /**\n     * Parsed text.\n     */\n    text() {\n        return this.m_text || \"\";\n    }\n    /**\n     * Go to the next token.\n     */\n    next() {\n        this.m_token = this.yylex();\n        if (this.m_token === Token.Error) {\n            throw new Error(`unexpected character ${this.m_char}`);\n        }\n        return this.m_token;\n    }\n    yyinp() {\n        this.m_char = this.code.codePointAt(this.m_index++) || 0;\n    }\n    yylex() {\n        this.m_text = undefined;\n        while (isSpace(this.m_char)) {\n            this.yyinp();\n        }\n        if (this.m_char === 0) {\n            return Token.Eof;\n        }\n        const ch = this.m_char;\n        this.yyinp();\n        switch (ch) {\n            case Character.LParen:\n                return Token.LParen;\n            case Character.RParen:\n                return Token.RParen;\n            case Character.LBracket:\n                return Token.LBracket;\n            case Character.RBracket:\n                return Token.RBracket;\n            case Character.Comma:\n                return Token.Comma;\n            case Character.SingleQuote:\n            case Character.DoubleQuote: {\n                const start = this.m_index - 1;\n                while (this.m_char && this.m_char !== ch) {\n                    // ### TODO handle escape sequences\n                    this.yyinp();\n                }\n                if (this.m_char !== ch) {\n                    throw new Error(\"Unfinished string literal\");\n                }\n                this.yyinp();\n                this.m_text = this.code.substring(start, this.m_index - 2);\n                return Token.String;\n            }\n            case Character.Exclaim:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.ExclaimEqual;\n                }\n                return Token.Exclaim;\n            case Character.Caret:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.CaretEqual;\n                }\n                return Token.Error;\n            case Character.Tilde:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.TildeEqual;\n                }\n                return Token.Error;\n            case Character.Equal:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.EqualEqual;\n                }\n                return Token.Error;\n            case Character.Less:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.LessEqual;\n                }\n                return Token.Less;\n            case Character.Greater:\n                if (this.m_char === Character.Equal) {\n                    this.yyinp();\n                    return Token.GreaterEqual;\n                }\n                return Token.Greater;\n            case Character.Bar:\n                if (this.m_char === Character.Bar) {\n                    this.yyinp();\n                    return Token.BarBar;\n                }\n                return Token.Error;\n            case Character.Amp:\n                if (this.m_char === Character.Amp) {\n                    this.yyinp();\n                    return Token.AmpAmp;\n                }\n                return Token.Error;\n            default: {\n                const start = this.m_index - 2;\n                if (isLetter(ch) ||\n                    ch === Character._ ||\n                    (ch === Character.Dollar && isIdentChar(this.m_char))) {\n                    while (isIdentChar(this.m_char)) {\n                        this.yyinp();\n                    }\n                    this.m_text = this.code.substring(start, this.m_index - 1);\n                    return Token.Identifier;\n                }\n                else if (isNumber(ch)) {\n                    while (isNumber(this.m_char)) {\n                        this.yyinp();\n                    }\n                    if (this.m_char === Character.Dot) {\n                        this.yyinp();\n                        while (isNumber(this.m_char)) {\n                            this.yyinp();\n                        }\n                    }\n                    this.m_text = this.code.substring(start, this.m_index - 1);\n                    return Token.Number;\n                }\n                else if (ch === Character.Dollar) {\n                    if (this.m_char === Character.Equal) {\n                        this.yyinp();\n                        return Token.DollarEqual;\n                    }\n                    return Token.Error;\n                }\n            }\n        }\n        return Token.Error;\n    }\n}\nfunction getEqualityOp(token) {\n    switch (token) {\n        case Token.TildeEqual:\n            return \"~=\";\n        case Token.CaretEqual:\n            return \"^=\";\n        case Token.DollarEqual:\n            return \"$=\";\n        case Token.EqualEqual:\n            return \"==\";\n        case Token.ExclaimEqual:\n            return \"!=\";\n        default:\n            return undefined;\n    } // switch\n}\nfunction getRelationalOp(token) {\n    switch (token) {\n        case Token.Less:\n            return \"<\";\n        case Token.Greater:\n            return \">\";\n        case Token.LessEqual:\n            return \"<=\";\n        case Token.GreaterEqual:\n            return \">=\";\n        default:\n            return undefined;\n    } // switch\n}\nclass Parser {\n    constructor(code) {\n        this.lex = new Lexer(code);\n        this.lex.next();\n    }\n    parse() {\n        return this.parseLogicalOr();\n    }\n    yyexpect(token) {\n        if (this.lex.token() !== token) {\n            throw new Error(`Syntax error: Expected token '${tokenSpell(token)}' but ` +\n                `found '${tokenSpell(this.lex.token())}'`);\n        }\n        this.lex.next();\n    }\n    parsePrimary() {\n        switch (this.lex.token()) {\n            case Token.Identifier: {\n                const text = this.lex.text();\n                if (text !== \"has\") {\n                    const expr = new VarExpr(text);\n                    this.lex.next();\n                    return expr;\n                }\n                this.lex.next(); // skip has\n                this.yyexpect(Token.LParen);\n                const attribute = this.lex.text();\n                this.yyexpect(Token.Identifier);\n                this.yyexpect(Token.RParen);\n                return new HasAttributeExpr(attribute);\n            }\n            case Token.Number: {\n                const expr = new NumberLiteralExpr(parseFloat(this.lex.text()));\n                this.lex.next();\n                return expr;\n            }\n            case Token.String: {\n                const expr = new StringLiteralExpr(this.lex.text());\n                this.lex.next();\n                return expr;\n            }\n            case Token.LParen: {\n                this.lex.next();\n                const expr = this.parseLogicalOr();\n                this.yyexpect(Token.RParen);\n                return expr;\n            }\n        }\n        throw new Error(\"Syntax error\");\n    }\n    parseUnary() {\n        if (this.lex.token() === Token.Exclaim) {\n            this.lex.next();\n            return new NotExpr(this.parseUnary());\n        }\n        return this.parsePrimary();\n    }\n    parseRelational() {\n        let expr = this.parseUnary();\n        while (true) {\n            if (this.lex.token() === Token.Identifier && this.lex.text() === \"in\") {\n                this.lex.next();\n                this.yyexpect(Token.LBracket);\n                const elements = [this.parsePrimary()];\n                while (this.lex.token() === Token.Comma) {\n                    this.lex.next();\n                    elements.push(this.parsePrimary());\n                }\n                this.yyexpect(Token.RBracket);\n                expr = new ContainsExpr(expr, elements);\n            }\n            else {\n                const op = getRelationalOp(this.lex.token());\n                if (op === undefined) {\n                    break;\n                }\n                this.lex.next();\n                const right = this.parseUnary();\n                expr = new BinaryExpr(op, expr, right);\n            }\n        }\n        return expr;\n    }\n    parseEquality() {\n        let expr = this.parseRelational();\n        while (true) {\n            const op = getEqualityOp(this.lex.token());\n            if (op === undefined) {\n                break;\n            }\n            this.lex.next();\n            const right = this.parseRelational();\n            expr = new BinaryExpr(op, expr, right);\n        }\n        return expr;\n    }\n    parseLogicalAnd() {\n        let expr = this.parseEquality();\n        while (this.lex.token() === Token.AmpAmp) {\n            this.lex.next();\n            const right = this.parseEquality();\n            expr = new LogicalExpr(\"&&\", expr, right);\n        }\n        return expr;\n    }\n    parseLogicalOr() {\n        let expr = this.parseLogicalAnd();\n        while (this.lex.token() === Token.BarBar) {\n            this.lex.next();\n            const right = this.parseLogicalAnd();\n            expr = new LogicalExpr(\"||\", expr, right);\n        }\n        return expr;\n    }\n}\nexports.Parser = Parser;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/MapControls\"));\n__export(require(\"./lib/MapControlsUI\"));\n__export(require(\"./lib/LongPressHandler\"));\n__export(require(\"./lib/Utils\"));\n__export(require(\"./lib/MapAnimations\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst SolidLineMaterial_1 = require(\"./SolidLineMaterial\");\n/**\n * Material designed to render dashed variable-width lines.\n */\nclass DashedLineMaterial extends SolidLineMaterial_1.SolidLineMaterial {\n    /**\n     * Constructs a new `DashedLineMaterial`.\n     *\n     * @param params `DashedLineMaterial` parameters.\n     */\n    constructor(params) {\n        const shaderParams = {};\n        if (params !== undefined && params.color !== undefined) {\n            shaderParams.color = params.color;\n        }\n        if (params !== undefined && params.lineWidth !== undefined) {\n            shaderParams.lineWidth = params.lineWidth;\n        }\n        if (params !== undefined && params.opacity !== undefined) {\n            shaderParams.opacity = params.opacity;\n        }\n        if (params !== undefined && params.fog !== undefined) {\n            shaderParams.fog = params.fog;\n        }\n        super(shaderParams);\n        this.name = \"DashedLineMaterial\";\n        Object.assign(this.uniforms, {\n            dashSize: new THREE.Uniform(DashedLineMaterial.DEFAULT_DASH_SIZE),\n            gapSize: new THREE.Uniform(DashedLineMaterial.DEFAULT_GAP_SIZE)\n        });\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.dashSize !== undefined) {\n                this.dashSize = params.dashSize;\n            }\n            if (params.gapSize !== undefined) {\n                this.gapSize = params.gapSize;\n            }\n            if (params.fog !== undefined) {\n                this.fog = params.fog !== null;\n            }\n        }\n    }\n    /**\n     * Size of the dashed segments.\n     */\n    get dashSize() {\n        return this.uniforms.dashSize.value;\n    }\n    set dashSize(value) {\n        this.uniforms.dashSize.value = value;\n    }\n    /**\n     * Size of the gaps between dashed segments.\n     */\n    get gapSize() {\n        return this.uniforms.gapSize.value;\n    }\n    set gapSize(value) {\n        this.uniforms.gapSize.value = value;\n        this.updateDashedFeature();\n    }\n    updateDashedFeature() {\n        this.defines.DASHED_LINE = this.gapSize > 0.0 ? 1 : 0;\n    }\n}\nDashedLineMaterial.DEFAULT_DASH_SIZE = 1.0;\nDashedLineMaterial.DEFAULT_GAP_SIZE = 1.0;\nexports.DashedLineMaterial = DashedLineMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The `PriorityListGroup` contains a list of [[PriorityListElement]]s that all have the same\n * (integer) priority.\n */\nclass PriorityListGroup {\n    constructor(priority, elements = new Array()) {\n        this.priority = priority;\n        this.elements = elements;\n    }\n    /**\n     * Create and return a deep copy of the `PriorityListGroup<T>`.\n     *\n     * @returns A clone of the `PriorityListGroup<T>`.\n     */\n    clone() {\n        return new PriorityListGroup(this.priority, this.elements.slice());\n    }\n}\nexports.PriorityListGroup = PriorityListGroup;\n/**\n * The `GroupedPriorityList` contains a [[PriorityListGroupMap]] to manage a larger number of items\n * in priority groups.\n */\nclass GroupedPriorityList {\n    constructor() {\n        this.groups = new Map();\n    }\n    /**\n     * Add an element to the `GroupedPriorityList`. Selects group based on the elements priority.\n     *\n     * @param element Element to be added.\n     */\n    add(element) {\n        this.getGroup(element.priority).elements.push(element);\n    }\n    /**\n     * Remove an element from the `GroupedPriorityList`.\n     *\n     * Note: It is required that the priority is the same as it was when the element has been added.\n     * Otherwise, the removal will fail.\n     *\n     * @param element Element to be removed.\n     * @returns `True` if the element was removed, `false` otherwise.\n     */\n    remove(element) {\n        const group = this.getGroup(element.priority);\n        if (group !== undefined) {\n            const foundIndex = group.elements.indexOf(element);\n            if (foundIndex >= 0) {\n                group.elements.splice(foundIndex, 1);\n                if (group.elements.length === 0) {\n                    const normalizedPriority = Math.floor(element.priority);\n                    this.groups.delete(normalizedPriority);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Remove all internal [[PriorityListGroup]]s.\n     */\n    clear() {\n        this.groups.clear();\n    }\n    /**\n     * Merge another [[GroupedPriorityList]] into this one.\n     *\n     * @param other Other group to merge.\n     */\n    merge(other) {\n        for (const otherGroup of other.groups) {\n            const group = this.findGroup(otherGroup[1].priority);\n            if (group === undefined) {\n                this.groups.set(Math.floor(otherGroup[1].priority), otherGroup[1].clone());\n                continue;\n            }\n            group.elements = group.elements.concat(otherGroup[1].elements);\n        }\n        return this;\n    }\n    /**\n     * Return a sorted list of [[PriorityListGroup]]s.\n     */\n    get sortedGroups() {\n        const groups = [];\n        for (const priorityList of this.groups) {\n            groups.push(priorityList[1]);\n        }\n        groups.sort((a, b) => {\n            return b.priority - a.priority;\n        });\n        return groups;\n    }\n    /**\n     * Apply function to all elements in this `GroupedPriorityList`.\n     *\n     * @param {(element: T) => void} fun Function to apply.\n     */\n    forEach(fun) {\n        for (const group of this.groups) {\n            group[1].elements.forEach(fun);\n        }\n    }\n    /**\n     * Count the number of elements in this `GroupedPriorityList`.\n     */\n    count() {\n        let n = 0;\n        for (const group of this.groups) {\n            n += group[1].elements.length;\n        }\n        return n;\n    }\n    /**\n     * Get group of elements that have the same (integer) priority.\n     *\n     * @param priority The priority to retrieve all elements from.\n     */\n    findGroup(priority) {\n        const normalizedPriority = Math.floor(priority);\n        const group = this.groups.get(normalizedPriority);\n        return group;\n    }\n    /**\n     * Get group of elements that have the same (integer) priority.\n     *\n     * @param priority The priority to retrieve all elements from.\n     */\n    getGroup(priority) {\n        let group = this.findGroup(priority);\n        if (group === undefined) {\n            const normalizedPriority = Math.floor(priority);\n            group = new PriorityListGroup(normalizedPriority);\n            this.groups.set(normalizedPriority, group);\n        }\n        return group;\n    }\n}\nexports.GroupedPriorityList = GroupedPriorityList;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./ConsoleChannel\"));\n__export(require(\"./ILogger\"));\n__export(require(\"./Logger\"));\n__export(require(\"./LoggerManager\"));\n__export(require(\"./MultiChannel\"));\n__export(require(\"./WorkerChannel\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst LoggerManagerImpl_1 = require(\"./LoggerManagerImpl\");\n/**\n * The LoggerManager class implements a singleton object that handles logging.\n *\n * Example:\n *\n * ```typescript\n *\n * const logger = LoggerManager.instance.create(\"MyFontLoaderClass\");\n * if (missingFonts.length > 0) {\n *     logger.error(\"These fonts can not be loaded: \", missingFonts);\n * } else {\n *     logger.log(\"All fonts have been loaded.\");\n * }\n * ```\n */\nclass LoggerManager {\n    static get instance() {\n        return this.m_instance || (this.m_instance = new LoggerManagerImpl_1.LoggerManagerImpl());\n    }\n}\nexports.LoggerManager = LoggerManager;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ConsoleChannel_1 = require(\"./ConsoleChannel\");\nconst Logger_1 = require(\"./Logger\");\nconst WorkerChannel_1 = require(\"./WorkerChannel\");\n/**\n * LoggerManagerImpl is the class for the singleton instance of the logger manager.\n * It handles channels and loggers.\n */\nclass LoggerManagerImpl {\n    constructor() {\n        this.m_loggers = [];\n        this.channel =\n            typeof self === \"undefined\" || typeof self.document !== \"undefined\"\n                ? new ConsoleChannel_1.ConsoleChannel()\n                : new WorkerChannel_1.WorkerChannel();\n    }\n    getLoggerNames() {\n        return this.m_loggers.map(logger => logger.name);\n    }\n    getLogger(name) {\n        return this.m_loggers.find(logger => logger.name === name);\n    }\n    create(loggerName, options) {\n        const logger = new Logger_1.Logger(loggerName, this.channel, options);\n        this.m_loggers.push(logger);\n        return logger;\n    }\n    dispose(logger) {\n        const found = this.m_loggers.indexOf(logger);\n        if (found < 0) {\n            throw new Error(`Cannot unregister \"${logger}\" : no such logger registered.`);\n        }\n        this.m_loggers.splice(found, 1);\n    }\n    updateAll(options) {\n        for (const logger of this.m_loggers) {\n            logger.update(options);\n        }\n    }\n    update(loggerName, config) {\n        for (const logger of this.m_loggers) {\n            if (logger.name === loggerName) {\n                logger.update(config);\n            }\n        }\n    }\n    enableAll(enabled) {\n        for (const logger of this.m_loggers) {\n            logger.enabled = enabled;\n        }\n    }\n    enable(loggerName, value) {\n        this.update(loggerName, { enabled: value });\n    }\n    setLogLevelForAll(level) {\n        for (const logger of this.m_loggers) {\n            logger.level = level;\n        }\n    }\n    setLogLevel(loggerName, level) {\n        this.update(loggerName, { level });\n    }\n    setChannel(channel) {\n        this.channel = channel;\n    }\n}\nexports.LoggerManagerImpl = LoggerManagerImpl;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Class allowing mixing several channels.\n */\nclass MultiChannel {\n    constructor(...channels) {\n        this.channels = [];\n        this.channels = channels;\n    }\n    error(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.error(message, ...optionalParams);\n        }\n    }\n    debug(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.debug(message, ...optionalParams);\n        }\n    }\n    info(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.info(message, ...optionalParams);\n        }\n    }\n    log(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.log(message, ...optionalParams);\n        }\n    }\n    trace(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.trace(message, ...optionalParams);\n        }\n    }\n    warn(message, ...optionalParams) {\n        for (const channel of this.channels) {\n            channel.warn(message, ...optionalParams);\n        }\n    }\n}\nexports.MultiChannel = MultiChannel;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Math2D;\n(function (Math2D) {\n    /**\n     * Alternative 2D box object with less memory impact (four numbers instead of two min/max\n     * objects with two numbers each). Should be faster.\n     */\n    class Box {\n        /**\n         * Alternative 2D box object with less memory impact (four numbers instead of two min/max\n         * objects with two numbers each). Should be faster.\n         *\n         * @param x New X value.\n         * @param y New y value.\n         * @param w New w value.\n         * @param h New h value.\n         */\n        constructor(x = 0, y = 0, w = 0, h = 0) {\n            this.x = x;\n            this.y = y;\n            this.w = w;\n            this.h = h;\n        }\n        /**\n         * Set new values to all properties of the box.\n         *\n         * @param x New X value.\n         * @param y New y value.\n         * @param w New w value.\n         * @param h New h value.\n         */\n        set(x, y, w, h) {\n            this.x = x;\n            this.y = y;\n            this.w = w;\n            this.h = h;\n        }\n        /**\n         * Test box for inclusion of point.\n         *\n         * @param x X coordinate of point.\n         * @param y Y coordinate of point.\n         */\n        contains(x, y) {\n            return this.x <= x && this.x + this.w >= x && this.y <= y && this.y + this.h >= y;\n        }\n        /**\n         * Test two boxes for intersection.\n         *\n         * @param other Box 2 to test for intersection.\n         */\n        intersects(other) {\n            return (this.x <= other.x + other.w &&\n                this.x + this.w >= other.x &&\n                this.y <= other.y + other.h &&\n                this.y + this.h >= other.y);\n        }\n    }\n    Math2D.Box = Box;\n    /**\n     * Compute squared distance between two 2D points `a` and `b`.\n     *\n     * @param ax Point a.x\n     * @param ay Point a.y\n     * @param bx Point b.x\n     * @param by Point b.y\n     * @returns Squared distance between the two points\n     */\n    function distSquared(ax, ay, bx, by) {\n        return (ax - bx) * (ax - bx) + (ay - by) * (ay - by);\n    }\n    Math2D.distSquared = distSquared;\n    /**\n     * Computes the squared length of a line.\n     *\n     * @param line An array of that forms a line via [x,y,z,x,y,z,...] tuples.\n     */\n    function computeSquaredLineLength(line) {\n        let squaredLineLength = 0;\n        const length = line.length - 4;\n        for (let i = 0; i < length; i += 3) {\n            const xDiff = line[i + 3] - line[i];\n            const yDiff = line[i + 4] - line[i + 1];\n            squaredLineLength += xDiff * xDiff + yDiff * yDiff;\n        }\n        return squaredLineLength;\n    }\n    Math2D.computeSquaredLineLength = computeSquaredLineLength;\n    /**\n     * Compute squared distance between a 2D point and a 2D line segment.\n     *\n     * @param px Test point X\n     * @param py Test point y\n     * @param l0x Line segment start X\n     * @param l0y Line segment start Y\n     * @param l1x Line segment end X\n     * @param l1y Line segment end Y\n     * @returns Squared distance between point and line segment\n     */\n    function distToSegmentSquared(px, py, l0x, l0y, l1x, l1y) {\n        const lineLengthSuared = distSquared(l0x, l0y, l1x, l1y);\n        if (lineLengthSuared === 0) {\n            return distSquared(px, py, l0x, l0y);\n        }\n        let t = ((px - l0x) * (l1x - l0x) + (py - l0y) * (l1y - l0y)) / lineLengthSuared;\n        t = Math.max(0, Math.min(1, t));\n        return distSquared(px, py, l0x + t * (l1x - l0x), l0y + t * (l1y - l0y));\n    }\n    Math2D.distToSegmentSquared = distToSegmentSquared;\n})(Math2D = exports.Math2D || (exports.Math2D = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar MathUtils;\n(function (MathUtils) {\n    /**\n     * Ensures that input value fits in a given range.\n     *\n     * @param value The value to be clamped.\n     * @param min Minimum value.\n     * @param max Maximum value.\n     *\n     * @returns Clamped value.\n     */\n    function clamp(value, min, max) {\n        return value < min ? min : value > max ? max : value;\n    }\n    MathUtils.clamp = clamp;\n    /**\n     * Returns a smooth interpolation between the values edge0 and edge1 based on the interpolation\n     * factor x. `0 <= x <= 1`.\n     * @see https://en.wikipedia.org/wiki/Smoothstep\n     *\n     * @param edge0\n     * @param edge1\n     * @param x\n     */\n    function smoothStep(edge0, edge1, x) {\n        // Scale, bias and saturate x to 0..1 range\n        x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n        // Evaluate polynomial\n        return x * x * (3 - 2 * x);\n    }\n    MathUtils.smoothStep = smoothStep;\n    /**\n     * Returns a smooth interpolation between the values edge0 and edge1 based on the interpolation\n     * factor x. `0 <= x <= 1`.\n     *\n     * Improved version by Ken Perlin, which has zero 1st- and 2nd-order derivatives at `x = 0` and\n     * `x = 1`:\n     *\n     * @see https://en.wikipedia.org/wiki/Smoothstep\n     *\n     * @param edge0\n     * @param edge1\n     * @param x\n     */\n    function smootherStep(edge0, edge1, x) {\n        // Scale, and clamp x to 0..1 range\n        x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n        // Evaluate polynomial\n        return x * x * x * (x * (x * 6 - 15) + 10);\n    }\n    MathUtils.smootherStep = smootherStep;\n    /**\n     * Maps a number from one range to another.\n     *\n     * @param val The incoming value to be converted.\n     * @param inMin Lower bound of the value's current range.\n     * @param inMax Upper bound of the value's current range.\n     * @param outMin Lower bound of the value's target range.\n     * @param outMax Upper bound of the value's target range.\n     */\n    function lerp(val, inMin, inMax, outMin, outMax) {\n        return ((val - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin;\n    }\n    MathUtils.lerp = lerp;\n    /**\n     * Returns the smaller of the two given numbers. Both numbers may be undefined, in which case\n     * the result is undefined. If only one of the numbers is undefined, the other number is\n     * returned.\n     *\n     * @param a First number.\n     * @param b Second number.\n     */\n    function min2(a, b) {\n        let result;\n        if (a !== undefined) {\n            result = a;\n        }\n        if (b !== undefined) {\n            result = result === undefined ? b : Math.min(result, b);\n        }\n        return result;\n    }\n    MathUtils.min2 = min2;\n    /**\n     * Returns the larger of the two given numbers. Both numbers may be undefined, in which case\n     * the result is undefined. If only one of the numbers is undefined, the other number is\n     * returned.\n     *\n     * @param a First number.\n     * @param b Second number.\n     */\n    function max2(a, b) {\n        let result;\n        if (a !== undefined) {\n            result = a;\n        }\n        if (b !== undefined) {\n            result = result === undefined ? b : Math.max(result, b);\n        }\n        return result;\n    }\n    MathUtils.max2 = max2;\n    /**\n     * Checks if the value of a given number is inside an upper or lower bound. The bounds may be\n     * undefined, in which case their value is ignored.\n     *\n     * @param value Value to check.\n     * @param lowerBound The lower bound to check the value against.\n     * @param upperBound The upper bound to check the value against.\n     *\n     * @returns `true` if value is inside the bounds or if the bounds are `undefined`, `false`\n     *          otherwise.\n     */\n    function isClamped(value, lowerBound, upperBound) {\n        if (lowerBound !== undefined && value < lowerBound) {\n            return false;\n        }\n        if (upperBound !== undefined && value > upperBound) {\n            return false;\n        }\n        return true;\n    }\n    MathUtils.isClamped = isClamped;\n    /**\n     * Smoothly interpolates between two values using cubic formula\n     *\n     * @param startValue\n     * @param endValue\n     * @param time\n     * @returns Result of the interpolation within the range of `[startValue, endValue]`\n     */\n    function easeInOutCubic(startValue, endValue, time) {\n        const timeValue = time < 0.5 ? 4 * time * time * time : (time - 1) * (2 * time - 2) * (2 * time - 2) + 1;\n        return startValue + (endValue - startValue) * timeValue;\n    }\n    MathUtils.easeInOutCubic = easeInOutCubic;\n})(MathUtils = exports.MathUtils || (exports.MathUtils = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Copy methods and properties from one prototype into another.\n *\n * @see https://www.typescriptlang.org/docs/handbook/mixins.html\n *\n * @param derivedCtor Class to mix methods and properties into.\n * @param baseCtors Class to take all methods and properties from.\n */\nfunction applyMixins(derivedCtor, baseCtors) {\n    baseCtors.forEach(baseCtor => {\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\n            derivedCtor.prototype[name] = baseCtor.prototype[name];\n        });\n    });\n}\nexports.applyMixins = applyMixins;\n/**\n * Copy methods from one prototype into another.\n *\n * @see https://www.typescriptlang.org/docs/handbook/mixins.html\n *\n * @param derivedCtor Class to mix methods into.\n * @param baseCtors Class to take all methods from.\n */\nfunction applyMixinsWithoutProperties(derivedCtor, baseCtors) {\n    baseCtors.forEach(baseCtor => {\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\n            const descriptor = Object.getOwnPropertyDescriptor(baseCtor.prototype, name);\n            if (descriptor !== undefined && descriptor.get === undefined) {\n                derivedCtor.prototype[name] = baseCtor.prototype[name];\n            }\n        });\n    });\n}\nexports.applyMixinsWithoutProperties = applyMixinsWithoutProperties;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// cache value, because access to process.env.NODE_ENV is SLOW!\nconst isProduction = process.env.NODE_ENV === \"production\";\n//TODO: Make assertHandler configurable\n/**\n * Implementation of assert as a development help\n *\n * Note - this is deliberately a global function so that minimizers remove the\n * entire call when building for production.\n *\n * @hidden\n * @param condition Condition to match, if false, throws an Error(message)\n * @param message Optional message, defaults to \"ASSERTION failed\"\n */\nfunction assert(condition, message) {\n    if (!isProduction) {\n        if (!condition) {\n            throw new Error(message !== undefined ? message : \"ASSERTION failed\");\n        }\n    }\n}\nexports.assert = assert;\nfunction assertExists(element, message) {\n    if (!isProduction) {\n        if (element === undefined || element === null) {\n            throw new Error(message !== undefined ? message : \"ASSERTION failed: Element is undefined or null\");\n        }\n    }\n    return element;\n}\nexports.assertExists = assertExists;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/* tslint:disable:max-line-length */\n/**\n * See:\n * https://developers.google.com/web/updates/2012/08/When-milliseconds-are-not-enough-performance-now\n */\n/* tslint:ensable:max-line-length */\nclass PerformanceTimer {\n    /**\n     * Returns timestamp in milliseconds since page load.\n     *\n     * If the [[DOMHighResTimeStamp]] is supported, the resolution is up to 5 microseconds,\n     * otherwise it is in milliseconds. Timespans are computed by taking the difference between two\n     * samples.\n     *\n     * Example:\n     * ```typescript\n     * const now = PerformanceTimer.now();\n     * // call some expensive function for which you want to check the duration.\n     * const end = PerformanceTimer.now();\n     * const elapsedTime = end - now;\n     * ```\n     */\n    static now() {\n        return PerformanceTimer.nowFunc();\n    }\n    static getNowFunc() {\n        if (typeof performance !== \"undefined\" && typeof performance.now !== \"undefined\") {\n            return () => performance.now();\n        }\n        // fall back to Date.getTime()\n        return () => {\n            return new Date().getTime();\n        };\n    }\n}\n// tslint:disable-next-line:no-unused-variable\nPerformanceTimer.instance = new PerformanceTimer();\nPerformanceTimer.nowFunc = PerformanceTimer.getNowFunc();\nexports.PerformanceTimer = PerformanceTimer;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction getOptionValue(...values) {\n    for (const candidate of values) {\n        if (candidate !== undefined && candidate !== null) {\n            return candidate;\n        }\n    }\n    return undefined;\n}\nexports.getOptionValue = getOptionValue;\n/**\n * Merge options into existing parameters object.\n *\n * Convenience helper with _similar_ semantics as:\n *\n *     const finalParams1 = { ...defaults, ... options };\n *     const finalParams2 = Object.assign({}, defaults, options);\n *\n * This function doesn't copy _extra_ properties of `options` that doesn't exist in `defaults`.\n * `defaults` is used as _parameters_ template.\n *\n * This doc uses following notion of `option` and `parameter` terms:\n * * `parameter` is a variable, or 'almost constant' of procedure/function/algorith/object\n *    * `parameter` usually have sensible and usually used default\n *    * `parameter` is always defined (no `undefined`, `null` or `?` in type)\n *    * `parameter` can be overriden by specyfying `option` with same name\n * * `option` means value that may be passed optionally, overrides `parameter` value with same name\n *\n * Usage:\n *\n *     interface FooParams {\n *         useTextures: boolean;\n *         opacity: number;\n *     }\n *\n *     const FOO_DEFAULTS: FooParams = {\n *         useTextures: true,\n *         opacity: 0.8\n *     };\n *\n *     type FooOptions = Partial<FooParams>;\n *\n *     function doSomething(options: FooOptions) {\n *         const params = mergeWithOptions(FOO_DEFAULTS, options);\n *             // typeof params === FooParams\n *             // params.opacity = 0.5\n *             // params.useTextures = true\n *             // params.someOtherOptionFromOtherApi is not defined\n *     }\n *     const opt = {opacity: 0.5, someOtherOptionFromOtherApi: 'aaa'};\n *     doSomething(opt);\n *\n * Rationale:\n *   * both `Object.assign` and spread operator copy extra options\n *   * `Object.assign` & `spread operator` may copy `undefined` and `null`s if they really exist\n *     in options object\n *\n * @param parameters parmeters template object holding all expected parameters\n * @param options options object\n * @returns new object with `parameters` overriden by values from `options`\n */\nfunction mergeWithOptions(parameters, options) {\n    // NOTE: `as object` needed due to TypeScript bug:\n    //       https://github.com/Microsoft/TypeScript/issues/14409\n    // tslint:disable-next-line:no-object-literal-type-assertion\n    const result = Object.assign({}, parameters);\n    if (options === undefined || options === null) {\n        return result;\n    }\n    for (const prop in parameters) {\n        if (parameters.hasOwnProperty(prop)) {\n            const optionValue = options[prop];\n            if (optionValue !== undefined && optionValue !== null) {\n                result[prop] = optionValue;\n            }\n        }\n    }\n    return result;\n}\nexports.mergeWithOptions = mergeWithOptions;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Resolves URL using default URL resolver.\n *\n * By default URL resolver is just identity function, it can be changed using\n * [[setDefaultUrlResolver].\n */\nfunction defaultUrlResolver(url) {\n    if (customDefaultUrlResolver !== undefined) {\n        return customDefaultUrlResolver(url);\n    }\n    else {\n        return url;\n    }\n}\nexports.defaultUrlResolver = defaultUrlResolver;\n/**\n * Change resolver used by [[defaultUrlResolver]].\n *\n * `undefined` resets default resolver to identity function.\n *\n * @param resolver\n */\nfunction setDefaultUrlResolver(resolver) {\n    customDefaultUrlResolver = resolver;\n}\nexports.setDefaultUrlResolver = setDefaultUrlResolver;\nlet customDefaultUrlResolver;\n/**\n * Compose URL resolvers.\n *\n * Creates new `UrlResolver` that applies resolvers in orders or arguments.\n *\n * Example:\n *\n *     const themeUrl = ...; // url of parent object\n *     const childUrlResolver = composeUrlResolvers(\n *           (childUrl: string) => resolveReferenceUrl(themeUrl, childUrl),\n *           defaultUrlResolver\n *     );\n */\nfunction composeUrlResolvers(...resolvers) {\n    return (originalUrl) => {\n        return resolvers.reduce((url, resolver) => {\n            if (resolver !== undefined) {\n                return resolver(url);\n            }\n            else {\n                return url;\n            }\n        }, originalUrl);\n    };\n}\nexports.composeUrlResolvers = composeUrlResolvers;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Resolve URL of referenced object.\n *\n * Resolves `childUrl` as it would be loaded from location specified by `parentUrl`.\n *\n * If `childUrl` is absolute, then it is returned unchanged.\n * If `childUrl` is origin-absolute path, then only origin path is taken from `parentUrl`.\n *\n * See [[baseUrl]] for reference how base URL of `parentUrl` is determined.\n *\n * Examples:\n *\n *     // normal case, child is sibling\n *     https://foo.com/themes/day.json + images/foo.png -> https://foo.com/themes/images/foo.png\n *\n *     // parent is \"folder\", so child is just located in this folder\n *     https://foo.com/themes/ + images/foo.png -> https://foo.com/themes/images/foo.png\n *\n *     // parent looks like leaf, so last component is stripped\n *     https://foo.com/themes + images/foo.png -> https://foo.com/images/foo.png\n *\n *     // origin-absolute URL, takes only origin from parent\n *     https://foo.com/themes/day.json + /fonts/foo.json -> https://foo.com/fonts/foo.json\n *\n * @param parentUrl URL of parent resource\n * @param childUrl URL of child as referenced from parent resource\n * @return `childUrl` as if anchored in location of `parentUrl`\n */\nfunction resolveReferenceUrl(parentUrl, childUrl) {\n    if (absoluteUrlWithOriginRe.test(childUrl)) {\n        return childUrl;\n    }\n    else if (childUrl.startsWith(\"/\")) {\n        const origin = getUrlOrigin(parentUrl);\n        return origin + childUrl;\n    }\n    else {\n        if (childUrl.startsWith(\"./\")) {\n            childUrl = childUrl.substr(2);\n        }\n        const parentBaseUrl = baseUrl(parentUrl);\n        return parentBaseUrl + childUrl;\n    }\n}\nexports.resolveReferenceUrl = resolveReferenceUrl;\nconst absoluteUrlWithOriginRe = new RegExp(\"^(?:[a-z]+:)?//\", \"i\");\n/**\n * Returns base URL of given resource URL.\n *\n * `Url` with trailing slash are considered genuine 'locations', they are returned as is, however if\n * `url` ends with name component it is treated as \"leaf\", so last path component is removed.\n *\n * Standalone files (without any folder structure) are considered relative to `./`.\n *\n * Examples:\n * ```\n *     https://foo.com/themes/a.json -> https://foo.com/themes/\n *     https://foo.com/themes/ -> https://foo.com/themes/\n *     https://foo.com/themes -> https://foo.com/ // note, themes is treated as leaf\n *     themes/day.json -> themes/\n *     themes -> ./\n * ```\n */\nfunction baseUrl(url) {\n    if (url === undefined) {\n        return \"./\";\n    }\n    const idx = url.lastIndexOf(\"/\");\n    if (idx === -1) {\n        return \"./\";\n    }\n    else {\n        return url.substring(0, idx + 1);\n    }\n}\nexports.baseUrl = baseUrl;\n/**\n * Get `origin` part of URL.\n *\n * @example\n *    https://example.com/foo -> https://example.com\n *    //example.com:8080/ -> //example.com:8080\n *    file:///etc/hosts ->\n *\n * @param url input URL\n * @return origin of given URL\n */\nfunction getUrlOrigin(url) {\n    if (url === undefined) {\n        return \"\";\n    }\n    const parsed = getUrlHostAndProtocol(url);\n    if (parsed.protocol === \"file:\") {\n        return \"file://\";\n    }\n    else if (parsed.host && parsed.protocol) {\n        return parsed.protocol + \"//\" + parsed.host;\n    }\n    else if (parsed.host) {\n        return \"//\" + parsed.host;\n    }\n    else if (parsed.protocol) {\n        return parsed.protocol + \"//\";\n    }\n    else {\n        return \"\";\n    }\n}\nexports.getUrlOrigin = getUrlOrigin;\n/**\n * Parse `host` and `protocol` part from URL.\n */\nfunction getUrlHostAndProtocol(url) {\n    const urlOriginRe = new RegExp(/^(?:([a-z]+:))?\\/\\/([^\\/]*)/, \"i\");\n    const match = url.match(urlOriginRe);\n    if (!match) {\n        throw new Error(`getUrlHostAndProtocol: unable to parse URL '${url}'`);\n    }\n    return {\n        protocol: match[1],\n        host: match[2]\n    };\n}\nexports.getUrlHostAndProtocol = getUrlHostAndProtocol;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Chains two functions for further assigning as one wrapped callback function\n */\nfunction chainCallbacks(f1, f2) {\n    return function (...args) {\n        if (f1) {\n            f1.apply(this, args);\n        }\n        return f2.apply(this, args);\n    };\n}\nexports.chainCallbacks = chainCallbacks;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Insert shader includes after another shader include.\n *\n * @param shaderContent Original string.\n * @param shaderName String to append to.\n * @param insertedShaderName String to append after string `shaderA`.\n * @param addTab If `true`, a tab character will be inserted before `shaderB`.\n */\nfunction insertShaderInclude(shaderContent, shaderName, insertedShaderName, addTab) {\n    const tabChar = addTab === true ? \"\\t\" : \"\";\n    const result = shaderContent.replace(`#include <${shaderName}>`, `#include <${shaderName}>\n${tabChar}#include <${insertedShaderName}>`);\n    return result;\n}\nexports.insertShaderInclude = insertShaderInclude;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = {\n    extrusion_pars_vertex: `\nuniform float extrusionRatio;\n`,\n    extrusion_vertex: `\ntransformed.z = transformed.z * extrusionRatio;\n`,\n    extrusion_pars_fragment: `\nuniform float extrusionRatio;\n`,\n    extrusion_fragment: `\ngl_FragColor.a *= smoothstep( 0.0, 0.25, extrusionRatio );\n`\n};\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The shader chunks have their lines \"#ifdef USE_FADING\" commented out, because currently the\n * mesh materials use individually created shader strings based on the materials settings.\n * @see [[FadingMeshBasicMaterial]]\n **/\nexports.default = {\n    fading_pars_vertex: `\nvarying float fadingDepth;\n`,\n    fading_vertex: `\nfadingDepth = -mvPosition.z;\n`,\n    fading_pars_fragment: `\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n`,\n    fading_fragment: `\n\n// lerp with \"hard\" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n`\n};\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst AnimatedExtrusionHandler_1 = require(\"../../harp-mapview/lib/AnimatedExtrusionHandler\");\nconst MapMeshMaterials_1 = require(\"./MapMeshMaterials\");\nconst vertexSource = `\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}`;\nconst fragmentSource = `\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}`;\n/**\n * Material designed to render the edges of extruded buildings using GL_LINES. It supports solid\n * colors, vertex colors, color mixing and distance fading.\n */\nclass EdgeMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Constructs a new `EdgeMaterial`.\n     *\n     * @param params `EdgeMaterial` parameters.\n     */\n    constructor(params) {\n        const shaderParams = {\n            name: \"EdgeMaterial\",\n            vertexShader: vertexSource,\n            fragmentShader: fragmentSource,\n            uniforms: {\n                edgeColor: new THREE.Uniform(new THREE.Color(EdgeMaterial.DEFAULT_COLOR)),\n                edgeColorMix: new THREE.Uniform(EdgeMaterial.DEFAULT_COLOR_MIX),\n                fadeNear: new THREE.Uniform(MapMeshMaterials_1.FadingFeature.DEFAULT_FADE_NEAR),\n                fadeFar: new THREE.Uniform(MapMeshMaterials_1.FadingFeature.DEFAULT_FADE_FAR),\n                extrusionRatio: new THREE.Uniform(AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MIN)\n            },\n            depthWrite: false\n        };\n        super(shaderParams);\n        this.transparent = true;\n        MapMeshMaterials_1.FadingFeature.patchGlobalShaderChunks();\n        MapMeshMaterials_1.ExtrusionFeature.patchGlobalShaderChunks();\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.color !== undefined) {\n                this.color.set(params.color);\n            }\n            if (params.colorMix !== undefined) {\n                this.colorMix = params.colorMix;\n            }\n            if (params.fadeNear !== undefined) {\n                this.fadeNear = params.fadeNear;\n            }\n            if (params.fadeFar !== undefined) {\n                this.fadeFar = params.fadeFar;\n            }\n        }\n    }\n    /**\n     * Edge color.\n     */\n    get color() {\n        return this.uniforms.edgeColor.value;\n    }\n    set color(value) {\n        this.uniforms.edgeColor.value = value;\n    }\n    /**\n     * Color mix value. Mixes between vertexColors and edgeColor.\n     */\n    get colorMix() {\n        return this.uniforms.edgeColorMix.value;\n    }\n    set colorMix(value) {\n        this.uniforms.edgeColorMix.value = value;\n        this.updateColorMixFeature();\n    }\n    updateColorMixFeature() {\n        this.defines.USE_COLOR = this.colorMix > 0.0 ? 1 : 0;\n    }\n    get fadeNear() {\n        return this.uniforms.fadeNear.value;\n    }\n    set fadeNear(value) {\n        this.uniforms.fadeNear.value = value;\n    }\n    get fadeFar() {\n        return this.uniforms.fadeFar.value;\n    }\n    set fadeFar(value) {\n        this.uniforms.fadeFar.value = value;\n        const doFade = value !== undefined && value > 0.0;\n        if (doFade) {\n            this.needsUpdate = this.needsUpdate || this.defines.USE_FADING === undefined;\n            this.defines.USE_FADING = \"\";\n        }\n        else {\n            this.needsUpdate = this.needsUpdate || this.defines.USE_FADING !== undefined;\n            delete this.defines.USE_FADING;\n        }\n    }\n    get extrusionRatio() {\n        return this.uniforms.extrusionRatio.value;\n    }\n    set extrusionRatio(value) {\n        this.uniforms.extrusionRatio.value = value;\n        const doExtrusion = value !== undefined && value >= AnimatedExtrusionHandler_1.AnimatedExtrusionTileHandler.DEFAULT_RATIO_MIN;\n        if (doExtrusion) {\n            this.needsUpdate = this.needsUpdate || this.defines.USE_EXTRUSION === undefined;\n            this.defines.USE_EXTRUSION = \"\";\n        }\n        else {\n            this.needsUpdate = this.needsUpdate || this.defines.USE_EXTRUSION !== undefined;\n            delete this.defines.USE_EXTRUSION;\n        }\n    }\n}\nEdgeMaterial.DEFAULT_COLOR = 0x000000;\nEdgeMaterial.DEFAULT_COLOR_MIX = 0.0;\nexports.EdgeMaterial = EdgeMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst LinesChunks_1 = require(\"./ShaderChunks/LinesChunks\");\nconst vertexSource = `\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}`;\nconst fragmentSource = `\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}`;\n/**\n * Material designed to render high precision lines (ideal for position-sensible data).\n */\nclass HighPrecisionLineMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Constructs a new `HighPrecisionLineMaterial`.\n     *\n     * @param params `HighPrecisionLineMaterial` parameters.\n     */\n    constructor(params) {\n        Object.assign(THREE.ShaderChunk, LinesChunks_1.default);\n        const shaderParams = {\n            name: \"HighPrecisionLineMaterial\",\n            vertexShader: vertexSource,\n            fragmentShader: fragmentSource,\n            uniforms: {\n                diffuse: new THREE.Uniform(new THREE.Color(HighPrecisionLineMaterial.DEFAULT_COLOR)),\n                opacity: new THREE.Uniform(HighPrecisionLineMaterial.DEFAULT_OPACITY),\n                u_mvp: new THREE.Uniform(new THREE.Matrix4()),\n                u_eyepos: new THREE.Uniform(new THREE.Vector3()),\n                u_eyepos_lowpart: new THREE.Uniform(new THREE.Vector3())\n            }\n        };\n        Object.assign(shaderParams, params);\n        super(shaderParams);\n        this.type = \"HighPrecisionLineMaterial\";\n        this.isHighPrecisionLineMaterial = true;\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.color !== undefined) {\n                this.color.set(params.color);\n            }\n            if (params.opacity !== undefined) {\n                this.opacity = params.opacity;\n            }\n        }\n        this.updateTransparencyFeature();\n    }\n    /**\n     * Line color.\n     */\n    get color() {\n        return this.uniforms.diffuse.value;\n    }\n    set color(value) {\n        this.uniforms.diffuse.value = value;\n    }\n    updateTransparencyFeature() {\n        this.transparent = this.opacity < 1.0 ? true : false;\n    }\n}\nHighPrecisionLineMaterial.DEFAULT_COLOR = 0x000050;\nHighPrecisionLineMaterial.DEFAULT_OPACITY = 1.0;\nexports.HighPrecisionLineMaterial = HighPrecisionLineMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst LinesChunks_1 = require(\"./ShaderChunks/LinesChunks\");\nconst vertexSource = `\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}`;\n/**\n * Material designed to render high precision points (ideal for position-sensible data).\n */\nclass HighPrecisionPointMaterial extends THREE.PointsMaterial {\n    /**\n     * Constructs a new `HighPrecisionPointMaterial`.\n     *\n     * @param params `HighPrecisionPointMaterial` parameters.\n     */\n    constructor(params) {\n        Object.assign(THREE.ShaderChunk, LinesChunks_1.default);\n        const shaderParams = params;\n        super(shaderParams);\n        this.type = \"HighPrecisionPointMaterial\";\n        this.vertexShader = vertexSource;\n        this.fragmentShader = THREE.ShaderChunk.points_frag;\n        this.fog = false;\n        this.uniforms = {\n            diffuse: new THREE.Uniform(new THREE.Color(HighPrecisionPointMaterial.DEFAULT_COLOR)),\n            opacity: new THREE.Uniform(HighPrecisionPointMaterial.DEFAULT_OPACITY),\n            size: new THREE.Uniform(HighPrecisionPointMaterial.DEFAULT_SIZE),\n            scale: new THREE.Uniform(HighPrecisionPointMaterial.DEFAULT_SCALE),\n            map: new THREE.Uniform(new THREE.Texture()),\n            uvTransform: new THREE.Uniform(new THREE.Matrix3()),\n            u_mvp: new THREE.Uniform(new THREE.Matrix4()),\n            u_eyepos: new THREE.Uniform(new THREE.Vector3()),\n            u_eyepos_lowpart: new THREE.Uniform(new THREE.Vector3())\n        };\n        this.isHighPrecisionPointMaterial = true;\n        // Apply initial parameter values.\n        if (params !== undefined) {\n            if (params.color !== undefined) {\n                this.color.set(params.color);\n            }\n            if (params.opacity !== undefined) {\n                this.opacity = params.opacity;\n            }\n            if (params.size !== undefined) {\n                this.size = params.size;\n            }\n            if (params.scale !== undefined) {\n                this.scale = params.scale;\n            }\n            if (params.uvTransform !== undefined) {\n                this.uvTransform = params.uvTransform;\n            }\n            if (params.map !== undefined) {\n                this.map = params.map;\n            }\n        }\n    }\n    /**\n     *  Point scale.\n     */\n    get scale() {\n        return this.uniforms.scale.value;\n    }\n    set scale(value) {\n        this.uniforms.scale.value = value;\n    }\n    /**\n     * UV transformation matrix.\n     */\n    get uvTransform() {\n        return this.uniforms.uvTransform.value;\n    }\n    set uvTransform(value) {\n        this.uniforms.uvTransform.value = value;\n    }\n}\nHighPrecisionPointMaterial.DEFAULT_COLOR = 0x000050;\nHighPrecisionPointMaterial.DEFAULT_OPACITY = 1.0;\nHighPrecisionPointMaterial.DEFAULT_SIZE = 1.0;\nHighPrecisionPointMaterial.DEFAULT_SCALE = 1.0;\nexports.HighPrecisionPointMaterial = HighPrecisionPointMaterial;\nfunction isHighPrecisionPointMaterial(material) {\n    return (material !== undefined &&\n        material.isHighPrecisionPointMaterial === true);\n}\nexports.isHighPrecisionPointMaterial = isHighPrecisionPointMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst vertexSource = `\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}`;\nconst fragmentSource = `\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor.a;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}`;\n/**\n * 2D material for icons, similar to [[TextMaterial]]. Uses component in texture coordinates to\n * apply opacity.\n */\nclass IconMaterial extends THREE.RawShaderMaterial {\n    /**\n     * Constructs a new `IconMaterial`.\n     *\n     * @param params `IconMaterial` parameters.\n     */\n    constructor(params) {\n        const shaderParams = {\n            name: \"IconMaterial\",\n            vertexShader: vertexSource,\n            fragmentShader: fragmentSource,\n            uniforms: {\n                map: new THREE.Uniform(params.map)\n            },\n            depthTest: true,\n            depthWrite: true,\n            transparent: true,\n            vertexColors: THREE.VertexColors,\n            premultipliedAlpha: true,\n            blending: THREE.NormalBlending\n        };\n        super(shaderParams);\n    }\n    /**\n     * Icon texture map/atlas.\n     */\n    get map() {\n        return this.uniforms.map.value;\n    }\n}\nexports.IconMaterial = IconMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst vertexShader = `\nuniform float size;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n`;\nconst fragmentShader = `\nuniform vec3 diffuse;\n\nvoid main() {\n    float alpha = 1.0;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}`;\nconst DEFAULT_CIRCLE_SIZE = 1;\n/**\n * Material designed to render circle points. Note that it is always transparent since the circle\n * shape is created with an alpha channel to benefit an antialising that a mere `discard` could\n * not bring.\n */\nclass CirclePointsMaterial extends THREE.ShaderMaterial {\n    /**\n     * Constructs a new `CirclePointsMaterial`.\n     *\n     * @param parameters The constructor's parameters.\n     */\n    constructor(parameters = {}) {\n        parameters.depthTest = false;\n        super(parameters);\n        this.isCirclePointsMaterial = true;\n        this.type = \"CirclePointsMaterial\";\n        this.vertexShader = vertexShader;\n        this.fragmentShader = fragmentShader;\n        this.transparent = true;\n        this.m_size = parameters.size || DEFAULT_CIRCLE_SIZE;\n        this.m_color = new THREE.Color();\n        this.uniforms = {\n            diffuse: new THREE.Uniform(this.m_color),\n            size: new THREE.Uniform(this.m_size)\n        };\n        this.extensions.derivatives = true;\n    }\n    /**\n     * Gets the circle screen size.\n     */\n    get size() {\n        return this.m_size;\n    }\n    /**\n     * Sets the circle screen size.\n     */\n    set size(size) {\n        this.m_size = size;\n        this.uniforms.size.value = size;\n        this.needsUpdate = true;\n    }\n    /**\n     * Gets the diffuse.\n     */\n    get color() {\n        return \"#\" + this.m_color.getHexString();\n    }\n    /**\n     * Sets the diffuse.\n     */\n    set color(color) {\n        this.m_color.set(color);\n        this.uniforms.diffuse.value.set(this.m_color);\n        this.needsUpdate = true;\n    }\n}\nexports.CirclePointsMaterial = CirclePointsMaterial;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst THREE = require(\"three\");\nconst CopyMaterial_1 = require(\"./CopyMaterial\");\n/**\n * The material to use for the quad of the [[MSAARenderPass]] in the composing.\n */\nclass MSAAMaterial extends THREE.ShaderMaterial {\n    /**\n     * The constructor of `MSAAMaterial`.\n     *\n     * @param uniforms The [[CopyShader]]'s uniforms.\n     */\n    constructor(uniforms) {\n        super({\n            uniforms,\n            vertexShader: CopyMaterial_1.CopyShader.vertexShader,\n            fragmentShader: CopyMaterial_1.CopyShader.fragmentShader,\n            premultipliedAlpha: true,\n            transparent: true,\n            blending: THREE.AdditiveBlending,\n            depthTest: false,\n            depthWrite: false\n        });\n    }\n}\nexports.MSAAMaterial = MSAAMaterial;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Type guard to assert that `object` conforms to [[GeoCoordinatesLike]] data interface.\n */\nfunction isGeoCoordinatesLike(object) {\n    return (object &&\n        typeof object.latitude === \"number\" &&\n        typeof object.longitude === \"number\" &&\n        (typeof object.altitude === \"number\" || typeof object.altitude === \"undefined\"));\n}\nexports.isGeoCoordinatesLike = isGeoCoordinatesLike;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoBox_1 = require(\"../coordinates/GeoBox\");\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst Box3Like_1 = require(\"../math/Box3Like\");\nconst MathUtils_1 = require(\"../math/MathUtils\");\nconst OrientedBox3Like_1 = require(\"../math/OrientedBox3Like\");\nconst Projection_1 = require(\"./Projection\");\nconst DEG2RAD = Math.PI / 180;\nclass IdentityProjection {\n    constructor() {\n        this.type = Projection_1.ProjectionType.Planar;\n    }\n    getScaleFactor(_worldPoint) {\n        return 1;\n    }\n    worldExtent(minAltitude, maxAltitude, result) {\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        result.min.x = -Math.PI;\n        result.min.y = -Math.PI * 0.5;\n        result.min.z = minAltitude;\n        result.max.x = Math.PI;\n        result.max.y = Math.PI * 0.5;\n        result.max.z = maxAltitude;\n        return result;\n    }\n    projectPoint(geoPoint, result) {\n        if (!result) {\n            // tslint:disable-next-line:no-object-literal-type-assertion\n            result = { x: 0, y: 0, z: 0 };\n        }\n        result.x = geoPoint.longitude * DEG2RAD;\n        result.y = geoPoint.latitude * DEG2RAD;\n        result.z = geoPoint.altitude || 0;\n        return result;\n    }\n    unprojectPoint(worldPoint) {\n        const geoPoint = GeoCoordinates_1.GeoCoordinates.fromRadians(worldPoint.y, worldPoint.x, worldPoint.z);\n        return geoPoint;\n    }\n    projectBox(geoBox, result) {\n        if (!result) {\n            result = MathUtils_1.MathUtils.newEmptyBox3();\n        }\n        const min = this.projectPoint(new GeoCoordinates_1.GeoCoordinates(geoBox.south, geoBox.west, geoBox.minAltitude));\n        const max = this.projectPoint(new GeoCoordinates_1.GeoCoordinates(geoBox.north, geoBox.east, geoBox.maxAltitude));\n        if (Box3Like_1.isBox3Like(result)) {\n            result.min.x = min.x;\n            result.min.y = min.y;\n            result.min.z = min.z;\n            result.max.x = max.x;\n            result.max.y = max.y;\n            result.max.z = max.z;\n        }\n        else if (OrientedBox3Like_1.isOrientedBox3Like(result)) {\n            MathUtils_1.MathUtils.newVector3(1, 0, 0, result.xAxis);\n            MathUtils_1.MathUtils.newVector3(0, 1, 0, result.yAxis);\n            MathUtils_1.MathUtils.newVector3(0, 0, 1, result.zAxis);\n            result.position.x = (min.x + max.x) * 0.5;\n            result.position.y = (min.y + max.y) * 0.5;\n            result.position.z = (min.z + max.z) * 0.5;\n            result.extents.x = (max.x - min.x) * 0.5;\n            result.extents.y = (max.y - min.y) * 0.5;\n            result.extents.z = Math.max(Number.EPSILON, (max.z - min.z) * 0.5);\n        }\n        return result;\n    }\n    unprojectBox(worldBox) {\n        const minGeo = this.unprojectPoint(worldBox.min);\n        const maxGeo = this.unprojectPoint(worldBox.max);\n        return GeoBox_1.GeoBox.fromCoordinates(minGeo, maxGeo);\n    }\n    groundDistance(worldPoint) {\n        return worldPoint.z;\n    }\n    scalePointToSurface(worldPoint) {\n        worldPoint.z = 0;\n        return worldPoint;\n    }\n}\n/**\n * Identity [[Projection]] used to convert geo coordinates to world coordinates and vice versa.\n */\nexports.identityProjection = new IdentityProjection();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GeoCoordinates_1 = require(\"../coordinates/GeoCoordinates\");\nconst Box3Like_1 = require(\"../math/Box3Like\");\nconst MathUtils_1 = require(\"../math/MathUtils\");\nconst OrientedBox3Like_1 = require(\"../math/OrientedBox3Like\");\nconst EarthConstants_1 = require(\"./EarthConstants\");\nconst Projection_1 = require(\"./Projection\");\n/**\n * Transforms the given vector using the provided basis.\n */\nfunction apply(xAxis, yAxis, zAxis, v) {\n    const x = xAxis.x * v.x + yAxis.x * v.y + zAxis.x * v.z;\n    const y = xAxis.y * v.x + yAxis.y * v.y + zAxis.y * v.z;\n    const z = xAxis.z * v.x + yAxis.z * v.y + zAxis.z * v.z;\n    v.x = x;\n    v.y = y;\n    v.z = z;\n    return v;\n}\n/**\n * Returns the quadrants for the given longitude. The quadrant is defined as:\n *  - quadrant(+Math.PI * -1.0) = 0\n *  - quadrant(+Math.PI * -0.5) = 1\n *  - quadrant(+Math.PI *  0.0) = 2\n *  - quadrant(+Math.PI *  0.5) = 3\n *  - quadrant(+Math.PI *  1.0) = 4\n *\n * @param longitude The longitude in radians.\n */\nfunction getLongitudeQuadrant(longitude) {\n    const oneOverPI = 1 / Math.PI;\n    const quadrantIndex = Math.floor(2 * (longitude * oneOverPI + 1));\n    return MathUtils_1.MathUtils.clamp(quadrantIndex, 0, 4);\n}\nfunction lengthOfVector3(worldPoint) {\n    const d = Math.sqrt(worldPoint.x * worldPoint.x + worldPoint.y * worldPoint.y + worldPoint.z * worldPoint.z);\n    return d;\n}\n/**\n * Creates a Box3 enclosing the geobox.\n *\n * @param geoBox Ghe given geobox\n * @param worldBox The resulting axis aligned bounding box.\n */\nfunction makeBox3(geoBox, worldBox) {\n    const halfEquatorialRadius = (EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS + (geoBox.maxAltitude || 0)) * 0.5;\n    const minLongitude = MathUtils_1.MathUtils.degToRad(geoBox.west);\n    const maxLongitude = MathUtils_1.MathUtils.degToRad(geoBox.east);\n    const minLongitudeQuadrant = getLongitudeQuadrant(minLongitude);\n    const maxLongitudeQuadrant = getLongitudeQuadrant(maxLongitude);\n    let xMin = Math.cos(minLongitude);\n    let xMax = xMin;\n    let yMin = Math.sin(minLongitude);\n    let yMax = yMin;\n    for (let quadrantIndex = minLongitudeQuadrant + 1; quadrantIndex <= maxLongitudeQuadrant; quadrantIndex++) {\n        // tslint:disable-next-line: no-bitwise\n        const x = ((quadrantIndex + 1) & 1) * ((quadrantIndex & 2) - 1);\n        xMin = Math.min(x, xMin);\n        xMax = Math.max(x, xMax);\n        // tslint:disable-next-line: no-bitwise\n        const y = (quadrantIndex & 1) * ((quadrantIndex & 2) - 1);\n        yMin = Math.min(y, yMin);\n        yMax = Math.max(y, yMax);\n    }\n    const cosMaxLongitude = Math.cos(maxLongitude);\n    xMin = Math.min(cosMaxLongitude, xMin);\n    xMax = Math.max(cosMaxLongitude, xMax);\n    const sinMaxLongitude = Math.sin(maxLongitude);\n    yMin = Math.min(sinMaxLongitude, yMin);\n    yMax = Math.max(sinMaxLongitude, yMax);\n    const xCenter = (xMax + xMin) * halfEquatorialRadius;\n    const xExtent = (xMax - xMin) * halfEquatorialRadius;\n    const yCenter = (yMax + yMin) * halfEquatorialRadius;\n    const yExtent = (yMax - yMin) * halfEquatorialRadius;\n    // Calculate Z boundaries.\n    const minLatitude = MathUtils_1.MathUtils.degToRad(geoBox.south);\n    const maxLatutide = MathUtils_1.MathUtils.degToRad(geoBox.north);\n    const zMax = Math.sin(maxLatutide);\n    const zMin = Math.sin(minLatitude);\n    const zCenter = (zMax + zMin) * halfEquatorialRadius;\n    const zExtent = (zMax - zMin) * halfEquatorialRadius;\n    worldBox.min.x = xCenter - xExtent;\n    worldBox.min.y = yCenter - yExtent;\n    worldBox.min.z = zCenter - zExtent;\n    worldBox.max.x = xCenter + xExtent;\n    worldBox.max.y = yCenter + yExtent;\n    worldBox.max.z = zCenter + zExtent;\n    return worldBox;\n}\n/**\n * Computes the spherical projection of the given geo coordinates.\n *\n * @param geoPoint The geo coordinates.\n * @param worldpoint The resulting world coordinates.\n */\nfunction project(geoPoint, worldpoint) {\n    const radius = EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS + (geoPoint.altitude || 0);\n    const latitude = MathUtils_1.MathUtils.degToRad(geoPoint.latitude);\n    const longitude = MathUtils_1.MathUtils.degToRad(geoPoint.longitude);\n    const cosLatitude = Math.cos(latitude);\n    worldpoint.x = radius * cosLatitude * Math.cos(longitude);\n    worldpoint.y = radius * cosLatitude * Math.sin(longitude);\n    worldpoint.z = radius * Math.sin(latitude);\n    return worldpoint;\n}\nclass SphereProjection {\n    constructor() {\n        this.type = Projection_1.ProjectionType.Spherical;\n    }\n    worldExtent(_minElevation, maxElevation, result = MathUtils_1.MathUtils.newEmptyBox3()) {\n        const radius = EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS + maxElevation;\n        result.min.x = -radius;\n        result.min.y = -radius;\n        result.min.z = -radius;\n        result.max.x = radius;\n        result.max.y = radius;\n        result.max.z = radius;\n        return result;\n    }\n    projectPoint(geoPoint, result = MathUtils_1.MathUtils.newVector3(0, 0, 0)) {\n        return project(geoPoint, result);\n    }\n    unprojectPoint(point) {\n        const parallelRadiusSq = point.x * point.x + point.y * point.y;\n        const parallelRadius = Math.sqrt(parallelRadiusSq);\n        const v = point.z / parallelRadius;\n        if (isNaN(v)) {\n            return GeoCoordinates_1.GeoCoordinates.fromRadians(0, 0, -EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS);\n        }\n        const radius = Math.sqrt(parallelRadiusSq + point.z * point.z);\n        return GeoCoordinates_1.GeoCoordinates.fromRadians(Math.atan(v), Math.atan2(point.y, point.x), radius - EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS);\n    }\n    projectBox(geoBox, result = MathUtils_1.MathUtils.newEmptyBox3()) {\n        if (Box3Like_1.isBox3Like(result)) {\n            return makeBox3(geoBox, result);\n        }\n        else if (OrientedBox3Like_1.isOrientedBox3Like(result)) {\n            if (geoBox.longitudeSpan >= 90) {\n                const bounds = makeBox3(geoBox, MathUtils_1.MathUtils.newEmptyBox3());\n                MathUtils_1.MathUtils.newVector3(1, 0, 0, result.xAxis);\n                MathUtils_1.MathUtils.newVector3(0, 1, 0, result.yAxis);\n                MathUtils_1.MathUtils.newVector3(0, 0, 1, result.zAxis);\n                result.position.x = (bounds.max.x + bounds.min.x) * 0.5;\n                result.position.y = (bounds.max.y + bounds.min.y) * 0.5;\n                result.position.z = (bounds.max.z + bounds.min.z) * 0.5;\n                result.extents.x = (bounds.max.x - bounds.min.x) * 0.5;\n                result.extents.y = (bounds.max.y - bounds.min.y) * 0.5;\n                result.extents.z = (bounds.max.z - bounds.min.z) * 0.5;\n                return result;\n            }\n            const { south, west, north, east, center: mid } = geoBox;\n            const midX = mid.longitude;\n            const midY = mid.latitude;\n            const cosSouth = Math.cos(MathUtils_1.MathUtils.degToRad(south));\n            const sinSouth = Math.sin(MathUtils_1.MathUtils.degToRad(south));\n            const cosWest = Math.cos(MathUtils_1.MathUtils.degToRad(west));\n            const sinWest = Math.sin(MathUtils_1.MathUtils.degToRad(west));\n            const cosNorth = Math.cos(MathUtils_1.MathUtils.degToRad(north));\n            const sinNorth = Math.sin(MathUtils_1.MathUtils.degToRad(north));\n            const cosEast = Math.cos(MathUtils_1.MathUtils.degToRad(east));\n            const sinEast = Math.sin(MathUtils_1.MathUtils.degToRad(east));\n            const cosMidX = Math.cos(MathUtils_1.MathUtils.degToRad(midX));\n            const sinMidX = Math.sin(MathUtils_1.MathUtils.degToRad(midX));\n            const cosMidY = Math.cos(MathUtils_1.MathUtils.degToRad(midY));\n            const sinMidY = Math.sin(MathUtils_1.MathUtils.degToRad(midY));\n            // Build the orientation of the OBB using the normal vector and its partial derivates.\n            // the sperical coordinates of the mid point of the geobox.\n            MathUtils_1.MathUtils.newVector3(cosMidX * cosMidY, sinMidX * cosMidY, sinMidY, result.zAxis);\n            // the partial derivates of the normal vector.\n            MathUtils_1.MathUtils.newVector3(-sinMidX, cosMidX, 0, result.xAxis);\n            MathUtils_1.MathUtils.newVector3(-cosMidX * sinMidY, -sinMidX * sinMidY, cosMidY, result.yAxis);\n            let width;\n            let minY;\n            let maxY;\n            if (south >= 0) {\n                // abs(dot(southWest - southEast, xAxis))\n                width = Math.abs(cosSouth * (cosMidX * (sinWest - sinEast) + sinMidX * (cosEast - cosWest)));\n                // dot(south, yAxis)\n                minY = cosMidY * sinSouth - sinMidY * cosSouth;\n                // dot(northEast, zAxis)\n                maxY =\n                    cosMidY * sinNorth -\n                        sinMidY * cosNorth * (cosMidX * cosEast + sinMidX * sinEast);\n            }\n            else {\n                if (north <= 0) {\n                    // abs(dot(northWest - northEast, xAxis))\n                    width = Math.abs(cosNorth * (cosMidX * (sinWest - sinEast) + sinMidX * (cosEast - cosWest)));\n                    // dot(north, yAxis)\n                    maxY = cosMidY * sinNorth - sinMidY * cosNorth;\n                }\n                else {\n                    // abs(dot(west - east, xAxis))\n                    width = Math.abs(cosMidX * (sinWest - sinEast) + sinMidX * (cosEast - cosWest));\n                    // dot(northEast, yAxis)\n                    maxY =\n                        cosMidY * sinNorth -\n                            sinMidY * cosNorth * (sinMidX * sinEast + cosMidX * cosEast);\n                }\n                // dot(southEast, yAxis)\n                minY =\n                    cosMidY * sinSouth -\n                        sinMidY * cosSouth * (cosMidX * cosEast + sinMidX * sinEast);\n            }\n            const rMax = (EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS + (geoBox.maxAltitude || 0)) * 0.5;\n            const rMin = (EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS + (geoBox.minAltitude || 0)) * 0.5;\n            // min(dot(southEast, zAxis), dot(northEast, zAxis))\n            const d = cosMidY * (cosMidX * cosEast + sinMidX * sinEast);\n            const minZ = Math.min(cosNorth * d + sinNorth * sinMidY, cosSouth * d + sinSouth * sinMidY);\n            MathUtils_1.MathUtils.newVector3(width * rMax, (maxY - minY) * rMax, rMax - minZ * rMin, result.extents);\n            MathUtils_1.MathUtils.newVector3(0, (minY + maxY) * rMax, rMax + rMax, result.position);\n            apply(result.xAxis, result.yAxis, result.zAxis, result.position);\n            result.position.x = result.position.x - result.zAxis.x * result.extents.z;\n            result.position.y = result.position.y - result.zAxis.y * result.extents.z;\n            result.position.z = result.position.z - result.zAxis.z * result.extents.z;\n            return result;\n        }\n        throw new Error(\"Invalid bounding box\");\n    }\n    unprojectBox(_worldBox) {\n        throw new Error(\"Method not implemented.\");\n    }\n    getScaleFactor(_worldPoint) {\n        return 1;\n    }\n    groundDistance(worldPoint) {\n        return lengthOfVector3(worldPoint) - EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS;\n    }\n    scalePointToSurface(worldPoint) {\n        const scale = EarthConstants_1.EarthConstants.EQUATORIAL_RADIUS / (lengthOfVector3(worldPoint) || 1);\n        worldPoint.x *= scale;\n        worldPoint.y *= scale;\n        worldPoint.z *= scale;\n        return worldPoint;\n    }\n}\nexports.sphereProjection = new SphereProjection();\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst TileKey_1 = require(\"./TileKey\");\n/**\n * A class used to represent a quadtree.\n */\nclass QuadTree {\n    /**\n     * Constructs a new `QuadTree` for the given [[TilingScheme]].\n     *\n     * Example:\n     * ```typescript\n     * const quadTree = new QuadTree(hereTilingScheme);\n     * const geoBox = quadTree.getGeoBox(tileKey);\n     * console.log(geoBox.center);\n     * ```\n     *\n     * @param tilingScheme The TilingScheme used by this `QuadTree`.\n     */\n    constructor(tilingScheme) {\n        this.tilingScheme = tilingScheme;\n    }\n    /**\n     * Visits this `QuadTree` and invoke the given accept method with the current [[TileKey]] and\n     * its bounding box in geo coordinates.\n     *\n     * Example:\n     * ```typescript\n     * const geoPos = new GeoCoordinates(latitude, longitude);\n     * const quadTree = new QuadTree(hereTilingScheme);\n     * quadTree.visit((tileKey, geoBox) => {\n     *     if (geoBox.contains(geoPos)) {\n     *         console.log(\"tile\", tileKey, \"contains\", geoPos);\n     *         return tileKey.level < 14; // stop visiting the quadtree if the level is >= 14.\n     *     }\n     *     return false; // stop visiting the quadtree,\n     *                   // the tile's geoBox doesn't contain the given coordinates.\n     * });\n     * ```\n     *\n     * @param accept A function that takes a [[TileKey]] and its bounding box in geo coordinates and\n     * returns `true` if the visit of the `QuadTree` should continue; otherwise `false`.\n     */\n    visit(accept) {\n        this.visitTileKey(TileKey_1.TileKey.fromRowColumnLevel(0, 0, 0), accept);\n    }\n    /**\n     * Visits the subtree starting from the given tile.\n     *\n     * @param tileKey The root of the subtree that should be visited.\n     * @param accept A function that takes a [[TileKey]] and its bounding box in geo coordinates and\n     * returns `true` if the visit of the `QuadTree` should continue; otherwise `false`.\n     */\n    visitTileKey(tileKey, accept) {\n        const geoBox = this.tilingScheme.getGeoBox(tileKey);\n        if (!accept(tileKey, geoBox)) {\n            return;\n        }\n        for (const subTileKey of this.tilingScheme.getSubTileKeys(tileKey)) {\n            this.visitTileKey(subTileKey, accept);\n        }\n    }\n}\nexports.QuadTree = QuadTree;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst EquirectangularProjection_1 = require(\"../projection/EquirectangularProjection\");\nconst HalfQuadTreeSubdivisionScheme_1 = require(\"./HalfQuadTreeSubdivisionScheme\");\nconst TilingScheme_1 = require(\"./TilingScheme\");\n/**\n * [[TilingScheme]] used by most of the data published by HERE.\n *\n * The `hereTilingScheme` features a half quadtree subdivision scheme and an equirectangular\n * projection.\n */\nexports.hereTilingScheme = new TilingScheme_1.TilingScheme(HalfQuadTreeSubdivisionScheme_1.halfQuadTreeSubdivisionScheme, EquirectangularProjection_1.equirectangularProjection);\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst WebMercatorProjection_1 = require(\"../projection/WebMercatorProjection\");\nconst QuadTreeSubdivisionScheme_1 = require(\"./QuadTreeSubdivisionScheme\");\nconst TilingScheme_1 = require(\"./TilingScheme\");\n/**\n * A [[TilingScheme]] featuring quadtree subdivision scheme and web Mercator projection.\n */\nexports.webMercatorTilingScheme = new TilingScheme_1.TilingScheme(QuadTreeSubdivisionScheme_1.quadTreeSubdivisionScheme, WebMercatorProjection_1.webMercatorProjection);\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst MercatorProjection_1 = require(\"../projection/MercatorProjection\");\nconst QuadTreeSubdivisionScheme_1 = require(\"./QuadTreeSubdivisionScheme\");\nconst TilingScheme_1 = require(\"./TilingScheme\");\n/**\n * The [[TilingScheme]] used by the HERE web tiles.\n *\n * The `mercatorTilingScheme` features a quadtree subdivision scheme and a Mercator projection.\n */\nexports.mercatorTilingScheme = new TilingScheme_1.TilingScheme(QuadTreeSubdivisionScheme_1.quadTreeSubdivisionScheme, MercatorProjection_1.mercatorProjection);\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isVector3Like(v) {\n    return v && typeof v.x === \"number\" && typeof v.y === \"number\" && typeof v.z === \"number\";\n}\nexports.isVector3Like = isVector3Like;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst TechniqueParams_1 = require(\"./TechniqueParams\");\n/**\n * Names of the supported texure properties.\n */\nexports.TEXTURE_PROPERTY_KEYS = [\n    \"map\",\n    \"normalMap\",\n    \"displacementMap\",\n    \"roughnessMap\",\n    \"emissiveMap\",\n    \"alphaMap\",\n    \"metalnessMap\",\n    \"bumpMap\"\n];\n/**\n * Type guard to check if an object is an instance of [[CirclesTechnique]].\n */\nfunction isCirclesTechnique(technique) {\n    return technique.name === \"circles\";\n}\nexports.isCirclesTechnique = isCirclesTechnique;\n/**\n * Type guard to check if an object is an instance of [[SquaresTechnique]].\n */\nfunction isSquaresTechnique(technique) {\n    return technique.name === \"squares\";\n}\nexports.isSquaresTechnique = isSquaresTechnique;\n/**\n * Type guard to check if an object is an instance of [[PoiTechnique]].\n */\nfunction isPoiTechnique(technique) {\n    return technique.name === \"labeled-icon\";\n}\nexports.isPoiTechnique = isPoiTechnique;\n/**\n * Type guard to check if an object is an instance of [[LineMarkerTechnique]].\n */\nfunction isLineMarkerTechnique(technique) {\n    return technique.name === \"line-marker\";\n}\nexports.isLineMarkerTechnique = isLineMarkerTechnique;\n/**\n * Type guard to check if an object is an instance of [[DashedLineTechnique]].\n */\nfunction isDashedLineTechnique(technique) {\n    return technique.name === \"dashed-line\";\n}\nexports.isDashedLineTechnique = isDashedLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[LineTechnique]].\n */\nfunction isLineTechnique(technique) {\n    return technique.name === \"line\";\n}\nexports.isLineTechnique = isLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[SolidLineTechnique]].\n */\nfunction isSolidLineTechnique(technique) {\n    return technique.name === \"solid-line\";\n}\nexports.isSolidLineTechnique = isSolidLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[SegmentsTechnique]].\n */\nfunction isSegmentsTechnique(technique) {\n    return technique.name === \"segments\";\n}\nexports.isSegmentsTechnique = isSegmentsTechnique;\n/**\n * Type guard to check if an object is an instance of [[BasicExtrudedLineTechnique]]\n * or [[StandardExtrudedLineTechnique]].\n */\nfunction isExtrudedLineTechnique(technique) {\n    return technique.name === \"extruded-line\";\n}\nexports.isExtrudedLineTechnique = isExtrudedLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[BasicExtrudedLineTechnique]].\n */\nfunction isBasicExtrudedLineTechnique(technique) {\n    return isExtrudedLineTechnique(technique) && technique.shading === \"basic\";\n}\nexports.isBasicExtrudedLineTechnique = isBasicExtrudedLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[StandardExtrudedLineTechnique]].\n */\nfunction isStandardExtrudedLineTechnique(technique) {\n    return isExtrudedLineTechnique(technique) && technique.shading === \"standard\";\n}\nexports.isStandardExtrudedLineTechnique = isStandardExtrudedLineTechnique;\n/**\n * Type guard to check if an object is an instance of [[FillTechnique]].\n */\nfunction isFillTechnique(technique) {\n    return technique.name === \"fill\";\n}\nexports.isFillTechnique = isFillTechnique;\n/**\n * Type guard to check if an object is an instance of [[ExtrudedPolygonTechnique]].\n */\nfunction isExtrudedPolygonTechnique(technique) {\n    return technique.name === \"extruded-polygon\";\n}\nexports.isExtrudedPolygonTechnique = isExtrudedPolygonTechnique;\n/**\n * Type guard to check if an object is an instance of [[StandardTechnique]].\n */\nfunction isStandardTechnique(technique) {\n    return technique.name === \"standard\";\n}\nexports.isStandardTechnique = isStandardTechnique;\n/**\n * Type guard to check if an object is an instance of [[TerrainTechnique]].\n */\nfunction isTerrainTechnique(technique) {\n    return technique.name === \"terrain\";\n}\nexports.isTerrainTechnique = isTerrainTechnique;\n/**\n * Type guard to check if an object is an instance of [[TextTechnique]].\n */\nfunction isTextTechnique(technique) {\n    return technique.name === \"text\";\n}\nexports.isTextTechnique = isTextTechnique;\n/**\n * Type guard to check if an object is an instance of [[ShaderTechnique]].\n */\nfunction isShaderTechnique(technique) {\n    return technique.name === \"shader\";\n}\nexports.isShaderTechnique = isShaderTechnique;\n/**\n * Check if vertex normals should be generated for this technique (if no normals are in the data).\n * @param technique Technique to check.\n */\nfunction needsVertexNormals(technique) {\n    return (isStandardTechnique(technique) ||\n        isTerrainTechnique(technique) ||\n        isStandardExtrudedLineTechnique(technique));\n}\nexports.needsVertexNormals = needsVertexNormals;\n/**\n * Get the texture coordinate type if the technique supports it.\n */\nfunction textureCoordinateType(technique) {\n    if (isStandardTechnique(technique)) {\n        return technique.textureCoordinateType;\n    }\n    else if (isExtrudedPolygonTechnique(technique)) {\n        return technique.textureCoordinateType;\n    }\n    else if (isTerrainTechnique(technique)) {\n        return technique.textureCoordinateType;\n    }\n    else {\n        return undefined;\n    }\n}\nexports.textureCoordinateType = textureCoordinateType;\n/**\n * Add all the buffers of the technique to the transfer list.\n */\nfunction addBuffersToTransferList(technique, transferList = []) {\n    if (isStandardTechnique(technique) ||\n        isExtrudedPolygonTechnique(technique) ||\n        isTerrainTechnique(technique)) {\n        for (const texturePropertyKey of exports.TEXTURE_PROPERTY_KEYS) {\n            const textureProperty = technique[texturePropertyKey];\n            if (TechniqueParams_1.isTextureBuffer(textureProperty)) {\n                transferList.push(textureProperty.buffer);\n            }\n        }\n    }\n}\nexports.addBuffersToTransferList = addBuffersToTransferList;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Common communication protocol for [[WorkerService]].\n */\nvar WorkerServiceProtocol;\n(function (WorkerServiceProtocol) {\n    /**\n     * Service id of worker manager ([[WorkerServiceManager]]) used to create/destroy service\n     * instances in workers.\n     */\n    WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID = \"worker-service-manager\";\n    /**\n     * Define possible names of messages exchanged with services within `WebWorker`.\n     */\n    let ServiceMessageName;\n    (function (ServiceMessageName) {\n        ServiceMessageName[\"Initialized\"] = \"initialized\";\n        ServiceMessageName[\"Request\"] = \"request\";\n        ServiceMessageName[\"Response\"] = \"response\";\n    })(ServiceMessageName = WorkerServiceProtocol.ServiceMessageName || (WorkerServiceProtocol.ServiceMessageName = {}));\n    /**\n     * Type guard to check if an object is a signal message from worker.\n     */\n    function isInitializedMessage(message) {\n        return (message &&\n            typeof message.service === \"string\" &&\n            typeof message.type === \"string\" &&\n            message.type === ServiceMessageName.Initialized);\n    }\n    WorkerServiceProtocol.isInitializedMessage = isInitializedMessage;\n    /**\n     * Define possible names of requests called on services within `WebWorker`.\n     */\n    let Requests;\n    (function (Requests) {\n        Requests[\"CreateService\"] = \"create-service\";\n        Requests[\"DestroyService\"] = \"destroy-service\";\n    })(Requests = WorkerServiceProtocol.Requests || (WorkerServiceProtocol.Requests = {}));\n    /**\n     * Type guard to check if an object is a request message sent to a worker.\n     */\n    function isRequestMessage(message) {\n        return (message &&\n            typeof message.service === \"string\" &&\n            typeof message.type === \"string\" &&\n            message.type === ServiceMessageName.Request);\n    }\n    WorkerServiceProtocol.isRequestMessage = isRequestMessage;\n    /**\n     * Type guard to check if an object is a request message sent to a worker.\n     */\n    function isResponseMessage(message) {\n        return (message &&\n            typeof message.service === \"string\" &&\n            typeof message.type === \"string\" &&\n            message.type === ServiceMessageName.Response);\n    }\n    WorkerServiceProtocol.isResponseMessage = isResponseMessage;\n})(WorkerServiceProtocol = exports.WorkerServiceProtocol || (exports.WorkerServiceProtocol = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Communication protocol with [[ITiler]].\n */\nvar WorkerTilerProtocol;\n(function (WorkerTilerProtocol) {\n    /**\n     * Define possible names of requests called on tiler services within `WebWorker`.\n     */\n    let Requests;\n    (function (Requests) {\n        Requests[\"RegisterIndex\"] = \"register-index\";\n        Requests[\"TileRequest\"] = \"tile-request\";\n    })(Requests = WorkerTilerProtocol.Requests || (WorkerTilerProtocol.Requests = {}));\n    /**\n     * Type guard to check if an object is an index registration request sent to a worker.\n     */\n    function isRegisterIndexRequest(message) {\n        return (message && typeof message.type === \"string\" && message.type === Requests.RegisterIndex);\n    }\n    WorkerTilerProtocol.isRegisterIndexRequest = isRegisterIndexRequest;\n    /**\n     * Type guard to check if an object is a tile request sent to a worker.\n     */\n    function isTileRequest(message) {\n        return message && typeof message.type === \"string\" && message.type === Requests.TileRequest;\n    }\n    WorkerTilerProtocol.isTileRequest = isTileRequest;\n})(WorkerTilerProtocol = exports.WorkerTilerProtocol || (exports.WorkerTilerProtocol = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Allows to cancel and prioritize requests inside the requestQueue. Useful to optimize the order of\n * decoding tiles during animations and camera movements.\n *\n * `RequestController` is not extending [[AbortController]], because this is not supported in ES5.\n */\nclass RequestController {\n    /**\n     * Creates an instance of `RequestController`.\n     *\n     * @param {number} priority\n     * @param {AbortController} abortController Optional [[AbortController]] used internally, since\n     *      [[AbortController]]s should not be subclassed.\n     */\n    constructor(priority = 0, abortController = new AbortController()) {\n        this.priority = priority;\n        this.abortController = abortController;\n    }\n    get signal() {\n        return this.abortController.signal;\n    }\n    /**\n     * Invoking this method will set this object's AbortSignal's aborted flag and\n     * signal to any observers that the associated activity is to be aborted.\n     */\n    abort() {\n        this.abortController.abort();\n    }\n}\nexports.RequestController = RequestController;\n/**\n * Communication protocol with [[ITileDecoder]].\n */\nvar WorkerDecoderProtocol;\n(function (WorkerDecoderProtocol) {\n    /**\n     * Define possible names of messages exchanged with decoder services within `WebWorker`.\n     */\n    let DecoderMessageName;\n    (function (DecoderMessageName) {\n        DecoderMessageName[\"Configuration\"] = \"configuration\";\n    })(DecoderMessageName = WorkerDecoderProtocol.DecoderMessageName || (WorkerDecoderProtocol.DecoderMessageName = {}));\n    /**\n     * Type guard to check if an object is an instance of `ConfigurationMessage`.\n     */\n    function isConfigurationMessage(message) {\n        return (message &&\n            typeof message.service === \"string\" &&\n            typeof message.type === \"string\" &&\n            message.type === DecoderMessageName.Configuration);\n    }\n    WorkerDecoderProtocol.isConfigurationMessage = isConfigurationMessage;\n    /**\n     * Define possible names of requests called on decoder services within `WebWorker`.\n     */\n    let Requests;\n    (function (Requests) {\n        Requests[\"DecodeTileRequest\"] = \"decode-tile-request\";\n        Requests[\"TileInfoRequest\"] = \"tile-info-request\";\n    })(Requests = WorkerDecoderProtocol.Requests || (WorkerDecoderProtocol.Requests = {}));\n    /**\n     * Type guard to check if an object is a decoded tile object sent to a worker.\n     */\n    function isDecodeTileRequest(message) {\n        return (message &&\n            typeof message.type === \"string\" &&\n            message.type === Requests.DecodeTileRequest);\n    }\n    WorkerDecoderProtocol.isDecodeTileRequest = isDecodeTileRequest;\n    /**\n     * Type guard to check if an object is an info tile object sent to a worker.\n     */\n    function isTileInfoRequest(message) {\n        return (message && typeof message.type === \"string\" && message.type === Requests.TileInfoRequest);\n    }\n    WorkerDecoderProtocol.isTileInfoRequest = isTileInfoRequest;\n})(WorkerDecoderProtocol = exports.WorkerDecoderProtocol || (exports.WorkerDecoderProtocol = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\n/**\n * Returns an array with the data type specified as parameter.\n *\n * @param attr specifies which type of data is being stored in the array\n */\nfunction getArrayConstructor(attr) {\n    switch (attr) {\n        case \"float\":\n            return Float32Array;\n        case \"uint16\":\n            return Uint16Array;\n        case \"uint32\":\n            return Uint32Array;\n    }\n}\nexports.getArrayConstructor = getArrayConstructor;\n/**\n * Geometry types supported by [[Geometry]] objects.\n */\nvar GeometryType;\n(function (GeometryType) {\n    GeometryType[GeometryType[\"Unspecified\"] = 0] = \"Unspecified\";\n    GeometryType[GeometryType[\"Point\"] = 1] = \"Point\";\n    GeometryType[GeometryType[\"Line\"] = 2] = \"Line\";\n    GeometryType[GeometryType[\"SolidLine\"] = 3] = \"SolidLine\";\n    GeometryType[GeometryType[\"Text\"] = 4] = \"Text\";\n    GeometryType[GeometryType[\"TextPath\"] = 5] = \"TextPath\";\n    GeometryType[GeometryType[\"ExtrudedLine\"] = 6] = \"ExtrudedLine\";\n    GeometryType[GeometryType[\"Polygon\"] = 7] = \"Polygon\";\n    GeometryType[GeometryType[\"ExtrudedPolygon\"] = 8] = \"ExtrudedPolygon\";\n    GeometryType[GeometryType[\"Object3D\"] = 9] = \"Object3D\";\n    GeometryType[GeometryType[\"Other\"] = 1000] = \"Other\";\n})(GeometryType = exports.GeometryType || (exports.GeometryType = {}));\n/**\n * Returns the projection object specified in the parameter.\n *\n * @param projectionName string describing projection to be used\n */\nfunction getProjection(projectionName) {\n    switch (projectionName) {\n        case \"mercator\":\n            return harp_geoutils_1.mercatorProjection;\n        case \"webMercator\":\n            return harp_geoutils_1.webMercatorProjection;\n        case \"sphere\":\n            return harp_geoutils_1.sphereProjection;\n        default:\n            throw new Error(`Unknown projection ${projectionName}`);\n    } // switch\n}\nexports.getProjection = getProjection;\n/**\n * String with the projection's name.\n *\n * @param projection `Projection` object containing the name of the projection to retrieve\n */\nfunction getProjectionName(projection) {\n    if (projection === harp_geoutils_1.mercatorProjection) {\n        return \"mercator\";\n    }\n    else if (projection === harp_geoutils_1.webMercatorProjection) {\n        return \"webMercator\";\n    }\n    else if (projection === harp_geoutils_1.sphereProjection) {\n        return \"sphere\";\n    }\n    throw new Error(\"Unknown projection\");\n}\nexports.getProjectionName = getProjectionName;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\n/**\n * Minimum estimated size of a JS object.\n */\nconst MINIMUM_OBJECT_SIZE_ESTIMATION = 100;\n/**\n * Structure of arrays containing data for all features of this group. No methods, since the object\n * is being passed as part of ExtendedTileInfo across \"process boundaries\" to the web worker.\n *\n * Supporting methods in namespace [[ExtendedTileInfo]].\n */\nclass FeatureGroup {\n    /**\n     * Construct featureGroup.\n     *\n     * @param storeExtendedTags Pass `true` to create fields for more OMV tags (`layer`, `class`\n     * and `type`).\n     */\n    constructor(storeExtendedTags, startSize = 5000) {\n        /** featureIds */\n        this.featureIds = new Array();\n        /** number of features */\n        this.numFeatures = 0;\n        /** number of positions of elements (2 per point) */\n        this.numPositions = 0;\n        this.featureIds = new Array(startSize);\n        this.featureIds.length = startSize;\n        this.techniqueIndex = new Array(startSize);\n        this.techniqueIndex.length = startSize;\n        this.textIndex = new Array(startSize);\n        this.textIndex.length = startSize;\n        this.positionIndex = new Array(startSize);\n        this.positionIndex.length = startSize;\n        this.positions = new Array(10 * startSize);\n        this.positions.length = 10 * startSize;\n        if (storeExtendedTags) {\n            this.layerIndex = new Array(startSize);\n            this.layerIndex.length = startSize;\n            this.classIndex = new Array(startSize);\n            this.classIndex.length = startSize;\n            this.typeIndex = new Array(startSize);\n            this.typeIndex.length = startSize;\n        }\n    }\n    /**\n     * Compute size in bytes.\n     */\n    getNumBytes() {\n        return ((this.featureIds.length +\n            this.techniqueIndex.length +\n            this.textIndex.length +\n            this.positionIndex.length +\n            this.positions.length +\n            (this.layerIndex !== undefined ? this.layerIndex.length : 0) +\n            (this.classIndex !== undefined ? this.classIndex.length : 0) +\n            (this.typeIndex !== undefined ? this.typeIndex.length : 0)) *\n            8);\n    }\n}\nexports.FeatureGroup = FeatureGroup;\n/**\n * Structure of arrays containing data for roads. No methods, since the object is being passed as\n * part of [[ExtendedTileInfo]] across \"process boundaries\" to the web worker.\n */\nclass LineFeatureGroup extends FeatureGroup {\n    constructor() {\n        super(...arguments);\n        /**\n         * An array of object defined by the user. Certain elements may be `undefined` (if this line\n         * feature is not a road, or if the object for that feature is undefined).\n         */\n        this.userData = [];\n    }\n    getNumBytes() {\n        return (super.getNumBytes() +\n            ((this.segmentIds !== undefined ? this.segmentIds.length : 0) +\n                (this.segmentStartOffsets !== undefined ? this.segmentStartOffsets.length : 0) +\n                (this.segmentEndOffsets !== undefined ? this.segmentEndOffsets.length : 0)) *\n                8);\n    }\n}\nexports.LineFeatureGroup = LineFeatureGroup;\n/**\n * Structure of arrays containing data for polygons. No methods, since the object is being passed as\n * part of ExtendedTileInfo across \"process boundaries\" to the web worker.\n *\n * Supporting methods in namespace [[ExtendedTileInfo]].\n *\n * Due to the complexity of the access, there are supporting classes to store and access data in\n * the feature groups. See [[ExtendedTileInfoWriter]] and [[ExtendedTileInfoPolygonAccessor]].\n */\nclass PolygonFeatureGroup extends FeatureGroup {\n    constructor(storeExtendedTags, startSize = 5000) {\n        super(storeExtendedTags, startSize);\n        /**\n         * Number of rings stored in all polygons in tis group. Used to keep size of the\n         * arrays.\n         */\n        this.groupNumRings = 0;\n        this.outerRingStartIndex = new Array(startSize);\n        this.outerRingStartIndex.length = startSize;\n        this.innerRingIsOuterContour = new Array(startSize);\n        this.innerRingIsOuterContour.length = startSize;\n        this.innerRingStartIndex = new Array(startSize);\n        this.innerRingStartIndex.length = startSize;\n    }\n    getNumBytes() {\n        return (super.getNumBytes() +\n            ((this.outerRingStartIndex !== undefined ? this.outerRingStartIndex.length : 0) +\n                (this.innerRingIsOuterContour !== undefined\n                    ? this.innerRingIsOuterContour.length\n                    : 0) +\n                (this.innerRingStartIndex !== undefined ? this.innerRingStartIndex.length : 0)) *\n                8);\n    }\n}\nexports.PolygonFeatureGroup = PolygonFeatureGroup;\n/**\n * Class to hold infos from [[OmvTile]]s. Optimized for fast serialization when being passed from\n * webworker to main thread. No methods, since the object is being passed across \"process\n * boundaries\" to the web worker.\n *\n * Supporting methods in namespace [[ExtendedTileInfo]].\n *\n * Due to the complexity of the access, there are supporting classes to store and access data in\n * the feature groups. See [[ExtendedTileInfoWriter]] and [[ExtendedTileInfoPolygonAccessor]].\n */\nclass ExtendedTileInfo {\n    constructor(tileKey, storeExtendedTags) {\n        this.tileKey = tileKey;\n        /**\n         * Catalog of strings. Addressed by every features stringIndex.\n         */\n        this.textCatalog = new Array();\n        /**\n         * Catalog of techniques. Addressed by every features featureIndex.\n         */\n        this.techniqueCatalog = new Array();\n        /**\n         * Used for performance diagnostics.\n         */\n        this.setupTime = 0;\n        /**\n         * Size in bytes.\n         */\n        this.numBytes = 0;\n        this.pointGroup = new FeatureGroup(storeExtendedTags);\n        this.lineGroup = new LineFeatureGroup(storeExtendedTags);\n        this.polygonGroup = new PolygonFeatureGroup(storeExtendedTags);\n        if (storeExtendedTags) {\n            this.layerCatalog = new Array();\n            this.classCatalog = new Array();\n            this.typeCatalog = new Array();\n        }\n    }\n    /**\n     * Compute the memory footprint caused by objects owned by the `ExtendedTileInfo`.\n     */\n    getNumBytes() {\n        let numBytes = MINIMUM_OBJECT_SIZE_ESTIMATION;\n        for (const str of this.textCatalog) {\n            numBytes += 2 * str.length;\n        }\n        numBytes += this.techniqueCatalog.length * MINIMUM_OBJECT_SIZE_ESTIMATION;\n        numBytes += this.pointGroup.getNumBytes();\n        numBytes += this.lineGroup.getNumBytes();\n        numBytes += this.polygonGroup.getNumBytes();\n        if (this.layerCatalog !== undefined) {\n            for (const str of this.layerCatalog) {\n                numBytes += 2 * str.length;\n            }\n            for (const str of this.classCatalog) {\n                numBytes += 2 * str.length;\n            }\n            for (const str of this.typeCatalog) {\n                numBytes += 2 * str.length;\n            }\n        }\n        return numBytes;\n    }\n}\nexports.ExtendedTileInfo = ExtendedTileInfo;\n(function (ExtendedTileInfo) {\n    function finishFeatureGroup(featureGroup) {\n        featureGroup.featureIds.length = featureGroup.numFeatures;\n        featureGroup.techniqueIndex.length = featureGroup.numFeatures;\n        featureGroup.textIndex.length = featureGroup.numFeatures;\n        featureGroup.positionIndex.length = featureGroup.numFeatures;\n        featureGroup.positions.length = featureGroup.numPositions;\n        if (featureGroup.layerIndex !== undefined) {\n            featureGroup.layerIndex.length = featureGroup.numFeatures;\n        }\n        if (featureGroup.classIndex !== undefined) {\n            featureGroup.classIndex.length = featureGroup.numFeatures;\n        }\n        if (featureGroup.typeIndex !== undefined) {\n            featureGroup.typeIndex.length = featureGroup.numFeatures;\n        }\n    }\n    function finishPolygonFeatureGroup(polygonGroup) {\n        finishFeatureGroup(polygonGroup);\n        polygonGroup.outerRingStartIndex.length = polygonGroup.numFeatures;\n        polygonGroup.innerRingIsOuterContour.length = polygonGroup.groupNumRings;\n        polygonGroup.innerRingStartIndex.length = polygonGroup.groupNumRings;\n    }\n    function finishLineFeatureGroup(lineGroup) {\n        finishFeatureGroup(lineGroup);\n        if (lineGroup.segmentIds !== undefined) {\n            lineGroup.segmentIds.length = lineGroup.numFeatures;\n            lineGroup.segmentStartOffsets.length = lineGroup.numFeatures;\n            lineGroup.segmentEndOffsets.length = lineGroup.numFeatures;\n        }\n    }\n    /**\n     * Finalize the tile's features groups.\n     */\n    function finish(tileInfo) {\n        finishFeatureGroup(tileInfo.pointGroup);\n        finishLineFeatureGroup(tileInfo.lineGroup);\n        finishPolygonFeatureGroup(tileInfo.polygonGroup);\n        tileInfo.numBytes = tileInfo.getNumBytes();\n    }\n    ExtendedTileInfo.finish = finish;\n    /**\n     * Returns the number of features in this feature group.\n     */\n    function featureGroupSize(featureGroup) {\n        return featureGroup.numFeatures;\n    }\n    ExtendedTileInfo.featureGroupSize = featureGroupSize;\n    /**\n     * Check if the feature group is finalized.\n     */\n    function featureGroupFinished(featureGroup) {\n        return featureGroup.numPositions === featureGroup.positions.length;\n    }\n    ExtendedTileInfo.featureGroupFinished = featureGroupFinished;\n    /**\n     * Check if the tileInfo is finalized.\n     */\n    function tileInfoFinished(tileInfo) {\n        return (featureGroupFinished(tileInfo.pointGroup) &&\n            featureGroupFinished(tileInfo.lineGroup) &&\n            featureGroupFinished(tileInfo.polygonGroup));\n    }\n    ExtendedTileInfo.tileInfoFinished = tileInfoFinished;\n    /**\n     * Determine the text string of the (OMV) feature. It implements the special handling required\n     * to determine the text content of a feature from its tags, which are passed in as the `env`.\n     *\n     * @param env Environment containing the tags from the (OMV) feature.\n     * @param useAbbreviation `true` to use the abbreviation if available.\n     * @param useIsoCode `true` to use the tag \"iso_code\".\n     * @param languages List of languages to use, for example: Specify \"en\" to use the tag \"name_en\"\n     *                  as the text of the string. Order reflects priority.\n     */\n    function getFeatureName(env, useAbbreviation, useIsoCode, languages) {\n        let name;\n        if (useAbbreviation) {\n            const abbreviation = env.lookup(`name:short`);\n            if (typeof abbreviation === \"string\" && abbreviation.length > 0) {\n                return abbreviation;\n            }\n        }\n        if (useIsoCode) {\n            const isoCode = env.lookup(`iso_code`);\n            if (typeof isoCode === \"string\" && isoCode.length > 0) {\n                return isoCode;\n            }\n        }\n        if (languages !== undefined) {\n            for (const lang of languages) {\n                name = env.lookup(`name:${lang}`) || env.lookup(`name_${lang}`);\n                if (typeof name === \"string\" && name.length > 0) {\n                    return name;\n                }\n            }\n        }\n        name = env.lookup(\"name\");\n        if (typeof name === \"string\") {\n            return name;\n        }\n        return undefined;\n    }\n    ExtendedTileInfo.getFeatureName = getFeatureName;\n})(ExtendedTileInfo = exports.ExtendedTileInfo || (exports.ExtendedTileInfo = {}));\n/**\n * Support class for [[ExtendedTileInfo]]. Assist in filling it with data.\n */\nclass ExtendedTileInfoWriter {\n    /**\n     * Create an [[ExtendedTileInfoWriter]] for an [[ExtendedTileInfo]]. Assist in filling the\n     * [[ExtendedTileInfo]] with data.\n     *\n     * @param tileInfo [[ExtendedTileInfo]] to write data to.\n     * @param storeExtendedTags Pass `true` if feature data like `layer`, `class`or `type` should\n     *          be stored for every feature.\n     */\n    constructor(tileInfo, storeExtendedTags, languages) {\n        this.tileInfo = tileInfo;\n        this.storeExtendedTags = storeExtendedTags;\n        this.languages = languages;\n        /** Map to identify which techniques already have been added to the [[ExtendedTileInfo]]. */\n        this.techniqueIndexMap = new Map();\n        /** Map to identify which strings already have been added to the [[ExtendedTileInfo]]. */\n        this.stringMap = new Map();\n        /** Map to identify which `layer` names already have been added to the [[ExtendedTileInfo]]. */\n        this.layerMap = new Map();\n        /** Map to identify which `class` names already have been added to the [[ExtendedTileInfo]]. */\n        this.classMap = new Map();\n        /** Map to identify which `type` names already have been added to the [[ExtendedTileInfo]]. */\n        this.typeMap = new Map();\n    }\n    /**\n     * Adds a [[Technique]] to the catalog of techniques. Individual techniques have a `_index` file\n     * which has been created in the [[StyleSetEvaluator]]. This index is required to identify a\n     * technique. The `Map` is used to map techniques to already added techniques, or store the\n     * technique as new, and add it to the map.\n     *\n     * @param technique The [[Technique]] to add.\n     */\n    addTechnique(technique) {\n        let infoTileTechniqueIndex = this.techniqueIndexMap.get(technique._index);\n        if (infoTileTechniqueIndex !== undefined) {\n            return infoTileTechniqueIndex;\n        }\n        infoTileTechniqueIndex = this.tileInfo.techniqueCatalog.length;\n        // add a new technique. Select the subset of features that should be stored (e.g., _index is\n        // not)\n        const storedTechnique = {};\n        Object.getOwnPropertyNames(technique).forEach(property => {\n            if (!property.startsWith(\"_\")) {\n                storedTechnique[property] = technique[property];\n            }\n        });\n        // Keep the index to identify the original technique later.\n        storedTechnique._index = technique._index;\n        this.techniqueIndexMap.set(technique._index, infoTileTechniqueIndex);\n        this.tileInfo.techniqueCatalog.push(storedTechnique);\n        return infoTileTechniqueIndex;\n    }\n    /**\n     * Add a feature.\n     *\n     * @param featureGroup The feature group to add to.\n     * @param technique The technique to add.\n     * @param env The `env` which is a mix of original OMV feature tags and fields added by the\n     *      [[StyleSetEvaluator]]\n     * @param featureId The featureId, a number unique for many features (but not all).\n     * @param infoTileTechniqueIndex The previously computed index of the technique. Must have been\n     *      computed by `addTechnique(technique)`.\n     * @param isPolygonGroup `true`for polygons.\n     */\n    addFeature(featureGroup, technique, env, featureId, infoTileTechniqueIndex, isPolygonGroup) {\n        // compute name/label of feature\n        const textTechnique = technique;\n        const textLabel = textTechnique.label;\n        const useAbbreviation = textTechnique.useAbbreviation;\n        const useIsoCode = textTechnique.useIsoCode;\n        const name = typeof textLabel === \"string\"\n            ? env.lookup(textLabel)\n            : ExtendedTileInfo.getFeatureName(env, useAbbreviation, useIsoCode, this.languages);\n        let stringIndex = -1;\n        if (name && typeof name === \"string\") {\n            stringIndex = this.addText(name);\n        }\n        // add indices into the arrays.\n        featureGroup.featureIds[featureGroup.numFeatures] = featureId;\n        featureGroup.techniqueIndex[featureGroup.numFeatures] = infoTileTechniqueIndex;\n        featureGroup.textIndex[featureGroup.numFeatures] = stringIndex;\n        featureGroup.positionIndex[featureGroup.numFeatures] = featureGroup.numPositions;\n        // polygons need the extra fields for polygon rings\n        if (isPolygonGroup) {\n            const polygonGroup = featureGroup;\n            harp_utils_1.assert(polygonGroup.outerRingStartIndex !== undefined);\n            harp_utils_1.assert(polygonGroup.innerRingStartIndex !== undefined);\n            harp_utils_1.assert(polygonGroup.innerRingIsOuterContour !== undefined);\n            polygonGroup.outerRingStartIndex[featureGroup.numFeatures] = polygonGroup.groupNumRings;\n        }\n        // store the extra feature fields\n        if (this.storeExtendedTags) {\n            featureGroup.layerIndex[featureGroup.numFeatures] = this.addLayer(env.lookup(\"$layer\"));\n            featureGroup.classIndex[featureGroup.numFeatures] = this.addClass(env.lookup(\"class\"));\n            featureGroup.typeIndex[featureGroup.numFeatures] = this.addType(env.lookup(\"type\"));\n        }\n        featureGroup.numFeatures++;\n    }\n    /**\n     * Add the X/Y coordinate of the point. Only for point feature groups.\n     *\n     * @param featureGroup The feature group to add it to.\n     * @param x X Position of point.\n     * @param y Y Position of point.\n     */\n    addFeaturePoint(featureGroup, x, y) {\n        featureGroup.positions[featureGroup.numPositions++] = x;\n        featureGroup.positions[featureGroup.numPositions++] = y;\n    }\n    /**\n     * Add the line points as X/Y coordinates to the line feature.\n     *\n     * If a line feature has more than one line (rare for HERE data), it should define multiple\n     * line features for it.\n     *\n     * @param featureGroup The feature group to add to. Must be line feature group.\n     * @param points The X/Y coordinates of the points.\n     */\n    addFeaturePoints(featureGroup, points) {\n        const n = featureGroup.numPositions;\n        const l = points.length;\n        const p = featureGroup.positions;\n        for (let i = 0; i < l; i++) {\n            p[n + i] = points[i];\n        }\n        featureGroup.numPositions += points.length;\n    }\n    /**\n     * Add the information about road segments to the line feature. Performs lazy initialization of\n     * `segmentIds`, `segmentStartOffsets`, and `segmentEndOffsets` members of a\n     * [[LineFeatureGroup]] instance.\n     *\n     * @param featureGroup The line feature group to add information to.\n     * @param segmentId Segment id of a feature.\n     * @param startOffset Start offset of a feature.\n     * @param endOffset End offset of a feature.\n     */\n    addRoadSegments(featureGroup, segmentId, startOffset, endOffset) {\n        if (featureGroup.segmentIds === undefined) {\n            featureGroup.segmentIds = new Array();\n            featureGroup.segmentStartOffsets = new Array();\n            featureGroup.segmentEndOffsets = new Array();\n        }\n        featureGroup.segmentIds[featureGroup.numFeatures - 1] = segmentId;\n        featureGroup.segmentStartOffsets[featureGroup.numFeatures - 1] = startOffset;\n        featureGroup.segmentEndOffsets[featureGroup.numFeatures - 1] = endOffset;\n    }\n    /**\n     * Add a single ring to the polygon. Can be called multiple times to add multiple rings to the\n     * polygon.\n     *\n     * @param featureGroup Polygon feature group to add polygon ring to.\n     * @param contour The X/Y coordinates of the ring.\n     * @param isOuterRing Pass `true`if it is a outer ring, otherwise `false`.\n     */\n    addRingPoints(featureGroup, contour, isOuterRing) {\n        featureGroup.innerRingStartIndex[featureGroup.groupNumRings] = featureGroup.numPositions;\n        featureGroup.innerRingIsOuterContour[featureGroup.groupNumRings] = isOuterRing ? 1 : 0;\n        featureGroup.groupNumRings++;\n        const n = featureGroup.numPositions;\n        const l = contour.length;\n        const p = featureGroup.positions;\n        for (let i = 0; i < l; i++) {\n            p[n + i] = contour[i];\n        }\n        featureGroup.numPositions += contour.length;\n    }\n    /**\n     * Finalize the tile info's feature group.\n     */\n    finish() {\n        ExtendedTileInfo.finish(this.tileInfo);\n    }\n    addText(name) {\n        return this.addStringValue(name, this.tileInfo.textCatalog, this.stringMap);\n    }\n    addLayer(name) {\n        return this.addStringValue(name, this.tileInfo.layerCatalog, this.layerMap);\n    }\n    addClass(name) {\n        return this.addStringValue(name, this.tileInfo.classCatalog, this.classMap);\n    }\n    addType(name) {\n        return this.addStringValue(name, this.tileInfo.typeCatalog, this.typeMap);\n    }\n    // Add a string to the strings catalog. Returns index into the catalog.\n    addStringValue(str, catalog, map) {\n        if (str === undefined) {\n            return -1;\n        }\n        const name = str.toString();\n        let i = map.get(name);\n        if (i !== undefined) {\n            return i;\n        }\n        i = catalog.length;\n        catalog.push(name);\n        map.set(name, i);\n        return i;\n    }\n}\nexports.ExtendedTileInfoWriter = ExtendedTileInfoWriter;\n/**\n * Implementation of [[ExtendedTileInfoPolygonAccessor]].\n */\nclass ExtendedTileInfoPolygonAccessorImpl {\n    constructor() {\n        /**\n         * Feature's index in the group.\n         */\n        this.featureIndex = 0;\n        /**\n         * Indicates where the ring starts.\n         */\n        this.ringStart = 0;\n        /**\n         * Number of rings.\n         */\n        this.numRings = 0;\n    }\n    /**\n     * Setup the accessor for extended [[TileInfo]].\n     *\n     * @param polygons polygons feature group.\n     * @param featureIndex feature's index in the group.\n     * @param ringStart where the ring starts.\n     * @param numRings number of rings.\n     */\n    setup(polygons, featureIndex, ringStart, numRings) {\n        this.polygons = polygons;\n        this.featureIndex = featureIndex;\n        this.ringStart = ringStart;\n        this.numRings = numRings;\n    }\n    /**\n     * Shut down the accessor and free all references.\n     */\n    reset() {\n        this.polygons = undefined;\n        this.featureIndex = 0;\n        this.ringStart = 0;\n        this.numRings = 0;\n    }\n    isOuterRing(ringIndex) {\n        harp_utils_1.assert(ringIndex >= 0);\n        harp_utils_1.assert(ringIndex < this.numRings);\n        harp_utils_1.assert(this.polygons !== undefined);\n        if (ringIndex < 0 || ringIndex >= this.numRings || this.polygons === undefined) {\n            throw new Error(\"ExtendedTileInfoPolygonAccessor: Invalid ring index\");\n        }\n        return this.polygons.innerRingIsOuterContour[this.ringStart + ringIndex] !== 0;\n    }\n    getPoints(ringIndex) {\n        harp_utils_1.assert(ringIndex >= 0);\n        harp_utils_1.assert(ringIndex < this.numRings);\n        harp_utils_1.assert(this.polygons !== undefined);\n        if (ringIndex < 0 || ringIndex >= this.numRings || this.polygons === undefined) {\n            throw new Error(\"ExtendedTileInfoPolygonAccessor: Invalid ring index\");\n        }\n        // compute the start/size of the points in this ring. All `points` are actually just the\n        // indices of a single X/Y coordinate.\n        const pointsStart = this.polygons.innerRingStartIndex[this.ringStart + ringIndex];\n        let numPointValues;\n        if (ringIndex < this.numRings - 1) {\n            numPointValues =\n                this.polygons.innerRingStartIndex[this.ringStart + ringIndex + 1] - pointsStart;\n        }\n        else {\n            if (this.ringStart + ringIndex < this.polygons.innerRingStartIndex.length - 1) {\n                numPointValues =\n                    this.polygons.innerRingStartIndex[this.ringStart + ringIndex + 1] - pointsStart;\n            }\n            else {\n                numPointValues = this.polygons.positions.length - pointsStart;\n            }\n        }\n        return {\n            points: this.polygons.positions,\n            pointsStart,\n            numPointValues\n        };\n    }\n}\n/**\n * Supporting class for [[ExtendedTileInfo]]. Takes an [[ExtendedTileInfoHandler]] and calls an\n * `accept` for every feature of the [[ExtendedTileInfo]], or just all features of a specified\n * `featureId`.\n */\nclass ExtendedTileInfoVisitor {\n    constructor(tileInfo) {\n        this.tileInfo = tileInfo;\n    }\n    /**\n     * Visit all feature in the [[ExtendedTileInfo]]\n     *\n     * @param handler Let the `handler` visit all features.\n     */\n    visitAll(handler) {\n        this.visitAllPointFeatures(handler);\n        this.visitAllLineFeatures(handler);\n        this.visitAllPolygonFeatures(handler);\n    }\n    /**\n     * Visit all features of a specified featureId.\n     *\n     * @param featureId The featureId to visit.\n     * @param handler The `handler` to use.\n     */\n    visitFeature(featureId, handler) {\n        let numFeaturesFound = 0;\n        const numPointFeatures = this.tileInfo.pointGroup.numFeatures;\n        const pointFeatures = this.tileInfo.pointGroup.featureIds;\n        for (let i = 0; i < numPointFeatures; i++) {\n            if (pointFeatures[i] === featureId) {\n                numFeaturesFound++;\n                this.visitPointFeature(i, handler);\n            }\n        }\n        const numLineFeatures = this.tileInfo.lineGroup.numFeatures;\n        const lineFeatures = this.tileInfo.lineGroup.featureIds;\n        for (let i = 0; i < numLineFeatures; i++) {\n            if (lineFeatures[i] === featureId) {\n                numFeaturesFound++;\n                this.visitLineFeature(i, handler);\n            }\n        }\n        const numPolygonFeatures = this.tileInfo.polygonGroup.numFeatures;\n        const polygonsFeatures = this.tileInfo.polygonGroup.featureIds;\n        for (let i = 0; i < numPolygonFeatures; i++) {\n            if (polygonsFeatures[i] === featureId) {\n                numFeaturesFound++;\n                this.visitPolygonFeature(i, handler);\n            }\n        }\n        return numFeaturesFound;\n    }\n    /**\n     * Visit all `POINT` features.\n     *\n     * @param handler The `handler` to use.\n     */\n    visitAllPointFeatures(handler) {\n        const numFeatures = this.tileInfo.pointGroup.numFeatures;\n        for (let i = 0; i < numFeatures; i++) {\n            this.visitPointFeature(i, handler);\n        }\n    }\n    /**\n     * Visit all `LINESTRING` features.\n     *\n     * @param handler The handler to use.\n     */\n    visitAllLineFeatures(handler) {\n        const numFeatures = this.tileInfo.lineGroup.numFeatures;\n        for (let i = 0; i < numFeatures; i++) {\n            this.visitLineFeature(i, handler);\n        }\n    }\n    /**\n     * Visit all `POLYGON` features.\n     *\n     * @param handler The `handler` to use.\n     */\n    visitAllPolygonFeatures(handler) {\n        const numFeatures = this.tileInfo.polygonGroup.numFeatures;\n        for (let i = 0; i < numFeatures; i++) {\n            this.visitPolygonFeature(i, handler);\n        }\n    }\n    getTag(featureIndex, index) {\n        return index !== undefined && index[featureIndex] >= 0 ? index[featureIndex] : -1;\n    }\n    /**\n     * Call the `handler` on a point feature.\n     *\n     * @param featureIndex The index of the feature into the feature table.\n     * @param handler The `handler` to use.\n     */\n    visitPointFeature(featureIndex, handler) {\n        const tileInfo = this.tileInfo;\n        const points = tileInfo.pointGroup;\n        const start = points.positionIndex[featureIndex];\n        const x = points.positions[start];\n        const y = points.positions[start + 1];\n        if (!!handler.acceptPoint) {\n            handler.acceptPoint(points.featureIds[featureIndex], points.techniqueIndex[featureIndex], x, y, points.textIndex[featureIndex], this.getTag(featureIndex, points.layerIndex), this.getTag(featureIndex, points.classIndex), this.getTag(featureIndex, points.typeIndex));\n        }\n    }\n    /**\n     * Call the `handler` on a line feature.\n     *\n     * @param featureIndex The index of the feature into the feature table.\n     * @param handler The `handler` to use.\n     */\n    visitLineFeature(featureIndex, handler) {\n        const tileInfo = this.tileInfo;\n        const lines = tileInfo.lineGroup;\n        const numFeatures = lines.numFeatures;\n        const positionsStart = lines.positionIndex[featureIndex];\n        const numPointValues = featureIndex === numFeatures - 1\n            ? lines.positions.length - positionsStart\n            : lines.positionIndex[featureIndex + 1] - positionsStart;\n        let segmentId;\n        let startOffset;\n        let endOffset;\n        if (lines.segmentIds !== undefined) {\n            segmentId = lines.segmentIds[featureIndex];\n            startOffset = lines.segmentStartOffsets[featureIndex];\n            endOffset = lines.segmentEndOffsets[featureIndex];\n        }\n        if (!!handler.acceptLine) {\n            handler.acceptLine(lines.featureIds[featureIndex], lines.techniqueIndex[featureIndex], lines.textIndex[featureIndex], this.getTag(featureIndex, lines.layerIndex), this.getTag(featureIndex, lines.classIndex), this.getTag(featureIndex, lines.typeIndex), tileInfo.lineGroup.positions, positionsStart, numPointValues, segmentId, startOffset, endOffset);\n        }\n    }\n    /**\n     * Call the `handler` on a polygon feature.\n     *\n     * @param featureIndex The index of the feature into the feature table.\n     * @param handler The `handler` to use.\n     */\n    visitPolygonFeature(featureIndex, handler) {\n        if (handler.acceptPolygon === undefined) {\n            return;\n        }\n        const tileInfo = this.tileInfo;\n        const polygons = tileInfo.polygonGroup;\n        const numFeatures = polygons.numFeatures;\n        const ringStart = polygons.outerRingStartIndex[featureIndex];\n        const numRings = featureIndex === numFeatures - 1\n            ? polygons.innerRingStartIndex.length - ringStart\n            : polygons.outerRingStartIndex[featureIndex + 1] - ringStart;\n        // Use a static instance, so we do not allocate anything here\n        ExtendedTileInfoVisitor.polygonAccessor.setup(polygons, featureIndex, ringStart, numRings);\n        handler.acceptPolygon(polygons.featureIds[featureIndex], polygons.techniqueIndex[featureIndex], polygons.textIndex[featureIndex], this.getTag(featureIndex, polygons.layerIndex), this.getTag(featureIndex, polygons.classIndex), this.getTag(featureIndex, polygons.typeIndex), ExtendedTileInfoVisitor.polygonAccessor);\n        // Free all data references.\n        ExtendedTileInfoVisitor.polygonAccessor.reset();\n    }\n}\n// static instance to work without allocations.\nExtendedTileInfoVisitor.polygonAccessor = new ExtendedTileInfoPolygonAccessorImpl();\nexports.ExtendedTileInfoVisitor = ExtendedTileInfoVisitor;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The ThemeVisitor visits every style in the theme in a depth-first fashion.\n */\nclass ThemeVisitor {\n    constructor(theme) {\n        this.theme = theme;\n    }\n    /**\n     * Applies a function to every style in the theme.\n     *\n     * @param visitFunc Function to be called with `style` as an argument. Function should return\n     *                  `true` to cancel visitation.\n     * @returns `true` if function has finished prematurely.\n     */\n    visitStyles(visitFunc) {\n        const visit = (style) => {\n            if (visitFunc(style)) {\n                return true;\n            }\n            if (style.styles !== undefined) {\n                for (const currStyle of style.styles) {\n                    if (visit(currStyle)) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        };\n        if (this.theme.styles !== undefined) {\n            for (const styleSetName in this.theme.styles) {\n                if (this.theme.styles[styleSetName] !== undefined) {\n                    for (const style of this.theme.styles[styleSetName]) {\n                        if (visit(style)) {\n                            return true;\n                        }\n                    }\n                }\n            }\n        }\n        return false;\n    }\n}\nexports.ThemeVisitor = ThemeVisitor;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst GlyphData_1 = require(\"./GlyphData\");\nconst GlyphTextureCache_1 = require(\"./GlyphTextureCache\");\nconst TextStyle_1 = require(\"./TextStyle\");\nconst ASSETS_PATH = \"_Assets/\";\nconst BOLD_ASSETS_PATH = \"_BoldAssets/\";\nconst ITALIC_ASSETS_PATH = \"_ItalicAssets/\";\nconst BOLD_ITALIC_ASSETS_PATH = \"_BoldItalicAssets/\";\nconst REPLACEMENT_PATH = \"_Assets/Extra/\";\n/**\n * Collection of font assets used to render glyphs when using a [[TextCanvas]].\n *\n * @summary A `FontCatalog` works as a stack of SDF bitmap fonts (using the BMFont format) designed\n * to cover the widest Unicode code point range possible. In order to manage all these assets\n * elegantly, the assets inside the `FontCatalog` are stored on a per-Unicode-Block basis, and\n * assets for a block are only loaded once a glyph belonging to that block is requested.\n *\n * Bitmap information coming from all different fonts is then stored in a unified WebGL GPU Texture\n * resource, which can be sampled to render all currently loaded glyphs.\n *\n */\nclass FontCatalog {\n    /**\n     * @hidden\n     * Creates a new FontCatalog.\n     *\n     * @param url FontCatalog's URL.\n     * @param name FontCatalog's name.\n     * @param type FontCatalog's type (sdf or msdf).\n     * @param size FontCatalog's glyph size (pixels).\n     * @param maxWidth FontCatalog's maximum glyph width (pixels).\n     * @param maxHeight FontCatalog's maximum glyph height (pixels).\n     * @param distanceRange Distance range used to generate the SDF bitmaps.\n     * @param fonts Array of supported fonts.\n     * @param unicodeBlocks Array of supported Unicode blocks.\n     * @param maxCodePointCount Maximum number of unique code points bitmaps this `FontCatalog`'s\n     * internal texture can store simultaneously.\n     * @param m_replacementGlyph [[GlyphData]] to be used whenever a Unicode code point is not\n     * supported by this `FontCatalog`.\n     *\n     * @returns New FontCatalog.\n     */\n    constructor(url, name, type, size, maxWidth, maxHeight, distanceRange, fonts, unicodeBlocks, maxCodePointCount, m_replacementGlyph) {\n        this.url = url;\n        this.name = name;\n        this.type = type;\n        this.size = size;\n        this.maxWidth = maxWidth;\n        this.maxHeight = maxHeight;\n        this.distanceRange = distanceRange;\n        this.fonts = fonts;\n        this.unicodeBlocks = unicodeBlocks;\n        this.maxCodePointCount = maxCodePointCount;\n        this.m_replacementGlyph = m_replacementGlyph;\n        this.m_glyphTextureCache = new GlyphTextureCache_1.GlyphTextureCache(maxCodePointCount, this.maxWidth + 1, this.maxHeight + 1);\n        this.m_loadingJson = new Map();\n        this.m_loadingPages = new Map();\n        this.m_loadingGlyphs = new Map();\n        this.m_loadedJson = new Map();\n        this.m_loadedPages = new Map();\n        this.m_loadedGlyphs = new Map();\n    }\n    /**\n     * Loads a `FontCatalog`.\n     *\n     * @param url Asset url.\n     * @param maxCodePointCount Maximum number of unique code points bitmaps this `FontCatalog`'s\n     * internal texture can store simultaneously.\n     *\n     * @returns `FontCatalog` Promise.\n     */\n    static load(path, maxCodePointCount) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = new URL(path, window.location.href);\n            const fontCatalog = yield FontCatalog.loadJSON(url.href);\n            const replacementDirUrl = new URL(`${fontCatalog.name}${REPLACEMENT_PATH}`, url);\n            const replacementJson = yield FontCatalog.loadJSON(replacementDirUrl.href + \"Specials.json\");\n            const replacementTexture = yield FontCatalog.loadTexture(replacementDirUrl.href + \"Specials.png\");\n            replacementTexture.wrapS = THREE.ClampToEdgeWrapping;\n            replacementTexture.wrapT = THREE.ClampToEdgeWrapping;\n            replacementTexture.minFilter = THREE.NearestFilter;\n            replacementTexture.needsUpdate = true;\n            const replacementFont = fontCatalog.fonts.find((font) => font.name === \"Extra\");\n            const replacementGlyph = new GlyphData_1.GlyphData(65533, \"Specials\", replacementJson.chars[0].width, replacementJson.chars[0].height, replacementJson.chars[0].xadvance, replacementJson.chars[0].xoffset, replacementJson.chars[0].yoffset, 0.0, 0.0, 1.0, 1.0, replacementTexture, replacementFont);\n            const fontCatalogInfo = new FontCatalog(url.href.substr(0, url.href.lastIndexOf(\"/\")), fontCatalog.name, fontCatalog.type, fontCatalog.size, fontCatalog.maxWidth, fontCatalog.maxHeight, fontCatalog.distanceRange, fontCatalog.fonts, fontCatalog.supportedBlocks, maxCodePointCount, replacementGlyph);\n            return fontCatalogInfo;\n        });\n    }\n    static loadTexture(url) {\n        return new Promise(resolve => {\n            new THREE.TextureLoader().load(url, resolve);\n        });\n    }\n    static loadJSON(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const response = yield fetch(url);\n            if (!response.ok) {\n                throw new Error(`${url} Status Text:  ${response.statusText}`);\n            }\n            const rawJSON = yield response.text();\n            return JSON.parse(rawJSON);\n        });\n    }\n    /**\n     * Release all allocated resources.\n     */\n    dispose() {\n        this.fonts.length = 0;\n        this.unicodeBlocks.length = 0;\n        this.m_glyphTextureCache.dispose();\n        this.m_loadingJson.clear();\n        this.m_loadingPages.clear();\n        this.m_loadingGlyphs.clear();\n        this.m_loadedJson.clear();\n        this.m_loadedPages.clear();\n        this.m_loadedGlyphs.clear();\n    }\n    /**\n     * Removes all loaded (and loading) assets.\n     */\n    clear() {\n        this.m_glyphTextureCache.clear();\n        this.m_loadingJson.clear();\n        this.m_loadingPages.clear();\n        this.m_loadingGlyphs.clear();\n        this.m_loadedJson.clear();\n        this.m_loadedPages.clear();\n        this.m_loadedGlyphs.clear();\n    }\n    /**\n     * Updates the internal WebGLRenderTarget.\n     * The update will copy the newly introduced glyphs since the previous update.\n     *\n     * @param renderer WebGLRenderer.\n     */\n    update(renderer) {\n        this.m_glyphTextureCache.update(renderer);\n    }\n    /**\n     * Internal WebGL Texture.\n     */\n    get texture() {\n        return this.m_glyphTextureCache.texture;\n    }\n    /**\n     * Internal WebGL Texture size.\n     */\n    get textureSize() {\n        return this.m_glyphTextureCache.textureSize;\n    }\n    /**\n     * Current internal loading state.\n     */\n    get isLoading() {\n        return (this.m_loadingJson.size > 0 ||\n            this.m_loadingPages.size > 0 ||\n            this.m_loadingGlyphs.size > 0);\n    }\n    /**\n     * Loads the description file for a specific [[UnicodeBlock]]. This speeds up consequent calls\n     * to `FontCatalog`.loadCharset() that require glyphs from this block to be loaded.\n     *\n     * @param block Requested [[UnicodeBlock]].\n     * @param font [[Font]] to retrieve this Unicode block from.\n     * @param fontStyle [[FontStyle]] assets to load.\n     * @param loadPages If `true`, all pages in this Unicode block will also be loaded.\n     *\n     * @returns Loaded Unicode Block json.\n     */\n    loadBlock(block, font, fontStyle, loadPages) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const assetsPath = this.getAssetsPath(fontStyle, font);\n            const jsonPath = `${assetsPath}/${block.name.replace(/ /g, \"_\")}.json`;\n            let json = this.m_loadedJson.get(jsonPath);\n            if (json === undefined) {\n                let jsonPromise = this.m_loadingJson.get(jsonPath);\n                if (jsonPromise === undefined) {\n                    try {\n                        jsonPromise = FontCatalog.loadJSON(jsonPath);\n                        this.m_loadingJson.set(jsonPath, jsonPromise);\n                        json = yield jsonPromise;\n                        this.m_loadingJson.delete(jsonPath);\n                        this.m_loadedJson.set(jsonPath, json);\n                    }\n                    catch (e) {\n                        // tslint:disable-next-line:no-console\n                        console.error(e);\n                        this.m_loadingJson.delete(jsonPath);\n                    }\n                }\n                else {\n                    json = yield jsonPromise;\n                }\n            }\n            const pagePromises = [];\n            if (loadPages === true) {\n                for (const page of json.pages) {\n                    pagePromises.push(this.loadPage(`${assetsPath}/${page}`));\n                }\n            }\n            yield Promise.all(pagePromises);\n            return json;\n        });\n    }\n    /**\n     * Releases the description file for a specific [[UnicodeBlock]] (and all downloaded pages).\n     * Safe to call when no assets for this block have been loaded.\n     *\n     * @param block Requested [[UnicodeBlock]].\n     * @param font [[Font]] to remove this Unicode block from.\n     * @param fontStyle [[FontStyle]] assets to remove.\n     */\n    removeBlock(block, font, fontStyle) {\n        const assetsPath = this.getAssetsPath(fontStyle, font);\n        const jsonPath = `${assetsPath}/${block.name.replace(/ /g, \"_\")}.json`;\n        const json = this.m_loadedJson.get(jsonPath);\n        if (json !== undefined) {\n            for (const page of json.pages) {\n                const pagePath = `${assetsPath}/${page}`;\n                this.m_loadingPages.delete(pagePath);\n                this.m_loadedPages.delete(pagePath);\n            }\n            this.m_loadingJson.delete(jsonPath);\n            this.m_loadedJson.delete(jsonPath);\n        }\n    }\n    /**\n     * Loads all the required glyphs needed to render the input text. Character repetition will not\n     * be considered, and only styled assets (with applied font selection, style and variants) will\n     * be loaded.\n     *\n     * @param input Input text.\n     * @param style Specific [[TextRenderStyle]] for which glyphs will be loaded.\n     *\n     * @returns Promise containing an array of all loaded [[GlyphData]] for the input text.\n     */\n    loadCharset(input, style) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const fontName = style.fontName;\n            const fontStyle = style.fontStyle;\n            const shouldTransform = style.fontVariant === TextStyle_1.FontVariant.AllCaps ||\n                style.fontVariant === TextStyle_1.FontVariant.SmallCaps;\n            const charset = (shouldTransform ? input.toUpperCase() : input).replace(/[\\s\\S](?=([\\s\\S]+))/g, (c, s) => {\n                return s.indexOf(c) + 1 ? \"\" : c;\n            });\n            const glyphPromises = [];\n            for (const char of charset) {\n                const codePoint = char.codePointAt(0);\n                const font = this.getFont(codePoint, fontName);\n                const fontHash = `${font.name}_${fontStyle}`;\n                const glyphHash = `${fontHash}_${codePoint}`;\n                let fontGlyphMap = this.m_loadedGlyphs.get(fontHash);\n                if (fontGlyphMap === undefined) {\n                    fontGlyphMap = new Map();\n                    this.m_loadedGlyphs.set(fontHash, fontGlyphMap);\n                }\n                const glyph = fontGlyphMap.get(codePoint);\n                if (glyph === undefined) {\n                    let glyphPromise = this.m_loadingGlyphs.get(glyphHash);\n                    if (glyphPromise === undefined) {\n                        if (font.charset.indexOf(String.fromCodePoint(codePoint)) === -1) {\n                            const replacementGlyph = this.createReplacementGlyph(codePoint, char, font);\n                            fontGlyphMap.set(codePoint, replacementGlyph);\n                            this.m_glyphTextureCache.add(glyphHash, replacementGlyph);\n                            continue;\n                        }\n                        let charUnicodeBlock;\n                        for (const block of this.unicodeBlocks) {\n                            if (codePoint >= block.min && codePoint <= block.max) {\n                                charUnicodeBlock = block;\n                                break;\n                            }\n                        }\n                        glyphPromise = this.loadAssets(codePoint, fontStyle, charUnicodeBlock, font);\n                        this.m_loadingGlyphs.set(glyphHash, glyphPromise);\n                        glyphPromise.then((loadedGlyph) => {\n                            this.m_loadingGlyphs.delete(glyphHash);\n                            fontGlyphMap.set(codePoint, loadedGlyph);\n                            this.m_glyphTextureCache.add(glyphHash, loadedGlyph);\n                        });\n                    }\n                    glyphPromises.push(glyphPromise);\n                }\n                else if (!this.m_glyphTextureCache.has(glyphHash)) {\n                    glyphPromises.push(Promise.resolve(glyph));\n                    this.m_glyphTextureCache.add(glyphHash, glyph);\n                }\n            }\n            return Promise.all(glyphPromises);\n        });\n    }\n    /**\n     * Retrieves the loaded [[GlyphData]] for a specific character.\n     * Returns `undefined` if the assets for this glyph haven't been loaded yet.\n     *\n     * @param codePoint Character's Unicode code point.\n     * @param font [[Font]] to get this glyph from.\n     * @param fontStyle Specific [[FontStyle]] to get glyphs for.\n     *\n     * @returns [[GlyphData]] for this code point.\n     */\n    getGlyph(codePoint, font, fontStyle) {\n        const fontGlyphMap = this.m_loadedGlyphs.get(`${font.name}_${fontStyle}`);\n        if (fontGlyphMap === undefined) {\n            return undefined;\n        }\n        return fontGlyphMap.get(codePoint);\n    }\n    /**\n     * Retrieves the loaded [[GlyphData]] for the specified text.\n     * Returns `undefined` if the assets for these glyphs haven't been loaded yet.\n     *\n     * @param input Input text.\n     * @param style Specific [[TextRenderStyle]] to get glyphs for.\n     * @param letterCaseArray Array containing the original letter case for the requested glyphs.\n     *\n     * @returns Array containing [[GlyphData]] for each character of the input text.\n     */\n    getGlyphs(input, style, letterCaseArray) {\n        const result = [];\n        const fontName = style.fontName;\n        const fontStyle = style.fontStyle;\n        const fontVariant = style.fontVariant;\n        const shouldTransform = fontVariant === TextStyle_1.FontVariant.AllCaps || fontVariant === TextStyle_1.FontVariant.SmallCaps;\n        for (const character of input) {\n            const transformedCharacter = shouldTransform ? character.toUpperCase() : character;\n            for (const char of transformedCharacter) {\n                const codePoint = char.codePointAt(0);\n                const font = this.getFont(codePoint, fontName);\n                const glyphData = this.getGlyph(codePoint, font, fontStyle);\n                if (glyphData !== undefined) {\n                    result.push(glyphData);\n                    if (letterCaseArray !== undefined) {\n                        letterCaseArray.push(char !== character);\n                    }\n                }\n                else {\n                    return undefined;\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Gets the best matched font for a specific character.\n     *\n     * @param codePoint Character's Unicode code point.\n     * @param fontName Font name suggestion.\n     *\n     * @returns Best matched font.\n     */\n    getFont(codePoint, fontName) {\n        let selectedFontName = this.fonts[0].name;\n        for (const block of this.unicodeBlocks) {\n            if (codePoint >= block.min && codePoint <= block.max) {\n                selectedFontName =\n                    fontName !== undefined &&\n                        block.fonts.find(element => {\n                            return element === fontName;\n                        }) !== undefined\n                        ? fontName\n                        : block.fonts[0];\n                break;\n            }\n        }\n        return this.fonts.find(element => {\n            return element.name === selectedFontName;\n        });\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `FontCatalog`.\n     *\n     * @param info The info object to increment with the values from this `FontCatalog`.\n     */\n    updateMemoryUsage(info) {\n        let numBytes = 0;\n        for (const block of this.unicodeBlocks) {\n            numBytes += (block.max - block.min) * 2;\n        }\n        // Always stored in RGBA internally.\n        let textureBytes = this.m_glyphTextureCache.textureSize.x * this.m_glyphTextureCache.textureSize.y * 4;\n        for (const page in this.m_loadedPages.entries) {\n            if (this.m_loadedPages.get(page) !== undefined) {\n                const loadedPage = this.m_loadedPages.get(page);\n                if (loadedPage !== undefined) {\n                    textureBytes += loadedPage.image.width * loadedPage.image.height * 4;\n                }\n            }\n        }\n        info.heapSize += numBytes + textureBytes;\n        info.gpuSize += textureBytes;\n    }\n    createReplacementGlyph(codePoint, char, font) {\n        const replacementGlyph = this.m_replacementGlyph.clone();\n        replacementGlyph.codePoint = codePoint;\n        replacementGlyph.character = char;\n        replacementGlyph.font = font;\n        return replacementGlyph;\n    }\n    loadAssets(codePoint, fontStyle, block, font) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const json = yield this.loadBlock(block, font, fontStyle);\n            if (json === undefined) {\n                return this.m_replacementGlyph;\n            }\n            const sourceGlyphData = json.chars.find(char => char.id === codePoint);\n            const assetsPath = this.getAssetsPath(fontStyle, font);\n            const texturePath = `${assetsPath}/${json.pages[sourceGlyphData.page]}`;\n            const texture = yield this.loadPage(texturePath);\n            const glyphData = new GlyphData_1.GlyphData(sourceGlyphData.id, block.name, sourceGlyphData.width, sourceGlyphData.height, sourceGlyphData.xadvance, sourceGlyphData.xoffset, sourceGlyphData.yoffset, sourceGlyphData.x / texture.image.width, 1.0 - (sourceGlyphData.y + sourceGlyphData.height) / texture.image.height, (sourceGlyphData.x + sourceGlyphData.width) / texture.image.width, 1.0 - sourceGlyphData.y / texture.image.height, texture, font);\n            return glyphData;\n        });\n    }\n    loadPage(pagePath) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let page = this.m_loadedPages.get(pagePath);\n            if (page === undefined) {\n                let pagePromise = this.m_loadingPages.get(pagePath);\n                if (pagePromise === undefined) {\n                    pagePromise = FontCatalog.loadTexture(pagePath);\n                    this.m_loadingPages.set(pagePath, pagePromise);\n                    page = yield pagePromise;\n                    page.wrapS = THREE.ClampToEdgeWrapping;\n                    page.wrapT = THREE.ClampToEdgeWrapping;\n                    page.minFilter = THREE.NearestFilter;\n                    page.needsUpdate = true;\n                    if (this.m_loadingPages.delete(pagePath)) {\n                        this.m_loadedPages.set(pagePath, page);\n                    }\n                    this.m_loadingPages.delete(pagePath);\n                }\n                else {\n                    page = yield pagePromise;\n                }\n            }\n            return page;\n        });\n    }\n    getAssetsPath(fontStyle, font) {\n        let fontStylePath = ASSETS_PATH;\n        switch (fontStyle) {\n            case TextStyle_1.FontStyle.Bold:\n                if (font.bold !== undefined) {\n                    fontStylePath = BOLD_ASSETS_PATH;\n                }\n                break;\n            case TextStyle_1.FontStyle.Italic:\n                if (font.italic !== undefined) {\n                    fontStylePath = ITALIC_ASSETS_PATH;\n                }\n                break;\n            case TextStyle_1.FontStyle.BoldItalic:\n                if (font.boldItalic !== undefined) {\n                    fontStylePath = BOLD_ITALIC_ASSETS_PATH;\n                }\n                else if (font.italic !== undefined) {\n                    fontStylePath = ITALIC_ASSETS_PATH;\n                }\n                else if (font.bold !== undefined) {\n                    fontStylePath = BOLD_ASSETS_PATH;\n                }\n                break;\n        }\n        return `${this.url}/${this.name}${fontStylePath}${font.name}`;\n    }\n}\nexports.FontCatalog = FontCatalog;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_lrucache_1 = require(\"@here/harp-lrucache\");\nconst THREE = require(\"three\");\nconst GlyphData_1 = require(\"./GlyphData\");\nconst TextMaterials_1 = require(\"./TextMaterials\");\n/**\n * Maximum number of texture atlas pages we can copy from in a single go. This amount is determined\n * by the maximum number of texture units available on a pixel shader for all devices:\n * https://webglstats.com/webgl/parameter/MAX_TEXTURE_IMAGE_UNITS\n */\nconst MAX_NUM_COPY_PAGES = 8;\n/**\n * Maximum texture size supported. This amount is determined by the maximum texture size supported\n * for all devices:\n * https://webglstats.com/webgl/parameter/MAX_TEXTURE_SIZE\n */\nconst MAX_TEXTURE_SIZE = 4096;\n/**\n * @hidden\n * Unified glyph SDF bitmap storage for all fonts in a [[FontCatalog]].\n * Implemented as an abstraction layer on top of an LRUCache and WebGLRenderTarget.\n */\nclass GlyphTextureCache {\n    /**\n     * Creates a `GlyphTextureCache` object.\n     *\n     * @param capacity Cache's maximum glyph capacity.\n     * @param entryWidth Maximum entry width.\n     * @param entryHeight Maximum entry height.\n     *\n     * @returns New `GlyphTextureCache`.\n     */\n    constructor(capacity, entryWidth, entryHeight) {\n        this.capacity = capacity;\n        this.entryWidth = entryWidth;\n        this.entryHeight = entryHeight;\n        const nRows = Math.floor(Math.sqrt(capacity));\n        this.m_cacheHeight = nRows * nRows < capacity ? nRows + 1 : nRows;\n        this.m_cacheWidth = nRows * this.m_cacheHeight < capacity ? nRows + 1 : nRows;\n        this.m_textureSize = new THREE.Vector2(this.m_cacheWidth * entryWidth, this.m_cacheHeight * entryHeight);\n        if (this.m_textureSize.y > MAX_TEXTURE_SIZE || this.m_textureSize.x > MAX_TEXTURE_SIZE) {\n            // tslint:disable-next-line:no-console\n            console.warn(\"GlyphTextureCache texture size (\" +\n                this.m_textureSize.x +\n                \", \" +\n                this.m_textureSize.y +\n                \") exceeds WebGL's widely supported MAX_TEXTURE_SIZE (\" +\n                MAX_TEXTURE_SIZE +\n                \").\\n\" +\n                \"This could result in rendering errors on some devices.\\n\" +\n                \"Please consider reducing its capacity or input assets size.\");\n        }\n        this.m_entryCache = new harp_lrucache_1.LRUCache(capacity);\n        this.initCacheEntries();\n        this.m_scene = new THREE.Scene();\n        this.m_camera = new THREE.OrthographicCamera(0, this.m_textureSize.x, this.m_textureSize.y, 0);\n        this.m_camera.position.z = 1;\n        this.m_camera.updateMatrixWorld(false);\n        this.m_rt = new THREE.WebGLRenderTarget(this.m_textureSize.x, this.m_textureSize.y, {\n            wrapS: THREE.ClampToEdgeWrapping,\n            wrapT: THREE.ClampToEdgeWrapping,\n            depthBuffer: false,\n            stencilBuffer: false\n        });\n        this.m_copyTextureSet = new Set();\n        this.m_copyTransform = new THREE.Matrix3();\n        this.m_copyPositions = [];\n        this.m_copyPositions.push(new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2());\n        this.m_copyMaterial = new TextMaterials_1.GlyphCopyMaterial();\n        this.m_copyVertexBuffer = new THREE.InterleavedBuffer(new Float32Array(capacity * 20), 5);\n        this.m_copyVertexBuffer.setDynamic(true);\n        this.m_copyPositionAttribute = new THREE.InterleavedBufferAttribute(this.m_copyVertexBuffer, 3, 0);\n        this.m_copyUVAttribute = new THREE.InterleavedBufferAttribute(this.m_copyVertexBuffer, 2, 3);\n        this.m_copyGeometry = new THREE.BufferGeometry();\n        this.m_copyGeometry.addAttribute(\"position\", this.m_copyPositionAttribute);\n        this.m_copyGeometry.addAttribute(\"uv\", this.m_copyUVAttribute);\n        const copyIndexBuffer = new THREE.BufferAttribute(new Uint32Array(capacity * 6), 1);\n        copyIndexBuffer.setDynamic(true);\n        this.m_copyGeometry.setIndex(copyIndexBuffer);\n        this.m_copyMesh = new THREE.Mesh(this.m_copyGeometry, this.m_copyMaterial);\n        this.m_copyMesh.frustumCulled = false;\n        this.m_copyGeometryDrawCount = 0;\n        this.m_clearMaterial = new TextMaterials_1.GlyphClearMaterial();\n        this.m_clearPositionAttribute = new THREE.BufferAttribute(new Float32Array(capacity * 8), 2);\n        this.m_clearPositionAttribute.setDynamic(true);\n        this.m_clearGeometry = new THREE.BufferGeometry();\n        this.m_clearGeometry.addAttribute(\"position\", this.m_clearPositionAttribute);\n        const clearIndexBuffer = new THREE.BufferAttribute(new Uint32Array(capacity * 6), 1);\n        clearIndexBuffer.setDynamic(true);\n        this.m_clearGeometry.setIndex(clearIndexBuffer);\n        this.m_clearMesh = new THREE.Mesh(this.m_clearGeometry, this.m_clearMaterial);\n        this.m_clearMesh.frustumCulled = false;\n        this.m_clearGeometryDrawCount = 0;\n        this.m_scene.add(this.m_clearMesh, this.m_copyMesh);\n    }\n    /**\n     * Release all allocated resources.\n     */\n    dispose() {\n        this.m_entryCache.clear();\n        this.m_scene.remove(this.m_clearMesh, this.m_copyMesh);\n        this.m_rt.dispose();\n        this.m_clearMaterial.dispose();\n        this.m_copyMaterial.dispose();\n        this.m_copyTextureSet.clear();\n        this.m_clearGeometry.dispose();\n        this.m_copyGeometry.dispose();\n    }\n    /**\n     * Internal WebGL Texture.\n     */\n    get texture() {\n        return this.m_rt.texture;\n    }\n    /**\n     * Internal WebGL Texture size.\n     */\n    get textureSize() {\n        return this.m_textureSize;\n    }\n    /**\n     * Add a new entry to the GlyphTextureCache. If the limit of entries is hit, the least requested\n     * entry will be replaced.\n     *\n     * @param hash Entry's hash.\n     * @param glyph Entry's glyph data.\n     */\n    add(hash, glyph) {\n        const entry = this.m_entryCache.get(hash);\n        if (entry !== undefined) {\n            return;\n        }\n        const oldestEntry = this.m_entryCache.oldest;\n        if (oldestEntry === null) {\n            throw new Error(\"GlyphTextureCache is uninitialized!\");\n        }\n        this.clearCacheEntry(oldestEntry.value);\n        this.copyGlyphToCache(hash, glyph, oldestEntry.value.location);\n    }\n    /**\n     * Checks if an entry is in the cache.\n     *\n     * @param hash Entry's hash.\n     *\n     * @returns Test result.\n     */\n    has(hash) {\n        return this.m_entryCache.has(hash);\n    }\n    /**\n     * Retrieves an entry from the cache.\n     *\n     * @param hash Entry's hash.\n     *\n     * @returns Retrieval result.\n     */\n    get(hash) {\n        return this.m_entryCache.get(hash);\n    }\n    /**\n     * Clears the internal LRUCache.\n     */\n    clear() {\n        this.m_copyGeometryDrawCount = 0;\n        this.m_clearGeometryDrawCount = 0;\n        this.m_entryCache.clear();\n        this.m_copyTextureSet.clear();\n        this.initCacheEntries();\n    }\n    /**\n     * Updates the internal WebGLRenderTarget.\n     * The update will copy the newly introduced glyphs since the previous update.\n     *\n     * @param renderer WebGLRenderer.\n     */\n    update(renderer) {\n        let oldRenderTarget = null;\n        const willClearGeometry = this.m_clearGeometryDrawCount > 0;\n        const willCopyGeometry = this.m_copyGeometryDrawCount > 0;\n        if (willClearGeometry || willCopyGeometry) {\n            oldRenderTarget = renderer.getRenderTarget();\n            renderer.setRenderTarget(this.m_rt);\n        }\n        if (willClearGeometry) {\n            this.m_clearPositionAttribute.needsUpdate = true;\n            this.m_clearPositionAttribute.updateRange.offset = 0;\n            this.m_clearPositionAttribute.updateRange.count = this.m_clearGeometryDrawCount * 8;\n            this.m_clearGeometry.index.needsUpdate = true;\n            this.m_clearGeometry.index.updateRange.offset = 0;\n            this.m_clearGeometry.index.updateRange.count = this.m_clearGeometryDrawCount * 6;\n            this.m_clearGeometry.setDrawRange(0, this.m_clearGeometryDrawCount * 6);\n            this.m_clearMesh.visible = true;\n            this.m_copyMesh.visible = false;\n            renderer.render(this.m_scene, this.m_camera);\n            this.m_clearGeometryDrawCount = 0;\n            this.m_clearMesh.visible = false;\n        }\n        if (willCopyGeometry) {\n            this.m_copyVertexBuffer.needsUpdate = true;\n            this.m_copyVertexBuffer.updateRange.offset = 0;\n            this.m_copyVertexBuffer.updateRange.count = this.m_copyGeometryDrawCount * 20;\n            this.m_copyGeometry.index.needsUpdate = true;\n            this.m_copyGeometry.index.updateRange.offset = 0;\n            this.m_copyGeometry.index.updateRange.count = this.m_copyGeometryDrawCount * 6;\n            this.m_copyGeometry.setDrawRange(0, this.m_copyGeometryDrawCount * 6);\n            this.m_copyMesh.visible = true;\n            const srcPages = Array.from(this.m_copyTextureSet);\n            const nCopies = Math.ceil(this.m_copyTextureSet.size / MAX_NUM_COPY_PAGES);\n            for (let copyIndex = 0; copyIndex < nCopies; copyIndex++) {\n                const pageOffset = copyIndex * MAX_NUM_COPY_PAGES;\n                this.m_copyMaterial.uniforms.pageOffset.value = pageOffset;\n                for (let i = 0; i < MAX_NUM_COPY_PAGES; i++) {\n                    const pageIndex = pageOffset + i;\n                    if (pageIndex < this.m_copyTextureSet.size) {\n                        this.m_copyMaterial.uniforms[\"page\" + i].value = srcPages[pageIndex];\n                    }\n                }\n                renderer.render(this.m_scene, this.m_camera);\n            }\n            this.m_copyTextureSet.clear();\n            this.m_copyGeometryDrawCount = 0;\n        }\n        if (willClearGeometry || willCopyGeometry) {\n            renderer.setRenderTarget(oldRenderTarget);\n        }\n    }\n    initCacheEntries() {\n        const dummyMetrics = {\n            size: 0,\n            distanceRange: 0,\n            base: 0,\n            lineHeight: 0,\n            lineGap: 0,\n            capHeight: 0,\n            xHeight: 0\n        };\n        const dummyFont = {\n            name: \"\",\n            metrics: dummyMetrics,\n            charset: \"\"\n        };\n        const dummyGlyphData = new GlyphData_1.GlyphData(0, \"\", 0, 0, 0, 0, 0, 0, 0, 0, 0, THREE.Texture.DEFAULT_IMAGE, dummyFont);\n        for (let i = 0; i < this.m_cacheHeight; i++) {\n            for (let j = 0; j < this.m_cacheWidth; j++) {\n                const dummyEntry = {\n                    glyphData: dummyGlyphData,\n                    location: new THREE.Vector2(j, i)\n                };\n                this.m_entryCache.set(`Dummy_${i * this.m_cacheHeight + j}`, dummyEntry);\n            }\n        }\n    }\n    copyGlyphToCache(hash, glyph, cacheLocation) {\n        this.m_copyTextureSet.add(glyph.texture);\n        let copyTextureIndex = 0;\n        for (const value of this.m_copyTextureSet.values()) {\n            if (value === glyph.texture) {\n                break;\n            }\n            copyTextureIndex++;\n        }\n        glyph.copyIndex = copyTextureIndex;\n        this.m_copyTransform.set(1.0, 0.0, cacheLocation.x * this.entryWidth - glyph.offsetX, 0.0, 1.0, cacheLocation.y * this.entryHeight - glyph.positions[0].y, 0.0, 0.0, 0.0);\n        for (let i = 0; i < 4; ++i) {\n            this.m_copyPositions[i].set(glyph.positions[i].x, glyph.positions[i].y);\n            this.m_copyPositions[i].applyMatrix3(this.m_copyTransform);\n        }\n        if (this.m_copyGeometryDrawCount >= this.capacity) {\n            return;\n        }\n        const baseVertex = this.m_copyGeometryDrawCount * 4;\n        const baseIndex = this.m_copyGeometryDrawCount * 6;\n        for (let i = 0; i < 4; ++i) {\n            this.m_copyPositionAttribute.setXYZ(baseVertex + i, this.m_copyPositions[i].x, this.m_copyPositions[i].y, glyph.copyIndex);\n            this.m_copyUVAttribute.setXY(baseVertex + i, glyph.sourceTextureCoordinates[i].x, glyph.sourceTextureCoordinates[i].y);\n        }\n        this.m_copyGeometry.index.setX(baseIndex, baseVertex);\n        this.m_copyGeometry.index.setX(baseIndex + 1, baseVertex + 1);\n        this.m_copyGeometry.index.setX(baseIndex + 2, baseVertex + 2);\n        this.m_copyGeometry.index.setX(baseIndex + 3, baseVertex + 2);\n        this.m_copyGeometry.index.setX(baseIndex + 4, baseVertex + 1);\n        this.m_copyGeometry.index.setX(baseIndex + 5, baseVertex + 3);\n        ++this.m_copyGeometryDrawCount;\n        const u0 = this.m_copyPositions[0].x / this.m_textureSize.x;\n        const v0 = this.m_copyPositions[0].y / this.m_textureSize.y;\n        const u1 = this.m_copyPositions[3].x / this.m_textureSize.x;\n        const v1 = this.m_copyPositions[3].y / this.m_textureSize.y;\n        glyph.dynamicTextureCoordinates[0].set(u0, v0);\n        glyph.dynamicTextureCoordinates[1].set(u1, v0);\n        glyph.dynamicTextureCoordinates[2].set(u0, v1);\n        glyph.dynamicTextureCoordinates[3].set(u1, v1);\n        glyph.isInCache = true;\n        this.m_entryCache.set(hash, {\n            glyphData: glyph,\n            location: cacheLocation\n        });\n    }\n    clearCacheEntry(entry) {\n        entry.glyphData.isInCache = false;\n        this.m_copyPositions[0].set(entry.location.x * this.entryWidth, entry.location.y * this.entryHeight);\n        this.m_copyPositions[1].set((entry.location.x + 1) * this.entryWidth, entry.location.y * this.entryHeight);\n        this.m_copyPositions[2].set(entry.location.x * this.entryWidth, (entry.location.y + 1) * this.entryHeight);\n        this.m_copyPositions[3].set((entry.location.x + 1) * this.entryWidth, (entry.location.y + 1) * this.entryHeight);\n        if (this.m_clearGeometryDrawCount >= this.capacity) {\n            return;\n        }\n        const baseVertex = this.m_clearGeometryDrawCount * 4;\n        const baseIndex = this.m_clearGeometryDrawCount * 6;\n        for (let i = 0; i < 4; ++i) {\n            this.m_clearPositionAttribute.setXY(baseVertex + i, this.m_copyPositions[i].x, this.m_copyPositions[i].y);\n        }\n        this.m_clearGeometry.index.setX(baseIndex, baseVertex);\n        this.m_clearGeometry.index.setX(baseIndex + 1, baseVertex + 1);\n        this.m_clearGeometry.index.setX(baseIndex + 2, baseVertex + 2);\n        this.m_clearGeometry.index.setX(baseIndex + 3, baseVertex + 2);\n        this.m_clearGeometry.index.setX(baseIndex + 4, baseVertex + 1);\n        this.m_clearGeometry.index.setX(baseIndex + 5, baseVertex + 3);\n        ++this.m_clearGeometryDrawCount;\n    }\n}\nexports.GlyphTextureCache = GlyphTextureCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\n/** @hidden */\nclass Entry {\n    constructor(key, value, size, newer, older) {\n        this.key = key;\n        this.value = value;\n        this.size = size;\n        this.newer = newer;\n        this.older = older;\n    }\n}\nexports.Entry = Entry;\n/**\n * Fixed size cache that evicts its entries in least-recently-used order when it overflows.\n * Modeled after standard JavaScript `Map` otherwise.\n */\nclass LRUCache {\n    /**\n     * Creates a new instance of `LRUCache`. The optional sizeFunction can be used\n     * fine tune the size required to cache that item.\n     *\n     * @param cacheCapacity The maximum number of entries to store in the cache.\n     * @param sizeFunction A function determining the size per element.\n     */\n    constructor(cacheCapacity, sizeFunction = () => 1) {\n        this.m_size = 0;\n        /**\n         * The internal map object that keeps the key-value pairs and their order.\n         */\n        this.m_map = new Map();\n        /**\n         * The newest entry, i.e. the most recently used item.\n         */\n        this.m_newest = null;\n        /**\n         * The oldest entry, i.e. the least recently used item.\n         */\n        this.m_oldest = null;\n        this.m_capacity = cacheCapacity;\n        this.m_sizeFunction = sizeFunction;\n    }\n    /**\n     * Iterates over all items from the most recently used item to the least recently used one.\n     *\n     * **Note**: Results are undefined if the cache is modified during iteration.\n     *\n     * @param callbackfn The callback to call for each item.\n     * @param thisArg Optional this argument for the callback.\n     */\n    forEach(callbackfn, thisArg) {\n        let entry = this.m_newest;\n        while (entry !== null) {\n            callbackfn.call(thisArg, entry.value, entry.key, this);\n            entry = entry.older;\n        }\n    }\n    /**\n     * The size of the cache, i.e. the sum of all the sizes of all the objects in the cache.\n     *\n     * @returns The size of the cache.\n     */\n    get size() {\n        return this.m_size;\n    }\n    /**\n     * Returns the maximum capacity of the cache, i.e. the maximum number of elements this cache can\n     * contain.\n     *\n     * @returns The capacity of the cache.\n     */\n    get capacity() {\n        return this.m_capacity;\n    }\n    /**\n     * @deprecated - DO NOT USE. Will be removed in future versions.\n     *\n     * Returns the internal map object that keeps the key-value pairs and their order.\n     *\n     * @returns The internal map object.\n     */\n    get map() {\n        // ### TODO - remove me. Cache must not expose its internal object,\n        // modifications to it are fatal for the internal state machine.\n        return this.m_map;\n    }\n    /**\n     * Returns the newest entry in the cache.\n     *\n     * @returns Newest entry in the cache.\n     */\n    get newest() {\n        return this.m_newest;\n    }\n    /**\n     * Returns the oldest entry in the cache.\n     *\n     * Note: Does not promote the oldest item as most recently used item.\n     *\n     * @returns Oldest entry in the cache.\n     */\n    get oldest() {\n        return this.m_oldest;\n    }\n    /**\n     * Resets the capacity of this cache. If `newCapacity` is smaller than the current cache size,\n     * all items will be evicted until the cache shrinks to `newCapacity`.\n     *\n     * @param newCapacity The new capacity of this cache.\n     */\n    setCapacity(newCapacity) {\n        this.m_capacity = newCapacity;\n        this.evict();\n    }\n    /**\n     * Updates the size of all elements in this cache. If their aggregated size is larger than the\n     * capacity, items will be evicted until the cache shrinks to fit the capacity.\n     */\n    shrinkToCapacity() {\n        let size = 0;\n        const sizeFunction = this.m_sizeFunction;\n        let entry = this.m_newest;\n        while (entry !== null) {\n            const entrySize = sizeFunction(entry.value);\n            entry.size = entrySize;\n            size += entrySize;\n            entry = entry.older;\n        }\n        this.m_size = size;\n        this.evict();\n    }\n    /**\n     * Inserts or updates a key/value pair in the cache.\n     *\n     * If the key already existed in the cache, it will be updated and promoted to the most recently\n     * used item.\n     *\n     * If the key didn't exist in the cache, it will be inserted as most recently used item. An\n     * eviction of the least recently used item takes place if the cache exceeded its capacity.\n     *\n     * @param key The key for the key-value pair to insert or update.\n     * @param value The value for the key-value pair to insert or update.\n     */\n    set(key, value) {\n        const valueSize = this.m_sizeFunction(value);\n        let entry = this.m_map.get(key);\n        if (entry !== undefined) {\n            this.m_size = this.m_size - entry.size + valueSize;\n            entry.value = value;\n            entry.size = valueSize;\n            this.promote(entry);\n            this.evict();\n        }\n        else {\n            if (valueSize > this.m_capacity) {\n                return; // single item too big to cache\n            }\n            entry = new Entry(key, value, valueSize, null, null);\n            if (this.m_map.size === 0) {\n                this.m_newest = this.m_oldest = entry;\n            }\n            else {\n                harp_utils_1.assert(this.m_newest !== null);\n                const newest = this.m_newest;\n                entry.older = this.m_newest;\n                newest.newer = entry;\n                this.m_newest = entry;\n            }\n            this.m_map.set(key, entry);\n            this.m_size += valueSize;\n            this.evict();\n        }\n    }\n    /**\n     * Looks up key in the cache and returns the associated value.\n     *\n     * @param key The key to look up.\n     * @returns The associated value, or `undefined` if the key-value pair is not in the cache.\n     */\n    get(key) {\n        const entry = this.m_map.get(key);\n        if (entry === undefined) {\n            return undefined;\n        }\n        this.promote(entry);\n        return entry.value;\n    }\n    /**\n     * Test if a key/value pair is in the cache.\n     *\n     * @param key The key to look up.\n     * @returns `true` if the key-value pair is in the cache, `false` otherwise.\n     */\n    has(key) {\n        return this.m_map.has(key);\n    }\n    /**\n     * Clears the cache and removes all stored key-value pairs.\n     *\n     * Does not call the eviction callback. Use [[evictAll]] to clear the cache and call the\n     * eviction callback.\n     */\n    clear() {\n        this.m_newest = this.m_oldest = null;\n        this.m_size = 0;\n        this.m_map.clear();\n    }\n    /**\n     * Evicts all items from the cache, calling the eviction callback on each item.\n     *\n     * Use [[clear]] to remove all items without calling the eviction callback.\n     */\n    evictAll() {\n        const cb = this.evictionCallback;\n        if (cb !== undefined) {\n            this.forEach((value, key) => cb(key, value));\n        }\n        this.clear();\n    }\n    /**\n     * Explicitly removes a key-value pair from the cache.\n     *\n     * **Note**: This is an explicit removal, thus, the eviction callback will not be called.\n     *\n     * @param key The key of the key-value pair to delete.\n     * @returns `true` if the key-value pair existed and was deleted, `false` otherwise.\n     */\n    delete(key) {\n        const entry = this.m_map.get(key);\n        if (entry === undefined) {\n            return false;\n        }\n        if (entry === this.m_newest) {\n            this.m_newest = entry.older;\n        }\n        else if (entry.newer) {\n            entry.newer.older = entry.older;\n        }\n        else {\n            harp_utils_1.assert(false);\n        }\n        if (entry === this.m_oldest) {\n            this.m_oldest = entry.newer;\n        }\n        else if (entry.older) {\n            entry.older.newer = entry.newer;\n        }\n        else {\n            harp_utils_1.assert(false);\n        }\n        this.m_size -= entry.size;\n        return this.m_map.delete(key);\n    }\n    evict() {\n        while (this.m_oldest !== null && this.m_size > this.m_capacity) {\n            const evicted = this.evictOldest();\n            if (evicted === undefined) {\n                return;\n            }\n        }\n    }\n    evictOldest() {\n        harp_utils_1.assert(this.m_oldest !== null);\n        const oldest = this.m_oldest;\n        harp_utils_1.assert(oldest.older === null);\n        let itemToRemove = oldest;\n        if (this.canEvict !== undefined) {\n            while (!this.canEvict(itemToRemove.key, itemToRemove.value)) {\n                if (itemToRemove.newer === null) {\n                    return undefined;\n                }\n                itemToRemove = itemToRemove.newer;\n            }\n        }\n        if (itemToRemove === oldest) {\n            this.m_oldest = itemToRemove.newer;\n            if (itemToRemove.newer !== null) {\n                harp_utils_1.assert(itemToRemove.newer.older === itemToRemove);\n                itemToRemove.newer.older = null;\n            }\n        }\n        else {\n            if (itemToRemove.newer !== null) {\n                harp_utils_1.assert(itemToRemove.newer.older === itemToRemove);\n                itemToRemove.newer.older = itemToRemove.older;\n                if (itemToRemove.older !== null) {\n                    itemToRemove.older.newer = itemToRemove.newer;\n                }\n            }\n            else {\n                return undefined;\n            }\n        }\n        const isOk = this.m_map.delete(itemToRemove.key);\n        harp_utils_1.assert(isOk === true);\n        if (isOk && this.evictionCallback !== undefined) {\n            this.evictionCallback(itemToRemove.key, itemToRemove.value);\n        }\n        this.m_size -= itemToRemove.size;\n        return itemToRemove;\n    }\n    promote(entry) {\n        if (entry === this.m_newest) {\n            return;\n        } // already newest, nothing to do\n        // re-link newer and older items\n        if (entry.newer) {\n            harp_utils_1.assert(entry.newer.older === entry);\n            entry.newer.older = entry.older;\n        }\n        if (entry.older) {\n            harp_utils_1.assert(entry.older.newer === entry);\n            entry.older.newer = entry.newer;\n        }\n        if (entry === this.m_oldest) {\n            this.m_oldest = entry.newer;\n        }\n        // re-link ourselves\n        entry.newer = null;\n        entry.older = this.m_newest;\n        // finally, set ourselves as the newest entry\n        harp_utils_1.assert(this.m_newest !== null);\n        const newest = this.m_newest;\n        harp_utils_1.assert(newest.newer === null);\n        newest.newer = entry;\n        this.m_newest = entry;\n    }\n}\nexports.LRUCache = LRUCache;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst TextBufferObject_1 = require(\"./rendering/TextBufferObject\");\nconst TextGeometry_1 = require(\"./rendering/TextGeometry\");\nconst TextStyle_1 = require(\"./rendering/TextStyle\");\nconst LineTypesetter_1 = require(\"./typesetting/LineTypesetter\");\nconst PathTypesetter_1 = require(\"./typesetting/PathTypesetter\");\nconst MaterialUtils_1 = require(\"./utils/MaterialUtils\");\nconst tempTextPosition = new THREE.Vector3();\nconst tempTextBounds = {\n    array: [new THREE.Box2()],\n    offset: 0\n};\nlet tempVertexBuffer = new Float32Array();\n/**\n * Default's [[TextCanvas]] layer identifier.\n */\nexports.DEFAULT_TEXT_CANVAS_LAYER = 0;\n/**\n * three.js text rendering engine which can manage and render high-quality, transformable, stylable\n * and properly layout SDF and MSDF text.\n */\nclass TextCanvas {\n    /**\n     * Constructs a new `TextCanvas`.\n     *\n     * @param params `TextCanvas` construction parameters.\n     *\n     * @returns New `TextCanvas`.\n     */\n    constructor(params) {\n        this.m_renderer = params.renderer;\n        this.m_fontCatalog = params.fontCatalog;\n        this.minGlyphCount = params.minGlyphCount;\n        this.maxGlyphCount = params.maxGlyphCount;\n        if (params.material === undefined) {\n            this.m_ownsMaterial = true;\n            this.m_material = MaterialUtils_1.createSdfTextMaterial({ fontCatalog: params.fontCatalog });\n        }\n        else {\n            this.m_ownsMaterial = false;\n            this.m_material = params.material;\n        }\n        if (params.backgroundMaterial === undefined) {\n            this.m_ownsBgMaterial = true;\n            this.m_bgMaterial = MaterialUtils_1.createSdfTextMaterial({\n                fontCatalog: params.fontCatalog,\n                isBackground: true\n            });\n        }\n        else {\n            this.m_ownsBgMaterial = false;\n            this.m_bgMaterial = params.backgroundMaterial;\n        }\n        this.m_defaultLayer = {\n            id: exports.DEFAULT_TEXT_CANVAS_LAYER,\n            storage: new TextGeometry_1.TextGeometry(new THREE.Scene(), this.m_material, this.m_bgMaterial, this.minGlyphCount, this.maxGlyphCount)\n        };\n        this.m_layers = [this.m_defaultLayer];\n        this.m_defaultTextRenderStyle = new TextStyle_1.TextRenderStyle();\n        this.m_currentTextRenderStyle = this.m_defaultTextRenderStyle;\n        this.m_defaultTextLayoutStyle = new TextStyle_1.TextLayoutStyle();\n        this.m_currentTextLayoutStyle = this.m_defaultTextLayoutStyle;\n        this.m_lineTypesetter = new LineTypesetter_1.LineTypesetter();\n        this.m_pathTypesetter = new PathTypesetter_1.PathTypesetter();\n    }\n    /**\n     * Currently active [[FontCatalog]].\n     */\n    get fontCatalog() {\n        return this.m_fontCatalog;\n    }\n    set fontCatalog(value) {\n        this.m_fontCatalog = value;\n        const material = this.m_material;\n        material.uniforms.sdfTexture.value = this.m_fontCatalog.texture;\n        material.uniforms.sdfParams.value = new THREE.Vector4(this.m_fontCatalog.textureSize.x, this.m_fontCatalog.textureSize.y, this.m_fontCatalog.size, this.m_fontCatalog.distanceRange);\n        material.defines.MSDF = this.m_fontCatalog.type === \"msdf\" ? 1.0 : 0.0;\n        const bgMaterial = this.m_bgMaterial;\n        bgMaterial.uniforms.sdfTexture.value = this.m_fontCatalog.texture;\n        bgMaterial.uniforms.sdfParams.value = new THREE.Vector4(this.m_fontCatalog.textureSize.x, this.m_fontCatalog.textureSize.y, this.m_fontCatalog.size, this.m_fontCatalog.distanceRange);\n        bgMaterial.defines.MSDF = this.m_fontCatalog.type === \"msdf\" ? 1.0 : 0.0;\n    }\n    /**\n     * Currently active text rendering material.\n     */\n    get material() {\n        return this.m_material;\n    }\n    set material(value) {\n        if (this.m_ownsMaterial) {\n            this.m_material.dispose();\n            this.m_ownsMaterial = false;\n        }\n        this.m_material = value;\n        for (const layer of this.m_layers) {\n            layer.storage.mesh.material = this.m_material;\n        }\n    }\n    /**\n     * Currently active text background rendering material.\n     */\n    get backgroundMaterial() {\n        return this.m_bgMaterial;\n    }\n    set backgroundMaterial(value) {\n        if (this.m_ownsBgMaterial) {\n            this.m_bgMaterial.dispose();\n            this.m_ownsBgMaterial = false;\n        }\n        this.m_bgMaterial = value;\n        for (const layer of this.m_layers) {\n            layer.storage.backgroundMesh.material = this.m_bgMaterial;\n        }\n    }\n    /**\n     * Currently active text rendering style.\n     */\n    get textRenderStyle() {\n        return this.m_currentTextRenderStyle;\n    }\n    set textRenderStyle(style) {\n        this.m_currentTextRenderStyle = style;\n    }\n    /**\n     * Currently active text layout style.\n     */\n    get textLayoutStyle() {\n        return this.m_currentTextLayoutStyle;\n    }\n    set textLayoutStyle(style) {\n        this.m_currentTextLayoutStyle = style;\n    }\n    /**\n     * Clears all the placed glyphs in this `TextCanvas` (as well as resetting the current style).\n     */\n    clear() {\n        for (const layer of this.m_layers) {\n            layer.storage.clear();\n        }\n        this.m_currentTextRenderStyle = this.m_defaultTextRenderStyle;\n    }\n    /**\n     * Renders the content of this `TextCanvas`.\n     *\n     * @param camera Orthographic camera.\n     * @param target Optional render target.\n     * @param clear Optional render target clear operation.\n     */\n    render(camera, target, clear) {\n        this.m_fontCatalog.update(this.m_renderer);\n        let oldTarget = null;\n        if (target !== undefined) {\n            oldTarget = this.m_renderer.getRenderTarget();\n            this.m_renderer.setRenderTarget(target);\n        }\n        if (clear === true) {\n            this.m_renderer.clear(true);\n        }\n        for (const layer of this.m_layers) {\n            layer.storage.update();\n            this.m_renderer.clear(false, true);\n            this.m_renderer.render(layer.storage.scene, camera);\n        }\n        if (target !== undefined) {\n            this.m_renderer.setRenderTarget(oldTarget);\n        }\n    }\n    /**\n     * Creates a new `TextCanvas` rendering layer and returns. If there was already a layer for the\n     * input `layerId`, it just returns this one instead.\n     *\n     * @param layerId Desired layer identifier.\n     *\n     * @returns Created [[TextCanvasLayer]].\n     */\n    addLayer(layerId) {\n        let result = this.getLayer(layerId);\n        if (result === undefined) {\n            result = {\n                id: layerId,\n                storage: new TextGeometry_1.TextGeometry(new THREE.Scene(), this.m_material, this.m_bgMaterial, this.minGlyphCount, this.maxGlyphCount)\n            };\n            this.m_layers.push(result);\n            this.m_layers.sort((a, b) => {\n                return a.id - b.id;\n            });\n        }\n        return result;\n    }\n    /**\n     * Retrieves a specific `TextCanvas` rendering layer.\n     *\n     * @param layerId Desired layer identifier.\n     *\n     * @returns Selected [[TextCanvasLayer]].\n     */\n    getLayer(layerId) {\n        return this.m_layers.find(layer => layer.id === layerId);\n    }\n    /**\n     * Retrieves all `TextCanvas` rendering layers.\n     *\n     * @returns Array of [[TextCanvasLayer]]s.\n     */\n    getAllLayers() {\n        return this.m_layers;\n    }\n    /**\n     * Returns the computed bounding box for the input text. The current [[TextRenderStyle]] and\n     * [[TextLayoutStyle]] will influence the results of this function.\n     *\n     * @param text Input text. Provide an array of [[GlyphData]] for better performance.\n     * @param outputBounds Output text bounding box.\n     * @param params Optional measurement parameters.\n     *\n     * @returns Result of the measurement. If `false`, some error occurred during execution and the\n     * input text couldn't be properly measured.\n     */\n    measureText(text, outputBounds, params) {\n        tempTextPosition.set(0, 0, 0);\n        let path;\n        let pathOverflow;\n        let upperCaseArray;\n        let outputCharacterBounds;\n        if (params !== undefined) {\n            path = params.path;\n            pathOverflow = params.pathOverflow;\n            outputCharacterBounds = params.outputCharacterBounds;\n            if (params.path !== undefined) {\n                const pathOrigin = params.path.getPoint(0);\n                if (pathOrigin === null) {\n                    return false;\n                }\n                tempTextPosition.set(pathOrigin.x, pathOrigin.y, 0.0);\n            }\n            if (params.letterCaseArray) {\n                upperCaseArray = params.letterCaseArray;\n            }\n        }\n        return this.placeText({\n            input: text,\n            layer: this.m_defaultLayer,\n            textPath: path,\n            textPathOverflow: pathOverflow,\n            bounds: outputBounds,\n            individualBounds: outputCharacterBounds,\n            letterCaseArray: upperCaseArray\n        });\n    }\n    /**\n     * Adds the input text to this `TextCanvas` in the specified screen position. The current\n     * [[TextRenderStyle]] and [[TextLayoutStyle]] will influence the results of this function.\n     *\n     * @param text Input text. Provide an array of [[GlyphData]] for better performance.\n     * @param position Screen position.\n     * @param params Optional addition parameters.\n     *\n     * @returns Result of the addition. If `false`, some error occurred during execution and the\n     * input text couldn't be properly added.\n     */\n    addText(text, position, params) {\n        tempTextPosition.copy(position);\n        let path;\n        let pathOverflow;\n        let upperCaseArray;\n        let targetLayer = this.m_defaultLayer;\n        if (params !== undefined) {\n            path = params.path;\n            pathOverflow = params.pathOverflow;\n            if (params.layer !== undefined) {\n                let tempLayer = this.getLayer(params.layer);\n                if (tempLayer === undefined) {\n                    tempLayer = this.addLayer(params.layer);\n                }\n                targetLayer = tempLayer;\n            }\n            if (params.path !== undefined) {\n                tempTextPosition.set(0, 0, tempTextPosition.z);\n            }\n            if (params.letterCaseArray) {\n                upperCaseArray = params.letterCaseArray;\n            }\n        }\n        const prevDrawCount = targetLayer.storage.drawCount;\n        const result = this.placeText({\n            input: text,\n            textPath: path,\n            textPathOverflow: pathOverflow,\n            layer: targetLayer,\n            letterCaseArray: upperCaseArray\n        });\n        if (result && params !== undefined) {\n            if (params.updatePosition === true) {\n                position.copy(tempTextPosition);\n            }\n            if (params.pickingData !== undefined) {\n                targetLayer.storage.addPickingData(prevDrawCount, targetLayer.storage.drawCount, params.pickingData);\n            }\n        }\n        else if (!result) {\n            targetLayer.storage.m_drawCount = prevDrawCount;\n        }\n        return result;\n    }\n    /**\n     * Creates a new [[TextBufferObject]]. The computed text vertex buffer is equivalent to the\n     * result of performing the `addText` function for the input text in the screen origin.\n     *\n     * @param text Input text. Provide an array of [[GlyphData]] for better performance.\n     * @param params Optional creation parameters.\n     *\n     * @returns New [[TextBufferObject]] (or `undefined` if requested text glyphs couldn't be\n     * retrieved from the current [[FontCatalog]]).\n     */\n    createTextBufferObject(text, params) {\n        tempTextPosition.set(0, 0, 0);\n        let glyphArray;\n        let upperCaseArray;\n        const smallCapsEnabled = this.m_currentTextRenderStyle.fontVariant === TextStyle_1.FontVariant.SmallCaps;\n        if (typeof text !== \"string\") {\n            glyphArray = text;\n            if (params !== undefined && params.letterCaseArray) {\n                upperCaseArray = params.letterCaseArray;\n            }\n        }\n        else {\n            upperCaseArray = [];\n            glyphArray = this.m_fontCatalog.getGlyphs(text, this.m_currentTextRenderStyle, smallCapsEnabled ? upperCaseArray : undefined);\n            if (glyphArray === undefined) {\n                return undefined;\n            }\n        }\n        let path;\n        let pathOverflow;\n        let textBounds;\n        let characterBounds;\n        let renderStyle;\n        let layoutStyle;\n        if (params !== undefined) {\n            path = params.path;\n            pathOverflow = params.pathOverflow;\n            if (params.outputBounds === true) {\n                textBounds = new THREE.Box2();\n            }\n            if (params.outputCharacterBounds === true) {\n                characterBounds = [];\n            }\n            if (params.storeStyles === true) {\n                renderStyle = this.m_currentTextRenderStyle;\n                layoutStyle = this.m_currentTextLayoutStyle;\n            }\n        }\n        this.placeText({\n            input: text,\n            layer: this.m_defaultLayer,\n            computeTextBuffer: true,\n            textPath: path,\n            textPathOverflow: pathOverflow,\n            bounds: textBounds,\n            individualBounds: characterBounds,\n            letterCaseArray: upperCaseArray\n        });\n        return new TextBufferObject_1.TextBufferObject(glyphArray, new Float32Array(tempVertexBuffer), textBounds, characterBounds, renderStyle, layoutStyle);\n    }\n    /**\n     * Adds a previously created [[TextBufferObject]] to the `TextCanvas`. Additional parameters can\n     * be provided to override the attributes stored in the buffer.\n     *\n     * @param textBufferObject [[TextBufferObject]] to add.\n     * @param params Optional addition parameters.\n     *\n     * @returns Result of the addition. If `false`, some error occurred during execution and the\n     * input text couldn't be properly added.\n     */\n    addTextBufferObject(textBufferObject, params) {\n        let targetLayer = this.m_defaultLayer;\n        let position;\n        let scale;\n        let rotation;\n        let color;\n        let opacity;\n        let bgColor;\n        let bgOpacity;\n        if (params !== undefined) {\n            if (params.layer !== undefined) {\n                let tempLayer = this.getLayer(params.layer);\n                if (tempLayer === undefined) {\n                    tempLayer = this.addLayer(params.layer);\n                }\n                targetLayer = tempLayer;\n            }\n            position = params.position;\n            scale = params.scale;\n            rotation = params.rotation;\n            color = params.color;\n            opacity = params.opacity;\n            bgColor = params.backgroundColor;\n            bgOpacity = params.backgroundOpacity;\n        }\n        const prevDrawCount = targetLayer.storage.drawCount;\n        const result = targetLayer.storage.addTextBufferObject(textBufferObject, position, scale, rotation, color, opacity, bgColor, bgOpacity);\n        if (result && params !== undefined) {\n            if (params.pickingData !== undefined) {\n                targetLayer.storage.addPickingData(prevDrawCount, targetLayer.storage.drawCount, params.pickingData);\n            }\n        }\n        else if (!result) {\n            targetLayer.storage.m_drawCount = prevDrawCount;\n        }\n        return result;\n    }\n    /**\n     * Executes the `pickCallback` for all previously stored picking data for text covering the\n     * specified screen position.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickCallback Callback to be called for every picked element.\n     */\n    pickText(position, callback) {\n        for (const layer of this.m_layers) {\n            layer.storage.pick(position, callback);\n        }\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `TextCanvas`.\n     *\n     * @param info The info object to increment with the values from this `TextCanvas`.\n     */\n    getMemoryUsage(info) {\n        this.m_fontCatalog.updateMemoryUsage(info);\n        for (const layer of this.m_layers) {\n            layer.storage.updateMemoryUsage(info);\n        }\n    }\n    // Places all glyphs for input text. Depending on parameters, it can store the resulting glyphs\n    // in the current [[TextGeometry]] (or into a separate buffer) or compute the bounding box for\n    // the input (as a whole or on a per-character basis).\n    placeText(params) {\n        if (params.input.length === 0 || this.m_currentTextLayoutStyle.maxLines === 0) {\n            if (params.bounds !== undefined) {\n                params.bounds.min.set(0, 0);\n                params.bounds.max.set(0, 0);\n            }\n            if (params.individualBounds !== undefined) {\n                params.individualBounds.length = 0;\n            }\n            return true;\n        }\n        let glyphArray;\n        let smallCapsTransformations;\n        const smallCapsEnabled = this.m_currentTextRenderStyle.fontVariant === TextStyle_1.FontVariant.SmallCaps;\n        if (typeof params.input !== \"string\") {\n            glyphArray = params.input;\n            if (params.letterCaseArray) {\n                smallCapsTransformations = params.letterCaseArray;\n            }\n        }\n        else {\n            smallCapsTransformations = [];\n            glyphArray = this.m_fontCatalog.getGlyphs(params.input, this.m_currentTextRenderStyle, smallCapsEnabled ? smallCapsTransformations : undefined);\n            if (glyphArray === undefined) {\n                return false;\n            }\n        }\n        let glyphBounds;\n        if (params.individualBounds !== undefined) {\n            tempTextBounds.array = params.individualBounds;\n            tempTextBounds.offset = 0;\n            glyphBounds = tempTextBounds;\n        }\n        if (params.bounds !== undefined) {\n            params.bounds.min.set(Infinity, Infinity);\n            params.bounds.max.set(-Infinity, -Infinity);\n        }\n        if (params.computeTextBuffer === true) {\n            tempVertexBuffer = new Float32Array(glyphArray.length * TextGeometry_1.QUAD_VERTEX_MEMORY_FOOTPRINT);\n        }\n        const isPath = params.textPath !== undefined;\n        const typesettingParams = {\n            glyphs: glyphArray,\n            fontCatalog: this.m_fontCatalog,\n            textRenderStyle: this.m_currentTextRenderStyle,\n            textLayoutStyle: this.m_currentTextLayoutStyle,\n            position: tempTextPosition,\n            geometry: params.layer.storage,\n            smallCapsArray: smallCapsEnabled ? smallCapsTransformations : undefined,\n            globalBounds: params.bounds,\n            individualBounds: glyphBounds,\n            vertexBuffer: params.computeTextBuffer === true ? tempVertexBuffer : undefined\n        };\n        let result = true;\n        if (isPath) {\n            Object.assign(typesettingParams, {\n                path: params.textPath,\n                pathOverflow: params.textPathOverflow === true\n            });\n            result = this.m_pathTypesetter.arrangeGlyphs(typesettingParams);\n        }\n        else {\n            result = this.m_lineTypesetter.arrangeGlyphs(typesettingParams);\n        }\n        if (glyphBounds !== undefined) {\n            glyphBounds.array.length = glyphBounds.offset;\n        }\n        return result;\n    }\n}\nexports.TextCanvas = TextCanvas;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst TextGeometry_1 = require(\"../rendering/TextGeometry\");\nconst TextStyle_1 = require(\"../rendering/TextStyle\");\nconst TypesettingUtils_1 = require(\"../utils/TypesettingUtils\");\nconst UnicodeUtils_1 = require(\"../utils/UnicodeUtils\");\n/**\n * @hidden\n * [[Typesetter]] implementation that handles multi-line complex layout text.\n */\nclass LineTypesetter {\n    /**\n     * Creates a `LineTypesetter` object.\n     *\n     * @returns New `LineTypesetter`.\n     */\n    constructor() {\n        this.m_tempTransform = new THREE.Matrix3();\n        this.m_tempCorners = [\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3()\n        ];\n        this.m_tempLineDirection = UnicodeUtils_1.UnicodeUtils.Direction.LTR;\n        this.m_tempRunDirection = UnicodeUtils_1.UnicodeUtils.Direction.LTR;\n        this.m_tempPixelSize = 1.0;\n        this.m_tempPixelBgSize = 1.0;\n        this.m_tempScale = 1.0;\n        this.m_tempSmallCaps = false;\n    }\n    /**\n     * Arranges the specified glyphs using this `LineTypesetter`. Text will be placed into multiple\n     * bidirectional lines, that will be generated taking into account [[textLayoutStyle]] features,\n     * such as:\n     * - Maximum line width.\n     * - Word and character wrapping.\n     * - Maximum number of lines.\n     * - Vertical and horizontal alignment.\n     * - Leading (spacing between lines).\n     *\n     * @param params Typesetting parameters.\n     *\n     * @returns If `false`, some error occurred during execution and the output should be dismissed.\n     */\n    arrangeGlyphs(params) {\n        // Initializes common typesetting parameters (used across all functions in this class).\n        this.m_currentParams = params;\n        this.m_tempLineDirection = TypesettingUtils_1.TypesettingUtils.getDirection(this.m_currentParams.glyphs, 0);\n        this.m_tempRunDirection = this.m_tempLineDirection;\n        this.m_tempPixelSize = TypesettingUtils_1.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size, this.m_currentParams.textRenderStyle.fontSize.unit, this.m_currentParams.fontCatalog.size);\n        this.m_tempScale = this.m_tempPixelSize / this.m_currentParams.fontCatalog.size;\n        this.m_tempPixelBgSize = Math.min(TypesettingUtils_1.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize, this.m_currentParams.textRenderStyle.fontSize.unit, this.m_currentParams.fontCatalog.size), this.m_currentParams.fontCatalog.distanceRange * this.m_tempScale);\n        this.m_tempSmallCaps = this.m_currentParams.smallCapsArray !== undefined;\n        this.m_currentParams.position.y +=\n            this.m_currentParams.textLayoutStyle.verticalAlignment *\n                this.m_currentParams.glyphs[0].font.metrics.capHeight *\n                this.m_tempScale;\n        const isOnlyMeasured = this.m_currentParams.globalBounds !== undefined &&\n            this.m_currentParams.vertexBuffer === undefined;\n        // Compute line origin and height.\n        const origin = this.m_currentParams.position.x;\n        const lineHeight = this.m_currentParams.glyphs[0].font.metrics.lineHeight +\n            this.m_currentParams.textLayoutStyle.leading;\n        // Initialize line-breaking and wrapping variables.\n        let lineStartIdx = 0;\n        let glyphWrapIdx = 0;\n        let wordWrapIdx = 0;\n        let lineStartX = 0;\n        let lineCurrX = 0;\n        let glyphWrapX = 0;\n        let wordWrapX = 0;\n        let lineCount = 0;\n        let isBidirectionalLine = false;\n        for (let i = 0; i < this.m_currentParams.glyphs.length; ++i) {\n            if (lineCount > this.m_currentParams.textLayoutStyle.maxLines - 1) {\n                break;\n            }\n            const glyphData = this.m_currentParams.glyphs[i];\n            if (!glyphData.isInCache && !isOnlyMeasured) {\n                return false;\n            }\n            const isNewLine = UnicodeUtils_1.UnicodeUtils.isNewLine(glyphData.codePoint);\n            const isWhiteSpace = UnicodeUtils_1.UnicodeUtils.isWhiteSpace(glyphData.codePoint);\n            // Check if this line should be treated as bidirectional.\n            if (!isBidirectionalLine && glyphData.direction === -this.m_tempLineDirection) {\n                isBidirectionalLine = true;\n            }\n            // Advance the line's current X offset (only for printable characters).\n            if (UnicodeUtils_1.UnicodeUtils.isPrintable(glyphData.codePoint)) {\n                lineCurrX +=\n                    (glyphData.advanceX + this.m_currentParams.textLayoutStyle.tracking) *\n                        this.m_tempScale *\n                        (this.m_tempSmallCaps\n                            ? TypesettingUtils_1.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs, this.m_currentParams.smallCapsArray, i, this.m_currentParams.textRenderStyle.fontVariant)\n                            : 1.0);\n            }\n            // If this is the first character in a line, update the line's X offset values (needed\n            // to properly center and wrap).\n            if (i === lineStartIdx) {\n                lineStartX = lineCurrX;\n                glyphWrapX = lineCurrX;\n                wordWrapX = lineCurrX;\n            }\n            // Check if should break the current line.\n            if (isNewLine ||\n                (this.m_currentParams.textLayoutStyle.wrappingMode !== TextStyle_1.WrappingMode.None &&\n                    lineCurrX > this.m_currentParams.textLayoutStyle.lineWidth)) {\n                // Perform wrapping.\n                if (this.m_currentParams.textLayoutStyle.wrappingMode !== TextStyle_1.WrappingMode.None) {\n                    let wrapPointIdx = glyphWrapIdx;\n                    let wrapPointX = glyphWrapX;\n                    // Only wrap words when more than a single word fits into the current line.\n                    if (this.m_currentParams.textLayoutStyle.wrappingMode === TextStyle_1.WrappingMode.Word &&\n                        wordWrapX !== lineStartX) {\n                        wrapPointIdx = wordWrapIdx;\n                        wrapPointX = wordWrapX;\n                    }\n                    lineCurrX = wrapPointX;\n                    i = Math.min(isNewLine ? (lineStartIdx === i ? wrapPointIdx : i) : wrapPointIdx, this.m_currentParams.glyphs.length - 1);\n                }\n                // Calculate the correct starting position for the line base on alignment, and place\n                // all glyphs in it.\n                const lineAlignment = this.m_tempLineDirection === UnicodeUtils_1.UnicodeUtils.Direction.RTL && isBidirectionalLine\n                    ? 1.0 + this.m_currentParams.textLayoutStyle.horizontalAlignment\n                    : this.m_currentParams.textLayoutStyle.horizontalAlignment;\n                this.m_currentParams.position.x =\n                    this.m_currentParams.position.x + lineCurrX * lineAlignment;\n                if (!this.placeLine(lineStartIdx, i, this.m_tempLineDirection, isBidirectionalLine)) {\n                    return false;\n                }\n                // Update the line position.\n                this.m_currentParams.position.y -= lineHeight * this.m_tempScale;\n                this.m_currentParams.position.x = origin;\n                // Find the beginning of a new line (removing trailing white spaces).\n                while (i !== lineStartIdx &&\n                    i + 1 < this.m_currentParams.glyphs.length &&\n                    UnicodeUtils_1.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[i + 1].codePoint)) {\n                    ++i;\n                }\n                lineStartIdx = i + 1;\n                if (lineStartIdx === this.m_currentParams.glyphs.length) {\n                    break;\n                }\n                // Only reset the line's direction when a new line character is found (to keep\n                // correct bidirectional behaviour when a bidirectional run is placed between\n                // multiple lines).\n                if (isNewLine) {\n                    this.m_tempLineDirection = TypesettingUtils_1.TypesettingUtils.getDirection(this.m_currentParams.glyphs, lineStartIdx);\n                    this.m_tempRunDirection = this.m_tempLineDirection;\n                }\n                // Reset the line placement parameters.\n                lineStartX = 0;\n                lineCurrX = 0;\n                glyphWrapIdx = lineStartIdx;\n                glyphWrapX = 0;\n                wordWrapIdx = lineStartIdx;\n                wordWrapX = 0;\n                isBidirectionalLine = false;\n                lineCount++;\n            }\n            // If not, should if we should record any new wrapping points.\n            else if (this.m_currentParams.textLayoutStyle.wrappingMode !== TextStyle_1.WrappingMode.None &&\n                !isWhiteSpace) {\n                // Update the per-glyph wrapping point.\n                glyphWrapIdx = i;\n                glyphWrapX = lineCurrX;\n                // Update the word wrapping point (only if mode is correctly set and we are\n                // currently placed at the end of a word).\n                if (this.m_currentParams.textLayoutStyle.wrappingMode === TextStyle_1.WrappingMode.Word &&\n                    i + 1 < this.m_currentParams.glyphs.length &&\n                    (UnicodeUtils_1.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[i + 1].codePoint) ||\n                        UnicodeUtils_1.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[i + 1].codePoint))) {\n                    wordWrapIdx = i;\n                    wordWrapX = lineCurrX;\n                }\n            }\n        }\n        // If we still haven't placed all characters, place a final line.\n        if (lineCount <= this.m_currentParams.textLayoutStyle.maxLines - 1 &&\n            lineStartIdx <= this.m_currentParams.glyphs.length - 1) {\n            const offset = this.m_tempLineDirection === UnicodeUtils_1.UnicodeUtils.Direction.RTL && isBidirectionalLine\n                ? 1.0 + this.m_currentParams.textLayoutStyle.horizontalAlignment\n                : this.m_currentParams.textLayoutStyle.horizontalAlignment;\n            this.m_currentParams.position.setX(this.m_currentParams.position.x + lineCurrX * offset);\n            if (!this.placeLine(lineStartIdx, this.m_currentParams.glyphs.length - 1, this.m_tempLineDirection, isBidirectionalLine)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    // Place characters alongside a line. Text direction is taken into account, and text is broken\n    // into directional runs.\n    placeLine(startIdx, endIdx, direction, isBidirectional) {\n        // If the line is not bidirectional, place it as a single directional run.\n        if (!isBidirectional) {\n            return this.placeRun(startIdx, endIdx, direction);\n        }\n        // Gather common typesetting parameters.\n        const glyphDataArray = this.m_currentParams.glyphs;\n        const smallCapsArray = this.m_currentParams.smallCapsArray;\n        const textRenderStyle = this.m_currentParams.textRenderStyle;\n        const textLayoutStyle = this.m_currentParams.textLayoutStyle;\n        const position = this.m_currentParams.position;\n        // Initialize line placement parameters.\n        const isRTL = direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL;\n        const origin = position.x;\n        let offset = 0;\n        let runStart = startIdx;\n        for (let i = startIdx; i <= endIdx; ++i) {\n            const glyphData = glyphDataArray[i];\n            // If the current glyph changes the line direction, place the current run.\n            if (glyphData.direction === -this.m_tempRunDirection) {\n                if (isRTL) {\n                    position.x = origin + offset;\n                }\n                if (!this.placeRun(runStart, i - 1, this.m_tempRunDirection)) {\n                    return false;\n                }\n                if (!isRTL) {\n                    position.x = origin + offset;\n                }\n                runStart = i;\n                this.m_tempRunDirection *= -1.0;\n            }\n            // If the current glyph has neutral direction (i.e. white space) and we're in the middle\n            // of a run with direction opposite to the line's main direction, check for the closest\n            // strong direction in the run.\n            else if (glyphData.direction === UnicodeUtils_1.UnicodeUtils.Direction.Neutral &&\n                this.m_tempRunDirection === -direction) {\n                let neutralIdx = i;\n                while (neutralIdx + 1 < glyphDataArray.length &&\n                    Math.abs(glyphDataArray[neutralIdx].direction) !== 1) {\n                    ++neutralIdx;\n                }\n                // If the closest strong direction in the run is not the current run's direction,\n                // place the current run.\n                if (glyphDataArray[neutralIdx].direction !== this.m_tempRunDirection) {\n                    if (isRTL) {\n                        position.x = origin + offset;\n                    }\n                    if (!this.placeRun(runStart, i - 1, this.m_tempRunDirection)) {\n                        return false;\n                    }\n                    if (!isRTL) {\n                        position.x = origin + offset;\n                    }\n                    runStart = i;\n                    this.m_tempRunDirection *= -1.0;\n                }\n            }\n            // Advance the offset position in the line.\n            offset +=\n                (glyphData.advanceX + textLayoutStyle.tracking) *\n                    this.m_tempScale *\n                    (this.m_tempSmallCaps\n                        ? TypesettingUtils_1.TypesettingUtils.getSmallCapsScale(glyphDataArray, smallCapsArray, i, textRenderStyle.fontVariant)\n                        : 1.0) *\n                    direction;\n        }\n        // If we still haven't placed all characters in the line, place a final run.\n        if (runStart <= endIdx) {\n            if (isRTL) {\n                position.x = origin + offset;\n            }\n            if (!this.placeRun(runStart, endIdx, this.m_tempRunDirection)) {\n                return false;\n            }\n            if (!isRTL) {\n                position.x = origin + offset;\n            }\n        }\n        return true;\n    }\n    // Place a directional run of index inside a line.\n    placeRun(startIdx, endIdx, direction) {\n        // Gather common typesetting parameters.\n        const glyphDataArray = this.m_currentParams.glyphs;\n        const smallCapsArray = this.m_currentParams.smallCapsArray;\n        const fontCatalog = this.m_currentParams.fontCatalog;\n        const textRenderStyle = this.m_currentParams.textRenderStyle;\n        const textLayoutStyle = this.m_currentParams.textLayoutStyle;\n        const position = this.m_currentParams.position;\n        const geometry = this.m_currentParams.geometry;\n        const globalBounds = this.m_currentParams.globalBounds;\n        const individualBounds = this.m_currentParams.individualBounds;\n        const vertexBuffer = this.m_currentParams.vertexBuffer;\n        // Move through the glyph array following the run's direction (as the order of the glyphs in\n        // memory might not match the order on glyphs on scree).\n        const start = direction === UnicodeUtils_1.UnicodeUtils.Direction.LTR ? startIdx : endIdx;\n        const end = direction === UnicodeUtils_1.UnicodeUtils.Direction.LTR ? endIdx : startIdx;\n        for (let i = start; direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL ? i >= end : i <= end; i += direction) {\n            // Only process printable characters.\n            const glyphData = glyphDataArray[i];\n            if (!UnicodeUtils_1.UnicodeUtils.isPrintable(glyphData.codePoint)) {\n                continue;\n            }\n            // When placing a RTL run, we need to check for weak runs (numerical runs of characters\n            // that don't change the overall run direction, but should always be displayed as LTR\n            // text).\n            if (startIdx !== endIdx &&\n                i !== 0 &&\n                direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL &&\n                glyphData.direction === UnicodeUtils_1.UnicodeUtils.Direction.Weak) {\n                let weakRunStart = i;\n                let weakGlyph = glyphDataArray[weakRunStart - 1];\n                while (weakRunStart !== startIdx &&\n                    (weakGlyph.direction === UnicodeUtils_1.UnicodeUtils.Direction.Weak ||\n                        (weakGlyph.direction === UnicodeUtils_1.UnicodeUtils.Direction.Neutral &&\n                            !UnicodeUtils_1.UnicodeUtils.isWhiteSpace(weakGlyph.codePoint)))) {\n                    --weakRunStart;\n                    weakGlyph = glyphDataArray[weakRunStart - 1];\n                }\n                this.placeRun(Math.max(weakRunStart, startIdx), i, UnicodeUtils_1.UnicodeUtils.Direction.LTR);\n                i = weakRunStart;\n                continue;\n            }\n            // Compute various rendering parameters for this glyph.\n            const glyphFont = glyphData.font;\n            const glyphFontMetrics = glyphFont.metrics;\n            const fontStyle = textRenderStyle.fontStyle;\n            const isBoldEmulated = (fontStyle === TextStyle_1.FontStyle.Bold && glyphFont.bold === undefined) ||\n                (fontStyle === TextStyle_1.FontStyle.BoldItalic &&\n                    glyphFont.bold === undefined &&\n                    glyphFont.boldItalic === undefined);\n            const isItalicEmulated = (fontStyle === TextStyle_1.FontStyle.Italic && glyphFont.italic === undefined) ||\n                (fontStyle === TextStyle_1.FontStyle.BoldItalic &&\n                    glyphFont.italic === undefined &&\n                    glyphFont.boldItalic === undefined);\n            const isSmallCaps = this.m_tempSmallCaps\n                ? smallCapsArray[i] && textRenderStyle.fontVariant === TextStyle_1.FontVariant.SmallCaps\n                : false;\n            const smallCapsScale = isSmallCaps\n                ? glyphFontMetrics.xHeight / glyphFontMetrics.capHeight\n                : 1.0;\n            const glyphScale = this.m_tempScale * smallCapsScale;\n            const emulationWeight = ((isBoldEmulated ? 0.02 : 0.0) + (isSmallCaps ? 0.01 : 0.0)) *\n                (fontCatalog.size / fontCatalog.distanceRange);\n            const bgWeight = (0.5 * this.m_tempPixelBgSize) /\n                (fontCatalog.distanceRange * Math.max(glyphScale, 1.0));\n            const isMirrored = UnicodeUtils_1.UnicodeUtils.isRtlMirrored(glyphData.codePoint) &&\n                direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL;\n            const verticalOffset = glyphFontMetrics.lineHeight -\n                glyphFontMetrics.base -\n                glyphFontMetrics.distanceRange * 0.5;\n            // Compute the glyphs transformation matrix and apply to all corners of a glyph.\n            TypesettingUtils_1.TypesettingUtils.computeGlyphTransform(this.m_tempTransform, position, glyphScale, textLayoutStyle.lineRotation, textRenderStyle.rotation);\n            for (let j = 0; j < 4; ++j) {\n                const glyphVertexPosition = glyphData.positions[j];\n                const horizontalOffset = isItalicEmulated && j > 1\n                    ? TypesettingUtils_1.TypesettingUtils.OBLIQUE_OFFSET * glyphFontMetrics.size\n                    : 0.0;\n                this.m_tempCorners[j].set(glyphVertexPosition.x + horizontalOffset, glyphVertexPosition.y - verticalOffset, glyphVertexPosition.z);\n                this.m_tempCorners[j].applyMatrix3(this.m_tempTransform);\n            }\n            // Depending on the typesetting options, add the computed glyph to the TextGeometry or\n            // update the text bounds.\n            if (globalBounds === undefined && vertexBuffer === undefined) {\n                if (!geometry.add(glyphData, this.m_tempCorners, emulationWeight, emulationWeight + bgWeight, isMirrored, textRenderStyle)) {\n                    return false;\n                }\n            }\n            else {\n                if (globalBounds !== undefined) {\n                    TypesettingUtils_1.TypesettingUtils.updateBounds(this.m_tempCorners, globalBounds, individualBounds);\n                }\n                if (vertexBuffer !== undefined) {\n                    geometry.addToBuffer(vertexBuffer, i * TextGeometry_1.QUAD_VERTEX_MEMORY_FOOTPRINT, glyphData, this.m_tempCorners, emulationWeight, emulationWeight + bgWeight, isMirrored, textRenderStyle);\n                }\n            }\n            // Advance the current position and proceed to next glyph in the run.\n            position.x += (glyphData.advanceX + textLayoutStyle.tracking) * glyphScale;\n        }\n        return true;\n    }\n}\nexports.LineTypesetter = LineTypesetter;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst TextGeometry_1 = require(\"../rendering/TextGeometry\");\nconst TextStyle_1 = require(\"../rendering/TextStyle\");\nconst TypesettingUtils_1 = require(\"../utils/TypesettingUtils\");\nconst UnicodeUtils_1 = require(\"../utils/UnicodeUtils\");\n/**\n * @hidden\n * [[Typesetter]] implementation that arranges glyphs alongside a specified path.\n */\nclass PathTypesetter {\n    /**\n     * Creates a `PathTypesetter` object.\n     *\n     * @returns New `PathTypesetter`.\n     */\n    constructor() {\n        this.m_tempTransform = new THREE.Matrix3();\n        this.m_tempCorners = [\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3()\n        ];\n        this.m_tempLineDirection = UnicodeUtils_1.UnicodeUtils.Direction.LTR;\n        this.m_tempRunDirection = UnicodeUtils_1.UnicodeUtils.Direction.LTR;\n        this.m_tempPixelSize = 1.0;\n        this.m_tempPixelBgSize = 1.0;\n        this.m_tempScale = 1.0;\n        this.m_tempSmallCaps = false;\n        this.m_tempPathPosition = new THREE.Vector3();\n        this.m_tempPathLength = 0.0;\n        this.m_tempPathOffset = 0.0;\n    }\n    /**\n     * Arranges the specified glyphs using this `PathTypesetter`. Text will be placed into a single\n     * bidirectional line that follows the specified path. Characters will be orientated and placed\n     * alongside this path following [[TextLayout]]'s [[VerticalAlignment]] and\n     * [[HorizontalAlignment]].\n     *\n     * @param params Typesetting parameters.\n     *\n     * @returns If `false`, some error occurred during execution and the output should be dismissed.\n     */\n    arrangeGlyphs(params) {\n        // Initializes common typesetting parameters (used across all functions in this class).\n        this.m_currentParams = params;\n        this.m_tempLineDirection = TypesettingUtils_1.TypesettingUtils.getDirection(this.m_currentParams.glyphs, 0);\n        this.m_tempRunDirection = this.m_tempLineDirection;\n        this.m_tempPixelSize = TypesettingUtils_1.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size, this.m_currentParams.textRenderStyle.fontSize.unit, this.m_currentParams.fontCatalog.size);\n        this.m_tempScale = this.m_tempPixelSize / this.m_currentParams.fontCatalog.size;\n        this.m_tempPixelBgSize = Math.min(TypesettingUtils_1.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize, this.m_currentParams.textRenderStyle.fontSize.unit, this.m_currentParams.fontCatalog.size), this.m_currentParams.fontCatalog.distanceRange * this.m_tempScale);\n        this.m_tempSmallCaps = this.m_currentParams.smallCapsArray !== undefined;\n        this.m_tempPathLength = this.m_currentParams.path.getLength();\n        this.m_tempPathOffset = 0.0;\n        const isOnlyMeasured = this.m_currentParams.globalBounds !== undefined &&\n            this.m_currentParams.vertexBuffer === undefined;\n        // To be able to properly set the horizontal alignment on a path, we need to first retrieve\n        // how much of the path the input text covers, so we can calculate the correct initial\n        // offset.\n        let isBidirectional = false;\n        let pathWidth = 0.0;\n        for (let i = 0; i < this.m_currentParams.glyphs.length; ++i) {\n            const glyphData = this.m_currentParams.glyphs[i];\n            if (!glyphData.isInCache && !isOnlyMeasured) {\n                return false;\n            }\n            if (!UnicodeUtils_1.UnicodeUtils.isPrintable(glyphData.codePoint)) {\n                continue;\n            }\n            if (!isBidirectional && glyphData.direction === -this.m_tempLineDirection) {\n                isBidirectional = true;\n            }\n            pathWidth +=\n                (glyphData.advanceX + this.m_currentParams.textLayoutStyle.tracking) *\n                    this.m_tempScale *\n                    (this.m_tempSmallCaps\n                        ? TypesettingUtils_1.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs, this.m_currentParams.smallCapsArray, i, this.m_currentParams.textRenderStyle.fontVariant)\n                        : 1.0);\n        }\n        this.m_tempPathOffset = Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment +\n            (this.m_currentParams.textLayoutStyle.horizontalAlignment * pathWidth) /\n                this.m_tempPathLength, 0), 1);\n        // Place the input text as a single path line.\n        return this.placeLine(this.m_tempLineDirection, isBidirectional);\n    }\n    // Place characters alongside a path line. Text direction is taken into account, and text is\n    // broken into directional runs.\n    placeLine(direction, isBidirectional) {\n        // If the line is not bidirectional, place it as a single directional run.\n        if (!isBidirectional) {\n            return this.placeRun(0, this.m_currentParams.glyphs.length - 1, direction);\n        }\n        // Gather common typesetting parameters.\n        const glyphDataArray = this.m_currentParams.glyphs;\n        // Initialize line placement parameters.\n        let runStart = 0;\n        for (let i = runStart; i < glyphDataArray.length; ++i) {\n            const glyphData = glyphDataArray[i];\n            // If the current glyph changes the line direction, place the current run.\n            if (glyphData.direction === -this.m_tempRunDirection) {\n                if (!this.placeRun(runStart, i - 1, this.m_tempRunDirection)) {\n                    return false;\n                }\n                runStart = i;\n                this.m_tempRunDirection *= -1.0;\n            }\n            // If the current glyph has neutral direction (i.e. white space) and we're in the middle\n            // of a run with direction opposite to the line's main direction, check for the closest\n            // strong direction in the run.\n            else if (glyphData.direction === UnicodeUtils_1.UnicodeUtils.Direction.Neutral &&\n                this.m_tempRunDirection === -direction) {\n                let neutralIdx = i;\n                while (neutralIdx + 1 < glyphDataArray.length &&\n                    Math.abs(glyphDataArray[neutralIdx].direction) !== 1) {\n                    ++neutralIdx;\n                }\n                // If the closest strong direction in the run is not the current run's direction,\n                // place the current run.\n                if (glyphDataArray[neutralIdx].direction !== this.m_tempRunDirection) {\n                    if (!this.placeRun(runStart, i - 1, this.m_tempRunDirection)) {\n                        return false;\n                    }\n                    runStart = i;\n                    this.m_tempRunDirection *= -1.0;\n                }\n            }\n        }\n        // If we still haven't placed all characters in the line, place a final run.\n        if (runStart < glyphDataArray.length) {\n            if (!this.placeRun(runStart, glyphDataArray.length - 1, this.m_tempRunDirection)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    // Place a directional run of index inside a path line.\n    placeRun(startIdx, endIdx, direction) {\n        // Gather common typesetting parameters.\n        const glyphDataArray = this.m_currentParams.glyphs;\n        const smallCapsArray = this.m_currentParams.smallCapsArray;\n        const fontCatalog = this.m_currentParams.fontCatalog;\n        const textRenderStyle = this.m_currentParams.textRenderStyle;\n        const textLayoutStyle = this.m_currentParams.textLayoutStyle;\n        const position = this.m_currentParams.position;\n        const geometry = this.m_currentParams.geometry;\n        const globalBounds = this.m_currentParams.globalBounds;\n        const individualBounds = this.m_currentParams.individualBounds;\n        const vertexBuffer = this.m_currentParams.vertexBuffer;\n        const path = this.m_currentParams.path;\n        const defaultGlyphRotation = textRenderStyle.rotation;\n        const normalDisplacement = textLayoutStyle.verticalAlignment *\n            glyphDataArray[0].font.metrics.capHeight *\n            this.m_tempScale;\n        // Move through the glyph array following the run's direction (as the order of the glyphs in\n        // memory might not match the order on glyphs on scree).\n        const start = direction === UnicodeUtils_1.UnicodeUtils.Direction.LTR ? startIdx : endIdx;\n        const end = direction === UnicodeUtils_1.UnicodeUtils.Direction.LTR ? endIdx : startIdx;\n        for (let i = start; direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL ? i >= end : i <= end; i += direction) {\n            // Only process printable characters.\n            const glyphData = glyphDataArray[i];\n            if (!UnicodeUtils_1.UnicodeUtils.isPrintable(glyphData.codePoint)) {\n                continue;\n            }\n            // When placing a RTL run, we need to check for weak runs (numerical runs of characters\n            // that don't change the overall run direction, but should always be displayed as LTR\n            // text).\n            if (startIdx !== endIdx &&\n                i !== 0 &&\n                direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL &&\n                glyphData.direction === UnicodeUtils_1.UnicodeUtils.Direction.Weak) {\n                let weakRunStart = i;\n                let weakGlyph = glyphDataArray[weakRunStart - 1];\n                while (weakRunStart !== startIdx &&\n                    (weakGlyph.direction === UnicodeUtils_1.UnicodeUtils.Direction.Weak ||\n                        (weakGlyph.direction === UnicodeUtils_1.UnicodeUtils.Direction.Neutral &&\n                            !UnicodeUtils_1.UnicodeUtils.isWhiteSpace(weakGlyph.codePoint)))) {\n                    --weakRunStart;\n                    weakGlyph = glyphDataArray[weakRunStart - 1];\n                }\n                this.placeRun(Math.max(weakRunStart, startIdx), i, UnicodeUtils_1.UnicodeUtils.Direction.LTR);\n                i = weakRunStart;\n                continue;\n            }\n            // Compute various rendering parameters for this glyph.\n            const glyphFont = glyphData.font;\n            const glyphFontMetrics = glyphFont.metrics;\n            const fontStyle = textRenderStyle.fontStyle;\n            const isBoldEmulated = (fontStyle === TextStyle_1.FontStyle.Bold && glyphFont.bold === undefined) ||\n                (fontStyle === TextStyle_1.FontStyle.BoldItalic &&\n                    glyphFont.bold === undefined &&\n                    glyphFont.boldItalic === undefined);\n            const isItalicEmulated = (fontStyle === TextStyle_1.FontStyle.Italic && glyphFont.italic === undefined) ||\n                (fontStyle === TextStyle_1.FontStyle.BoldItalic &&\n                    glyphFont.italic === undefined &&\n                    glyphFont.boldItalic === undefined);\n            const isSmallCaps = this.m_tempSmallCaps\n                ? smallCapsArray[i] && textRenderStyle.fontVariant === TextStyle_1.FontVariant.SmallCaps\n                : false;\n            const smallCapsScale = isSmallCaps\n                ? glyphFontMetrics.xHeight / glyphFontMetrics.capHeight\n                : 1.0;\n            const glyphScale = this.m_tempScale * smallCapsScale;\n            const emulationWeight = ((isBoldEmulated ? 0.02 : 0.0) + (isSmallCaps ? 0.01 : 0.0)) *\n                (fontCatalog.size / fontCatalog.distanceRange);\n            const bgWeight = (0.5 * this.m_tempPixelBgSize) /\n                (fontCatalog.distanceRange * Math.max(glyphScale, 1.0));\n            const isMirrored = UnicodeUtils_1.UnicodeUtils.isRtlMirrored(glyphData.codePoint) &&\n                direction === UnicodeUtils_1.UnicodeUtils.Direction.RTL;\n            const verticalOffset = glyphFontMetrics.lineHeight -\n                glyphFontMetrics.base -\n                glyphFontMetrics.distanceRange * 0.5;\n            // Update the current interpolated path position and angle.\n            const textPoint = path.getPoint(this.m_tempPathOffset);\n            if (textPoint === null) {\n                return this.m_currentParams.pathOverflow;\n            }\n            const tangent = path.getTangent(this.m_tempPathOffset);\n            const normal = new THREE.Vector2(-tangent.y, tangent.x).multiplyScalar(normalDisplacement);\n            const angle = Math.atan2(tangent.y, tangent.x);\n            this.m_tempPathPosition.set(normal.x + textPoint.x, normal.y + textPoint.y, position.z);\n            textRenderStyle.rotation = defaultGlyphRotation + angle;\n            // Compute the glyphs transformation matrix and apply to all corners of a glyph.\n            TypesettingUtils_1.TypesettingUtils.computeGlyphTransform(this.m_tempTransform, this.m_tempPathPosition, glyphScale, textLayoutStyle.lineRotation, textRenderStyle.rotation);\n            for (let j = 0; j < 4; ++j) {\n                const glyphVertexPosition = glyphData.positions[j];\n                const horizontalOffset = isItalicEmulated && j > 1\n                    ? TypesettingUtils_1.TypesettingUtils.OBLIQUE_OFFSET * glyphFontMetrics.size\n                    : 0.0;\n                this.m_tempCorners[j].set(glyphVertexPosition.x + horizontalOffset, glyphVertexPosition.y - verticalOffset, glyphVertexPosition.z);\n                this.m_tempCorners[j].applyMatrix3(this.m_tempTransform);\n                this.m_tempCorners[j].x -= position.x;\n                this.m_tempCorners[j].y -= position.y;\n            }\n            // Depending on the typesetting options, add the computed glyph to the TextGeometry or\n            // update the text bounds.\n            if (globalBounds === undefined && vertexBuffer === undefined) {\n                if (!geometry.add(glyphData, this.m_tempCorners, emulationWeight, emulationWeight + bgWeight, isMirrored, textRenderStyle)) {\n                    return false;\n                }\n            }\n            else {\n                if (globalBounds !== undefined) {\n                    TypesettingUtils_1.TypesettingUtils.updateBounds(this.m_tempCorners, globalBounds, individualBounds);\n                }\n                if (vertexBuffer !== undefined) {\n                    geometry.addToBuffer(vertexBuffer, i * TextGeometry_1.QUAD_VERTEX_MEMORY_FOOTPRINT, glyphData, this.m_tempCorners, emulationWeight, emulationWeight + bgWeight, isMirrored, textRenderStyle);\n                }\n            }\n            // Restore the original glyph rotation.\n            textRenderStyle.rotation = defaultGlyphRotation;\n            // Advance the current position and proceed to next glyph in the run.\n            this.m_tempPathOffset +=\n                ((glyphData.advanceX + textLayoutStyle.tracking) * glyphScale) /\n                    this.m_tempPathLength;\n        }\n        return true;\n    }\n}\nexports.PathTypesetter = PathTypesetter;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ContextualForm;\n(function (ContextualForm) {\n    ContextualForm[ContextualForm[\"Initial\"] = 0] = \"Initial\";\n    ContextualForm[ContextualForm[\"Medial\"] = 1] = \"Medial\";\n    ContextualForm[ContextualForm[\"Final\"] = 2] = \"Final\";\n})(ContextualForm || (ContextualForm = {}));\nvar CombinedForm;\n(function (CombinedForm) {\n    CombinedForm[CombinedForm[\"Isolated\"] = 0] = \"Isolated\";\n    CombinedForm[CombinedForm[\"Connected\"] = 1] = \"Connected\";\n})(CombinedForm || (CombinedForm = {}));\n/**\n * Converter between arabic isolated forms (in Unicode Block 'Arabic') and their contextual forms\n * (in Unicode Block 'Arabic Presentation Forms-B').\n */\nclass ContextualArabicConverter {\n    constructor() {\n        this.m_singleCharactersMap = new Map();\n        this.m_combinedCharactersMap = new Map();\n        // Single characters.\n        this.m_singleCharactersMap.set(0x0621, [undefined, undefined, undefined]); // HAMZA\n        this.m_singleCharactersMap.set(0x0622, [undefined, undefined, 0xfe82]); // ALEF_MADDA\n        this.m_singleCharactersMap.set(0x0623, [undefined, undefined, 0xfe84]); // ALEF_HAMZA_ABOVE\n        this.m_singleCharactersMap.set(0x0624, [undefined, undefined, 0xfe86]); // WAW_HAMZA\n        this.m_singleCharactersMap.set(0x0625, [undefined, undefined, 0xfe88]); // ALEF_HAMZA_BELOW\n        this.m_singleCharactersMap.set(0x0626, [0xfe8b, 0xfe8c, 0xfe8a]); // YEH_HAMZA\n        this.m_singleCharactersMap.set(0x0627, [undefined, undefined, 0xfe8e]); // ALEF\n        this.m_singleCharactersMap.set(0x0628, [0xfe91, 0xfe92, 0xfe90]); // BEH\n        this.m_singleCharactersMap.set(0x0629, [undefined, undefined, 0xfe94]); // TEH_MARBUTA\n        this.m_singleCharactersMap.set(0x062a, [0xfe97, 0xfe98, 0xfe96]); // TEH\n        this.m_singleCharactersMap.set(0x062b, [0xfe9b, 0xfe9c, 0xfe9a]); // THEH\n        this.m_singleCharactersMap.set(0x062c, [0xfe9f, 0xfea0, 0xfe9e]); // JEEM\n        this.m_singleCharactersMap.set(0x062d, [0xfea3, 0xfea4, 0xfea2]); // HAH\n        this.m_singleCharactersMap.set(0x062e, [0xfea7, 0xfea8, 0xfea6]); // KHAH\n        this.m_singleCharactersMap.set(0x062f, [undefined, undefined, 0xfeaa]); // DAL\n        this.m_singleCharactersMap.set(0x0630, [undefined, undefined, 0xfeac]); // THAL\n        this.m_singleCharactersMap.set(0x0631, [undefined, undefined, 0xfeae]); // REH\n        this.m_singleCharactersMap.set(0x0632, [undefined, undefined, 0xfeb0]); // ZAIN\n        this.m_singleCharactersMap.set(0x0633, [0xfeb3, 0xfeb4, 0xfeb2]); // SEEN\n        this.m_singleCharactersMap.set(0x0634, [0xfeb7, 0xfeb8, 0xfeb6]); // SHEEN\n        this.m_singleCharactersMap.set(0x0635, [0xfebb, 0xfebc, 0xfeba]); // SAD\n        this.m_singleCharactersMap.set(0x0636, [0xfebf, 0xfec0, 0xfebe]); // DAD\n        this.m_singleCharactersMap.set(0x0637, [0xfec3, 0xfec4, 0xfec2]); // TAH\n        this.m_singleCharactersMap.set(0x0638, [0xfec7, 0xfec8, 0xfec6]); // ZAH\n        this.m_singleCharactersMap.set(0x0639, [0xfecb, 0xfecc, 0xfeca]); // AIN\n        this.m_singleCharactersMap.set(0x063a, [0xfecf, 0xfed0, 0xfece]); // GHAIN\n        this.m_singleCharactersMap.set(0x0640, [0x0640, 0x0640, 0x0640]); // TATWEEL\n        this.m_singleCharactersMap.set(0x0641, [0xfed3, 0xfed4, 0xfed2]); // FEH\n        this.m_singleCharactersMap.set(0x0642, [0xfed7, 0xfed8, 0xfed6]); // QAF\n        this.m_singleCharactersMap.set(0x0643, [0xfedb, 0xfedc, 0xfeda]); // KAF\n        this.m_singleCharactersMap.set(0x0644, [0xfedf, 0xfee0, 0xfede]); // LAM\n        this.m_singleCharactersMap.set(0x0645, [0xfee3, 0xfee4, 0xfee2]); // MEEM\n        this.m_singleCharactersMap.set(0x0646, [0xfee7, 0xfee8, 0xfee6]); // NOON\n        this.m_singleCharactersMap.set(0x0647, [0xfeeb, 0xfeec, 0xfeea]); // HEH\n        this.m_singleCharactersMap.set(0x0648, [undefined, undefined, 0xfeee]); // WAW\n        this.m_singleCharactersMap.set(0x0649, [undefined, undefined, 0xfef0]); // ALEF_MAKSURA\n        this.m_singleCharactersMap.set(0x064a, [0xfef3, 0xfef4, 0xfef2]); // YEH\n        this.m_singleCharactersMap.set(0x067e, [0xfb58, 0xfb59, 0xfb57]); // PEH\n        this.m_singleCharactersMap.set(0x06cc, [0xfbfe, 0xfbff, 0xfbfd]); // Farsi Yeh\n        this.m_singleCharactersMap.set(0x0686, [0xfb7c, 0xfb7d, 0xfb7b]); // Tcheh\n        this.m_singleCharactersMap.set(0x06a9, [0xfb90, 0xfb91, 0xfb8f]); // Keheh\n        this.m_singleCharactersMap.set(0x06af, [0xfb94, 0xfb95, 0xfb93]); // Gaf\n        this.m_singleCharactersMap.set(0x0698, [undefined, undefined, 0xfb8b]); // Jeh\n        // Combined characters.\n        this.m_combinedCharactersMap.set(0x0644, new Map());\n        // LAM_ALEF_MADDA\n        this.m_combinedCharactersMap.get(0x0644).set(0x0622, [0xfef5, 0xfef6]);\n        // LAM_ALEF_HAMZA_ABOVE\n        this.m_combinedCharactersMap.get(0x0644).set(0x0623, [0xfef7, 0xfef8]);\n        // LAM_ALEF_HAMZA_BELOW\n        this.m_combinedCharactersMap.get(0x0644).set(0x0625, [0xfef9, 0xfefa]);\n        // LAM_ALEF\n        this.m_combinedCharactersMap.get(0x0644).set(0x0627, [0xfefb, 0xfefc]);\n        // Neutral characters.\n        this.m_neutralCharacters = [\n            0x0610,\n            0x0612,\n            0x0613,\n            0x0614,\n            0x0615,\n            0x064b,\n            0x064c,\n            0x064d,\n            0x064e,\n            0x064f,\n            0x0650,\n            0x0651,\n            0x0652,\n            0x0653,\n            0x0654,\n            0x0655,\n            0x0656,\n            0x0657,\n            0x0658,\n            0x0670,\n            0x06d6,\n            0x06d7,\n            0x06d8,\n            0x06d9,\n            0x06da,\n            0x06db,\n            0x06dc,\n            0x06df,\n            0x06e0,\n            0x06e1,\n            0x06e2,\n            0x06e3,\n            0x06e4,\n            0x06e7,\n            0x06e8,\n            0x06ea,\n            0x06eb,\n            0x06ec,\n            0x06ed // ARABIC SMALL LOW MEEM\n        ];\n    }\n    static get instance() {\n        if (this.m_instance === undefined) {\n            this.m_instance = new ContextualArabicConverter();\n        }\n        return this.m_instance;\n    }\n    /**\n     * Converts isolated arabic characters into their contextual form.\n     *\n     * @param input String with isolated arabic characters.\n     */\n    convert(input) {\n        let output = \"\";\n        for (let i = 0; i < input.length; ++i) {\n            const currentCodePoint = input.charCodeAt(i);\n            // Only process arabic characters in the map.\n            if (this.isArabicCharacter(currentCodePoint)) {\n                // Find the first previous non-neutral character.\n                let prevIndex = i - 1;\n                for (; prevIndex >= 0; --prevIndex) {\n                    if (!this.isNeutral(input.charCodeAt(prevIndex))) {\n                        break;\n                    }\n                }\n                // Check if the previous character has ligatures with following characters.\n                let prevCodePoint = prevIndex >= 0 ? input.charCodeAt(prevIndex) : undefined;\n                if (prevCodePoint !== undefined) {\n                    const prevMap = this.getCharacterMap(prevCodePoint);\n                    if (prevMap === undefined ||\n                        (prevMap[ContextualForm.Initial] === undefined &&\n                            prevMap[ContextualForm.Medial] === undefined)) {\n                        prevCodePoint = undefined;\n                    }\n                }\n                // Find the first next non-neutral character.\n                let nextIndex = i + 1;\n                for (; nextIndex < input.length; ++nextIndex) {\n                    if (!this.isNeutral(input.charCodeAt(nextIndex))) {\n                        break;\n                    }\n                }\n                // Check if the next character has ligatures with previous characters.\n                let nextCodePoint = nextIndex < input.length ? input.charCodeAt(nextIndex) : undefined;\n                if (nextCodePoint !== undefined) {\n                    const nextMap = this.getCharacterMap(nextCodePoint);\n                    if (nextMap === undefined ||\n                        (nextMap[ContextualForm.Medial] === undefined &&\n                            nextMap[ContextualForm.Final] === undefined)) {\n                        nextCodePoint = undefined;\n                    }\n                }\n                // Check for Lam Alef combinated forms.\n                if (currentCodePoint === 0x0644 &&\n                    nextCodePoint !== undefined &&\n                    (nextCodePoint === 0x0622 ||\n                        nextCodePoint === 0x0623 ||\n                        nextCodePoint === 0x0625 ||\n                        nextCodePoint === 0x0627)) {\n                    const combinedMap = this.getCombinedCharacterMap(currentCodePoint, nextCodePoint);\n                    if (prevCodePoint !== undefined) {\n                        output += String.fromCharCode(combinedMap[CombinedForm.Connected]);\n                    }\n                    else {\n                        output += String.fromCharCode(combinedMap[CombinedForm.Isolated]);\n                    }\n                    // Skip the next character and continue.\n                    ++i;\n                    continue;\n                }\n                // Check for single character contextual forms.\n                const map = this.getCharacterMap(currentCodePoint);\n                // Intermediate.\n                if (prevCodePoint !== undefined &&\n                    nextCodePoint !== undefined &&\n                    map[ContextualForm.Medial] !== undefined) {\n                    output += String.fromCharCode(map[ContextualForm.Medial]);\n                }\n                // Final.\n                else if (prevCodePoint !== undefined && map[ContextualForm.Final] !== undefined) {\n                    output += String.fromCharCode(map[ContextualForm.Final]);\n                }\n                // Initial.\n                else if (nextCodePoint !== undefined && map[ContextualForm.Initial] !== undefined) {\n                    output += String.fromCharCode(map[ContextualForm.Initial]);\n                }\n                // Isolated.\n                else {\n                    output += String.fromCharCode(currentCodePoint);\n                }\n            }\n            else {\n                output += String.fromCharCode(currentCodePoint);\n            }\n        }\n        return output;\n    }\n    isArabicCharacter(codePoint) {\n        return this.m_singleCharactersMap.has(codePoint);\n    }\n    getCharacterMap(codePoint) {\n        return this.m_singleCharactersMap.get(codePoint);\n    }\n    getCombinedCharacterMap(codePoint, nextCodePoint) {\n        const map = this.m_combinedCharactersMap.get(codePoint);\n        if (map !== undefined) {\n            return map.get(nextCodePoint);\n        }\n        return undefined;\n    }\n    isNeutral(codePoint) {\n        for (const character of this.m_neutralCharacters) {\n            if (character === codePoint) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nexports.ContextualArabicConverter = ContextualArabicConverter;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * Raycasting points is not supported as necessary in Three.js. This class extends a\n * [[THREE.Raycaster]] except that it holds a reference to [[MapView]] allowing to access the\n * camera and the renderer from [[MapViewPoints]], in order to project the points in screen space.\n */\nclass PickingRaycaster extends THREE.Raycaster {\n    /**\n     * Constructs a `MapViewRaycaster`. It keeps a reference to [[MapView]] in order to access the\n     * active camera when calling the custom method `raycastPoints`.\n     *\n     * @param m_mapView the active [[MapView]].\n     */\n    constructor(mapView) {\n        super();\n        this.mapView = mapView;\n    }\n}\nexports.PickingRaycaster = PickingRaycaster;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst ColorCache_1 = require(\"../ColorCache\");\nconst BoxBuffer_1 = require(\"./BoxBuffer\");\nconst Poi_1 = require(\"./Poi\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"PoiRenderer\");\nconst INVALID_RENDER_BATCH = -1;\nconst tempPos = new THREE.Vector3(0);\n/**\n * The `PoiRenderBufferBatch` contains the geometry and the material for all POIs that share the\n * same icon image ([[ImageTexture]]). If the image is the same, all the objects in this batch can\n * share the same material, which makes them renderable in the same draw call, whatever the number\n * of actual objects (WebGL limits apply!).\n *\n * There is a `PoiRenderBufferBatch` for every icon in a texture atlas, since the size of the icon\n * in the atlas as well as the texture coordinates are specified in the `PoiRenderBufferBatch`.\n */\nclass PoiRenderBufferBatch {\n    /**\n     * Create the `PoiRenderBufferBatch`.\n     *\n     * @param mapView The [[MapView]] instance.\n     * @param scene The three.js scene to add the POIs to.\n     * @param imageItem The icon that will have his material shared.\n     * @param renderOrder RenderOrder of the batch geometry's [[Mesh]].\n     */\n    constructor(mapView, scene, imageItem, renderOrder) {\n        this.mapView = mapView;\n        this.scene = scene;\n        this.imageItem = imageItem;\n        this.renderOrder = renderOrder;\n        this.color = ColorCache_1.ColorCache.instance.getColor(\"#000000\");\n    }\n    /**\n     * Initialize with the [[ImageTexture]]. Loads the image and sets up the icon size, the texture\n     * coordinates and material of the batch. Since image loading is done asynchronously, this\n     * batch cannot be rendered right away. MapView#update is being triggered if it loaded\n     * successfully.\n     */\n    init() {\n        if (this.boxBuffer === undefined) {\n            this.setup();\n        }\n    }\n    /**\n     * Clean the `PoiRenderBufferBatch`, remove all icon boxes. Called before starting a new frame.\n     */\n    reset() {\n        if (this.boxBuffer === undefined) {\n            this.init();\n        }\n        this.boxBuffer.reset();\n    }\n    /**\n     * Update the geometry with all the added boxes during the frame.\n     */\n    update() {\n        if (this.boxBuffer === undefined) {\n            this.init();\n        }\n        this.boxBuffer.updateBufferGeometry();\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the\n     * `PoiRenderBufferBatch`.\n     *\n     * @param info The info object to increment with the values from this `PoiRenderBufferBatch`.\n     */\n    updateMemoryUsage(info) {\n        if (this.boxBuffer !== undefined) {\n            this.boxBuffer.updateMemoryUsage(info);\n        }\n    }\n    /**\n     * Setup texture and material for the batch.\n     */\n    setup() {\n        const bilinear = true;\n        // Texture images should be generated with premultiplied alpha\n        const premultipliedAlpha = true;\n        const iconTexture = new Poi_1.IconTexture(this.imageItem);\n        const texture = new THREE.Texture(iconTexture.image.imageData, THREE.UVMapping, undefined, undefined, bilinear ? THREE.LinearFilter : THREE.NearestFilter, bilinear ? THREE.LinearFilter : THREE.NearestFilter, THREE.RGBAFormat);\n        texture.needsUpdate = true;\n        texture.premultiplyAlpha = premultipliedAlpha;\n        texture.generateMipmaps = false; // not needed, always rendered in full size\n        this.m_material = new harp_materials_1.IconMaterial({\n            map: texture\n        });\n        this.boxBuffer = new BoxBuffer_1.BoxBuffer(this.m_material, this.renderOrder);\n        const mesh = this.boxBuffer.mesh;\n        mesh.frustumCulled = false;\n        this.scene.add(mesh);\n        this.mapView.update();\n    }\n}\n/**\n * Contains all [[PoiRenderBufferBatch]]es. Selects (and initializes) the correct batch for a POI.\n */\nclass PoiRenderBuffer {\n    /**\n     * Create the `PoiRenderBuffer`.\n     *\n     * @param mapView The [[MapView]] to be rendered to.\n     * @param textCanvas The [[TextCanvas]] to which scenes this `PoiRenderBuffer` adds geometry to.\n     * The actual scene a [[TextElement]] is added to is specified by the renderOrder of the\n     * [[TextElement]].\n     */\n    constructor(mapView, textCanvas) {\n        this.mapView = mapView;\n        this.textCanvas = textCanvas;\n        this.batches = [];\n        this.m_batchMap = new Map();\n    }\n    /**\n     * Register the POI and prepare the [[PoiRenderBufferBatch]] for the POI at first usage.\n     *\n     * @param poiInfo Describes the POI icon.\n     */\n    registerPoi(poiInfo) {\n        const { imageItem, imageTexture, imageTextureName } = poiInfo;\n        if (imageItem === undefined ||\n            imageTextureName === undefined ||\n            imageTexture === undefined) {\n            // No image -> invisible -> ignore\n            return INVALID_RENDER_BATCH;\n        }\n        const renderOrder = poiInfo.renderOrder;\n        // There is a batch for every ImageDefinition, which could be a texture atlas with many\n        // ImageTextures in it.\n        const batchKey = imageTexture.image;\n        let batchSet = this.m_batchMap.get(batchKey);\n        let mappedIndex;\n        let bufferBatch;\n        if (batchSet === undefined) {\n            batchSet = new Map();\n            this.m_batchMap.set(batchKey, batchSet);\n        }\n        mappedIndex = batchSet.get(renderOrder);\n        if (mappedIndex !== undefined) {\n            return mappedIndex;\n        }\n        mappedIndex = this.batches.length;\n        let layer = this.textCanvas.getLayer(renderOrder);\n        if (layer === undefined) {\n            this.textCanvas.addText(\"\", tempPos, { layer: renderOrder });\n            layer = this.textCanvas.getLayer(renderOrder);\n        }\n        bufferBatch = new PoiRenderBufferBatch(this.mapView, layer.storage.scene, imageItem, renderOrder);\n        bufferBatch.init();\n        batchSet.set(renderOrder, mappedIndex);\n        this.batches.push(bufferBatch);\n        return mappedIndex;\n    }\n    /**\n     * Render a POI image at the specified location.\n     *\n     * @param poiInfo PoiInfo containing information for rendering the POI icon.\n     * @param screenBox Box to render icon into in 2D coordinates.\n     * @param opacity Opacity of icon to allow fade in/out.\n     */\n    addPoi(poiInfo, screenBox, opacity) {\n        const batchIndex = this.registerPoi(poiInfo);\n        harp_utils_1.assert(batchIndex >= 0);\n        if (batchIndex < 0) {\n            return INVALID_RENDER_BATCH;\n        }\n        harp_utils_1.assert(poiInfo.uvBox !== undefined);\n        if (this.batches[batchIndex].boxBuffer === undefined) {\n            this.batches[batchIndex].init();\n        }\n        this.batches[batchIndex].boxBuffer.addBox(screenBox, poiInfo.uvBox, this.batches[batchIndex].color, opacity, poiInfo.textElement.renderDistance, poiInfo.textElement);\n        return batchIndex;\n    }\n    /**\n     * Retrieve the [[PoiRenderBufferBatch]] from the array at the specified index. May be invalid\n     * if the imageTexture could not be found\n     *\n     * @param index Index into batch array.\n     */\n    getBatch(index) {\n        if (index >= 0) {\n            harp_utils_1.assert(index < this.batches.length);\n            return this.batches[index];\n        }\n        // may be invalid if the imageTexture could not be found\n        return undefined;\n    }\n    /**\n     * Reset all batches, removing all content from the [[PoiRenderBufferBatch]]es. Called at the\n     * beginning of a frame before the POIs are placed.\n     */\n    reset() {\n        for (const batch of this.batches) {\n            batch.reset();\n        }\n    }\n    /**\n     * Update the geometry of all [[PoiRenderBufferBatch]]es. Called before rendering.\n     */\n    update() {\n        for (const batch of this.batches) {\n            batch.update();\n        }\n    }\n    /**\n     * Fill the picking results for the pixel with the given screen coordinate. If multiple\n     * [[PoiInfo]]s are found, the order of the results is unspecified.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickCallback Callback to be called for every picked element.\n     */\n    pickTextElements(screenPosition, pickCallback) {\n        for (const batch of this.batches) {\n            if (batch.boxBuffer === undefined) {\n                batch.init();\n            }\n            batch.boxBuffer.pickBoxes(screenPosition, pickCallback, batch.imageItem.imageData);\n        }\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `PoiRenderBuffer`.\n     *\n     * @param info The info object to increment with the values from this `PoiRenderBuffer`.\n     */\n    updateMemoryUsage(info) {\n        for (const batch of this.batches) {\n            if (batch.imageItem.imageData !== undefined) {\n                const imageBytes = batch.imageItem.imageData.width * batch.imageItem.imageData.height * 4;\n                info.heapSize += imageBytes;\n                info.gpuSize += imageBytes;\n            }\n            if (batch.boxBuffer !== undefined) {\n                batch.boxBuffer.updateMemoryUsage(info);\n            }\n        }\n    }\n}\n/**\n * Manage POI rendering. Uses a [[PoiRenderBuffer]] to actually create the geometry that is being\n * rendered.\n */\nclass PoiRenderer {\n    /**\n     * Create the `PoiRenderer` for the specified [[MapView]].\n     *\n     * @param mapView The MapView to be rendered to.\n     * @param textCanvas The [[TextCanvas]] this `PoiRenderer` is associated to. POIs are added to\n     * the different layers of this [[TextCanvas]] based on renderOrder.\n     */\n    constructor(mapView, textCanvas) {\n        this.mapView = mapView;\n        this.textCanvas = textCanvas;\n        // temporary variable to save allocations\n        this.m_tempScreenBox = new harp_utils_1.Math2D.Box();\n        this.m_renderBuffer = new PoiRenderBuffer(mapView, textCanvas);\n    }\n    /**\n     * Prepare the POI for rendering, and determine which `poiRenderBatch` should be used. If a\n     * `poiRenderBatch` is assigned, the POI is ready to be rendered.\n     *\n     * @param pointLabel TextElement with PoiInfo for rendering the POI icon.\n     *\n     * @returns `True` if the space is not already allocated by another object (text label or POI)\n     */\n    prepareRender(pointLabel) {\n        const poiInfo = pointLabel.poiInfo;\n        if (poiInfo === undefined) {\n            return false;\n        }\n        if (poiInfo.poiRenderBatch === undefined) {\n            this.preparePoi(pointLabel);\n        }\n        return poiInfo.poiRenderBatch !== undefined;\n    }\n    /**\n     * Compute screen box for icon. It is required that `prepareRender` has been successfully called\n     * before `isSpaceAvailable` may be called.\n     *\n     * @param poiInfo PoiInfo containing information for rendering the POI icon.\n     * @param screenPosition Position on screen (2D).\n     * @param scale Scale to apply to icon.\n     * @param screenCollisions Object handling the collision checks for screen-aligned 2D boxes.\n     *\n     * @returns `True` if box is visible on screen.\n     */\n    computeScreenBox(poiInfo, screenPosition, scale, screenCollisions, tempScreenBox) {\n        if (!this.computeIconScreenBox(poiInfo, screenPosition, scale, tempScreenBox)) {\n            return false;\n        }\n        return screenCollisions.isVisible(tempScreenBox);\n    }\n    /**\n     * Check if the space for the icon is available. It is required that `prepareRender` has been\n     * successfully called before `isSpaceAvailable` may be called.\n     *\n     * @param poiInfo PoiInfo containing information for rendering the POI icon.\n     * @param screenPosition Position on screen (2D).\n     * @param scale Scale to apply to icon.\n     * @param screenCollisions Object handling the collision checks for screen-aligned 2D boxes.\n     *\n     * @returns `True` if the space is not already allocated by another object (text label or POI)\n     */\n    isSpaceAvailable(screenCollisions, tempScreenBox) {\n        return !screenCollisions.isAllocated(tempScreenBox);\n    }\n    /**\n     * Reset all batches, removing all content from the [[PoiRenderBuffer]]es. Called at the\n     * beginning of a frame before the POIs are placed.\n     */\n    reset() {\n        this.m_renderBuffer.reset();\n    }\n    /**\n     * Render the icon.\n     *\n     * @param poiInfo PoiInfo containing information for rendering the POI icon.\n     * @param screenPosition Position on screen (2D):\n     * @param screenCollisions Object handling the collision checks for screen-aligned 2D boxes.\n     * @param scale Scaling factor to apply to text and icon.\n     * @param allocateScreenSpace If `true` screen space will be allocated for the icon.\n     * @param opacity Opacity of icon to allow fade in/out.\n     */\n    renderPoi(poiInfo, screenPosition, screenCollisions, scale, allocateScreenSpace, opacity) {\n        harp_utils_1.assert(poiInfo.poiRenderBatch !== undefined);\n        if (this.computeIconScreenBox(poiInfo, screenPosition, scale, this.m_tempScreenBox)) {\n            if (allocateScreenSpace) {\n                screenCollisions.allocate(this.m_tempScreenBox);\n            }\n            this.m_renderBuffer.addPoi(poiInfo, this.m_tempScreenBox, opacity);\n        }\n    }\n    /**\n     * Return 'true' if the POI has been successfully prepared for rendering.\n     *\n     * @param poiInfo PoiInfo containing information for rendering the POI icon.\n     */\n    poiIsRenderable(poiInfo) {\n        return poiInfo.poiRenderBatch !== undefined;\n    }\n    /**\n     * Update the geometry of all [[PoiRenderBuffer]]es. Called before rendering.\n     */\n    update() {\n        this.m_renderBuffer.update();\n    }\n    /**\n     * Fill the picking results for the pixel with the given screen coordinate. If multiple\n     * [[PoiInfo]]s are found, the order of the results is unspecified.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickCallback Callback to be called for every picked element.\n     */\n    pickTextElements(screenPosition, pickCallback) {\n        this.m_renderBuffer.pickTextElements(screenPosition, pickCallback);\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `PoiRenderer`.\n     *\n     * @param info The info object to increment with the values from this `PoiRenderer`.\n     */\n    getMemoryUsage(info) {\n        this.m_renderBuffer.updateMemoryUsage(info);\n    }\n    /**\n     * Compute the screen rectangle from the screen position.\n     */\n    computeIconScreenBox(poiInfo, screenPosition, scale, \n    /* out */ screenBox) {\n        harp_utils_1.assert(poiInfo.poiRenderBatch !== undefined);\n        const batch = this.m_renderBuffer.getBatch(poiInfo.poiRenderBatch);\n        if (batch === undefined) {\n            return false;\n        }\n        const width = poiInfo.computedWidth * scale;\n        const height = poiInfo.computedHeight * scale;\n        const technique = poiInfo.technique;\n        const centerX = screenPosition.x + (technique.iconXOffset !== undefined ? technique.iconXOffset : 0);\n        const centerY = screenPosition.y + (technique.iconYOffset !== undefined ? technique.iconYOffset : 0);\n        screenBox.x = centerX - width / 2;\n        screenBox.y = centerY - height / 2;\n        screenBox.w = width;\n        screenBox.h = height;\n        return true;\n    }\n    /**\n     * Register the POI at the [[PoiRenderBuffer]] which may require some setup, for example loading\n     * of the actual image.\n     */\n    preparePoi(pointLabel) {\n        const poiInfo = pointLabel.poiInfo;\n        if (poiInfo === undefined || !pointLabel.visible) {\n            return;\n        }\n        if (poiInfo.poiRenderBatch !== undefined || poiInfo.isValid === false) {\n            // Already set up, nothing to be done here.\n            return;\n        }\n        if (poiInfo.poiTableName !== undefined) {\n            if (this.mapView.poiManager.updatePoiFromPoiTable(pointLabel)) {\n                // Remove poiTableName to mark this POI as processed.\n                poiInfo.poiTableName = undefined;\n                if (!pointLabel.visible) {\n                    // PoiTable set this POI to not visible.\n                    return;\n                }\n            }\n            else {\n                // PoiTable has not been loaded, but is required to determine visibility.\n                return;\n            }\n        }\n        const imageTextureName = poiInfo.imageTextureName;\n        const imageTexture = this.mapView.poiManager.getImageTexture(imageTextureName);\n        if (imageTexture === undefined) {\n            // Warn about a missing texture, but only once.\n            if (PoiRenderer.m_missingTextureName.get(imageTextureName) === undefined) {\n                PoiRenderer.m_missingTextureName.set(imageTextureName, true);\n                logger.error(`preparePoi: No imageTexture with name '${imageTextureName}' found`);\n            }\n            poiInfo.isValid = false;\n            return;\n        }\n        const imageDefinition = imageTexture.image;\n        let imageItem = this.mapView.imageCache.findImageByName(imageDefinition);\n        if (imageItem === undefined) {\n            logger.error(`init: No imageItem found with name '${imageDefinition}'`);\n            poiInfo.isValid = false;\n            return;\n        }\n        if (!imageItem.loaded) {\n            if (imageItem.loadingPromise !== undefined) {\n                // already being loaded, will be rendered once available\n                return;\n            }\n            const imageUrl = imageItem.url;\n            const loading = this.mapView.imageCache.loadImage(imageItem);\n            if (loading instanceof Promise) {\n                loading\n                    .then(loadedImageItem => {\n                    if (loadedImageItem === undefined) {\n                        logger.error(`preparePoi: Failed to load imageItem: '${imageUrl}`);\n                        return;\n                    }\n                    this.setupPoiInfo(poiInfo, imageTexture, loadedImageItem);\n                })\n                    .catch(error => {\n                    logger.error(`preparePoi: Failed to load imageItem: '${imageUrl}`, error);\n                    poiInfo.isValid = false;\n                });\n                return;\n            }\n            else {\n                imageItem = loading;\n            }\n        }\n        this.setupPoiInfo(poiInfo, imageTexture, imageItem);\n    }\n    /**\n     * Setup texture and material for the batch.\n     *\n     * @param poiInfo [[PoiInfo]] to initialize.\n     * @param imageTexture Shared [[ImageTexture]], defines used area in atlas.\n     * @param imageItem Shared [[ImageItem]], contains cached image for texture.\n     */\n    setupPoiInfo(poiInfo, imageTexture, imageItem) {\n        harp_utils_1.assert(poiInfo.uvBox === undefined);\n        if (imageItem === undefined || imageItem.imageData === undefined) {\n            logger.error(\"setupPoiInfo: No imageItem/imageData found\");\n            // invalid render batch number\n            poiInfo.poiRenderBatch = INVALID_RENDER_BATCH;\n            poiInfo.isValid = false;\n            return;\n        }\n        const technique = poiInfo.technique;\n        const imageWidth = imageItem.imageData.width;\n        const imageHeight = imageItem.imageData.height;\n        const iconWidth = imageTexture.width !== undefined ? imageTexture.width : imageWidth;\n        const iconHeight = imageTexture.height !== undefined ? imageTexture.height : imageHeight;\n        let minS = 0;\n        let maxS = 1;\n        let minT = 0;\n        let maxT = 1;\n        let iconScaleH = technique.iconScale !== undefined ? technique.iconScale : 1;\n        let iconScaleV = technique.iconScale !== undefined ? technique.iconScale : 1;\n        const width = imageTexture.width !== undefined ? imageTexture.width : imageWidth;\n        const height = imageTexture.height !== undefined ? imageTexture.height : imageHeight;\n        const xOffset = imageTexture.xOffset !== undefined ? imageTexture.xOffset : 0;\n        const yOffset = imageTexture.yOffset !== undefined ? imageTexture.yOffset : 0;\n        minS = xOffset / imageWidth;\n        maxS = (xOffset + width) / imageWidth;\n        const flipY = true;\n        if (flipY) {\n            minT = (imageHeight - yOffset) / imageHeight;\n            maxT = (imageHeight - yOffset - height) / imageHeight;\n        }\n        else {\n            minT = yOffset / imageHeight;\n            maxT = (yOffset + height) / imageHeight;\n        }\n        // minS += 0.5 / imageWidth;\n        // maxS += 0.5 / imageWidth;\n        // minT += 0.5 / imageHeight;\n        // maxT += 0.5 / imageHeight;\n        // By default, iconScaleV should be equal to iconScaleH, whatever is set in the style.\n        if (technique.screenWidth !== undefined) {\n            iconScaleV = iconScaleH = technique.screenWidth / imageWidth;\n        }\n        if (technique.screenHeight !== undefined) {\n            iconScaleV = technique.screenHeight / imageHeight;\n            if (technique.screenWidth === undefined) {\n                iconScaleH = iconScaleV;\n            }\n        }\n        // compute stored values in imageTexture\n        poiInfo.computedWidth = iconWidth * iconScaleH;\n        poiInfo.computedHeight = iconHeight * iconScaleV;\n        poiInfo.uvBox = {\n            s0: minS,\n            t0: maxT,\n            s1: maxS,\n            t1: minT\n        };\n        poiInfo.imageItem = imageItem;\n        poiInfo.imageTexture = imageTexture;\n        poiInfo.poiRenderBatch = this.m_renderBuffer.registerPoi(poiInfo);\n        poiInfo.isValid = true;\n        harp_utils_1.assert(poiInfo.poiRenderBatch !== undefined);\n    }\n}\n// keep track of the missing textures, but only warn once\nPoiRenderer.m_missingTextureName = new Map();\nexports.PoiRenderer = PoiRenderer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst PixelPicker_1 = require(\"./PixelPicker\");\n/**\n * Initial number of boxes in BoxBuffer.\n */\nconst START_BOX_BUFFER_SIZE = 0;\n/**\n * Maximum number of boxes in BoxBuffer.\n */\nconst MAX_BOX_BUFFER_SIZE = 32 * 1024;\n/**\n * Number of vertices per box/glyph element: 4 corners.\n */\nconst NUM_VERTICES_PER_ELEMENT = 4;\n/**\n * Number of indices added per box/glyph: 2 triangles, 6 indices.\n */\nconst NUM_INDICES_PER_ELEMENT = 6;\n/**\n * Number of values per position.\n */\nconst NUM_POSITION_VALUES_PER_VERTEX = 3;\n/**\n * Number of values per color.\n */\nconst NUM_COLOR_VALUES_PER_VERTEX = 4;\n/**\n * Number of values per UV.\n */\nconst NUM_UV_VALUES_PER_VERTEX = 4;\n/**\n * Number of values per index.\n */\nconst NUM_INDEX_VALUES_PER_VERTEX = 1;\n/**\n * Number of bytes for float in an Float32Array.\n */\nconst NUM_BYTES_PER_FLOAT = 4;\n/**\n * Number of bytes for integer number in an UInt32Array.\n */\nconst NUM_BYTES_PER_INT32 = 4;\n/**\n * SubClass of [[THREE.Mesh]] to identify meshes that have been created by [[BoxBuffer]] and\n * [[TextBuffer]]. Add the isEmpty flag to quickly test for empty meshes.\n */\nclass BoxBufferMesh extends THREE.Mesh {\n    constructor(geometry, material) {\n        super(geometry, material);\n        this.type = \"BoxBufferMesh\";\n    }\n    /**\n     * A mesh that has no positions and indices set is defined to be empty.\n     *\n     * @returns `True` if no indices have been added to the mesh.\n     */\n    get isEmpty() {\n        return this.geometry !== undefined\n            ? this.geometry.index.count === 0\n            : true;\n    }\n}\nexports.BoxBufferMesh = BoxBufferMesh;\n/**\n * Buffer for (untransformed) `Box2` objects. Can be used to create a single geometry for screen-\n * aligned boxes, like POIs.\n */\nclass BoxBuffer {\n    /**\n     * Creates a new `BoxBuffer`.\n     *\n     * @param material Material to be used for [[Mesh]] of this `BoxBuffer`.\n     * @param renderOrder Optional renderOrder of this buffer.\n     * @param startElementCount Initial number of elements this `BoxBuffer` can hold.\n     * @param maxElementCount Maximum number of elements this `BoxBuffer` can hold.\n     */\n    constructor(material, renderOrder = 0, startElementCount = START_BOX_BUFFER_SIZE, maxElementCount = MAX_BOX_BUFFER_SIZE) {\n        this.material = material;\n        this.renderOrder = renderOrder;\n        this.startElementCount = startElementCount;\n        this.maxElementCount = maxElementCount;\n        this.m_size = 0;\n        this.resizeBuffer(startElementCount);\n        this.pickInfos = new Array();\n    }\n    /**\n     * Duplicate this `BoxBuffer` with same material and renderOrder.\n     *\n     * @returns A clone of this `BoxBuffer`.\n     */\n    clone() {\n        return new BoxBuffer(this.material, this.renderOrder);\n    }\n    /**\n     * Dispose of the geometry.\n     */\n    dispose() {\n        if (this.geometry !== undefined) {\n            this.geometry.dispose();\n            this.geometry = undefined;\n        }\n        this.internalMesh = undefined;\n    }\n    /**\n     * Return the current number of elements the buffer can hold.\n     */\n    get size() {\n        return this.m_size;\n    }\n    /**\n     * Clear's the `BoxBuffer` attribute buffers.\n     */\n    reset() {\n        if (this.positionAttribute !== undefined) {\n            this.positionAttribute.count = 0;\n            this.colorAttribute.count = 0;\n            this.uvAttribute.count = 0;\n            this.indexAttribute.count = 0;\n            this.pickInfos.length = 0;\n        }\n    }\n    /**\n     * Returns `true` if this `BoxBuffer` can hold the specified amount of glyphs. If the buffer\n     * can only add the glyph by increasing the buffer size, the resize() method is called, which\n     * will then create a new geometry for the mesh.\n     *\n     * @param glyphCount Number of glyphs to be added to the buffer.\n     * @returns `true` if the element (box or glyph) can be added to the buffer, `false` otherwise.\n     */\n    canAddElements(glyphCount = 1) {\n        const indexAttribute = this.indexAttribute;\n        if (indexAttribute.count + glyphCount * NUM_INDICES_PER_ELEMENT >=\n            indexAttribute.array.length) {\n            // Too many elements for the current buffer, check if we can resize the buffer.\n            if (indexAttribute.array.length >= this.maxElementCount * NUM_INDICES_PER_ELEMENT) {\n                return false;\n            }\n            const newSize = Math.min(this.maxElementCount, this.size === 0 ? 256 : this.size * 2);\n            this.resize(newSize);\n        }\n        return true;\n    }\n    /**\n     * Returns this `BoxBuffer`'s attribute [[State]].\n     */\n    saveState() {\n        const state = {\n            positionAttributeCount: this.positionAttribute.count,\n            colorAttributeCount: this.colorAttribute.count,\n            uvAttributeCount: this.uvAttribute.count,\n            indexAttributeCount: this.indexAttribute.count,\n            pickInfoCount: this.pickInfos.length\n        };\n        return state;\n    }\n    /**\n     * Store this `BoxBuffer`'s attribute [[State]] to a previously stored one.\n     *\n     * @param state [[State]] struct describing a previous attribute state.\n     */\n    restoreState(state) {\n        this.positionAttribute.count = state.positionAttributeCount;\n        this.colorAttribute.count = state.colorAttributeCount;\n        this.uvAttribute.count = state.uvAttributeCount;\n        this.indexAttribute.count = state.indexAttributeCount;\n        this.pickInfos.length = state.pickInfoCount;\n    }\n    /**\n     * Adds a new box to this `BoxBuffer`.\n     *\n     * @param screenBox [[Math2D.Box]] holding screen coordinates for this box.\n     * @param uvBox [[Math2D.UvBox]] holding uv coordinates for this box.\n     * @param color Box's color.\n     * @param opacity Box's opacity.\n     * @param distance Box's distance to camera.\n     * @param pickInfo Box's picking information.\n     */\n    addBox(screenBox, uvBox, color, opacity, distance, pickInfo) {\n        if (!this.canAddElements()) {\n            return false;\n        }\n        const { s0, t0, s1, t1 } = uvBox;\n        const { x, y, w, h } = screenBox;\n        const r = Math.round(color.r * 255);\n        const g = Math.round(color.g * 255);\n        const b = Math.round(color.b * 255);\n        const a = Math.round(opacity * 255);\n        const positionAttribute = this.positionAttribute;\n        const colorAttribute = this.colorAttribute;\n        const uvAttribute = this.uvAttribute;\n        const indexAttribute = this.indexAttribute;\n        const baseVertex = positionAttribute.count;\n        const baseIndex = indexAttribute.count;\n        positionAttribute.setXYZ(baseVertex, x, y, distance);\n        positionAttribute.setXYZ(baseVertex + 1, x + w, y, distance);\n        positionAttribute.setXYZ(baseVertex + 2, x, y + h, distance);\n        positionAttribute.setXYZ(baseVertex + 3, x + w, y + h, distance);\n        colorAttribute.setXYZW(baseVertex, r, g, b, a);\n        colorAttribute.setXYZW(baseVertex + 1, r, g, b, a);\n        colorAttribute.setXYZW(baseVertex + 2, r, g, b, a);\n        colorAttribute.setXYZW(baseVertex + 3, r, g, b, a);\n        uvAttribute.setXY(baseVertex, s0, t0);\n        uvAttribute.setXY(baseVertex + 1, s1, t0);\n        uvAttribute.setXY(baseVertex + 2, s0, t1);\n        uvAttribute.setXY(baseVertex + 3, s1, t1);\n        indexAttribute.setX(baseIndex, baseVertex);\n        indexAttribute.setX(baseIndex + 1, baseVertex + 1);\n        indexAttribute.setX(baseIndex + 2, baseVertex + 2);\n        indexAttribute.setX(baseIndex + 3, baseVertex + 2);\n        indexAttribute.setX(baseIndex + 4, baseVertex + 1);\n        indexAttribute.setX(baseIndex + 5, baseVertex + 3);\n        positionAttribute.count += NUM_VERTICES_PER_ELEMENT;\n        colorAttribute.count += NUM_VERTICES_PER_ELEMENT;\n        uvAttribute.count += NUM_VERTICES_PER_ELEMENT;\n        indexAttribute.count += NUM_INDICES_PER_ELEMENT;\n        this.pickInfos.push(pickInfo);\n        return true;\n    }\n    /**\n     * Updates a [[BufferGeometry]] object to reflect the changes in this `TextBuffer`'s attribute\n     * data.\n     */\n    updateBufferGeometry() {\n        const positionAttribute = this.positionAttribute;\n        const colorAttribute = this.colorAttribute;\n        const uvAttribute = this.uvAttribute;\n        const indexAttribute = this.indexAttribute;\n        if (positionAttribute.count > 0) {\n            positionAttribute.needsUpdate = true;\n            positionAttribute.updateRange.offset = 0;\n            positionAttribute.updateRange.count =\n                positionAttribute.count * NUM_VERTICES_PER_ELEMENT;\n        }\n        if (colorAttribute.count > 0) {\n            colorAttribute.needsUpdate = true;\n            colorAttribute.updateRange.offset = 0;\n            colorAttribute.updateRange.count = colorAttribute.count * NUM_VERTICES_PER_ELEMENT;\n        }\n        if (uvAttribute.count > 0) {\n            uvAttribute.needsUpdate = true;\n            uvAttribute.updateRange.offset = 0;\n            uvAttribute.updateRange.count = uvAttribute.count * NUM_VERTICES_PER_ELEMENT;\n        }\n        if (indexAttribute.count > 0) {\n            indexAttribute.needsUpdate = true;\n            indexAttribute.updateRange.offset = 0;\n            indexAttribute.updateRange.count = indexAttribute.count;\n        }\n        if (this.geometry !== undefined) {\n            this.geometry.clearGroups();\n            this.geometry.addGroup(0, this.indexAttribute.count);\n        }\n    }\n    /**\n     * Check if the buffer is empty. If it is empty, the memory usage is minimized to reduce\n     * footprint.\n     */\n    cleanUp() {\n        // If there is nothing in this buffer, resize it, it may never be used again.\n        if (this.indexAttribute.count === 0 && this.size > START_BOX_BUFFER_SIZE) {\n            this.clearAttributes();\n        }\n    }\n    /**\n     * Determine if the mesh is empty.\n     */\n    get isEmpty() {\n        return this.internalMesh.isEmpty;\n    }\n    /**\n     * Get the [[Mesh]] object. The geometry instance of the mesh may change if the buffers are\n     * resized. The mesh, once created, will not change, so it can always be added to the scene.\n     */\n    get mesh() {\n        if (this.internalMesh === undefined) {\n            this.resize();\n        }\n        return this.internalMesh;\n    }\n    /**\n     * Fill the picking results for the pixel with the given screen coordinate. If multiple\n     * boxes are found, the order of the results is unspecified.\n     *\n     * @param screenPosition Screen coordinate of picking position.\n     * @param pickCallback Callback to be called for every picked element.\n     * @param imageData Image data to test if the pixel is transparent\n     */\n    pickBoxes(screenPosition, pickCallback, imageData) {\n        const n = this.pickInfos.length;\n        const pickInfos = this.pickInfos;\n        const positions = this.positionAttribute;\n        const screenX = screenPosition.x;\n        const screenY = screenPosition.y;\n        const canvas = document.createElement(\"canvas\");\n        for (let pickInfoIndex = 0; pickInfoIndex < n; pickInfoIndex++) {\n            const positionIndex = pickInfoIndex * NUM_VERTICES_PER_ELEMENT;\n            const minX = positions.getX(positionIndex);\n            if (screenX < minX) {\n                continue;\n            }\n            const maxX = positions.getX(positionIndex + 1);\n            if (screenX > maxX) {\n                continue;\n            }\n            const minY = positions.getY(positionIndex);\n            if (screenY < minY) {\n                continue;\n            }\n            const maxY = positions.getY(positionIndex + 2);\n            if (screenY > maxY) {\n                continue;\n            }\n            const box = new harp_utils_1.Math2D.Box(minX, minY, maxX - minX, maxY - minY);\n            if (imageData !== undefined &&\n                pickInfos[pickInfoIndex].poiInfo !== undefined &&\n                pickInfos[pickInfoIndex].poiInfo.uvBox !== undefined &&\n                this.isPixelTransparent(imageData, screenX, screenY, box, pickInfos[pickInfoIndex].poiInfo.uvBox, canvas)) {\n                continue;\n            }\n            if (pickInfos[pickInfoIndex] !== undefined) {\n                pickCallback(pickInfos[pickInfoIndex]);\n            }\n        }\n    }\n    /**\n     * Creates a new [[Geometry]] object from all the attribute data stored in this `BoxBuffer`.\n     * The [[Mesh]] object may be created if it is not initialized already.\n     *\n     * @param newSize Optional number of elements to resize the buffer to.\n     * @param forceResize Optional flag to force a resize even if new size is smaller than before.\n     */\n    resize(newSize, forceResize) {\n        if (this.geometry !== undefined) {\n            this.geometry.dispose();\n        }\n        this.geometry = new THREE.BufferGeometry();\n        if (newSize !== undefined && (forceResize === true || newSize > this.size)) {\n            this.resizeBuffer(newSize);\n        }\n        this.geometry.addAttribute(\"position\", this.positionAttribute);\n        this.geometry.addAttribute(\"color\", this.colorAttribute);\n        this.geometry.addAttribute(\"uv\", this.uvAttribute);\n        this.geometry.setIndex(this.indexAttribute);\n        this.geometry.addGroup(0, this.indexAttribute.count);\n        if (this.internalMesh === undefined) {\n            this.internalMesh = new BoxBufferMesh(this.geometry, this.material);\n            this.internalMesh.renderOrder = this.renderOrder;\n        }\n        else {\n            this.internalMesh.geometry = this.geometry;\n        }\n        return this.internalMesh;\n    }\n    /**\n     * Update the info with the memory footprint caused by objects owned by the `BoxBuffer`.\n     *\n     * @param info The info object to increment with the values from this `BoxBuffer`.\n     */\n    updateMemoryUsage(info) {\n        const numBytes = this.positionAttribute.count * NUM_POSITION_VALUES_PER_VERTEX * NUM_BYTES_PER_FLOAT +\n            this.colorAttribute.count * NUM_COLOR_VALUES_PER_VERTEX +\n            this.uvAttribute.count * NUM_UV_VALUES_PER_VERTEX * NUM_BYTES_PER_FLOAT +\n            this.indexAttribute.count * NUM_BYTES_PER_INT32; // May be UInt16, so we overestimate\n        info.heapSize += numBytes;\n        info.gpuSize += numBytes;\n    }\n    /**\n     * Check if a pixel is transparent or not.\n     *\n     * @param imageData Data containing the pixels.\n     * @param xScreenPos X position of the pixel.\n     * @param yScreenPos Y position of the pixel.\n     * @param box Bounding box of the image in screen coordinates.\n     * @param uvBox Uv box referred to the given bounding box.\n     * @param canvas Canvas element that will be used to draw the image, in case the imageData is an\n     *      ImageBitmap\n     */\n    isPixelTransparent(imageData, xScreenPos, yScreenPos, box, uvBox, canvas) {\n        let pixelIsTransparent = false;\n        const { u, v } = PixelPicker_1.screenToUvCoordinates(xScreenPos, yScreenPos, box, uvBox);\n        const imageWidth = imageData.width;\n        const x = imageWidth * u;\n        const imageHeight = imageData.height;\n        const y = imageHeight * v;\n        const pixel = PixelPicker_1.getPixelFromImage(x, y, imageData, canvas);\n        if (pixel !== undefined && pixel[3] === 0) {\n            pixelIsTransparent = true;\n        }\n        return pixelIsTransparent;\n    }\n    /**\n     * Remove current attributes and arrays. Minimizes memory footprint.\n     */\n    clearAttributes() {\n        this.positionAttribute = undefined;\n        this.colorAttribute = undefined;\n        this.uvAttribute = undefined;\n        this.indexAttribute = undefined;\n        this.resize(START_BOX_BUFFER_SIZE, true);\n    }\n    /**\n     * Resize the attribute buffers. New value must be larger than the previous one.\n     *\n     * @param newSize New number of elements in the buffer. Number has to be larger than the\n     *      previous size.\n     */\n    resizeBuffer(newSize) {\n        const newPositionArray = new Float32Array(newSize * NUM_VERTICES_PER_ELEMENT * NUM_POSITION_VALUES_PER_VERTEX);\n        if (this.positionAttribute !== undefined && this.positionAttribute.array.length > 0) {\n            const positionAttributeCount = this.positionAttribute.count;\n            newPositionArray.set(this.positionAttribute.array);\n            this.positionAttribute.setArray(newPositionArray);\n            this.positionAttribute.count = positionAttributeCount;\n        }\n        else {\n            this.positionAttribute = new THREE.BufferAttribute(newPositionArray, NUM_POSITION_VALUES_PER_VERTEX);\n            this.positionAttribute.count = 0;\n            this.positionAttribute.setDynamic(true);\n        }\n        const newColorArray = new Uint8Array(newSize * NUM_VERTICES_PER_ELEMENT * NUM_COLOR_VALUES_PER_VERTEX);\n        if (this.colorAttribute !== undefined) {\n            const colorAttributeCount = this.colorAttribute.count;\n            newColorArray.set(this.colorAttribute.array);\n            this.colorAttribute.setArray(newColorArray);\n            this.colorAttribute.count = colorAttributeCount;\n        }\n        else {\n            this.colorAttribute = new THREE.BufferAttribute(newColorArray, NUM_COLOR_VALUES_PER_VERTEX, true);\n            this.colorAttribute.count = 0;\n            this.colorAttribute.setDynamic(true);\n        }\n        const newUvArray = new Float32Array(newSize * NUM_VERTICES_PER_ELEMENT * NUM_UV_VALUES_PER_VERTEX);\n        if (this.uvAttribute !== undefined) {\n            const uvAttributeCount = this.uvAttribute.count;\n            newUvArray.set(this.uvAttribute.array);\n            this.uvAttribute.setArray(newUvArray);\n            this.uvAttribute.count = uvAttributeCount;\n        }\n        else {\n            this.uvAttribute = new THREE.BufferAttribute(newUvArray, NUM_UV_VALUES_PER_VERTEX);\n            this.uvAttribute.count = 0;\n            this.uvAttribute.setDynamic(true);\n        }\n        const numIndexValues = newSize * NUM_INDICES_PER_ELEMENT * NUM_INDEX_VALUES_PER_VERTEX;\n        const newIndexArray = numIndexValues > 65535\n            ? new Uint32Array(numIndexValues)\n            : new Uint16Array(numIndexValues);\n        if (this.indexAttribute !== undefined) {\n            const indexAttributeCount = this.indexAttribute.count;\n            newIndexArray.set(this.indexAttribute.array);\n            this.indexAttribute.setArray(newIndexArray);\n            this.indexAttribute.count = indexAttributeCount;\n        }\n        else {\n            this.indexAttribute = new THREE.BufferAttribute(newIndexArray, NUM_INDEX_VALUES_PER_VERTEX);\n            this.indexAttribute.count = 0;\n            this.indexAttribute.setDynamic(true);\n        }\n        this.m_size = newSize;\n    }\n}\nexports.BoxBuffer = BoxBuffer;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\n/**\n * It returns an array containing the channel colors for the pixel at the given coordinates.\n *\n * @param xPos X value of the pixel.\n * @param yPos Y value of the pixel.\n * @param imageData Data containing the pixels.\n * @param canvas Canvas element that will be used to draw the image, in case the imageData is an\n * ImageBitmap\n */\nfunction getPixelFromImage(xPos, yPos, imageData, canvas) {\n    let pickedColor;\n    const isImageBitmap = (imgData) => {\n        return imgData.close !== undefined;\n    };\n    if (isImageBitmap(imageData)) {\n        if (canvas === undefined) {\n            canvas = document.createElement(\"canvas\");\n        }\n        pickedColor = getPixelFromImageBitmap(imageData, xPos, yPos, canvas);\n    }\n    else {\n        const pixelsData = imageData;\n        const stride = pixelsData.data.length / (pixelsData.height * pixelsData.width);\n        pickedColor = getPixelFromImageData(pixelsData, xPos, yPos, stride);\n    }\n    return pickedColor;\n}\nexports.getPixelFromImage = getPixelFromImage;\n/**\n * Given the x and y position in screen coordinates inside the target box, it map them to the UV\n * coordinates.\n * @param screenX X value in screen coordinates.\n * @param screenY Y value in screen coordinates.\n * @param box Bounding box in screen coordinates.\n * @param uvBox Uv box referred to the given bounding box.\n */\nfunction screenToUvCoordinates(screenX, screenY, box, uvBox) {\n    const minX = box.x;\n    const maxX = box.x + box.w;\n    const minY = box.y;\n    const maxY = box.y + box.h;\n    const u = harp_utils_1.MathUtils.lerp(screenX, minX, maxX, uvBox.s0, uvBox.s1);\n    const v = harp_utils_1.MathUtils.lerp(screenY, minY, maxY, uvBox.t0, uvBox.t1);\n    return { u, v };\n}\nexports.screenToUvCoordinates = screenToUvCoordinates;\n/**\n * It returns an Uint8ClampedArray containing the color channel values for the given pixel\n * coordinates. It returns undefined if the given coordinates are out of range.\n *\n * @param image Bitmap image in which the pixels are stored.\n * @param xPos X value of the pixel.\n * @param yPos Y value of the pixel.\n * @param canvas HTML Canvas element on which the image is drawn.\n */\nfunction getPixelFromImageBitmap(image, xPos, yPos, canvas) {\n    if (xPos > image.width || xPos < 0 || yPos > image.height || yPos < 0) {\n        return undefined;\n    }\n    let pixelData;\n    canvas.width = image.width;\n    canvas.height = image.height;\n    const context = canvas.getContext(\"2d\");\n    if (context !== null) {\n        context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\n        pixelData = context.getImageData(xPos, yPos, 1, 1).data;\n    }\n    return pixelData;\n}\nexports.getPixelFromImageBitmap = getPixelFromImageBitmap;\n/**\n * It returns an Uint8ClampedArray containing the color channel values for the given pixel\n * coordinates. It returns undefined if the given coordinates are out of range.\n *\n * @param image Image data in which the pixels are stored.\n * @param xPos X value of the pixel.\n * @param yPos Y value of the pixel.\n * @param stride The stride value of the image data.\n */\nfunction getPixelFromImageData(imgData, xPos, yPos, stride) {\n    const getPixel = (imageData, index, strd) => {\n        const i = index * strd;\n        const d = imageData.data;\n        const pixel = new Uint8ClampedArray(strd);\n        for (let s = 0; s < strd; s++) {\n            pixel[0] = d[i + s];\n        }\n        return pixel;\n    };\n    if (xPos > imgData.width || xPos < 0 || yPos > imgData.height || yPos < 0) {\n        return undefined;\n    }\n    return getPixel(imgData, yPos * imgData.width + xPos, stride);\n}\nexports.getPixelFromImageData = getPixelFromImageData;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * @hidden\n */\nclass SimpleLineCurve extends THREE.LineCurve {\n    constructor(v1, v2) {\n        super(v1, v2);\n    }\n    getLengths() {\n        if (this.m_lengths === undefined) {\n            this.m_lengths = [0, this.v2.distanceTo(this.v1)];\n        }\n        return this.m_lengths;\n    }\n}\nexports.SimpleLineCurve = SimpleLineCurve;\n/**\n * @hidden\n */\nclass PathParam {\n    constructor(path, index, t) {\n        this.path = path;\n        this.index = index;\n        this.t = t;\n    }\n    get curve() {\n        return this.path.curves[this.index];\n    }\n    get point() {\n        if (this.m_point === undefined) {\n            this.m_point = this.curve.getPoint(this.t);\n        }\n        return this.m_point;\n    }\n}\nexports.PathParam = PathParam;\n/**\n * @hidden\n */\nclass SimplePath extends THREE.Path {\n    constructor() {\n        super();\n    }\n    getLengths() {\n        if (this.m_cache) {\n            return this.m_cache;\n        }\n        let sum = 0;\n        const lengths = new Array();\n        lengths.push(0);\n        this.curves.forEach(curve => {\n            const lineCurve = curve;\n            sum += lineCurve.v1.distanceTo(lineCurve.v2);\n            lengths.push(sum);\n        });\n        this.m_cache = lengths;\n        return lengths;\n    }\n    getParamAt(t) {\n        const distance = t * this.getLength();\n        const curveLengths = this.getCurveLengths();\n        for (let index = 0; index < curveLengths.length; ++index) {\n            if (curveLengths[index] < distance) {\n                continue;\n            }\n            const diff = curveLengths[index] - distance;\n            const curve = this.curves[index];\n            const segmentLength = curve.getLength();\n            const u = segmentLength === 0 ? 0 : 1 - diff / segmentLength;\n            return new PathParam(this, index, u);\n        }\n        return null;\n    }\n}\nexports.SimplePath = SimplePath;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst THREE = require(\"three\");\nconst LowResRenderPass_1 = require(\"./LowResRenderPass\");\nconst MSAARenderPass_1 = require(\"./MSAARenderPass\");\nconst DEFAULT_DYNAMIC_MSAA_SAMPLING_LEVEL = MSAARenderPass_1.MSAASampling.Level_1;\nconst DEFAULT_STATIC_MSAA_SAMPLING_LEVEL = MSAARenderPass_1.MSAASampling.Level_4;\n/**\n * The implementation of [[IMapRenderingManager]] to instantiate in [[MapView]] and manage the map\n * rendering.\n */\nclass MapRenderingManager {\n    /**\n     * The constructor of `MapRenderingManager`.\n     *\n     * @param width Width of the frame buffer.\n     * @param height Height of the frame buffer.\n     * @param lowResPixelRatio The `pixelRatio` determines the resolution of the internal\n     *  `WebGLRenderTarget`. Values between 0.5 and `window.devicePixelRatio` can be tried to give\n     * good results. A value of `undefined` disables the low res render pass. The value should not\n     * be larger than`window.devicePixelRatio`.\n     * @param antialiasSetting The object defining the demeanor of MSAA.\n     */\n    constructor(width, height, lowResPixelRatio, antialiasSettings = { msaaEnabled: false }) {\n        this.m_readBuffer = new THREE.WebGLRenderTarget(width, height);\n        this.m_msaaPass = new MSAARenderPass_1.MSAARenderPass();\n        this.m_msaaPass.enabled =\n            antialiasSettings !== undefined ? antialiasSettings.msaaEnabled === true : false;\n        this.m_dynamicMsaaSamplingLevel =\n            antialiasSettings.dynamicMsaaSamplingLevel === undefined\n                ? DEFAULT_DYNAMIC_MSAA_SAMPLING_LEVEL\n                : antialiasSettings.dynamicMsaaSamplingLevel;\n        this.m_staticMsaaSamplingLevel =\n            antialiasSettings.staticMsaaSamplingLevel === undefined\n                ? DEFAULT_STATIC_MSAA_SAMPLING_LEVEL\n                : antialiasSettings.staticMsaaSamplingLevel;\n        this.m_lowResPass = new LowResRenderPass_1.LowResRenderPass(lowResPixelRatio);\n        this.m_lowResPass.enabled = lowResPixelRatio !== undefined;\n    }\n    /**\n     * The method to call to render the map with the `MapRenderingManager` instance. It contains the\n     * chain of sub-passes that can transfer the write and read buffers, and other sheer rendering\n     * conditions as disabling AA when a high DPI device is in use.\n     *\n     * @param renderer The ThreeJS WebGLRenderer instance to render the map with.\n     * @param scene The ThreeJS Scene instance containing the map objects to render.\n     * @param camera The ThreeJS Camera instance to render the scene through.\n     * @param isStaticFrame Whether the frame to render is static or dynamic. Selects level of\n     * antialiasing.\n     */\n    render(renderer, scene, camera, isStaticFrame) {\n        if (!isStaticFrame && this.m_lowResPass.pixelRatio !== undefined) {\n            // Not designed to be combined with our own MSAA\n            const target = null;\n            this.m_lowResPass.renderToScreen = true;\n            this.m_lowResPass.render(renderer, scene, camera, target, this.m_readBuffer);\n            return;\n        }\n        const isHighDpiDevice = renderer.getPixelRatio() > 1.1; // On desktop IE11 is ~1.01.\n        // 1. First pass (and only for the map part) : base scene render.\n        if (isHighDpiDevice) {\n            // On smartphones, discard AAs as the pixel ratio already stands for this and also makes\n            // AA passes much more expensive.\n            renderer.render(scene, camera);\n        }\n        else {\n            // Later with further effects, a ThreeJS WebGLRenderTarget will be needed as the\n            // destination of the render call.\n            const target = null;\n            if (this.m_msaaPass.enabled) {\n                // Use a higher MSAA sampling level for static rendering.\n                this.m_msaaPass.samplingLevel = isStaticFrame\n                    ? this.m_staticMsaaSamplingLevel\n                    : this.m_dynamicMsaaSamplingLevel;\n                // MSAA is the only effect for the moment.\n                this.m_msaaPass.renderToScreen = true;\n                // Render to the specified target with the MSAA pass.\n                this.m_msaaPass.render(renderer, scene, camera, target, this.m_readBuffer);\n            }\n            else {\n                renderer.render(scene, camera);\n            }\n        }\n        // 2. Further passes could then be implemented here on top of the base pass.\n    }\n    /**\n     * The resize function to call on resize events to resize the render targets. It shall include\n     * the resize methods of all the sub-passes used in `MapRenderingManager`.\n     *\n     * @param width New width to use.\n     * @param height New height to use.\n     */\n    setSize(width, height) {\n        this.m_readBuffer.setSize(width, height);\n        this.m_msaaPass.setSize(width, height);\n        this.m_lowResPass.setSize(width, height);\n    }\n    /**\n     * The `lowResPixelRatio` determines the resolution of the internal `WebGLRenderTarget`. Values\n     * between 0.5 and `window.devicePixelRatio` can be tried to give  good results. A value of\n     * `undefined` disables the low res render pass. The value should not be larger than\n     * `window.devicePixelRatio`.\n     */\n    get lowResPixelRatio() {\n        return this.m_lowResPass.pixelRatio;\n    }\n    set lowResPixelRatio(pixelRatio) {\n        this.m_lowResPass.pixelRatio = pixelRatio;\n        this.m_lowResPass.enabled = pixelRatio !== undefined;\n    }\n    /**\n     * Set the level of sampling while the user interacts.\n     *\n     * @param samplingLevel The sampling level.\n     */\n    set dynamicMsaaSamplingLevel(samplingLevel) {\n        this.m_dynamicMsaaSamplingLevel = samplingLevel;\n    }\n    /**\n     * Return the sampling level defined during continuous rendering.\n     */\n    get dynamicMsaaSamplingLevel() {\n        return this.m_dynamicMsaaSamplingLevel;\n    }\n    /**\n     * Enable or disable the MSAA. If disabled, `MapRenderingManager` will use the renderer provided\n     * in the [[MapRenderingManager.render]] method to render the scene.\n     *\n     * @param value If `true`, MSAA is enabled, disabled otherwise.\n     */\n    set msaaEnabled(value) {\n        this.m_msaaPass.enabled = value;\n    }\n    /**\n     * Return whether the MSAA is enabled.\n     */\n    get msaaEnabled() {\n        return this.m_msaaPass.enabled;\n    }\n    /**\n     * Set the sampling level for rendering static frames.\n     *\n     * @param samplingLevel The sampling level.\n     */\n    set staticMsaaSamplingLevel(samplingLevel) {\n        this.m_staticMsaaSamplingLevel = samplingLevel;\n    }\n    /**\n     * Return the sampling level defined for rendering static frames.\n     */\n    get staticMsaaSamplingLevel() {\n        return this.m_staticMsaaSamplingLevel;\n    }\n}\nexports.MapRenderingManager = MapRenderingManager;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst THREE = require(\"three\");\nconst Pass_1 = require(\"./Pass\");\n/**\n * The `LowResRenderPass` renders the scene at a lower resolution into an internal\n * `WebGLRenderTarget`, and then copies the result into the frame buffer. The size of the internal\n * buffer is determined by the current frame buffer size multiplied by `pixelRatio`.\n *\n * @note Since no anti-aliasing is applied during dynamic rendering, visual artifacts may be\n * visible.\n */\nclass LowResRenderPass extends Pass_1.Pass {\n    /**\n     * The constructor for `LowResRenderPass`. It builds an internal scene with a camera looking at\n     * a quad.\n     *\n     * @param lowResPixelRatio The `pixelRatio` determines the resolution of the internal\n     *  `WebGLRenderTarget`. Values between 0.5 and `window.devicePixelRatio` can be tried to give\n     * good results. A value of `undefined` disables the low res render pass. The value should not\n     * be larger than`window.devicePixelRatio`.\n     */\n    constructor(lowResPixelRatio) {\n        super();\n        this.lowResPixelRatio = lowResPixelRatio;\n        this.m_renderTarget = null;\n        this.m_localCamera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\n        this.m_quadScene = new THREE.Scene();\n        this.m_quadUniforms = harp_materials_1.CopyShader.uniforms;\n        this.m_quadMaterial = new harp_materials_1.CopyMaterial(this.m_quadUniforms);\n        this.m_quad = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), this.m_quadMaterial);\n        this.m_savedWidth = 0;\n        this.m_savedHeight = 0;\n        this.m_quad.frustumCulled = false;\n        this.m_quadScene.add(this.m_quad);\n        this.m_pixelRatio = lowResPixelRatio;\n    }\n    /**\n     * Releases all used resources.\n     */\n    dispose() {\n        this.m_quadMaterial.dispose();\n        this.m_quad.geometry.dispose();\n        if (this.m_renderTarget !== null) {\n            this.m_renderTarget.dispose();\n            this.m_renderTarget = null;\n        }\n    }\n    /**\n     * If a value is specified, a low resolution render pass is used to render the scene into a\n     * low resolution render target, before it is copied to the screen.\n     *\n     * A value of `undefined` disables the low res render pass. The value should not be larger than\n     * `window.devicePixelRatio`.\n     *\n     * @default `undefined`\n     */\n    set pixelRatio(ratio) {\n        this.m_pixelRatio = ratio;\n        if (this.m_renderTarget && this.pixelRatio !== undefined) {\n            this.m_renderTarget.setSize(Math.floor(this.m_savedWidth * this.pixelRatio), Math.floor(this.m_savedHeight * this.pixelRatio));\n        }\n    }\n    get pixelRatio() {\n        return this.m_pixelRatio;\n    }\n    /**\n     * The render function of `LowResRenderPass`. It renders the whole scene into an internal\n     * `WebGLRenderTarget` instance with a lower resolution, using the passed in `WebGLRenderer`.\n     * The low resolution image is then copied to the `writeBuffer`, which is `undefined` in case it\n     * is the screen.\n     *\n     * @param renderer The ThreeJS WebGLRenderer instance to render the scene with.\n     * @param scene The ThreeJS Scene instance to render the scene with.\n     * @param camera The ThreeJS Camera instance to render the scene with.\n     * @param writeBuffer A ThreeJS WebGLRenderTarget instance to render the scene to.\n     * @param readBuffer A ThreeJS WebGLRenderTarget instance to render the scene.\n     */\n    render(renderer, scene, camera, writeBuffer, readBuffer) {\n        if (!this.enabled || this.pixelRatio === undefined) {\n            return;\n        }\n        // Initiates the local render target with the read buffer's dimensions, if not available.\n        if (this.m_renderTarget === null) {\n            this.m_savedWidth = readBuffer.width;\n            this.m_savedHeight = readBuffer.height;\n            this.m_renderTarget = new THREE.WebGLRenderTarget(Math.floor(this.m_savedWidth * this.pixelRatio), Math.floor(this.m_savedHeight * this.pixelRatio), {\n                minFilter: THREE.LinearFilter,\n                magFilter: THREE.LinearFilter,\n                format: THREE.RGBAFormat,\n                depthBuffer: true,\n                stencilBuffer: true\n            });\n            this.m_renderTarget.texture.name = \"LowResRenderPass.sample\";\n        }\n        this.m_quadUniforms.tDiffuse.value = this.m_renderTarget.texture;\n        this.m_quadUniforms.opacity.value = 1.0;\n        const oldRenderTarget = renderer.getRenderTarget();\n        renderer.setRenderTarget(this.m_renderTarget);\n        renderer.clear();\n        // Render into the low resolution internal render target.\n        renderer.render(scene, camera);\n        // Render the low resolution target into the screen.\n        // NOTE: three.js doesn't like undefined as renderTarget, but works with `null`\n        renderer.setRenderTarget(this.renderToScreen ? null : writeBuffer);\n        renderer.clear();\n        renderer.render(this.m_quadScene, this.m_localCamera);\n        renderer.setRenderTarget(oldRenderTarget);\n    }\n    /**\n     * Resize the internal render target to match the new size specified. The size of internal\n     * buffer depends on the `pixelRatio`.\n     *\n     * @param width New width to apply to the render target.\n     * @param height New height to apply to the render target.\n     */\n    setSize(width, height) {\n        this.m_savedWidth = width;\n        this.m_savedHeight = height;\n        if (this.m_renderTarget && this.pixelRatio !== undefined) {\n            this.m_renderTarget.setSize(Math.floor(width * this.pixelRatio), Math.floor(height * this.pixelRatio));\n        }\n    }\n}\nexports.LowResRenderPass = LowResRenderPass;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"@here/harp-fetch\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"WorkerLoader\");\n/**\n * Set of `Worker` loading and initialization helpers:\n *  - starting Worker from URL with fallback to XHR+blob [[WorkerLoader.startWorker]]\n *  - waiting for proper worker initialization, see [[WorkerLoader.waitWorkerInitialized]]\n */\nclass WorkerLoader {\n    /**\n     * Starts worker by first attempting load from `scriptUrl` using native `Worker` constructor.\n     * Then waits (using [[waitWorkerInitialized]]) for its successful initialization. In case of\n     * error falls back to [[startWorkerBlob]].\n     *\n     * This method is needed as browsers in general forbid to load worker if it's not on 'same\n     * origin' regardless of Content-Security-Policy.\n     *\n     * For blob-based fallback work, one need to ensure that Content Security Policy (CSP) allows\n     * loading web worker code from `Blob`s. By default browsers, allow 'blob:' for workers, but\n     * this may change.\n     *\n     * Following snippet setups CSP, so workers can be started from blob urls:\n     *\n     *     <head>\n     *         <meta http-equiv=\"Content-Security-Policy\" content=\"child-src blob:\">\n     *     </head>\n     *\n     * Tested on:\n     *   * Chrome 67 / Linux, Window, OSX, Android\n     *   * Firefox 60 / Linux, Windows, OSX\n     *   * Edge 41 / Windows\n     *   * Safari 11 / OSX\n     *   * Samsung Internet 7.2\n     *\n     * See\n     *  * https://benohead.com/cross-domain-cross-browser-web-workers/\n     *  * MapBox\n     *    * https://stackoverflow.com/questions/21913673/execute-web-worker-from-different-origin\n     *    * https://github.com/mapbox/mapbox-gl-js/issues/2658\n     *    * https://github.com/mapbox/mapbox-gl-js/issues/559\n     *    * https://github.com/mapbox/mapbox-gl-js/issues/6058\n     *\n     * Findings:\n     *\n     * * Chrome reports CSP by exception when constructing [[Worker]] instance.\n     * * Firefox reports CSP errors when loading in first event:\n     *   https://bugzilla.mozilla.org/show_bug.cgi?id=1241888\n     * * Firefox 62, Chrome 67 obeys `<meta http-equiv=\"Content-Security-Policy\">` with\n     *   `worker-src blob:` but doesn't obey `worker-src URL` when used\n     * * Chrome 67 doesn't obey CSP `worker-src URL` despite it's documented as supported\n     *   (https://developer.mozilla.org/docs/Web/HTTP/Headers/Content-Security-Policy/worker-src)\n     *\n     * @param scriptUrl web worker script URL\n     */\n    static startWorker(scriptUrl) {\n        if (scriptUrl.startsWith(\"blob:\")) {\n            return this.startWorkerImmediately(scriptUrl);\n        }\n        if (this.directlyFallbackToBlobBasedLoading) {\n            return this.startWorkerBlob(scriptUrl);\n        }\n        return this.startWorkerImmediately(scriptUrl).catch(error => {\n            logger.log(\"#startWorker: worker construction failed, attempting load with blob\");\n            this.directlyFallbackToBlobBasedLoading = true;\n            return WorkerLoader.startWorkerBlob(scriptUrl);\n        });\n    }\n    /**\n     * Start worker, loading it immediately from `scriptUrl`. Waits (using\n     * [[waitWorkerInitialized]]) for successful worker start.\n     *\n     * @param scriptUrl web worker script URL\n     */\n    static startWorkerImmediately(scriptUrl) {\n        try {\n            const worker = new Worker(scriptUrl);\n            return this.waitWorkerInitialized(worker);\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    /**\n     * Start worker \"via blob\" by first loading worker script code with [[fetch]], creating `Blob`\n     * and attempting to start worker from blob url. Waits (using [[waitWorkerInitialized]]) for\n     * successful worker start.\n     *\n     * @param scriptUrl web worker script URL\n     */\n    static startWorkerBlob(scriptUrl) {\n        return this.fetchScriptSourceToBlobUrl(scriptUrl).then(blobUrl => {\n            return this.startWorkerImmediately(blobUrl);\n        });\n    }\n    /**\n     * Fetch script source as `Blob` url.\n     *\n     * Reuses results, if there are many simultaneous requests.\n     *\n     * @param scriptUrl web worker script URL\n     * @return promise that resolves to url of a `Blob` with script source code\n     */\n    static fetchScriptSourceToBlobUrl(scriptUrl) {\n        let loadingPromise = this.sourceLoaderCache.get(scriptUrl);\n        if (loadingPromise !== undefined) {\n            return loadingPromise;\n        }\n        loadingPromise = fetch(scriptUrl)\n            .then(response => response.text())\n            .catch(error => {\n            throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${error}`);\n        })\n            .then(scriptSource => {\n            this.sourceLoaderCache.delete(scriptUrl);\n            const blob = new Blob([scriptSource], { type: \"application/javascript\" });\n            return URL.createObjectURL(blob);\n        });\n        this.sourceLoaderCache.set(scriptUrl, loadingPromise);\n        return loadingPromise;\n    }\n    /**\n     * Waits for successful Web Worker start.\n     *\n     * Expects that worker script sends initial message.\n     *\n     * If first event is `message` then assumes that worker has been loaded sussesfully and promise\n     * resolves to `worker` object passed as argument.\n     *\n     * If first event is 'error', then it is assumed that worker failed to load and promise is\n     * rejected.\n     *\n     * (NOTE: The initial 'message' - if received - is immediately replayed using worker's\n     * `dispatchEvent`, so application code can also consume it as confirmation of successful\n     * worker initialization.\n     *\n     * @param worker [[Worker]] instance to be checked\n     * @returns `Promise` that resolves to `worker` on success\n     */\n    static waitWorkerInitialized(worker) {\n        return new Promise((resolve, reject) => {\n            const firstMessageCallback = (event) => {\n                worker.removeEventListener(\"message\", firstMessageCallback);\n                worker.removeEventListener(\"error\", errorCallback);\n                resolve(worker);\n                // We've just consumed first message from worker before client has any chance to\n                // even call `addEventListener` on it, so here after resolve, we wait next tick and\n                // replay message so user has chance to intercept it in its own handler.\n                setTimeout(() => {\n                    worker.dispatchEvent(event);\n                }, 0);\n            };\n            const errorCallback = (error) => {\n                // Error events do not carry any useful information on tested browsers, so we assume\n                // that any error before 'firstMessageCallback' as failed Worker initialization.\n                worker.removeEventListener(\"message\", firstMessageCallback);\n                worker.removeEventListener(\"error\", errorCallback);\n                reject(new Error(\"#waitWorkerInitialized: Error event before first message.\"));\n            };\n            worker.addEventListener(\"message\", firstMessageCallback);\n            worker.addEventListener(\"error\", errorCallback);\n        });\n    }\n}\nWorkerLoader.directlyFallbackToBlobBasedLoading = false;\nWorkerLoader.sourceLoaderCache = new Map();\nexports.WorkerLoader = WorkerLoader;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst DebugContext_1 = require(\"./DebugContext\");\n// tslint:disable-next-line:no-var-requires\nconst RTree = require(\"rtree\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"ScreenCollissions\");\n/**\n * @hidden\n */\nclass ScreenCollisions {\n    /**\n     * Constructs a new ScreenCollisions object.\n     */\n    constructor() {\n        /** The screen bounding box. */\n        this.screenBounds = new harp_utils_1.Math2D.Box();\n        /** Tree of allocated bounds. */\n        this.rtree = new RTree();\n        /**\n         * An array of temporary variables used when converting boxes to reduce allocations.\n         */\n        this.m_returnArray = [];\n        //\n    }\n    /**\n     * Converts a [[THREE.Box2]] to an internal [[Math2D.Box]].\n     *\n     * @param threeBox The [[THREE.Box2]] to convert.\n     * @param box2 The conversion target.\n     */\n    static toBox2D(threeBox, box2) {\n        box2.x = threeBox.min.x;\n        box2.y = threeBox.min.y;\n        box2.w = threeBox.max.x - threeBox.min.x;\n        box2.h = threeBox.max.y - threeBox.min.y;\n    }\n    /**\n     * Resets the list of allocated screen bounds.\n     */\n    reset() {\n        this.rtree = new RTree();\n    }\n    /**\n     * Updates the screen bounds that are used to check if bounding boxes are visible.\n     *\n     * @param width The width of the container.\n     * @param height The height of the container.\n     */\n    update(width, height) {\n        this.screenBounds.set(width / -2, height / -2, width, height);\n        this.reset();\n    }\n    /**\n     * Marks the region of the screen intersecting with the given bounding box as allocated.\n     *\n     * @param bounds The bounding box in world coordinates.\n     */\n    allocate(bounds) {\n        this.rtree.insert(bounds, null);\n    }\n    /**\n     * Checks if the given bounding box is already allocated.\n     *\n     * @param bounds The bounding box in world coordinates.\n     */\n    isAllocated(bounds) {\n        // Re-use array to reduce allocations.\n        this.m_returnArray.length = 0;\n        this.m_returnArray = this.rtree.search(bounds, undefined, this.m_returnArray);\n        return this.m_returnArray.length !== 0;\n    }\n    /**\n     * Checks if the given screen bounds intersects with the frustum of the active camera.\n     *\n     * @param bounds The bounding box in world coordinates.\n     */\n    isVisible(bounds) {\n        return this.screenBounds.intersects(bounds);\n    }\n}\nexports.ScreenCollisions = ScreenCollisions;\n/**\n * @hidden\n *\n * Shows requests for screen space during labelling in an HTML canvas, which should be sized like\n * the actual map canvas. It can be placed on top of the map canvas to show exactly which requests\n * for screen space were done.\n *\n * Also logs statistics.\n */\nclass ScreenCollisionsDebug extends ScreenCollisions {\n    /**\n     * Constructs a new ScreenCollisions object which renders its state to a 2D canvas.\n     */\n    constructor(debugCanvas) {\n        super();\n        /** 2D rendering context. */\n        this.m_renderContext = null;\n        this.m_renderingEnabled = false;\n        this.m_numAllocations = 0;\n        this.m_numSuccessfulTests = 0;\n        this.m_numFailedTests = 0;\n        this.m_numSuccessfulVisibilityTests = 0;\n        this.m_numFailedVisibilityTests = 0;\n        if (debugCanvas !== undefined && debugCanvas !== null) {\n            this.m_renderContext = debugCanvas.getContext(\"2d\");\n        }\n    }\n    /**\n     * Resets the list of allocated bounds and clears the debug canvas.\n     */\n    reset() {\n        super.reset();\n        this.m_numAllocations = 0;\n        this.m_numSuccessfulTests = 0;\n        this.m_numFailedTests = 0;\n        this.m_numSuccessfulVisibilityTests = 0;\n        this.m_numFailedVisibilityTests = 0;\n    }\n    /**\n     * Updates the screen bounds used to check if bounding boxes are visible.\n     *\n     * @param width The width of the container.\n     * @param height The height of the container.\n     */\n    update(width, height) {\n        if (this.m_renderingEnabled) {\n            logger.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `);\n        }\n        super.update(width, height);\n        if (this.m_renderContext !== null) {\n            this.m_renderContext.canvas.width = width;\n            this.m_renderContext.canvas.height = height;\n        }\n        // activate in the browser with:\n        // window.__debugContext.setValue(\"DEBUG_SCREEN_COLLISIONS\", true)\n        this.m_renderingEnabled = DebugContext_1.debugContext.getValue(\"DEBUG_SCREEN_COLLISIONS\");\n    }\n    /**\n     * Marks the region of the screen intersecting with the given bounding box as allocated.\n     *\n     * @param bounds the bounding box in world coordinates.\n     */\n    allocate(bounds) {\n        super.allocate(bounds);\n        this.m_numAllocations++;\n        if (this.m_renderingEnabled && this.m_renderContext !== null) {\n            this.m_renderContext.strokeStyle = \"#6666ff\";\n            this.m_renderContext.strokeRect(bounds.x - this.screenBounds.x, this.screenBounds.y + this.screenBounds.h - bounds.y - 1, bounds.w, -bounds.h);\n        }\n    }\n    /**\n     * Checks if the given bounding box is already allocated.\n     *\n     * @param bounds The bounding box in world coordinates.\n     */\n    isAllocated(bounds) {\n        const isFailed = super.isAllocated(bounds);\n        if (this.m_renderingEnabled && this.m_renderContext !== null) {\n            const offset = isFailed ? 2 : 0;\n            this.m_renderContext.strokeStyle = isFailed ? \"#FF0000\" : \"#00ff00\";\n            this.m_renderContext.strokeRect(bounds.x - this.screenBounds.x - offset, this.screenBounds.y + this.screenBounds.h - bounds.y - 1 + offset, bounds.w + 2 * offset, -bounds.h - 2 * offset);\n        }\n        if (isFailed) {\n            this.m_numFailedTests++;\n        }\n        else {\n            this.m_numSuccessfulTests++;\n        }\n        return isFailed;\n    }\n    /**\n     * Checks if the given screen bounds intersects with the frustum of the active camera.\n     *\n     * @param bounds The bounding box in world coordinates.\n     */\n    isVisible(bounds) {\n        const visible = super.isVisible(bounds);\n        if (visible) {\n            this.m_numSuccessfulVisibilityTests++;\n        }\n        else {\n            this.m_numFailedVisibilityTests++;\n        }\n        return visible;\n    }\n}\nexports.ScreenCollisionsDebug = ScreenCollisionsDebug;\n","'use strict';\nvar RTree = require('./rtree');\nvar geojson = require('./geojson');\nRTree.prototype.bbox = geojson.bbox;\nRTree.prototype.geoJSON = geojson.geoJSON;\nRTree.Rectangle = require('./rectangle');\nmodule.exports = RTree;","'use strict';\nvar rectangle = require('./rectangle');\nfunction RTree(width) {\n  if (!(this instanceof RTree)) {\n    return new RTree(width);\n  }\n  // Variables to control tree-dimensions\n  var minWidth = 3;  // Minimum width of any node before a merge\n  var maxWidth = 6;  // Maximum width of any node before a split\n  if (!isNaN(width)) {\n    minWidth = Math.floor(width / 2.0);\n    maxWidth = width;\n  }\n  // Start with an empty root-tree\n  var rootTree = {x: 0, y: 0, w: 0, h: 0, id: 'root', nodes: [] };\n  this.root = rootTree;\n\n\n  // This is my special addition to the world of r-trees\n  // every other (simple) method I found produced crap trees\n  // this skews insertions to prefering squarer and emptier nodes\n  var flatten = function (tree) {\n    var todo = tree.slice();\n    var done = [];\n    var current;\n    while (todo.length) {\n      current = todo.pop();\n      if (current.nodes) {\n        todo = todo.concat(current.nodes);\n      } else if (current.leaf) {\n        done.push(current);\n      }\n    }\n    return done;\n  };\n  /* find the best specific node(s) for object to be deleted from\n   * [ leaf node parent ] = removeSubtree(rectangle, object, root)\n   * @private\n   */\n  var removeSubtree = function (rect, obj, root) {\n    var hitStack = []; // Contains the elements that overlap\n    var countStack = []; // Contains the elements that overlap\n    var retArray = [];\n    var currentDepth = 1;\n    var tree, i, ltree;\n    if (!rect || !rectangle.overlapRectangle(rect, root)) {\n      return retArray;\n    }\n    var retObj = {x: rect.x, y: rect.y, w: rect.w, h: rect.h, target: obj};\n\n    countStack.push(root.nodes.length);\n    hitStack.push(root);\n    while (hitStack.length > 0) {\n      tree = hitStack.pop();\n      i = countStack.pop() - 1;\n      if ('target' in retObj) { // will this ever be false?\n        while (i >= 0) {\n          ltree = tree.nodes[i];\n          if (rectangle.overlapRectangle(retObj, ltree)) {\n            if ((retObj.target && 'leaf' in ltree && ltree.leaf === retObj.target) || (!retObj.target && ('leaf' in ltree || rectangle.containsRectangle(ltree, retObj)))) {\n              // A Match !!\n            // Yup we found a match...\n            // we can cancel search and start walking up the list\n              if ('nodes' in ltree) {// If we are deleting a node not a leaf...\n                retArray = flatten(tree.nodes.splice(i, 1));\n              } else {\n                retArray = tree.nodes.splice(i, 1);\n              }\n              // Resize MBR down...\n              rectangle.makeMBR(tree.nodes, tree);\n              delete retObj.target;\n              //if (tree.nodes.length < minWidth) { // Underflow\n              //  retObj.nodes = searchSubtree(tree, true, [], tree);\n              //}\n              break;\n            } else if ('nodes' in ltree) { // Not a Leaf\n              currentDepth++;\n              countStack.push(i);\n              hitStack.push(tree);\n              tree = ltree;\n              i = ltree.nodes.length;\n            }\n          }\n          i--;\n        }\n\n      } else if ('nodes' in retObj) { // We are unsplitting\n\n        tree.nodes.splice(i + 1, 1); // Remove unsplit node\n        if (tree.nodes.length > 0) {\n          rectangle.makeMBR(tree.nodes, tree);\n        }\n        for (var t = 0;t < retObj.nodes.length;t++) {\n          insertSubtree(retObj.nodes[t], tree);\n        }\n        retObj.nodes = [];\n        if (hitStack.length === 0 && tree.nodes.length <= 1) { // Underflow..on root!\n          retObj.nodes = searchSubtree(tree, true, retObj.nodes, tree);\n          tree.nodes = [];\n          hitStack.push(tree);\n          countStack.push(1);\n        } else if (hitStack.length > 0 && tree.nodes.length < minWidth) { // Underflow..AGAIN!\n          retObj.nodes = searchSubtree(tree, true, retObj.nodes, tree);\n          tree.nodes = [];\n        } else {\n          delete retObj.nodes; // Just start resizing\n        }\n      } else { // we are just resizing\n        rectangle.makeMBR(tree.nodes, tree);\n      }\n      currentDepth -= 1;\n    }\n    return retArray;\n  };\n\n  /* choose the best damn node for rectangle to be inserted into\n   * [ leaf node parent ] = chooseLeafSubtree(rectangle, root to start search at)\n   * @private\n   */\n  var chooseLeafSubtree = function (rect, root) {\n    var bestChoiceIndex = -1;\n    var bestChoiceStack = [];\n    var bestChoiceArea;\n    var first = true;\n    bestChoiceStack.push(root);\n    var nodes = root.nodes;\n\n    while (first || bestChoiceIndex !== -1) {\n      if (first) {\n        first = false;\n      } else {\n        bestChoiceStack.push(nodes[bestChoiceIndex]);\n        nodes = nodes[bestChoiceIndex].nodes;\n        bestChoiceIndex = -1;\n      }\n\n      for (var i = nodes.length - 1; i >= 0; i--) {\n        var ltree = nodes[i];\n        if ('leaf' in ltree) {\n          // Bail out of everything and start inserting\n          bestChoiceIndex = -1;\n          break;\n        }\n        // Area of new enlarged rectangle\n        var oldLRatio = rectangle.squarifiedRatio(ltree.w, ltree.h, ltree.nodes.length + 1);\n\n        // Enlarge rectangle to fit new rectangle\n        var nw = Math.max(ltree.x + ltree.w, rect.x + rect.w) - Math.min(ltree.x, rect.x);\n        var nh = Math.max(ltree.y + ltree.h, rect.y + rect.h) - Math.min(ltree.y, rect.y);\n\n        // Area of new enlarged rectangle\n        var lratio = rectangle.squarifiedRatio(nw, nh, ltree.nodes.length + 2);\n\n        if (bestChoiceIndex < 0 || Math.abs(lratio - oldLRatio) < bestChoiceArea) {\n          bestChoiceArea = Math.abs(lratio - oldLRatio);\n          bestChoiceIndex = i;\n        }\n      }\n    }\n\n    return bestChoiceStack;\n  };\n\n  /* split a set of nodes into two roughly equally-filled nodes\n   * [ an array of two new arrays of nodes ] = linearSplit(array of nodes)\n   * @private\n   */\n  var linearSplit = function (nodes) {\n    var n = pickLinear(nodes);\n    while (nodes.length > 0) {\n      pickNext(nodes, n[0], n[1]);\n    }\n    return n;\n  };\n\n  /* insert the best source rectangle into the best fitting parent node: a or b\n   * [] = pickNext(array of source nodes, target node array a, target node array b)\n   * @private\n   */\n  var pickNext = function (nodes, a, b) {\n  // Area of new enlarged rectangle\n    var areaA = rectangle.squarifiedRatio(a.w, a.h, a.nodes.length + 1);\n    var areaB = rectangle.squarifiedRatio(b.w, b.h, b.nodes.length + 1);\n    var highAreaDelta;\n    var highAreaNode;\n    var lowestGrowthGroup;\n\n    for (var i = nodes.length - 1; i >= 0;i--) {\n      var l = nodes[i];\n      var newAreaA = {};\n      newAreaA.x = Math.min(a.x, l.x);\n      newAreaA.y = Math.min(a.y, l.y);\n      newAreaA.w = Math.max(a.x + a.w, l.x + l.w) - newAreaA.x;\n      newAreaA.h = Math.max(a.y + a.h, l.y + l.h) - newAreaA.y;\n      var changeNewAreaA = Math.abs(rectangle.squarifiedRatio(newAreaA.w, newAreaA.h, a.nodes.length + 2) - areaA);\n\n      var newAreaB = {};\n      newAreaB.x = Math.min(b.x, l.x);\n      newAreaB.y = Math.min(b.y, l.y);\n      newAreaB.w = Math.max(b.x + b.w, l.x + l.w) - newAreaB.x;\n      newAreaB.h = Math.max(b.y + b.h, l.y + l.h) - newAreaB.y;\n      var changeNewAreaB = Math.abs(rectangle.squarifiedRatio(newAreaB.w, newAreaB.h, b.nodes.length + 2) - areaB);\n\n      if (!highAreaNode || !highAreaDelta || Math.abs(changeNewAreaB - changeNewAreaA) < highAreaDelta) {\n        highAreaNode = i;\n        highAreaDelta = Math.abs(changeNewAreaB - changeNewAreaA);\n        lowestGrowthGroup = changeNewAreaB < changeNewAreaA ? b : a;\n      }\n    }\n    var tempNode = nodes.splice(highAreaNode, 1)[0];\n    if (a.nodes.length + nodes.length + 1 <= minWidth) {\n      a.nodes.push(tempNode);\n      rectangle.expandRectangle(a, tempNode);\n    }  else if (b.nodes.length + nodes.length + 1 <= minWidth) {\n      b.nodes.push(tempNode);\n      rectangle.expandRectangle(b, tempNode);\n    }\n    else {\n      lowestGrowthGroup.nodes.push(tempNode);\n      rectangle.expandRectangle(lowestGrowthGroup, tempNode);\n    }\n  };\n\n  /* pick the 'best' two starter nodes to use as seeds using the 'linear' criteria\n   * [ an array of two new arrays of nodes ] = pickLinear(array of source nodes)\n   * @private\n   */\n  var pickLinear = function (nodes) {\n    var lowestHighX = nodes.length - 1;\n    var highestLowX = 0;\n    var lowestHighY = nodes.length - 1;\n    var highestLowY = 0;\n    var t1, t2;\n\n    for (var i = nodes.length - 2; i >= 0;i--) {\n      var l = nodes[i];\n      if (l.x > nodes[highestLowX].x) {\n        highestLowX = i;\n      } else if (l.x + l.w < nodes[lowestHighX].x + nodes[lowestHighX].w) {\n        lowestHighX = i;\n      }\n      if (l.y > nodes[highestLowY].y) {\n        highestLowY = i;\n      } else if (l.y + l.h < nodes[lowestHighY].y + nodes[lowestHighY].h) {\n        lowestHighY = i;\n      }\n    }\n    var dx = Math.abs((nodes[lowestHighX].x + nodes[lowestHighX].w) - nodes[highestLowX].x);\n    var dy = Math.abs((nodes[lowestHighY].y + nodes[lowestHighY].h) - nodes[highestLowY].y);\n    if (dx > dy)  {\n      if (lowestHighX > highestLowX)  {\n        t1 = nodes.splice(lowestHighX, 1)[0];\n        t2 = nodes.splice(highestLowX, 1)[0];\n      }  else {\n        t2 = nodes.splice(highestLowX, 1)[0];\n        t1 = nodes.splice(lowestHighX, 1)[0];\n      }\n    }  else {\n      if (lowestHighY > highestLowY)  {\n        t1 = nodes.splice(lowestHighY, 1)[0];\n        t2 = nodes.splice(highestLowY, 1)[0];\n      }  else {\n        t2 = nodes.splice(highestLowY, 1)[0];\n        t1 = nodes.splice(lowestHighY, 1)[0];\n      }\n    }\n    return [\n      {x: t1.x, y: t1.y, w: t1.w, h: t1.h, nodes: [t1]},\n      {x: t2.x, y: t2.y, w: t2.w, h: t2.h, nodes: [t2]}\n    ];\n  };\n\n  var attachData = function (node, moreTree) {\n    node.nodes = moreTree.nodes;\n    node.x = moreTree.x;\n    node.y = moreTree.y;\n    node.w = moreTree.w;\n    node.h = moreTree.h;\n    return node;\n  };\n\n  /* non-recursive internal search function\n  * [ nodes | objects ] = searchSubtree(rectangle, [return node data], [array to fill], root to begin search at)\n   * @private\n   */\n  var searchSubtree = function (rect, returnNode, returnArray, root) {\n    var hitStack = []; // Contains the elements that overlap\n\n    if (!rectangle.overlapRectangle(rect, root)) {\n      return returnArray;\n    }\n\n\n    hitStack.push(root.nodes);\n\n    while (hitStack.length > 0) {\n      var nodes = hitStack.pop();\n\n      for (var i = nodes.length - 1; i >= 0; i--) {\n        var ltree = nodes[i];\n        if (rectangle.overlapRectangle(rect, ltree)) {\n          if ('nodes' in ltree) { // Not a Leaf\n            hitStack.push(ltree.nodes);\n          } else if ('leaf' in ltree) { // A Leaf !!\n            if (!returnNode) {\n              returnArray.push(ltree.leaf);\n            } else {\n              returnArray.push(ltree);\n            }\n          }\n        }\n      }\n    }\n\n    return returnArray;\n  };\n\n  /* non-recursive internal insert function\n   * [] = insertSubtree(rectangle, object to insert, root to begin insertion at)\n   * @private\n   */\n  var insertSubtree = function (node, root) {\n    var bc; // Best Current node\n    // Initial insertion is special because we resize the Tree and we don't\n    // care about any overflow (seriously, how can the first object overflow?)\n    if (root.nodes.length === 0) {\n      root.x = node.x;\n      root.y = node.y;\n      root.w = node.w;\n      root.h = node.h;\n      root.nodes.push(node);\n      return;\n    }\n\n    // Find the best fitting leaf node\n    // chooseLeaf returns an array of all tree levels (including root)\n    // that were traversed while trying to find the leaf\n    var treeStack = chooseLeafSubtree(node, root);\n    var retObj = node;//{x:rect.x,y:rect.y,w:rect.w,h:rect.h, leaf:obj};\n    var pbc;\n    // Walk back up the tree resizing and inserting as needed\n    while (treeStack.length > 0) {\n      //handle the case of an empty node (from a split)\n      if (bc && 'nodes' in bc && bc.nodes.length === 0) {\n        pbc = bc; // Past bc\n        bc = treeStack.pop();\n        for (var t = 0;t < bc.nodes.length;t++) {\n          if (bc.nodes[t] === pbc || bc.nodes[t].nodes.length === 0) {\n            bc.nodes.splice(t, 1);\n            break;\n          }\n        }\n      } else {\n        bc = treeStack.pop();\n      }\n\n      // If there is data attached to this retObj\n      if ('leaf' in retObj || 'nodes' in retObj || Array.isArray(retObj)) {\n        // Do Insert\n        if (Array.isArray(retObj)) {\n          for (var ai = 0; ai < retObj.length; ai++) {\n            rectangle.expandRectangle(bc, retObj[ai]);\n          }\n          bc.nodes = bc.nodes.concat(retObj);\n        } else {\n          rectangle.expandRectangle(bc, retObj);\n          bc.nodes.push(retObj); // Do Insert\n        }\n\n        if (bc.nodes.length <= maxWidth)  { // Start Resizeing Up the Tree\n          retObj = {x: bc.x, y: bc.y, w: bc.w, h: bc.h};\n        }  else { // Otherwise Split this Node\n          // linearSplit() returns an array containing two new nodes\n          // formed from the split of the previous node's overflow\n          var a = linearSplit(bc.nodes);\n          retObj = a;//[1];\n\n          if (treeStack.length < 1)  { // If are splitting the root..\n            bc.nodes.push(a[0]);\n            treeStack.push(bc);  // Reconsider the root element\n            retObj = a[1];\n          } /*else {\n            delete bc;\n          }*/\n        }\n      } else { // Otherwise Do Resize\n        //Just keep applying the new bounding rectangle to the parents..\n        rectangle.expandRectangle(bc, retObj);\n        retObj = {x: bc.x, y: bc.y, w: bc.w, h: bc.h};\n      }\n    }\n  };\n\n  this.insertSubtree = insertSubtree;\n  /* quick 'n' dirty function for plugins or manually drawing the tree\n   * [ tree ] = RTree.getTree(): returns the raw tree data. useful for adding\n   * @public\n   * !! DEPRECATED !!\n   */\n  this.getTree = function () {\n    return rootTree;\n  };\n\n  /* quick 'n' dirty function for plugins or manually loading the tree\n   * [ tree ] = RTree.setTree(sub-tree, where to attach): returns the raw tree data. useful for adding\n   * @public\n   * !! DEPRECATED !!\n   */\n  this.setTree = function (newTree, where) {\n    if (!where) {\n      where = rootTree;\n    }\n    return attachData(where, newTree);\n  };\n\n  /* non-recursive search function\n  * [ nodes | objects ] = RTree.search(rectangle, [return node data], [array to fill])\n   * @public\n   */\n  this.search = function (rect, returnNode, returnArray) {\n    returnArray = returnArray || [];\n    return searchSubtree(rect, returnNode, returnArray, rootTree);\n  };\n\n\n  var removeArea = function (rect) {\n    var numberDeleted = 1,\n    retArray = [],\n    deleted;\n    while (numberDeleted > 0) {\n      deleted = removeSubtree(rect, false, rootTree);\n      numberDeleted = deleted.length;\n      retArray = retArray.concat(deleted);\n    }\n    return retArray;\n  };\n\n  var removeObj = function (rect, obj) {\n    var retArray = removeSubtree(rect, obj, rootTree);\n    return retArray;\n  };\n    /* non-recursive delete function\n   * [deleted object] = RTree.remove(rectangle, [object to delete])\n   */\n  this.remove = function (rect, obj) {\n    if (!obj || typeof obj === 'function') {\n      return removeArea(rect, obj);\n    } else {\n      return removeObj(rect, obj);\n    }\n  };\n\n  /* non-recursive insert function\n   * [] = RTree.insert(rectangle, object to insert)\n   */\n  this.insert = function (rect, obj) {\n    var retArray = insertSubtree({x: rect.x, y: rect.y, w: rect.w, h: rect.h, leaf: obj}, rootTree);\n    return retArray;\n  };\n}\nRTree.prototype.toJSON = function (printing) {\n  return JSON.stringify(this.root, false, printing);\n};\n\nRTree.fromJSON = function (json) {\n  var rt = new RTree();\n  rt.setTree(JSON.parse(json));\n  return rt;\n};\n\nmodule.exports = RTree;\n\n\n/**\n * Polyfill for the Array.isArray function\n * todo: Test on IE7 and IE8\n * Taken from https://github.com/geraintluff/tv4/issues/20\n */\nif (typeof Array.isArray !== 'function') {\n  Array.isArray = function (a) {\n    return typeof a === 'object' && {}.toString.call(a) === '[object Array]';\n  };\n}\n","'use strict';\nvar rectangle = require('./rectangle');\nvar bbox = function (ar, obj) {\n  if (obj && obj.bbox) {\n    return {\n      leaf: obj,\n      x: obj.bbox[0],\n      y: obj.bbox[1],\n      w: obj.bbox[2] - obj.bbox[0],\n      h: obj.bbox[3] - obj.bbox[1]\n    };\n  }\n  var len = ar.length;\n  var i = 0;\n  var a = new Array(len);\n  while (i < len) {\n    a[i] = [ar[i][0], ar[i][1]];\n    i++;\n  }\n  var first = a[0];\n  len = a.length;\n  i = 1;\n  var temp = {\n    min: [].concat(first),\n    max: [].concat(first)\n  };\n  while (i < len) {\n    if (a[i][0] < temp.min[0]) {\n      temp.min[0] = a[i][0];\n    }\n    else if (a[i][0] > temp.max[0]) {\n      temp.max[0] = a[i][0];\n    }\n    if (a[i][1] < temp.min[1]) {\n      temp.min[1] = a[i][1];\n    }\n    else if (a[i][1] > temp.max[1]) {\n      temp.max[1] = a[i][1];\n    }\n    i++;\n  }\n  var out = {\n    x: temp.min[0],\n    y: temp.min[1],\n    w: (temp.max[0] - temp.min[0]),\n    h: (temp.max[1] - temp.min[1])\n  };\n  if (obj) {\n    out.leaf = obj;\n  }\n  return out;\n};\nvar geoJSON = {};\ngeoJSON.point = function (obj, self) {\n  return (self.insertSubtree({\n    x: obj.geometry.coordinates[0],\n    y: obj.geometry.coordinates[1],\n    w: 0,\n    h: 0,\n    leaf: obj\n  }, self.root));\n};\ngeoJSON.multiPointLineString = function (obj, self) {\n  return (self.insertSubtree(bbox(obj.geometry.coordinates, obj), self.root));\n};\ngeoJSON.multiLineStringPolygon = function (obj, self) {\n  return (self.insertSubtree(bbox(Array.prototype.concat.apply([], obj.geometry.coordinates), obj), self.root));\n};\ngeoJSON.multiPolygon = function (obj, self) {\n  return (self.insertSubtree(bbox(Array.prototype.concat.apply([], Array.prototype.concat.apply([], obj.geometry.coordinates)), obj), self.root));\n};\ngeoJSON.makeRec = function (obj) {\n  return rectangle(obj.x, obj.y, obj.w, obj.h);\n};\ngeoJSON.geometryCollection = function (obj, self) {\n  if (obj.bbox) {\n    return (self.insertSubtree({\n      leaf: obj,\n      x: obj.bbox[0],\n      y: obj.bbox[1],\n      w: obj.bbox[2] - obj.bbox[0],\n      h: obj.bbox[3] - obj.bbox[1]\n    }, self.root));\n  }\n  var geos = obj.geometry.geometries;\n  var i = 0;\n  var len = geos.length;\n  var temp = [];\n  var g;\n  while (i < len) {\n    g = geos[i];\n    switch (g.type) {\n    case 'Point':\n      temp.push(geoJSON.makeRec({\n        x: g.coordinates[0],\n        y: g.coordinates[1],\n        w: 0,\n        h: 0\n      }));\n      break;\n    case 'MultiPoint':\n      temp.push(geoJSON.makeRec(bbox(g.coordinates)));\n      break;\n    case 'LineString':\n      temp.push(geoJSON.makeRec(bbox(g.coordinates)));\n      break;\n    case 'MultiLineString':\n      temp.push(geoJSON.makeRec(bbox(Array.prototype.concat.apply([], g.coordinates))));\n      break;\n    case 'Polygon':\n      temp.push(geoJSON.makeRec(bbox(Array.prototype.concat.apply([], g.coordinates))));\n      break;\n    case 'MultiPolygon':\n      temp.push(geoJSON.makeRec(bbox(Array.prototype.concat.apply([], Array.prototype.concat.apply([], g.coordinates)))));\n      break;\n    case 'GeometryCollection':\n      geos = geos.concat(g.geometries);\n      len = geos.length;\n      break;\n    }\n    i++;\n  }\n  var first = temp[0];\n  i = 1;\n  len = temp.length;\n  while (i < len) {\n    first.expand(temp[i]);\n    i++;\n  }\n  return self.insertSubtree({\n    leaf: obj,\n    x: first.x(),\n    y: first.y(),\n    h: first.h(),\n    w: first.w()\n  }, self.root);\n};\nexports.geoJSON = function (prelim) {\n  var that = this;\n  var features, feature;\n  if (Array.isArray(prelim)) {\n    features = prelim.slice();\n  }\n  else if (prelim.features && Array.isArray(prelim.features)) {\n    features = prelim.features.slice();\n  }\n  else if (prelim instanceof Object) {\n    features = [prelim];\n  } else {\n    throw ('this isn\\'t what we\\'re looking for');\n  }\n  var len = features.length;\n  var i = 0;\n  while (i < len) {\n    feature = features[i];\n    if (feature.type === 'Feature') {\n      switch (feature.geometry.type) {\n      case 'Point':\n        geoJSON.point(feature, that);\n        break;\n      case 'MultiPoint':\n        geoJSON.multiPointLineString(feature, that);\n        break;\n      case 'LineString':\n        geoJSON.multiPointLineString(feature, that);\n        break;\n      case 'MultiLineString':\n        geoJSON.multiLineStringPolygon(feature, that);\n        break;\n      case 'Polygon':\n        geoJSON.multiLineStringPolygon(feature, that);\n        break;\n      case 'MultiPolygon':\n        geoJSON.multiPolygon(feature, that);\n        break;\n      case 'GeometryCollection':\n        geoJSON.geometryCollection(feature, that);\n        break;\n      }\n    }\n    i++;\n  }\n};\nexports.bbox = function () {\n  var x1, y1, x2, y2;\n  switch (arguments.length) {\n  case 1:\n    x1 = arguments[0][0][0];\n    y1 = arguments[0][0][1];\n    x2 = arguments[0][1][0];\n    y2 = arguments[0][1][1];\n    break;\n  case 2:\n    x1 = arguments[0][0];\n    y1 = arguments[0][1];\n    x2 = arguments[1][0];\n    y2 = arguments[1][1];\n    break;\n  case 4:\n    x1 = arguments[0];\n    y1 = arguments[1];\n    x2 = arguments[2];\n    y2 = arguments[3];\n    break;\n  }\n\n  return this.search({\n    x: x1,\n    y: y1,\n    w: x2 - x1,\n    h: y2 - y1\n  });\n};\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * @hidden\n * Handles the projection of world coordinates to screen coordinates.\n */\nclass ScreenProjector {\n    constructor() {\n        this.m_projectionViewMatrix = new THREE.Matrix4();\n        this.m_viewMatrix = new THREE.Matrix4();\n        this.m_cameraPosition = new THREE.Vector3();\n        this.m_center = new THREE.Vector3();\n        this.m_width = 0;\n        this.m_height = 0;\n        // tslint:disable-next-line:no-unused-variable\n        this.m_nearClipPlane = 0;\n        // tslint:disable-next-line:no-unused-variable\n        this.m_farClipPlane = 0;\n    }\n    /**\n     * Height of the screen.\n     */\n    get width() {\n        return this.m_width;\n    }\n    /**\n     * Width of the screen.\n     */\n    get height() {\n        return this.m_height;\n    }\n    /**\n     * Apply current projectionViewMatrix of the camera to project the source vector into screen\n     * coordinates.\n     *\n     * @param {(THREE.Vector3 | THREE.Vector4)} source The source vector to project.\n     * @param {THREE.Vector3} target The target vector.\n     * @returns {THREE.Vector3} The projected vector (the parameter 'target').\n     */\n    project(source, target = new THREE.Vector2()) {\n        const p = this.projectVector(source, ScreenProjector.tempV3);\n        if (p.z > 0 && p.z < 1) {\n            target.set((p.x * this.m_width) / 2, (p.y * this.m_height) / 2);\n            return target;\n        }\n        return undefined;\n    }\n    /**\n     * Apply current projectionViewMatrix of the camera to project the source vector. Stores result\n     * in NDC in the target vector.\n     *\n     * @param {(THREE.Vector3 | THREE.Vector4)} source The source vector to project.\n     * @param {THREE.Vector3} target The target vector.\n     * @returns {THREE.Vector3} The projected vector (the parameter 'target').\n     */\n    projectVector(source, target) {\n        target.x = source.x - this.m_center.x - this.m_cameraPosition.x;\n        target.y = source.y - this.m_center.y - this.m_cameraPosition.y;\n        target.z = source.z - this.m_center.z - this.m_cameraPosition.z;\n        target.applyMatrix4(this.m_projectionViewMatrix);\n        return target;\n    }\n    /**\n     * Project the 3D source point to a 2D screen point.\n     *\n     * @param {THREE.Vector3} source Point to project.\n     * @param {THREE.Vector2} target 2D screen point to initialize.\n     * @returns {(THREE.Vector2 | undefined)} Result or `undefined` if point is not between near and\n     *      far plane.\n     */\n    projectInPlace(source, target) {\n        const p = this.projectVector(source, ScreenProjector.tempV3);\n        if (p.z > 0 && p.z < 1) {\n            target.set((p.x * this.m_width) / 2, (p.y * this.m_height) / 2);\n            return target;\n        }\n        return undefined;\n    }\n    /**\n     * Fast test to check if projected point is on screen.\n     *\n     * @returns {boolean} `true` if point is on screen, `false` otherwise.\n     */\n    onScreen(source) {\n        const p = this.projectVector(source, ScreenProjector.tempV3);\n        if (p.z > 0 && p.z < 1) {\n            return p.x >= -1 && p.x <= 1 && p.y >= -1 && p.y <= 1;\n        }\n        return false;\n    }\n    /**\n     * Update the `ScreenProjector` with the latest values of the screen and the camera.\n     *\n     * @param {THREE.Camera} camera The current camera.\n     * @param {THREE.Vector3} center Center of the world.\n     * @param {number} width Width of screen/canvas.\n     * @param {number} height Height of screen/canvas.\n     */\n    update(camera, center, width, height) {\n        this.m_width = width;\n        this.m_height = height;\n        if (camera instanceof THREE.PerspectiveCamera) {\n            this.m_nearClipPlane = camera.near;\n            this.m_farClipPlane = camera.far;\n        }\n        this.m_center.copy(center);\n        this.m_viewMatrix.makeRotationFromQuaternion(camera.quaternion);\n        this.m_viewMatrix.transpose();\n        this.m_cameraPosition.copy(camera.position);\n        this.m_projectionViewMatrix.multiplyMatrices(camera.projectionMatrix, this.m_viewMatrix);\n    }\n}\nScreenProjector.tempV2 = new THREE.Vector2();\nScreenProjector.tempV3 = new THREE.Vector3();\nexports.ScreenProjector = ScreenProjector;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst SkyGradientTexture_1 = require(\"./SkyGradientTexture\");\n/**\n * Generates a texture gradient and allows updates to its y-offset.\n *\n * To position the texture correctly, this class reads the value of the four corners of the far\n * clipping plane and calculates the intersection between the line that divides the far clipping\n * plane in to two equal parts, and the ground plane. This intersection point is called\n * `horizonPosition`, and it determines the texture's y-offset.\n *\n * See also [[SkyGradientTexture]].\n */\nclass SkyBackground {\n    /**\n     * Constructs a `SkyBackground` instance.\n     *\n     * @param m_topColor Defines the color of the upper part of the gradient.\n     * @param m_bottomColor Defines the color of bottom part of the gradient, that touches the\n     * ground.\n     * @param m_groundColor Defines the color of the first pixel of the gradient, from the bottom.\n     * @param camera Required to calculate the texture's offset.\n     * @param m_monomialPower Defines the texture's gradient power.\n     *\n     * @example\n     * ```TypeScript\n     * // This creates a texture gradient and uses it as background of the scene.\n     * this.m_skyBackground = new SkyBackground(\n     *     new THREE.Color(\"#FF000\"),\n     *     new THREE.Color(\"#0000FF\"),\n     *     new THREE.Color(\"#F8FBFD\"),\n     *     this.camera\n     * );\n     * this.m_scene.background = this.m_skyBackground.texture;\n     *\n     * // Then, when the camera moves at runtime, the skyBackground needs to be updated.\n     * this.m_skyBackground.update(this.m_camera);\n     * ```\n     */\n    constructor(m_topColor, m_bottomColor, m_groundColor, camera, m_monomialPower = SkyGradientTexture_1.DEFAULT_MONOMIAL_POWER) {\n        this.m_topColor = m_topColor;\n        this.m_bottomColor = m_bottomColor;\n        this.m_groundColor = m_groundColor;\n        this.m_monomialPower = m_monomialPower;\n        this.m_gradient = new SkyGradientTexture_1.SkyGradientTexture(m_topColor, m_bottomColor, m_groundColor, m_monomialPower);\n        this.m_farClipPlaneDividedVertically = new THREE.Line3();\n        this.m_groundPlane = new THREE.Plane(new THREE.Vector3(0, 0, 1));\n        this.m_bottomMidFarPoint = new THREE.Vector3();\n        this.m_topMidFarPoint = new THREE.Vector3();\n        this.m_horizonPosition = new THREE.Vector3();\n        this.m_farClipPlaneCorners = [\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3()\n        ];\n        this.update(camera);\n    }\n    /**\n     * Missing Typedoc\n     */\n    get topColor() {\n        return this.m_topColor;\n    }\n    /**\n     * Missing Typedoc\n     */\n    get bottomColor() {\n        return this.m_bottomColor;\n    }\n    /**\n     * Missing Typedoc\n     */\n    get groundColor() {\n        return this.m_groundColor;\n    }\n    /**\n     * Missing Typedoc\n     */\n    get monomialPower() {\n        return this.m_monomialPower;\n    }\n    /**\n     * Missing Typedoc\n     */\n    get texture() {\n        return this.m_gradient.texture;\n    }\n    /**\n     * Missing Typedoc\n     */\n    get horizon() {\n        return this.m_horizonPosition;\n    }\n    /**\n     * This method updates the position of the texture depending on the camera frustum.\n     *\n     * @param camera The camera used in the map view.\n     */\n    update(camera) {\n        this.setHorizonPosition(camera);\n        this.updateTexturePosition();\n    }\n    /**\n     * Updates the sky texture with new colors.\n     *\n     * @param topColor Color at the zenith.\n     * @param bottomColor Color at the horizon.\n     * @param groundColor This color should match the renderer's clear color in the theme.\n     */\n    updateColors(topColor, bottomColor, groundColor) {\n        this.m_topColor = topColor;\n        this.m_bottomColor = bottomColor;\n        this.m_groundColor = groundColor;\n        this.m_gradient.update(topColor, bottomColor, groundColor);\n    }\n    setHorizonPosition(camera) {\n        this.setFarPlaneCornersFromCamera(camera, this.m_farClipPlaneCorners);\n        const bottomLeftFarCorner = this.m_farClipPlaneCorners[0];\n        const bottomRightFarCorner = this.m_farClipPlaneCorners[1];\n        const topLeftFarCorner = this.m_farClipPlaneCorners[2];\n        const topRightFarCorner = this.m_farClipPlaneCorners[3];\n        this.setMidPoint(bottomLeftFarCorner, bottomRightFarCorner, this.m_bottomMidFarPoint);\n        this.setMidPoint(topLeftFarCorner, topRightFarCorner, this.m_topMidFarPoint);\n        this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint, this.m_topMidFarPoint);\n        const hasIntersection = this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically, this.m_horizonPosition);\n        // when there is no intersection between the ground plane and the\n        // farClipPlaneDividedVertically, be sure that the horizon is reset. Otherwise a previous\n        // intersection point stored in the m_horizonPosition will be considered the valid one.\n        if (!hasIntersection) {\n            this.m_horizonPosition.set(0.0, 0.0, 0.0);\n        }\n    }\n    updateTexturePosition() {\n        const coveredBySky = this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition);\n        const frustumHeight = this.m_farClipPlaneDividedVertically.distance();\n        const skyRatio = coveredBySky / frustumHeight;\n        // if there is no intersection between the ground plane and the line that defines the far\n        // clip plane divided vertically, it means that there is no sky visible and therefore the\n        // ground color should be displayed. When there is no intersection, the length of the\n        // this.m_horizonPosition is still equal to zero, as threejs initialize an empty vector with\n        // all the three components to zero.\n        // If there is an intersection, calculate the offset.\n        let ratio;\n        if (this.m_horizonPosition.length() === 0) {\n            ratio = 1;\n        }\n        else {\n            const groundRatio = 1 / this.m_gradient.texture.image.height;\n            ratio = skyRatio - groundRatio;\n        }\n        // if the bottom part of the far clipping plane is under the ground plane, scroll the\n        // texture down. Otherwise, the camera is looking at the sky, therefore, scroll the texture\n        // up.\n        if (this.m_bottomMidFarPoint.z <= 0) {\n            this.m_gradient.updateYOffset(-ratio);\n        }\n        else {\n            this.m_gradient.updateYOffset(skyRatio);\n        }\n    }\n    setMidPoint(start, end, destination) {\n        destination.set((start.x + end.x) / 2, (start.y + end.y) / 2, (start.z + end.z) / 2);\n    }\n    setFarPlaneCornersFromCamera(camera, corners) {\n        let cornerIndex = 0;\n        function addPoint(x, y, z) {\n            corners[cornerIndex++].set(x, y, z).unproject(camera);\n        }\n        const w = 1;\n        const h = 1;\n        const f = 1;\n        addPoint(-w, -h, f);\n        addPoint(w, -h, f);\n        addPoint(-w, h, f);\n        addPoint(w, h, f);\n    }\n}\nexports.SkyBackground = SkyBackground;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst three_1 = require(\"three\");\nexports.DEFAULT_TEXTURE_HEIGHT = 512;\nconst TEXTURE_WIDTH = 1;\nexports.DEFAULT_MONOMIAL_POWER = 1;\n/**\n * Generates a texture containing a linear gradient.\n *\n * The gradient goes from `topColor` in the top part of the image to `bottomColor` in the bottom\n * part of the image. The default dimension of the texture is 1x256 pixels. The first pixel at the\n * bottom is filled with `groundColor`. This class generates the texture used in [[SkyBackground]]\n * to create the sky background.\n *\n * The colors are defined as follows:\n * - `topColor` is the color that defines the upper part of the sky\n * - `bottomColor` is the color that defines the part of sky above the horizon\n * - `groundColor` is the color of the background below the horizon; which can only be seen when\n *    there are no visible tiles.\n */\nclass SkyGradientTexture {\n    /**\n     * Constructs a `SkyGradientTexture` instance.\n     *\n     * @param m_topColor Defines the top color of the gradient.\n     * @param m_bottomColor Defines the bottom color of the gradient.\n     * @param m_groundColor Defines the first pixel of the gradient, in the bottom part.\n     * @param m_monomialPower Defines the texture's gradient power; the default value is 1\n     * (linear gradient).\n     * @param m_height Defines the texture's height; the default value is 256.\n     *\n     * @example\n     * ```TypeScript\n     * // This snippet creates a texture containing a gradient that goes from red in the upper part\n     * // of the image to blue in the bottom part of the image, with 1 gray pixel at the bottom\n     * // line.\n     * let gradient = new SkyGradientTexture(\n     *   new Color(\"#FF000\"),\n     *   new Color(\"#0000FF\"),\n     *   new Color(\"#F8FBFD\")\n     * );\n     * let texture = gradient.texture;\n     * ```\n     */\n    constructor(m_topColor, m_bottomColor, m_groundColor, m_monomialPower, m_height = exports.DEFAULT_TEXTURE_HEIGHT) {\n        this.m_topColor = m_topColor;\n        this.m_bottomColor = m_bottomColor;\n        this.m_groundColor = m_groundColor;\n        this.m_monomialPower = m_monomialPower;\n        this.m_height = m_height;\n        this.m_texture = this.createTexture();\n    }\n    /**\n     * Returns the `DataTexture` instance.\n     */\n    get texture() {\n        return this.m_texture;\n    }\n    /**\n     * Modifies the offset of the texture.\n     *\n     * @param offset The offset of the texture.\n     */\n    updateYOffset(offset) {\n        if (offset <= 0) {\n            this.m_texture.offset.set(0, offset);\n        }\n    }\n    /**\n     * Updates the Texture with new colors and height.\n     *\n     * @param topColor The new top color.\n     * @param bottomColor The new bottom color.\n     * @param groundColor The new ground color.\n     * @param height The texture's new height.\n     */\n    update(topColor, bottomColor, groundColor, \n    // tslint:disable-next-line:no-unused-variable\n    height = exports.DEFAULT_TEXTURE_HEIGHT) {\n        this.m_topColor = topColor;\n        this.m_bottomColor = bottomColor;\n        this.m_groundColor = groundColor;\n        this.updateTextureColors();\n    }\n    updateTextureColors() {\n        const data = this.m_texture.image.data;\n        this.fillTextureData(data);\n        this.m_texture.needsUpdate = true;\n    }\n    createTexture() {\n        const size = TEXTURE_WIDTH * this.m_height;\n        const data = new Uint8Array(3 * size);\n        this.fillTextureData(data);\n        const texture = new three_1.DataTexture(data, TEXTURE_WIDTH, this.m_height, three_1.RGBFormat);\n        texture.needsUpdate = true;\n        texture.unpackAlignment = 1;\n        return texture;\n    }\n    // When creating the texture, a Uint8Array is required, because the resulting texture passed\n    // to the scene as a background, is a texImage2D object, that does not accept UintClampedArray\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n    // But, when updating the texture, a Uint8ClampedArray is passed as argument, because\n    // this.m_texture.image.data returns a Uint8ClampedArray. That's why this method accepts both.\n    fillTextureData(data) {\n        const size = TEXTURE_WIDTH * this.m_height;\n        const topColor = this.m_topColor;\n        const bottomColor = this.m_bottomColor;\n        const groundColor = this.m_groundColor;\n        // The first pixel of the texture is occupied by the ground color.\n        // This color is used just for the part of the screen that remains below the horizon.\n        data[0] = groundColor.r * 255;\n        data[1] = groundColor.g * 255;\n        data[2] = groundColor.b * 255;\n        const interpolatedColor = new three_1.Color();\n        for (let i = 1; i < size; i++) {\n            const { r, g, b } = interpolatedColor\n                .copy(bottomColor)\n                .lerp(topColor, Math.pow((i / size), this.m_monomialPower))\n                .multiplyScalar(255);\n            const stride = i * 3;\n            data[stride] = r;\n            data[stride + 1] = g;\n            data[stride + 2] = b;\n        }\n    }\n}\nexports.SkyGradientTexture = SkyGradientTexture;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n/**\n * Second step tile culling: Do additional check for intersection of box and frustum by checking if\n * the frustum is outside any plane of the tiles `bbox` (oriented, not AABB). It's in the inverse of\n * the standard frustum test, which excludes many cases where the large terrain tiles straddle the\n * planes of the frustum.\n *\n * @see http://www.iquilezles.org/www/articles/frustumcorrect/frustumcorrect.htm\n */\nclass MapTileCuller {\n    /**\n     * Constructs a `MapTileCuller`.\n     *\n     * @param m_camera A `THREE.Camera`.\n     */\n    constructor(m_camera) {\n        this.m_camera = m_camera;\n        this.m_globalFrustumMin = new THREE.Vector3();\n        this.m_globalFrustumMax = new THREE.Vector3();\n        this.m_frustumCorners = [\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3(),\n            new THREE.Vector3()\n        ];\n    }\n    /**\n     * Sets up culling and computes frustum corners. You mus call this function before the culling\n     * starts.\n     */\n    setup() {\n        const frustumCorners = this.getFrustumCorners();\n        const matrix = this.m_camera.matrixWorld;\n        this.m_globalFrustumMin.set(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n        this.m_globalFrustumMax.set(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\n        for (const frustumCorner of frustumCorners) {\n            frustumCorner.applyMatrix4(matrix);\n            this.m_globalFrustumMin.x = Math.min(this.m_globalFrustumMin.x, frustumCorner.x);\n            this.m_globalFrustumMin.y = Math.min(this.m_globalFrustumMin.y, frustumCorner.y);\n            this.m_globalFrustumMin.z = Math.min(this.m_globalFrustumMin.z, frustumCorner.z);\n            this.m_globalFrustumMax.x = Math.max(this.m_globalFrustumMax.x, frustumCorner.x);\n            this.m_globalFrustumMax.y = Math.max(this.m_globalFrustumMax.y, frustumCorner.y);\n            this.m_globalFrustumMax.z = Math.max(this.m_globalFrustumMax.z, frustumCorner.z);\n        }\n    }\n    /**\n     * Checks if the tile's bounding box intersects with the current view's frustum.\n     *\n     * @param tileBounds The bounding box for the tile.\n     */\n    frustumIntersectsTileBox(tileBounds) {\n        const globalFrustumMin = this.m_globalFrustumMin;\n        const globalFrustumMax = this.m_globalFrustumMax;\n        if (globalFrustumMax.x < tileBounds.min.x ||\n            globalFrustumMax.y < tileBounds.min.y ||\n            globalFrustumMax.z < tileBounds.min.z ||\n            globalFrustumMin.x > tileBounds.max.x ||\n            globalFrustumMin.y > tileBounds.max.y ||\n            globalFrustumMin.z > tileBounds.max.z) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Returns the eight corners of the frustum.\n     */\n    getFrustumCorners() {\n        const frustumCorners = this.m_frustumCorners;\n        const invProjMatrix = this.m_camera.projectionMatrixInverse;\n        let cornerIndex = 0;\n        function addPoint(x, y, z) {\n            frustumCorners[cornerIndex++].set(x, y, z).applyMatrix4(invProjMatrix);\n        }\n        const w = 1;\n        const h = 1;\n        const n = -1;\n        const f = 1;\n        // near\n        addPoint(-w, -h, n);\n        addPoint(w, -h, n);\n        addPoint(-w, h, n);\n        addPoint(w, h, n);\n        // far\n        addPoint(-w, -h, f);\n        addPoint(w, -h, f);\n        addPoint(-w, h, f);\n        addPoint(w, h, f);\n        return frustumCorners;\n    }\n}\nexports.MapTileCuller = MapTileCuller;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst THREE = require(\"three\");\nconst UPDATE_EVENT = { type: \"update\" };\n/**\n * Derive a class from `DataSource` to contribute data and geometries to the [[MapView]].\n */\nclass DataSource extends THREE.EventDispatcher {\n    /**\n     * Constructs a new `DataSource`.\n     *\n     * @param uniqueName A unique name that represents this `DataSource`.\n     * @param styleSetName The name of the [[StyleSet]] to refer to in a [[Theme]], to decode vector\n     * tiles.\n     * @param minZoomLevel Minimum zoom level this `DataSource` can be displayed in.\n     * @param maxZoomLevel Maximum zoom level this `DataSource` can be displayed in.\n     * @param storageLevelOffset Storage level offset applied to this `DataSource`.\n     */\n    constructor(uniqueName, styleSetName, minZoomLevel, maxZoomLevel, storageLevelOffset) {\n        super();\n        /**\n         * Set to `true` if this `DataSource` is enabled; `false` otherwise.\n         */\n        this.enabled = true;\n        /**\n         * Set to `true` if the [[MapView]] can cache tiles produced by this `DataSource`.\n         */\n        this.cacheable = false;\n        /**\n         * If `true` or `undefined`, a geometry for every tile is generated. The background has the size\n         * of the covered tile area. It is required to clear the area of a tile. It is also used to\n         * identify the tile during picking operations. If no tile background is generated, a tile\n         * cannot be identified during picking if no geometry is defined at the picking location. To be\n         * able to pick the tile with the help of the tile background, tile background does not have to\n         * be visible (set `tileBackgroundIsVisible` to `false`).\n         */\n        this.addTileBackground = true;\n        /**\n         * If defined, this option defines the color of the tile background. If it is `undefined`, the\n         * [[MapView.clearColor]] defined in the [[Theme]] is used.\n         */\n        this.tileBackgroundColor = undefined;\n        /**\n         * If set to `true`, and if `addTileBackground` is true, the background is actually rendered. If\n         * set to `false` or `undefined`, the background is only used for picking, but is not rendered,\n         * but only used for picking.\n         */\n        this.tileBackgroundIsVisible = false;\n        /**\n         * Minimum zoom level this `DataSource` can be displayed in.\n         */\n        this.m_minZoomLevel = 1;\n        /**\n         * Maximum zoom level this `DataSource` can be displayed in.\n         */\n        this.m_maxZoomLevel = 20;\n        /**\n         * Storage level offset applied to this `DataSource`.\n         */\n        this.m_storageLevelOffset = 0;\n        if (uniqueName === undefined || uniqueName.length === 0) {\n            uniqueName = `anonymous-datasource#${++DataSource.uniqueNameCounter}`;\n        }\n        this.name = uniqueName;\n        this.styleSetName = styleSetName;\n        if (minZoomLevel !== undefined) {\n            this.m_minZoomLevel = minZoomLevel;\n        }\n        if (maxZoomLevel !== undefined) {\n            this.m_maxZoomLevel = maxZoomLevel;\n        }\n        if (storageLevelOffset !== undefined) {\n            this.m_storageLevelOffset = storageLevelOffset;\n        }\n    }\n    /**\n     * Returns the name of the [[StyleSet]] to use for the decoding.\n     */\n    get styleSetName() {\n        return this.m_styleSetName;\n    }\n    /**\n     * Sets the name of the [[StyleSet]] to use for the decoding. If this [[DataSource]] is already\n     * attached to a [[MapView]], this setter then looks for a [[StyleSet]] with this name and\n     * applies it.\n     */\n    set styleSetName(styleSetName) {\n        this.m_styleSetName = styleSetName;\n        if (this.m_mapView !== undefined &&\n            styleSetName !== undefined &&\n            this.m_mapView.theme.styles !== undefined) {\n            this.setStyleSet(this.m_mapView.theme.styles[styleSetName]);\n        }\n    }\n    /**\n     * Destroys this `DataSource`.\n     */\n    dispose() {\n        // to be overloaded by subclasses\n    }\n    /**\n     * Returns `true` if this `DataSource` is ready and the [[MapView]] can invoke `getTile()` to\n     * start requesting data.\n     */\n    ready() {\n        return true;\n    }\n    /**\n     * The [[MapView]] that is holding this `DataSource`.\n     */\n    get mapView() {\n        if (this.m_mapView === undefined) {\n            throw new Error(\"This DataSource was not added to MapView\");\n        }\n        return this.m_mapView;\n    }\n    /**\n     * The [[Projection]] used by the [[MapView]] that is holding this `DataSource`.\n     *\n     * An `Error` is thrown if you call this method before this `DataSource` has been added\n     * to a [[MapView]].\n     */\n    get projection() {\n        return this.mapView.projection;\n    }\n    /**\n     * This method is called when the `DataSource` is added to a [[MapView]]. Reimplement this\n     * method to provide any custom initialization, such as, to establish a network connection,\n     * or to initialize complex data structures.\n     */\n    connect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // to be overloaded by subclasses\n        });\n    }\n    /**\n     * Returns a [[ElevationRangeSource]] so that [[MapView]] can compute proper bounding boxes that\n     * take the elevation range of the data into account.\n     * There can be only one [[ElevationRangeSource]] per [[MapView]]. [[MapView]] will take the\n     * [[ElevationRangeSource]] of the first enabled data source.\n     * Data sources with different tiling schemes are currently not supported and will not have\n     * proper bounding boxes.\n     */\n    getElevationRangeSource() {\n        return undefined;\n    }\n    /**\n     * This method is called when this `DataSource` is added to a [[MapView]].\n     *\n     * Reimplementations of this method must invoke the definition of the super class.\n     *\n     * @param mapView The instance of the [[MapView]].\n     */\n    attach(mapView) {\n        this.m_mapView = mapView;\n    }\n    /**\n     * This method is called when this `DataSource` is removed from a [[MapView]].\n     *\n     * Reimplementations of this method must invoke the definition of the super class.\n     *\n     * @param mapView The instance of the [[MapView]].\n     */\n    detach(mapView) {\n        harp_utils_1.assert(this.m_mapView === mapView);\n        this.m_mapView = undefined;\n    }\n    /**\n     * Invoked by [[MapView]] to notify when the [[Theme]] has been changed.\n     *\n     * If `DataSource` depends on a theme, it must update its tiles' geometry.\n     *\n     * @param styleSet The new theme that [[MapView]] uses.\n     * @param languages An optional list of languages for the `DataSource`.\n     */\n    // tslint:disable-next-line:no-unused-variable\n    setStyleSet(styleSet, languages) {\n        // to be overwritten by subclasses\n    }\n    /**\n     * Used to configure the languages used by the `DataSource` according to priority;\n     * the first language in the array has the highest priority.\n     *\n     * @param languages An array of ISO 639-1 language codes.\n     */\n    setLanguages(languages) {\n        // to be overloaded by subclasses\n    }\n    /**\n     * This method is called by [[MapView]] before the tile needs to be updated, for example after\n     * a theme change.\n     *\n     * @param tile The [[Tile]] to update.\n     */\n    // tslint:disable-next-line:no-unused-variable\n    updateTile(tile) {\n        // to be overloaded by subclasses\n    }\n    /**\n     * This method is called by the [[MapView]] to determine if the content of the surrounding\n     * tiles must be preloaded.\n     *\n     * @returns `true` if the [[MapView]] should try to preload tiles surrounding the visible\n     * tiles; `false` otherwise. The default is `false`.\n     */\n    shouldPreloadTiles() {\n        return false;\n    }\n    /**\n     * The minimum zoom level to use for display.\n     *\n     * @returns The minimum zoom level to use for display.\n     */\n    get minZoomLevel() {\n        return this.m_minZoomLevel;\n    }\n    set minZoomLevel(level) {\n        this.m_minZoomLevel = level;\n    }\n    /**\n     * The maximum zoom level to use for display.\n     */\n    get maxZoomLevel() {\n        return this.m_maxZoomLevel;\n    }\n    set maxZoomLevel(level) {\n        this.m_maxZoomLevel = level;\n    }\n    /**\n     * The difference between storage level and display level of tile.\n     *\n     * Storage level offset is a value applied (added) to current zoom level giving\n     * a final tile level being displayed. This way we may differentate current\n     * zoom level from the storage level that is displayed, giving fine grained\n     * control over the tiles being decoded an displayed.\n     */\n    get storageLevelOffset() {\n        return this.m_storageLevelOffset;\n    }\n    /**\n     * Setup the relative offset between storage level and display level of tile.\n     *\n     * @param levelOffset Difference between zoom level and display level.\n     */\n    set storageLevelOffset(levelOffset) {\n        this.m_storageLevelOffset = levelOffset;\n    }\n    /**\n     * Computes the zoom level to use for display.\n     *\n     * @param zoomLevel The zoom level of the [[MapView]].\n     * @returns The zoom level to use for display.\n     */\n    getDisplayZoomLevel(zoomLevel) {\n        return THREE.Math.clamp(zoomLevel + this.m_storageLevelOffset, this.m_minZoomLevel, this.m_maxZoomLevel);\n    }\n    /**\n     * Returns `true` if [[MapView]] should render the tile with given [[TileKey]] and zoom level.\n     *\n     * @param zoomLevel The zoom level of the [[MapView]].\n     * @param tileKey The unique identifier for a map tile.\n     * @returns `true` if the geometries created for the given [[TileKey]] should be rendered.\n     */\n    shouldRender(zoomLevel, tileKey) {\n        return tileKey.level === zoomLevel;\n    }\n    /**\n     * Returns `true` if [[MapView]] should render the text elements with the given [[TileKey]] and\n     * zoom level.\n     *\n     * This is an additional check for the tiles that are already selected for rendering so the\n     * default implementation returns `true`.\n     *\n     * @param zoomLevel The zoom level.\n     * @param tileKey The unique identifier for a map tile.\n     * @returns `true` if the text elements created for the given [[TileKey]] should be rendered.\n     */\n    // tslint:disable-next-line:no-unused-variable\n    shouldRenderText(zoomLevel, tileKey) {\n        return true;\n    }\n    /**\n     * Sends a request to the [[MapView]] to redraw the scene.\n     */\n    requestUpdate() {\n        this.dispatchEvent(UPDATE_EVENT);\n    }\n}\n/**\n * A counter to generate unique names for each `DataSource`, if no name is provided in the\n * constructor.\n */\nDataSource.uniqueNameCounter = 0;\nexports.DataSource = DataSource;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ImageItem;\n(function (ImageItem) {\n    /**\n     * Missing Typedoc\n     */\n    function isLoading(imageItem) {\n        return imageItem.loadingPromise !== undefined;\n    }\n    ImageItem.isLoading = isLoading;\n})(ImageItem = exports.ImageItem || (exports.ImageItem = {}));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ConcurrentWorkerSet_1 = require(\"./ConcurrentWorkerSet\");\nconst WorkerBasedTiler_1 = require(\"./WorkerBasedTiler\");\n/**\n * Default concurrent tiler helper.\n *\n * A convenient singleton that maintains a separate [[ConcurrentWorkerSet]] for each bundle\n * requested. Provides easy access to [[WorkerBasedTiler]]s for data sources.\n */\nclass ConcurrentTilerFacade {\n    /**\n     * Returns a [[WorkerBasedTiler]] instance.\n     *\n     * @param tilerServiceType The name of the tiler service type.\n     * @param scriptUrl The optional URL with the workers' script.\n     */\n    static getTiler(tilerServiceType, scriptUrl) {\n        const workerSet = this.getWorkerSet(scriptUrl);\n        return new WorkerBasedTiler_1.WorkerBasedTiler(workerSet, tilerServiceType);\n    }\n    /**\n     * Returns a [[ConcurrentWorkerSet]] instance based on the script URL specified.\n     *\n     * @param scriptUrl The optional URL with the workers' script. If not specified,\n     * the function uses [[defaultScriptUrl]] instead.\n     */\n    static getWorkerSet(scriptUrl) {\n        if (scriptUrl === undefined) {\n            scriptUrl = this.defaultScriptUrl;\n        }\n        let workerSet = this.workerSets[scriptUrl];\n        if (workerSet === undefined) {\n            workerSet = new ConcurrentWorkerSet_1.ConcurrentWorkerSet({\n                scriptUrl,\n                workerCount: this.defaultWorkerCount\n            });\n            this.workerSets[scriptUrl] = workerSet;\n        }\n        return workerSet;\n    }\n    /**\n     * Destroys a [[ConcurrentWorkerSet]] instance.\n     *\n     * @param scriptUrl The worker script URL that was used to create the [[ConcurrentWorkerSet]].\n     */\n    static destroyWorkerSet(scriptUrl) {\n        const workerSet = this.workerSets[scriptUrl];\n        if (workerSet !== undefined) {\n            workerSet.destroy();\n            delete this.workerSets[scriptUrl];\n        }\n    }\n    /**\n     * Destroys all managed [[ConcurrentWorkerSet]]s.\n     */\n    static destroy() {\n        Object.keys(this.workerSets).forEach(name => {\n            this.workerSets[name].destroy();\n        });\n        this.workerSets = {};\n    }\n}\n/**\n * The URL containing a script to fall back (default) to when looking for worker sets\n * and tilers.\n */\nConcurrentTilerFacade.defaultScriptUrl = \"./decoder.bundle.js\";\n/**\n * The default number of workers.\n */\nConcurrentTilerFacade.defaultWorkerCount = 1;\n/**\n * The [[ConcurrentWorkerSet]] instances which are stored by the script URL.\n */\nConcurrentTilerFacade.workerSets = {};\nexports.ConcurrentTilerFacade = ConcurrentTilerFacade;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_datasource_protocol_1 = require(\"@here/harp-datasource-protocol\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst TileGeometry_1 = require(\"./TileGeometry\");\nconst logger = harp_utils_1.LoggerManager.instance.create(\"TileDataAccessor\");\n/**\n * An accessor for all geometries in a tile. This class uses a client-provided [[ITileDataVisitor]]\n * to visit all objects, based on filtering options specified by both, the `TileDataAccessor` and\n * the visitor itself.\n */\nclass TileDataAccessor {\n    /**\n     * Constructs a `TileDataAccessor` instance.\n     *\n     * @param tile The tile to access.\n     * @param visitor The visitor.\n     * @param options Options for the tile.\n     */\n    constructor(tile, visitor, options) {\n        this.tile = tile;\n        this.visitor = visitor;\n        this.m_wantsPoints = true;\n        this.m_wantsLines = true;\n        this.m_wantsAreas = true;\n        this.m_wantsObject3D = true;\n        const wantsAll = options.wantsAll === true;\n        this.m_wantsPoints = wantsAll || !(options.wantsPoints === false);\n        this.m_wantsLines = wantsAll || !(options.wantsLines === false);\n        this.m_wantsAreas = wantsAll || !(options.wantsAreas === false);\n        this.m_wantsObject3D = wantsAll || !(options.wantsObject3D === false);\n    }\n    /**\n     * Calls the visitor on all objects in the tile.\n     */\n    visitAll() {\n        const objects = this.tile.objects;\n        for (const object of objects) {\n            this.visitObject(object);\n        }\n    }\n    /**\n     * Visits a single object. This function should normally be called during visiting.\n     *\n     * @param object The object to visit.\n     */\n    visitObject(object) {\n        const featureData = object.userData !== undefined\n            ? object.userData.feature\n            : undefined;\n        // early opt out if there is no feature data, or if the feature data has only a single id\n        // and the visitor wants to ignore that featureId\n        if (featureData === undefined ||\n            (featureData.ids !== undefined &&\n                featureData.ids.length === 1 &&\n                !this.visitor.wantsFeature(featureData.ids[0]))) {\n            return;\n        }\n        const geometryType = featureData.geometryType;\n        if (geometryType === undefined) {\n            logger.warn(\"#visitObject: visiting object failed, no geometryType\", object);\n            return;\n        }\n        harp_utils_1.assert(featureData.ids !== undefined, \"featureData.ids missing\");\n        harp_utils_1.assert(Array.isArray(featureData.ids), \"featureData.ids is not an array\");\n        harp_utils_1.assert(featureData.starts !== undefined, \"featureData.starts missing\");\n        harp_utils_1.assert(Array.isArray(featureData.starts), \"featureData.starts is not an array\");\n        if (featureData.ids !== undefined && featureData.starts !== undefined) {\n            harp_utils_1.assert(featureData.ids.length === featureData.starts.length, \"featureData.ids and featureData.starts have unequal length\");\n        }\n        switch (geometryType) {\n            case harp_datasource_protocol_1.GeometryType.Point:\n            case harp_datasource_protocol_1.GeometryType.Text:\n                if (!this.m_wantsPoints) {\n                    return;\n                }\n                break;\n            case harp_datasource_protocol_1.GeometryType.SolidLine:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedLine:\n            case harp_datasource_protocol_1.GeometryType.TextPath:\n                if (!this.m_wantsLines) {\n                    return;\n                }\n                break;\n            case harp_datasource_protocol_1.GeometryType.Polygon:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedPolygon:\n                if (!this.m_wantsAreas) {\n                    return;\n                }\n                break;\n            case harp_datasource_protocol_1.GeometryType.Object3D:\n                if (!this.m_wantsObject3D) {\n                    return;\n                }\n                break;\n            default:\n                logger.warn(\"#visitObject: invalid geometryType\");\n        }\n        if (object.type !== \"Mesh\") {\n            logger.warn(\"#visitObject: visiting object failed, not of type 'Mesh'\", object);\n            return;\n        }\n        const mesh = object;\n        this.visitMesh(mesh, featureData);\n    }\n    /**\n     * Gets the `BufferGeometry` from the specified object. This function requires the\n     * attribute `position` in `BufferGeometry` to be set.\n     *\n     * @param object The object from which to get the geometry.\n     * @returns the geometry of the object, or `undefined`.\n     */\n    getBufferGeometry(object) {\n        const geometry = object.geometry;\n        if (geometry.type !== \"BufferGeometry\") {\n            logger.warn(\"#visitObject: object does not have BufferGeometry\");\n            return undefined;\n        }\n        const bufferGeometry = geometry;\n        // we know its a BufferAttribute because it is a BufferGeometry\n        const position = bufferGeometry.getAttribute(\"position\");\n        if (!position) {\n            logger.warn(\"#visitLines: BufferGeometry has no position attribute\");\n            return undefined;\n        }\n        return bufferGeometry;\n    }\n    /**\n     * Obtains an accessor for the nonindexed geometry. This function may return `undefined`\n     * if the accessor is not implemented.\n     *\n     * @param geometryType The type of geometry.\n     * @param object The object for which to access the attributes and geometry.\n     * @param bufferGeometry The object's `BufferGeometry`.\n     * @returns an accessor for a specified object, if available.\n     */\n    getGeometryAccessor(geometryType, object, bufferGeometry) {\n        switch (geometryType) {\n            case harp_datasource_protocol_1.GeometryType.Point:\n            case harp_datasource_protocol_1.GeometryType.Text:\n                // return new RoBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n                return undefined;\n            case harp_datasource_protocol_1.GeometryType.SolidLine:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedLine:\n            case harp_datasource_protocol_1.GeometryType.TextPath:\n                return new TileGeometry_1.BufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n            case harp_datasource_protocol_1.GeometryType.Polygon:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedPolygon:\n                // return new RoBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n                return undefined;\n            case harp_datasource_protocol_1.GeometryType.Object3D:\n                return new TileGeometry_1.BufferedGeometryObject3dAccessor(object, geometryType, bufferGeometry);\n            default:\n                logger.warn(\"#getGeometryAccessor: invalid geometryType\");\n        }\n        return undefined;\n    }\n    /**\n     * Obtains an accessor for the indexed geometry. This function may return `undefined`\n     * if the accessor is not implemented.\n     *\n     * @param geometryType The type of geometry.\n     * @param object The object for which to access the attributes and geometry.\n     * @param bufferGeometry The object's `BufferGeometry`.\n     * @returns an accessor for a specified object, if available.\n     */\n    getIndexedGeometryAccessor(geometryType, object, bufferGeometry) {\n        switch (geometryType) {\n            case harp_datasource_protocol_1.GeometryType.Point:\n            case harp_datasource_protocol_1.GeometryType.Text:\n                // return new RoBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n                return undefined;\n            case harp_datasource_protocol_1.GeometryType.SolidLine:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedLine:\n            case harp_datasource_protocol_1.GeometryType.TextPath:\n                return new TileGeometry_1.IndexedBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n            case harp_datasource_protocol_1.GeometryType.Polygon:\n            case harp_datasource_protocol_1.GeometryType.ExtrudedPolygon:\n                // return new RoBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n                return undefined;\n            case harp_datasource_protocol_1.GeometryType.Object3D:\n                // return new RoBufferedGeometryLineAccessor(object, geometryType, bufferGeometry);\n                return undefined;\n            default:\n                logger.warn(\"#getIndexedGeometryAccessor: invalid geometryType\");\n        }\n        return undefined;\n    }\n    /**\n     * Visit the object.\n     *\n     * @param meshObject Object of type `Mesh`.\n     * @param featureData Dataset stored along with the object.\n     */\n    visitMesh(meshObject, featureData) {\n        const { ids, starts } = featureData;\n        const geometryType = featureData.geometryType;\n        // make linter happy: we already know that these both are valid\n        if (ids === undefined || starts === undefined || geometryType === undefined) {\n            return;\n        }\n        let geometryAccessor;\n        for (let featureIndex = 0; featureIndex < ids.length; featureIndex++) {\n            const featureId = ids[featureIndex];\n            if (!this.visitor.wantsFeature(featureId)) {\n                continue;\n            }\n            const featureStart = starts[featureIndex];\n            let featureEnd = -1;\n            // lazy creation of accessor, in case featureId was not wanted...\n            if (geometryAccessor === undefined) {\n                const bufferGeometry = this.getBufferGeometry(meshObject);\n                if (bufferGeometry === undefined) {\n                    continue;\n                }\n                if (bufferGeometry.index !== null) {\n                    geometryAccessor = this.getIndexedGeometryAccessor(geometryType, meshObject, bufferGeometry);\n                }\n                else {\n                    geometryAccessor = this.getGeometryAccessor(geometryType, meshObject, bufferGeometry);\n                }\n                if (geometryAccessor === undefined) {\n                    logger.warn(\"#visitObject: no accessor geometryType\", geometryType);\n                    continue;\n                }\n            }\n            featureEnd =\n                featureIndex < starts.length - 1\n                    ? starts[featureIndex + 1]\n                    : geometryAccessor.getCount();\n            // setup/update the accessor for the new range of the object\n            geometryAccessor.setRange(featureStart, featureEnd);\n            switch (geometryType) {\n                case harp_datasource_protocol_1.GeometryType.Point:\n                case harp_datasource_protocol_1.GeometryType.Text:\n                    this.visitor.visitPoint(featureId);\n                    break;\n                case harp_datasource_protocol_1.GeometryType.SolidLine:\n                case harp_datasource_protocol_1.GeometryType.ExtrudedLine:\n                case harp_datasource_protocol_1.GeometryType.TextPath:\n                    harp_utils_1.assert(TileGeometry_1.isLineAccessor(geometryAccessor));\n                    this.visitor.visitLine(featureId, geometryAccessor);\n                    break;\n                case harp_datasource_protocol_1.GeometryType.Polygon:\n                case harp_datasource_protocol_1.GeometryType.ExtrudedPolygon:\n                    this.visitor.visitArea(featureId);\n                    break;\n                case harp_datasource_protocol_1.GeometryType.Object3D:\n                    harp_utils_1.assert(TileGeometry_1.isObject3dAccessor(geometryAccessor));\n                    this.visitor.visitObject3D(featureId, geometryAccessor);\n                    break;\n                default:\n                    logger.warn(\"#visitObject: invalid geometryType\");\n            }\n        }\n    }\n}\nexports.TileDataAccessor = TileDataAccessor;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/Lines\"));\n__export(require(\"./lib/TriangulateLines\"));\n__export(require(\"./lib/HighPrecisionLines\"));\n__export(require(\"./lib/HighPrecisionUtils\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\n// Preallocate temp variables used during line generation.\nconst tmpV = new THREE.Vector3();\nconst tmpNormal = new THREE.Vector3();\nconst tmpTangent0 = new THREE.Vector3();\nconst tmpTangent1 = new THREE.Vector3();\nconst tmpBitangent = new THREE.Vector3();\nconst SEGMENT_OFFSET = 0.1;\n/**\n * Declares all the vertex attributes used for rendering a line using the [[SolidLineMaterial]].\n */\nconst LINE_VERTEX_ATTRIBUTES = [\n    { name: \"texcoord\", itemSize: 2, offset: 0 },\n    { name: \"position\", itemSize: 3, offset: 2 },\n    { name: \"tangent\", itemSize: 3, offset: 5 },\n    { name: \"bitangent\", itemSize: 4, offset: 8 }\n];\n/** Stride size for line vertex data. */\nconst LINE_STRIDE = 12;\n/**\n * Declares all the vertex attributes used for rendering a line using the\n * [[HighPrecisionLineMaterial]].\n */\nconst HP_LINE_VERTEX_ATTRIBUTES = [\n    { name: \"texcoord\", itemSize: 2, offset: 0 },\n    { name: \"position\", itemSize: 3, offset: 2 },\n    { name: \"positionLow\", itemSize: 3, offset: 5 },\n    { name: \"tangent\", itemSize: 3, offset: 8 },\n    { name: \"bitangent\", itemSize: 4, offset: 11 }\n];\n/** Stride size for high precision line vertex data. */\nconst HP_LINE_STRIDE = 15;\n/**\n * Class that holds the vertex and index attributes for a [[Lines]] object.\n */\nclass LineGeometry {\n    constructor() {\n        this.vertices = [];\n        this.indices = [];\n    }\n}\nexports.LineGeometry = LineGeometry;\n/**\n * Creates a [[LineGeometry]] object out of a polyline.\n *\n * @param polyline Array of `numbers` describing a polyline.\n * @param center Center of the tile.\n * @param geometry [[LineGeometry]] object used to store the vertex and index attributes.\n * @param highPrecision If `true` will create high-precision vertex information.\n */\nfunction createLineGeometry(polyline, center, geometry = new LineGeometry(), highPrecision = false) {\n    if (polyline.length === 0) {\n        return geometry;\n    }\n    const stride = highPrecision ? HP_LINE_STRIDE : LINE_STRIDE;\n    const pointCount = polyline.length / 3;\n    const segments = new Array(pointCount);\n    const tangents = new Array(polyline.length - 3);\n    const baseVertex = geometry.vertices.length / stride;\n    // Compute segments and tangents.\n    let sum = SEGMENT_OFFSET;\n    segments[0] = sum;\n    let isFlat = true;\n    for (let i = 0; i < pointCount - 1; ++i) {\n        let sqrLength = 0;\n        for (let j = 0; j < 3; ++j) {\n            const d = polyline[(i + 1) * 3 + j] - polyline[i * 3 + j];\n            tangents[i * 3 + j] = d;\n            sqrLength += d * d;\n            isFlat = j === 2 ? isFlat && polyline[(i + 1) * 3 + j] === 0.0 : isFlat;\n        }\n        const len = Math.sqrt(sqrLength);\n        sum = sum + len;\n        segments[i + 1] = sum;\n    }\n    // Check if we're working with a closed line.\n    let isClosed = true;\n    for (let j = 0; j < 3; ++j) {\n        isClosed = isClosed && polyline[j] === polyline[polyline.length - 3 + j];\n    }\n    for (let i = 0; i < pointCount; ++i) {\n        // Retrieve the per-point tangents.\n        const T1 = isClosed && i === 0 ? tangents.length - 3 : Math.max(0, i - 1) * 3;\n        const T2 = isClosed && i === pointCount - 1 ? 0 : Math.min(i * 3, tangents.length - 3);\n        // Process v0 and v1.\n        if (i > 0) {\n            for (let v = -1; v <= 1; v += 2) {\n                // Store the segment and texcoord attributes.\n                geometry.vertices.push(segments[i - 1], segments[i] * v);\n                // Store the position attribute (component-dependant).\n                for (let j = 0; j < 3; ++j) {\n                    if (!highPrecision) {\n                        geometry.vertices.push(polyline[i * 3 + j]);\n                    }\n                    else {\n                        const highComp = Math.fround(polyline[i * 3 + j]);\n                        const lowComp = polyline[i * 3 + j] - highComp;\n                        geometry.vertices.push(highComp, lowComp);\n                    }\n                    tmpNormal.setComponent(j, polyline[i * 3 + j]);\n                }\n                // Store the bitangent attribute (component-dependant).\n                for (let j = 0; j < 3; ++j) {\n                    tmpTangent0.setComponent(j, tangents[T1 + j]);\n                    tmpTangent1.setComponent(j, tangents[T2 + j]);\n                }\n                geometry.vertices.push(...tmpTangent0.normalize().toArray());\n                const angle = computeBitangent(isFlat ? tmpNormal.set(0, 0, 1) : tmpNormal.add(center).normalize(), tmpTangent0.normalize(), tmpTangent1.normalize(), tmpBitangent);\n                geometry.vertices.push(...tmpBitangent.toArray(), angle);\n            }\n        }\n        // Process v2 and v3.\n        if (i + 1 < pointCount) {\n            for (let v = -1; v <= 1; v += 2) {\n                // Store the segment and texcoord attributes.\n                geometry.vertices.push(segments[Math.min(i, segments.length - 1)] * -1, segments[Math.min(i + 1, segments.length - 1)] * v);\n                // Store the position attribute (component-dependant).\n                for (let j = 0; j < 3; ++j) {\n                    if (!highPrecision) {\n                        geometry.vertices.push(polyline[i * 3 + j]);\n                    }\n                    else {\n                        const highComp = Math.fround(polyline[i * 3 + j]);\n                        const lowComp = polyline[i * 3 + j] - highComp;\n                        geometry.vertices.push(highComp, lowComp);\n                    }\n                    tmpNormal.setComponent(j, polyline[i * 3 + j]);\n                }\n                // Store the bitangent attribute (component-dependant).\n                for (let j = 0; j < 3; ++j) {\n                    tmpTangent0.setComponent(j, tangents[T1 + j]);\n                    tmpTangent1.setComponent(j, tangents[T2 + j]);\n                }\n                geometry.vertices.push(...tmpTangent0.normalize().toArray());\n                const angle = computeBitangent(isFlat ? tmpNormal.set(0, 0, 1) : tmpNormal.add(center).normalize(), tmpTangent0.normalize(), tmpTangent1.normalize(), tmpBitangent);\n                geometry.vertices.push(...tmpBitangent.toArray(), angle);\n            }\n        }\n    }\n    // Store the triangle indices in the final index buffer.\n    for (let i = 0; i < pointCount - 1; ++i) {\n        const base = baseVertex + i * 4;\n        geometry.indices.push(base, base + 1, base + 2, base + 2, base + 1, base + 3);\n    }\n    return geometry;\n}\nexports.createLineGeometry = createLineGeometry;\n/**\n * Creates a [[LineGeometry]] object out of a polyline.\n *\n * @param polyline Array of `numbers` describing a polyline.\n * @param geometry [[LineGeometry]] object used to store the vertex and index attributes.\n */\nfunction createSimpleLineGeometry(polyline, geometry = new LineGeometry()) {\n    if (polyline.length === 0) {\n        return geometry;\n    }\n    const pointCount = polyline.length / 3;\n    let index = geometry.vertices.length / 3;\n    for (let i = 0; i < pointCount; ++i, index++) {\n        if (i > 0) {\n            geometry.indices.push(index);\n        }\n        if (i < pointCount - 1) {\n            geometry.indices.push(index);\n        }\n        for (let j = 0; j < 3; ++j) {\n            geometry.vertices.push(polyline[i * 3 + j]);\n        }\n    }\n    return geometry;\n}\nexports.createSimpleLineGeometry = createSimpleLineGeometry;\n/**\n * Class used to render groups (or batches) of width-variable lines (in the same tile).\n */\nclass LineGroup {\n    constructor(highPrecision = false, isSimple = false) {\n        this.highPrecision = highPrecision;\n        this.isSimple = isSimple;\n        this.m_origin = new THREE.Vector3();\n        this.m_geometry = new LineGeometry();\n    }\n    /**\n     * Adds all the attribute data needed to a [[BufferGeometry]] object for rendering `Lines`.\n     *\n     * @param vertices Array of vertex positions.\n     * @param indices Array of vertex indices.\n     * @param geometry [[BufferGeometry]] object which will store all the `Lines` attribute data.\n     * @param highPrecision If `true` will create high-precision vertex information.\n     * @param isSimple `true` to create simple (nonsolid, nonextruded) lines. Defaults to `false`.\n     */\n    static createGeometry(vertices, indices, geometry, highPrecision = false, isSimple = false) {\n        if (isSimple) {\n            geometry.addAttribute(\"position\", new THREE.BufferAttribute(new Float32Array(vertices), 3));\n            geometry.setIndex(new THREE.BufferAttribute(new Uint32Array(indices), 1));\n            return geometry;\n        }\n        else {\n            const stride = highPrecision ? HP_LINE_STRIDE : LINE_STRIDE;\n            const descriptors = highPrecision ? HP_LINE_VERTEX_ATTRIBUTES : LINE_VERTEX_ATTRIBUTES;\n            const buffer = new THREE.InterleavedBuffer(new Float32Array(vertices), stride);\n            descriptors.forEach(descr => {\n                const attribute = new THREE.InterleavedBufferAttribute(buffer, descr.itemSize, descr.offset, false);\n                geometry.addAttribute(descr.name, attribute);\n            });\n            geometry.setIndex(new THREE.BufferAttribute(new Uint32Array(indices), 1));\n            return geometry;\n        }\n    }\n    /**\n     * Clears the list of line strips.\n     */\n    clear() {\n        this.m_geometry.vertices = [];\n        this.m_geometry.indices = [];\n    }\n    /**\n     * Add the given points to this line group.\n     *\n     * @param points Sequence of (x,y,z) coordinates.\n     * @param center World center of the provided points.\n     */\n    add(points, center = this.m_origin) {\n        if (!this.isSimple) {\n            createLineGeometry(points, center, this.m_geometry, this.highPrecision);\n        }\n        else {\n            createSimpleLineGeometry(points, this.m_geometry);\n        }\n        return this;\n    }\n    /**\n     * Returns the list of vertices.\n     */\n    get vertices() {\n        return this.m_geometry.vertices;\n    }\n    /**\n     * Returns the list of indices.\n     */\n    get indices() {\n        return this.m_geometry.indices;\n    }\n    /**\n     * Returns the list of [[VertexAttributeDescriptor]]s.\n     */\n    get vertexAttributes() {\n        return this.highPrecision ? HP_LINE_VERTEX_ATTRIBUTES : LINE_VERTEX_ATTRIBUTES;\n    }\n    /**\n     * Returns the vertex attribute stride.\n     */\n    get stride() {\n        return this.highPrecision ? HP_LINE_STRIDE : LINE_STRIDE;\n    }\n    /**\n     * Creates a three.js geometry.\n     */\n    createGeometry(geometry) {\n        if (geometry === undefined) {\n            geometry = new THREE.BufferGeometry();\n        }\n        return LineGroup.createGeometry(this.m_geometry.vertices, this.m_geometry.indices, geometry, this.highPrecision);\n    }\n}\nexports.LineGroup = LineGroup;\nfunction computeBitangent(n, t0, t1, bt) {\n    let angle = 0;\n    if (!t0.equals(t1)) {\n        angle = Math.acos(t0.dot(t1)) * Math.sign(n.dot(tmpV.copy(t0).cross(t1)));\n        if (Number.isNaN(angle)) {\n            angle = 0;\n        }\n    }\n    bt.copy(t0)\n        .add(t1)\n        .normalize()\n        .cross(n)\n        .normalize();\n    return angle;\n}\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst harp_materials_1 = require(\"@here/harp-materials\");\nconst HighPrecisionUtils_1 = require(\"./HighPrecisionUtils\");\n/**\n * Class used to render high-precision points.\n */\nclass HighPrecisionPoints extends THREE.Points {\n    /**\n     * Creates a `HighPrecisionPoints` object.\n     *\n     * @param geometry [[BufferGeometry]] used to render this object.\n     * @param material [[HighPrecisionLineMaterial]] used to render this object.\n     *     instances.\n     * @param positions Array of 2D/3D positions.\n     * @param color Color of the rendered point.\n     * @param opacity Opacity of the rendered point.\n     */\n    constructor(geometry, material, positions, color, opacity) {\n        if (material === undefined) {\n            material = new harp_materials_1.HighPrecisionPointMaterial({\n                color: color ? color : harp_materials_1.HighPrecisionPointMaterial.DEFAULT_COLOR,\n                opacity: opacity !== undefined ? opacity : 1\n            });\n        }\n        super(geometry === undefined ? new THREE.BufferGeometry() : geometry, material);\n        this.matrixWorldInverse = new THREE.Matrix4();\n        if (positions) {\n            this.setPositions(positions);\n        }\n    }\n    get bufferGeometry() {\n        return this.geometry;\n    }\n    /**\n     * Clears the [[BufferGeometry]] used to render this point.\n     */\n    clearGeometry() {\n        return (this.geometry = new THREE.BufferGeometry());\n    }\n    get shaderMaterial() {\n        return this.material;\n    }\n    setPositions(positions) {\n        HighPrecisionUtils_1.HighPrecisionUtils.setPositions(this, positions);\n    }\n    setupForRendering() {\n        if (this.material.isHighPrecisionPointsMaterial &&\n            this.dimensionality !== undefined) {\n            this.material.setDimensionality(this.dimensionality);\n        }\n        this.onBeforeRender = (_renderer, _scene, camera, _geometry, _material, _group) => {\n            HighPrecisionUtils_1.HighPrecisionUtils.updateHpUniforms(this, camera, this.shaderMaterial);\n        };\n    }\n    updateMatrixWorld(force) {\n        const doUpdateMatrixWorldInverse = this.matrixWorldNeedsUpdate || force;\n        super.updateMatrixWorld(force);\n        if (doUpdateMatrixWorldInverse) {\n            this.matrixWorldInverse.getInverse(this.matrixWorld);\n        }\n    }\n}\nexports.HighPrecisionPoints = HighPrecisionPoints;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst CopyrightInfo_1 = require(\"./CopyrightInfo\");\nconst MapView_1 = require(\"./MapView\");\n/**\n * Helper class that maintains up-to-date [[MapView]] copyright information in DOM element.\n *\n * @example\n *\n *     // HTML snippet\n *     <div id=\"copyrightNotice\" style=\"position:absolute; right:0; bottom:0; z-index:100\"></div>\n *\n *     // Javascript\n *     const mapView = new MapView({ ... });\n *     CopyrightElementHandler.attach(\"copyrightNotice\", mapView);\n */\nclass CopyrightElementHandler {\n    /**\n     * Creates a new `CopyrightElementHandler` that updates the DOM element with the copyright info\n     * of the given `mapView`.\n     *\n     * Note: Generally, the static [[install]] method can be used to create and attach a new\n     * `CopyrightElementHandler` to a [[MapView]]\n     *\n     * @param elementId HTML DOM element or a HTML DOM element id\n     * @param mapView optional, [[attach]] to this [[MapView]] instance\n     */\n    constructor(element, mapView) {\n        this.m_defaults = new Map();\n        this.m_mapViews = [];\n        /**\n         * Update copyright info text in controlled HTML element.\n         */\n        this.update = () => {\n            const mergedCopyrightInfo = this.m_mapViews\n                .map(mapView => mapView.copyrightInfo)\n                .reduce(CopyrightInfo_1.CopyrightInfo.mergeArrays, this.staticInfo || []);\n            // Conditionally hiding of element with copyright information.\n            // If nothing to show we schould to avoid empty white rectangle in right bottom corner.\n            if (mergedCopyrightInfo.length === 0) {\n                this.m_element.style.display = \"none\";\n                return;\n            }\n            else {\n                this.m_element.style.display = \"block\";\n            }\n            if (this.m_defaults.size !== 0) {\n                for (const sourceInfo of mergedCopyrightInfo) {\n                    const defaults = this.m_defaults.get(sourceInfo.id);\n                    if (defaults !== undefined) {\n                        sourceInfo.year = harp_utils_1.getOptionValue(sourceInfo.year, defaults.year);\n                        sourceInfo.label = harp_utils_1.getOptionValue(sourceInfo.label, defaults.label);\n                        sourceInfo.link = harp_utils_1.getOptionValue(sourceInfo.link, defaults.link);\n                    }\n                }\n            }\n            const deduped = CopyrightInfo_1.CopyrightInfo.mergeArrays(mergedCopyrightInfo);\n            this.m_element.innerHTML = CopyrightInfo_1.CopyrightInfo.formatAsHtml(deduped);\n        };\n        if (typeof element === \"string\") {\n            this.m_element = document.getElementById(element);\n            if (!this.m_element) {\n                throw new Error(`CopyrightElementHandler: unable to find DOM element ${element}`);\n            }\n        }\n        else {\n            this.m_element = element;\n        }\n        if (mapView !== undefined) {\n            this.attach(mapView);\n        }\n    }\n    /**\n     * Install [[CopyrightElementHandler]] on DOM element and - optionally - attach to a [[MapView]]\n     * instance.\n     *\n     * @param element HTML DOM element or a HTML DOM element id\n     * @param mapView, optional, [[attach]] to this [[MapView]]\n     */\n    static install(element, mapView) {\n        return new CopyrightElementHandler(element, mapView);\n    }\n    /**\n     * Destroys this object by removing all event listeners from the attached [[MapView]]s.\n     */\n    destroy() {\n        for (const mapView of this.m_mapViews) {\n            mapView.removeEventListener(MapView_1.MapViewEventNames.CopyrightChanged, this.update);\n        }\n    }\n    /**\n     * Attaches this [[CopyrightInfo]] updates from [[MapView]] instance.\n     */\n    attach(mapView) {\n        this.m_mapViews.push(mapView);\n        mapView.addEventListener(MapView_1.MapViewEventNames.CopyrightChanged, this.update);\n        this.update();\n        return this;\n    }\n    /**\n     * Stop following [[CopyrightInfo]] updates from [[MapView]] instance.\n     */\n    detach(mapView) {\n        mapView.removeEventListener(MapView_1.MapViewEventNames.CopyrightChanged, this.update);\n        this.m_mapViews = this.m_mapViews.filter(item => item !== mapView);\n        this.update();\n        return this;\n    }\n    /**\n     * Set [[CopyrightInfo]] defaults to be used in case [[DataSource]] does not provide deatailed\n     * copyright information.\n     *\n     * The defaults will applied to all undefined `year`, `label` and `link` values in the copyright\n     * information retrieved from [[MapView]].\n     */\n    setDefaults(defaults) {\n        this.m_defaults.clear();\n        if (defaults !== undefined) {\n            for (const item of defaults) {\n                this.m_defaults.set(item.id, item);\n            }\n        }\n        return this;\n    }\n    /**\n     * Sets the [[staticInfo]] property.\n     *\n     * A `CopyrightElementHandler` always displays a deduplicated sum of static copyright info and\n     * copyright information obtained from attached [[MapView]]s.\n     *\n     * This information is used when [[DataSource]] instances of given [[MapView]] do not provide\n     * copyright information.\n     */\n    setStaticCopyightInfo(staticInfo) {\n        this.staticInfo = staticInfo;\n        return this;\n    }\n}\nexports.CopyrightElementHandler = CopyrightElementHandler;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_mapview_1 = require(\"@here/harp-mapview\");\n/**\n * Base class to handle UI overlay elements.\n */\nclass MapControlsUI {\n    /**\n     * Constructor of the UI.\n     *\n     * @param controls Controls referencing a [[MapView]].\n     */\n    constructor(controls, options = {}) {\n        this.controls = controls;\n        this.domElement = document.createElement(\"div\");\n        const zoomInButton = document.createElement(\"button\");\n        zoomInButton.innerText = \"+\";\n        const zoomOutButton = document.createElement(\"button\");\n        zoomOutButton.innerText = \"-\";\n        const tiltButton = document.createElement(\"button\");\n        tiltButton.innerText = \"3D\";\n        // Optional zoom level displaying\n        let zoomLevelElement = null;\n        if (options.zoomLevel === \"show\") {\n            const div = document.createElement(\"div\");\n            controls.mapView.addEventListener(harp_mapview_1.MapViewEventNames.Render, () => {\n                div.innerText = controls.zoomLevelTargetted.toLocaleString(undefined, {\n                    minimumFractionDigits: 2,\n                    maximumFractionDigits: 2\n                });\n            });\n            zoomLevelElement = div;\n        }\n        else if (options.zoomLevel === \"input\") {\n            const input = document.createElement(\"input\");\n            input.type = \"number\";\n            controls.mapView.addEventListener(harp_mapview_1.MapViewEventNames.Render, () => {\n                input.value = controls.zoomLevelTargetted.toLocaleString(undefined, {\n                    minimumFractionDigits: 2,\n                    maximumFractionDigits: 2\n                });\n            });\n            const updateZoom = (event) => {\n                controls.setZoomLevel(parseFloat(input.value));\n                event.preventDefault();\n            };\n            input.addEventListener(\"blur\", updateZoom);\n            input.addEventListener(\"keypress\", event => {\n                if (event.key === \"Enter\") {\n                    updateZoom(event);\n                }\n            });\n            // Removes focus from input element.\n            window.addEventListener(\"click\", event => {\n                if (!event ||\n                    !event.target ||\n                    !event.target.contains ||\n                    (event.target === input || event.target.contains(input))) {\n                    return;\n                }\n                input.blur();\n            });\n            zoomLevelElement = input;\n        }\n        this.domElement.appendChild(zoomInButton);\n        this.domElement.appendChild(tiltButton);\n        if (zoomLevelElement !== null) {\n            this.domElement.appendChild(zoomLevelElement);\n        }\n        this.domElement.appendChild(zoomOutButton);\n        zoomInButton.addEventListener(\"click\", event => {\n            const zoomLevel = controls.zoomLevelTargetted + controls.zoomLevelDeltaOnControl;\n            controls.setZoomLevel(zoomLevel);\n        });\n        zoomOutButton.addEventListener(\"click\", event => {\n            const zoomLevel = controls.zoomLevelTargetted - controls.zoomLevelDeltaOnControl;\n            controls.setZoomLevel(zoomLevel);\n        });\n        tiltButton.addEventListener(\"click\", event => {\n            controls.toggleTilt();\n        });\n        this.domElement.className = \"harp-gl_controls\";\n        zoomInButton.className = zoomOutButton.className = tiltButton.className =\n            \"harp-gl_controls-button\";\n        if (zoomLevelElement !== null) {\n            zoomLevelElement.className = \"harp-gl_controls-zoom\";\n        }\n        if (options.disableDefaultStyle !== true) {\n            this.initStyle();\n            this.domElement.style.cssText =\n                \"position: absolute; right: 10px; top: 50%; margin-top: -70px;\";\n        }\n        return this;\n    }\n    initStyle() {\n        if (document.getElementById(\"here-harp-controls.map-controls-ui-styles\") !== null) {\n            return;\n        }\n        const style = document.createElement(\"style\");\n        style.id = \"here-harp-controls.map-controls-ui-styles\";\n        style.appendChild(document.createTextNode(`\n            .harp-gl_controls-button {\n                display: block;\n                background-color: #fff;\n                width: 40px;\n                height: 40px;\n                font-size: 22px;\n                font-weight: bold;\n                outline: none;\n                margin: 5px;\n                border: none;\n                color: #555;\n                opacity: 0.87;\n                cursor: pointer;\n                border-radius: 4px;\n                box-shadow: 0px 0px 4px #aaa;\n                transition: all 0.1s;\n                padding: 0 0 1px 1px;\n                user-select: none;\n            }\n            .harp-gl_controls-button:active {\n                background-color: #37afaa;\n                color: #eee;\n            }\n            .harp-gl_controls-zoom {\n                display: block;\n                background-color: #fff;\n                width: 40px;\n                height: 20px;\n                font-size: 12px;\n                font-weight: bold;\n                outline: none;\n                margin: 5px;\n                border: none;\n                color: #555;\n                opacity: 0.87;\n                border-radius: 4px;\n                box-shadow: 0px 0px 4px #aaa;\n                padding: 2px 0 0;\n                text-align: center;\n                user-select: text;\n            }\n            input.harp-gl_controls-zoom::-webkit-outer-spin-button,\n            input.harp-gl_controls-zoom::-webkit-inner-spin-button {\n                /* display: none; <- Crashes Chrome on hover */\n                -webkit-appearance: none;\n                margin: 0; /* <-- Apparently some margin are still there even though it's hidden */\n            }\n            input.harp-gl_controls-zoom[type=number] {\n                -moz-appearance:textfield; /* Firefox */\n            }`));\n        document.head.appendChild(style);\n    }\n}\nexports.MapControlsUI = MapControlsUI;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Class that can be used to track long presses on an HTML Element. A long press is a press that\n * lasts a minimum duration (see the [[timeout]] member) while the mouse is not moved more than a\n * certain threshold (see the [[moveThreshold]] member).\n */\nclass LongPressHandler {\n    /**\n     * Default constructor.\n     *\n     * @param element The HTML element to track.\n     * @param onLongPress The callback to call when a long press occurred.\n     */\n    constructor(element, onLongPress) {\n        this.element = element;\n        this.onLongPress = onLongPress;\n        /**\n         * How long to wait (in ms) until a press is considered a long press.\n         */\n        this.timeout = 500;\n        /**\n         * If the cursor moves more than the given number of pixels, it is not a long-press, but a pan.\n         */\n        this.moveThreshold = 5;\n        /**\n         * Button id that should be handled by this event.\n         */\n        this.buttonId = 0;\n        this.m_mouseDownEvent = undefined;\n        this.m_timerId = undefined;\n        this.m_moveHandlerRegistered = false;\n        // workaround - need to bind 'this' for our dynamic mouse move handler\n        this.m_boundMouseMoveHandler = this.onMouseMove.bind(this);\n        this.m_boundMouseDownHandler = this.onMousedown.bind(this);\n        this.m_boundMouseUpHandler = this.onMouseup.bind(this);\n        this.element.addEventListener(\"mousedown\", this.m_boundMouseDownHandler);\n        this.element.addEventListener(\"mouseup\", this.m_boundMouseUpHandler);\n    }\n    /**\n     * Removes all events listeners. No more events will be sent.\n     */\n    dispose() {\n        this.cancel();\n        this.element.removeEventListener(\"mousedown\", this.m_boundMouseDownHandler);\n        this.element.removeEventListener(\"mouseup\", this.m_boundMouseUpHandler);\n    }\n    onMousedown(event) {\n        if (event.button !== this.buttonId) {\n            return;\n        }\n        this.cancelTimer();\n        this.m_mouseDownEvent = event;\n        this.m_timerId = setTimeout(() => this.onTimeout(), this.timeout);\n        this.addMouseMoveHandler();\n    }\n    onMouseup(event) {\n        if (event.button !== this.buttonId) {\n            return;\n        }\n        this.cancel();\n    }\n    onMouseMove(event) {\n        if (this.m_mouseDownEvent === undefined) {\n            return; // Must not happen\n        }\n        const manhattanLength = Math.abs(event.clientX - this.m_mouseDownEvent.clientX) +\n            Math.abs(event.clientY - this.m_mouseDownEvent.clientY);\n        if (manhattanLength >= this.moveThreshold) {\n            this.cancel();\n        }\n    }\n    cancel() {\n        this.m_mouseDownEvent = undefined;\n        this.cancelTimer();\n        this.removeMouseMoveHandler();\n    }\n    cancelTimer() {\n        if (this.m_timerId === undefined) {\n            return;\n        }\n        clearTimeout(this.m_timerId);\n        this.m_timerId = undefined;\n    }\n    addMouseMoveHandler() {\n        if (this.m_moveHandlerRegistered) {\n            return;\n        }\n        this.element.addEventListener(\"mousemove\", this.m_boundMouseMoveHandler);\n        this.m_moveHandlerRegistered = true;\n    }\n    removeMouseMoveHandler() {\n        if (!this.m_moveHandlerRegistered) {\n            return;\n        }\n        this.element.removeEventListener(\"mousemove\", this.m_boundMouseMoveHandler);\n        this.m_moveHandlerRegistered = false;\n    }\n    onTimeout() {\n        const event = this.m_mouseDownEvent;\n        this.m_timerId = undefined;\n        this.cancel();\n        if (event !== undefined) {\n            this.onLongPress(event);\n        }\n    }\n}\nexports.LongPressHandler = LongPressHandler;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_geoutils_1 = require(\"@here/harp-geoutils\");\nconst MapControls_1 = require(\"./MapControls\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst TWEEN = require(\"@tweenjs/tween.js\");\nconst THREE = require(\"three\");\n/**\n * Functions used for specifying animations' speed.\n */\nvar EasingFunction;\n(function (EasingFunction) {\n    EasingFunction[EasingFunction[\"Linear\"] = 0] = \"Linear\";\n    EasingFunction[EasingFunction[\"QuadraticIn\"] = 1] = \"QuadraticIn\";\n    EasingFunction[EasingFunction[\"QuadraticOut\"] = 2] = \"QuadraticOut\";\n    EasingFunction[EasingFunction[\"QuadraticInOut\"] = 3] = \"QuadraticInOut\";\n    EasingFunction[EasingFunction[\"CubicIn\"] = 4] = \"CubicIn\";\n    EasingFunction[EasingFunction[\"CubicOut\"] = 5] = \"CubicOut\";\n    EasingFunction[EasingFunction[\"CubicInOut\"] = 6] = \"CubicInOut\";\n    EasingFunction[EasingFunction[\"QuarticIn\"] = 7] = \"QuarticIn\";\n    EasingFunction[EasingFunction[\"QuarticOut\"] = 8] = \"QuarticOut\";\n    EasingFunction[EasingFunction[\"QuarticInOut\"] = 9] = \"QuarticInOut\";\n    EasingFunction[EasingFunction[\"QuinticIn\"] = 10] = \"QuinticIn\";\n    EasingFunction[EasingFunction[\"QuinticOut\"] = 11] = \"QuinticOut\";\n    EasingFunction[EasingFunction[\"QuinticInOut\"] = 12] = \"QuinticInOut\";\n    EasingFunction[EasingFunction[\"SinusoidalIn\"] = 13] = \"SinusoidalIn\";\n    EasingFunction[EasingFunction[\"SinusoidalOut\"] = 14] = \"SinusoidalOut\";\n    EasingFunction[EasingFunction[\"SinusoidalInOut\"] = 15] = \"SinusoidalInOut\";\n    EasingFunction[EasingFunction[\"ExponentialIn\"] = 16] = \"ExponentialIn\";\n    EasingFunction[EasingFunction[\"ExponentialOut\"] = 17] = \"ExponentialOut\";\n    EasingFunction[EasingFunction[\"ExponentialInOut\"] = 18] = \"ExponentialInOut\";\n    EasingFunction[EasingFunction[\"CircularIn\"] = 19] = \"CircularIn\";\n    EasingFunction[EasingFunction[\"CircularOut\"] = 20] = \"CircularOut\";\n    EasingFunction[EasingFunction[\"CircularInOut\"] = 21] = \"CircularInOut\";\n    EasingFunction[EasingFunction[\"ElasticIn\"] = 22] = \"ElasticIn\";\n    EasingFunction[EasingFunction[\"ElasticOut\"] = 23] = \"ElasticOut\";\n    EasingFunction[EasingFunction[\"ElasticInOut\"] = 24] = \"ElasticInOut\";\n    EasingFunction[EasingFunction[\"BackIn\"] = 25] = \"BackIn\";\n    EasingFunction[EasingFunction[\"BackOut\"] = 26] = \"BackOut\";\n    EasingFunction[EasingFunction[\"BackInOut\"] = 27] = \"BackInOut\";\n    EasingFunction[EasingFunction[\"BounceIn\"] = 28] = \"BounceIn\";\n    EasingFunction[EasingFunction[\"BounceOut\"] = 29] = \"BounceOut\";\n    EasingFunction[EasingFunction[\"BounceInOut\"] = 30] = \"BounceInOut\";\n})(EasingFunction = exports.EasingFunction || (exports.EasingFunction = {}));\n/**\n * Functions used to generate intermediate animation values.\n */\nvar InterpolationFunction;\n(function (InterpolationFunction) {\n    InterpolationFunction[InterpolationFunction[\"Linear\"] = 0] = \"Linear\";\n    InterpolationFunction[InterpolationFunction[\"Bezier\"] = 1] = \"Bezier\";\n    InterpolationFunction[InterpolationFunction[\"CatmullRom\"] = 2] = \"CatmullRom\";\n})(InterpolationFunction = exports.InterpolationFunction || (exports.InterpolationFunction = {}));\n/**\n * Abstract class used as base to define camera animations.\n */\nclass CameraAnimation {\n    /**\n     * Creates a new `CameraAnimation` object.\n     *\n     * @param mapView [[MapView]] which will be affected by the animation.\n     * @param name Animation's name.\n     */\n    constructor(mapView, name) {\n        this.mapView = mapView;\n        this.name = name;\n        /**\n         * `True` if animation is being played.\n         */\n        this.running = false;\n        /**\n         * `True` if the animation has been interrupted.\n         */\n        this.stopped = false;\n        /**\n         * Duration of a whole animation in milliseconds. Defaults to `10` seconds.\n         */\n        this.duration = 10000;\n        /**\n         * Number of times the animation should be repeated. Defaults to `0`.\n         */\n        this.repeat = 0;\n        /**\n         * Easing function that control acceleration. Defaults to [[EasingFunction.Linear]].\n         */\n        this.easing = TWEEN.Easing.Linear.None;\n        checkSetupTween();\n    }\n    /**\n     * Update function is to be called before the next frame is rendered.\n     */\n    update(time) {\n        if (this.tween) {\n            return this.tween.update(time || harp_utils_1.PerformanceTimer.now());\n        }\n        return false;\n    }\n    /**\n     * Returns `true` if the animation is being played.\n     */\n    get isRunning() {\n        return this.running;\n    }\n}\nexports.CameraAnimation = CameraAnimation;\n/**\n * Create an animation around the Z-axis of the camera.\n */\nclass CameraRotationAnimation extends CameraAnimation {\n    /**\n     * Creates a new `CameraRotationAnimation` object.\n     *\n     * @param mapView [[MapView]] which will be affected by the animation.\n     * @param m_mapControls [[MapControls]] this animation will be taking control of.\n     * @param options Animation's options.\n     * @param name Animation's name.\n     */\n    constructor(mapView, m_mapControls, options, name) {\n        super(mapView, name);\n        this.m_mapControls = m_mapControls;\n        /**\n         * Initial camera rotation (in the Z-axis).\n         */\n        this.startAngle = 0;\n        /**\n         * Final camera rotation (in the Z-axis).\n         */\n        this.endAngle = 360;\n        // tslint:disable-next-line:no-unused-variable\n        this.m_axis = new THREE.Vector3(0, 0, 1);\n        this.beginInteractionListener = () => {\n            if (!this.stopped) {\n                this.stopTween();\n            }\n        };\n        this.endInteractionListener = () => {\n            if (!this.stopped) {\n                this.startTween();\n            }\n        };\n        if (options.axis !== undefined) {\n            this.m_axis = options.axis;\n        }\n        if (options.startAngle !== undefined) {\n            this.startAngle = options.startAngle;\n        }\n        if (options.endAngle !== undefined) {\n            this.endAngle = options.endAngle;\n        }\n        if (options.duration !== undefined) {\n            this.duration = options.duration;\n        }\n        if (options.repeat !== undefined) {\n            this.repeat = options.repeat;\n        }\n        if (options.easing !== undefined) {\n            this.easing =\n                typeof options.easing === \"function\"\n                    ? options.easing\n                    : easingMap.get(options.easing) || TWEEN.Easing.Linear.None;\n        }\n        this.m_lastRotationValue = this.startAngle;\n    }\n    /**\n     * Start the animation.\n     *\n     * @param time Duration of the animation in milliseconds.\n     * @param onFinished Callback that gets triggered once the animation ends.\n     */\n    start(time, onFinished) {\n        if (this.running) {\n            throw new Error(\"Animation already running\" + this.name !== undefined ? this.name : \"\");\n        }\n        this.running = true;\n        this.onFinished = onFinished;\n        this.stopped = false;\n        if (this.m_mapControls) {\n            this.m_mapControls.addEventListener(MapControls_1.EventNames.BeginInteraction, this.beginInteractionListener);\n            this.m_mapControls.addEventListener(MapControls_1.EventNames.EndInteraction, this.endInteractionListener);\n        }\n        this.startTween(time);\n        this.mapView.beginAnimation();\n    }\n    /**\n     * Stop the animation. Can be started again (with original values only, though).\n     */\n    stop() {\n        if (!this.running) {\n            throw new Error(\"Animation not running\" + this.name !== undefined ? this.name : \"\");\n        }\n        this.running = false;\n        this.stopped = true;\n        this.mapView.endAnimation();\n        if (this.tween) {\n            this.tween.stop();\n        }\n        if (this.m_mapControls) {\n            this.m_mapControls.removeEventListener(MapControls_1.EventNames.BeginInteraction, this.beginInteractionListener);\n            this.m_mapControls.removeEventListener(MapControls_1.EventNames.EndInteraction, this.endInteractionListener);\n        }\n    }\n    /**\n     * Internal start of tween. Required because the tween may be interrupted by the\n     * [[MapControls]].\n     */\n    startTween(time) {\n        const rotZ = new THREE.Quaternion();\n        this.m_userCamerRotation = new THREE.Quaternion();\n        this.mapView.camera.getWorldQuaternion(this.m_userCamerRotation);\n        // Create a tween to animate the camera rotation around the Z axis.\n        //\n        // make this a relative rotation, always starting from 0. Take into account the\n        // lastRotationValue which may be a leftover from the previous run of \"this\" tween.\n        this.tween = new TWEEN.Tween({ rotation: 0 })\n            .to({ rotation: this.endAngle - this.m_lastRotationValue }, this.duration)\n            .onComplete(() => {\n            this.stop();\n            if (this.onFinished) {\n                this.onFinished();\n            }\n        })\n            .onUpdate(({ rotation }) => {\n            this.m_lastRotationValue = rotation;\n            rotZ.setFromEuler(new THREE.Euler(0, 0, harp_geoutils_1.MathUtils.degToRad(rotation)));\n            if (this.m_userCamerRotation !== undefined) {\n                rotZ.multiply(this.m_userCamerRotation);\n            }\n            this.mapView.camera.quaternion.copy(rotZ);\n        });\n        this.tween.repeat(this.repeat);\n        this.tween.easing(this.easing);\n        this.tween.start(time);\n    }\n    /**\n     * Internal stop of tween. Required because the tween may be interrupted by the [[MapControls]].\n     */\n    stopTween() {\n        if (this.tween) {\n            this.tween.stop();\n        }\n    }\n}\nexports.CameraRotationAnimation = CameraRotationAnimation;\n/**\n * Class to pan between the specified geo coordinates. Height can be specified to move the camera in\n * and out.\n */\nclass CameraPanAnimation extends CameraAnimation {\n    /**\n     * Creates a new `CameraPanAnimation` object.\n     *\n     * @param mapView [[MapView]] which will be affected by the animation.\n     * @param options Animation's options.\n     * @param name Animation's name.\n     */\n    constructor(mapView, options, name) {\n        super(mapView, name);\n        this.name = name;\n        /**\n         * Specifies interpolation. Defaults to [[InterpolationFunction.CatmullRom]]\n         */\n        this.interpolation = TWEEN.Interpolation.CatmullRom;\n        if (options.duration !== undefined) {\n            this.duration = options.duration;\n        }\n        if (options.repeat !== undefined) {\n            this.repeat = options.repeat;\n        }\n        if (options.easing !== undefined) {\n            this.easing =\n                typeof options.easing === \"function\"\n                    ? options.easing\n                    : easingMap.get(options.easing) || TWEEN.Easing.Linear.None;\n        }\n        if (options.interpolation !== undefined) {\n            this.interpolation =\n                typeof options.interpolation === \"function\"\n                    ? options.interpolation\n                    : interpolationMap.get(options.interpolation) || TWEEN.Interpolation.Linear;\n        }\n        this.m_geoCoordinates = options.geoCoordinates !== undefined ? options.geoCoordinates : [];\n    }\n    /**\n     * Add a geo coordinate that should be visited.\n     *\n     * @param geoPos Geographical coordinate to animate to.\n     */\n    addPosition(geoPos) {\n        this.m_geoCoordinates.push(geoPos);\n    }\n    /**\n     * Start the animation.\n     *\n     * @param time Duration of the animation in milliseconds.\n     * @param onFinished Callback that gets triggered once the animation ends.\n     */\n    start(time, onFinished) {\n        if (this.running) {\n            throw new Error(\"Animation already running\" + this.name !== undefined ? this.name : \"\");\n        }\n        this.onFinished = onFinished;\n        this.running = true;\n        const from = new harp_geoutils_1.GeoCoordinates(this.mapView.geoCenter.latitude, this.mapView.geoCenter.longitude, this.mapView.camera.position.z);\n        const to = {\n            latitude: new Array(),\n            longitude: new Array(),\n            altitude: new Array()\n        };\n        for (const pos of this.m_geoCoordinates) {\n            to.latitude.push(pos.latitude);\n            to.longitude.push(pos.longitude);\n            to.altitude.push(pos.altitude || this.mapView.camera.position.z);\n        }\n        this.tween = new TWEEN.Tween(from)\n            .to(to, this.duration)\n            .onComplete(() => {\n            this.stop();\n            if (this.onFinished) {\n                this.onFinished();\n            }\n        })\n            .onUpdate(({ latitude, longitude, altitude }) => {\n            this.mapView.geoCenter = new harp_geoutils_1.GeoCoordinates(latitude, longitude, altitude);\n            this.mapView.camera.position.z = altitude;\n        });\n        this.tween.repeat(this.repeat);\n        this.tween.easing(this.easing);\n        this.tween.interpolation(this.interpolation);\n        this.tween.start(time);\n        this.mapView.beginAnimation();\n    }\n    /**\n     * Stop the animation. Can be started again (with original values only, though).\n     */\n    stop() {\n        if (!this.running) {\n            throw new Error(\"Animation not running\" + this.name !== undefined ? this.name : \"\");\n        }\n        this.running = false;\n        this.mapView.endAnimation();\n        if (this.tween) {\n            this.tween.stop();\n        }\n    }\n    /**\n     * Returns `true` if the animation is being played.\n     */\n    get isRunning() {\n        return this.running;\n    }\n}\nexports.CameraPanAnimation = CameraPanAnimation;\n// Cannot use enum as map index in a typesave manner, otherwise I would love to make it more\n// elegant...\nlet easingMap;\nlet interpolationMap;\nfunction checkSetupTween() {\n    if (easingMap !== undefined) {\n        return;\n    }\n    easingMap = new Map();\n    interpolationMap = new Map();\n    easingMap.set(EasingFunction.Linear, TWEEN.Easing.Linear.None);\n    easingMap.set(EasingFunction.QuadraticIn, TWEEN.Easing.Quadratic.In);\n    easingMap.set(EasingFunction.QuadraticOut, TWEEN.Easing.Quadratic.Out);\n    easingMap.set(EasingFunction.QuadraticInOut, TWEEN.Easing.Quadratic.InOut);\n    easingMap.set(EasingFunction.CubicIn, TWEEN.Easing.Cubic.In);\n    easingMap.set(EasingFunction.CubicOut, TWEEN.Easing.Cubic.Out);\n    easingMap.set(EasingFunction.CubicInOut, TWEEN.Easing.Cubic.InOut);\n    easingMap.set(EasingFunction.QuarticIn, TWEEN.Easing.Quartic.In);\n    easingMap.set(EasingFunction.QuarticOut, TWEEN.Easing.Quartic.Out);\n    easingMap.set(EasingFunction.QuarticInOut, TWEEN.Easing.Quartic.InOut);\n    easingMap.set(EasingFunction.QuinticIn, TWEEN.Easing.Quintic.In);\n    easingMap.set(EasingFunction.QuinticOut, TWEEN.Easing.Quintic.Out);\n    easingMap.set(EasingFunction.QuinticInOut, TWEEN.Easing.Quintic.InOut);\n    easingMap.set(EasingFunction.SinusoidalIn, TWEEN.Easing.Sinusoidal.In);\n    easingMap.set(EasingFunction.SinusoidalOut, TWEEN.Easing.Sinusoidal.Out);\n    easingMap.set(EasingFunction.SinusoidalInOut, TWEEN.Easing.Sinusoidal.InOut);\n    easingMap.set(EasingFunction.ExponentialIn, TWEEN.Easing.Exponential.In);\n    easingMap.set(EasingFunction.ExponentialOut, TWEEN.Easing.Exponential.Out);\n    easingMap.set(EasingFunction.ExponentialInOut, TWEEN.Easing.Exponential.InOut);\n    easingMap.set(EasingFunction.CircularIn, TWEEN.Easing.Circular.In);\n    easingMap.set(EasingFunction.CircularOut, TWEEN.Easing.Circular.Out);\n    easingMap.set(EasingFunction.CircularOut, TWEEN.Easing.Circular.InOut);\n    easingMap.set(EasingFunction.ElasticIn, TWEEN.Easing.Elastic.In);\n    easingMap.set(EasingFunction.ElasticOut, TWEEN.Easing.Elastic.Out);\n    easingMap.set(EasingFunction.ElasticInOut, TWEEN.Easing.Elastic.InOut);\n    easingMap.set(EasingFunction.BackIn, TWEEN.Easing.Back.In);\n    easingMap.set(EasingFunction.BackOut, TWEEN.Easing.Back.Out);\n    easingMap.set(EasingFunction.BackInOut, TWEEN.Easing.Back.InOut);\n    easingMap.set(EasingFunction.BounceIn, TWEEN.Easing.Bounce.In);\n    easingMap.set(EasingFunction.BounceOut, TWEEN.Easing.Bounce.Out);\n    easingMap.set(EasingFunction.BounceInOut, TWEEN.Easing.Bounce.InOut);\n    interpolationMap.set(InterpolationFunction.Linear, TWEEN.Interpolation.Linear);\n    interpolationMap.set(InterpolationFunction.Bezier, TWEEN.Interpolation.Bezier);\n    interpolationMap.set(InterpolationFunction.CatmullRom, TWEEN.Interpolation.CatmullRom);\n}\n","/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\n\n\nvar _Group = function () {\n\tthis._tweens = {};\n\tthis._tweensAddedDuringUpdate = {};\n};\n\n_Group.prototype = {\n\tgetAll: function () {\n\n\t\treturn Object.keys(this._tweens).map(function (tweenId) {\n\t\t\treturn this._tweens[tweenId];\n\t\t}.bind(this));\n\n\t},\n\n\tremoveAll: function () {\n\n\t\tthis._tweens = {};\n\n\t},\n\n\tadd: function (tween) {\n\n\t\tthis._tweens[tween.getId()] = tween;\n\t\tthis._tweensAddedDuringUpdate[tween.getId()] = tween;\n\n\t},\n\n\tremove: function (tween) {\n\n\t\tdelete this._tweens[tween.getId()];\n\t\tdelete this._tweensAddedDuringUpdate[tween.getId()];\n\n\t},\n\n\tupdate: function (time, preserve) {\n\n\t\tvar tweenIds = Object.keys(this._tweens);\n\n\t\tif (tweenIds.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time !== undefined ? time : TWEEN.now();\n\n\t\t// Tweens are updated in \"batches\". If you add a new tween during an update, then the\n\t\t// new tween will be updated in the next batch.\n\t\t// If you remove a tween during an update, it may or may not be updated. However,\n\t\t// if the removed tween was added during the current batch, then it will not be updated.\n\t\twhile (tweenIds.length > 0) {\n\t\t\tthis._tweensAddedDuringUpdate = {};\n\n\t\t\tfor (var i = 0; i < tweenIds.length; i++) {\n\n\t\t\t\tvar tween = this._tweens[tweenIds[i]];\n\n\t\t\t\tif (tween && tween.update(time) === false) {\n\t\t\t\t\ttween._isPlaying = false;\n\n\t\t\t\t\tif (!preserve) {\n\t\t\t\t\t\tdelete this._tweens[tweenIds[i]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttweenIds = Object.keys(this._tweensAddedDuringUpdate);\n\t\t}\n\n\t\treturn true;\n\n\t}\n};\n\nvar TWEEN = new _Group();\n\nTWEEN.Group = _Group;\nTWEEN._nextId = 0;\nTWEEN.nextId = function () {\n\treturn TWEEN._nextId++;\n};\n\n\n// Include a performance.now polyfill.\n// In node.js, use process.hrtime.\nif (typeof (self) === 'undefined' && typeof (process) !== 'undefined' && process.hrtime) {\n\tTWEEN.now = function () {\n\t\tvar time = process.hrtime();\n\n\t\t// Convert [seconds, nanoseconds] to milliseconds.\n\t\treturn time[0] * 1000 + time[1] / 1000000;\n\t};\n}\n// In a browser, use self.performance.now if it is available.\nelse if (typeof (self) !== 'undefined' &&\n         self.performance !== undefined &&\n\t\t self.performance.now !== undefined) {\n\t// This must be bound, because directly assigning this function\n\t// leads to an invocation exception in Chrome.\n\tTWEEN.now = self.performance.now.bind(self.performance);\n}\n// Use Date.now if it is available.\nelse if (Date.now !== undefined) {\n\tTWEEN.now = Date.now;\n}\n// Otherwise, use 'new Date().getTime()'.\nelse {\n\tTWEEN.now = function () {\n\t\treturn new Date().getTime();\n\t};\n}\n\n\nTWEEN.Tween = function (object, group) {\n\tthis._object = object;\n\tthis._valuesStart = {};\n\tthis._valuesEnd = {};\n\tthis._valuesStartRepeat = {};\n\tthis._duration = 1000;\n\tthis._repeat = 0;\n\tthis._repeatDelayTime = undefined;\n\tthis._yoyo = false;\n\tthis._isPlaying = false;\n\tthis._reversed = false;\n\tthis._delayTime = 0;\n\tthis._startTime = null;\n\tthis._easingFunction = TWEEN.Easing.Linear.None;\n\tthis._interpolationFunction = TWEEN.Interpolation.Linear;\n\tthis._chainedTweens = [];\n\tthis._onStartCallback = null;\n\tthis._onStartCallbackFired = false;\n\tthis._onUpdateCallback = null;\n\tthis._onRepeatCallback = null;\n\tthis._onCompleteCallback = null;\n\tthis._onStopCallback = null;\n\tthis._group = group || TWEEN;\n\tthis._id = TWEEN.nextId();\n\n};\n\nTWEEN.Tween.prototype = {\n\tgetId: function () {\n\t\treturn this._id;\n\t},\n\n\tisPlaying: function () {\n\t\treturn this._isPlaying;\n\t},\n\n\tto: function (properties, duration) {\n\n\t\tthis._valuesEnd = Object.create(properties);\n\n\t\tif (duration !== undefined) {\n\t\t\tthis._duration = duration;\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tduration: function duration(d) {\n\t\tthis._duration = d;\n\t\treturn this;\n\t},\n\n\tstart: function (time) {\n\n\t\tthis._group.add(this);\n\n\t\tthis._isPlaying = true;\n\n\t\tthis._onStartCallbackFired = false;\n\n\t\tthis._startTime = time !== undefined ? typeof time === 'string' ? TWEEN.now() + parseFloat(time) : time : TWEEN.now();\n\t\tthis._startTime += this._delayTime;\n\n\t\tfor (var property in this._valuesEnd) {\n\n\t\t\t// Check if an Array was provided as property value\n\t\t\tif (this._valuesEnd[property] instanceof Array) {\n\n\t\t\t\tif (this._valuesEnd[property].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Create a local copy of the Array with the start value at the front\n\t\t\t\tthis._valuesEnd[property] = [this._object[property]].concat(this._valuesEnd[property]);\n\n\t\t\t}\n\n\t\t\t// If `to()` specifies a property that doesn't exist in the source object,\n\t\t\t// we should not set that property in the object\n\t\t\tif (this._object[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Save the starting value.\n\t\t\tthis._valuesStart[property] = this._object[property];\n\n\t\t\tif ((this._valuesStart[property] instanceof Array) === false) {\n\t\t\t\tthis._valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n\t\t\t}\n\n\t\t\tthis._valuesStartRepeat[property] = this._valuesStart[property] || 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tstop: function () {\n\n\t\tif (!this._isPlaying) {\n\t\t\treturn this;\n\t\t}\n\n\t\tthis._group.remove(this);\n\t\tthis._isPlaying = false;\n\n\t\tif (this._onStopCallback !== null) {\n\t\t\tthis._onStopCallback(this._object);\n\t\t}\n\n\t\tthis.stopChainedTweens();\n\t\treturn this;\n\n\t},\n\n\tend: function () {\n\n\t\tthis.update(Infinity);\n\t\treturn this;\n\n\t},\n\n\tstopChainedTweens: function () {\n\n\t\tfor (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\tthis._chainedTweens[i].stop();\n\t\t}\n\n\t},\n\n\tgroup: function (group) {\n\t\tthis._group = group;\n\t\treturn this;\n\t},\n\n\tdelay: function (amount) {\n\n\t\tthis._delayTime = amount;\n\t\treturn this;\n\n\t},\n\n\trepeat: function (times) {\n\n\t\tthis._repeat = times;\n\t\treturn this;\n\n\t},\n\n\trepeatDelay: function (amount) {\n\n\t\tthis._repeatDelayTime = amount;\n\t\treturn this;\n\n\t},\n\n\tyoyo: function (yoyo) {\n\n\t\tthis._yoyo = yoyo;\n\t\treturn this;\n\n\t},\n\n\teasing: function (easingFunction) {\n\n\t\tthis._easingFunction = easingFunction;\n\t\treturn this;\n\n\t},\n\n\tinterpolation: function (interpolationFunction) {\n\n\t\tthis._interpolationFunction = interpolationFunction;\n\t\treturn this;\n\n\t},\n\n\tchain: function () {\n\n\t\tthis._chainedTweens = arguments;\n\t\treturn this;\n\n\t},\n\n\tonStart: function (callback) {\n\n\t\tthis._onStartCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonUpdate: function (callback) {\n\n\t\tthis._onUpdateCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonRepeat: function onRepeat(callback) {\n\n\t\tthis._onRepeatCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonComplete: function (callback) {\n\n\t\tthis._onCompleteCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonStop: function (callback) {\n\n\t\tthis._onStopCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tupdate: function (time) {\n\n\t\tvar property;\n\t\tvar elapsed;\n\t\tvar value;\n\n\t\tif (time < this._startTime) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this._onStartCallbackFired === false) {\n\n\t\t\tif (this._onStartCallback !== null) {\n\t\t\t\tthis._onStartCallback(this._object);\n\t\t\t}\n\n\t\t\tthis._onStartCallbackFired = true;\n\t\t}\n\n\t\telapsed = (time - this._startTime) / this._duration;\n\t\telapsed = (this._duration === 0 || elapsed > 1) ? 1 : elapsed;\n\n\t\tvalue = this._easingFunction(elapsed);\n\n\t\tfor (property in this._valuesEnd) {\n\n\t\t\t// Don't update properties that do not exist in the source object\n\t\t\tif (this._valuesStart[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar start = this._valuesStart[property] || 0;\n\t\t\tvar end = this._valuesEnd[property];\n\n\t\t\tif (end instanceof Array) {\n\n\t\t\t\tthis._object[property] = this._interpolationFunction(end, value);\n\n\t\t\t} else {\n\n\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\n\t\t\t\tif (typeof (end) === 'string') {\n\n\t\t\t\t\tif (end.charAt(0) === '+' || end.charAt(0) === '-') {\n\t\t\t\t\t\tend = start + parseFloat(end);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tend = parseFloat(end);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Protect against non numeric properties.\n\t\t\t\tif (typeof (end) === 'number') {\n\t\t\t\t\tthis._object[property] = start + (end - start) * value;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (this._onUpdateCallback !== null) {\n\t\t\tthis._onUpdateCallback(this._object, elapsed);\n\t\t}\n\n\t\tif (elapsed === 1) {\n\n\t\t\tif (this._repeat > 0) {\n\n\t\t\t\tif (isFinite(this._repeat)) {\n\t\t\t\t\tthis._repeat--;\n\t\t\t\t}\n\n\t\t\t\t// Reassign starting values, restart by making startTime = now\n\t\t\t\tfor (property in this._valuesStartRepeat) {\n\n\t\t\t\t\tif (typeof (this._valuesEnd[property]) === 'string') {\n\t\t\t\t\t\tthis._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._yoyo) {\n\t\t\t\t\t\tvar tmp = this._valuesStartRepeat[property];\n\n\t\t\t\t\t\tthis._valuesStartRepeat[property] = this._valuesEnd[property];\n\t\t\t\t\t\tthis._valuesEnd[property] = tmp;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._valuesStart[property] = this._valuesStartRepeat[property];\n\n\t\t\t\t}\n\n\t\t\t\tif (this._yoyo) {\n\t\t\t\t\tthis._reversed = !this._reversed;\n\t\t\t\t}\n\n\t\t\t\tif (this._repeatDelayTime !== undefined) {\n\t\t\t\t\tthis._startTime = time + this._repeatDelayTime;\n\t\t\t\t} else {\n\t\t\t\t\tthis._startTime = time + this._delayTime;\n\t\t\t\t}\n\n\t\t\t\tif (this._onRepeatCallback !== null) {\n\t\t\t\t\tthis._onRepeatCallback(this._object);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t} else {\n\n\t\t\t\tif (this._onCompleteCallback !== null) {\n\n\t\t\t\t\tthis._onCompleteCallback(this._object);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\t\t\t// Make the chained tweens start exactly at the time they should,\n\t\t\t\t\t// even if the `update()` method was called way past the duration of the tween\n\t\t\t\t\tthis._chainedTweens[i].start(this._startTime + this._duration);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n};\n\n\nTWEEN.Easing = {\n\n\tLinear: {\n\n\t\tNone: function (k) {\n\n\t\t\treturn k;\n\n\t\t}\n\n\t},\n\n\tQuadratic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn k * (2 - k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * (--k * (k - 2) - 1);\n\n\t\t}\n\n\t},\n\n\tCubic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn --k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tQuartic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn 1 - (--k * k * k * k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * ((k -= 2) * k * k * k - 2);\n\n\t\t}\n\n\t},\n\n\tQuintic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tSinusoidal: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - Math.cos(k * Math.PI / 2);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn Math.sin(k * Math.PI / 2);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\treturn 0.5 * (1 - Math.cos(Math.PI * k));\n\n\t\t}\n\n\t},\n\n\tExponential: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k === 0 ? 0 : Math.pow(1024, k - 1);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow(2, - 10 * k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * Math.pow(1024, k - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (- Math.pow(2, - 10 * (k - 1)) + 2);\n\n\t\t}\n\n\t},\n\n\tCircular: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - Math.sqrt(1 - k * k);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn Math.sqrt(1 - (--k * k));\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn - 0.5 * (Math.sqrt(1 - k * k) - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n\n\t\t}\n\n\t},\n\n\tElastic: {\n\n\t\tIn: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tk *= 2;\n\n\t\t\tif (k < 1) {\n\t\t\t\treturn -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\t\t\t}\n\n\t\t\treturn 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n\n\t\t}\n\n\t},\n\n\tBack: {\n\n\t\tIn: function (k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn k * k * ((s + 1) * k - s);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn --k * k * ((s + 1) * k + s) + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tvar s = 1.70158 * 1.525;\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * (k * k * ((s + 1) * k - s));\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n\n\t\t}\n\n\t},\n\n\tBounce: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - TWEEN.Easing.Bounce.Out(1 - k);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tif (k < (1 / 2.75)) {\n\t\t\t\treturn 7.5625 * k * k;\n\t\t\t} else if (k < (2 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n\t\t\t} else if (k < (2.5 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n\t\t\t} else {\n\t\t\t\treturn 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n\t\t\t}\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k < 0.5) {\n\t\t\t\treturn TWEEN.Easing.Bounce.In(k * 2) * 0.5;\n\t\t\t}\n\n\t\t\treturn TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n\n\t\t}\n\n\t}\n\n};\n\nTWEEN.Interpolation = {\n\n\tLinear: function (v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.Linear;\n\n\t\tif (k < 0) {\n\t\t\treturn fn(v[0], v[1], f);\n\t\t}\n\n\t\tif (k > 1) {\n\t\t\treturn fn(v[m], v[m - 1], m - f);\n\t\t}\n\n\t\treturn fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n\n\t},\n\n\tBezier: function (v, k) {\n\n\t\tvar b = 0;\n\t\tvar n = v.length - 1;\n\t\tvar pw = Math.pow;\n\t\tvar bn = TWEEN.Interpolation.Utils.Bernstein;\n\n\t\tfor (var i = 0; i <= n; i++) {\n\t\t\tb += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n\t\t}\n\n\t\treturn b;\n\n\t},\n\n\tCatmullRom: function (v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n\t\tif (v[0] === v[m]) {\n\n\t\t\tif (k < 0) {\n\t\t\t\ti = Math.floor(f = m * (1 + k));\n\t\t\t}\n\n\t\t\treturn fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n\n\t\t} else {\n\n\t\t\tif (k < 0) {\n\t\t\t\treturn v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n\t\t\t}\n\n\t\t\tif (k > 1) {\n\t\t\t\treturn v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n\t\t\t}\n\n\t\t\treturn fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n\n\t\t}\n\n\t},\n\n\tUtils: {\n\n\t\tLinear: function (p0, p1, t) {\n\n\t\t\treturn (p1 - p0) * t + p0;\n\n\t\t},\n\n\t\tBernstein: function (n, i) {\n\n\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\n\n\t\t\treturn fc(n) / fc(i) / fc(n - i);\n\n\t\t},\n\n\t\tFactorial: (function () {\n\n\t\t\tvar a = [1];\n\n\t\t\treturn function (n) {\n\n\t\t\t\tvar s = 1;\n\n\t\t\t\tif (a[n]) {\n\t\t\t\t\treturn a[n];\n\t\t\t\t}\n\n\t\t\t\tfor (var i = n; i > 1; i--) {\n\t\t\t\t\ts *= i;\n\t\t\t\t}\n\n\t\t\t\ta[n] = s;\n\t\t\t\treturn s;\n\n\t\t\t};\n\n\t\t})(),\n\n\t\tCatmullRom: function (p0, p1, p2, p3, t) {\n\n\t\t\tvar v0 = (p2 - p0) * 0.5;\n\t\t\tvar v1 = (p3 - p1) * 0.5;\n\t\t\tvar t2 = t * t;\n\t\t\tvar t3 = t * t2;\n\n\t\t\treturn (2 * p1 - 2 * p2 + v0 + v1) * t3 + (- 3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n\n\t\t}\n\n\t}\n\n};\n\n// UMD (Universal Module Definition)\n(function (root) {\n\n\tif (typeof define === 'function' && define.amd) {\n\n\t\t// AMD\n\t\tdefine([], function () {\n\t\t\treturn TWEEN;\n\t\t});\n\n\t} else if (typeof module !== 'undefined' && typeof exports === 'object') {\n\n\t\t// Node.js\n\t\tmodule.exports = TWEEN;\n\n\t} else if (root !== undefined) {\n\n\t\t// Global variable\n\t\troot.TWEEN = TWEEN;\n\n\t}\n\n})(this);\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_mapview_1 = require(\"@here/harp-mapview\");\nconst harp_lrucache_1 = require(\"@here/harp-lrucache\");\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst TileLoader_1 = require(\"./TileLoader\");\n/**\n * Templated factory class to create instances of [[Tile]].\n */\nclass TileFactory {\n    /**\n     * Initialize the factory using the constructor of the element to be called when a [[Tile]] is\n     * created.\n     *\n     * @param m_modelConstructor Constructor of (subclass of) [[Tile]].\n     */\n    constructor(m_modelConstructor) {\n        this.m_modelConstructor = m_modelConstructor;\n    }\n    /**\n     * Create an instance of (subclass of) [[Tile]]. The required parameters are passed as arguments\n     * to the constructor of [[Tile]].\n     *\n     * @param dataSource [[Datasource]] this class belongs to.\n     * @param tileKey Quadtree address of the [[Tile]].\n     */\n    create(dataSource, tileKey) {\n        return new this.m_modelConstructor(dataSource, tileKey);\n    }\n}\nexports.TileFactory = TileFactory;\nconst maxLevelTileLoaderCache = 3;\n/**\n * Common base class for the typical [[DataSource]] which uses an [[ITileDecoder]] to decode the\n * tile content asynchronously. The decoder can be passed in as an option, or a default\n * asynchronous one is generated.\n */\nclass TileDataSource extends harp_mapview_1.DataSource {\n    /**\n     * Set up the `TileDataSource`.\n     *\n     * @param m_tileFactory Factory to create the [[Tile]] instances.\n     * @param m_options Options specifying the parameters of the [[DataSource]].\n     */\n    constructor(m_tileFactory, m_options) {\n        super(m_options.name, m_options.styleSetName, m_options.minZoomLevel, m_options.maxZoomLevel, m_options.storageLevelOffset);\n        this.m_tileFactory = m_tileFactory;\n        this.m_options = m_options;\n        this.logger = harp_utils_1.LoggerManager.instance.create(\"TileDataSource\");\n        this.m_isReady = false;\n        if (m_options.decoder) {\n            this.m_decoder = m_options.decoder;\n        }\n        else if (m_options.concurrentDecoderServiceName) {\n            this.m_decoder = harp_mapview_1.ConcurrentDecoderFacade.getTileDecoder(m_options.concurrentDecoderServiceName, m_options.concurrentDecoderScriptUrl);\n        }\n        else {\n            throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or ` +\n                `concurrentDecoderServiceName`);\n        }\n        this.m_decoder.configure(undefined, undefined, {\n            storageLevelOffset: this.m_options.storageLevelOffset\n        });\n        this.cacheable = true;\n        this.m_tileLoaderCache = new harp_lrucache_1.LRUCache(this.getCacheCount());\n    }\n    dispose() {\n        this.decoder.dispose();\n    }\n    ready() {\n        return this.m_isReady && this.m_options.dataProvider.ready();\n    }\n    /**\n     * Get the [[ITileDecoder]] of this `ITileDataSource`, which has either been passed in with\n     * the options, or has been supplied by the [[ConcurrentDecoderFacade]].\n     */\n    get decoder() {\n        return this.m_decoder;\n    }\n    connect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield Promise.all([this.m_options.dataProvider.connect(), this.m_decoder.connect()]);\n            this.m_isReady = true;\n        });\n    }\n    setStyleSet(styleSet, languages) {\n        this.m_decoder.configure(styleSet, languages);\n        this.mapView.markTilesDirty(this);\n    }\n    /**\n     * Get the [[DataProvider]] that has been passed in with the options.\n     */\n    dataProvider() {\n        return this.m_options.dataProvider;\n    }\n    getTilingScheme() {\n        return this.m_options.tilingScheme;\n    }\n    /**\n     * Create a [[Tile]] and start the asynchronous download of the tile content. The [[Tile]] will\n     * be empty, but the download and decoding will be scheduled immediately.\n     *\n     * @param tileKey Quadtree address of the requested tile.\n     */\n    getTile(tileKey) {\n        const tile = this.m_tileFactory.create(this, tileKey);\n        const mortonCode = tileKey.mortonCode();\n        const tileLoader = this.m_tileLoaderCache.get(mortonCode);\n        if (tileLoader !== undefined) {\n            tile.tileLoader = tileLoader;\n        }\n        else {\n            const newTileLoader = new TileLoader_1.TileLoader(this, tileKey, this.m_options.dataProvider, this.decoder, 0);\n            tile.tileLoader = newTileLoader;\n            // We don't cache tiles with level 4 and above, at this level, there are 16 (2^4) tiles\n            // horizontally, given the assumption that the zoom level assumes the tile should be 256\n            // pixels wide (see function [[calculateZoomLevelFromDistance]]), and the current\n            // storage offset of -2 (which makes the tiles then 1024 pixels wide). this would mean a\n            // horizontal width of ~16k pixels for the entire earth, this would be quite a lot to\n            // pan, hence caching doesn't make sense above this point (as the chance that we need to\n            // share the TileLoader is small, and even if we did eventually see it, the original\n            // TileLoader would probably be evicted because it was removed by other more recent\n            // tiles).\n            if (tileKey.level <= maxLevelTileLoaderCache) {\n                this.m_tileLoaderCache.set(mortonCode, newTileLoader);\n            }\n        }\n        this.updateTile(tile);\n        return tile;\n    }\n    updateTile(tile) {\n        const tileLoader = tile.tileLoader;\n        if (tileLoader === undefined) {\n            return;\n        }\n        if (tileLoader.decodedTile !== undefined) {\n            this.setDecodedTileOnTile(tileLoader.decodedTile, tile);\n        }\n        else {\n            tileLoader\n                .loadAndDecode()\n                .then(tileLoaderState => {\n                harp_utils_1.assert(tileLoaderState === harp_mapview_1.TileLoaderState.Ready);\n                const decodedTile = tileLoader.decodedTile;\n                this.setDecodedTileOnTile(decodedTile, tile);\n            })\n                .catch(tileLoaderState => {\n                if (tileLoaderState !== harp_mapview_1.TileLoaderState.Canceled &&\n                    tileLoaderState !== harp_mapview_1.TileLoaderState.Failed) {\n                    this.logger.error(\"Unknown error\" + tileLoaderState);\n                }\n            });\n        }\n    }\n    /**\n     * Get [[TileInfo]] of a tile.\n     *\n     * @param tileKey Quadtree address of the requested tile.\n     * @returns A promise which will contain the [[TileInfo]] when resolved.\n     */\n    getTileInfo(tileKey) {\n        const promise = new Promise((resolve, reject) => {\n            const tileLoader = new TileLoader_1.TileInfoLoader(this, tileKey, this.m_options.dataProvider, this.decoder, 0);\n            tileLoader.loadAndDecode().then(loaderState => {\n                if (loaderState === harp_mapview_1.TileLoaderState.Ready) {\n                    resolve(tileLoader.tileInfo);\n                }\n                else {\n                    reject(new Error(`TileDataSource#getInfoTile wrong final state: ${loaderState}`));\n                }\n            });\n        });\n        return promise;\n    }\n    decodedTileHasGeometry(decodedTile) {\n        return (decodedTile.geometries.length ||\n            (decodedTile.poiGeometries !== undefined && decodedTile.poiGeometries.length) ||\n            (decodedTile.textGeometries !== undefined && decodedTile.textGeometries.length) ||\n            (decodedTile.textPathGeometries !== undefined && decodedTile.textPathGeometries.length));\n    }\n    getCacheCount() {\n        // We support up to [[maxLevelTileLoaderCache]] levels, this equates to roughly\n        // 2^maxLevelTileLoaderCache^2 tiles in total (at level maxLevelTileLoaderCache), we don't\n        // generally see that many, so we add a factor of 2 to try to get the worst case.\n        return Math.pow(2, maxLevelTileLoaderCache) * 2;\n    }\n    // Applies the decoded tile to the tile.\n    // If the geometry is empty, then the tile's forceHasGeometry flag is set.\n    // Map is updated.\n    setDecodedTileOnTile(decodedTile, tile) {\n        if (decodedTile && this.decodedTileHasGeometry(decodedTile)) {\n            tile.copyrightInfo =\n                decodedTile.copyrightHolderIds !== undefined\n                    ? decodedTile.copyrightHolderIds.map(id => ({ id }))\n                    : this.m_options.copyrightInfo;\n            tile.setDecodedTile(decodedTile);\n        }\n        else {\n            // empty tiles are traditionally ignored and don't need decode\n            tile.forceHasGeometry(true);\n        }\n        this.requestUpdate();\n    }\n}\nexports.TileDataSource = TileDataSource;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst index_decoder_1 = require(\"@here/harp-datasource-protocol/index-decoder\");\n/**\n * `ThemedTileDecoder` implements an [[ITileDecoder]] which uses a [[Theme]] to apply styles to the\n * objects displayed in the map.\n *\n * By default, decoders are executed in web workers (using [[TileDecoderService]]) for performance\n * reasons.\n */\nclass ThemedTileDecoder {\n    constructor() {\n        this.m_storageLevelOffset = 0;\n    }\n    dispose() {\n        // implemented in subclasses\n    }\n    decodeTile(data, tileKey, projection) {\n        if (this.m_styleSetEvaluator === undefined) {\n            return Promise.reject(new Error(\"No style is defined\"));\n        }\n        return this.decodeThemedTile(data, tileKey, this.m_styleSetEvaluator, projection);\n    }\n    // tslint:disable:no-unused-variable\n    getTileInfo(data, tileKey, projection) {\n        return Promise.resolve(undefined);\n    }\n    // tslint:disable:no-unused-variable\n    configure(styleSet, languages, options) {\n        if (styleSet !== undefined) {\n            this.m_styleSetEvaluator = new index_decoder_1.StyleSetEvaluator(styleSet);\n        }\n        if (languages !== undefined) {\n            this.languages = languages;\n        }\n        if (options !== undefined && options.storageLevelOffset !== undefined) {\n            this.m_storageLevelOffset = options.storageLevelOffset;\n        }\n    }\n}\nexports.ThemedTileDecoder = ThemedTileDecoder;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./lib/StyleSetEvaluator\"));\n__export(require(\"./lib/Extruder\"));\n__export(require(\"./lib/Outliner\"));\n__export(require(\"./lib/Expr\"));\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst harp_utils_1 = require(\"@here/harp-utils\");\nconst Expr_1 = require(\"./Expr\");\nconst InterpolatedProperty_1 = require(\"./InterpolatedProperty\");\nconst InterpolatedPropertyDefs_1 = require(\"./InterpolatedPropertyDefs\");\nexports.logger = harp_utils_1.LoggerManager.instance.create(\"StyleSetEvaluator\");\n/**\n * Combine data from datasource and apply the rules from a specified theme to show it on the map.\n */\nclass StyleSetEvaluator {\n    constructor(styleSet) {\n        this.m_renderOrderBiasGroups = new Map();\n        this.m_techniques = [];\n        let techniqueRenderOrder = 0;\n        const cloneStyle = (style) => {\n            return Object.assign({}, style, { styles: style.styles !== undefined\n                    ? style.styles.map(subStyle => cloneStyle(subStyle))\n                    : undefined });\n        };\n        this.styleSet = styleSet.map(style => cloneStyle(style));\n        const computeDefaultRenderOrder = (style) => {\n            if (style.renderOrderBiasGroup !== undefined) {\n                const renderOrderBiasGroupOrder = style.renderOrderBiasGroup\n                    ? this.m_renderOrderBiasGroups.get(style.renderOrderBiasGroup)\n                    : undefined;\n                if (style.renderOrderBiasRange !== undefined &&\n                    renderOrderBiasGroupOrder === undefined) {\n                    if (style.renderOrder !== undefined) {\n                        exports.logger.warn(\"WARN: style.renderOrder will be overridden if \" +\n                            \"renderOrderBiasGroup is set:\", style);\n                    }\n                    const [minRange, maxRange] = style.renderOrderBiasRange;\n                    style.renderOrder =\n                        minRange < 0\n                            ? techniqueRenderOrder + Math.abs(minRange)\n                            : techniqueRenderOrder;\n                    techniqueRenderOrder += Math.abs(minRange) + maxRange;\n                    if (style.renderOrderBiasGroup) {\n                        this.m_renderOrderBiasGroups.set(style.renderOrderBiasGroup, style.renderOrder);\n                    }\n                    techniqueRenderOrder++;\n                }\n                else if (renderOrderBiasGroupOrder) {\n                    if (style.renderOrder !== undefined) {\n                        exports.logger.warn(\"WARN: style.renderOrder will be overridden if \" +\n                            \"renderOrderBiasGroup is set:\", style);\n                    }\n                    style.renderOrder = renderOrderBiasGroupOrder;\n                }\n            }\n            // search through child styles\n            if (style.styles !== undefined) {\n                for (const currStyle of style.styles) {\n                    computeDefaultRenderOrder(currStyle);\n                }\n            }\n            else {\n                if (style.technique !== undefined && style.renderOrder === undefined) {\n                    style.renderOrder = techniqueRenderOrder++;\n                }\n            }\n        };\n        for (const style of this.styleSet) {\n            computeDefaultRenderOrder(style);\n        }\n    }\n    /**\n     * Find all techniques that fit the current objects' environment.\n     * *The techniques in the resulting array may not be modified* since they are being reused for\n     * identical objects.\n     *\n     * @param env The objects environment, i.e. the attributes that are relevant for its\n     * representation.\n     */\n    getMatchingTechniques(env) {\n        const result = [];\n        const styleStack = new Array();\n        for (const currStyle of this.styleSet) {\n            if (styleStack.length !== 0) {\n                throw new Error(\"Internal error: style stack cleanup failed\");\n            }\n            if (this.processStyle(env, styleStack, currStyle, result)) {\n                break;\n            }\n        }\n        return result;\n    }\n    /**\n     * Add a technique to the current array of techniques. Add its index to the style, so next time\n     * the technique can be found directly from this index.\n     *\n     * @param style Style that defines technique\n     * @param technique Technique to add\n     */\n    addTechniqueToIndex(technique) {\n        const index = this.m_techniques.length;\n        technique._index = index;\n        this.m_techniques.push(technique);\n        return index;\n    }\n    /**\n     * Get the (current) array of techniques that have been created during decoding.\n     */\n    get techniques() {\n        return this.m_techniques;\n    }\n    /**\n     * Shorten the style object for debug log. Remove special strings (starting with \"_\") as well\n     * as the sub-styles of style groups.\n     *\n     * @param key Key in object\n     * @param value value in object\n     */\n    cleanupStyle(key, value) {\n        // Filtering out properties\n        if (key === \"styles\") {\n            return \"[...]\";\n        }\n        if (key.startsWith(\"_\")) {\n            return undefined;\n        }\n        return value;\n    }\n    /**\n     * Process a style (and its sub-styles) hierarchically to look for the technique that fits the\n     * current objects' environment. The attributes of the styles are assembled to create a unique\n     * technique for every object.\n     *\n     * @param env The objects environment, i.e. the attributes that are relevant for its\n     *            representation.\n     * @param styleStack Stack of styles containing the hierarchy of styles up to this point.\n     * @param style Current style (could also be top of stack).\n     * @param result The array of resulting techniques. There may be more than one technique per\n     *               object, resulting in multiple graphical objects for representation.\n     * @returns `true` if style has been found and processing is finished. `false` if not found, or\n     *          more than one technique should be applied.\n     */\n    processStyle(env, styleStack, style, result) {\n        if (style.when !== undefined) {\n            // optimization: Lazy evaluation of when-expression\n            if (style._whenExpr === undefined) {\n                style._whenExpr = Expr_1.Expr.parse(style.when);\n            }\n            if (!style._whenExpr.evaluate(env)) {\n                return false;\n            }\n        }\n        // search through sub-styles\n        if (style.styles !== undefined) {\n            if (style.debug) {\n                exports.logger.log(\"\\n======== style group =========\\nenv:\", JSON.stringify(env.unmap(), undefined, 2), \"\\nstyle group:\", JSON.stringify(style, this.cleanupStyle, 2));\n            }\n            styleStack.push(style);\n            for (const currStyle of style.styles) {\n                if (this.processStyle(env, styleStack, currStyle, result)) {\n                    styleStack.pop();\n                    return true;\n                }\n            }\n            styleStack.pop();\n        }\n        else {\n            // we found a technique!\n            if (style.technique !== undefined) {\n                if (style.technique !== \"none\") {\n                    // Check if we already assembled the technique for exactly this style. If we\n                    // have, we return the preassembled technique object. Otherwise we assemble the\n                    // technique from all parent styles' attributes and the current stales'\n                    // attributes, and add it to the cached techniques.\n                    if (style._index === undefined) {\n                        const technique = this.createTechnique(style, styleStack);\n                        result.push(technique);\n                        if (style.debug) {\n                            exports.logger.log(\"\\n======== style w/ technique =========\\nenv:\", JSON.stringify(env.unmap(), undefined, 2), \"\\nstyle:\", JSON.stringify(style, this.cleanupStyle, 2), \"\\ntechnique:\", JSON.stringify(technique, this.cleanupStyle, 2));\n                        }\n                    }\n                    else {\n                        result.push(this.m_techniques[style._index]);\n                    }\n                }\n                // stop processing if \"final\" is set\n                return style.final === true;\n            }\n        }\n        return false;\n    }\n    createTechnique(style, styleStack) {\n        const technique = {};\n        technique.name = style.technique;\n        const addAttributes = (currStyle) => {\n            if (currStyle.renderOrder !== undefined) {\n                technique.renderOrder = currStyle.renderOrder;\n            }\n            if (currStyle.transient !== undefined) {\n                technique.transient = currStyle.transient;\n            }\n            if (currStyle.renderOrderBiasProperty !== undefined) {\n                technique.renderOrderBiasProperty = currStyle.renderOrderBiasProperty;\n            }\n            if (currStyle.labelProperty !== undefined) {\n                technique.label = currStyle.labelProperty;\n            }\n            if (currStyle.renderOrderBiasRange !== undefined) {\n                technique.renderOrderBiasRange = currStyle.renderOrderBiasRange;\n            }\n            if (currStyle.renderOrderBiasGroup !== undefined) {\n                technique.renderOrderBiasGroup = currStyle.renderOrderBiasGroup;\n            }\n            if (currStyle.secondaryRenderOrder !== undefined) {\n                technique.secondaryRenderOrder = currStyle.secondaryRenderOrder;\n            }\n            if (currStyle.attr !== undefined) {\n                Object.getOwnPropertyNames(currStyle.attr).forEach(property => {\n                    const prop = currStyle.attr[property];\n                    if (InterpolatedProperty_1.isInterpolatedPropertyDefinition(prop)) {\n                        switch (typeof prop.values[0]) {\n                            default:\n                            case \"number\":\n                                technique[property] = createInterpolatedProperty(prop);\n                                break;\n                            case \"boolean\":\n                                technique[property] = createInterpolatedProperty(prop);\n                                break;\n                            case \"string\":\n                                technique[property] = createInterpolatedProperty(prop);\n                                break;\n                        }\n                    }\n                    else {\n                        technique[property] = prop;\n                    }\n                });\n            }\n        };\n        for (const currStyle of styleStack) {\n            addAttributes(currStyle);\n        }\n        addAttributes(style);\n        style._index = this.addTechniqueToIndex(technique);\n        return technique;\n    }\n}\nexports.StyleSetEvaluator = StyleSetEvaluator;\nfunction removeDuplicatePropertyValues(p) {\n    for (let i = 0; i < p.values.length; ++i) {\n        const firstIdx = p.zoomLevels.findIndex((a) => {\n            return a === p.zoomLevels[i];\n        });\n        if (firstIdx !== i) {\n            p.zoomLevels.splice(--i, 1);\n            p.values.splice(--i, 1);\n        }\n    }\n}\nfunction createInterpolatedProperty(prop) {\n    removeDuplicatePropertyValues(prop);\n    const propKeys = new Float32Array(prop.zoomLevels);\n    let propValues;\n    switch (typeof prop.values[0]) {\n        default:\n        case \"number\":\n            propValues = new Float32Array(prop.values);\n            return {\n                interpolationMode: prop.interpolation !== undefined\n                    ? InterpolatedPropertyDefs_1.InterpolationMode[prop.interpolation]\n                    : InterpolatedPropertyDefs_1.InterpolationMode.Discrete,\n                zoomLevels: propKeys,\n                values: propValues\n            };\n        case \"boolean\":\n            propValues = new Float32Array(prop.values.length);\n            for (let i = 0; i < prop.values.length; ++i) {\n                propValues[i] = prop.values[i] ? 1 : 0;\n            }\n            return {\n                interpolationMode: InterpolatedPropertyDefs_1.InterpolationMode.Discrete,\n                zoomLevels: propKeys,\n                values: propValues\n            };\n        case \"string\":\n            propValues = new Float32Array(prop.values.length * 3);\n            for (let i = 0; i < prop.values.length; ++i) {\n                const value = +prop.values[i].replace(\"#\", \"0x\");\n                // tslint:disable:no-bitwise\n                const channels = [\n                    ((value >> 16) & 255) / 255,\n                    ((value >> 8) & 255) / 255,\n                    ((value >> 0) & 255) / 255\n                ];\n                // tslint:disable:bitwise\n                for (let j = 0; j < prop.values.length * 3; ++j) {\n                    propValues[i * 3 + j] = channels[j];\n                }\n            }\n            return {\n                interpolationMode: prop.interpolation !== undefined\n                    ? InterpolatedPropertyDefs_1.InterpolationMode[prop.interpolation]\n                    : InterpolatedPropertyDefs_1.InterpolationMode.Discrete,\n                zoomLevels: propKeys,\n                values: propValues\n            };\n    }\n}\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Fills an index buffer with the indices for the extruded walls for a polygon contour.\n *\n * @param indexBuffer Index buffer to be filled.\n * @param vertexOffset Starting offset of the vertices composing the contour.\n * @param vertexStride Number of elements per contour vertex.\n * @param contour Vertices that compose the contour.\n * @param contourEdges Collection of booleans indicating if contour edges should be added.\n * @param boundaryWalls If `false`, walls in tile boundaries will not be created.\n *\n */\nfunction addExtrudedWalls(indexBuffer, vertexOffset, vertexStride, contour, contourEdges, boundaryWalls) {\n    // Infer the index buffer's position of the vertices that form the extruded-polygons' walls\n    // by stepping through the contour segment by segment.\n    const nSegments = contour.length / vertexStride;\n    for (let i = 0; i < nSegments; ++i) {\n        const vFootprint0 = vertexOffset + i * 2;\n        const vRoof0 = vFootprint0 + 1;\n        const vFootprint1 = vertexOffset + ((i + 1) % nSegments) * 2;\n        const vRoof1 = vFootprint1 + 1;\n        if (boundaryWalls !== false || contourEdges === undefined) {\n            indexBuffer.push(vFootprint0, vRoof0, vRoof1, vRoof1, vFootprint1, vFootprint0);\n        }\n        else if (contourEdges[i]) {\n            indexBuffer.push(vFootprint0, vRoof0, vRoof1, vRoof1, vFootprint1, vFootprint0);\n        }\n    }\n}\nexports.addExtrudedWalls = addExtrudedWalls;\n","\"use strict\";\n/*\n * Copyright (C) 2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst THREE = require(\"three\");\nconst currEdgeStart = new THREE.Vector2();\nconst currEdgeGoal = new THREE.Vector2();\nconst prevEdgeStart = new THREE.Vector2();\nconst prevEdgeGoal = new THREE.Vector2();\n/**\n * Fills an index buffer with the indices for the edges of a polygon contour.\n *\n * @param indexBuffer Edge index buffer to be filled.\n * @param vertexOffset Starting offset of the vertices composing the contour.\n * @param vertexStride Number of elements per contour vertex.\n * @param polygonContour Vertices that compose the contour.\n * @param polygonContourEdges Collection of booleans indicating if contour edges should be added.\n */\nfunction addPolygonEdges(indexBuffer, vertexOffset, vertexStride, polygonContour, polygonContourEdges, isExtruded, addFootprintEdges, wallEdgeSlope) {\n    for (let i = 0; i < polygonContourEdges.length; ++i) {\n        if (polygonContourEdges[i]) {\n            if (isExtruded === true) {\n                const vFootprint0 = vertexOffset + i * 2;\n                const vRoof0 = vFootprint0 + 1;\n                const vFootprint1 = vertexOffset + ((i + 1) % polygonContourEdges.length) * 2;\n                const vRoof1 = vFootprint1 + 1;\n                if (addFootprintEdges === true) {\n                    indexBuffer.push(vFootprint0, vFootprint1);\n                }\n                indexBuffer.push(vRoof0, vRoof1);\n                const prevEdgeIdx = (i === 0 ? polygonContourEdges.length : i) - 1;\n                if (polygonContourEdges[prevEdgeIdx]) {\n                    if (wallEdgeSlope !== undefined) {\n                        const v0x = polygonContour[i * vertexStride];\n                        const v0y = polygonContour[i * vertexStride + 1];\n                        const v1x = polygonContour[((i + 1) % polygonContourEdges.length) * vertexStride];\n                        const v1y = polygonContour[((i + 1) % polygonContourEdges.length) * vertexStride + 1];\n                        currEdgeStart.set(v0x, v0y);\n                        currEdgeGoal.set(v1x, v1y);\n                        prevEdgeStart.set(polygonContour[prevEdgeIdx * vertexStride], polygonContour[prevEdgeIdx * vertexStride + 1]);\n                        prevEdgeGoal.set(currEdgeStart.x, currEdgeStart.y);\n                        if (prevEdgeGoal\n                            .sub(prevEdgeStart)\n                            .normalize()\n                            .dot(currEdgeGoal.sub(currEdgeStart).normalize()) <= wallEdgeSlope) {\n                            indexBuffer.push(vFootprint0, vRoof0);\n                        }\n                    }\n                    else {\n                        indexBuffer.push(vFootprint0, vRoof0);\n                    }\n                }\n            }\n            else {\n                const vFoot0 = vertexOffset + i;\n                const vRoof0 = vertexOffset + ((i + 1) % polygonContourEdges.length);\n                indexBuffer.push(vFoot0, vRoof0);\n            }\n        }\n    }\n}\nexports.addPolygonEdges = addPolygonEdges;\n","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n\n  return css;\n}\n\nfunction colorToString (color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return Object.prototype.toString.call(obj) === '[object Function]';\n  }\n};\n\nvar INTERPRETATIONS = [\n{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n},\n{\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n},\n{\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n},\n{\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n    h /= 6;\n    if (h < 0) {\n      h += 1;\n    }\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n    this.__state.a = this.__state.a || 1;\n  }\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (!this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n    }\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n  var match = val.match(CSS_VALUE_PIXELS);\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n  return 0;\n}\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n    elem.style.position = 'absolute';\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n    var evt = document.createEvent(className);\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\n          0,\n          clientX,\n          clientY,\n          false, false, false, false, 0, null);\n          break;\n        }\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = { left: 0, top: 0 };\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n    _this2.domElement.appendChild(_this2.__checkbox);\n    _this2.updateDisplay();\n    return _this2;\n  }\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n    });\n    _this2.updateDisplay();\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n    _this2.domElement.appendChild(_this2.__select);\n    return _this2;\n  }\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n    var _this = _this2;\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n  return 0;\n}\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n    var _params = params || {};\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onBlur() {\n      onFinish();\n    }\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n      prevY = e.clientY;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, { min: min, max: max, step: step }));\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n    function onMouseDrag(e) {\n      e.preventDefault();\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n      return false;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.updateDisplay();\n    _this2.__background.appendChild(_this2.__foreground);\n    _this2.domElement.appendChild(_this2.__background);\n    return _this2;\n  }\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n    _this2.domElement.appendChild(_this2.__button);\n    return _this2;\n  }\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n      this.getValue().call(this.object);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n    _this2.__saturation_field.appendChild(valueField);\n    _this2.__selector.appendChild(_this2.__field_knob);\n    _this2.__selector.appendChild(_this2.__saturation_field);\n    _this2.__selector.appendChild(_this2.__hue_field);\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n    _this2.domElement.appendChild(_this2.__input);\n    _this2.domElement.appendChild(_this2.__selector);\n    _this2.updateDisplay();\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n      _this.__color.v = v;\n      _this.__color.s = s;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n      _this.__color.h = h * 360;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    return _this2;\n  }\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n      var _flip = 255 - flip;\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n    try {\n      head.appendChild(injected);\n    } catch (e) {\n    }\n  }\n};\n\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3], step: arguments[4] });\n    }\n    return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n  }\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\nvar styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\ncss.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    return false;\n  }\n}();\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\nvar GUI = function GUI(pars) {\n  var _this = this;\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n  }\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  var titleRow = void 0;\n  Object.defineProperties(this,\n  {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n        setPresetSelectIndex(this);\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n        if (titleRow) {\n          titleRow.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n        this.onResize();\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n  if (Common.isUndefined(params.parent)) {\n    this.closed = params.closed || false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n    var titleRowName = document.createTextNode(params.name);\n    dom.addClass(titleRowName, 'controller-name');\n    titleRow = addRow(_this, titleRowName);\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n  function resetWidth() {\n    var root = _this.getRoot();\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n  if (!params.parent) {\n    resetWidth();\n  }\n};\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype,\n{\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n    var _this = this;\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n    var _this = this;\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n    var newGuiParams = { name: name, parent: this };\n    newGuiParams.autoPlace = this.autoPlace;\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n    delete this.__folders[folder.name];\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n    removeListeners(folder);\n    var _this = this;\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n    var _this = this;\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n    this.__listening.push(controller);\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n  gui.onResize();\n  return li;\n}\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller,                                   {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n      return controller;\n    }\n  });\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n      return returned;\n    };\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n    return val;\n  }, controller.setValue);\n}\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n    controllerMap[controller.property] = controller;\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n  var controller = void 0;\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n  augmentController(gui, li, controller);\n  gui.__controllers.push(controller);\n  return controller;\n}\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n  gui.__preset_select.appendChild(opt);\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar color = {\n  Color: Color,\n  math: ColorMath,\n  interpret: interpret\n};\nvar controllers = {\n  Controller: Controller,\n  BooleanController: BooleanController,\n  OptionController: OptionController,\n  StringController: StringController,\n  NumberController: NumberController,\n  NumberControllerBox: NumberControllerBox,\n  NumberControllerSlider: NumberControllerSlider,\n  FunctionController: FunctionController,\n  ColorController: ColorController\n};\nvar dom$1 = { dom: dom };\nvar gui = { GUI: GUI };\nvar GUI$1 = GUI;\nvar index = {\n  color: color,\n  controllers: controllers,\n  dom: dom$1,\n  gui: gui,\n  GUI: GUI$1\n};\n\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\nexport default index;\n//# sourceMappingURL=dat.gui.module.js.map\n","// Copyright  2017-2019 HERE Europe B.V.\n// Licensed under Apache 2.0, see full license in LICENSE\n// SPDX-License-Identifier: Apache-2.0\n\nconst vertexShader = () => `\nvarying float vAltitude;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n\nattribute vec2 octNormal;\n\nuniform bool useOctNormal;\n\n#include <fog_pars_vertex>\n\nvec2 signNotZero(vec2 v) {\n  return vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\n\nvec3 oct_to_float32x3(vec2 e) {\n  vec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\n  if (v.z < 0.0) {\n    v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n  }\n  return normalize(v);\n}\n\nvec2 snorm_to_float32x2(vec2 s) {\n  vec2 v = ((s / 255.0) * 2.0) - 1.0;\n  return v;\n}\n\nvoid main() {\n  vAltitude = position[2]; // z value\n\n  if (useOctNormal) {\n    vec2 floatOctNormal = snorm_to_float32x2(octNormal);\n    vec3 decNormal = oct_to_float32x3(floatOctNormal);\n    vNormal = decNormal;\n  } else {\n    vNormal = normal;\n  }\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  \n  #include <begin_vertex>\n  #include <project_vertex>\n  #include <fog_vertex>\n}\n`\n\nexport default vertexShader\n","// Copyright  2017-2019 HERE Europe B.V.\n// Licensed under Apache 2.0, see full license in LICENSE\n// SPDX-License-Identifier: Apache-2.0\n\nconst fragmentShader = vars => `\n#define COLOR_STEPS_COUNT ${vars.COLOR_STEPS_COUNT}\n\nvarying float vAltitude;\nvarying vec2 vUv;\nvarying vec3 vNormal;\n\nuniform vec3 colorSteps[COLOR_STEPS_COUNT];\nuniform float altitudeSteps[COLOR_STEPS_COUNT];\n\nuniform sampler2D texture;\nuniform int hasTexture;\nuniform float textureIntensity;\nuniform vec3 lightVector;\nuniform float opacity;\n\n#include <fog_pars_fragment>\n\nvoid main() {\n  vec3 altitudeColor;\n  float lowestAltitude = altitudeSteps[0];\n  float highestAlttitude = altitudeSteps[COLOR_STEPS_COUNT - 1];\n  vec3 lowestAltitudeColor = colorSteps[0];\n  vec3 highestAltitudeColor = colorSteps[COLOR_STEPS_COUNT - 1];\n\n  if (vAltitude < lowestAltitude) {\n    altitudeColor = lowestAltitudeColor;\n  }\n\n  if (vAltitude > highestAlttitude) {\n    altitudeColor = highestAltitudeColor;\n  }\n\n  for(int i = 0; i < COLOR_STEPS_COUNT - 1; i++) {\n    if (vAltitude > altitudeSteps[i] && vAltitude <= altitudeSteps[i + 1]) {\n      altitudeColor = mix(\n        colorSteps[i],\n        colorSteps[i + 1],\n        (vAltitude - altitudeSteps[i]) / (altitudeSteps[i + 1] - altitudeSteps[i])\n      );\n    }\n  }\n\n  if (hasTexture == 1) {\n    vec4 texColor = texture2D(texture, vUv);\n\n    gl_FragColor = vec4(mix(altitudeColor.xyz, texColor.xyz, textureIntensity), 1.0);\n  } else {\n    vec3 color = altitudeColor * clamp(dot(vNormal, normalize(lightVector)), 0.3, 1.0); \n  \n    gl_FragColor = vec4(color, opacity);\n  }\n  \n  #include <fog_fragment>\n}\n`\n\nexport default fragmentShader\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as THREE from 'three'\n\nimport vertexShader from './shaders/vertex.glsl'\nimport fragmentShader from './shaders/fragment.glsl'\n\nconst stylingOptionsDefaults = {\n  colorSteps: [\n    {\n      color: new THREE.Vector3(0, 0, 0),\n      altitude: -300\n    },\n    {\n      color: new THREE.Vector3(1, 1, 1),\n      altitude: 8848\n    }\n  ],\n  texture: null,\n  textureIntensity: 0.4,\n  lightVector: new THREE.Vector3(1.0, 0.0, 0.5),\n  opacity: 1\n}\n\nexport class ElevationMaterial extends THREE.ShaderMaterial {\n  constructor (decodedTile, stylingOptions) {\n    const options = Object.assign({}, stylingOptionsDefaults, stylingOptions)\n    const sortedColorSteps = options.colorSteps.slice().sort((a, b) => a.altitude >= b.altitude)\n    const colors = sortedColorSteps.map(item => item.color)\n    const altitudes = sortedColorSteps.map(item => item.altitude)\n\n    const uniforms = THREE.UniformsUtils.merge([\n      {\n        useOctNormal: { value: ElevationMaterial.containsOctNormals(decodedTile) },\n        colorSteps: { value: colors },\n        altitudeSteps: { value: altitudes },\n        textureIntensity: { value: options.textureIntensity },\n        hasTexture: { value: options.texture === null ? 0 : 1 },\n        texture: { value: options.texture },\n        lightVector: { value: options.lightVector },\n        opacity: { value: options.opacity }\n      },\n      THREE.UniformsLib.fog\n    ])\n\n    super({\n      vertexShader: vertexShader(),\n      fragmentShader: fragmentShader({\n        COLOR_STEPS_COUNT: sortedColorSteps.length\n      }),\n      uniforms\n    })\n  }\n\n  static containsOctNormals (decodedTile) {\n    const geometry = decodedTile.geometries[0]\n    return geometry.vertexAttributes.find(this.isOctNormalAttribute) !== undefined\n  }\n\n  static isOctNormalAttribute (attribute) {\n    return attribute.name === 'octNormal'\n  }\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as THREE from 'three'\n\nimport { ElevationMaterial } from './elevation-styling'\nimport { Tile } from '@here/harp-mapview'\nimport { TileFactory } from '@here/harp-mapview-decoder'\n\nexport class TerrainTileFactory extends TileFactory {\n  constructor (options) {\n    super(TerrainTile)\n    this.options = options\n  }\n\n  create (dataSource, tileKey) {\n    return new TerrainTile(dataSource, tileKey, this.options)\n  }\n}\n\nclass TerrainTile extends Tile {\n  constructor (dataSource, tileKey, options) {\n    super(dataSource, tileKey)\n\n    this.getTileMaterial = options.getTileMaterial\n    this.getCustomObjects = options.getCustomObjects\n\n    this.decodedTileGeometry = null\n    this.scaledPositionArray = null\n    this.tileSize = this.getTileSize(\n      this.tileKey,\n      this.projection,\n      this.dataSource.getTilingScheme()\n    )\n  }\n\n  generateTileMaterial (decodedTile) {\n    return this.getTileMaterial\n      ? this.getTileMaterial(this, decodedTile)\n      : Promise.resolve(new ElevationMaterial(decodedTile))\n  }\n\n  getTileSize (tileKey, projection, tilingScheme) {\n    const boundingBox = new THREE.Box3()\n    const size = new THREE.Vector3()\n    const geoBox = tilingScheme.getGeoBox(tileKey)\n\n    projection.projectBox(geoBox, boundingBox)\n    boundingBox.getSize(size)\n\n    return size\n  }\n\n  scaleVertices (positionArray, tileHeader, tileSize) {\n    const xScale = tileSize.x\n    const yScale = tileSize.y\n    const zScale = tileHeader.maxHeight - tileHeader.minHeight\n    const scaledPositionArray = new Float32Array(positionArray.length)\n\n    for (let i = 0; i < positionArray.length; i += 3) {\n      scaledPositionArray[i] = positionArray[i] * xScale - tileSize.x / 2\n      scaledPositionArray[i + 1] = positionArray[i + 1] * yScale - tileSize.y / 2\n      scaledPositionArray[i + 2] = positionArray[i + 2] * zScale + tileHeader.minHeight\n    }\n\n    return scaledPositionArray\n  }\n\n  findVertexAttribute (attributeArray, name) {\n    return attributeArray.find(attr => attr.name === name)\n  }\n\n  createObjects (decodedTile, objects) {\n    this.decodedTileGeometry = decodedTile.geometries[0]\n\n    const vertexPosition = this.findVertexAttribute(this.decodedTileGeometry.vertexAttributes, 'position')\n    const buffer = vertexPosition.buffer\n    const metadata = vertexPosition.metadata\n\n    this.scaledPositionArray = this.scaleVertices(buffer, metadata, this.tileSize)\n\n    this.generateTileMaterial(decodedTile).then((material) =>\n      this.createTileObjects(material, decodedTile.geometries[0], objects)\n    )\n    if (this.getCustomObjects) {\n      Promise.resolve(this.getCustomObjects(this))\n        .then(() => this.dataSource.requestUpdate())\n    }\n  }\n\n  createTileObjects (material, decodedTileGeometry, objects) {\n    const tileGeometry = new THREE.BufferGeometry()\n    const tileMesh = new THREE.Mesh(tileGeometry, material)\n\n    decodedTileGeometry.vertexAttributes.forEach((attr) => {\n      const buffer =\n        attr.name === 'position'\n          ? this.scaledPositionArray\n          : attr.buffer\n\n      tileGeometry.addAttribute(attr.name, new THREE.BufferAttribute(buffer, attr.itemCount))\n    })\n\n    if (decodedTileGeometry.index !== undefined) {\n      tileGeometry.setIndex(new THREE.BufferAttribute(decodedTileGeometry.index.buffer, 1))\n    }\n\n    if (!tileGeometry.attributes.normal && !tileGeometry.attributes.octNormal) {\n      tileGeometry.computeVertexNormals()\n    }\n\n    this.registerTileObject(tileMesh)\n\n    objects.push(tileMesh)\n\n    this.dataSource.requestUpdate()\n  }\n\n  calculateLocalDisplacement (geoCoordinates) {\n    const worldCoordinates = this.projection.projectPoint(geoCoordinates, new THREE.Vector3())\n    const localCoordinates = worldCoordinates.sub(this.center)\n\n    const indexBuffer = this.decodedTileGeometry.index.buffer\n    const scaledPositionArray = this.scaledPositionArray\n    const displacement = new THREE.Vector3(0, 0, 0)\n\n    for (let i = 0; i < indexBuffer.length; i += 3) {\n      const index1 = indexBuffer[i] * 3\n      const index2 = indexBuffer[i + 1] * 3\n      const index3 = indexBuffer[i + 2] * 3\n\n      const v1 = new THREE.Vector3(scaledPositionArray[index1], scaledPositionArray[index1 + 1], scaledPositionArray[index1 + 2])\n      const v2 = new THREE.Vector3(scaledPositionArray[index2], scaledPositionArray[index2 + 1], scaledPositionArray[index2 + 2])\n      const v3 = new THREE.Vector3(scaledPositionArray[index3], scaledPositionArray[index3 + 1], scaledPositionArray[index3 + 2])\n\n      const triangle = new THREE.Triangle(v1, v2, v3)\n      const planeTriangle = new THREE.Triangle(\n        v1.clone().setZ(0),\n        v2.clone().setZ(0),\n        v3.clone().setZ(0)\n      )\n\n      if (planeTriangle.containsPoint(localCoordinates)) {\n        const rationVector = planeTriangle.getBarycoord(localCoordinates, new THREE.Vector3())\n\n        const displacementZ = rationVector.x * triangle.a.z + rationVector.y * triangle.b.z + rationVector.z * triangle.c.z\n\n        displacement.set(localCoordinates.x, localCoordinates.y, displacementZ)\n\n        break\n      }\n    }\n\n    return displacement\n  }\n\n  addObject (geoCoordinates, object) {\n    if (this.geoBox.contains(geoCoordinates)) {\n      object.displacement = this.calculateLocalDisplacement(geoCoordinates)\n\n      this.registerTileObject(object)\n      this.objects.push(object)\n    }\n  }\n}\n\nexport { ElevationMaterial }\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class TerrainDataProvider {\n  constructor (fetchTile) {\n    if (fetchTile === undefined) {\n      throw new Error('\"fetchTile()\" method was not provided')\n    }\n\n    this.fetchTile = fetchTile\n  }\n\n  connect () {\n    return Promise.resolve()\n  }\n\n  ready () {\n    return true\n  }\n\n  getTile (tileKey) {\n    return this.fetchTile(tileKey)\n  }\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { TileDataSource } from '@here/harp-mapview-decoder'\n\nimport { TerrainTileFactory } from './terrain-tile'\nimport { TerrainDataProvider } from './terrain-data-provider'\n\nexport class TerrainDataSource extends TileDataSource {\n  constructor (options) {\n    if (options.tilingScheme === undefined) {\n      throw new Error('No \"tilingScheme\" option provided.')\n    }\n\n    if (options.concurrentDecoderServiceName === undefined) {\n      throw new Error(\n        'No \"concurrentDecoderServiceName\" option provided. ' +\n        'It should be an ID of one of the supported decoders.'\n      )\n    }\n\n    if (options.concurrentDecoderScriptUrl === undefined) {\n      throw new Error(\n        'No \"concurrentDecoderScriptUrl\" option provided. ' +\n        'It should be URL of a decoder worker used to decode tiles.'\n      )\n    }\n\n    const tileFactory = new TerrainTileFactory(\n      options\n    )\n\n    super(tileFactory, {\n      id: 'terrain',\n      tilingScheme: options.tilingScheme,\n      dataProvider: new TerrainDataProvider(options.fetchTile),\n      useWorker: true,\n      concurrentDecoderServiceName: options.concurrentDecoderServiceName,\n      concurrentDecoderScriptUrl: options.concurrentDecoderScriptUrl\n    })\n\n    this.options = options\n\n    if (options.decoderOptions !== undefined) {\n      this.decoder.connect().then(() => {\n        this.decoder.configure(options.decoderOptions)\n      })\n    }\n  }\n\n  connect () {\n    return this.decoder.connect()\n  }\n\n  ready () {\n    return true\n  }\n\n  shouldPreloadTiles () {\n    return true\n  }\n\n  getDisplayZoomLevel (level) {\n    if (this.options.getDisplayZoomLevel !== undefined) {\n      return this.options.getDisplayZoomLevel(level)\n    }\n\n    return level\n  }\n}\n","const QUANTIZED_MESH_HEADER = new Map([\n  ['centerX', Float64Array.BYTES_PER_ELEMENT],\n  ['centerY', Float64Array.BYTES_PER_ELEMENT],\n  ['centerZ', Float64Array.BYTES_PER_ELEMENT],\n\n  ['minHeight', Float32Array.BYTES_PER_ELEMENT],\n  ['maxHeight', Float32Array.BYTES_PER_ELEMENT],\n\n  ['boundingSphereCenterX', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterY', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterZ', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereRadius', Float64Array.BYTES_PER_ELEMENT],\n\n  ['horizonOcclusionPointX', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointY', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointZ', Float64Array.BYTES_PER_ELEMENT]\n])\n\nfunction decodeZigZag (value) {\n  return (value >> 1) ^ (-(value & 1))\n}\n\nfunction decodeHeader (dataView) {\n  let position = 0\n  const header = {}\n\n  for (let [key, bytesCount] of QUANTIZED_MESH_HEADER) {\n    const getter = bytesCount === 8 ? dataView.getFloat64 : dataView.getFloat32\n\n    header[key] = getter.call(dataView, position, true)\n    position += bytesCount\n  }\n\n  return { header, headerEndPosition: position }\n}\n\nfunction decodeVertexData (dataView, headerEndPosition) {\n  let position = headerEndPosition\n  const elementsPerVertex = 3\n  const vertexCount = dataView.getUint32(position, true)\n  const vertexData = new Uint16Array(vertexCount * elementsPerVertex)\n\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const bytesPerArrayElement = Uint16Array.BYTES_PER_ELEMENT\n  const elementArrayLength = vertexCount * bytesPerArrayElement\n  const uArrayStartPosition = position\n  const vArrayStartPosition = uArrayStartPosition + elementArrayLength\n  const heightArrayStartPosition = vArrayStartPosition + elementArrayLength\n\n  let u = 0\n  let v = 0\n  let height = 0\n\n  for (let i = 0; i < vertexCount; i++) {\n    u += decodeZigZag(dataView.getUint16(uArrayStartPosition + bytesPerArrayElement * i, true))\n    v += decodeZigZag(dataView.getUint16(vArrayStartPosition + bytesPerArrayElement * i, true))\n    height += decodeZigZag(dataView.getUint16(heightArrayStartPosition + bytesPerArrayElement * i, true))\n\n    vertexData[i] = u\n    vertexData[i + vertexCount] = v\n    vertexData[i + vertexCount * 2] = height\n  }\n\n  position += elementArrayLength * 3\n\n  return { vertexData, vertexDataEndPosition: position }\n}\n\nfunction decodeIndex (buffer, position, indicesCount, bytesPerIndex, encoded = true) {\n  let indices\n\n  if (bytesPerIndex === 2) {\n    indices = new Uint16Array(buffer, position, indicesCount)\n  } else {\n    indices = new Uint32Array(buffer, position, indicesCount)\n  }\n\n  if (!encoded) {\n    return indices\n  }\n\n  let highest = 0\n\n  for (let i = 0; i < indices.length; ++i) {\n    let code = indices[i]\n\n    indices[i] = highest - code\n\n    if (code === 0) {\n      ++highest\n    }\n  }\n\n  return indices\n}\n\nfunction decodeTriangleIndices (dataView, vertexData, vertexDataEndPosition) {\n  let position = vertexDataEndPosition\n  const elementsPerVertex = 3\n  const vertexCount = vertexData.length / elementsPerVertex\n  const bytesPerIndex = vertexCount > 65536\n    ? Uint32Array.BYTES_PER_ELEMENT\n    : Uint16Array.BYTES_PER_ELEMENT\n\n  if (position % bytesPerIndex !== 0) {\n    position += bytesPerIndex - (position % bytesPerIndex)\n  }\n\n  const triangleCount = dataView.getUint32(position, true)\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const triangleIndicesCount = triangleCount * 3\n  const triangleIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    triangleIndicesCount,\n    bytesPerIndex\n  )\n  position += triangleIndicesCount * bytesPerIndex\n\n  return {\n    triangleIndicesEndPosition: position,\n    triangleIndices\n  }\n}\n\nfunction decodeEdgeIndices (dataView, vertexData, triangleIndicesEndPosition) {\n  let position = triangleIndicesEndPosition\n  const elementsPerVertex = 3\n  const vertexCount = vertexData.length / elementsPerVertex\n  const bytesPerIndex = vertexCount > 65536\n    ? Uint32Array.BYTES_PER_ELEMENT\n    : Uint16Array.BYTES_PER_ELEMENT\n\n  const westVertexCount = dataView.getUint32(position, true)\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const westIndices = decodeIndex(dataView.buffer, position, westVertexCount, bytesPerIndex, false)\n  position += westVertexCount * bytesPerIndex\n\n  const southVertexCount = dataView.getUint32(position, true)\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const southIndices = decodeIndex(dataView.buffer, position, southVertexCount, bytesPerIndex, false)\n  position += southVertexCount * bytesPerIndex\n\n  const eastVertexCount = dataView.getUint32(position, true)\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const eastIndices = decodeIndex(dataView.buffer, position, eastVertexCount, bytesPerIndex, false)\n  position += eastVertexCount * bytesPerIndex\n\n  const northVertexCount = dataView.getUint32(position, true)\n  position += Uint32Array.BYTES_PER_ELEMENT\n\n  const northIndices = decodeIndex(dataView.buffer, position, northVertexCount, bytesPerIndex, false)\n  position += northVertexCount * bytesPerIndex\n\n  return {\n    edgeIndicesEndPosition: position,\n    westIndices,\n    southIndices,\n    eastIndices,\n    northIndices\n  }\n}\n\nfunction decodeVertexNormalsExtension (extensionDataView) {\n  return new Uint8Array(\n    extensionDataView.buffer, extensionDataView.byteOffset, extensionDataView.byteLength\n  )\n}\n\nfunction decodeWaterMaskExtension (extensionDataView) {\n  return extensionDataView.buffer.slice(\n    extensionDataView.byteOffset,\n    extensionDataView.byteOffset + extensionDataView.byteLength\n  )\n}\n\nfunction decodeExtensions (dataView, indicesEndPosition) {\n  const extensions = {}\n\n  if (dataView.byteLength <= indicesEndPosition) {\n    return { extensions, extensionsEndPosition: indicesEndPosition }\n  }\n\n  let position = indicesEndPosition\n\n  while (position < dataView.byteLength) {\n    const extensionId = dataView.getUint8(position, true)\n    position += Uint8Array.BYTES_PER_ELEMENT\n\n    const extensionLength = dataView.getUint32(position, true)\n    position += Uint32Array.BYTES_PER_ELEMENT\n\n    const extensionView = new DataView(dataView.buffer, position, extensionLength)\n\n    switch (extensionId) {\n      case 1: {\n        extensions.vertexNormals = decodeVertexNormalsExtension(extensionView)\n\n        break\n      }\n      case 2: {\n        extensions.waterMask = decodeWaterMaskExtension(extensionView)\n\n        break\n      }\n      default: {\n        console.warn(`Unknown extension with id ${extensionId}`)\n      }\n    }\n\n    position += extensionLength\n  }\n\n  return { extensions, extensionsEndPosition: position }\n}\n\nexport const DECODING_STEPS = {\n  header: 0,\n  vertices: 1,\n  triangleIndices: 2,\n  edgeIndices: 3,\n  extensions: 4\n}\n\nconst DEFAULT_OPTIONS = {\n  maxDecodingStep: DECODING_STEPS.extensions\n}\n\nexport default function decode (data, userOptions) {\n  const options = Object.assign({}, DEFAULT_OPTIONS, userOptions)\n  const view = new DataView(data)\n  const { header, headerEndPosition } = decodeHeader(view)\n\n  if (options.maxDecodingStep < DECODING_STEPS.vertices) {\n    return { header }\n  }\n\n  const { vertexData, vertexDataEndPosition } = decodeVertexData(view, headerEndPosition)\n\n  if (options.maxDecodingStep < DECODING_STEPS.triangleIndices) {\n    return { header, vertexData }\n  }\n\n  const {\n    triangleIndices,\n    triangleIndicesEndPosition\n  } = decodeTriangleIndices(view, vertexData, vertexDataEndPosition)\n\n  if (options.maxDecodingStep < DECODING_STEPS.edgeIndices) {\n    return { header, vertexData, triangleIndices }\n  }\n\n  const {\n    westIndices,\n    southIndices,\n    eastIndices,\n    northIndices,\n    edgeIndicesEndPosition\n  } = decodeEdgeIndices(view, vertexData, triangleIndicesEndPosition)\n\n  if (options.maxDecodingStep < DECODING_STEPS.extensions) {\n    return {\n      header,\n      vertexData,\n      triangleIndices,\n      westIndices,\n      northIndices,\n      eastIndices,\n      southIndices\n    }\n  }\n\n  const { extensions } = decodeExtensions(view, edgeIndicesEndPosition)\n\n  return {\n    header,\n    vertexData,\n    triangleIndices,\n    westIndices,\n    northIndices,\n    eastIndices,\n    southIndices,\n    extensions\n  }\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default {\n  APP_ID: process.env.APP_ID,\n  APP_CODE: process.env.APP_CODE,\n  CESIUM_USER_ACCESS_TOKEN: process.env.CESIUM_USER_ACCESS_TOKEN\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const datasetList = [\n  'Grand Teton National Park (Quantized Mesh)',\n  'Cesium World Terrain (Quantized Mesh)' /* ,\n  'Nextzen Terrain (PNG)' */\n]\n\nexport const stylesList = [\n  'Elevation Styling',\n  'Texture',\n  'Wireframe'\n]\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as THREE from 'three'\nimport { mercatorTilingScheme } from '@here/harp-geoutils'\nimport { ElevationMaterial } from '@here/harp-terrain-datasource/src/terrain-tile'\n\nimport config from './config'\nimport {\n  datasetList,\n  stylesList\n} from './constants'\n\nconst textureLoader = new THREE.TextureLoader()\ntextureLoader.crossOrigin = ''\n\nfunction getTileTextureUrl (tile) {\n  const textureTileKey = mercatorTilingScheme.getTileKey(tile.geoBox.center, tile.tileKey.level)\n  const shard = Math.round(Math.random() * 3) + 1\n\n  return `https://${shard}.aerial.maps.api.here.com/maptile/2.1/basetile/newest/satellite.day/${textureTileKey.level}/${textureTileKey.column}/${textureTileKey.rowCount() - textureTileKey.row - 1}/512/png?app_id=${config.APP_ID}&app_code=${config.APP_CODE}`\n}\n\nfunction fetchTileTexture (tile) {\n  const textureUrl = getTileTextureUrl(tile)\n\n  return new Promise((resolve, reject) => {\n    textureLoader.load(textureUrl, resolve, undefined, reject)\n  })\n}\n\nconst defaultColorSteps = [\n  {\n    color: new THREE.Vector3(0.670588235, 0.850980392, 0.91372549),\n    altitude: 700\n  },\n  {\n    color: new THREE.Vector3(0.109803922, 0.564705882, 0.6),\n    altitude: 1500\n  },\n  {\n    color: new THREE.Vector3(0.403921569, 0.662745098, 0.811764706),\n    altitude: 2000\n  },\n  {\n    color: new THREE.Vector3(0.741176471, 0.788235294, 0.882352941),\n    altitude: 2800\n  },\n  {\n    color: new THREE.Vector3(1, 1, 1),\n    altitude: 3000\n  }\n]\n\nconst defaultLighting = new THREE.Vector3(0.7, 0, 0.5)\nconst cesiumLighting = new THREE.Vector3(0, -1, 0)\n\nexport default function getTileMaterial (mapTile, decodedTile, options) {\n  switch (options.style) {\n    // Elevation Styling\n    case stylesList[0]: {\n      return Promise.resolve(new ElevationMaterial(\n        decodedTile,\n        {\n          colorSteps: defaultColorSteps,\n          lightVector: options.dataset === datasetList[1]\n            ? cesiumLighting\n            : defaultLighting\n        }\n      ))\n    }\n\n    // Texture\n    case stylesList[1]: {\n      return fetchTileTexture(mapTile).then((texture) => {\n        texture.minFilter = THREE.LinearFilter\n        texture.magFilter = THREE.LinearFilter\n        texture.generateMipmaps = false\n        texture.wrapS = texture.wrapT = THREE.ClampToEdgeWrapping\n\n        return new THREE.MeshBasicMaterial({\n          map: texture\n        })\n      })\n    }\n\n    // Wireframe\n    case stylesList[2]: {\n      return Promise.resolve(new THREE.MeshBasicMaterial({\n        color: 0x000000,\n        wireframe: true\n      }))\n    }\n  }\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { datasetList } from './constants'\n\nconst state = {\n  currentDataset: datasetList[0],\n  isAttributionPopupVisible: false\n}\n\nconst attributionTrigger = document.querySelector('.attribution-trigger')\nconst attributionPopup = document.querySelector('.attribution-popup')\nconst cesiumAttribution = document.querySelector('.cesium-attribution')\n// const nextzenAttribution = document.querySelector('.nextzen-attribution')\nconst sampleAttribution = document.querySelector('.sample-attribution')\nconst cesiumIonLogo = document.querySelector('.cesium-ion-logo')\n\nattributionTrigger.addEventListener('click', onAttributionTriggerClick)\nwindow.addEventListener('message', onWindowMessage)\n\nupdateUi(state)\n\nfunction onAttributionTriggerClick () {\n  state.isAttributionPopupVisible = !state.isAttributionPopupVisible\n\n  updateUi(state)\n}\n\nfunction onWindowMessage (event) {\n  if (typeof event.data !== 'object' || event.data.type !== 'dataset-change') {\n    return\n  }\n\n  state.currentDataset = event.data.dataset\n  updateUi(state)\n}\n\nfunction updateUi (state) {\n  attributionTrigger.classList.toggle('active', state.isAttributionPopupVisible)\n  attributionPopup.style.display = state.isAttributionPopupVisible ? 'block' : 'none'\n  sampleAttribution.style.display = state.currentDataset === datasetList[0] ? 'block' : 'none'\n  cesiumAttribution.style.display = state.currentDataset === datasetList[1] ? 'block' : 'none'\n  // nextzenAttribution.style.display = state.currentDataset === datasetList[2] ? 'block' : 'none'\n\n  cesiumIonLogo.style.display = state.currentDataset === datasetList[1] ? 'block' : 'none'\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as dat from 'dat.gui'\nimport * as THREE from 'three'\nimport { MapView } from '@here/harp-mapview'\nimport {\n  GeoCoordinates,\n  hereTilingScheme, /*\n  mercatorTilingScheme, */\n  webMercatorTilingScheme\n} from '@here/harp-geoutils'\nimport { MapControls } from '@here/harp-map-controls'\nimport { TerrainDataSource } from '@here/harp-terrain-datasource'\nimport { QUANTIZED_MESH_TILE_DECODER_ID } from '@here/harp-terrain-datasource/src/quantized-mesh/tile-decoder'\n/* import {\n  PNG_TILE_DECODER_ID,\n  DEM_ENCODINGS\n} from '@here/harp-terrain-datasource/src/png/tile-decoder' */\n\nimport config from './config'\nimport {\n  datasetList,\n  stylesList\n} from './constants'\nimport fetchCesiumWorldTerrainTile from './fetch-cesium-tile'\nimport fetchSampleTile from './fetch-sample-tile'\nimport getTileMaterial from './get-tile-material'\n// import fetchNextzenTile from './fetch-nextzen-tile'\nimport './attribution-ui'\n\nconst QUANTIZED_MESH_DECODER_URL = './dist/quantized-mesh-decoder.bundle.js'\n// const PNG_DECODER_URL = './dist/png-decoder.bundle.js'\n\nfunction fetchWorldTerrainToken () {\n  const url = `https://api.cesium.com/v1/assets/1/endpoint?access_token=${config.CESIUM_USER_ACCESS_TOKEN}`\n\n  return window.fetch(url)\n    .then(res => res.json())\n    .then(endpoint => endpoint.accessToken)\n    .catch(err => console.log(err))\n}\n\nfunction initializeMapView (canvas) {\n  const mapView = new MapView({\n    minZoomLevel: 8,\n    maxZoomLevel: 14,\n    canvas,\n    maxVisibleDataSourceTiles: 300,\n    tileCacheSize: 1000\n  })\n\n  /* eslint-disable no-new */\n  new MapControls(mapView)\n  /* eslint-enable no-new */\n\n  mapView.resize(window.innerWidth, window.innerHeight)\n\n  mapView.zoomLevelBias = 0.5\n\n  window.addEventListener('resize', () => {\n    mapView.resize(window.innerWidth, window.innerHeight)\n  })\n\n  return mapView\n}\n\nfunction createCesiumWorldTerrainDataSource (worldTerrainToken, options) {\n  return new TerrainDataSource({\n    concurrentDecoderServiceName: QUANTIZED_MESH_TILE_DECODER_ID,\n    concurrentDecoderScriptUrl: QUANTIZED_MESH_DECODER_URL,\n    tilingScheme: hereTilingScheme,\n    fetchTile: (tileKey) => fetchCesiumWorldTerrainTile(tileKey, worldTerrainToken),\n    getTileMaterial: (mapTile, decodedTile) => getTileMaterial(mapTile, decodedTile, options)\n  })\n}\n\nfunction createSampleTilesDataSource (options) {\n  return new TerrainDataSource({\n    concurrentDecoderServiceName: QUANTIZED_MESH_TILE_DECODER_ID,\n    concurrentDecoderScriptUrl: QUANTIZED_MESH_DECODER_URL,\n    tilingScheme: webMercatorTilingScheme,\n    fetchTile: (tileKey) => fetchSampleTile(tileKey),\n    getTileMaterial: (mapTile, decodedTile) => getTileMaterial(mapTile, decodedTile, options),\n    getDisplayZoomLevel: level => {\n      return THREE.Math.clamp(level + 2, 8, 14)\n    }\n  })\n}\n\n/* function createPNGDataSource (options, decoderOptions) {\n  return new TerrainDataSource({\n    concurrentDecoderServiceName: PNG_TILE_DECODER_ID,\n    concurrentDecoderScriptUrl: PNG_DECODER_URL,\n    tilingScheme: mercatorTilingScheme,\n    fetchTile: fetchNextzenTile,\n    getTileMaterial: (mapTile, decodedTile) => getTileMaterial(mapTile, decodedTile, options),\n    decoderOptions\n  })\n} */\n\nfetchWorldTerrainToken().then(worldTerrainToken => {\n  const uiOptions = {\n    dataset: datasetList[0],\n    style: stylesList[0]\n  }\n  const mapView = initializeMapView(document.getElementById('map'))\n\n  const cesiumWorldTerrainDataSource = createCesiumWorldTerrainDataSource(worldTerrainToken, uiOptions)\n  const sampleDataSource = createSampleTilesDataSource(uiOptions)\n  /* const nextzenDataSource = createPNGDataSource(uiOptions, {\n    widthSegments: 63,\n    heightSegments: 63,\n    demEncoding: DEM_ENCODINGS.terrarium\n  }) */\n\n  mapView.addDataSource(cesiumWorldTerrainDataSource)\n  mapView.addDataSource(sampleDataSource)\n  // mapView.addDataSource(nextzenDataSource)\n\n  sampleDataSource.enabled = uiOptions.dataset === datasetList[0]\n  cesiumWorldTerrainDataSource.enabled = uiOptions.dataset === datasetList[1]\n  // nextzenDataSource.enabled = uiOptions.dataset === datasetList[2]\n\n  mapView.setCameraGeolocationAndZoom(\n    new GeoCoordinates(43.751997519592596, -110.73214288570348),\n    12\n  )\n  mapView.camera.rotateX(THREE.Math.degToRad(35))\n\n  const gui = new dat.GUI({width: 300})\n  const datasetController = gui.add(uiOptions, 'dataset', datasetList)\n  const styleController = gui.add(uiOptions, 'style', stylesList)\n\n  function updateTiles () {\n    mapView.clearTileCache()\n    mapView.update()\n  }\n\n  datasetController.onChange(dataset => {\n    sampleDataSource.enabled = dataset === datasetList[0]\n    cesiumWorldTerrainDataSource.enabled = dataset === datasetList[1]\n    // nextzenDataSource.enabled = dataset === datasetList[2]\n\n    styleController.setValue(stylesList[0])\n    styleController.updateDisplay()\n\n    // Disable texture style for Cesium World Terrain tiles for now\n    // as we have only texture tiles in mercator tiling\n    // scheme and Cesium tiles are using Equirectangular.\n    styleController\n      .domElement\n      .querySelectorAll('option[value*=Texture]')\n      .forEach(option => { option.disabled = dataset === datasetList[1] })\n\n    updateTiles()\n    window.postMessage({type: 'dataset-change', dataset}, '*')\n  })\n  styleController.onChange(updateTiles)\n})\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport decode from '@here/quantized-mesh-decoder'\n\nexport const QUANTIZED_MESH_TILE_DECODER_ID = 'quantized-mesh-tile-decoder'\n\nexport class QuantizedMeshTileDecoder {\n  connect () {\n    return Promise.resolve()\n  }\n\n  /**\n   * Rearranges vertices components in more THREE.js-friendly\n   * way [x, y, z, x, y, z, ...] instead of\n   * [x, x, x,..., y, y, y,... z, z, z, ...].\n   *\n   * Also, scales x, y, z to be in [0, 1] range.\n   *\n   * @param {Uint16Array} vertexData\n   * @returns {Float32Array}\n   */\n  constructPositionArray (vertexData) {\n    const elementsPerVertex = 3\n    const vertexCount = vertexData.length / 3\n    const positionAttributeArray = new Float32Array(vertexData.length)\n\n    const vertexMaxPosition = 32767\n\n    for (let i = 0; i < vertexCount; i++) {\n      positionAttributeArray[i * elementsPerVertex] = vertexData[i] / vertexMaxPosition\n      positionAttributeArray[i * elementsPerVertex + 1] = vertexData[i + vertexCount] / vertexMaxPosition\n      positionAttributeArray[i * elementsPerVertex + 2] = vertexData[i + vertexCount * 2] / vertexMaxPosition\n    }\n\n    return positionAttributeArray\n  }\n\n  /**\n   * Drops z-coordinate of each vertex to make a UV-map.\n   *\n   * @param {Float32Array} positionArray\n   * @returns {Float32Array}\n   */\n  constructUvArray (positionArray) {\n    return positionArray.filter((item, index) => index % 3 < 2)\n  }\n\n  decodeTile (data) {\n    const decodedTile = decode(data)\n    const positionArray = this.constructPositionArray(decodedTile.vertexData)\n    const uvArray = this.constructUvArray(positionArray)\n    const vertexAttributes = []\n\n    vertexAttributes.push(\n      {\n        name: 'position',\n        type: 'float',\n        buffer: positionArray,\n        itemCount: 3,\n        metadata: decodedTile.header\n      },\n      {\n        name: 'uv',\n        type: 'float',\n        buffer: uvArray,\n        itemCount: 2\n      }\n    )\n\n    Object.keys(decodedTile.extensions).forEach(key => {\n      if (key === 'vertexNormals' && decodedTile.extensions[key].byteLength > 0) {\n        let array = new Uint8Array(decodedTile.extensions[key])\n        vertexAttributes.push({\n          name: 'octNormal',\n          type: 'float',\n          buffer: array,\n          itemCount: 2\n        })\n      }\n    })\n\n    const verityTile = {\n      techniques: [],\n      geometries: [\n        {\n          index: {\n            name: 'index',\n            type: 'uint16',\n            buffer: decodedTile.triangleIndices,\n            itemCount: 1\n          },\n          vertexAttributes\n        }\n      ]\n    }\n\n    return Promise.resolve(verityTile)\n  }\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default function fetchCesiumWorldTerrainTile (tileKey, worldTerrainToken) {\n  const column = tileKey.column\n  const row = tileKey.row\n  const level = tileKey.level - 1\n\n  const url = `https://assets.cesium.com/1/${level}/${column}/${row}.terrain?extensions=octvertexnormals&v=1.1.0`\n  const qmContentType = 'application/vnd.quantized-mesh,application/octet-stream;q=0.9'\n\n  return window.fetch(url, {\n    headers: {\n      'Accept': `${qmContentType};access_token=${worldTerrainToken};`\n    }\n  })\n    .then(res => {\n      if (res.status !== 200) {\n        throw new Error(`Unable to load tile ${url}`)\n      }\n\n      return res.arrayBuffer()\n    })\n    .catch(err => {\n      console.log(err)\n    })\n}\n","/*\n * Copyright  2017-2019 HERE Europe B.V.\n * Licensed under Apache 2.0, see full license in LICENSE\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default function fetchSampleTile (tileKey) {\n  const column = tileKey.column\n  const row = tileKey.rowCount() - tileKey.row - 1\n  const level = tileKey.level\n\n  const url = `https://mykolaharmash.github.io/grand-teton-tiles/tiles/${level}/${column}/${row}.terrain`\n\n  return window.fetch(url)\n    .then(res => {\n      if (res.status !== 200) {\n        throw new Error(`Unable to load tile ${url}`)\n      }\n\n      return res.arrayBuffer()\n    })\n    .catch(err => {\n      console.log(err)\n    })\n}\n"],"sourceRoot":""}